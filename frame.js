!(function (e) {
  function t(e) {
    Object.defineProperty(this, e, {
      enumerable: !0,
      get: function () {
        return this[h][e];
      },
    });
  }
  function n(e) {
    if (
      "undefined" != typeof System && System.isModule
        ? System.isModule(e)
        : "[object Module]" === Object.prototype.toString.call(e)
    )
      return e;
    var t = { default: e, __useDefault: e };
    if (e && e.__esModule)
      for (var n in e) Object.hasOwnProperty.call(e, n) && (t[n] = e[n]);
    return new i(t);
  }
  function i(e) {
    Object.defineProperty(this, h, { value: e }),
      Object.keys(e).forEach(t, this);
  }
  function r(e) {
    return "@node/" === e.substr(0, 6) ? d(e, n(p(e.substr(6)))) : u[e];
  }
  function o(e) {
    var t = r(e);
    if (!t)
      throw new Error(
        'Module "' + e + '" expected, but not contained in build.'
      );
    if (t.module) return t.module;
    var n = t.linkRecord;
    return (
      (function e(t, n) {
        if (!n.depLoads) {
          n.declare && a(t, n), (n.depLoads = []);
          for (var i = 0; i < n.deps.length; i++) {
            var o = r(n.deps[i]);
            n.depLoads.push(o), o.linkRecord && e(o, o.linkRecord);
            var s = n.setters && n.setters[i];
            s &&
              (s(o.module || o.linkRecord.moduleObj),
              o.importerSetters.push(s));
          }
          return t;
        }
      })(t, n),
      c(t, n, []),
      t.module
    );
  }
  function a(t, n) {
    var i = n.moduleObj,
      r = t.importerSetters,
      o = !1,
      a = n.declare.call(
        e,
        function (e, t) {
          if (!o) {
            if ("object" == typeof e)
              for (var n in e) "__useDefault" !== n && (i[n] = e[n]);
            else i[e] = t;
            o = !0;
            for (var a = 0; a < r.length; a++) r[a](i);
            return (o = !1), t;
          }
        },
        { id: t.key }
      );
    "function" != typeof a
      ? ((n.setters = a.setters), (n.execute = a.execute))
      : ((n.setters = []), (n.execute = a));
  }
  function s(e, t, n) {
    return (u[e] = {
      key: e,
      module: void 0,
      importerSetters: [],
      linkRecord: {
        deps: t,
        depLoads: void 0,
        declare: n,
        setters: void 0,
        execute: void 0,
        moduleObj: {},
      },
    });
  }
  function l(e, t, n, i) {
    var r = {};
    return (u[e] = {
      key: e,
      module: void 0,
      importerSetters: [],
      linkRecord: {
        deps: t,
        depLoads: void 0,
        declare: void 0,
        execute: i,
        executingRequire: n,
        moduleObj: { default: r, __useDefault: r },
        setters: void 0,
      },
    });
  }
  function c(t, n, r) {
    if ((r.push(t), t.module)) return t.module;
    if (n.setters) {
      for (var o = 0; o < n.deps.length; o++) {
        var a = n.depLoads[o],
          s = a.linkRecord;
        s && -1 === r.indexOf(a) && c(a, s, s.setters ? r : []);
      }
      n.execute.call(f);
    } else {
      var l = { id: t.key },
        d = n.moduleObj;
      Object.defineProperty(l, "exports", {
        configurable: !0,
        set: function (e) {
          d.default = d.__useDefault = e;
        },
        get: function () {
          return d.__useDefault;
        },
      });
      var u = (function (e, t, n) {
        return function (i) {
          for (var r = 0; r < e.length; r++)
            if (e[r] === i) {
              var o,
                a = t[r],
                s = a.linkRecord;
              return "__useDefault" in
                (o = s
                  ? -1 === n.indexOf(a)
                    ? c(a, s, n)
                    : s.moduleObj
                  : a.module)
                ? o.__useDefault
                : o;
            }
        };
      })(n.deps, n.depLoads, r);
      if (!n.executingRequire) for (o = 0; o < n.deps.length; o++) u(n.deps[o]);
      var h = n.execute.call(e, u, d.__useDefault, l);
      void 0 !== h
        ? (d.default = d.__useDefault = h)
        : l.exports !== d.__useDefault &&
          (d.default = d.__useDefault = l.exports);
      var p = d.__useDefault;
      if (p && p.__esModule)
        for (var m in p) Object.hasOwnProperty.call(p, m) && (d[m] = p[m]);
    }
    l = t.module = new i(n.moduleObj);
    if (!n.setters)
      for (o = 0; o < t.importerSetters.length; o++) t.importerSetters[o](l);
    return l;
  }
  function d(e, t) {
    return (u[e] = {
      key: e,
      module: t,
      importerSetters: [],
      linkRecord: void 0,
    });
  }
  var u = {},
    h = "undefined" != typeof Symbol ? Symbol() : "@@baseObject";
  (i.prototype = Object.create(null)),
    "undefined" != typeof Symbol &&
      Symbol.toStringTag &&
      (i.prototype[Symbol.toStringTag] = "Module");
  var p =
      ("undefined" != typeof System && System._nodeRequire) ||
      ("undefined" != typeof require &&
        void 0 !== require.resolve &&
        "undefined" != typeof process &&
        process.platform &&
        require),
    f = {};
  return (
    Object.freeze && Object.freeze(f),
    function (e, t, r, a) {
      return function (c) {
        c(function (c) {
          var h = {
            _nodeRequire: p,
            register: s,
            registerDynamic: l,
            registry: {
              get: function (e) {
                return u[e].module;
              },
              set: d,
            },
            newModule: function (e) {
              return new i(e);
            },
          };
          d("@empty", new i({}));
          for (var f = 0; f < t.length; f++) d(t[f], n(arguments[f]));
          a(h);
          var m = o(e[0]);
          if (e.length > 1) for (f = 1; f < e.length; f++) o(e[f]);
          return r
            ? m.__useDefault
            : (m instanceof i &&
                Object.defineProperty(m, "__esModule", { value: !0 }),
              m);
        });
      };
    }
  );
})(
  "undefined" != typeof self
    ? self
    : "undefined" != typeof global
    ? global
    : this
)(["a"], [], !0, function ($__System) {
  var require = this.require,
    exports = this.exports,
    module = this.module,
    f,
    factory;
  !(function (e) {
    function t(e, t) {
      for (var n = e.split("."); n.length; ) t = t[n.shift()];
      return t;
    }
    function n(n) {
      if ("string" == typeof n) return t(n, e);
      if (!(n instanceof Array))
        throw new Error("Global exports must be a string or array.");
      for (var i = {}, r = 0; r < n.length; r++)
        i[n[r].split(".").pop()] = t(n[r], e);
      return i;
    }
    function i(t) {
      if (-1 === a.indexOf(t)) {
        try {
          var n = e[t];
        } catch (e) {
          a.push(t);
        }
        this(t, n);
      }
    }
    var r,
      o = $__System,
      a = [
        "_g",
        "sessionStorage",
        "localStorage",
        "clipboardData",
        "frames",
        "frameElement",
        "external",
        "mozAnimationStartTime",
        "webkitStorageInfo",
        "webkitIndexedDB",
        "mozInnerScreenY",
        "mozInnerScreenX",
      ];
    o.registry.set(
      "@@global-helpers",
      o.newModule({
        prepareGlobal: function (t, o, a) {
          var s,
            l = e.define;
          if (((e.define = void 0), a))
            for (var c in ((s = {}), a)) (s[c] = e[c]), (e[c] = a[c]);
          return (
            o ||
              ((r = {}),
              Object.keys(e).forEach(i, function (e, t) {
                r[e] = t;
              })),
            function () {
              var t,
                a = o ? n(o) : {},
                c = !!o;
              if (
                (o ||
                  Object.keys(e).forEach(i, function (e, n) {
                    r[e] !== n &&
                      void 0 !== n &&
                      (o ||
                        ((a[e] = n),
                        void 0 !== t ? c || t === n || (c = !0) : (t = n)));
                  }),
                (a = c ? a : t),
                s)
              )
                for (var d in s) e[d] = s[d];
              return (e.define = l), a;
            }
          );
        },
      })
    );
  })(
    "undefined" != typeof self
      ? self
      : "undefined" != typeof global
      ? global
      : this
  ),
    (function (e) {
      "use strict";
      var t = function () {},
        n =
          e.requestAnimationFrame ||
          e.webkitRequestAnimationFrame ||
          e.mozRequestAnimationFrame ||
          e.msRequestAnimationFrame ||
          function (e) {
            return setTimeout(e, 16);
          };
      function i() {
        (this.reads = []),
          (this.writes = []),
          (this.raf = n.bind(e)),
          t("initialized", this);
      }
      function r(e) {
        e.scheduled ||
          ((e.scheduled = !0),
          e.raf(
            function (e) {
              t("flush");
              var n,
                i = e.writes,
                a = e.reads;
              try {
                t("flushing reads", a.length),
                  o(a),
                  t("flushing writes", i.length),
                  o(i);
              } catch (e) {
                n = e;
              }
              (e.scheduled = !1), (a.length || i.length) && r(e);
              if (n) {
                if ((t("task errored", n.message), !e.catch)) throw n;
                e.catch(n);
              }
            }.bind(null, e)
          ),
          t("flush scheduled"));
      }
      function o(e) {
        var n;
        for (t("run tasks"); (n = e.shift()); ) n();
      }
      function a(e, t) {
        var n = e.indexOf(t);
        return !!~n && !!e.splice(n, 1);
      }
      i.prototype = {
        constructor: i,
        measure: function (e, n) {
          t("measure");
          var i = n ? e.bind(n) : e;
          return this.reads.push(i), r(this), i;
        },
        mutate: function (e, n) {
          t("mutate");
          var i = n ? e.bind(n) : e;
          return this.writes.push(i), r(this), i;
        },
        clear: function (e) {
          return t("clear", e), a(this.reads, e) || a(this.writes, e);
        },
        extend: function (e) {
          if ((t("extend", e), "object" != typeof e))
            throw new Error("expected object");
          var n = Object.create(this);
          return (
            (function (e, t) {
              for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]);
            })(n, e),
            (n.fastdom = this),
            n.initialize && n.initialize(),
            n
          );
        },
        catch: null,
      };
      var s = (e.fastdom = e.fastdom || new i());
      "f" == "function"[0]
        ? $__System.registerDynamic("b", [], !1, function (e, t, n) {
            return function () {
              return s;
            }.call(this);
          })
        : "o" == (typeof module)[0] && (module.exports = s);
    })(window || this),
    (function () {
      var e = {
        initialize: function () {
          this._tasks = new Map();
        },
        mutate: function (e, n) {
          return t(this, "mutate", e, n);
        },
        measure: function (e, n) {
          return t(this, "measure", e, n);
        },
        clear: function (e) {
          var t = this._tasks,
            n = t.get(e);
          this.fastdom.clear(n), t.delete(n);
        },
      };
      function t(e, t, n, i) {
        var r,
          o = e._tasks,
          a = e.fastdom,
          s = new Promise(function (e, l) {
            r = a[t](function () {
              o.delete(s);
              try {
                e(i ? n.call(i) : n());
              } catch (e) {
                l(e);
              }
            }, i);
          });
        return o.set(s, r), s;
      }
      "f" == "function"[0]
        ? $__System.registerDynamic("c", [], !1, function (t, n, i) {
            return function () {
              return e;
            }.call(this);
          })
        : "o" == (typeof module)[0]
        ? (module.exports = e)
        : (window.fastdomPromised = e);
    })(),
    $__System.registerDynamic("d", ["e"], !0, function (e, t, n) {
      this || self;
      !(function (e) {
        var t;
        (t = function (e) {
          return e;
        }),
          (e.defaultLanguage = t(
            navigator.languages && navigator.languages.length > 0
              ? navigator.languages[0]
              : navigator.language || navigator.userLanguage
          )),
          (e.localize = function (n, i) {
            var r, o, a, s, l, c, d, u, h, p, f, m, g, v, y, b, w, x;
            return (
              null == i && (i = {}),
              (x = this),
              (s = {}),
              (a = i.fileExtension || "json"),
              (o = e.Deferred()),
              (d = function (e, t, n) {
                switch ((null == n && (n = 1), n)) {
                  case 1:
                    return (s = {}), l(t + ".lproj/" + e + "." + a, e, t, n);
                  default:
                    return o.resolve();
                }
              }),
              (l = function (t, n, r, o) {
                var a, l, c;
                return (
                  null != i.pathPrefix && (t = i.pathPrefix + "/" + t),
                  (c = function (t) {
                    return e.extend(s, t), g(s), d(n, r, o + 1);
                  }),
                  (l = function () {
                    return 2 === o && r.indexOf("-") > -1
                      ? d(n, r, o + 1)
                      : i.fallback && i.fallback !== r
                      ? d(n, i.fallback)
                      : void 0;
                  }),
                  e.localize.data[n]
                    ? c(e.localize.data[n])
                    : ((a = {
                        url: t,
                        dataType: "json",
                        async: !0,
                        timeout: null != i.timeout ? i.timeout : 500,
                        success: c,
                        error: l,
                      }),
                      "file:" === window.location.protocol &&
                        (a.error = function (t) {
                          return c(
                            t.responseText ? e.parseJSON(t.responseText) : {}
                          );
                        }),
                      e.ajax(a))
                );
              }),
              (g = function (e) {
                return null != i.callback ? i.callback(e, r) : r(e);
              }),
              (r = function (t) {
                return (
                  (e.localize.data[n] = t),
                  x.each(function () {
                    var n, i, r;
                    if (
                      ((i = (
                        (n = e(this)).data("localize") ||
                        n.data("afterContent") ||
                        n.attr("ty-hint") ||
                        ""
                      ).replace(/\\n/g, "\n")),
                      (r = w(i, t)))
                    )
                      return u(n, i, r);
                  })
                );
              }),
              (u = function (t, n, i) {
                if (
                  (t.is("input")
                    ? f(t, n, i)
                    : t.is("textarea")
                    ? f(t, n, i)
                    : t.is("img")
                    ? p(t, n, i)
                    : t.is("optgroup") && m(t, n, i),
                  t[0].hasAttribute("data-after-content"))
                )
                  t.attr("data-after-content", i);
                else if (t[0].hasAttribute("ty-hint"))
                  t.attr("ty-hint", i).attr("aria-label", i);
                else if (t[0].hasAttribute("data-lt")) t.html(i);
                else {
                  if (e.isPlainObject(i)) return h(t, i);
                  t.text(i);
                }
              }),
              (f = function (t, n, i) {
                var r;
                if (
                  ((r = e.isPlainObject(i) ? i.value : i),
                  t.is("[placeholder]"))
                )
                  return t.attr("placeholder", r);
              }),
              (h = function (e, t) {
                return y(e, "title", t), b(e, "text", t);
              }),
              (m = function (e, t, n) {
                return e.attr("label", n);
              }),
              (p = function (e, t, n) {
                return y(e, "alt", n), y(e, "src", n);
              }),
              (w = function (e, t) {
                if (!e) return "";
                if (t[e]) return t[e];
                return /((\.\.\.)|(…))$/.exec(e)
                  ? (t[(e = e.replace(/((\.\.\.)|(…))$/, ""))] || e) + "…"
                  : e;
              }),
              (y = function (e, t, n) {
                if (null != (n = w(t, n))) return e.attr(t, n);
              }),
              (b = function (e, t, n) {
                if (null != (n = w(t, n))) return e.text(n);
              }),
              (v = function (e) {
                var t;
                return "string" == typeof e
                  ? "^" + e + "$"
                  : null != e.length
                  ? (function () {
                      var n, i, r;
                      for (r = [], n = 0, i = e.length; n < i; n++)
                        (t = e[n]), r.push(v(t));
                      return r;
                    })().join("|")
                  : e;
              }),
              (c = t(i.language ? i.language : e.defaultLanguage)),
              i.skipLanguage && c.match(v(i.skipLanguage))
                ? o.resolve()
                : d(n, c, 1),
              (x.localizePromise = o),
              x
            );
          }),
          (e.fn.localize = e.localize),
          (e.localize.getString = function (t, n) {
            let i = e.localize.data[n || "Front"] || {};
            return t
              ? i[t]
                ? i[t]
                : /((\.\.\.)|(…))$/.exec(t)
                ? (i[(t = t.replace(/((\.\.\.)|(…))$/, ""))] || t) + "…"
                : t
              : "";
          }),
          (e.localize.isLoaded = function (t) {
            return !!e.localize.data[t || "Front"];
          }),
          (e.localize.data = {});
      })(e("e"));
    }),
    $__System.registerDynamic("f", ["e"], !0, function (e, t, n) {
      "use strict";
      this || self;
      if (
        (window.jQuery || ((window.$ = e("e")), (window.jQuery = window.$)),
        "undefined" == typeof jQuery)
      )
        throw new Error("Bootstrap's JavaScript requires jQuery");
      !(function (e) {
        var t = '[data-dismiss="alert"]',
          n = function (n) {
            e(n).on("click", t, this.close);
          };
        (n.VERSION = "3.2.0"),
          (n.prototype.close = function (t) {
            var n = e(this),
              i = n.attr("data-target");
            i || (i = (i = n.attr("href")) && i.replace(/.*(?=#[^\s]*$)/, ""));
            var r = e(i);
            function o() {
              r.detach().trigger("closed.bs.alert").remove();
            }
            t && t.preventDefault(),
              r.length || (r = n.hasClass("alert") ? n : n.parent()),
              r.trigger((t = e.Event("close.bs.alert"))),
              t.isDefaultPrevented() ||
                (r.removeClass("in"),
                e.support.transition && r.hasClass("fade")
                  ? r.one("bsTransitionEnd", o).emulateTransitionEnd(150)
                  : o());
          });
        var i = e.fn.alert;
        (e.fn.alert = function (t) {
          return this.each(function () {
            var i = e(this),
              r = i.data("bs.alert");
            r || i.data("bs.alert", (r = new n(this))),
              "string" == typeof t && r[t].call(i);
          });
        }),
          (e.fn.alert.Constructor = n),
          (e.fn.alert.noConflict = function () {
            return (e.fn.alert = i), this;
          }),
          e(document).on("click.bs.alert.data-api", t, n.prototype.close);
      })(jQuery),
        (function (e) {
          var t = function (n, i) {
            (this.$element = e(n)),
              (this.options = e.extend({}, t.DEFAULTS, i)),
              (this.isLoading = !1);
          };
          function n(n) {
            return this.each(function () {
              var i = e(this),
                r = i.data("bs.button"),
                o = "object" == typeof n && n;
              r || i.data("bs.button", (r = new t(this, o))),
                "toggle" == n ? r.toggle() : n && r.setState(n);
            });
          }
          (t.VERSION = "3.2.0"),
            (t.DEFAULTS = { loadingText: "loading..." }),
            (t.prototype.setState = function (t) {
              var n = "disabled",
                i = this.$element,
                r = i.is("input") ? "val" : "html",
                o = i.data();
              (t += "Text"),
                null == o.resetText && i.data("resetText", i[r]()),
                i[r](null == o[t] ? this.options[t] : o[t]),
                setTimeout(
                  e.proxy(function () {
                    "loadingText" == t
                      ? ((this.isLoading = !0), i.addClass(n).attr(n, n))
                      : this.isLoading &&
                        ((this.isLoading = !1), i.removeClass(n).removeAttr(n));
                  }, this),
                  0
                );
            }),
            (t.prototype.toggle = function () {
              var e = !0,
                t = this.$element.closest('[data-toggle="buttons"]');
              if (t.length) {
                var n = this.$element.find("input");
                "radio" == n.prop("type") &&
                  (n.prop("checked") && this.$element.hasClass("active")
                    ? (e = !1)
                    : t.find(".active").removeClass("active")),
                  e &&
                    n
                      .prop("checked", !this.$element.hasClass("active"))
                      .trigger("change");
              }
              e && this.$element.toggleClass("active");
            });
          var i = e.fn.button;
          (e.fn.button = n),
            (e.fn.button.Constructor = t),
            (e.fn.button.noConflict = function () {
              return (e.fn.button = i), this;
            }),
            e(document).on(
              "click.bs.button.data-api",
              '[data-toggle^="button"]',
              function (t) {
                var i = e(t.target);
                i.hasClass("btn") || (i = i.closest(".btn")),
                  n.call(i, "toggle"),
                  t.preventDefault();
              }
            );
        })(jQuery),
        (function (e) {
          var t = ".dropdown-backdrop",
            n = '[data-toggle="dropdown"]',
            i = function (t) {
              e(t).on("click.bs.dropdown", this.toggle);
            };
          function r(i) {
            (i && 3 === i.which) ||
              (e(t).remove(),
              e(n).each(function () {
                var t = o(e(this)),
                  n = { relatedTarget: this };
                t.hasClass("open") &&
                  (t.trigger((i = e.Event("hide.bs.dropdown", n))),
                  i.isDefaultPrevented() ||
                    t.removeClass("open").trigger("hidden.bs.dropdown", n));
              }));
          }
          function o(t) {
            var n = t.attr("data-target");
            n ||
              (n =
                (n = t.attr("href")) &&
                /#[A-Za-z]/.test(n) &&
                n.replace(/.*(?=#[^\s]*$)/, ""));
            var i = n && e(n);
            return i && i.length ? i : t.parent();
          }
          (i.VERSION = "3.2.0"),
            (i.prototype.toggle = function (t) {
              var n = e(this);
              if (!n.is(".disabled, :disabled")) {
                var i = o(n),
                  a = i.hasClass("open");
                if ((r(), !a)) {
                  "ontouchstart" in document.documentElement &&
                    !i.closest(".navbar-nav").length &&
                    e('<div class="dropdown-backdrop"/>')
                      .insertAfter(e(this))
                      .on("click", r);
                  var s = { relatedTarget: this };
                  if (
                    (i.trigger((t = e.Event("show.bs.dropdown", s))),
                    t.isDefaultPrevented())
                  )
                    return;
                  n.trigger("focus"),
                    i.toggleClass("open").trigger("shown.bs.dropdown", s);
                }
                return !1;
              }
            }),
            (i.prototype.keydown = function (t) {
              if (/(38|40|27)/.test(t.keyCode)) {
                var i = e(this);
                if (
                  (t.preventDefault(),
                  t.stopPropagation(),
                  !i.is(".disabled, :disabled"))
                ) {
                  var r = o(i),
                    a = r.hasClass("open");
                  if (!a || (a && 27 == t.keyCode))
                    return (
                      27 == t.which && r.find(n).trigger("focus"),
                      i.trigger("click")
                    );
                  var s = " li:not(.divider):visible a",
                    l = r.find('[role="menu"]' + s + ', [role="listbox"]' + s);
                  if (l.length) {
                    var c = l.index(l.filter(":focus"));
                    38 == t.keyCode && c > 0 && c--,
                      40 == t.keyCode && c < l.length - 1 && c++,
                      ~c || (c = 0),
                      l.eq(c).trigger("focus");
                  }
                }
              }
            });
          var a = e.fn.dropdown;
          (e.fn.dropdown = function (t) {
            return this.each(function () {
              var n = e(this),
                r = n.data("bs.dropdown");
              r || n.data("bs.dropdown", (r = new i(this))),
                "string" == typeof t && r[t].call(n);
            });
          }),
            (e.fn.dropdown.Constructor = i),
            (e.fn.dropdown.noConflict = function () {
              return (e.fn.dropdown = a), this;
            }),
            e(document)
              .on("click.bs.dropdown.data-api", "modal.fade.in", r)
              .on("click.bs.dropdown.data-api", ".dropdown form", function (e) {
                e.stopPropagation();
              })
              .on("click.bs.dropdown.data-api", n, i.prototype.toggle)
              .on(
                "keydown.bs.dropdown.data-api",
                n + ', [role="menu"], [role="listbox"]',
                i.prototype.keydown
              );
        })(jQuery),
        (function (e) {
          var t = function (t, n) {
            (this.options = n),
              (this.$body = e(document.body)),
              (this.$element = e(t)),
              (this.$backdrop = this.isShown = null),
              (this.scrollbarWidth = 0),
              this.options.remote &&
                this.$element.find(".modal-content").load(
                  this.options.remote,
                  e.proxy(function () {
                    this.$element.trigger("loaded.bs.modal");
                  }, this)
                );
          };
          function n(n, i) {
            return this.each(function () {
              var r = e(this),
                o = r.data("bs.modal"),
                a = e.extend(
                  {},
                  t.DEFAULTS,
                  r.data(),
                  "object" == typeof n && n
                );
              o || r.data("bs.modal", (o = new t(this, a))),
                "string" == typeof n ? o[n](i) : a.show && o.show(i);
            });
          }
          (t.VERSION = "3.2.0"),
            (t.DEFAULTS = { backdrop: !0, keyboard: !0, show: !0 }),
            (t.prototype.toggle = function (e) {
              return this.isShown ? this.hide() : this.show(e);
            }),
            (t.prototype.show = function (t) {
              var n = this,
                i = e.Event("show.bs.modal", { relatedTarget: t });
              this.$element.trigger(i),
                this.isShown ||
                  i.isDefaultPrevented() ||
                  ((this.isShown = !0),
                  this.checkScrollbar(),
                  this.$body.addClass("modal-open"),
                  this.setScrollbar(),
                  this.escape(),
                  this.$element.on(
                    "click.dismiss.bs.modal",
                    '[data-dismiss="modal"]',
                    e.proxy(this.hide, this)
                  ),
                  this.backdrop(function () {
                    var i = e.support.transition && n.$element.hasClass("fade");
                    n.$element.parent().length || n.$element.appendTo(n.$body),
                      n.$element.show().scrollTop(0),
                      i && n.$element[0].offsetWidth,
                      n.$element.addClass("in").attr("aria-hidden", !1),
                      n.enforceFocus();
                    var r = e.Event("shown.bs.modal", { relatedTarget: t });
                    i
                      ? n.$element
                          .find(".modal-dialog")
                          .one("bsTransitionEnd", function () {
                            n.$element.trigger("focus").trigger(r);
                          })
                          .emulateTransitionEnd(300)
                      : n.$element.trigger("focus").trigger(r);
                  }));
            }),
            (t.prototype.hide = function (t) {
              t && t.preventDefault(),
                (t = e.Event("hide.bs.modal")),
                this.$element.trigger(t),
                this.isShown &&
                  !t.isDefaultPrevented() &&
                  ((this.isShown = !1),
                  this.resetScrollbar(),
                  this.escape(),
                  e(document).off("focusin.bs.modal"),
                  this.$element
                    .removeClass("in")
                    .attr("aria-hidden", !0)
                    .off("click.dismiss.bs.modal"),
                  e.support.transition && this.$element.hasClass("fade")
                    ? this.$element
                        .one("bsTransitionEnd", e.proxy(this.hideModal, this))
                        .emulateTransitionEnd(300)
                    : this.hideModal());
            }),
            (t.prototype.enforceFocus = function () {
              e(document)
                .off("focusin.bs.modal")
                .on(
                  "focusin.bs.modal",
                  e.proxy(function (e) {
                    this.$element[0] === e.target ||
                      this.$element.has(e.target).length ||
                      this.$element.trigger("focus");
                  }, this)
                );
            }),
            (t.prototype.escape = function () {
              this.isShown && this.options.keyboard
                ? this.$element.on(
                    "keyup.dismiss.bs.modal",
                    e.proxy(function (e) {
                      27 == e.which && this.hide();
                    }, this)
                  )
                : this.isShown || this.$element.off("keyup.dismiss.bs.modal");
            }),
            (t.prototype.hideModal = function () {
              var t = this;
              this.$element.hide(),
                this.backdrop(function () {
                  t.$element.trigger("hidden.bs.modal"),
                    e("body").removeClass("modal-open");
                });
            }),
            (t.prototype.removeBackdrop = function () {
              this.$backdrop && this.$backdrop.remove(),
                (this.$backdrop = null);
            }),
            (t.prototype.backdrop = function (t) {
              var n = this,
                i = this.$element.hasClass("fade") ? "fade" : "";
              if (this.isShown && this.options.backdrop) {
                var r = e.support.transition && i;
                if (
                  ((this.$backdrop = e(
                    '<div class="modal-backdrop ' + i + '" />'
                  ).appendTo(this.$body)),
                  this.$element.on(
                    "click.dismiss.bs.modal",
                    e.proxy(function (e) {
                      e.target === e.currentTarget &&
                        ("static" == this.options.backdrop
                          ? this.$element[0].focus.call(this.$element[0])
                          : this.hide.call(this));
                    }, this)
                  ),
                  r && this.$backdrop[0].offsetWidth,
                  this.$backdrop.addClass("in"),
                  !t)
                )
                  return;
                r
                  ? this.$backdrop
                      .one("bsTransitionEnd", t)
                      .emulateTransitionEnd(150)
                  : t();
              } else if (!this.isShown && this.$backdrop) {
                this.$backdrop.removeClass("in");
                var o = function () {
                  n.removeBackdrop(), t && t();
                };
                e.support.transition && this.$element.hasClass("fade")
                  ? this.$backdrop
                      .one("bsTransitionEnd", o)
                      .emulateTransitionEnd(150)
                  : o();
              } else t && t();
            }),
            (t.prototype.checkScrollbar = function () {
              document.body.clientWidth >= window.innerWidth ||
                (this.scrollbarWidth =
                  this.scrollbarWidth || this.measureScrollbar());
            }),
            (t.prototype.setScrollbar = function () {
              var e = parseInt(this.$body.css("padding-right") || 0, 10);
              this.scrollbarWidth &&
                this.$body.css("padding-right", e + this.scrollbarWidth);
            }),
            (t.prototype.resetScrollbar = function () {
              this.$body.css("padding-right", "");
            }),
            (t.prototype.measureScrollbar = function () {
              var e = document.createElement("div");
              (e.className = "modal-scrollbar-measure"), this.$body.append(e);
              var t = e.offsetWidth - e.clientWidth;
              return this.$body[0].removeChild(e), t;
            });
          var i = e.fn.modal;
          (e.fn.modal = n),
            (e.fn.modal.Constructor = t),
            (e.fn.modal.noConflict = function () {
              return (e.fn.modal = i), this;
            }),
            e(document).on(
              "click.bs.modal.data-api",
              '[data-toggle="modal"]',
              function (t) {
                var i = e(this),
                  r = i.attr("href"),
                  o = e(
                    i.attr("data-target") ||
                      (r && r.replace(/.*(?=#[^\s]+$)/, ""))
                  ),
                  a = o.data("bs.modal")
                    ? "toggle"
                    : e.extend(
                        { remote: !/#/.test(r) && r },
                        o.data(),
                        i.data()
                      );
                i.is("a") && t.preventDefault(),
                  o.one("show.bs.modal", function (e) {
                    e.isDefaultPrevented() ||
                      o.one("hidden.bs.modal", function () {
                        i.is(":visible") && i.trigger("focus");
                      });
                  }),
                  n.call(o, a, this);
              }
            );
        })(jQuery),
        (function (e) {
          var t = function (t) {
            this.element = e(t);
          };
          function n(n) {
            return this.each(function () {
              var i = e(this),
                r = i.data("bs.tab");
              r || i.data("bs.tab", (r = new t(this))),
                "string" == typeof n && r[n]();
            });
          }
          (t.VERSION = "3.2.0"),
            (t.prototype.show = function () {
              var t = this.element,
                n = t.closest("ul:not(.dropdown-menu)"),
                i = t.data("target");
              if (
                (i ||
                  (i = (i = t.attr("href")) && i.replace(/.*(?=#[^\s]*$)/, "")),
                !t.parent("li").hasClass("active"))
              ) {
                var r = n.find(".active:last a")[0],
                  o = e.Event("show.bs.tab", { relatedTarget: r });
                if ((t.trigger(o), !o.isDefaultPrevented())) {
                  var a = e(i);
                  this.activate(t.closest("li"), n),
                    this.activate(a, a.parent(), function () {
                      t.trigger({ type: "shown.bs.tab", relatedTarget: r });
                    });
                }
              }
            }),
            (t.prototype.activate = function (t, n, i) {
              var r = n.find("> .active"),
                o = i && e.support.transition && r.hasClass("fade");
              function a() {
                r
                  .removeClass("active")
                  .find("> .dropdown-menu > .active")
                  .removeClass("active"),
                  t.addClass("active"),
                  o
                    ? (t[0].offsetWidth, t.addClass("in"))
                    : t.removeClass("fade"),
                  t.parent(".dropdown-menu") &&
                    t.closest("li.dropdown").addClass("active"),
                  i && i();
              }
              o ? r.one("bsTransitionEnd", a).emulateTransitionEnd(150) : a(),
                r.removeClass("in");
            });
          var i = e.fn.tab;
          (e.fn.tab = n),
            (e.fn.tab.Constructor = t),
            (e.fn.tab.noConflict = function () {
              return (e.fn.tab = i), this;
            }),
            e(document).on(
              "click.bs.tab.data-api",
              '[data-toggle="tab"], [data-toggle="pill"]',
              function (t) {
                t.preventDefault(), n.call(e(this), "show");
              }
            );
        })(jQuery);
    }),
    $__System.registerDynamic("10", ["11"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i,
        r = e("11"),
        o = window.bridge,
        a = null;
      window.reqnode && ((i = reqnode("electron")), (a = i.ipcRenderer));
      var s = null,
        l = {
          clipboard: {
            readText: function () {
              return window.reqnode
                ? i.clipboard.readText() || ""
                : o
                ? o.callSync("clipboard.readText")
                : void 0;
            },
            writeForMac: function (e, t) {
              return o.callHandler("clipboard.write", {
                data: e,
                shouldClear: !!t,
              });
            },
            read: function (e, t) {
              var n = t || {},
                r = e && (e.clipboardData || e.dataTransfer);
              if (
                (r &&
                  ((n.html = r.getData("text/html")),
                  (n.markhtml = r.getData("text/markhtml")),
                  (n.text = r.getData("text/plain")),
                  (n.files = Array.from(r.files || [])
                    .map((e) => e.path)
                    .filter((e) => !!e))),
                o)
              )
                return new Promise(function (e, t) {
                  o.callHandler("clipboard.read", {}, function (t) {
                    if (
                      (n.markhtml || (n.markhtml = t.markhtml),
                      (n.html = (t.html || [])[0] || n.html),
                      (n.baseUrlInClipboard = (t.html || [])[1] || ""),
                      (n.remap = (t.html || [])[2]),
                      (n.from = (t.html || [])[3]),
                      "Apple Notes" == n.from)
                    ) {
                      var i = $("<div>" + n.html + "</div>");
                      i.children("p").each(function () {
                        "17px" == this.style.fontSize &&
                        "B" == (this.children[0] || {}).tagName
                          ? ($(this)
                              .find("b")
                              .replaceWith(function () {
                                return this.innerHTML;
                              }),
                            $(this).replaceWith(
                              "<h1>" + this.innerHTML + "</h1>"
                            ))
                          : "14px" == this.style.fontSize &&
                            "B" == (this.children[0] || {}).tagName &&
                            ($(this)
                              .find("b")
                              .replaceWith(function () {
                                return this.innerHTML;
                              }),
                            $(this).replaceWith(
                              "<h2>" + this.innerHTML + "</h2>"
                            ));
                      }),
                        (n.html = i.html());
                    }
                    !n.markhtml &&
                      /^version:/i.exec((t.html || [])[0] || "") &&
                      ((n.html = n.html.replace(/^[^<]+/, "")),
                      (n.fromFirefox = !0)),
                      (n.text && (r || n.html)) || (n.text = t.text),
                      (n.files = t.files || []),
                      e(n);
                  });
                });
              if (File.isWin) {
                if (!n.html) {
                  var a = (
                    i.clipboard.readBuffer("FileNameW") || new Uint8Array()
                  ).toString("ucs2");
                  (a = a.replace(
                    new RegExp(String.fromCharCode(0), "g"),
                    ""
                  )) && (n.files = [a]);
                }
                return Promise.resolve(n);
              }
              return Promise.resolve(n);
            },
            readImage: function () {
              var e = File.editor.imgEdit;
              return new Promise((t, n) => {
                var a = e.getTargetImageStorageFolder();
                if (o)
                  o.callHandler(
                    "clipboard.readImage",
                    {
                      imageStorageFolder: a,
                      silent: a == e.getTargetImageStorageFolderFromSetting(),
                    },
                    t
                  );
                else if (window.reqnode) {
                  var s = i.clipboard.readImage();
                  s && !s.isEmpty()
                    ? ((a && "upload" != a) ||
                        (a = _options.userDataPath + "/typora-user-images"),
                      e.prepImageMove(a).then(
                        async function () {
                          var e = reqnode("path").join(
                            a,
                            "image-" + r.dateToNumberString(new Date()) + ".png"
                          );
                          reqnode("fs").writeFile(e, s.toPNG(), (n) => {
                            t(n ? null : [e]);
                          });
                        },
                        () => {}
                      ))
                    : t(null);
                } else t(null);
              });
            },
          },
          menu: {
            update: function (e, t) {
              if (e) {
                if (t && "string" == typeof e) {
                  var n = e;
                  (e = {})[n] = t;
                }
                File.isNode
                  ? a.send("menu.updateMenu", JSON.stringify(e))
                  : o && o.callHandler("menu.updateMenu", e);
              }
            },
          },
          zoom: {
            zoomIn: function () {
              window.reqnode
                ? (ClientCommand.execForAll(function () {
                    ClientCommand.zoomIn();
                  }),
                  ClientCommand.refreshViewMenu())
                : o && o.callHandler("window.zoomIn");
            },
            zoomOut: function () {
              window.reqnode
                ? (ClientCommand.execForAll(function () {
                    ClientCommand.zoomOut();
                  }),
                  ClientCommand.refreshViewMenu())
                : o && o.callHandler("window.zoomOut");
            },
            resetZoom: function () {
              window.reqnode
                ? (ClientCommand.execForAll(function () {
                    ClientCommand.resetZoom();
                  }),
                  ClientCommand.refreshViewMenu())
                : o && o.callHandler("window.resetZoom");
            },
            setZoom: function (e) {
              window.reqnode &&
                reqnode("electron").webFrame.setZoomFactor(e || 1);
            },
          },
          invoke: function (e, ...t) {
            return o
              ? new Promise((n, i) => {
                  o.callHandler(e, t[0], n);
                })
              : a
              ? "function" == typeof (t = t || [])[t.length - 1]
                ? a.invoke
                    .apply(null, [e].concat(t.slice(0, -1)))
                    .then(t[t.length - 1])
                : a.invoke.apply(null, [e].concat(t))
              : Promise.resolve();
          },
          sendIPC: function (e, t) {
            a && a.send(e, t);
          },
          putSetting: function (e, t) {
            o
              ? o.callHandler("setting.put", { key: e, value: t })
              : l.invoke("setting.put", e, t);
          },
          execForAll: function (e) {
            window.reqnode
              ? ClientCommand.execForAll(e)
              : o && o.callHandler("window.execForAll", e);
          },
          showInFinder: function (e) {
            e &&
              (File.isMac
                ? o.callHandler("path.showInFinder", e)
                : e && l.invoke("shell.showItemInFolder", e));
          },
          openFolder: function (e) {
            e &&
              (File.isMac
                ? o.callHandler("path.openFolderInFinder", e)
                : l.invoke("shell.openItem", e));
          },
          openFile: function (e) {
            e &&
              (File.isMac
                ? o.callHandler("path.openFile", e)
                : l.invoke("shell.openItem", e));
          },
          showInBrowser: function (e) {
            File.isMac
              ? o.callHandler("path.openURL", e)
              : e && l.invoke("shell.openExternal", e);
          },
          selectFile: function (e, t, n) {
            File.isNode
              ? l
                  .invoke("dialog.showOpenDialog", {
                    defaultPath: e || void 0,
                    filters: t,
                    properties: ["openFile", "dontAddToRecent"],
                  })
                  .then(({ filePaths: e }) => {
                    n((e || [null])[0] || null);
                  })
              : File.isMac &&
                o.callHandler(
                  "path.selectFolderOrFile",
                  {
                    dir: !1,
                    defaultPath: e,
                    filters: t ? t.map((e) => e.extensions) : null,
                  },
                  (e) => {
                    n(e);
                  }
                );
          },
          fsCaseInsensitive: function () {
            return (
              null === s &&
                (File.isNode &&
                  (s = File.isWin || reqnode("fs-plus").isCaseInsensitive),
                File.isMac && (s = !0)),
              s
            );
          },
        };
      (window.JSBridge = l),
        (t.JSBridge = l),
        window._options &&
          _options.zoomFactor &&
          1 != _options.zoomFactor &&
          l.zoom.setZoom(_options.zoomFactor);
    }),
    $__System.registerDynamic("12", ["13", "11"], !0, function (e, t, n) {
      this || self;
      var i = e("13"),
        r = i.Node,
        o = i.NodeMap,
        a = i.TYPE,
        s = e("11"),
        l = /\uE027/gi,
        c = ["-", "+", "*"];
      (r.UL_DEFAULT_START = c),
        (r.prototype.toMark = function () {
          var e = u.call(this);
          return e instanceof Array
            ? e.join(File.useCRLF ? "\r\n" : "\n").replace(l, "")
            : e;
        });
      var d = function (e, t) {
          return "right" == e
            ? "-".repeat(t - 1) + ":"
            : "center" == e
            ? ":" + "-".repeat(t - 2) + ":"
            : "left" == e
            ? ":" + "-".repeat(t - 1)
            : "-".repeat(t);
        },
        u = function () {
          var e,
            t,
            n,
            i = [];
          function o(e) {
            if (e.get("children").length) return g(e.get("children"));
            var t = e.get("text") ? e.get("text") : "";
            return (t = t
              .replace(/(\u200B*):(\u200B*)/g, ":")
              .replace(/\u200B\$/g, "$"));
          }
          function c(e, t) {
            b(e, t.get("ahead") || 0);
          }
          function v(e) {
            if (
              !e.get("after") &&
              !e.get("parent") &&
              e.get("type") == a.paragraph &&
              File &&
              File.editor
            ) {
              var t = File.editor.findElemById(e.cid);
              if (t && t.hasClass("unholdable") && !e.get("text").length)
                return !0;
            }
            return !1;
          }
          function y(e, t, n) {
            void 0 === n &&
              (n = t.get("after") ? (v(t.get("after")) ? 0 : 1) : 0),
              b(e, void 0 == t.get("tail") ? n : t.get("tail"));
          }
          function b(e, t) {
            for (var n = 0; n < t; n++) e.push("");
          }
          function w(e) {
            return (
              r.isType(e.get("parent"), a.list_item) &&
              !1 !== e.get("parent").get("tight")
            );
          }
          function x(e, t) {
            var n = -1,
              i = "",
              o = this.get("alignText");
            for (
              this.set("align", this.get("align") || []), Q = 0;
              Q < e.length;
              Q++
            )
              if (((ee = this.get("align")[Q]), o)) {
                var a = o[Q];
                if (a) (i += a), (n = Q);
                else if (n > -1) {
                  var s = o[n],
                    l = this.get("align")[n];
                  " " != s[0] ||
                    " " === s[s.length - 1] ||
                    (l && "center" != l) ||
                    ((o[n] = s + " "), (i += " ")),
                    (i += r.adjustAlignText(this, n, ee));
                } else
                  i +=
                    ((Y = t.getNthChild(Q)).get("marginLeft") || "") +
                    d(ee, 4) +
                    (Y.get("marginRight") || "");
                i += "|";
              } else i += " " + d(ee, e[Q]) + " |";
            return i;
          }
          try {
            switch (this.get("type")) {
              case a.meta_block:
                return (
                  i.push("---"),
                  (i = i.concat(
                    (this.get("text") || "")
                      .replace(/^---/gm, "​---")
                      .split(/\r*\n/)
                  )).push(this.get("patternEnd") || "---"),
                  y(i, this),
                  i
                );
              case a.heading:
                if ((c(i, this), (t = o(this)), this.get("pattern")))
                  (t = s.escapeStringReplace(t)),
                    (i = i.concat(
                      this.get("pattern").replace("{0}", t).split(/\r*\n/)
                    ));
                else if (
                  !r.isType(this.get("parent"), a.list_item) &&
                  (1 == File.option.headingStyle ||
                    3 == File.option.headingStyle) &&
                  this.get("depth") <= 2
                )
                  i.push(t),
                    3 == File.option.headingStyle
                      ? i.push(
                          (1 == this.get("depth") ? "=" : "-").repeat(
                            Math.max(1, s.wcswidth(this.get("text")))
                          )
                        )
                      : i.push(1 == this.get("depth") ? "===" : "---");
                else {
                  var C = "#".repeat(this.get("depth")) + " " + t;
                  2 == File.option.headingStyle &&
                    (C += " " + "#".repeat(this.get("depth"))),
                    i.push(C);
                }
                return y(i, this), i;
              case a.paragraph:
                return v(this)
                  ? i
                  : (c(i, this),
                    (t = o(this)
                      .split(/\r?\n/g)
                      .map(function (e) {
                        return e || "";
                      })),
                    (i = /^( {4}|\t)/.exec(t[0])
                      ? i.concat(
                          t.map(function (e) {
                            return e.replace(/^( {4}|\t)/, "​$1");
                          })
                        )
                      : i.concat(t)),
                    void 0 === (I = this.get("tail")) &&
                      this.get("after") &&
                      r.isType(this.get("parent"), a.list_item) &&
                      (I = w(this) ? 0 : void 0),
                    r.isType(this.get("after"), a.paragraph) &&
                      I < 1 &&
                      this.unset("tail"),
                    r.isType(this.get("after"), a.math_block) &&
                      !this.get("tail") &&
                      (I = 0),
                    void 0 === I ? y(i, this, I) : b(i, I),
                    i);
              case a.blockquote:
                return (
                  c(i, this),
                  (t = o(this)),
                  (M = m(this.get("userIndent"), t))
                    ? t.map(function (e, n) {
                        t[n] = (M[n] || "") + e;
                      })
                    : (this.unset("userIndent"),
                      (n = f(a.blockquote, 0, this, this.get("pattern"))),
                      t.map(function (e, i) {
                        t[i] = e ? n + e : n.replace(/\s+$/, "");
                      })),
                  y((i = i.concat(t)), this),
                  "" !== i.last() &&
                    r.isType(this.get("after"), a.blockquote) &&
                    i.push(""),
                  i
                );
              case a.list:
                c(i, this);
                var F = this.get("style"),
                  S = this.isLoose(),
                  k = this.get("children").length,
                  E = this;
                if (k)
                  for (
                    var T = this.getFirstChild(),
                      _ = Number.isNaN(Number.parseInt(this.get("start")))
                        ? 0
                        : Number.parseInt(this.get("start")) - 1,
                      A = 0;
                    T;

                  ) {
                    T.set("tight", !S),
                      (t = u.call(T)),
                      (e = this.get("pattern")),
                      S &&
                        e &&
                        T.get("markindent") &&
                        (e = p(F, e.trim(), T.get("markindent")));
                    var M,
                      L = Math.min(T.get("prespace") || 0, 3),
                      N =
                        (void 0 === this.get("isFixed") &&
                          File.option.olStyle) ||
                        this.get("isFixed"),
                      D = (n =
                        " ".repeat(L) +
                        f(F, (N ? 0 : A) + _, T, e, (k + "").length)).length,
                      B = F == r.ListType.ol ? (A + _ + "").length - 1 : 0,
                      R = (D = T.get("subindent")
                        ? Math.min(
                            n.replace(/\s+$/, "").length + 4,
                            T.get("subindent") + B
                          )
                        : E.get("subindent")
                        ? Math.min(
                            n.replace(/\s+$/, "").length + 4,
                            E.get("subindent") + B
                          )
                        : File.option.indentByTab
                        ? 0
                        : Math.max(D, File.option.indentSize))
                        ? " ".repeat(D)
                        : "\t";
                    if ((M = m(T.get("userIndent"), t, !0)))
                      T.get("style") == r.ListType.task &&
                        (M[0].trim().length &&
                          -1 == M[0].indexOf("[") &&
                          (M[0] = M[0] + "[ ] "),
                        T.get("checked")
                          ? (M[0] = M[0].replace("[ ]", "[x]"))
                          : (M[0] = M[0].replace(/\[x\]/i, "[ ]"))),
                        t.map(function (e, n) {
                          (t[n] = M[n] + e), i.push(t[n].replace(l, ""));
                        });
                    else {
                      T.unset("userIndent");
                      var P = n;
                      T.get("style") == r.ListType.task &&
                        (P = n + (T.get("checked") ? "[x] " : "[ ] ")),
                        t.map(function (e, n) {
                          (t[n] = (n ? (e ? R : "") : P) + t[n]),
                            i.push(t[n].replace(l, ""));
                        });
                    }
                    A++, (T = T.get("after"));
                  }
                return (
                  r.isType(this.get("after"), a.list) &&
                    (!this.get("tail") || this.get("tail")) < 1 &&
                    this.get("pattern") == this.get("after").get("pattern") &&
                    this.get("style") == this.get("after").get("style") &&
                    (this.unset("tail"), i.push(""), w(this) && i.push("")),
                  y(
                    i,
                    this,
                    w(this)
                      ? 0
                      : (function (e) {
                          var t = E.get("tail"),
                            n = E.get("after");
                          if (0 === t) {
                            if (r.isType(n, a.paragraph))
                              return void e.unset("tail");
                            if (
                              r.isType(n, a.fences) &&
                              /^\s+$/.exec(n.get("pattern") || "")
                            )
                              return void e.unset("tail");
                          }
                          return t;
                        })(this)
                  ),
                  i
                );
              case a.list_item:
                var I;
                for (
                  "string" == typeof (t = o(this)) && (t = [t]),
                    i = i.concat(t),
                    void 0 == (I = this.get("tail")) &&
                      !this.get("tight") &&
                      this.get("after") &&
                      (I = 1),
                    I > 0 && i.push("");
                  i.length > 2 && "" === i.last() && "" === i[i.length - 2];

                )
                  i.pop();
                return i;
              case a.fences:
                c(i, this);
                var O = this.getText();
                (t = O.split(/\r*\n/)),
                  !0 === this.get("empty") && (t = []),
                  this.get("lang")
                    ? (this.get("pattern") || "").trim()
                      ? (e = this.get("pattern"))
                      : (this.unset("pattern"),
                        (e = /^\s*```/gm.exec(this.get("text") || "")
                          ? "~~~{0}"
                          : "```{0}"))
                    : (e = this.get("pattern") || "```{0}");
                var $ = e.replace(/\s*\{0\}/, ""),
                  H = $.trim().length;
                this.get("pattern") && ($ = this.get("patternEnd") || $);
                var U,
                  j = 0,
                  q = e.match(/^\s+$/),
                  W = (e.match(/[`~]/) || [])[0];
                W && (U = new RegExp(`^(${W}{${H},})s*$`));
                for (A = 0; A < t.length; A++) {
                  if (U) {
                    var z = U.exec(t[A]);
                    z && z[1] && (j = Math.max(j + H, z[1].length + 1) - H);
                  }
                  (t[A] = (q ? e : "") + t[A]),
                    (t[A] = t[A] || ""),
                    this.get("userIndent") &&
                      (t[A] = this.get("userIndent") + t[A]);
                }
                return (
                  q ||
                    (j &&
                      ((e = W.repeat(j + H) + "{0}"), ($ = W.repeat(j + H))),
                    i.push(e.replace(/\{0\}/, this.get("lang") || ""))),
                  (i = i.concat(t)),
                  q || this.get("noCloseTag") || i.push($),
                  y(i, this),
                  i
                );
              case a.math_block:
                return (
                  c(i, this),
                  this.get("tagBefore")
                    ? i.push("$$ {" + this.get("tagBefore") + "}")
                    : i.push("$$"),
                  (i = i.concat(
                    this.get("text")
                      .replace(/(^\n)|(\n$)/g, "")
                      .split(/\r?\n/)
                      .map(function (e) {
                        return e || "";
                      })
                  )),
                  this.get("tagAfter")
                    ? i.push("$$ {" + this.get("tagAfter") + "}")
                    : i.push("$$"),
                  y(
                    i,
                    this,
                    r.isType(this.get("after"), a.paragraph) &&
                      r.isType(this.get("before"), a.paragraph)
                      ? 0
                      : void 0
                  ),
                  i
                );
              case a.hr:
                return (
                  c(i, this),
                  i.push(this.get("pattern") || "------"),
                  y(i, this),
                  i
                );
              case a.def_footnote:
                return (
                  c(i, this),
                  i.push(
                    "[^" +
                      this.get("ref") +
                      "]:" +
                      s.orDefault(this.get("pattern"), " ") +
                      o(this)
                  ),
                  y(
                    i,
                    this,
                    !this.get("after") ||
                      r.isType(this.get("after"), r.TYPE.def_footnote)
                      ? 0
                      : 1
                  ),
                  i
                );
              case a.def_link:
                c(i, this);
                var V,
                  J = this.safeGetStrAttr("title").length;
                if (this.get("pattern")) {
                  var K = this.get("pattern").split(";");
                  (V =
                    K[0] +
                    this.get("ref") +
                    K[1] +
                    this.safeGetStrAttr("href") +
                    K[2]),
                    J &&
                      (V +=
                        (K[3] || "\t") +
                        (K[4] || '"') +
                        this.get("title") +
                        (K[5] || '"'));
                } else
                  V =
                    "[" +
                    this.get("ref") +
                    "]: " +
                    this.safeGetStrAttr("href") +
                    (J ? '\t"' + this.get("title") + '"' : "");
                return (
                  i.push(V),
                  y(
                    i,
                    this,
                    !this.get("after") ||
                      r.isType(this.get("after"), r.TYPE.def_link)
                      ? 0
                      : 1
                  ),
                  i
                );
              case a.table:
                if ((c(i, this), this.get("userText")))
                  return (
                    y((i = i.concat(this.get("userText").clone())), this), i
                  );
                for (
                  var Y,
                    G,
                    Q,
                    X,
                    Z,
                    ee,
                    te,
                    ne = [],
                    ie = [],
                    re = 0,
                    oe = this.getFirstChild();
                  oe;

                ) {
                  for (G = oe.getFirstChild(), ie[re] = [], Q = 0; G; )
                    (ie[re][Q] = G.toMark().trim()),
                      (G = G.get("after")),
                      0 === re && (ne[Q] = 4),
                      (ne[Q] = Math.max(s.wcswidth(ie[re][Q]), ne[Q])),
                      (ne[Q] = Math.min(ne[Q], 60)),
                      isNaN(ne[Q]) && (ne[Q] = 0),
                      Q++;
                  (oe = oe.get("after")), re++;
                }
                var ae = "npTable" == this.get("style") && ne.length > 1;
                for (
                  this.set("align", this.get("align") || []),
                    oe = this.getFirstChild(),
                    re = 0;
                  re < ie.length;
                  re++
                ) {
                  for (
                    X = "|", Y = oe.getFirstChild(), Q = 0;
                    Q < ne.length &&
                    (void 0 !== Y.get("marginLeft")
                      ? ((X +=
                          Y.get("marginLeft") +
                          ie[re][Q] +
                          Y.get("marginRight")),
                        (X += "|"))
                      : ((X += " "),
                        (Z = Math.max(ne[Q] - s.wcswidth(ie[re][Q]), 0)),
                        (X +=
                          "right" == (ee = this.get("align")[Q])
                            ? " ".repeat(Z) + ie[re][Q]
                            : "center" == ee
                            ? " ".repeat((te = ~~(Z / 2))) +
                              ie[re][Q] +
                              " ".repeat(Z - te)
                            : ie[re][Q] + " ".repeat(Z)),
                        (X += " |")),
                    (Y = Y.get("after")));
                    Q++
                  );
                  ae
                    ? "|" == (X = X.replace(/(^\s*\|)|(\|\s*$)/g, "")).trim() &&
                      (X = "|" + X)
                    : (X = X.replace(/\s$/, "")),
                    i.push(X),
                    0 === re &&
                      ((X = "|" + x.call(this, ne, oe)),
                      ae
                        ? i.push(X.replace(/(^\s*\|)|(\|\s*$)/g, ""))
                        : i.push(X.replace(/\s$/, ""))),
                    (oe = oe.get("after"));
                }
                return y(i, this), i;
              case a.table_row:
                return console.sendError("cannot call toMark on table_row"), "";
              case a.table_cell:
                return h(o(this));
              case a.toc:
                return (
                  c(i, this),
                  i.push(this.get("pattern") || "[TOC]"),
                  ~(this.get("pattern") || "").indexOf("\n") &&
                  this.get("after")
                    ? y(i, this, 2)
                    : y(i, this),
                  i
                );
              case a.html_block:
                return (
                  c(i, this),
                  y(
                    (i = i.concat(
                      this.get("text")
                        .replace(/(^\n)|(\n$)/g, "")
                        .split(/\r?\n/)
                        .map(function (e) {
                          return e || "";
                        })
                    )),
                    this
                  ),
                  i
                );
              default:
                return o(this);
            }
          } catch (e) {
            return console.error(e.stack), i;
          }
        },
        h = function (e) {
          var t = "",
            n = "",
            i = [],
            r = 0,
            o = 0;
          return (
            (e = e.replace(/(^|[^\\])`[^`]*\|[^`]*`/g, function (e) {
              return i.push(e), [t, ++r - 1, n].join("");
            })),
            File.option.enableInlineMath &&
              (e = e.replace(/(^|[^\\])\$[^$]*\|[^$]*\$/g, function (e) {
                return i.push(e), [t, ++r - 1, n].join("");
              })),
            e
              .replace(/\|/g, "\\|")
              .replace(/\\\\\|/g, "\\|")
              .replace(/\uE07A[^\uE07B]+\uE07B/g, function () {
                return i[++o - 1];
              })
          );
        },
        p = function (e, t, n) {
          var i = File.option.prettyIndent;
          return (
            void 0 !== n
              ? (n -= 0)
              : (n = Math.max(File.option.indentSize - 0, 2)),
            e == a.blockquote
              ? ">" + " ".repeat(Math.min(n - 1, i ? 4 : 1))
              : e === r.ListType.ol
              ? "{0}." + " ".repeat(Math.min(n - 2, i ? 4 : 1) || 1)
              : e === r.ListType.ul
              ? (t || c[File.option.ulStyle]) +
                " ".repeat(Math.min(n - 1, i ? 4 : 1))
              : c[File.option.ulStyle] + " "
          );
        },
        f = function (e, t, n, i) {
          var o = File.option.indentSize;
          return (
            t++,
            (i = i || p(e)),
            (!$.isNumeric(o) || o < 2) && (o = 2),
            e == a.blockquote
              ? i
              : e === r.ListType.ol
              ? i.replace("{0}", t)
              : i
          );
        };
      (r.getIndentPrefix = f),
        (r.getDefaultPrefixPattern = p),
        (r.markFromArr = function (e) {
          var t = g(e);
          return t instanceof Array
            ? t.join(File.useCRLF ? "\r\n" : "\n").replace(l, "")
            : t;
        });
      var m = function (e, t, n) {
          var i = t.length;
          if (!e || !i) return null;
          if (1 == i) return 1 == e.length ? e : null;
          var r = null;
          if (e.length < i) {
            var o;
            if (!(o = e.last() || e[1] || "").length || o.trim().length)
              return null;
            r = e.concat(new Array(i - e.length).fill(o));
          } else r = e.length > i ? e.slice(0, i) : e;
          if (r && n && (o = r.last() || r[1] || "").length && !o.trim().length)
            return r.map((e, n) => (t[n].length ? e || o : e));
          return r;
        },
        g = function (e) {
          var t = [],
            n = "";
          function i(e) {
            var i = u.call(e);
            i instanceof Array ? (t = t.concat(i)) : (n += i);
          }
          if (e.length)
            if (e instanceof Array)
              e.map(function (e) {
                i(e);
              });
            else {
              var r = e.sortedFirst();
              do {
                i(r), (r = r.get("after"));
              } while (r);
            }
          return t.length ? t : n;
        };
      (o.prototype.toMark = function () {
        if (this.blocks.length > 0) {
          var e = this.blocks.sortedFirst();
          e = e.getFirstBrother();
          var t = [],
            n = "";
          do {
            var i = u.call(e);
            i instanceof Array ? (t = t.concat(i)) : (n += i),
              (e = e.get("after"));
          } while (e);
          return t.length
            ? t.join(File.useCRLF ? "\r\n" : "\n").replace(l, "")
            : n;
        }
        return "";
      }),
        (r.getIndentPrefix = f);
    }),
    $__System.registerDynamic(
      "14",
      ["13", "11", "15", "16", "17", "18", "19"],
      !0,
      function (e, t, n) {
        this || self;
        var i = e("13"),
          r = i.Node,
          o = (i.NodeMap, i.TYPE),
          a = (i.NodeCollectionUtils, e("11")),
          s = (e("15"), e("16"), e("17")),
          l = e("18"),
          c = e("19"),
          d = document.querySelector("#md-rawblock-tooltip-templ").innerHTML;
        r.prototype.toHTML = function (e, t, n) {
          var u;
          n = n || {};
          var h = ["h1", "h2", "h3", "h4", "h5", "h6"];
          function p(t) {
            var a,
              s = t.get("children");
            return void 0 !== e && null !== e
              ? e
              : s && s.length > 0
              ? i.NodeCollectionUtils.toHTML(s, n)
              : ((a = t.safeGetStrAttr("text")),
                r.isType(t, o.paragraph) &&
                  /^\u200b( {4}|\t)/g.exec(a) &&
                  ((a = a.replace(/^\u200b( {4}|\t)/g, "$1")),
                  t.set("text", a)),
                (t.cursorDiff = []),
                c.parseInline(
                  t.safeGetStrAttr("text"),
                  { attr: !r.isType(t, o.heading) },
                  t.cursorDiff
                ));
          }
          function f(e) {
            var n = (function (e) {
                try {
                  if (
                    r.isType(
                      e,
                      o.fences,
                      o.hr,
                      o.def_link,
                      o.def_footnote,
                      o.table,
                      o.math_block
                    )
                  )
                    return !1;
                  if (
                    r.isType(e, o.list_item) &&
                    e.get("style") == r.ListType.task
                  )
                    return !1;
                  if (e.canContainBlock() || e.isDeleted()) return;
                  return File.inBusyMode
                    ? 0 == e.get("children").length || void 0
                    : 0 == e.get("children").length ||
                        r.isType(e.get("parent"), o.list_item) ||
                        void 0;
                } catch (e) {}
              })(e),
              i = n
                ? " contenteditable='true' "
                : !1 === n
                ? " contenteditable='false' "
                : "",
              a = t ? "mdlike='" + t + "' " : " ",
              s =
                " cid = '" +
                e.id +
                "' mdtype = '" +
                e.get("type") +
                "' " +
                i +
                a;
            return (
              (e.get("text") || "").length > 1e4 &&
                (s += " spellcheck='false' "),
              s
            );
          }
          switch (
            (File.option.expandSimpleBlock &&
              r.isType(this, o.paragraph) &&
              (h.indexOf(t) > -1
                ? this.set("depth", h.indexOf(t) + 1)
                : this.unset("depth")),
            this.get("type"))
          ) {
            case o.meta_block:
              var m = this.get("text") || "";
              return (
                m.match(/^\n/g) && (m = m.replace(/^\n/g, "\n\n")),
                "<pre " +
                  f(this) +
                  " class='md-meta-block md-end-block' >" +
                  a.escape(m, !1, !0) +
                  "\n</pre>"
              );
            case o.paragraph:
              return (
                "<p " +
                f(this) +
                " class='md-end-block md-p'>" +
                p(this) +
                "</p>"
              );
            case o.raw_edit:
              return (
                "<p class='rawedit' contenteditable ='true' spellcheck='false' " +
                f(this) +
                ">" +
                this.safeGetStrAttr("text", !0) +
                "</p>"
              );
            case o.heading:
              return (
                "<h" +
                this.get("depth") +
                f(this) +
                "class='md-end-block md-heading' >" +
                p(this) +
                "</h" +
                this.get("depth") +
                ">"
              );
            case o.blockquote:
              return (
                "<blockquote " + f(this) + " >" + p(this) + "</blockquote>"
              );
            case o.list:
              var g = this.get("style"),
                v = ((
                  this.get("pattern") ||
                  r.UL_DEFAULT_START[File.option.ulStyle] ||
                  "-"
                ).match(/[*+-]/) || [])[0];
              if (((v = " data-mark='" + v + "' "), g == r.ListType.ol)) {
                var y =
                  "" === this.get("start") ? void 0 : this.get("start") - 0;
                return (
                  "<ol class='ol-list' " +
                  (y =
                    Number.isNaN(y) || 1 == y
                      ? ""
                      : "start='" + this.get("start") + "' ") +
                  f(this) +
                  " >" +
                  p(this) +
                  "</ol>"
                );
              }
              return (
                "<ul class='ul-list' " + f(this) + v + " >" + p(this) + "</ul>"
              );
            case o.list_item:
              return this.get("parent") && this.get("style") === r.ListType.task
                ? "<li class='md-list-item task-list-item  md-task-list-item task-list-" +
                    (this.get("checked") ? "done" : "not-done") +
                    " ' " +
                    f(this) +
                    "><input type='checkbox' " +
                    (this.get("checked") ? "checked" : "") +
                    "></input>" +
                    p(this) +
                    "</li>"
                : "<li class='md-list-item' " +
                    f(this) +
                    " >" +
                    p(this) +
                    "</li>";
            case o.fences:
              return l.renderFences(this);
            case o.hr:
              return (
                "<div tabindex='-1' contenteditable='false' " +
                f(this) +
                " class='md-hr md-end-block' ><hr /></div>"
              );
            case o.def_footnote:
              return (
                "<div class='footnotes md-def-footnote md-end-block' contenteditable='false'" +
                f(this) +
                "><span class='md-def-name' contenteditable='true'>" +
                a.escape(this.get("ref") ? this.get("ref") : "​") +
                "</span><span class='md-def-split md-def-f' contenteditable='false' >&nbsp;</span><span class='md-def-content' contenteditable='true'>" +
                p(this) +
                "</span></div>"
              );
            case o.def_link:
              return (
                "<div class='footnotes md-def-link md-end-block' contenteditable='false'" +
                f(this) +
                "><span class='md-def-name' contenteditable='true'>" +
                a.escape(this.get("ref") ? this.get("ref") : "​") +
                "</span><span class='md-def-split md-def-f' contenteditable='false' >&nbsp;</span><span class='md-def-content md-def-url md-auto-disp' href='#' contenteditable='true'>" +
                a.escape(this.get("href")) +
                "</span><span class='md-def-split md-auto-hide' contenteditable='false'>&nbsp;</span><span class='md-def-title md-auto-disp md-auto-hide' contenteditable='true'>" +
                a.escape(this.get("title")) +
                "</span></div>"
              );
            case o.table:
              for (
                var b =
                    "<figure class='md-table-fig' contenteditable='false' " +
                    f(this) +
                    "><table class='md-table'>",
                  w = this.getFirstChild();
                w;

              )
                w.get("before")
                  ? (b += w.toHTML())
                  : (b += "<thead>" + w.toHTML() + "</thead><tbody>"),
                  (w = w.get("after")) || (b += "</tbody>");
              return (b += "</table></figure>");
            case o.table_row:
              (b = "<tr class='md-end-block' " + f(this) + ">"),
                (w = this.getFirstChild());
              var x,
                C = this.get("parent").get("align") || [],
                F = 0,
                S = this.get("before") ? "td" : "th";
              for (
                this.get("parent").get("align") ||
                this.get("parent").set("align", []);
                w;

              )
                (b +=
                  "<" +
                  S +
                  (x = (x = C[F]) ? " style='text-align:" + x + ";' " : "") +
                  ">" +
                  w.toHTML() +
                  "</" +
                  S +
                  ">"),
                  (w = w.get("after")),
                  F++;
              return (b += "</tr>");
            case o.table_cell:
              return (
                "<span contenteditable='true' class='td-span' " +
                f(this) +
                ">" +
                p(this) +
                "</span>"
              );
            case o.math_block:
              var k,
                E = "";
              let e = File.editor && File.editor.mathBlock;
              if (e && e.cache[this.get("text")]) {
                let t = e.cache[this.get("text")];
                (e.cache[this.get("text")] = void 0),
                  (k = `<div class='md-rawblock-container md-math-container math-jax-postprocess' tabindex='-1'>${t.inner}</div>`),
                  (E = t.attr);
              } else if (
                n.mathCount < 8 &&
                e &&
                !File.option.autoNumberingForMath &&
                e.isMathJaxReady()
              ) {
                n.mathCount++;
                var T = e.renderTex(this.get("text"), {}, !0);
                (k = `<div class='md-rawblock-container md-math-container math-jax-postprocess' tabindex='-1'>${T.dom.outerHTML}</div>`),
                  (E = `data-math-tag-before="${
                    T.mathTagBefore
                  }" data-math-tag-after="${
                    T.mathTagAfter
                  }" data-math-labels="${a.escape(T.mathLabels)}"`);
              } else
                k =
                  "<div class='md-rawblock-container md-math-container math-jax-preprocess' tabindex='-1'>$$<br/>" +
                  a.escape(this.get("text")) +
                  "<br/>$$</div>";
              return (
                "<div contenteditable='false' spellcheck='false' class='mathjax-block md-end-block md-math-block md-rawblock' id='mathjax-" +
                this.cid +
                "' " +
                f(this) +
                ` ${E}>` +
                d.replace("{type}", $.localize.getString("Math", "Menu")) +
                k +
                "</div>"
              );
            case o.toc:
              return (
                (u = this.get("in")),
                "<div contenteditable='false' spellcheck='false' tabindex='-1' class='md-toc md-end-block' " +
                  f(this) +
                  "><div class='md-tooltip-hide md-toc-tooltip'><span>" +
                  $.localize.getString("Table of Contents") +
                  "</span> <button type='button' class='btn md-delete-toc'><span class='ty-icon ty-delete'></span></button></div><p class='md-toc-content' role='list'>" +
                  (u.toc ? u.toc.getTocInnerHTML() : "") +
                  "</p></div>"
              );
            case o.html_block:
              return s.HIDDEN_TYPE.indexOf(
                this.get("displayStyle") || this.get("style")
              ) > -1 && !s.checkIsWhiteList(this)
                ? "<div contenteditable='false' spellcheck='false' class='md-htmlblock md-rawblock md-end-block' " +
                    f(this) +
                    ">" +
                    d.replace("{type}", "HTML") +
                    "<div class='md-htmlblock-panel md-rawblock-control' style='display:none;' contenteditable='false'></div><div class='md-htmlblock-container md-rawblock-container md-raw-html-src' contenteditable='false'><div class='md-raw-html-src-content'>" +
                    a.escape(this.get("text")) +
                    "</div></div></div>"
                : "<div contenteditable='false' spellcheck='false' class='md-htmlblock md-rawblock md-end-block' " +
                    f(this) +
                    "><span style='position:absolute;'>​</span>" +
                    d.replace("{type}", "HTML") +
                    "<div class='md-htmlblock-panel md-rawblock-control' style='display:none;' contenteditable='false;'></div><div class='md-htmlblock-container md-rawblock-container' tabindex='-1' contenteditable='false'>" +
                    s.buildHTML(this) +
                    "</div><span style='position:absolute;'>​</span></div>";
            default:
              return (
                "<p " + f(this) + ">unknow type: " + this.get("type") + "</p>"
              );
          }
        };
      }
    ),
    $__System.registerDynamic(
      "1a",
      ["13", "11", "1b", "15", "1c", "1d", "1e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("13"),
          r = i.Node,
          o = i.TYPE,
          a = (i.NodeCollectionUtils, e("11")),
          s = e("1b"),
          l = e("15"),
          c = e("1c"),
          d = e("1d"),
          u = e("1e");
        r.normalizeNode = function (e) {
          0 == e.get("children").length &&
            (r.isType(e, o.blockquote) || r.isType(e, o.list_item)) &&
            e.appendChild(new r({ type: o.paragraph }));
        };
        (r.genNormalSplitExitFunc = function (e, t, n) {
          return function (e, i) {
            var a = { prev: e, next: i };
            return (
              e.get("type") == o.paragraph &&
                (!n && e.parseFrom({ skips: { enableStartMatch: !0 } }),
                r.isType(e, o.paragraph) || ((a.oldCid = e.cid), (a.prev = e))),
              i.get("type") == o.paragraph &&
                (!t &&
                  (function (e, t) {
                    try {
                      var n,
                        i,
                        a = !t.isDeleted() && t.get("parent");
                      if (
                        ((a = r.isType(a, o.list_item) && a.get("parent")),
                        !(n = r.isType(a, o.list) && a.get("style")))
                      )
                        return;
                      if ((i = e.get("text")).match(/^(\s{2, }|\t)/)) return;
                      n == r.ListType.ol
                        ? (i = i.replace(/^\s*\d+(\.|\))\s+/, ""))
                        : n == r.ListType.ul &&
                          (i = i.replace(/^\s*[+*-]\s+/, "")),
                        e.set("text", i);
                    } catch (e) {}
                  })(i, e),
                !n && i.parseFrom(),
                r.isType(i, o.paragraph) || (a.next = i)),
              a
            );
          };
        }),
          (r.prototype.breakOn = function (e, t, n) {
            var i, a;
            if (
              r.isType(
                this,
                o.table,
                o.table_row,
                o.table_cell,
                o.blockquote,
                o.list,
                o.list_item
              )
            )
              return null;
            var l,
              c = t.selection.buildUndo();
            if (r.isType(this, o.def_footnote)) {
              var d = t.getJQueryElem(window.getSelection().baseNode);
              i = d.closest(".md-def-name").length
                ? t.selection.getOffset(d.closest(".md-def-name"))
                : this.get("ref").length +
                  1 +
                  t.selection.getOffset(d.closest(".md-def-content"));
            } else {
              var u = t.findElemById(this.id);
              u.find(".md-emoji-control-ch, .md-ruby-container").remove(),
                u.find(".md-math-after-sym").text(""),
                (i = t.selection.getOffset(u));
            }
            if (
              !this.get("children").length &&
              ((a = this.getText(!1).length),
              r.isType(this, o.def_link, o.def_footnote) &&
                (a += this.get("ref").length + 1),
              !this.get("children").length)
            )
              return (l = (function (t) {
                if (
                  ((t = t.getClosetBlock()),
                  a <= 1 &&
                    r.isType(t, o.def_footnote, o.def_footnote) &&
                    !e &&
                    !n &&
                    r.isEmptyBlock(t, null, !0))
                )
                  return (
                    (d = s.makeEmptyCommand(c)).undo.push(
                      s.buildReplaceUndo(t)
                    ),
                    t.unset("ahead"),
                    t.unset("tail"),
                    t.set("type", o.paragraph),
                    d.redo.push(s.buildReplaceUndo(t)),
                    d.redo.push({
                      type: "cursor",
                      id: t.getLastChild().cid,
                      start: 0,
                    }),
                    {
                      command: d,
                      nextFocus: t.getLastChild().cid,
                      oldCid: t.cid,
                      newHtml: t.toHTML(),
                    }
                  );
                var l = a;
                if (
                  (a && (l = t.getText(!1).trim().length),
                  0 == i &&
                    0 == l &&
                    !e &&
                    !n &&
                    t.closest(o.blockquote, o.list) &&
                    t.get("parent") &&
                    t.get("parent").canContainBlock(!0) &&
                    (t.get("parent").get("type") != o.list_item ||
                      !t.get("after")) &&
                    !(function (e) {
                      var t = e.get("parent");
                      return (
                        r.isType(t, o.list_item) &&
                        !e.get("before") &&
                        !e.get("after") &&
                        !t.get("before") &&
                        !t.get("after") &&
                        t.get("parent").get("attachTo")
                      );
                    })(t))
                ) {
                  var d;
                  (d = s.makeEmptyCommand()).undo.push(c);
                  var u = {};
                  if (!(u = r.upStream(t))) return;
                  return (
                    (d.undo = d.undo.concat(u.command.undo)),
                    (d.redo = d.redo.concat(u.command.redo)),
                    (u.nextFocus = u.nextFocus || t.id),
                    d.redo.push({ type: "cursor", id: u.nextFocus, start: 0 }),
                    (u.command = d),
                    u
                  );
                }
              })(this.getClosetBlock()))
                ? l
                : (l = (function (e) {
                    if (
                      i == a &&
                      e == t.nodeMap.getFirst() &&
                      r.isType(e, o.paragraph) &&
                      ((l = e.get("text")),
                      File.shouldRemapPunctuation()
                        ? "---" ==
                          (l || "")
                            .replace(/\u2013/g, "--")
                            .replace(/\u2014/g, "---")
                        : "---" == l)
                    ) {
                      var n = t.stylize.insertMetaBlock(!0);
                      return (
                        n.command.undo.push(s.buildReplaceUndo(e)),
                        e.set("text", ""),
                        n.command.redo.push(s.buildReplaceUndo(e)),
                        (n.newHtml = n.node.toHTML() + e.toHTML()),
                        (n.nextFocus = n.node.id),
                        (n.oldCid = e.id),
                        n
                      );
                    }
                    var l;
                  })(this))
                ? l
                : (function (i, l, d) {
                    d = d || s.makeEmptyCommand();
                    var u = {},
                      f = l == a && l > 0,
                      m = i.getClosetBlock();
                    return (
                      d.undo.push(c),
                      r.isType(m.get("parent"), o.list_item) && !e
                        ? d.undo.push(s.buildReplaceUndo(m.get("parent")))
                        : d.undo.push(s.buildReplaceUndo(m)),
                      m.unset("ahead"),
                      m.unset("tail"),
                      n && r.isType(i, o.paragraph)
                        ? h(i, l, d, f)
                        : (u = r.splitAt(i, l, t, e))
                        ? (u.undo && (d.undo.push(u.undo), d.redo.push(u.redo)),
                          d.redo.push(t.undo.buildReplaceUndo(u.prev)),
                          (u.prev && u.prev.contains(i)) ||
                            d.redo.push(t.undo.buildReplaceUndo(i)),
                          (i = u.insertArray[0]
                            ? u.insertArray[0].get("before")
                            : i),
                          (u.oldCid = i.cid),
                          s.addUndoForInsertArray(d, u.insertArray),
                          (u.newHtml =
                            i.toHTML() +
                            u.insertArray
                              .map(function (e) {
                                return e.toHTML();
                              })
                              .join("")),
                          p(u, f),
                          d.redo.push({
                            type: "cursor",
                            id: u.nextFocus,
                            start: 0,
                          }),
                          (u.command = d),
                          u)
                        : void 0
                    );
                  })(this, (i = Math.min(a, i)));
            function h(e, i, a, l) {
              if (n && r.isType(e, o.paragraph)) {
                var c = e.get("text") || "";
                if (
                  ("\n" == c[i]
                    ? (n = !1)
                    : "\n" == c[i - 1] && ((n = !1), i--),
                  a.undo.push(s.buildReplaceUndo(e)),
                  e.set("text", c.substring(0, i)),
                  !n)
                )
                  return (
                    a.redo.push(s.buildReplaceUndo(e)),
                    (function (e, t, n) {
                      var i = new r({
                        type: o.paragraph,
                        text: n,
                        in: e.get("in"),
                      });
                      return (
                        e.addAfter(i),
                        s.addUndoForInsert(t, i),
                        {
                          oldCid: e.cid,
                          prev: e,
                          next: i,
                          command: t,
                          nextFocus: i.cid,
                          newHtml: e.toHTML() + i.toHTML(),
                        }
                      );
                    })(e, a, c.substring(i + 1))
                  );
                var d = r.smartSplit(t.findElemById(e.id), i);
                e.set("text", d[0]);
                var u,
                  h = e.parseFrom(
                    { skips: { enableStartMatch: !0 } },
                    void 0,
                    !0
                  );
                if (1 == h[1].length && r.isType(h[1][0], o.paragraph))
                  return (
                    e.set("text", d[0] + "\n" + d[1]),
                    a.redo.push(s.buildReplaceUndo(e)),
                    (u = { type: "cursor", id: e.id, start: d[0].length + 1 }),
                    a.redo.push(u),
                    {
                      oldCid: e.cid,
                      nextFocus: e.cid,
                      prev: e,
                      newHtml: e.toHTML(),
                      command: a,
                      cursor: u,
                    }
                  );
                a.redo.push(s.buildReplaceUndo(e));
                var f = h[1],
                  m = f.last(),
                  g = m.getVeryFirst(!0).getClosetBlock();
                r.isType(g, o.paragraph)
                  ? ((u = {
                      type: "cursor",
                      id: g.id,
                      start: g.get("text").length + 1,
                    }),
                    g.set("text", g.get("text") + "\n" + d[1]))
                  : ((u = {
                      type: "cursor",
                      id: (g = new r({ type: o.paragraph, text: d[1] })).id,
                      start: 0,
                    }),
                    f.last().addAfter(g),
                    f.push(g)),
                  s.addUndoForInsertArray(a, f.subarray(1));
                var v = {
                  oldCid: e.cid,
                  nextFocus: g.cid,
                  prev: m,
                  next: m.get("after"),
                  newHtml: f
                    .map(function (e) {
                      return e.toHTML();
                    })
                    .join(""),
                  command: a,
                  cursor: u,
                };
                return (
                  0 == u.start
                    ? ((v.cursor = void 0),
                      p(v, l),
                      a.redo.push({
                        type: "cursor",
                        id: v.nextFocus,
                        start: 0,
                      }))
                    : a.redo.push(u),
                  v
                );
              }
            }
            function p(e, t) {
              var n =
                t ||
                (r.isType(e.next, o.paragraph) &&
                  !(e.next.get("text") || "").trim().length);
              if (
                r.isType(e.prev, o.meta_block) &&
                n &&
                e.prev.get("text").match(/\n$/)
              )
                e.nextFocus = e.next.getVeryFirst().id;
              else if (
                n &&
                r.isType(
                  (e.prev && e.prev.getLastChild()) || e.prev,
                  o.math_block,
                  o.fences,
                  o.meta_block,
                  o.html_block
                )
              ) {
                var i = e.prev.getVeryFirst(!0);
                !r.isType(i, o.html_block) ||
                /\n/.exec(i.get("text")) ||
                i.get("depth")
                  ? (e.nextFocus = i.id)
                  : (e.nextFocus = e.next.getVeryFirst().cid);
              } else
                t && r.isType(e.prev, o.table)
                  ? (e.nextFocus = e.prev.getLastChild().getVeryFirst().cid)
                  : (e.nextFocus = e.next.getVeryFirst().cid);
            }
          }),
          (r.isEmptyBlock = function (e, t, n) {
            var i = n ? a.isNullOrBlank : a.isNullOrEmpty;
            if (r.isType(e, t || [])) return !1;
            if (e.get("children").length) {
              if (r.isType(e, o.paragraph)) return i(e.get("text"));
            } else {
              if (r.isType(e, o.def_link))
                return i(e.get("ref")) && i(e.get("href")) && i(e.get("title"));
              if (r.isType(e, o.def_footnote))
                return i(e.get("ref")) && i(e.get("text"));
              if (!r.isType(e, o.table_cell, o.table_row, o.hr, o.toc))
                return i(e.get("text"));
            }
            return !1;
          });
        var h = { link: "[", footnote: "[^", reflink: "[" },
          p = { footnote: "]" };
        r.smartSplit = function (e, t, n) {
          var i,
            r,
            o,
            a = d.createRange(),
            s = 0;
          if (0 == t) return ["", e.rawText(), s];
          if (t == (e[0].textContent || e[0].innerText).length) {
            var l = e.rawText();
            return (
              File.isMac &&
                File.option.smartQuote &&
                !File.option.convertSmartOnRender &&
                /["']$/.exec(l) &&
                l.length > 1 &&
                (l = l.replace(/["']$/, function (e) {
                  return u.userQuote("'" == e ? 3 : 1, !1, !0);
                })),
              [l, ""]
            );
          }
          n
            ? ((o = $.parseHTML("<span />")[0]),
              e[0].appendChild(o),
              e.prepend("<span />"),
              a.moveToBookmark({ containerNode: e[0], start: t, end: t }),
              a.setEndAfter(o),
              (r = (o = a.extractContents()).querySelectorAll(
                ".md-pair-s, .md-meta-i-c"
              )),
              (i = e[0].querySelectorAll(".md-pair-s, .md-meta-i-c")))
            : (e[0].childElementCount < 3 &&
                ((o = $.parseHTML("<span />")[0]),
                e[0].insertBefore(o, e[0].firstChild),
                e.append("<span />")),
              a.moveToBookmark({ containerNode: e[0], start: 0, end: t }),
              o && a.setStart(o, 0),
              (i = (o = a.extractContents()).querySelectorAll(
                ".md-pair-s, .md-meta-i-c"
              )),
              (r = e[0].querySelectorAll(".md-pair-s, .md-meta-i-c")));
          for (
            var c = (e, t) => {
                var n = document.createElement("SPAN"),
                  i = e.children(t ? ".md-after" : ".md-before").rawText();
                return (
                  t
                    ? n.classList.add("md-before")
                    : n.classList.add("md-after"),
                  "<u>" == i
                    ? (i = "</u>")
                    : "</u>" == i
                    ? (i = "<u>")
                    : "<" == i
                    ? (i = ">")
                    : ">" == i && (i = "<"),
                  (n.textContent = i),
                  t && (s += i.length),
                  n
                );
              },
              f = [],
              m = 0;
            m < i.length;
            m++
          ) {
            (g = $(i[m])).hasClass("md-meta-i-c")
              ? g.find(":not(.md-meta-i)").text().length
                ? g.children(".md-after.md-meta-i").text().length ||
                  g.append(p[g.attr("md-inline")] || "")
                : f.push(i[m])
              : g.find(":not(.md-meta)").text().length
              ? g.children(".md-after").text().length || g.append(c(g, !1))
              : f.push(i[m]);
          }
          for (m = 0; m < r.length; m++) {
            var g;
            if ((g = $(r[m])).hasClass("md-meta-i-c"))
              if (g.find(":not(.md-meta-i)").text().length) {
                if (!g.children(".md-before.md-meta-i").text().length) {
                  var v = h[g.attr("md-inline")] || "";
                  g.prepend(v), (s += v.length);
                }
              } else f.push(r[m]);
            else
              g.find(":not(.md-meta)").text().length
                ? g.children(".md-before").text().length || g.prepend(c(g, !0))
                : f.push(r[m]);
          }
          f.forEach((e) => {
            e && (e.textContent = "");
          });
          var y = o.querySelectorAll("svg");
          for (m = 0; m < y.length; m++)
            y[m].parentElement && y[m].parentElement.removeChild(y[m]);
          return [$(o).rawText(), e.rawText(), s];
        };
        (r.splitAt = function (e, t, n, i, a, l) {
          var c;
          if (((l = l || !a), r.isType(e, o.def_link, o.def_footnote)))
            return (function (e, t, n) {
              var i,
                a,
                s = e.clone(),
                l = e.get("ref");
              if (t <= l.length)
                e.set("ref", l.substring(0, t)),
                  s.set("ref", l.substring(t)),
                  s.set("href", e.get("href")),
                  s.set("title", e.get("title")),
                  e.set("href", ""),
                  e.set("title", ""),
                  (i = ""),
                  (a = e.get("text"));
              else if (r.isType(e, o.def_link)) {
                var c = e.get("href") || "",
                  d = e.get("title") || "";
                t <= l.length + c.length
                  ? (e.set("title", ""),
                    s.set("ref", ""),
                    e.set("href", c.substring(0, t - l.length - 1)),
                    s.set("href", c.substring(t - l.length - 1)))
                  : (s.set("ref", ""),
                    s.set("href", ""),
                    e.set("title", d.substring(0, t - l.length - c.length - 1)),
                    s.set("title", d.substring(t - l.length - c.length - 1)));
              } else {
                var u = e.get("text") || "";
                s.set("ref", ""),
                  (i = u.substring(0, t - l.length - 1)),
                  (a = u.substring(t - l.length - 1));
              }
              return (
                e.set("text", i),
                r.isType(s, o.def_link) || s.set("text", a || ""),
                r.isEmptyBlock(s) &&
                  !r.isType(s, o.paragraph) &&
                  (s.set("type", o.paragraph), s.set("text", "")),
                e.addAfter(s),
                { oldCid: e.cid, prev: e, next: s, insertArray: [s] }
              );
            })(e, t);
          var d,
            u,
            h,
            p,
            f,
            m = e.clone();
          if (e.get("children").length)
            return console.error("cannot do Node.split at this ndoe"), null;
          r.isType(e, o.paragraph, o.heading)
            ? ((d = (h = r.smartSplit(n.findElemById(e.id), t))[0].replace(
                /\n$/,
                ""
              )),
              (f = !(u = h[1].replace(/^\n/, ""))),
              (p = h[2]),
              r.isType(e.get("parent"), o.list_item) &&
                (l ||
                  ((c = s.buildReplaceUndo(e.get("parent").get("parent"))),
                  e
                    .get("parent")
                    .get("parent")
                    .get("children")
                    .toArray()
                    .forEach(function (e) {
                      void 0 == e.get("tail") ? (c = null) : e.unset("tail");
                    }))))
            : ((d = e.getText().substring(0, t)),
              (u = e.getText().substring(t))),
            e.set("text", d),
            m.set("text", u);
          var g,
            v = e,
            y = [v],
            b = [];
          a ||
            (r.isType(e, o.paragraph) &&
              !a &&
              ((b = (y = (g = e.parseFrom(
                { skips: { enableStartMatch: !0 } },
                void 0,
                !0
              ))[1]).subarray(1)),
              (v = y.last().getVeryFirst().getClosetBlock()))),
            v.addAfter(m),
            y.last() == v && b.push(m),
            r.isEmptyBlock(m)
              ? m.set("type", o.paragraph)
              : r.isEmptyBlock(v) &&
                ((r.isType(v, o.math_block, o.fences) && g) ||
                  v.set("type", o.paragraph));
          var w = { prev: v, next: m, insertArray: b, cursorDiff: p };
          if (i) return w;
          if (l && r.isType(v.get("parent"), o.list_item) && !v.get("before")) {
            var x = v.get("parent"),
              C = x.get("parent"),
              F = !1;
            C.get("style") == r.ListType.ol &&
              (F =
                C.getFirstChild().get("userIndent") !=
                C.getLastChild().get("userIndent")),
              F && !c && (c = s.buildReplaceUndo(C));
            var S = x.clone();
            if (
              (!x.get("after") &&
                x.get("before") &&
                x.set("tail", x.get("before").get("tail")),
              x.get("style") == r.ListType.task &&
                (0 == t ? x.set("checked", !1) : f && S.set("checked", !1)),
              x.addAfter(S),
              S.appendChildrenTillEnd(m),
              F)
            ) {
              let e = C.getFirstChild();
              for (; e; ) e.unset("userIndent"), (e = e.get("after"));
            }
            (b = y.subarray(1)),
              y.last() == v && (y = [x]),
              y.last() == x && b.push(S),
              (w = { prev: x, next: S, insertArray: b, cursorDiff: p });
          }
          if (c && w.prev) {
            w.undo = c;
            let e = w.prev.get("in").allNodes.get(c.id);
            e && (w.redo = s.buildReplaceUndo(e));
          }
          return w;
        }),
          (r.genArrFrom = function (e, t) {
            for (var n = [], i = e; i != t; ) n.push(i), (i = i.get("after"));
            return t && n.push(t), n;
          }),
          (r.getTreePosition = function (e, t) {
            function n(e) {
              return e.get("parent") ? 1 + n(e.get("parent")) : 0;
            }
            if (e == t) return [e, e, t];
            var i = n(e) - n(t);
            if (i > 0) for (; i > 0; ) (e = e.get("parent")), i--;
            else if (i < 0) for (; i < 0; ) (t = t.get("parent")), i++;
            return (function e(t, n) {
              return t == n
                ? [t, t, n]
                : t.get("parent") == n.get("parent") ||
                  (!t.get("parent") && !t.get("parent"))
                ? [t.get("parent"), t, n]
                : e(t.get("parent"), n.get("parent"));
            })(e, t);
          }),
          (r.prototype.copyContentFrom = function (e, t) {
            var n = this;
            (t || r.property).map(function (t) {
              n.set(t, e.get(t));
            }),
              this.get("after") && this.set("noCloseTag", void 0);
          }),
          (r.prototype.clone = function () {
            var e = new r();
            return e.copyContentFrom(this), e.set("in", this.get("in")), e;
          }),
          (r.reverseAttrFromElem = function (e, t, n, i) {
            var s,
              l = t.attr("mdtype");
            switch (
              (e.set("type", l),
              t.find("mjx-container").remove(),
              n &&
                (t.find("[data-emoji]").text(function () {
                  return this.getAttribute("data-emoji");
                }),
                t.find(".md-meta, .md-content").remove(),
                t.find("sup, sub").text(function () {
                  return " (" + this.textContent + ")";
                })),
              File.option.convertSmartOnRender &&
                !document.body.contains(t[0]) &&
                t.find("[md-inline='pants']").text(function () {
                  return this.getAttribute("data-text") || this.textContent;
                }),
              e.set(
                "text",
                !i && r.isType(l, o.paragraph, o.def_footnote, o.heading)
                  ? (function (e) {
                      var t = File.editor.imgEdit.getLocalRootUrlForInsert();
                      return (
                        e.find("mjx-container").remove(),
                        e
                          .find("[md-inline='image'], [md-inline='imgtag']")
                          .each(function () {
                            var e = $(this),
                              n = e.attr("data-src");
                            if (
                              (t || File.bundle.filePath || "") !=
                                (e.attr("data-root") || "") &&
                              !/^[a-z0-9\-]+:/i.exec(n)
                            ) {
                              var i = e.find("img").attr("src") || n || "",
                                r = e.text();
                              e.find("img").length &&
                                (i = File.editor.imgEdit.resolveImagePath(
                                  i
                                    .replace(/^file:\/\//, "")
                                    .replace(/[#?]([^.]*)$/, "")
                                )),
                                File.option.autoEscapeImageURL ||
                                  (i = a.decodeFromEscapedPath(i)),
                                (r =
                                  "image" == this.getAttribute("md-inline")
                                    ? r.replace(
                                        /(\(<?)((?:\([^)]*\)|[^()])*?)(>?[ \t]*((['"])(.*?)\5[ \t]*)?\))/,
                                        "$1" + i + "$3"
                                      )
                                    : r.replace(
                                        /(^<img(\s+.+)*?\s+src\s*=\s*)("([^"]+)"|'([^']+)')(.*?(\/?\s*>.*?(<\/img>)?))/,
                                        '$1"' + i + '"$6'
                                      )),
                                e.text(r);
                            }
                          }),
                        e
                      );
                    })(t).text()
                  : t.text()
              ),
              ["ahead", "tail", "prespace", "markindent"].forEach(function (n) {
                if (t[0].hasAttribute(n)) {
                  var i = t.attr(n) - 0;
                  isNaN(i) || e.set(n, i);
                }
              }),
              ["pattern", "patternEnd"].forEach(function (n) {
                t[0].hasAttribute(n) && e.set(n, t.attr(n));
              }),
              ["isFixed"].forEach(function (n) {
                t[0].hasAttribute(n) && e.set(n, "true" == t.attr(n));
              }),
              l)
            ) {
              case o.heading:
                e.set("depth", t[0].tagName.replace(/H/gi, ""));
                break;
              case o.list:
                e.set("style", t[0].tagName.toLowerCase()),
                  e.set("start", (t[0].getAttribute("start") || 1) - 0);
                break;
              case o.math_block:
                i && (e.refcid = t.attr("cid"));
                break;
              case o.fences:
                e.set(
                  "lang",
                  a.unescape(t.attr("lang")) || t.find(".ty-input").text()
                ),
                  e.set("text", t.find("textarea[id]").val() || t.text());
                break;
              case o.list_item:
                t.hasClass("md-task-list-item") &&
                  e.set("style", r.ListType.task),
                  e.set(
                    "checked",
                    t.hasClass("task-list-done") ||
                      "checked" == t.children("input").attr("checked")
                  );
                break;
              case o.def_link:
                e.set("ref", t.find(".md-def-name").text()),
                  e.set("title", t.find(".md-def-title").text()),
                  e.set("href", t.find(".md-def-content").text());
                break;
              case o.def_footnote:
                e.set("text", t.find(".md-def-content").rawText()),
                  e.set("ref", t.find(".md-def-name").text());
                break;
              case o.table:
                (s = []),
                  t
                    .find("tbody>tr:first")
                    .children()
                    .toArray()
                    .map(function (e) {
                      (s[e.cellIndex] = e.style.textAlign),
                        "" == e.style.textAlign && (s[e.cellIndex] = null);
                    }),
                  s.length ||
                    t
                      .find("thead>tr:first")
                      .children()
                      .toArray()
                      .map(function (e) {
                        (s[e.cellIndex] = e.style.textAlign),
                          "" == e.style.textAlign && (s[e.cellIndex] = null);
                      }),
                  e.set("align", s);
                break;
              case o.table_row:
                e.set("header", t.closest("thead").length > 0);
                break;
              case o.html_block:
                e.set("text", t.text()), e.set("style", t.attr("data-tag"));
            }
          }),
          (r.reverse = function (e, t, n, i) {
            if (e.length && e[0].hasAttribute("mdtype")) {
              var a,
                s = new r({ in: t });
              return (
                r.reverseAttrFromElem(s, e, n, i),
                s.get("type") == o.table
                  ? (e.find("tr[mdtype]").each(l), r.TableEdit.verify(s))
                  : s.get("type") == o.table_row
                  ? e.children().children("span[mdtype]").each(l)
                  : e.children("[mdtype]").each(l),
                a && a.unset("tail"),
                s
              );
            }
            function l() {
              (a = r.reverse($(this), t, n, i)),
                s.appendChild(a),
                a.get("before") || a.unset("ahead");
            }
          }),
          (r.prototype.attr = function (e, t, n, i) {
            function a(i, r) {
              var o = n.undo.UndoManager.makeEmptyCommand();
              return (
                o.undo.push({
                  type: "attr",
                  id: i.id,
                  key: e,
                  value: r || i.safeGetStrAttr(e),
                }),
                o.redo.push({ type: "attr", key: e, id: i.id, value: t }),
                o
              );
            }
            if ((n.undo.endSnap(!0), this.get(e) != t)) {
              i || n.store();
              var d = a(this);
              switch ((i || "align_idx" == e || n.undo.register(d), e)) {
                case "tagBefore":
                case "tagAfter":
                  ((h = n.mathBlock.currentCm) && h.cid == this.cid) ||
                    n.mathBlock.startEditing(this.cid),
                    this.set(e, t);
                  var u = $(
                    "[cid='" +
                      this.id +
                      "'] .md-rawblock-" +
                      ("tagBefore" == e ? "before" : "after") +
                      " .ty-input"
                  )
                    .text(t || "")
                    .focus();
                  n.selection.selectAllElem(u);
                  break;
                case "lang":
                  var h;
                  if (!(h = n.fences.getCm(this.id))) {
                    console.sendError("Failed to get CodeMirror", "error", t);
                    break;
                  }
                  var p = $("[cid='" + this.id + "']");
                  if (this.get("lang") == t) break;
                  l.isDiagramType(this.get("lang")) &&
                    n.diagrams.cancelDiagram(this.id),
                    c.isMathType(this.get("lang")) &&
                      n.mathBlock.beforeDeleteFences(this.id),
                    h.setOption("mode", getCodeMirrorMode(t));
                  var f = n.fences.getOptionsFromFencesAttr(t);
                  if (
                    (File.option.showLineNumbersForFence ||
                      (f.lineNumbers
                        ? (h.setOption("lineNumbers", !0),
                          p.addClass("md-fences-with-lineno"))
                        : p.removeClass("md-fences-with-lineno")),
                    f.firstLineNumber &&
                      h.setOption("firstLineNumber", f.firstLineNumber),
                    h.refresh(),
                    this.set("lang", t),
                    p
                      .attr("lang", t)
                      .find(".CodeMirror")
                      .attr("lang", (t || "").toLowerCase()),
                    i)
                  ) {
                    var m = $("[cid='" + this.id + "'] .code-tooltip")
                      .show()
                      .find(".ty-input")
                      .text(t || "")
                      .focus();
                    n.selection.selectAllElem(m);
                  }
                  Fences.renderFencesByUpdate(this, p[0], t),
                    l.isDiagramType(t) && n.diagrams.updateDiagram(this.id),
                    c.isMathType(t) && n.mathBlock.renderUnder(p[0], !0);
                  break;
                case "checked":
                  var g = document.querySelector(
                    "[cid='" + this.id + "']>input"
                  );
                  t
                    ? (g.setAttribute("checked", "checked"),
                      g.parentElement.classList.remove("task-list-not-done"),
                      g.parentElement.classList.add("task-list-done"))
                    : (g.removeAttribute("checked"),
                      g.parentElement.classList.remove("task-list-done"),
                      g.parentElement.classList.add("task-list-not-done")),
                    (g.checked = t || !1),
                    this.set("checked", t || !1);
                  break;
                case "href-title":
                  if (this.get("type") == o.image) {
                    var v = t.split(/\s/);
                    if (
                      (n.findElemById(this.id).find("img").attr("src", v[0]),
                      this.set("href", v[0]),
                      this.set("title", v[1]),
                      i)
                    )
                      (u = $("[cid='" + this.id + "']")).hasClass("onfocus") ||
                        (u.addClass("onfocus").focus(),
                        n.EditHelper.showTooltipForImage(n, u),
                        $("[cid='" + this.id + "'] input.t-bracket-input")
                          .val(t || "")
                          .focus());
                  }
                  break;
                case "alt":
                  if (this.get("type") == o.image)
                    if (
                      (n.findElemById(this.id).find("img").attr("alt", t),
                      this.set("alt", t),
                      i)
                    )
                      (u = $("[cid='" + this.id + "']")).hasClass("onfocus") ||
                        (u.addClass("onfocus").focus(),
                        n.EditHelper.showTooltipForImage(n, u),
                        $("[cid='" + this.id + "'] input.t-alt-input")
                          .val(t || "")
                          .focus());
                  break;
                case "align_idx":
                  if (this.get("type") == o.table) {
                    var y = t[0],
                      b = t[1],
                      w = t[2];
                    u = n.findElemById(this.id);
                    this.set("align", this.get("align") || []);
                    d = a(this, [y, this.get("align")[y]]);
                    var x = this.get("userText");
                    if (
                      (x && (d.undo = [s.buildReplaceUndo(this)]),
                      i || (w = r.adjustAlignText(this, y, b)),
                      this.get("alignText") && (this.get("alignText")[y] = w),
                      (this.get("align")[y] = b),
                      x
                        ? (r.tryResetTable(this),
                          (d.redo = [s.buildReplaceUndo(this)]))
                        : w &&
                          (d.undo.last().value.push(this.get("alignText")[y]),
                          d.redo.last().value.push(w)),
                      !i)
                    ) {
                      var C = n.selection.buildUndo();
                      C && (d.undo.unshift(C), d.redo.push(C)),
                        n.undo.register(d);
                    }
                    if (
                      ((b = b || ""),
                      u
                        .find("tbody>tr>td:nth-child(" + (y + 1) + ")")
                        .css("text-align", b),
                      u
                        .find("thead>tr>th:nth-child(" + (y + 1) + ")")
                        .css("text-align", b),
                      i)
                    )
                      n.tableEdit.showTableEdit(u);
                    else {
                      var F = u.find(".md-align-gp[data-col='" + y + "']");
                      F.find("button").removeClass("active").blur(),
                        F.find(".md-align-" + b)
                          .addClass("active")
                          .focus();
                    }
                  }
                  break;
                default:
                  this.set(e, t);
              }
              return d;
            }
          }),
          (r.adjustAlignText = function (e, t, n) {
            if (e.get("alignText")) {
              var i = e.get("alignText")[t];
              if (i)
                return (
                  (i =
                    "left" == n || "center" == n
                      ? (i = i.replace(/(^\s*)-/, "$1:")).replace(
                          /(^\s*):(\s*$)/,
                          "$1:-$2"
                        )
                      : i.replace(/(^\s*):/, "$1-")),
                  (i =
                    "right" == n || "center" == n
                      ? (i = i.replace(/-(\s*$)/, ":$1")).replace(
                          /(^\s*):(\s*$)/,
                          "$1-:$2"
                        )
                      : i.replace(/:(\s*$)/, "-$1")),
                  /^\s*::\s*$/.exec(i) && (i = i.replace("::", ":-:")),
                  i
                );
            }
          }),
          (r.tryResetTable = function (e) {
            e &&
              !e.isDeleted() &&
              e.get("type") == o.table &&
              e.get("userText") &&
              e.set("userText", void 0);
          }),
          (r.prototype.unwrap = function (e) {
            this.cid;
            var t = [],
              n = this.getFirstChild();
            do {
              var r = n.get("after");
              n.set("parent", this.get("parent")),
                n.set("attachTo", this.get("attachTo")),
                n.get("before") || n.set("before", this.get("before")),
                n.get("after") || n.set("after", this.get("after")),
                t.push(n),
                n.get("pattern") &&
                  n.set("pattern", n.get("pattern").replace(/^\s+/, "")),
                (n = r);
            } while (n);
            return (
              this.remove(!0),
              e &&
                e
                  .findElemById(this.cid)
                  .replaceWith(
                    i.NodeCollectionUtils.toHTML(t, { mathCount: 0 })
                  ),
              t
            );
          }),
          (r.wrap = function (e, t, n, i) {
            var r,
              o = t;
            t.addBefore(e), i.findElemById(e.cid).remove();
            do {
              if (
                ((r = o.get("after")),
                e.appendChild(o),
                o != t && i.findElemById(o.cid).remove(),
                o == n)
              )
                break;
              o = r;
            } while (o);
            i.findElemById(t.cid).replaceWith(e.toHTML());
          });
      }
    ),
    $__System.registerDynamic("1f", ["20"], !0, function (e, t, n) {
      "use strict";
      this || self;
      !(function (e) {
        function t(e) {
          e.state.markedSelection &&
            e.operation(function () {
              !(function (e) {
                try {
                  if (!e.somethingSelected()) return s(e);
                  if (e.listSelections().length > 1) return l(e);
                  var t = e.getCursor("start"),
                    n = e.getCursor("end"),
                    r = e.state.markedSelection;
                  if (!r.length) return a(e, t, n);
                  var c = r[0].find(),
                    d = r[r.length - 1].find();
                  if (
                    !c ||
                    !d ||
                    n.line - t.line < i ||
                    o(t, d.to) >= 0 ||
                    o(n, c.from) <= 0
                  )
                    return l(e);
                  for (; o(t, c.from) > 0; )
                    r.shift().clear(), (c = r[0].find());
                  for (
                    o(t, c.from) < 0 &&
                    (c.to.line - t.line < i
                      ? (r.shift().clear(), a(e, t, c.to, 0))
                      : a(e, t, c.from, 0));
                    o(n, d.to) < 0;

                  )
                    r.pop().clear(), (d = r[r.length - 1].find());
                  o(n, d.to) > 0 &&
                    (n.line - d.from.line < i
                      ? (r.pop().clear(), a(e, d.from, n))
                      : a(e, d.to, n));
                } catch (e) {}
              })(e);
            });
        }
        function n(e) {
          e.state.markedSelection &&
            e.state.markedSelection.length &&
            e.operation(function () {
              s(e);
            });
        }
        e.defineOption("styleSelectedText", !1, function (i, r, o) {
          var a = o && o != e.Init;
          r && !a
            ? ((i.state.markedSelection = []),
              (i.state.markedSelectionStyle =
                "string" == typeof r ? r : "CodeMirror-selectedtext"),
              l(i),
              i.on("cursorActivity", t),
              i.on("change", n))
            : !r &&
              a &&
              (i.off("cursorActivity", t),
              i.off("change", n),
              s(i),
              (i.state.markedSelection = i.state.markedSelectionStyle = null));
        });
        var i = 8,
          r = e.Pos,
          o = e.cmpPos;
        function a(e, t, n, a) {
          if (0 != o(t, n))
            for (
              var s = e.state.markedSelection,
                l = e.state.markedSelectionStyle,
                c = t.line;
              ;

            ) {
              var d = c == t.line ? t : r(c, 0),
                u = c + i,
                h = u >= n.line,
                p = h ? n : r(u, 0),
                f = e.markText(d, p, { className: l });
              if ((null == a ? s.push(f) : s.splice(a++, 0, f), h)) break;
              c = u;
            }
        }
        function s(e) {
          for (var t = e.state.markedSelection, n = 0; n < t.length; ++n)
            t[n].clear();
          t.length = 0;
        }
        function l(e) {
          s(e);
          for (var t = e.listSelections(), n = 0; n < t.length; n++)
            a(e, t[n].from(), t[n].to());
        }
      })(e("20"));
    }),
    $__System.registerDynamic("21", ["20"], !0, function (e, t, n) {
      this || self;
      !(function (e) {
        var t = {
            pairs: "()[]{}''\"\"",
            closeBefore: ")]}'\":;>",
            triples: "",
            explode: "[]{}",
          },
          n = e.Pos;
        function i(e, n) {
          return "pairs" == n && "string" == typeof e
            ? e
            : "object" == typeof e && null != e[n]
            ? e[n]
            : t[n];
        }
        e.defineOption("autoCloseBrackets", !1, function (t, n, a) {
          a &&
            a != e.Init &&
            (t.removeKeyMap(r), (t.state.closeBrackets = null)),
            n &&
              (o(i(n, "pairs")), (t.state.closeBrackets = n), t.addKeyMap(r));
        });
        var r = {
          Backspace: function (t) {
            var r = s(t);
            if (!r || t.getOption("disableInput")) return e.Pass;
            for (
              var o = i(r, "pairs"), a = t.listSelections(), c = 0;
              c < a.length;
              c++
            ) {
              if (!a[c].empty()) return e.Pass;
              var d = l(t, a[c].head);
              if (!d || o.indexOf(d) % 2 != 0) return e.Pass;
            }
            for (var c = a.length - 1; c >= 0; c--) {
              var u = a[c].head;
              t.replaceRange(
                "",
                n(u.line, u.ch - 1),
                n(u.line, u.ch + 1),
                "+delete"
              );
            }
          },
          Enter: function (t) {
            var n = s(t),
              r = n && i(n, "explode");
            if (!r || t.getOption("disableInput")) return e.Pass;
            for (var o = t.listSelections(), a = 0; a < o.length; a++) {
              if (!o[a].empty()) return e.Pass;
              var c = l(t, o[a].head);
              if (!c || r.indexOf(c) % 2 != 0) return e.Pass;
            }
            t.operation(function () {
              var e = t.lineSeparator() || "\n";
              t.replaceSelection(e + e, null),
                t.execCommand("goCharLeft"),
                (o = t.listSelections());
              for (var n = 0; n < o.length; n++) {
                var i = o[n].head.line;
                t.indentLine(i, null, !0), t.indentLine(i + 1, null, !0);
              }
            });
          },
        };
        function o(e) {
          for (var t = 0; t < e.length; t++) {
            var n = e.charAt(t),
              i = "'" + n + "'";
            r[i] || (r[i] = a(n));
          }
        }
        function a(t) {
          return function (r) {
            return (function (t, r) {
              var o = s(t);
              if (!o || t.getOption("disableInput")) return e.Pass;
              var a = i(o, "pairs"),
                l = a.indexOf(r);
              if (-1 == l) return e.Pass;
              for (
                var d,
                  u = i(o, "closeBefore"),
                  h = i(o, "triples"),
                  p = a.charAt(l + 1) == r,
                  f = t.listSelections(),
                  m = l % 2 == 0,
                  g = 0;
                g < f.length;
                g++
              ) {
                var v,
                  y = f[g],
                  b = y.head,
                  w = t.getRange(b, n(b.line, b.ch + 1));
                if (m && !y.empty()) v = "surround";
                else if ((!p && m) || w != r)
                  if (
                    p &&
                    b.ch > 1 &&
                    h.indexOf(r) >= 0 &&
                    t.getRange(n(b.line, b.ch - 2), b) == r + r
                  ) {
                    if (
                      b.ch > 2 &&
                      /\bstring/.test(t.getTokenTypeAt(n(b.line, b.ch - 2)))
                    )
                      return e.Pass;
                    v = "addFour";
                  } else if (p) {
                    var x =
                      0 == b.ch ? " " : t.getRange(n(b.line, b.ch - 1), b);
                    if (e.isWordChar(w) || x == r || e.isWordChar(x))
                      return e.Pass;
                    v = "both";
                  } else {
                    if (
                      !m ||
                      !(0 === w.length || /\s/.test(w) || u.indexOf(w) > -1)
                    )
                      return e.Pass;
                    v = "both";
                  }
                else
                  v =
                    p && c(t, b)
                      ? "both"
                      : h.indexOf(r) >= 0 &&
                        t.getRange(b, n(b.line, b.ch + 3)) == r + r + r
                      ? "skipThree"
                      : "skip";
                if (d) {
                  if (d != v) return e.Pass;
                } else d = v;
              }
              var C = l % 2 ? a.charAt(l - 1) : r,
                F = l % 2 ? r : a.charAt(l + 1);
              t.operation(function () {
                if ("skip" == d) t.execCommand("goCharRight");
                else if ("skipThree" == d)
                  for (var i = 0; i < 3; i++) t.execCommand("goCharRight");
                else if ("surround" == d) {
                  for (var r = t.getSelections(), i = 0; i < r.length; i++)
                    r[i] = C + r[i] + F;
                  t.replaceSelections(r, "around"),
                    (r = t.listSelections().slice());
                  for (var i = 0; i < r.length; i++)
                    r[i] =
                      ((o = r[i]),
                      void 0,
                      (a = e.cmpPos(o.anchor, o.head) > 0),
                      {
                        anchor: new n(
                          o.anchor.line,
                          o.anchor.ch + (a ? -1 : 1)
                        ),
                        head: new n(o.head.line, o.head.ch + (a ? 1 : -1)),
                      });
                  t.setSelections(r);
                } else
                  "both" == d
                    ? (t.replaceSelection(C + F, null),
                      t.triggerElectric(C + F),
                      t.execCommand("goCharLeft"))
                    : "addFour" == d &&
                      (t.replaceSelection(C + C + C + C, "before"),
                      t.execCommand("goCharRight"));
                var o, a;
              });
            })(r, t);
          };
        }
        function s(e) {
          var t = e.state.closeBrackets;
          return !t || t.override
            ? t
            : e.getModeAt(e.getCursor()).closeBrackets || t;
        }
        function l(e, t) {
          var i = e.getRange(n(t.line, t.ch - 1), n(t.line, t.ch + 1));
          return 2 == i.length ? i : null;
        }
        function c(e, t) {
          var i = e.getTokenAt(n(t.line, t.ch + 1));
          return (
            /\bstring/.test(i.type) &&
            i.start == t.ch &&
            (0 == t.ch || !/\bstring/.test(e.getTokenTypeAt(t)))
          );
        }
        o(t.pairs + "`");
      })(e("20"));
    }),
    $__System.registerDynamic("22", ["20"], !0, function (e, t, n) {
      this || self;
      var i = e("20");
      !(function () {
        i.defineOption("autoCloseTags", !1, function (a, s, l) {
          if ((l != i.Init && l && a.removeKeyMap("autoCloseTags"), s)) {
            var c = { name: "autoCloseTags" };
            ("object" != typeof s || s.whenClosing) &&
              (c["'/'"] = function (e) {
                return (function (e) {
                  return e.getOption("disableInput") ? i.Pass : n(e, !0);
                })(e);
              }),
              ("object" != typeof s || s.whenOpening) &&
                (c["'>'"] = function (n) {
                  return (function (n) {
                    if (n.getOption("disableInput")) return i.Pass;
                    for (
                      var a = n.listSelections(), s = [], l = 0;
                      l < a.length;
                      l++
                    ) {
                      if (!a[l].empty()) return i.Pass;
                      var c = a[l].head,
                        d = n.getTokenAt(c),
                        u = i.innerMode(n.getMode(), d.state),
                        h = u.state;
                      if ("xml" != u.mode.name || !h.tagName) return i.Pass;
                      var p = n.getOption("autoCloseTags"),
                        f = "html" == u.mode.configuration,
                        m =
                          ("object" == typeof p && p.dontCloseTags) || (f && e),
                        g = ("object" == typeof p && p.indentTags) || (f && t),
                        v = h.tagName;
                      d.end > c.ch && (v = v.slice(0, v.length - d.end + c.ch));
                      var y = v.toLowerCase();
                      if (
                        !v ||
                        ("string" == d.type &&
                          (d.end != c.ch ||
                            !/[\"\']/.test(
                              d.string.charAt(d.string.length - 1)
                            ) ||
                            1 == d.string.length)) ||
                        ("tag" == d.type && "closeTag" == h.type) ||
                        d.string.indexOf("/") == d.string.length - 1 ||
                        (m && r(m, y) > -1) ||
                        o(n, v, c, h, !0)
                      )
                        return i.Pass;
                      var b = g && r(g, y) > -1;
                      s[l] = {
                        indent: b,
                        text: ">" + (b ? "\n\n" : "") + "</" + v + ">",
                        newPos: b
                          ? i.Pos(c.line + 1, 0)
                          : i.Pos(c.line, c.ch + 1),
                      };
                    }
                    for (var l = a.length - 1; l >= 0; l--) {
                      var w = s[l];
                      n.replaceRange(w.text, a[l].head, a[l].anchor, "+insert");
                      var x = n.listSelections().slice(0);
                      (x[l] = { head: w.newPos, anchor: w.newPos }),
                        n.setSelections(x),
                        w.indent &&
                          (n.indentLine(w.newPos.line, null, !0),
                          n.indentLine(w.newPos.line + 1, null, !0));
                    }
                  })(n);
                }),
              a.addKeyMap(c);
          }
        });
        var e = [
            "area",
            "base",
            "br",
            "col",
            "command",
            "embed",
            "hr",
            "img",
            "input",
            "keygen",
            "link",
            "meta",
            "param",
            "source",
            "track",
            "wbr",
          ],
          t = [
            "applet",
            "blockquote",
            "body",
            "button",
            "div",
            "dl",
            "fieldset",
            "form",
            "frameset",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "head",
            "html",
            "iframe",
            "layer",
            "legend",
            "object",
            "ol",
            "p",
            "select",
            "table",
            "ul",
          ];
        function n(e, t) {
          for (
            var n = e.listSelections(), r = [], a = t ? "/" : "</", s = 0;
            s < n.length;
            s++
          ) {
            if (!n[s].empty()) return i.Pass;
            var l,
              c = n[s].head,
              d = e.getTokenAt(c),
              u = i.innerMode(e.getMode(), d.state),
              h = u.state;
            if (
              t &&
              ("string" == d.type ||
                "<" != d.string.charAt(0) ||
                d.start != c.ch - 1)
            )
              return i.Pass;
            if ("xml" != u.mode.name)
              if (
                "htmlmixed" == e.getMode().name &&
                "javascript" == u.mode.name
              )
                l = a + "script";
              else {
                if ("htmlmixed" != e.getMode().name || "css" != u.mode.name)
                  return i.Pass;
                l = a + "style";
              }
            else {
              if (
                !h.context ||
                !h.context.tagName ||
                o(e, h.context.tagName, c, h)
              )
                return i.Pass;
              l = a + h.context.tagName;
            }
            ">" != e.getLine(c.line).charAt(d.end) && (l += ">"), (r[s] = l);
          }
          e.replaceSelections(r), (n = e.listSelections());
          for (s = 0; s < n.length; s++)
            (s == n.length - 1 || n[s].head.line < n[s + 1].head.line) &&
              e.indentLine(n[s].head.line);
        }
        function r(e, t) {
          if (e.indexOf) return e.indexOf(t);
          for (var n = 0, i = e.length; n < i; ++n) if (e[n] == t) return n;
          return -1;
        }
        function o(e, t, n, r, o) {
          if (!i.scanForClosingTag) return !1;
          var a = Math.min(e.lastLine() + 1, n.line + 500),
            s = i.scanForClosingTag(e, n, null, a);
          if (!s || s.tag != t) return !1;
          for (
            var l = r.context, c = o ? 1 : 0;
            l && l.tagName == t;
            l = l.prev
          )
            ++c;
          n = s.to;
          for (var d = 1; d < c; d++) {
            var u = i.scanForClosingTag(e, n, null, a);
            if (!u || u.tag != t) return !1;
            n = u.to;
          }
          return !0;
        }
        i.commands.closeTag = function (e) {
          return n(e);
        };
      })();
    }),
    $__System.registerDynamic("23", ["20"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = e("20");
      i.overlayMode = function (e, t, n) {
        return {
          startState: function () {
            return {
              base: i.startState(e),
              overlay: i.startState(t),
              basePos: 0,
              baseCur: null,
              overlayPos: 0,
              overlayCur: null,
              streamSeen: null,
            };
          },
          copyState: function (n) {
            return {
              base: i.copyState(e, n.base),
              overlay: i.copyState(t, n.overlay),
              basePos: n.basePos,
              baseCur: null,
              overlayPos: n.overlayPos,
              overlayCur: null,
            };
          },
          token: function (i, r) {
            return (
              (i != r.streamSeen ||
                Math.min(r.basePos, r.overlayPos) < i.start) &&
                ((r.streamSeen = i), (r.basePos = r.overlayPos = i.start)),
              i.start == r.basePos &&
                ((r.base.lineBefore = r.lineBefore),
                (r.base.lineAfter = r.lineAfter),
                (r.baseCur = e.token(i, r.base)),
                (r.basePos = i.pos)),
              i.start == r.overlayPos &&
                ((i.pos = i.start),
                (r.overlayCur = t.token(i, r.overlay)),
                (r.overlayPos = i.pos)),
              (i.pos = Math.min(r.basePos, r.overlayPos)),
              null == r.overlayCur
                ? r.baseCur
                : (null != r.baseCur && r.overlay.combineTokens) ||
                  (n && null == r.overlay.combineTokens)
                ? r.baseCur + " " + r.overlayCur
                : r.overlayCur
            );
          },
          indent:
            e.indent &&
            function (t, n) {
              return e.indent(t.base, n);
            },
          electricChars: e.electricChars,
          innerMode: function (t) {
            return { state: t.base, mode: e };
          },
          blankLine: function (i) {
            var r, o;
            return (
              e.blankLine && (r = e.blankLine(i.base)),
              t.blankLine && (o = t.blankLine(i.overlay)),
              null == o ? r : n && null != r ? r + " " + o : o
            );
          },
        };
      };
    }),
    $__System.registerDynamic("24", ["20"], !0, function (e, t, n) {
      this || self;
      var i = e("20"),
        r = "CodeMirror-lint-markers";
      function o(e) {
        e.parentNode && e.parentNode.removeChild(e);
      }
      function a(e, t, n) {
        var r = (function (e, t) {
          var n = document.createElement("div");
          function r(e) {
            if (!n.parentNode) return i.off(document, "mousemove", r);
            (n.style.top = Math.max(0, e.clientY - n.offsetHeight - 5) + "px"),
              (n.style.left = e.clientX + 5 + "px");
          }
          return (
            (n.className = "CodeMirror-lint-tooltip"),
            n.appendChild(t.cloneNode(!0)),
            document.body.appendChild(n),
            i.on(document, "mousemove", r),
            r(e),
            null != n.style.opacity && (n.style.opacity = 1),
            n
          );
        })(e, t);
        function a() {
          var e;
          i.off(n, "mouseout", a),
            r &&
              ((e = r).parentNode &&
                (null == e.style.opacity && o(e),
                (e.style.opacity = 0),
                setTimeout(function () {
                  o(e);
                }, 600)),
              (r = null));
        }
        var s = setInterval(function () {
          if (r)
            for (var e = n; ; e = e.parentNode) {
              if ((e && 11 == e.nodeType && (e = e.host), e == document.body))
                return;
              if (!e) {
                a();
                break;
              }
            }
          if (!r) return clearInterval(s);
        }, 400);
        i.on(n, "mouseout", a);
      }
      function s(e, t, n) {
        (this.marked = []),
          (this.options = t),
          (this.timeout = null),
          (this.hasGutter = n),
          (this.onMouseOver = function (t) {
            !(function (e, t) {
              var n = t.target || t.srcElement;
              if (!/\bCodeMirror-lint-mark-/.test(n.className)) return;
              for (
                var i = n.getBoundingClientRect(),
                  r = (i.left + i.right) / 2,
                  o = (i.top + i.bottom) / 2,
                  s = e.findMarksAt(
                    e.coordsChar({ left: r, top: o }, "client")
                  ),
                  l = [],
                  c = 0;
                c < s.length;
                ++c
              ) {
                var u = s[c].__annotation;
                u && l.push(u);
              }
              l.length &&
                (function (e, t) {
                  for (
                    var n = t.target || t.srcElement,
                      i = document.createDocumentFragment(),
                      r = 0;
                    r < e.length;
                    r++
                  ) {
                    var o = e[r];
                    i.appendChild(d(o));
                  }
                  a(t, i, n);
                })(l, t);
            })(e, t);
          }),
          (this.waitingFor = 0);
      }
      function l(e) {
        var t = e.state.lint;
        t.hasGutter && e.clearGutter(r);
        for (var n = 0; n < t.marked.length; ++n) t.marked[n].clear();
        t.marked.length = 0;
      }
      function c(e, t, n, r) {
        var o = document.createElement("div"),
          s = o;
        return (
          (o.className = "CodeMirror-lint-marker-" + t),
          n &&
            ((s = o.appendChild(document.createElement("div"))).className =
              "CodeMirror-lint-marker-multiple"),
          0 != r &&
            i.on(s, "mouseover", function (t) {
              a(t, e, s);
            }),
          o
        );
      }
      function d(e) {
        var t = e.severity;
        t || (t = "error");
        var n = document.createElement("div");
        return (
          (n.className = "CodeMirror-lint-message-" + t),
          n.appendChild(document.createTextNode(e.message)),
          n
        );
      }
      function u(e) {
        var t = e.state.lint.options,
          n = t.options || t,
          r = t.getAnnotations || e.getHelper(i.Pos(0, 0), "lint");
        if (r)
          if (t.async || r.async)
            !(function (e, t, n) {
              var r = e.state.lint,
                o = ++r.waitingFor;
              function a() {
                (o = -1), e.off("change", a);
              }
              e.on("change", a),
                t(
                  e.getValue(),
                  function (t, n) {
                    e.off("change", a),
                      r.waitingFor == o &&
                        (n && t instanceof i && (t = n), h(e, t));
                  },
                  n,
                  e
                );
            })(e, r, n);
          else {
            var o = r(e.getValue(), n, e);
            if (!o) return;
            o.then
              ? o.then(function (t) {
                  h(e, t);
                })
              : h(e, o);
          }
      }
      function h(e, t) {
        l(e);
        for (
          var n,
            i = e.state.lint,
            o = i.options,
            a = (function (e) {
              for (var t = [], n = 0; n < e.length; ++n) {
                var i = e[n],
                  r = i.from.line;
                (t[r] || (t[r] = [])).push(i);
              }
              return t;
            })(t),
            s = 0;
          s < a.length;
          ++s
        ) {
          var u = a[s];
          if (u) {
            for (
              var h = null,
                p = i.hasGutter && document.createDocumentFragment(),
                f = 0;
              f < u.length;
              ++f
            ) {
              var m = u[f],
                g = m.severity;
              g || (g = "error"),
                (h = "error" == (n = h) ? n : g),
                o.formatAnnotation && (m = o.formatAnnotation(m)),
                i.hasGutter && p.appendChild(d(m)),
                m.to &&
                  i.marked.push(
                    e.markText(m.from, m.to, {
                      className: "CodeMirror-lint-mark-" + g,
                      __annotation: m,
                    })
                  );
            }
            i.hasGutter &&
              e.setGutterMarker(
                s,
                r,
                c(p, h, u.length > 1, i.options.tooltips)
              );
          }
        }
        o.onUpdateLinting && o.onUpdateLinting(t, a, e);
      }
      function p(e) {
        var t = e.state.lint;
        t &&
          (clearTimeout(t.timeout),
          (t.timeout = setTimeout(function () {
            u(e);
          }, t.options.delay || 500)));
      }
      i.defineOption("lint", !1, function (e, t, n) {
        if (
          (n &&
            n != i.Init &&
            (l(e),
            !1 !== e.state.lint.options.lintOnChange && e.off("change", p),
            i.off(e.getWrapperElement(), "mouseover", e.state.lint.onMouseOver),
            clearTimeout(e.state.lint.timeout),
            delete e.state.lint),
          t)
        ) {
          for (var o = e.getOption("gutters"), a = !1, c = 0; c < o.length; ++c)
            o[c] == r && (a = !0);
          var d = (e.state.lint = new s(
            e,
            (h = t) instanceof Function
              ? { getAnnotations: h }
              : ((h && !0 !== h) || (h = {}), h),
            a
          ));
          !1 !== d.options.lintOnChange && e.on("change", p),
            0 != d.options.tooltips &&
              "gutter" != d.options.tooltips &&
              i.on(e.getWrapperElement(), "mouseover", d.onMouseOver),
            u(e);
        }
        var h;
      }),
        i.defineExtension("performLint", function () {
          this.state.lint && u(this);
        }),
        (i.clearMarks = l),
        (i.updateLinting = h);
    }),
    $__System.registerDynamic(
      "18",
      [
        "20",
        "11",
        "e",
        "25",
        "13",
        "26",
        "1b",
        "15",
        "1c",
        "1f",
        "21",
        "22",
        "23",
        "24",
      ],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("20"),
          r = e("11"),
          o = e("e"),
          a = (e("25"), e("13")),
          s = e("26"),
          l = (e("1b"), e("15")),
          c = e("1c"),
          d = s.map;
        Node = a.Node;
        var u = i.prototype.focus;
        (i.prototype.focus = function () {
          i.signal(this, "focus", this), u.apply(this);
        }),
          window.webkit &&
            (delete i.keyMap.emacsy["Alt-F"],
            delete i.keyMap.emacsy["Alt-D"],
            delete i.keyMap.emacsy["Alt-B"]);
        e("1f"), e("21"), e("22"), e("23"), e("24");
        var h = [
            "js",
            "javascript",
            "java",
            "json",
            "typescript",
            "clojure",
            "coffeescript",
            "css",
            "less",
            "scss",
            "gfm",
            "markdown",
            "xaml",
            "xml",
            "haskell",
            "html",
            "lua",
            "lisp",
            "commonlisp",
            "pascal",
            "perl",
            "perl6",
            "php",
            "php+HTML",
            "python",
            "cython",
            "ruby",
            "shell",
            "sh",
            "sql",
            "sqlite",
            "mssql",
            "mysql",
            "CQL",
            "mariadb",
            "cassandra",
            "plsql",
            "tiddlywiki",
            "wiki",
            "vb",
            "basic",
            "visual basic",
            "vbscript",
            "velocity",
            "verilog",
            "xquery",
            "yaml",
            "go",
            "groovy",
            "nginx",
            "octave",
            "c",
            "clike",
            "c++",
            "cpp",
            "objc",
            "objective-c",
            "csharp",
            "c#",
            "squirrel",
            "ceylon",
            "kotlin",
            "tex",
            "latex",
            "swift",
            "scala",
            "R",
            "D",
            "diff",
            "erlang",
            "http",
            "jade",
            "rst",
            "rust",
            "jinja2",
            "reStructuredText",
            "asp",
            "jsp",
            "erb",
            "ejs",
            "embeddedjs",
            "powershell",
            "dockerfile",
            "jsx",
            "tsx",
            "react",
            "vue",
            "nsis",
            "mathematica",
            "tiki wiki",
            "properties",
            "ini",
            "livescript",
            "assembly",
            "gas",
            "toml",
            "matlab",
            "ocaml",
            "F#",
            "fsharp",
            "elm",
            "pgp",
            "asciiarmor",
            "spreadsheet",
            "elixir",
            "cmake",
            "cypher",
            "dart",
            "django",
            "dtd",
            "xml-dtd",
            "dylan",
            "handlebars",
            "idl",
            "web-idl",
            "yacas",
            "mbox",
            "vhdl",
            "julia",
            "haxe",
            "hxml",
            "fortran",
            "protobuf",
            "makefile",
            "tcl",
            "scheme",
            "twig",
            "bash",
            "SAS",
            "pseudocode",
            "stylus",
            "cobol",
            "oz",
            "SPARQL",
            "crystal",
            "ASN.1",
            "gherkin",
            "smalltalk",
            "turtle",
            "glsl",
            "apl",
            "ABAP",
            "q",
            "v",
            "forth",
            "nim",
            "solidity",
            "htaccess",
            "postgresql",
            "hive",
            "stata",
            "systemverilog",
            "smarty",
            "yara",
            "pug",
            "svelte",
          ].sort((e, t) => e.toLowerCase().localeCompare(t.toLowerCase())),
          p = {
            clojure:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span>',
            ceylon: '<span class="path1"></span><span class="path2"></span>',
            dart: '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',
            fsharp:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span>',
            cmake:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span>',
            cython:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',
            dockerfile:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',
            elm: '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span>',
            haskell:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span>',
            haxe: '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span><span class="path10"></span><span class="path11"></span><span class="path12"></span><span class="path13"></span>',
            julia:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span>',
            jsp: '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',
            matlab:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span>',
            python: '<span class="path1"></span><span class="path2"></span>',
            protobuf:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span>',
            vue: '<span class="path1"></span><span class="path2"></span>',
            sparql: '<span class="path1"></span><span class="path2"></span>',
            squirrel:
              '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span>',
            xquery: '<span class="path1"></span><span class="path2"></span>',
            v: '<span class="path1"></span><span class="path2"></span>',
            toml: '<span class="path1"></span><span class="path2"></span><span class="path3"></span>',
            vhdl: '<span class="path1"></span><span class="path2"></span>',
            wiki: '<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span><span class="path10"></span><span class="path11"></span><span class="path12"></span><span class="path13"></span><span class="path14"></span><span class="path15"></span><span class="path16"></span><span class="path17"></span><span class="path18"></span><span class="path19"></span><span class="path20"></span><span class="path21"></span><span class="path22"></span><span class="path23"></span><span class="path24"></span><span class="path25"></span><span class="path26"></span><span class="path27"></span><span class="path28"></span><span class="path29"></span><span class="path30"></span><span class="path31"></span><span class="path32"></span><span class="path33"></span>',
          },
          f = {
            js: "javascript",
            "c#": "csharp",
            "c++": "cpp",
            "objective-c": "objectivec",
            "php+HTML": "php",
            latex: "tex",
            zsh: "console",
            bash: "console",
            cmd: "console",
            sh: "console",
            shell: "console",
            jsx: "react",
            asciiarmor: "key",
            pgp: "key",
            sql: "database",
            sqlite: "database",
            mssql: "database",
            mysql: "database",
            postgresql: "database",
            hive: "database",
            stata: "database",
            CQL: "database",
            mariadb: "database",
            cassandra: "database",
            plsql: "database",
            clike: "c",
            coffeescript: "coffee",
            "F#": "fsharp",
            commonlisp: "lisp",
            cypher: "database",
            dtd: "xml",
            D: "d",
            embeddedjs: "ejs",
            gfm: "markdown",
            gas: "assembly",
            flow: "none",
            hxml: "haxe",
            jinja2: "jinja",
            mbox: "email",
            nsis: "makefile",
            objc: "objectivec",
            octave: "matlab",
            Q: "q",
            perl6: "perl",
            properties: "ini",
            SAS: "sas",
            spreadsheet: "table",
            SPARQL: "sparql",
            R: "r",
            tsx: "typescript",
            basic: "vb",
            vbscript: "vb",
            "visual basic": "vb",
            "xml-dtd": "xml",
            tiddlywiki: "wiki",
            "tiki wiki": "wiki",
            echarts:"diagram",
            mermaid: "diagram",
            flow: "diagram",
            sequence: "diagram",
            htaccess: "credits",
            ABAP: "credits",
            "ASN.1": "credits",
            dylan: "credits",
            gherkin: "credits",
            idl: "credits",
            jade: "credits",
            mathematica: "credits",
            oz: "credits",
            pascal: "credits",
            pseudocode: "credits",
            rst: "credits",
            reStructuredText: "credits",
            turtle: "credits",
            "web-idl": "credits",
            yacas: "credits",
            systemverilog: "verilog",
            smalltalk: "credits",
            yara: "credits",
            pug: "credits",
          };
        for (var m of h) f[m] = f[m] || m;
        !(function (e) {
          var t = e.commands.delLineLeft;
          e.commands.delLineLeft = function (n) {
            try {
              return 0 == n.getCursor().ch ? e.commands.delCharBefore(n) : t(n);
            } catch (e) {}
          };
        })(i);
        var g = function (e, t) {
          var n = this;
          e
            .on("change blur", function () {
              this.textContent != t.get("lang") && n.tryAddLangUndo(t, this);
            })
            .keydown(function (e) {
              var t = e.which || e.keyCode;
              "Enter" == d[t] && o(this).trigger("change");
            })
            .focus(function () {
              File.isMac &&
                bridge.callHandler("touchBar.setFencesOnSetLang", !0);
            })
            .on("keydown", function (e) {
              var t,
                i = e.keyCode || e.which;
              if ("Delete" == d[i]) {
                if (
                  !(t = n.editor.selection.getRangy()) ||
                  t.commonAncestorContainer.parentElement != this
                )
                  return !1;
                if (
                  t.commonAncestorContainer == this ||
                  (t.startOffset == t.endOffset &&
                    t.endOffset == this.textContent.length)
                )
                  return n.editor.selection.moveUpOrDown(!1), !1;
              } else if ("Backspace" == d[i]) {
                if (
                  !(t = n.editor.selection.getRangy()) ||
                  t.commonAncestorContainer.parentElement != this
                )
                  return !1;
                if (
                  t.commonAncestorContainer == this ||
                  (t.startOffset == t.endOffset && 0 == t.startOffset)
                )
                  return n.editor.selection.moveUpOrDown(!0), !1;
              } else if ("Return" == d[i] || "Enter" == d[i])
                return (
                  n.editor.autoComplete.isShown() ||
                    n.editor.selection.moveUpOrDown(!1),
                  !1
                );
            })
            .on("paste", function (e) {
              setTimeout(function () {
                (e.target.textContent = e.target.textContent
                  .replace(/(^\n+)|(\n+$)/g, "")
                  .split(/\r?\n/)[0]),
                  o(e.target).trigger("change");
              }, 0);
            })
            .on("input", function (e) {
              this.querySelector(":not(br)") &&
                (this.textContent = this.textContent.replace(
                  /(^\n+)|(\n+$)/g,
                  ""
                ));
            }),
            this.editor.autoComplete.show(h, e[0], void 0, {
              type: "fences",
              render: this.autoCompleteRender,
            });
        };
        function v(e, t, n) {
          if (e)
            switch (e) {
              case "javascript":
              case "text/javascript":
              case "js":
                return (e = "javascript");
              case "json":
              case "json5":
                return t ? e : (e = { name: "javascript", json: !0 });
              case "jsonld":
              case "json-ld":
                return t ? e : "application/ld+json";
              case "text/typescript":
              case "typescript":
              case "ts":
                return t
                  ? "typescript"
                  : (e = { name: "javascript", typescript: !0 });
              case "clojure":
                return e;
              case "coffee":
              case "coffeescript":
              case "css":
                return e;
              case "less":
                return t ? "less" : "text/x-less";
              case "scss":
                return t ? "scss" : (e = "text/x-scss");
              case "gfm":
              case "github flavored markdown":
                return (e = "gfm");
              case "markdown":
              case "md":
              case "mkd":
                return e;
              case "xml":
              case "xaml":
              case "mjml":
              case "xul":
              case "enml":
                return t ? e : "xml";
              case "haskell":
                return e;
              case "htmlmixed":
              case "html":
              case "html4":
              case "html5":
              case "xhtml":
              case "svg":
              case "epub":
                return t ? (/^html/.exec(e) ? "html" : e) : (e = "htmlmixed");
              case "lua":
                return e;
              case "lisp":
              case "commonlisp":
              case "common lisp":
                return (e = "commonlisp");
              case "pascal":
                return e;
              case "perl":
              case "perl5":
              case "perl4":
              case "perl3":
              case "perl2":
                return "perl";
              case "perl6":
                return e;
              case "php+html":
                return t ? "php" : "application/x-httpd-php";
              case "php":
              case "php3":
              case "php4":
              case "php5":
              case "php6":
                return t ? e : "text/x-php";
              case "cython":
                return t ? e : (e = "text/x-cython");
              case "py":
              case "py2":
              case "py3":
                e = "python";
              case "python2":
              case "python3":
              case "python":
                return t ? e : (e = "text/x-python");
              case "terraform":
                return t ? e : "ruby";
              case "ruby":
                return e;
              case "shell":
              case "sh":
              case "zsh":
              case "bash":
              case "terminal":
                return n ? "bash" : (e = "shell");
              case "sql":
                return t ? e : (e = "text/x-mariadb");
              case "sql lite":
              case "sqlite":
                return t ? e : (e = "text/x-sql");
              case "mssql":
                return t ? e : (e = "text/x-mssql");
              case "mysql":
                return t ? e : (e = "text/x-mysql");
              case "pgsql":
              case "postgresql":
                return t ? "postgresql" : (e = "text/x-pgsql");
              case "hive":
                return t ? e : (e = "text/x-hive");
              case "esper":
                return t ? e : (e = "text/x-esper");
              case "mariadb":
                return t ? e : (e = "text/x-mariadb");
              case "cassandra":
              case "cql":
                return t ? e : (e = "text/x-cassandra");
              case "plsql":
                return t ? e : (e = "text/x-plsql");
              case "greenplum":
              case "greenplum-db":
              case "gpsql":
                return t ? e : (e = "text/x-gpsql");
              case "sparksql":
              case "spark-sql":
              case "spark sql":
                return t ? e : (e = "text/x-sparksql");
              case "esper":
                return t ? e : (e = "text/x-esper");
              case "stex":
              case "tex":
              case "latex":
              case "math":
                return t ? e : "text/x-stex";
              case "tiddlywiki":
              case "wiki":
                return t ? e : (e = "tiddlywiki");
              case "vb":
              case "visual basic":
              case "visualbasic":
              case "basic":
                return t ? e : (e = "vb");
              case "vbscript":
              case "velocity":
                return e;
              case "verilog":
                return t ? e : (e = "text/x-verilog");
              case "systemverilog":
                return t ? e : (e = "text/x-systemverilog");
              case "xquery":
                return e;
              case "yaml":
              case "yml":
                return t ? e : "yaml";
              case "go":
              case "golang":
              case "go-lang":
                return "go";
              case "groovy":
              case "nginx":
                return e;
              case "octave":
              case "matlab":
                return t ? e : "text/x-octave";
              case "c":
              case "clike":
              case "csrc":
                return t ? e : (e = "text/x-csrc");
              case "c++":
              case "c++src":
              case "cpp":
              case "cc":
              case "hpp":
              case "h++":
              case "h":
                return t ? e : (e = "text/x-c++src");
              case "obj-c":
              case "objc":
              case "objective c":
              case "objective-c":
              case "objectivec":
                return t ? e : (e = "text/x-objectivec");
              case "text/x-scala":
              case "scala":
                return t ? e : (e = "text/x-scala");
              case "csharp":
              case "c#":
              case "cs":
                return t ? e : (e = "text/x-csharp");
              case "java":
                return t ? e : (e = "text/x-java");
              case "squirrel":
                return t ? e : (e = "text/x-squirrel");
              case "ceylon":
                return t ? e : (e = "text/x-ceylon");
              case "kotlin":
                return t ? e : (e = "text/x-kotlin");
              case "swift":
              case "swiftui":
                return (e = "swift");
              case "r":
              case "rlang":
              case "r-lang":
                return t ? e : (e = "text/x-rsrc");
              case "d":
              case "dlang":
              case "d-lang":
              case "diff":
              case "erlang":
              case "http":
              case "jade":
                return e;
              case "rst":
              case "restructuredtext":
                return (e = "rst");
              case "rust":
                return e;
              case "jinja":
                return t ? e : "jinja2";
              case "jinja2":
                return e;
              case "aspx":
              case "asp":
              case "asp.net":
                return t ? e : (e = "application/x-aspx");
              case "jsp":
                return t ? e : (e = "application/x-jsp");
              case "erb":
                return t ? e : (e = "application/x-erb");
              case "ejs":
              case "embeddedjs":
              case "embedded javaScript":
                return t ? e : (e = "application/x-ejs");
              case "powershell":
              case "bat":
              case "cmd":
                return t ? e : "application/x-powershell";
              case "docker":
              case "dockerfile":
                return t ? e : "text/x-dockerfile";
              case "jsx":
              case "react":
                return t ? e : "text/jsx";
              case "tsx":
                return t ? e : "text/typescript-jsx";
              case "vue.js":
              case "vue":
              case "vue-template":
                return t ? e : "script/x-vue";
              case "nsis":
                return t ? e : "text/x-nsis";
              case "mathematica":
                return t ? e : "text/x-mathematica";
              case "tiki":
              case "tiki wiki":
              case "tiki-wiki":
              case "tikiwiki":
                return "tiki";
              case "properties":
              case "ini":
                return t ? e : "text/x-properties";
              case "livescript":
                return t ? e : "text/x-livescript";
              case "asm":
              case "assembly":
              case "nasm":
              case "gas":
                return t ? e : "assembly";
              case "toml":
                return t ? e : "text/x-toml";
              case "sequence":
                return "sequence";
              case "flow":
              case "flowchart":
                return "flow";
              case "mermaid":
                  return "mermaid";
              case "echarts":
                    return "echarts";
              case "ocaml":
                return t ? e : "text/x-ocaml";
              case "f#":
              case "fsharp":
                return t ? e : "text/x-fsharp";
              case "elm":
                return t ? e : "text/x-elm";
              case "pgp":
              case "pgp-keys":
              case "pgp-key":
              case "pgp-signature":
              case "asciiarmor":
              case "ascii-armor":
              case "ascii armor":
                return t ? e : "application/pgp";
              case "spreadsheet":
              case "excel":
                return t ? e : "text/x-spreadsheet";
              case "elixir":
                return "elixir";
              case "cmake":
                return t ? e : "text/x-cmake";
              case "cypher":
              case "cypher-query":
                return t ? e : "application/x-cypher-query";
              case "dart":
                return "dart";
              case "django":
                return t ? e : "text/x-django";
              case "dtd":
              case "xml-dtd":
              case "xml dtd":
              case "xmldtd":
                return t ? e : "application/xml-dtd";
              case "dylan":
                return t ? e : "text/x-dylan";
              case "handlebars":
              case "svelte":
                return t ? e : { name: "handlebars", base: "text/html" };
              case "idl":
                return t ? e : "text/x-idl";
              case "webidl":
              case "web-idl":
              case "web idl":
                return t ? e : "text/x-webidl";
              case "yacas":
                return t ? e : "text/x-yacas";
              case "mbox":
                return t ? e : "application/mbox";
              case "vhdl":
                return t ? e : "text/x-vhdl";
              case "julia":
                return "julia";
              case "haxe":
                return t ? e : "text/x-haxe";
              case "hxml":
                return t ? e : "text/x-hxml";
              case "fortran":
                return t ? e : "text/x-fortran";
              case "protobuf":
                return t ? e : "text/x-protobuf";
              case "makefile":
                return t ? e : "text/x-makefile";
              case "tcl":
                return t ? e : "text/x-tcl";
              case "scheme":
                return t ? e : "text/x-scheme";
              case "twig":
                return t ? e : "text/x-twig";
              case "sas":
                return t ? e : "text/x-sas";
              case "pseudocode":
                return t ? e : "text/x-pseudocode";
              case "julia":
              case "text/x-julia":
              case "stylus":
              case "cobol":
              case "oz":
              case "sparql":
              case "crystal":
                return e;
              case "asn.1":
                return t ? "ASN.1" : (e = "text/x-ttcn-asn");
              case "gherkin":
              case "smalltalk":
              case "turtle":
                return e;
              case "glsl":
              case "Open GL Shading Language":
                return (e = "glsl");
              case "apl":
              case "abap":
                return e;
              case "q":
              case "qlang":
              case "q-lang":
                return t ? e : "text/x-q";
              case "v":
              case "vlang":
              case "v-lang":
                return "v";
              case "forth":
                return e;
              case "nim":
              case "nimrod":
                return t ? e : "nimrod";
              case "solidity":
                return e;
              case "htaccess":
              case ".htaccess":
                if (t) return "htaccess";
              case "apache":
                return "apache";
              case "stata":
                return e;
              case "smarty":
              case "smarty2":
                return t ? e : "smarty";
              case "smarty3":
                return t ? e : { name: "smarty", verson: 3 };
              case "yara":
              case "pug":
                return e;
              default:
                return "";
            }
        }
        var y = function (e) {
            var t = document.createElement("div");
            return (
              t.setAttribute("class", "code-tooltip md-tooltip-remove"),
              t.setAttribute("align", "right"),
              t.setAttribute("contenteditable", "false"),
              (t.innerHTML =
                "<span class='ty-input ty-input-after ty-cm-lang-input' contenteditable tabindex='-1' autocorrect='false' placeholder='" +
                o.localize.getString("code language") +
                "'></span>"),
              (t.childNodes[0].textContent = e || ""),
              t
            );
          },
          b = function (e) {
            if (!e) return {};
            if ("{" != e[0] || "}" != e[e.length - 1]) return {};
            var t = e.replace(/(^{)|(}$)/g, "").split(/\s+/);
            if (!t || !t.length) return {};
            var n = {};
            return (
              t.forEach(function (e) {
                var t;
                (t = /^[.]number((-?l)|L)ines/.exec(e))
                  ? (n.lineNumbers = !0)
                  : (t = /^startFrom=['"](\d+)['"]$/.exec(e)) &&
                    (n.firstLineNumber = t[1] - 0);
              }),
              n
            );
          };
        window.getCodeMirrorMode = function (e, t, n, i) {
          var r = ((e = (e = e ? e.toLowerCase() : "")
              .replace(/^\s*\.*lang(uage)*-/g, "")
              .replace(/[{}]/g, "")
              .trim()).split(/[\s,]+/) || [e])[0],
            o = v(e, n || i, i);
          return (
            o || e == r || (o = v(r.replace(/(^[.])|(,$)/g, ""), n, i)),
            o || (n ? r : t ? null : e)
          );
        };
        var w = null,
          x = [];
        function C(e, t) {
          if (File.isMac) {
            if (null == w)
              return (
                (w = {}),
                (x = []),
                void bridge.callHandler("word.getTextReplacement", {}, (e) => {
                  (w = e), (x = Object.keys(w));
                })
              );
            if (1 == t.length && "+input" == t[0].origin) {
              var n = e.getWrapperElement().querySelector("textarea").value;
              n = n.substr(0, n.length - 1);
              var i = x.find((e) => n.endsWith(e));
              if (i && w[i]) {
                var r = Object.assign({}, e.getCursor("to")),
                  o = Object.assign({}, r);
                (r.ch -= 1),
                  (o.ch = r.ch - i.length),
                  e.doc.replaceRange(w[i], o, r, "+replaceText");
              }
            }
          }
        }
        class F {
          constructor(e) {
            (this.getOptionsFromFencesAttr = b),
              (this.handleUserReplacement = C);
            var t = this;
            (this.editor = e),
              (this.queue = {}),
              this.cachedCharWidth,
              (this.editor.diagrams = new l(e)),
              File.option.enableDiagram && (h = h.concat(l.MODES)),
              (this.ALL = h),
              (this.autoCompleteRender = (e, t) =>
                `<li class="${t ? "active" : ""}" data-content="${e.replace(
                  /[']/g,
                  "&quot;"
                )}"><i class="ty-file-icon ty-fi-${f[e] || e}">${
                  p[f[e] || ""] || ""
                }</i><span>${e}</span></li>`),
              "shift+tab" === File.option.autoIndentKey ||
                File.option.shiftTabAutoIndent ||
                (i.keyMap.default["Shift-Tab"] = "indentLess"),
              o(document)
                .on("losefocus", ".md-fences", function () {
                  var e = o(this),
                    n = t.queue[e.attr("cid")];
                  n &&
                    (t.syncToNode(this.getAttribute("cid")),
                    n.doc.setCursor(0, 0, { scroll: !1 }),
                    e.find(".md-tooltip-remove").hide(),
                    (e[0].style.marginBottom = ""),
                    e.find(".md-fences-adv-panel").length &&
                      setTimeout(() => {
                        t.editor.selection.scrollAdjust();
                      }, 1));
                })
                .on("endfocus", ".md-fences", function () {
                  var e = o(this);
                  t.queue[e.attr("cid")] &&
                    (e.find(".md-tooltip-remove").hide(),
                    (e[0].style.marginBottom = ""));
                })
                .on("focus", ".ty-input", function () {
                  var e = o(this).closest("[cid]"),
                    n = t.queue[e.attr("cid")];
                  n &&
                    (t.syncToNode(this.getAttribute("cid")),
                    n.doc.setCursor(0, 0, { scroll: !1 }));
                }),
              File.isWin &&
                ((i.keyMap.default.End = "goLineRight"),
                (i.keyMap.default.Home = "goLineLeft")),
              File.isMac &&
                bridge.registerHandler(
                  "fences.needUpdateReplaceDict",
                  function (e) {
                    (w = null), (x = []);
                  }
                ),
              this.bindMouseEvents(),
              this.lazyload(),
              this.editor.diagrams.lazyload();
          }
          bindMouseEvents() {
            var e = this,
              t = this.editor;
            window.addEventListener(
              "mousedown",
              (t) => {
                e.isMousePressed = !0;
              },
              !0
            ),
              window.addEventListener(
                "mouseup",
                (n) => {
                  if (((e.isMousePressed = !1), e.cmNeedsScroll)) {
                    var i = e.cmNeedsScroll;
                    (e.cmNeedsScroll = null),
                      t.selection.typeWriterScroll(
                        i.cursorCoords(i.getCursor())
                      );
                  }
                },
                !0
              ),
              (this.handleCursorActivity = (n) => {
                (e.cmNeedsScroll = null),
                  (n.curOp && !n.curOp.scrollToPos) ||
                    (File.isTypeWriterMode &&
                      File.option.scrollWithCursor &&
                      (e.isMousePressed
                        ? (e.cmNeedsScroll = n)
                        : t.selection.typeWriterScroll(
                            n.cursorCoords(n.getCursor())
                          )));
              });
          }
          onLeaveDocument() {
            (this.queue = {}), this.intersectionObserve(null, !0);
          }
          clickEventHandled(e, t) {
            var n, i, r;
            this.queue[t] ||
              ((r = window.scrollY),
              this.getCm(t),
              (r -= window.scrollY),
              window.scrollBy(0, r),
              (n = document.elementFromPoint(e.clientX, e.clientY)) &&
                (e.stopPropagation(),
                (i = document.createEvent("MouseEvents")).initMouseEvent(
                  "mousedown",
                  !0,
                  !0,
                  n.ownerDocument.defaultView,
                  1,
                  e.screenX,
                  e.screenY,
                  e.clientX,
                  e.clientY,
                  e.ctrlKey,
                  e.altKey,
                  e.shiftKey,
                  e.metaKey,
                  e.button
                ),
                n.dispatchEvent(i)),
              this.editor.refocus(t));
          }
          getCm(e) {
            if (this.queue[e]) {
              if (o("[cid='" + e + "'] textarea").length) return this.queue[e];
              delete this.queue[e];
            }
            if (!this.queue[e]) return this.addCodeBlock(e);
          }
          getValue(e) {
            if (this.queue[e]) return this.queue[e].getValue();
            var t = this.editor.findElemById(e)[0];
            return t ? t.innerText : "";
          }
          onKeyDown(e, t, n, r, o) {
            var a,
              s = t.which || t.keyCode,
              l = i.keyName(t),
              c = !t.metaKey && !t.shiftKey && !t.ctrlKey;
            if ("Up" == i.keyNames[s]) {
              if ((a = e.getCursor()) && 0 == a.line) {
                if (c)
                  return n.selection.moveUpOrDown(!0, t), t.codemirrorIgnore;
                if (
                  0 == a.ch &&
                  !t.shiftKey &&
                  ((File.isNode && t.ctrlKey) || (File.isMac && t.metaKey))
                )
                  return void (t.codemirrorIgnore = !0);
              }
              t.stopPropagation();
            } else if ("Down" == i.keyNames[s]) {
              if ((a = e.getCursor()) && a.line >= e.lineCount() - 1) {
                if (c)
                  return n.selection.moveUpOrDown(!1, t), t.codemirrorIgnore;
                if (
                  a.ch == e.doc.getLine(a.line).length &&
                  !t.shiftKey &&
                  ((File.isNode && t.ctrlKey) || (File.isMac && t.metaKey))
                )
                  return void (t.codemirrorIgnore = !0);
              }
              t.stopPropagation();
            } else n.selection.clearGlobalColumn();
            if ("Left" == i.keyNames[s]) {
              if (e.getSelection().length > 0) return;
              if ((a = e.doc.getCursor()) && !a.line && !a.ch && c)
                return n.selection.moveUpOrDown(!0, t, !0), t.codemirrorIgnore;
              t.stopPropagation();
            } else if ("Right" == i.keyNames[s]) {
              if (e.getSelection().length > 0) return;
              if (
                (a = e.doc.getCursor()) &&
                a.line >= e.lineCount() - 1 &&
                a.ch >= e.doc.getLine(a.line).length &&
                c
              )
                return n.selection.moveUpOrDown(!1, t, !0), t.codemirrorIgnore;
              t.stopPropagation();
            } else if ("Backspace" == i.keyNames[s]) {
              if (
                (a = e.doc.getCursor()) &&
                e.lineCount() <= 1 &&
                !a.line &&
                !a.ch &&
                !e.getSelection().length
              )
                return r(e), t.preventDefault(), t.codemirrorIgnore;
              t.stopPropagation();
            } else if ("Delete" == i.keyNames[s]) {
              if ("" == e.getValue())
                return r(e), t.preventDefault(), t.codemirrorIgnore;
              t.stopPropagation();
            } else if ("PageDown" == i.keyNames[s]) {
              if (
                !(a = e.doc.getCursor(a)) ||
                e.doc.indexFromPos(a) >= e.doc.getValue().length
              )
                return (
                  e.execCommand("goDocEnd"),
                  n.selection.moveUpOrDown(!1),
                  void (t.codemirrorIgnore = !0)
                );
            } else if ("PageUp" == i.keyNames[s]) {
              if (!(a = e.doc.getCursor()) || (0 == a.line && 0 == a.ch))
                return (
                  e.execCommand("goDocStart"),
                  n.selection.moveUpOrDown(!0),
                  void (t.codemirrorIgnore = !0)
                );
            } else if ("Enter" == i.keyNames[s] && o(e, t))
              return t.codemirrorIgnore;
            (i.keyMap.macDefault[l] || i.keyMap.pcDefault[l]) &&
              t.stopPropagation();
          }
          addCodeBlock(e) {
            var t = this.editor,
              n = this;
            function r(e) {
              var i = t.getNode(e.cid),
                r = t.undo.UndoManager,
                o = r.makeEmptyCommand();
              n.beforeDeleteFences(e.cid),
                o.undo.push({
                  type: "fences-pos",
                  pos: e.getCursor(),
                  id: e.cid,
                }),
                r.append(o, t.UserOp.backToParagraph(t, i, !1)),
                t.undo.register(o);
            }
            function s(e, n) {
              if (File.isMac ? n.metaKey : n.ctrlKey) {
                if (e.getSelection().length > 0) return;
                var i = e.doc.getCursor();
                if (
                  e.lineCount() - 1 == i.line &&
                  i.ch >= e.doc.getLine(i.line).length
                )
                  return (
                    t.UserOp.insertParagraph(!1),
                    n.stopPropagation(),
                    (n.codemirrorIgnore = !0),
                    !0
                  );
              }
            }
            function d(e, i) {
              n.onKeyDown(e, i, t, r, s);
            }
            function u(i) {
              t.refocus(e.id),
                i.getWrapperElement().offsetHeight || i.refresh();
              var r = o(i.getWrapperElement()).closest(".md-fences");
              if (!r.find(".md-tooltip-remove").length) {
                var a = y(r.attr("lang") || "");
                r[0].insertChildAtIndex(a, 1),
                  g.call(n, o(a).find(".ty-input"), e);
              }
              m(i),
                l.isDiagramType(i.options.mode) &&
                  t.diagrams.startPreview(i.cid),
                c.isMathType(e.get("lang")) &&
                  (r[0].style.marginBottom =
                    r.find(".md-fences-adv-panel").height() + 20 + "px"),
                File.isMac &&
                  bridge.callHandler("touchBar.setFencesOnSetLang", !1);
            }
            function h(e, t) {
              File.isNodeHtml &&
                File.editor.contextMenu.show(t, e.getWrapperElement());
            }
            function p(n, i) {
              C(n, i),
                t.wordCount.quickUpdate(n.cid),
                t.selection.clearGlobalColumn(),
                l.isDiagramType(n.options.mode) &&
                  t.diagrams.updateDiagram(n.cid),
                c.isMathType(e.get("lang")) &&
                  t.mathBlock.renderUnder(t.findElemById(n.cid)[0], !0),
                File.isTypeWriterMode &&
                  !File.option.scrollWithCursor &&
                  t.selection.typeWriterScroll(n.cursorCoords(n.getCursor())),
                e.set("text", n.getValue()),
                i.length &&
                  i[0].origin &&
                  t.syncChange([{ type: "sync", id: n.cid, cmChanges: i }]);
            }
            function f(e, n) {
              l.isDiagramType(e.options.mode) &&
                n.ranges.length &&
                n.ranges[0].anchor.line != (e.getCursor() || {}).line &&
                t.diagrams.attachError(e);
            }
            function m(e, i) {
              e.hasFocus() &&
                (n.handleCursorActivity(e), t.wordCount.updateInSelection());
            }
            function v(e, t) {
              File.isTypeWriterMode && t.preventDefault();
            }
            function w(e, n) {
              if ("TEXTAREA" !== document.activeElement.tagName) {
                var i = (t.selection.getRangy() || {}).commonAncestorContainer;
                if (
                  i &&
                  i == e.display.lineDiv &&
                  e.display.lineDiv.contains(i)
                )
                  return;
                n.codemirrorIgnore = !0;
              }
            }
            if (("string" == typeof e && (e = this.editor.getNode(e)), e)) {
              if (!this.queue[e.id] && e.get("type") == a.TYPE.fences) {
                var x = o("[cid = " + e.id + "]").removeClass("mock-cm");
                if (!x.length) return;
                var F = x.find(".md-fences-adv-panel").clone();
                x.addClass("ty-contain-cm").html("");
                var S = getCodeMirrorMode(e.get("lang"));
                e.id, this.modeLoaded;
                var k = {
                  lineWrapping: !File.option.noLineWrapping,
                  mode: S,
                  styleSelectedText: !0,
                  maxHighlightLength: 1 / 0,
                  viewportMargin: 1 / 0,
                  styleActiveLine: !0,
                  autoCloseBrackets: !File.option.noPairingMatch,
                  autoCloseTags: !File.option.noPairingMatch,
                  theme: " inner null-scroll",
                  lineNumbers: File.option.showLineNumbersForFence,
                  resetSelectionOnContextMenu: !0,
                  cursorScrollMargin: 60,
                  dragDrop: !1,
                  indentUnit: File.option.codeIndentSize,
                  tabSize: File.option.codeIndentSize,
                  lineWiseCopyCut: File.option.lineWiseCopyCut,
                  scrollbarStyle: "null",
                  value: e.safeGetStrAttr("text"),
                };
                Object.assign(k, b(e.get("lang")));
                var E = i(x[0], k, this.editor, e.id);
                console.log(k),
                  (this.queue[e.id] = E),
                  E.off("keydown", d),
                  E.on("keydown", d),
                  E.off("focus", u),
                  E.on("focus", u),
                  E.off("changes", p),
                  E.on("changes", p),
                  E.off("scrollCursorIntoView", v),
                  E.on("scrollCursorIntoView", v),
                  E.off("cursorActivity", m),
                  E.on("cursorActivity", m),
                  E.off("contextmenu", h),
                  E.on("contextmenu", h),
                  E.off("beforeSelectionChange", f),
                  E.on("beforeSelectionChange", f),
                  E.off("copy", w),
                  E.on("copy", w),
                  E.off("cut", w),
                  E.on("cut", w),
                  (function (e) {
                    if (t.searchPanel) {
                      var i = t.searchPanel.searchStatus;
                      if (i) {
                        var r = i.hits;
                        if (
                          r.length &&
                          !(r.length > t.searchPanel.MAX_HITS_COUNT)
                        ) {
                          for (var o = -1, a = -1, s = 0; s < r.length; s++) {
                            let t = r[s];
                            if (t.cid == e.cid && t.isFutureCm)
                              o < 0 && (o = s),
                                (a = s),
                                (t.isFutureCm = !1),
                                (t.isCm = e);
                            else if (a > 0) break;
                          }
                          -1 != o && n.searchOn(e, i.searchText, i);
                        }
                      }
                    }
                  })(E),
                  x
                    .children(".CodeMirror")
                    .attr("lang", (e.get("lang") || "").toLowerCase()),
                  this.modeLoaded && x.addClass("modeLoaded"),
                  !File.option.showLineNumbersForFence &&
                    k.lineNumbers &&
                    x.addClass("md-fences-with-lineno"),
                  F.length && x.append(F);
                var T = x.closest("li");
                T.length &&
                  ((T[0].style.display = "block"), (T[0].style.display = ""));
              }
              return this.editor.tryEnterBusyModeWithDelay(), this.queue[e.id];
            }
          }
          toggleFocusedComponent() {
            var e = document.activeElement,
              t = o(e).closest(".md-fences");
            if (t.length)
              if (e.classList && e.classList.contains("ty-cm-lang-input")) {
                var n = t.attr("cid"),
                  i = this.getCm(n),
                  r = i.getCursor();
                i.focus(), i.setCursor(r);
              } else
                t.find(".CodeMirror-focused")
                  .removeClass("CodeMirror-focused")
                  .end()
                  .find(".ty-input")
                  .show()
                  .focus();
          }
          focus(e) {
            var t = "string" == typeof e ? e : e.id;
            this.getCm(t).focus();
          }
          getFocused() {
            for (var e in this.queue)
              if (this.queue.hasOwnProperty(e) && this.queue[e].hasFocus())
                return this.queue[e];
          }
          updateCodeNum() {
            for (var e in this.queue)
              this.editor.getNode(e) || delete this.queue[e];
          }
          copyContent() {
            var e = this.editor.getNode(null, !0),
              t = this.editor.UserOp.setClipboard,
              n = e.get("text");
            t(
              `<pre lang='${e.get("lang") || ""}'>${r.escape(n)}</pre>`,
              void 0,
              n,
              !0
            );
          }
          formatContent(e) {
            var t;
            if (this.editor.sourceView.inSourceMode)
              t = this.editor.sourceView.cm;
            else {
              var n = this.editor.getNode(null, !0);
              if (
                !(t = (
                  this.editor.findElemById(n.id).find(".CodeMirror")[0] || {}
                ).CodeMirror)
              )
                return void File.editor.UserOp.lessIndent(File.editor);
            }
            var i = t.listSelections();
            e || t.execCommand("selectAll"),
              t.execCommand("indentAuto"),
              e || t.setSelections(i);
          }
          syncToNode(e) {
            var t, n;
            (t = "string" == typeof e ? this.editor.getNode(e) : e) &&
              ((n = this.getCm(t.id)),
              t.get("text") !== n.getValue() && t.set("text", n.getValue()));
          }
          decorateAll() {
            this.refreshEditor(!0, !1);
          }
          intersectionObserve(e, t) {
            this.continueRenderTimer && clearTimeout(this.continueRenderTimer),
              this.intersectionObserver &&
                t &&
                this.intersectionObserver.disconnect();
            var n = this;
            e &&
              (this.intersectionObserver ||
                (this.intersectionObserver = new IntersectionObserver(function (
                  e
                ) {
                  e.forEach(function (e) {
                    e.intersectionRatio <= 0 ||
                      (n.addCodeBlock(e.target.getAttribute("cid")),
                      n.intersectionObserver &&
                        n.intersectionObserver.unobserve(e.target));
                  });
                })),
              this.intersectionObserver.observe(e));
          }
          refreshEditor(e, t, n) {
            if (this.modeLoaded) {
              var i = this,
                r = 0;
              for (var o in this.queue) {
                var a = this.editor.findElemById(o);
                if (a.find(".CodeMirror").length && this.editor.getNode(o)) {
                  var s = this.queue[o];
                  if (a.hasClass("modeLoaded")) t && s.refresh();
                  else {
                    var l = this.editor.getNode(o);
                    s.setOption("mode", getCodeMirrorMode(l.get("lang"))),
                      s.refresh();
                  }
                  r++;
                } else delete this.queue[o];
              }
              var c = (n || document).querySelectorAll("[mdtype='fences']"),
                d = window.IntersectionObserver ? 8 : 30,
                u = 0;
              c.length != r &&
                c.forEach(function (t) {
                  var r = t.getAttribute("cid");
                  i.queue[r]
                    ? !n && u++
                    : e || (!File.inBusyMode && u < d)
                    ? (i.addCodeBlock(r), u++)
                    : window.IntersectionObserver && i.intersectionObserve(t);
                });
            }
          }
          lazyload() {
            var e = this;
            o.getScript(
              (File.isNode && !window.debugMode ? "./lib.asar" : "./lib") +
                "/codemirror/mode.min.js"
            ).then(function () {
              (e.modeLoaded = !0),
                e.refreshEditor(),
                e.editor.tryEnterBusyModeWithDelay();
            });
          }
          jumpCmEnd(e) {
            var t = e,
              n = e;
            "string" == typeof t ? (n = this.getCm(t)) : (t = n.cid);
            var i = 0,
              r = 0;
            n &&
              ((i = n.doc.lastLine()),
              (r = n.doc.getLine(i).length),
              n.focus(),
              n.setCursor({ line: i, ch: r }));
          }
          jumpCmBegin(e) {
            var t = e;
            "string" == typeof t && (t = this.getCm(t)),
              t.focus(),
              t.setCursor({ line: 0, ch: 0 });
          }
          beforeDeleteFences(e, t) {
            var n, i;
            "string" == typeof e
              ? ((n = this.queue[e]), (i = this.editor.getNode(e)))
              : ((i = e), (n = this.queue[i.id])),
              n &&
                (i.get("text") !== n.getValue() && i.set("text", n.getValue()),
                n.doc.clearHistory(),
                delete this.queue[i.id],
                t &&
                  t.map(function (e) {
                    e &&
                      (e.id == i.id &&
                      e.json &&
                      e.json.content &&
                      e.json.content.type == a.TYPE.fences
                        ? (e.json.content.text = i.get("text"))
                        : Array.isArray(e.json) &&
                          e.json.map(function (e) {
                            e.id == i.id &&
                              e.content.type == a.TYPE.fences &&
                              (e.content.text = i.get("text"));
                          }));
                  }));
          }
          searchOn(e, t, n) {
            (this.searchStatus = this.searchStatus || {}),
              (this.searchStatus.overlay = this.searchStatus.overlay || {}),
              (this.searchStatus.queue = this.searchStatus.queue || []);
            var i = null;
            if (n.useRegexp)
              try {
                n.wholeWord && (t = `\\b${t.replace(/^\\b|\\b$/g, "")}\\b`),
                  (i = new RegExp(t, n.caseSensitive ? "g" : "gi"));
              } catch (e) {
                return;
              }
            else
              i = n.wholeWord
                ? new RegExp(
                    "\\b" + r.escapeRegExp(t) + "\\b",
                    n.caseSensitive ? "g" : "gi"
                  )
                : new RegExp(r.escapeRegExp(t), n.caseSensitive ? "g" : "gi");
            (this.searchStatus.overlay[e.cid || "source"] = (function (e) {
              return {
                searchExp: e,
                token: function (e) {
                  var t = this.searchExp;
                  t.lastIndex = e.pos;
                  var n = t.exec(e.string);
                  return n && n.index == e.pos
                    ? ((e.pos += n[0].length || 1), "search-hit")
                    : (n ? (e.pos = n.index) : e.skipToEnd(), null);
                },
              };
            })(i)),
              e.addOverlay(this.searchStatus.overlay[e.cid || "source"]),
              this.searchStatus.queue.push(e);
          }
          clearSearchOn(e) {
            this.searchStatus &&
              (e.removeOverlay(this.searchStatus.overlay[e.cid || "source"]),
              this.searchStatus.queue.remove(e));
          }
          clearSearchAll() {
            if (this.editor.sourceView.inSourceMode)
              return (
                this.searchStatus &&
                  this.editor.sourceView.cm.removeOverlay(
                    this.searchStatus.overlay.source
                  ),
                void (this.searchStatus = null)
              );
            this.searchStatus &&
              this.searchStatus.overlay &&
              this.searchStatus.queue.forEach(function (e) {
                this.searchStatus.overlay[e.cid] &&
                  e.removeOverlay(this.searchStatus.overlay[e.cid]);
              }, this),
              (this.searchStatus = null);
          }
          renderFences(e) {
            return F.renderFences(e);
          }
          tryAddLangUndo(e, t) {
            if (
              (t || (t = document.activeElement),
              !t.classList || !t.classList.contains("ty-cm-lang-input"))
            )
              return !1;
            if (
              (e ||
                (e = this.editor.getNode(o(t).closest("[cid]").attr("cid"))),
              !e)
            )
              return !1;
            var n = e.get("lang") || "",
              i = t.textContent || "";
            return n != i && (e.attr("lang", i, this.editor, !1), !0);
          }
        }
        (F.renderFencesByUpdate = function (e, t, n) {
          if (
            (t.classList.remove("md-diagram"),
            t.classList.remove("md-fences-math"),
            t.classList.remove("md-fences-advanced"),
            l.isDiagramType(n))
          ) {
            t.classList.add("md-diagram"),
              t.classList.add("md-fences-advanced");
            var i = File.editor.findElemById(e.cid);
            if (i.find("textarea").val() == e.get("text")) {
              var r = i.find(".md-diagram-panel").clone()[0];
              r && t.appendChild(r);
            }
          }
          c.isMathType(n) &&
            (t.classList.add("md-fences-math"),
            t.classList.add("md-fences-advanced"),
            t.setAttribute("id", "mathjax-" + e.cid));
        }),
          (F.renderFences = function (e) {
            var t = document.createElement("PRE");
            t.classList.add("md-fences"),
              t.classList.add("mock-cm"),
              t.classList.add("md-end-block"),
              File.option.showLineNumbersForFence &&
                t.classList.add("md-fences-with-lineno");
            var n = e.get("lang"),
              i = e.get("text");
            return (
              t.setAttribute("spellcheck", "false"),
              t.setAttribute("contenteditable", "false"),
              t.setAttribute("lang", n || ""),
              t.setAttribute("cid", e.cid),
              t.setAttribute("mdtype", e.get("type")),
              (t.innerText = i),
              t.innerText || (t.innerHTML = "<br/>"),
              F.renderFencesByUpdate(e, t, n),
              t.outerHTML
            );
          }),
          (n.exports = F),
          (window.CodeMirror = i),
          (window.Fences = F);
      }
    ),
    $__System.registerDynamic(
      "27",
      ["e", "13", "1b", "26", "28", "29", "11", "1d"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"),
          r = (e("13").Node, e("1b"), e("26")),
          o = e("28"),
          a = e("29"),
          s = (r.map, e("11"));
        e("1d");
        window.svgCache = {};
        var l,
          c,
          d = null,
          u = async function (e) {
            if (e) {
              var t = e
                  .querySelector("script")
                  .textContent.replace(/\u200B+/g, ""),
                n = "";
              try {
                n = await MathJax.tex2svgPromise(t, { display: !1 });
              } catch (e) {
                return void window.Reporter.error("MathJax Error", {
                  level: "warning",
                  extra: { text: t, stack: e.stack },
                });
              }
              var i = e.querySelector("mjx-container");
              i && i.remove(), e.prepend(n);
              var r = e.parentElement;
              if (r && !r.classList.contains("math-jax-postprocess")) {
                r.classList.add("math-jax-postprocess"),
                  r.classList.remove("math-jax-preprocess");
                var o = e.cloneNode(!0);
                ((o.querySelector("script") || {}).textContent || "").replace(
                  /\u200B+/g,
                  ""
                ) === t &&
                  (svgCache[t] = a.processExportedSVG(o.innerHTML, !0));
              }
            }
          },
          h = function () {
            l && clearTimeout(l),
              (l = setTimeout(function () {
                File.editor.tryEnterBusyMode(), (l = null);
              }, 100));
          },
          p = async function (e, t, n, i) {
            if (!t.length) return !1;
            (i = i && !!window.IntersectionObserver) || n || e.brush.pause();
            var r = t.length > 60;
            if (i) {
              var o = this;
              d && d.disconnect(),
                (d = new IntersectionObserver(function (e) {
                  e.forEach(async function (e) {
                    e.intersectionRatio <= 0 ||
                      (await u.call(o, e.target),
                      d && d.unobserve(e.target),
                      r && h());
                  });
                })),
                t.forEach(function (e) {
                  d.observe(e);
                });
            } else
              await Promise.all(
                Array.from(t).map((e) =>
                  this.isUnderPreview(e)
                    ? Promise.resolve()
                    : u.call(this, e, n)
                )
              ),
                r && h();
            return i || n || e.brush.resume(), !0;
          },
          f = function () {
            var e = this.editor;
            i(this.editor.sessionStr)
              .on("cursorChange", function (t, n) {
                if (n) {
                  var r,
                    o = n.cursor || e.selection.getRangy();
                  if (!o) return y(e);
                  (r = i(o.commonAncestorContainer).closest(
                    ".md-inline-math.md-expand"
                  )).find("script").length
                    ? c != r[0] && (y(e), v(e, r))
                    : y(e);
                }
              })
              .on("mousedown", ".md-inline-math mjx-container", function (t) {
                if (
                  (y(e),
                  i(".md-expand").removeClass("md-expand"),
                  !File.isLocked)
                ) {
                  var n = i(this).closest(".md-inline-math"),
                    r = n.addClass("md-expand").find("script");
                  e.selection.selectAllElem(r), v(e, n);
                }
              });
          },
          m = null,
          g = {},
          v = async function (e, t) {
            c = t[0];
            var n = i("#math-inline-preview"),
              r = document.querySelector("#math-inline-preview-content"),
              a = t.find("script").text();
            async function s(e, t) {
              if (MathJax.tex2svg) {
                if (((r.dataset.text = e), g[e] || svgCache[e])) {
                  if (
                    ((r.innerHTML = g[e] || svgCache[e]),
                    !r.querySelector("rect") && !g[e])
                  )
                    return;
                  g[e] = g[e] || svgCache[e];
                }
                try {
                  var n = t
                    ? MathJax.tex2svg(e, { display: !1 })
                    : await MathJax.tex2svgPromise(e, { display: !1 });
                  (r.innerHTML = ""), r.appendChild(n);
                } catch (t) {
                  window.Reporter.error("MathJax Error", {
                    level: "warning",
                    extra: { text: e, stack: t.stack },
                  });
                }
              }
            }
            m = async function () {
              var t = i(".md-inline-math.md-expand"),
                r = t.find("script"),
                a = r.text().replace(/\u200B+/g, ""),
                l = m;
              if (!r.height())
                return i(e.sessionStr).off("inline-math-changed", l);
              svgCache[a] ||
                (await s(a),
                o.fixPopoverPosition(r, n),
                t
                  .find("mjx-container")
                  .replaceWith(n.find("mjx-container").clone()));
            };
            var l = !1;
            t.hasClass("math-jax-postprocess") &&
              (r.dataset.text || "").replace(/[\s\u200b]/g, "") !=
                a.replace(/[\s\u200b]/g, "") &&
              (l = !0),
              (l || "none" === n[0].style.display) &&
                (i(e.sessionStr).off("inline-math-changed"),
                i(e.sessionStr).on("inline-math-changed", m),
                await s(a, !0),
                delete svgCache[a],
                n.show(),
                o.fixPopoverPosition(t.find("script"), n));
          },
          y = function (e) {
            c = null;
            var t = i("#math-inline-preview");
            "none" !== t[0].style.display && t.hide(),
              m && (i(e.sessionStr).off("inline-math-changed", m), (m = null));
          },
          b = function () {
            var e = this.editor.selection.getRangy();
            return i(e.commonAncestorContainer).closest(".md-inline-math");
          };
        n.exports = class {
          constructor(e) {
            (this.editor = e), (this.queue = {}), f.call(this);
          }
          isUnderPreview(e) {
            return c == e;
          }
          async brush(e, t, n) {
            var i = e.querySelectorAll(
              ".math-jax-preprocess .md-inline-math-container"
            );
            return (
              await p.call(
                this,
                this.editor,
                i,
                n && t && e.getAttribute("cid") === t.startId ? t : null
              ),
              i.length
            );
          }
          showAutoSuggest(e) {
            if (File.option.enableInlineMath) {
              i(".md-math-prep").removeClass("md-math-prep"),
                o.markRange(e, "md-math-prep");
              var t = i("#math-inline-preview")
                .show()
                .addClass("md-math-inline-prep-preview")
                .css("width", "auto");
              t
                .find("#math-inline-preview-content")
                .text("<Empty Inline Math>"),
                o.fixPopoverPosition(i(".md-math-prep"), t);
            }
          }
          onLeaveDocument() {
            d && d.disconnect();
            try {
              MathJax.texReset(0);
            } catch (e) {}
          }
          async renderAll(e, t, n, i) {
            if (File.option.enableInlineMath) {
              var r = [];
              n
                ? (r = Array.from(
                    document.querySelectorAll(".md-inline-math-container")
                  ).filter((e) => {
                    if (
                      e.parentElement.classList.contains("math-jax-preprocess")
                    )
                      return !0;
                    var t = e.querySelector("script").innerText;
                    return /\\(label|(eq)?ref)\{/.exec(t)
                      ? (delete window.svgCache[t], o(e), !0)
                      : void 0;
                  }))
                : e
                ? ((window.svgCache = {}),
                  (r = document.querySelectorAll(
                    ".md-inline-math-container"
                  )).forEach(o))
                : (r = (t || document).querySelectorAll(
                    ".math-jax-preprocess .md-inline-math-container"
                  )),
                r.length &&
                  (await p.call(
                    this,
                    this.editor,
                    r,
                    void 0,
                    ((File.inBusyMode && !t) || r.length > 1e3) && !e && !i
                  ),
                  this.renderInToc());
            }
            function o(e) {
              try {
                e.querySelector("mjx-container").remove();
              } catch (e) {}
              e.parentElement.classList.add("math-jax-preprocess"),
                e.parentElement.classList.remove("math-jax-postprocess");
            }
          }
          renderInToc() {
            File.option.enableInlineMath &&
              this.editor.mathBlock.isMathJaxReady() &&
              document
                .querySelectorAll(".math-in-toc")
                .forEach(async function (e) {
                  try {
                    if (
                      e.children[0] &&
                      e.children[0].tagName == "mjx-container".toUpperCase()
                    )
                      return;
                    var t = e.textContent.replace(/(^\$+)|(\$+$)|\u200B/g, ""),
                      n = svgCache[t];
                    if (n) e.innerHTML = n;
                    else {
                      var i = await MathJax.tex2svgPromise(t, { display: !1 });
                      (e.innerHTML = ""), e.appendChild(i);
                    }
                  } catch (e) {
                    window.Reporter.captureException(e, { level: "warning" });
                  }
                }, this);
          }
          tryCloseInlinePreview() {
            y(this.editor);
          }
          copyAsTex() {
            var e = b.call(this),
              t = e.attr("pattern"),
              n = e
                .text()
                .replace("$$" == t ? /(^\$\$)|(\$\$$)/g : /(^\$)|(\$$)/g, "");
            this.editor.UserOp.setClipboard(null, null, n, !0);
          }
          copyAsMathML(e) {
            var t = i("#math-inline-preview-content")[0];
            if (t) {
              var n = t.dataset.text,
                r = this.editor,
                o = MathJax.tex2mml(n, { display: !1 });
              if (e) r.UserOp.nativeCopyText(o);
              else {
                var a =
                  "<pre class='md-fences' lang='xml'>" + s.escape(o) + "</pre>";
                r.UserOp.setClipboard(a, null, o, !0);
              }
            }
          }
          copyAsImage() {
            var e = document.querySelector("#math-inline-preview-content svg"),
              t = this.editor,
              n = a.SVG2HtmlImg(e);
            t.UserOp.setClipboard(n, null, n, !0);
          }
        };
      }
    ),
    $__System.registerDynamic(
      "2a",
      ["2b", "11", "19", "13", "2c", "1b", "29", "1d"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self, e("2b");
        var i = e("11"),
          r = e("19"),
          o = e("13"),
          a = o.Node,
          s = o.TYPE,
          l = e("2c"),
          c = e("1b"),
          d = e("29"),
          u = c.SnapFlag,
          h =
            (e("1d"),
            function (e) {
              (this.editor = e),
                (this.queue = []),
                (this.interval = 200),
                (this.inline = new r.InlineLexer()),
                (this.articleArea = document.querySelector(
                  this.editor.sessionStr
                ));
            });
        h.prototype = {
          addToQueue: function (e, t) {
            (t = t || !1),
              i.isNullOrEmpty(e) || this.queue.push({ cid: e, inlineOnly: t });
          },
          run: function () {
            this.timerID || this.scheduleNext(),
              this.editor._brushInitCallback &&
                (this.editor._brushInitCallback(),
                (this.editor._brushInitCallback = null));
          },
          scheduleNext: function () {
            var e = this;
            this.timerID = window.setTimeout(async function () {
              await e.brushQueue(), e.scheduleNext();
            }, this.interval);
          },
          clearAndPause: function () {
            this.willExpandSoon && clearTimeout(this.willExpandSoon),
              (this.queue = []),
              this.pause();
          },
          pause: function () {
            clearTimeout(this.timerID),
              (this.timerID = null),
              this.editor.mathBlock && this.editor.mathBlock.clearCache();
          },
          resume: async function (e) {
            e && (await this.brushQueue()), this.run();
          },
          restart: function () {
            (this.queue = []), this.run();
          },
          brushNode: function (e) {
            var t = this.editor.selection.buildUndo();
            g.call(this, e, {}, t, !1) && this.editor.undo.exeCommand(t);
          },
          brushQueue: async function () {
            var e = this,
              t = {},
              n = e.queue.length;
            if (!this.editor.isIME && !this.editor.isMousePressed) {
              if (e.queue.length > 0 && !File.isLocked) {
                e.queue;
                var i = !1,
                  r = !0;
                !(function () {
                  var t = e.editor.selection.getRangy();
                  if (t) {
                    var n = a(t.startContainer),
                      i = n.closest("[cid]"),
                      r = a(t.endContainer).closest("[cid]");
                    i &&
                      i
                        .querySelectorAll(".md-math-after-sym")
                        .forEach(function (e) {
                          let t = e.textContent.replace(/\u200b/g, "");
                          t != e.textContent && (e.textContent = t);
                        }),
                      r &&
                        r != i &&
                        r
                          .querySelectorAll(".md-math-after-sym")
                          .forEach(function (e) {
                            e.textContent = e.textContent.replace(
                              /\u200b/g,
                              ""
                            );
                          }),
                      t.collapsed &&
                        (t.startContainer.parentElement ||
                          (t.selectNode(n),
                          t.collapse(!1),
                          e.editor.selection.setRange(t)));
                  }
                })();
                var o = e.editor.selection.buildUndo();
                await Promise.all(
                  e.queue.map((n) =>
                    (async function (n) {
                      return (
                        t[n.cid] ||
                          ((t[n.cid] = 1),
                          (i =
                            (await g.call(e, n.cid, t, o, n.inlineOnly, !0)) ||
                            i),
                          (r = r && n.inlineOnly)),
                        Promise.resolve()
                      );
                    })(n)
                  )
                ),
                  (e.queue = []),
                  i && o && e.editor.undo.exeCommand(o),
                  this.expand(!0, !1, r);
              }
              n && this.triggerAutoComplete();
            }
            function a(e) {
              return e.closest ? e : e.parentElement;
            }
          },
          triggerAutoComplete: function (e) {
            var t,
              n,
              i = null,
              r = null,
              o = this.editor,
              a = this.editor.autoComplete,
              s = this.editor.selection.getTextAround(),
              l = s[0],
              c = s[1],
              d = s[2],
              h = this.editor.getJQueryElem(
                (this.editor.selection.getRangy() || {}).commonAncestorContainer
              ),
              p = h.closest(".md-inline-math").length,
              f = e && File.option.enableInlineMath,
              m = this.editor.selection.getRangy();
            if (d && m && m.collapsed && (l || c)) {
              if (
                ((o.lastCursor = o.selection.buildUndo(m)),
                (n = function () {
                  if (m && m.collapsed) {
                    var e = $(m.endContainer).closest(".md-lang"),
                      t = e.text(),
                      n =
                        e.prev().text().length +
                        e.parent().prevAll().text().length;
                    if (t)
                      return (
                        (i = {
                          start: n,
                          end: n + t.length,
                          containerNode: e.closest("[mdtype]")[0],
                        }),
                        t
                      );
                  }
                }.call(this)))
              )
                return void a.show(this.editor.fences.ALL, i, n, {
                  type: "fences",
                  render: this.editor.fences.autoCompleteRender,
                });
              if ((r = /:(\w+)$/.exec(l)))
                return void (
                  (t = /^(\w*:*)(\s|$)/.exec(c || "")) &&
                  ((d.start -= r[1].length + 1),
                  (d.end += t[1].length),
                  (i = d),
                  a.show(
                    [],
                    i,
                    r[1] + t[1],
                    this.editor.emoji.autoCompleteOption()
                  ))
                );
              f &&
                (n = /\$?\$$/.exec(l)) &&
                0 == $(".md-expand.md-inline-math").length &&
                (function () {
                  var e,
                    t = (/^\$+/.exec(c) || "").length;
                  if (t <= n[0].length)
                    (e = "$".repeat(n[0].length - t)).length &&
                      (m.insertNode(document.createTextNode(e)),
                      m.collapse(!0)),
                      (d.start -= n[0].length),
                      (d.end += n[0].length),
                      m.moveToBookmark(d),
                      o.mathInline.showAutoSuggest(m),
                      o.restoreLastCursor(null, !0),
                      o.undo.addSnap(o.focusCid, u.REPLACE),
                      (i = null);
                })();
            } else p && h.trigger("inline-math-changed");
            this.editor.autoComplete.hide();
          },
          expandOnDelay: function (e) {
            var t = this;
            this.willExpandSoon && clearTimeout(this.willExpandSoon),
              (this.willExpandSoon = setTimeout(function () {
                t.expand(e);
              }, 10));
          },
          closestExpandable: function (e) {
            var t = e.closest("[md-inline]"),
              n = t.parent().closest("[md-inline]");
            if (!n.length) return t;
            var i = t.attr("md-inline");
            return (i &&
              !a.isType(
                i,
                s.plain,
                s.br,
                s.tag,
                s.autolink,
                s.pants,
                s.attr,
                s.linebreak
              ) &&
              t.prevAll("[md-inline]").length) ||
              t.nextAll("[md-inline]").length
              ? t
              : this.closestExpandable(n);
          },
          expand: function (e, t, n, i) {
            if (
              (!t && this.editor.wordCount.updateInSelection(),
              this.willExpandSoon &&
                (clearTimeout(this.willExpandSoon),
                (this.willExpandSoon = null)),
              !this.editor.isIME && !File.isLocked)
            ) {
              var r,
                o = this.editor.selection,
                l = o.getRangy(),
                c = o.rangy,
                u = l ? l.cloneRange() : null;
              if (
                u &&
                (u.startContainer != this.editor.writingArea ||
                  0 != u.startOffset)
              )
                if (($(".selected").removeClass("selected"), l)) {
                  if (
                    (this.editor.selection.deRange(l),
                    (r = this.editor.getJQueryElem(l.commonAncestorContainer)),
                    this.editor.stylize.putBookmark(
                      u,
                      this.editor.stylize.buildBookmark(r)
                    ),
                    (function (e) {
                      try {
                        var t = document.querySelector(
                          ".md-inline-math.md-expand"
                        );
                        if (!t) return;
                        if (e.length && t.contains(e[0])) return;
                        var n = t.querySelector(
                            ".md-inline-math-container script"
                          ),
                          i = svgCache[n.innerHTML];
                        (i = i
                          ? $(i)[0]
                          : document.querySelector(
                              "#math-inline-preview-content mjx-container"
                            )) &&
                          ($(t.querySelector("mjx-container")).replaceWith(i),
                          (window.svgCache[n.textContent] =
                            d.processExportedSVG(
                              t.querySelector(".md-inline-math-container")
                                .innerHTML,
                              !0
                            )));
                      } catch (e) {}
                    })(r),
                    !t &&
                      !n &&
                      (function (e, t) {
                        var n = e.closest("[cid]");
                        if (
                          n.length &&
                          e.closest("[md-inline]").length &&
                          !e.closest(".md-block-like").length
                        ) {
                          var i = n.find(".md-block-like");
                          if (!i.length) return !1;
                          var r = editor.findNodeByElem(e.closest("[cid]")),
                            o = editor.selection.buildUndo(t);
                          if (r.cid != o.endId) return !1;
                          var a = i.prevAll().rawText().length,
                            s = i.rawText().length;
                          if (
                            !editor.lastCursor ||
                            editor.lastCursor.endId != o.endId ||
                            editor.lastCursor.startOffset > a + s ||
                            editor.lastCursor.endOffset < a + s
                          )
                            return !1;
                          var l = !1;
                          t.comparePoint(i[0], 0) < 0 &&
                            ((o.start = o.end = o.end - a - s), (l = !0));
                          var c = editor.simpleParse(r, !1);
                          if (c)
                            return (
                              editor.findElemById(c[2]).replaceWith(c[1]),
                              l &&
                                c[3].length > 1 &&
                                (o.startId = o.endId =
                                  c[3].last().getVeryFirst().cid),
                              editor.undo.exeCommand(o),
                              (c[0].undo[0] = editor.lastCursor),
                              c[0].redo.push(editor.selection.buildUndo()),
                              editor.undo.register(c[0]),
                              editor.quickRefresh(),
                              !0
                            );
                        }
                        return !1;
                      })(r, l))
                  )
                    return;
                  if (
                    isInputComponent(document.activeElement) ||
                    ("write" !== document.activeElement.id &&
                      document.activeElement.hasAttribute("tabindex"))
                  )
                    return (
                      $(".md-expand").removeClass("md-expand"),
                      $(this.editor.sessionStr).trigger(
                        "cursorChange",
                        this.editor.styleBookmark
                      )
                    );
                  if (
                    (!r.closest("[cid]").length && !r.find("[cid]").length) ||
                    a.isType(
                      r.closest("[cid]").attr("mdtype"),
                      s.fences,
                      s.math_block,
                      s.html_block
                    )
                  )
                    return $(this.editor.sessionStr).trigger(
                      "cursorChange",
                      this.editor.styleBookmark
                    );
                  if (l.collapsed) {
                    var h,
                      p = m(r),
                      g = r.closest("[mdtype]"),
                      v = [],
                      y = p.visibleText().length,
                      b =
                        y > 0 &&
                        y < p.text().length &&
                        (function (e, t) {
                          function n(e) {
                            return (
                              !e.previousSibling ||
                              (1 == e.previousSibling.nodeType &&
                                !e.previousSibling.offsetWidth)
                            );
                          }
                          if (!t) return null;
                          if (
                            e.endOffset == e.endContainer.length ||
                            "​" == e.endContainer.textContent
                          ) {
                            for (
                              var i = e.endContainer;
                              (t.contains(i) || t == i) &&
                              !i.parentElement.getAttribute("cid") &&
                              (!(o = i).nextSibling ||
                                (1 == o.nextSibling.nodeType &&
                                  !o.nextSibling.offsetWidth));

                            )
                              i = i.parentElement;
                            return [i, !0];
                          }
                          if (0 == e.startOffset) {
                            for (
                              var r = e.startContainer;
                              (t.contains(r) || t == r) &&
                              !r.parentElement.getAttribute("cid") &&
                              n(r);

                            )
                              r = r.parentElement;
                            return [r, !1];
                          }
                          var o;
                          return null;
                        })(l, p[0]);
                    if (b) {
                      var [w, x] = b;
                      (h = $(w).addClass("md-expand")),
                        (u = c.createRange()),
                        x
                          ? u.collapseToPoint(
                              w,
                              w.childNodes ? w.childNodes.length : w.length
                            )
                          : u.collapseToPoint(w, 0),
                        this.editor.selection.setRange(u, !0);
                    } else if (
                      (k(l, -1),
                      $(l.endContainer).parent().hasClass("md-softbreak") &&
                        u.startContainer === u.endContainer &&
                        (l = u.cloneRange()),
                      (h =
                        g[0] != $(l.startContainer).closest("[mdtype]")[0]
                          ? p
                          : m(this.editor.getJQueryElem(l.startContainer))),
                      l.startContainer === l.endContainer)
                    )
                      if (
                        (l.toString().length && l.collapse(!1),
                        3 == l.endContainer.nodeType &&
                          l.endOffset == l.endContainer.textContent.length &&
                          E(l.endContainer.nextElementSibling))
                      )
                        l.endContainer.nextElementSibling.classList.add(
                          "selected"
                        ),
                          l.selectNode(l.endContainer.nextElementSibling);
                      else {
                        k(l, 1);
                        var C = l.getNodes([1], E);
                        C.length &&
                          (u.setStart(C[0], 0),
                          u.setEnd(C[0], 0),
                          editor.selection.setRange(u, !0));
                      }
                  } else h = m(this.editor.getJQueryElem(l.startContainer));
                  if (
                    (!(v = m(this.editor.getJQueryElem(l.endContainer)))
                      .length && (v = h),
                    h.length || v.length)
                  ) {
                    var F = !1;
                    u.collapsed ||
                      (F =
                        (u =
                          (function (t) {
                            var n,
                              r = t.collapsed,
                              o = !1;
                            try {
                              var a,
                                s,
                                l = t.commonAncestorContainer;
                              if (
                                0 == t.startOffset &&
                                h.length &&
                                (h = editor.getJQueryElem(t.startContainer))
                                  .length
                              )
                                if (
                                  h.closest(".md-expand").length ||
                                  h[0].hasAttribute("cid") ||
                                  h[0].querySelector("[cid]") ||
                                  h.closest(".md-image:not(.md-img-loaded)")
                                    .length
                                )
                                  (s = h.closest(".md-expand")).length &&
                                    (h = s);
                                else {
                                  if (
                                    ((a = h.closest("[cid]")[0]),
                                    !(h = (function t(n, i) {
                                      if (
                                        !n
                                          .prevAll(
                                            ":not(.md-meta, .md-content)"
                                          )
                                          .text().length
                                      ) {
                                        var r = n.parent();
                                        return r.attr("mdtype")
                                          ? n
                                          : i.contains(r[0]) || e
                                          ? t(r, i)
                                          : m(n);
                                      }
                                      return m(n);
                                    })(h, l.contains && l.contains(a) ? a : l))
                                      .length)
                                  )
                                    return null;
                                  (n = t.cloneRange()),
                                    t.setStartBefore(h[0]),
                                    (o =
                                      !i &&
                                      !r &&
                                      0 == t.startOffset &&
                                      t.startContainer.getAttribute &&
                                      t.startContainer.getAttribute("cid")),
                                    t.containsNode(h[0]) || (t = n),
                                    r && t.collapse(!0);
                                }
                              if (
                                t.endOffset ==
                                (t.endContainer.nodeType === document.TEXT_NODE
                                  ? t.endContainer.length
                                  : t.endContainer.childNodes.length)
                              ) {
                                var c = editor.getJQueryElem(t.endContainer);
                                if (c.length)
                                  if (
                                    c.closest(".md-expand").length ||
                                    c[0].hasAttribute("cid") ||
                                    c[0].querySelector("[cid]") ||
                                    c.closest(".md-image:not(.md-img-loaded)")
                                      .length
                                  )
                                    (s = c.closest(".md-expand")).length &&
                                      (c = s);
                                  else {
                                    if (
                                      ((a = c.closest("[cid]")[0]),
                                      !(c = (function e(t, n) {
                                        if (
                                          !t
                                            .nextAll(
                                              ":not(.md-meta, .md-content)"
                                            )
                                            .text().length
                                        ) {
                                          var i = t.parent();
                                          return i.hasClass("[mdtype]") ||
                                            i[0].contains(n)
                                            ? m(t)
                                            : e(i, n);
                                        }
                                        return m(t);
                                      })(
                                        c,
                                        l.contains && l.contains(a) ? a : l
                                      )).length)
                                    )
                                      return null;
                                    (n = t.cloneRange()),
                                      t.setEndAfter(c[0]),
                                      o &&
                                      t.endContainer.childNodes &&
                                      t.endContainer.childNodes.length ==
                                        t.endOffset
                                        ? t.setStartBefore(h[0])
                                        : t.containsNode(c[0]) || (t = n),
                                      r && t.collapse(!1);
                                  }
                              }
                            } catch (e) {
                              console.warn(e);
                            }
                            return t;
                          })(u) || u) && !u.collapsed),
                      $(".md-expand").removeClass("md-expand"),
                      h.length ? f.call(this, h) : f.call(this, v),
                      h.length &&
                        v.length &&
                        !v.hasClass("md-img-loaded") &&
                        f.call(this, v, !0);
                  } else $(".md-expand").removeClass("md-expand");
                  if (F)
                    this.editor.selection.deRange(
                      u,
                      !0,
                      File.isMac ? null : u.cloneRange()
                    );
                  else {
                    var S = window.getSelection().anchorNode;
                    S &&
                      (3 === S.nodeType ||
                        (S.hasAttribute &&
                          S.hasAttribute("contenteditable"))) &&
                      ((u = u || this.editor.selection.getRangy()),
                      this.editor.selection.deRange(u, !0, u.cloneRange())),
                      u.commonAncestorContainer.parentElement &&
                      u.commonAncestorContainer.parentElement.classList.contains(
                        "ty-focusable-btn"
                      )
                        ? u.commonAncestorContainer.parentElement.classList.add(
                            "selected"
                          )
                        : E(S) && S.classList.add("selected");
                  }
                  $(this.editor.sessionStr).trigger(
                    "cursorChange",
                    this.editor.styleBookmark
                  );
                } else
                  (r = this.editor.getMarkElem()),
                    $(".md-expand").removeClass("md-expand"),
                    r.length &&
                      a.isType(r.attr("mdtype"), a.TYPE.hr, a.TYPE.toc) &&
                      (this.editor.stylize.putBookmark(
                        null,
                        this.editor.stylize.buildBookmark(r)
                      ),
                      $(this.editor.sessionStr).trigger(
                        "cursorChange",
                        this.editor.styleBookmark
                      ));
            }
            function k(e, t) {
              return o.extendRange(e, t);
            }
            function E(e) {
              return (
                e && e.classList && e.classList.contains("ty-focusable-btn")
              );
            }
          },
          focusContainer: function (e) {
            p.call(this, e);
          },
        };
        var p = function (e) {
            var t = e.closest("tr.md-end-block, li[cid]")[0],
              n = e[0];
            if (t && n) {
              for (; t !== n && t.contains(n); ) {
                if (
                  n.previousSibling &&
                  n.previousSibling.hasAttribute &&
                  n.previousSibling.hasAttribute("cid")
                )
                  return !1;
                n = n.parentElement;
              }
              t.classList.add("md-focus-container");
            }
          },
          f = function (e, t) {
            t || $(".md-focus-container").removeClass("md-focus-container"),
              e.length &&
                p(
                  e
                    .addClass("md-expand")
                    .trigger("expand")
                    .closest("[cid]")
                    .addClass("md-focus")
                );
          };
        function m(e) {
          var t = e.parent().closest("[md-inline]");
          return t.length ? m(t) : e.closest("[md-inline]");
        }
        var g = async function (e, t, n, i, o) {
          var c,
            d,
            u,
            h = e,
            f = e,
            m = 0;
          function v(e) {
            for (var t = 0; t < e.attributes.length; t++)
              a.isType(
                e.attributes[t].name,
                "cid",
                "contenteditable",
                "id",
                "for",
                "onerror",
                "onload"
              ) && e.removeAttributeNode(e.attributes[t]);
            e.classList.remove("md-img-loaded"),
              e.classList.remove("md-img-error");
          }
          function y(e) {
            for (var t = e.querySelectorAll("*"), n = 0; n < t.length; n++)
              v(t[n]);
            v(e);
          }
          async function b(e, t, n, i, r, a) {
            if (e.length) {
              var s,
                l = n.innerHtml,
                c = e[0].cloneNode(!0),
                d = document.createElement("div"),
                u = ((a = n.cursorDiff), e.find(".md-footnote").length);
              d.innerHTML = l;
              var h = null;
              return (
                c.querySelectorAll(".md-expand").forEach(function (e) {
                  e.classList.contains("md-inline-math") &&
                    ((e.querySelector(".md-before") || {}).textContent !==
                    (e.querySelector(".md-after") || {}).textContent
                      ? (e.textContent = "")
                      : (h = e.rawText(!0))),
                    e.classList.remove("md-expand");
                }),
                c.querySelectorAll(".md-inline-math").forEach(function (e) {
                  (e.textContent = e.rawText(!0)),
                    e.setAttribute("id", ""),
                    h == e.textContent && e.setAttribute("class", "");
                }),
                d.querySelectorAll(".md-inline-math").forEach(function (e) {
                  (e.textContent = e.rawText(!0)),
                    e.setAttribute("id", ""),
                    h == e.textContent && e.setAttribute("class", "");
                }),
                y(c),
                y(d),
                c.innerHTML.replace(/\s*class=\"\"/gi, "") !=
                d.innerHTML.replace(/\s*class=\"\"/gi, "")
                  ? (e.html(l),
                    n.mdlike
                      ? e.attr("mdlike") != n.mdlike &&
                        e.attr("mdlike", n.mdlike)
                      : e.attr("mdlike") && e.removeAttr("mdlike"),
                    r.selection.clearGlobalColumn(),
                    o
                      ? await r.mathInline.brush(e[0], i, !0)
                      : r.mathInline.brush(e[0], i, !0),
                    (s = !0))
                  : (e.hasClass("unholdable") && e.removeClass("unholdable"),
                    e.find(".math-jax-preprocess").length &&
                      r.mathInline.brush(e[0], i, !0)),
                (e.find(".md-footnote").length || u) &&
                  r.docMenu &&
                  r.docMenu.refreshFootnoteReverseLink(),
                r.focusCid === t.cid
                  ? ((function (e, t, n, i, r, o) {
                      if (o || t.length)
                        return (
                          e &&
                            (n && n.undo.unshift(Object.clone(e)),
                            (e.start = x(t, e.start - m)),
                            (e.end = x(t, e.end - m)),
                            n && n.redo.push(e),
                            r.undo && r.undo.exeCommand(e)),
                          !0
                        );
                    })(i, a, n.command, 0, r, s),
                    !1)
                  : s
              );
            }
          }
          async function w(e, t, n, i, r) {
            return n.blockChanged
              ? (function (e, t, n, i, r) {
                  var o = n.cursorDiff || [];
                  return (
                    r.selection.clearGlobalColumn(),
                    n.replaceCid
                      ? (r.findElemById(n.replaceCid).replaceWith(n.html),
                        r.refreshUnder(r.findElemById(n.replaceCid)[0]))
                      : e.closest("p").replaceWith(n.html),
                    n.toRemove &&
                      n.toRemove.forEach(function (e) {
                        r.findElemById(e).remove();
                      }),
                    (r.focusCid && r.focusCid !== t.cid) ||
                      ((r.focusCid = n.focus),
                      r.focusCid && p(r.findElemById(r.focusCid)),
                      i &&
                        (n.command.undo.unshift(Object.clone(i)),
                        o.length &&
                          ((i.start = x(o, i.start)), (i.end = x(o, i.end))),
                        (i.id = n.focus),
                        (i.startId = n.focus),
                        (i.endId = n.focus),
                        (i.start -= n.offset),
                        (i.end -= n.offset),
                        n.command.redo.push(Object.clone(i))),
                      r.undo.register(n.command)),
                    !0
                  );
                })(e, t, n, i, r)
              : await b(e, t, n, i, r);
          }
          function x(e, t) {
            var n = t;
            for (var i in e) void 0 !== i && i <= t && (n += e[i]);
            return n;
          }
          function C(e, t, n) {
            if (n && h.cid == n.id && n.start == n.end) {
              var i = e.rawText(),
                r = 0,
                o = 0;
              if (i == t) return 0;
              for (; r < n.start; )
                if (i[r] == t[o]) r++, o++;
                else {
                  if ("​" != i[r]) break;
                  r++;
                }
              return r - o;
            }
            return 0;
          }
          try {
            if (
              ("string" == typeof e ? (h = this.editor.getNode(e)) : (f = h.id),
              !h)
            )
              return;
            if (a.isType(h, s.meta_block)) return;
            if (l.CONST.NoInline.indexOf(h.get("type")) > -1) return;
            if (h.get("children").length)
              return (
                h
                  .get("children")
                  .toArray()
                  .map(function (e) {
                    t && (t[e.id] = 1), g.call(this, e, t, n, i);
                  }, this),
                !0
              );
            if (
              ((c = this.editor.findElemById(f)),
              h.get("type") == s.def_footnote)
            ) {
              var F = c.find(".md-def-content");
              return (
                (d = F.rawText(!0)),
                (m = C(F, d, n)),
                (u = r.quickParse(d, this, h, !0)),
                await w(F, h, u, n, this.editor)
              );
            }
            return (
              (d = c.rawText(!0)),
              (m = C(c, d, n)),
              (u = r.quickParse(
                d,
                this,
                h,
                i || !a.isType(h, s.paragraph),
                null,
                n
              )),
              await w(c, h, u, n, this.editor)
            );
          } catch (e) {
            e.stack;
          }
        };
        n.exports = h;
      }
    ),
    $__System.registerDynamic(
      "25",
      ["20", "11", "e", "1b", "28", "1d"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self, e("20"), e("11");
        var i = e("e"),
          r = e("1b"),
          o = (e("28"), e("1d"));
        n.exports = class {
          constructor(e) {
            (this.editor = e),
              (this.$container = i("#ty-auto-suggest")),
              (this.onInput = (e) => {
                this.makeVisible(),
                  this.update(e.target.value || e.target.textContent || "");
              }),
              (this.onKeydown = (e) => {
                !1 === this.handleKeyEvents(e) &&
                  (e.preventDefault(), e.stopPropagation());
              }),
              (this.onFocus = (e) => {
                this.makeVisible();
              }),
              (this.onBlur = (e) => {
                this.hide();
              }),
              this.initState(),
              this.bindEvents();
          }
          bindEvents() {
            this.$container.on("mousedown", "li[data-content]", (e) => {
              e.preventDefault(), e.stopPropagation();
            }),
              this.$container.on("click", "li[data-content]", (e) => {
                this.apply(
                  e.target
                    .closest("[data-content]")
                    .getAttribute("data-content")
                ),
                  e.preventDefault(),
                  e.stopPropagation();
              }),
              i(document).on("click", (e) => {
                document.activeElement != this.state.anchor &&
                  document.activeElement !== editor.brush.articleArea &&
                  this.hide();
              });
          }
          initState() {
            this.state = {
              type: "",
              token: "",
              match: [],
              all: [],
              index: -1,
              anchor: null,
            };
          }
          isShown() {
            return this.$container.hasClass("ty-show");
          }
          defaultSearchFuncWithoutExtract(e) {
            return this.defaultSearchFunc(e, !0);
          }
          defaultSearchFunc(e, t) {
            e = e.trim().toLowerCase();
            var n = [];
            return (
              this.state.all.map(function (t) {
                0 == t.toLowerCase().indexOf(e) && n.push(t);
              }),
              n.sort((e, t) => e.toLowerCase().localeCompare(t.toLowerCase())),
              t && 1 == n.length && n[0] == v
                ? (this.state.match = [])
                : (this.state.match = n),
              this.state.match
            );
          }
          apply(e) {
            var t = this.state.anchor,
              n = this.editor;
            (e = this.state.beforeApply ? this.state.beforeApply(e) : e),
              this.hide(),
              t &&
                (void 0 !== t.nodeType
                  ? function () {
                      "INPUT" == t.tagName
                        ? (t.value = e)
                        : t.hasAttribute("contenteditable") &&
                          (t.textContent = e),
                        t.focus(),
                        t.select
                          ? t.select()
                          : n.selection.selectAllElem(i(this.state.anchor)),
                        i(t).trigger("change");
                    }.call(this)
                  : void 0 !== t.start &&
                    function () {
                      if (n && e) {
                        var i = n.selection.buildUndo();
                        try {
                          n.brush.pause(),
                            i
                              ? (n.focusCid = i.id || i.startId)
                              : n.refocus(void 0, void 0, !0);
                          var a = t,
                            s = o.createRange(),
                            l = r.makeEmptyCommand(
                              i || n.selection.buildUndo()
                            ),
                            c = n.getNode(n.focusCid);
                          if (
                            (l.undo.push(r.buildReplaceUndo(c)),
                            s.moveToBookmark(a),
                            n.selection.deRange(s),
                            s.deleteContents(),
                            s.insertNode(document.createTextNode(e)),
                            (a.start = a.start += e.length),
                            (a.end = a.start),
                            n.store(n.focusCid, !0),
                            s.moveToBookmark(a),
                            l.redo.push(r.buildReplaceUndo(c)),
                            n.selection.setRange(s, !0),
                            l.redo.push(n.selection.buildUndo()),
                            n.undo.register(l),
                            "fences" == this.state.type)
                          ) {
                            var d = c.breakOn(!1, n);
                            n.findElemById(d.oldCid).replaceWith(d.newHtml),
                              n.selection.jumpIntoElemBegin(
                                n.findElemById(d.nextFocus)
                              ),
                              n.undo.register(d.command);
                          } else n.brush.addToQueue(n.focusCid, !0);
                        } catch (e) {
                          console.sendError(e);
                        }
                        n.brush.resume(!0);
                      }
                    }.call(this));
          }
          postScroll() {
            var e = this.state.anchor,
              t = this.$container;
            t &&
              t.length &&
              e &&
              (e.nodeType ? this.attachToDom(e) : this.initState());
          }
          show(e, t, n, i) {
            if (
              this.state.anchor &&
              this.state.anchor.start === t.start &&
              void 0 != t.start
            )
              return (this.state.anchor = t), void this.update(n);
            this.initState();
            var r = i || {},
              { render: o, search: a, type: s, beforeApply: l } = r;
            (this.state.all = this.state.match = e),
              (this.state.type = s || ""),
              (this.state.beforeApply = l),
              (this.render =
                o ||
                function (e, t) {
                  return (
                    "<li class='" +
                    (t ? "active" : "") +
                    "' data-content=\"" +
                    e.replace(/[']/g, "&quot;") +
                    '" > ' +
                    e +
                    "</span></li>"
                  );
                }),
              (this.search = a || this.defaultSearchFunc),
              this.$container.css("max-height", "none"),
              (this.state.anchor = t);
            var c = this.$container;
            c &&
              c.length &&
              t &&
              (t.nodeType && this.attachToDom(t),
              void 0 !== t.start && this.attachToRange(t),
              void 0 !== n && this.update(n));
          }
          attachToRange() {
            var e = this.$container;
            if (!this.isShown()) {
              var t = window.getSelection().getRangeAt(0).getClientRects()[0],
                n = document.querySelector("content").getBoundingClientRect(),
                r = t.left - 15;
              (r = r + 200 > window.innerWidth ? window.innerWidth - 200 : r),
                e
                  .css({
                    top:
                      t.bottom +
                      (window._shouldFixFontGlitch
                        ? i("content").scrollTop() - n.top
                        : 0),
                    left: r,
                    right: "auto",
                  })
                  .addClass("ty-show");
            }
          }
          attachToDom(e) {
            i(e)
              .off("input", this.onInput)
              .on("input", this.onInput)
              .off("keydown", this.onKeydown)
              .on("keydown", this.onKeydown)
              .on("blur", this.onBlur)
              .on("remove", function (e) {
                i(e.target).off();
              });
          }
          updateDom() {
            if (0 == this.state.match.length)
              this.$container.removeClass("ty-show");
            else {
              var { match: e, index: t, type: n } = this.state;
              if (
                (this.$container
                  .addClass("ty-show")
                  .html(
                    "<ul class='auto-suggest-for-" +
                      (n || "common") +
                      "'>%@</ul>".replace(
                        "%@",
                        e.map((e, n) => this.render(e, n == t)).join("")
                      )
                  ),
                "none" == this.$container.css("max-height"))
              ) {
                var i = this.$container.find("li")[0].clientHeight;
                (this.state.rowHeight = i),
                  this.$container.css("max-height", 5 * i + 12 + "px");
              }
            }
          }
          updateActive(e) {
            this.$container.find(".active").removeClass("active");
            var t = this.state.rowHeight;
            if (this.state.index >= 0) {
              var n,
                i = this.$container
                  .find("li:nth-child(" + (this.state.index + 1) + ")")
                  .addClass("active"),
                r = this.$container.scrollTop(),
                o = i[0].offsetTop;
              (o < r || o + t > 5 * t + r) &&
                ((n = this.$container[0].querySelector(
                  "li:nth-child(" + (e + 1) + ")"
                )),
                this.$container.scrollTop(n.offsetTop));
            }
          }
          update(e) {
            (this.state.token = e),
              (this.state.match = this.search(e)),
              this.state.match.length
                ? (this.state.index = Math.min(this.state.index, 0))
                : (this.state.index = -1),
              this.updateDom();
          }
          makeVisible() {
            if (
              this.state.anchor &&
              this.state.match.length &&
              !this.$container.hasClass("ty-show") &&
              void 0 !== this.state.anchor.nodeType
            ) {
              var e = this.state.anchor,
                t = e.getClientRects()[0];
              this.$container
                .css({
                  top: t.bottom + 6,
                  left: t.left,
                  minWidth: t.right - t.left + "px",
                })
                .addClass("ty-show"),
                this.update(e.value || e.textContent || "");
            }
          }
          hide() {
            this.$container.removeClass("ty-show");
          }
          handleKeyEvents(e) {
            var { index: t, match: n } = this.state,
              i = n.length;
            if (i && this.isShown())
              if (
                !e.shiftKey ||
                ("ArrowDown" != e.key &&
                  "ArrowUp" != e.key &&
                  "PageDown" != e.key &&
                  "PageUp" != e.key &&
                  "Home" != e.key &&
                  "End" != e.key)
              ) {
                if ("ArrowDown" == e.key)
                  return (
                    (this.state.index = t < 0 ? 0 : Math.min(t + 1, i - 1)),
                    this.updateActive(this.state.index),
                    !1
                  );
                if ("ArrowUp" == e.key) {
                  if (t < 0) return;
                  return (
                    (this.state.index = Math.max(t - 1, 0)),
                    this.updateActive(Math.max(this.state.index - 4, 0)),
                    !1
                  );
                }
                if ("PageDown" == e.key)
                  return (
                    (this.state.index = t < 0 ? 0 : Math.min(t + 5, i - 1)),
                    this.updateActive(this.state.index),
                    !1
                  );
                if ("PageUp" == e.key) {
                  if (t < 0) return;
                  return (
                    (this.state.index = Math.max(t - 5, 0)),
                    this.updateActive(Math.max(this.state.index - 4, 0)),
                    !1
                  );
                }
                if ("End" == e.key)
                  return (
                    (this.state.index = t < 0 ? 0 : i - 1),
                    this.updateActive(i - 1),
                    !1
                  );
                if ("Home" == e.key) {
                  if (t < 0) return;
                  return (this.state.index = 0), this.updateActive(0), !1;
                }
                if ("Enter" == e.key) {
                  if (this.state.index >= 0)
                    return this.apply(this.state.match[this.state.index]), !1;
                  this.hide();
                } else if ("Escape" == e.key) return this.hide(), !1;
              } else this.hide();
          }
        };
      }
    ),
    $__System.registerDynamic("2d", ["11"], !0, function (e, t, n) {
      this || self;
      var i = e("11");
      t.getImageScaleByElection = function (e) {
        if (!window.File || File.inBusyMode) return Promise.resolve(1);
        var t = reqnode("fs"),
          n = reqnode("url").parse,
          r = new Date();
        function o(e) {
          for (var t = 8; t < (e || []).length; ) {
            var n = t + 4,
              i = t + 8,
              o = t + 8 + e.readUInt32BE(t),
              a = o + 4,
              s = e.toString("ascii", n, i),
              l = e.slice(i, o);
            if ("pHYs" == s) {
              var c = l.readUInt32BE(0);
              return new Date(), Math.round(0.0254 * c) / 72 || 1;
            }
            if (new Date() - r > 1e3) return 1;
            t = a;
          }
          return 1;
        }
        function a(e) {
          for (var t, n = 0; n < e.length - 4; ) {
            var i = e[n],
              o = e[n + 1];
            if (((n += 2), 255 != i)) return 1;
            if (!t) {
              if ((t = 216 == o)) continue;
              return 1;
            }
            if (224 == o) {
              var a = n + 2 + 5 + 1 + 1;
              return 0 != e[a] && 1 != e[a]
                ? 1
                : Math.round(e.slice(a + 1, a + 1 + 2).readUInt16BE(0) / 72);
            }
            if (218 == o) return 1;
            if (new Date() - r > 1e3) return 1;
            n += e.slice(n, n + 2).readUInt16BE(0);
          }
          return 1;
        }
        return new Promise(function (r, s) {
          try {
            if (/^file:/.exec(e)) {
              (e = n(e).pathname), (e = i.decodeFromEscapedURL(e));
              var l = (/\.([^.\\\/]+)$/.exec(e) || [])[1] || "";
              t.readFile(e, function (e, t) {
                e || !t
                  ? r(1)
                  : "png" == l.toLowerCase()
                  ? r(o(t))
                  : ("jpg" != l.toLowerCase() && "jpeg" != l.toLowerCase()) ||
                    r(a(t));
              });
            } else
              /^https?:/.exec(e) &&
                JSBridge.invoke("url.request", e).then((t) => {
                  if (t) {
                    var s,
                      { type: l, data: c } = t;
                    l ||
                      ((e = n(e).pathname),
                      (e = i.decodeFromEscapedURL(e)),
                      (l = (/\.([^.\\\/]+)$/.exec(e) || [])[1] || "")),
                      /png/i.exec(l)
                        ? ((s = Buffer.concat(
                            c
                              .filter(function (e) {
                                return !!e;
                              })
                              .map(function (e) {
                                return Buffer.from(e);
                              })
                          )),
                          r(o(s)))
                        : /jpe?g/i.exec(l) &&
                          ((s = Buffer.from(c[0])), r(a(s)));
                  } else r(1);
                });
          } catch (e) {
            r(1);
          }
        });
      };
    }),
    $__System.registerDynamic(
      "2e",
      [
        "e",
        "13",
        "2f",
        "30",
        "31",
        "1b",
        "28",
        "11",
        "32",
        "2d",
        "33",
        "29",
        "34",
        "17",
      ],
      !0,
      function (e, t, n) {
        "use strict";
        var i,
          r = this || self,
          o = e("e"),
          a = e("13"),
          s = a.Node,
          l = a.TYPE,
          c = e("2f"),
          d = e("30"),
          u = e("31").rangy,
          h = e("1b"),
          p = h.SnapFlag,
          f = e("28"),
          m = e("11"),
          g = e("32"),
          v = e("2d"),
          y = e("33"),
          b = e("29"),
          w = (e("34"), e("17"), null),
          x = {},
          C = null,
          F = "typora-copy-images-to";
        function S(e) {
          return /(^[\\\/])|(^[a-zA-Z]:)/.exec(e);
        }
        function k(e, t, n) {
          if (n && e && t) {
            var i = n.clientHeight,
              r = n.clientWidth;
            i &&
              r &&
              (imagePreLoadAfterMove[
                "file://" + e.replace(/^file:\/\//, "").replace(/\\/g, "/")
              ] = { src: t, size: "height:" + i + "px;width:" + r + "px;" });
          }
        }
        function E(e, t) {
          return e.replace(
            /(]\s*\(<?)((?:\([^)]*\)|[^()])*?)(>?[ \t]*((['"])(.*?)\5[ \t]*)?\))/,
            "$1" + t + "$3"
          );
        }
        function T(e, t) {
          return /src\s*=\s*['"]/.exec(e)
            ? e.replace(/(src\s*=\s*(["'])).+?(\2)/i, "$1" + t + "$3")
            : e.replace(/(src\s*=\s*)([^\s'"]+)(\s|$)/i, '$1"' + t + '"$3');
        }
        function _(e) {
          e.removeClass("md-on-uploading").removeClass("md-on-moving"),
            e.find(".md-image-uploading-mask-wrapper").remove(),
            e.removeAttr("data-origin-path");
        }
        function A(e) {
          var t = o("[data-origin-path=" + JSON.stringify(e) + "]");
          return (
            uploadImageQueue.delete(e),
            moveImageQueue.delete(e),
            t.length && _(t),
            t
          );
        }
        function M(e) {
          var t = reqnode("path").extname(e),
            n = "-";
          return (
            /[\/\\]$/.exec(e) && ((t = ""), (n = "")),
            (e.replace(/(\.[^.\/\\]+?$)/, "") + n + m.tempString() + t).replace(
              /^\-/,
              ""
            )
          );
        }
        async function L(e) {
          var t = m.tempString(),
            n = File.isWin ? "\\" : "/",
            i = File.option.userDataPath + n + "runtime-storage" + n + t;
          if (!e || !File.option.userDataPath) return "";
          return File.isNode
            ? await (async function (e, t) {
                var n = reqnode("fs-extra");
                try {
                  await n.copy(e, t);
                } catch (e) {
                  return console.warn("failed to write temp image data", e), "";
                }
                return t;
              })(e, i)
            : File.isMac &&
              (await JSBridge.invoke("path.copyFile", { from: e, to: i }))
            ? i
            : void 0;
        }
        function N(e, t, n, i, r) {
          var o = d.applyUploadingStyle;
          if (e.length) {
            var a = e.find("img")[0];
            loadedImgCache.remove(m.wkfile2file(a.getAttribute("src") || "")),
              (a.onload = null);
          }
          return (
            this.editor.brush.clearAndPause(!0),
            window.moveImageQueue.add(n),
            o(e, n, !0, !0),
            this.editor.brush.resume(),
            (File.isMac
              ? function (e, t) {
                  if (((t = t.replace(/^file:\/\//, "")), !/^\w+:/.exec(t)))
                    try {
                      t = decodeURI(t);
                    } catch (e) {}
                  return new Promise(function (n, o) {
                    bridge.callHandler(
                      "images.copyImage",
                      {
                        src: t,
                        folder: e,
                        fileNameDefined: i || !1,
                        ignoreAlert: r || !1,
                      },
                      function (e) {
                        e.success ? n(e.msg) : o(e.msg);
                      }
                    );
                  });
                }
              : function (e, t) {
                  return new Promise(function (n, r) {
                    var o = reqnode("fs-extra"),
                      a = null;
                    function s(e, t, i) {
                      var a;
                      if (/^(http(s?))|(ftp):\/\//.exec(e))
                        !(function (e, t, n, i, r) {
                          var o = reqnode("path"),
                            a = o.dirname(t),
                            s = o.basename(r ? t : M(t));
                          JSBridge.invoke("app.download", e, a, s).then(
                            ({ path: e, state: o, type: a }) => {
                              var s = reqnode("fs"),
                                l = "";
                              function c() {
                                if (l) {
                                  var i = reqnode("path"),
                                    r = i.parse(t);
                                  ".jpg" != r.ext &&
                                    (t = i.join(r.dir, r.name + "." + l));
                                }
                                s.rename(e, t, (i) => {
                                  i ? console.sendError(i) : (e = t), n(e);
                                });
                              }
                              a &&
                                a.indexOf("image/") > -1 &&
                                (l = a.substr("image/".length)),
                                "completed" == o
                                  ? r
                                    ? e != t
                                      ? c()
                                      : n(e)
                                    : s.access(t, s.F_OK, function (t) {
                                        t ? c() : n(e);
                                      })
                                  : (console.error(o),
                                    i(
                                      o
                                        ? "Image download " + o
                                        : "unknown error for image download"
                                    ));
                            }
                          );
                        })(e, t, n, r, i);
                      else if ((a = /^data:image\/[^;]+;base64,/.exec(e))) {
                        var s = decodeURI(e.substr(a[0].length));
                        try {
                          s = decodeURI(s);
                        } catch (e) {}
                        o.writeFile(t, s, "base64", function (e) {
                          if (e)
                            return r("Failed to copy image\n." + e.message);
                          n(t);
                        });
                      } else {
                        try {
                          e = decodeURI(e);
                        } catch (e) {}
                        o.copy(e, t, { overwrite: i }, function (e) {
                          if (e)
                            return r(
                              "Failed to copy image\n." + (e.message || e)
                            );
                          n(t);
                        });
                      }
                    }
                    function l(e, t) {
                      o.access(t, o.F_OK, function (n) {
                        n || (t = M(t)), s(e, t, !1);
                      });
                    }
                    var c,
                      d = File.isWin ? "\\" : "/";
                    if (i) s(t, (a = e), !0);
                    else {
                      if (/^data:/.exec(t)) {
                        if (
                          !(c = (/^data:image\/([^;]+);base64,/.exec(t) ||
                            [])[1])
                        )
                          return n(t);
                        c = m.removeInvalidPathCh(
                          (function () {
                            var e = new Date();
                            e.setHours(
                              e.getHours() - e.getTimezoneOffset() / 60
                            );
                            var t = e.toUTCString();
                            return t.substr(0, t.length - 4);
                          })() +
                            "." +
                            c
                        );
                      } else
                        (c = g.getFileNameFromPath(t)),
                          (c = m.removeInvalidPathCh(
                            c.replace(/\?([^./]*)$/, "")
                          ));
                      (e = (e + d).replace(/[\/\\]{2}$/, d)),
                        (a = e + c),
                        window.imageDownloadMap[a] &&
                        window.imageDownloadMap[a] != t
                          ? (a = M(a))
                          : (window.imageDownloadMap[a] = t),
                        /^(https?|ftp):/.exec(t)
                          ? l(t, a)
                          : o.stat(t, (e, n) => {
                              e
                                ? r(
                                    "Failed to copy image\n." + (e.message || e)
                                  )
                                : n && n.isFile()
                                ? l(t, a)
                                : r(
                                    "Failed to copy image\n. Image src is not a file"
                                  );
                            });
                    }
                  });
                }
            )
              .call(this, t, n)
              .then(
                function (e) {
                  return e
                    ? (b.recordMediaMoves(e), L(e).then((t) => [e, t]))
                    : [];
                },
                function () {
                  A(n);
                }
              )
          );
        }
        function D(e, t) {
          return "picgo-app" == t
            ? (function (e) {
                try {
                  var t = JSON.parse(e);
                  return t.success ? t.result : [];
                } catch (e) {
                  return [];
                }
              })(e)
            : (function (e) {
                var t = e.split(/\r?\n/);
                console.sendLog("[Upload Result] " + e);
                for (var n = [], i = t.length - 1; i >= 0; i--) {
                  var r = t[i].trim();
                  if (r)
                    if (/^(https?|ftp|file):\//.exec(r)) n.unshift(r);
                    else if (
                      /^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}\/.*$/.exec(r)
                    )
                      n.unshift("http://" + r);
                    else if (n.length) break;
                }
                return n;
              })(e);
        }
        function B(e, t) {
          return (
            this.editor.brush.pause(),
            (t = m.absolutePathFrom(t)),
            window.uploadImageQueue.add(t),
            d.applyUploadingStyle(e, t, !1),
            this.editor.brush.resume(),
            function (e) {
              var t = this;
              return new Promise(function (n, i) {
                if (File.isMac) {
                  var r = t.getImageUploader();
                  bridge.callHandler(
                    "images.upload",
                    { command: t.getImageUploaderCommand(r), file: e },
                    function (e) {
                      var t;
                      e.success
                        ? "ipic" == r
                          ? n(e.msg)
                          : (t = D(e.msg, r))[t.length - 1]
                          ? n(t[t.length - 1])
                          : i(e.msg)
                        : i(e.msg);
                    }
                  );
                } else
                  File.isNode
                    ? R.call(t, [e])
                        .then((e) => {
                          n(e[0]);
                        })
                        .catch(i)
                    : i();
              });
            }.call(this, t)
          );
        }
        function R(e) {
          var t,
            n = this.getImageUploaderCommand();
          if (!n) return Promise.reject("Upload command not found.");
          return (
            "picgo-app" == n
              ? ((t = File.option.picgoAppPath),
                t
                  ? (function n(i) {
                      return window
                        .fetch("http://127.0.0.1:36677/upload", {
                          method: "POST",
                          body: JSON.stringify({ list: e }),
                        })
                        .then(
                          function (e) {
                            return 200 === e.status
                              ? e
                                  .json()
                                  .then((e) =>
                                    e.success
                                      ? (console.sendLog(
                                          "[Upload Result] " +
                                            JSON.stringify(e.result)
                                        ),
                                        e.result)
                                      : Promise.reject(JSON.stringify(e))
                                  )
                              : Promise.reject(e.text());
                          },
                          function (e) {
                            return i
                              ? Promise.reject(e.message || "failed")
                              : new Promise(function (e, i) {
                                  var r = setTimeout(() => {
                                    (r = null), n(!0).then(e, i);
                                  }, 5e3);
                                  window
                                    .reqnode("child_process")
                                    .exec(JSON.stringify(t), (e, t, n) => {
                                      r &&
                                        e &&
                                        (i(
                                          "failed to launch PicGo app: " +
                                            e.message
                                        ),
                                        clearTimeout(r));
                                    });
                                });
                          }
                        );
                    })(!1)
                  : Promise.reject(
                      "Please config path for PicGo (app) in preferences panel."
                    ))
              : new Promise((t, i) => {
                  reqnode("child_process").exec(
                    n + " " + m.escapeShell(e),
                    { maxBuffer: 2097152 },
                    (e, n, r) => {
                      if (e) return console.warn("exec error: " + e), void i(e);
                      n ? t(n) : (console.warn("error: " + r), i(r));
                    }
                  );
                })
          ).then((t) => {
            var i = "picgo-app" == n ? t : D(t, n);
            return i.length == e.length
              ? Promise.resolve(i)
              : (console.log(t),
                Promise.reject("fail to parse result image path from: " + t));
          });
        }
        function P(e, t, n) {
          var i = t;
          t = this.resolveImagePath(t);
          var r,
            a,
            s,
            c = this.editor;
          if (
            (c.undo.endSnap(!0),
            e.each(function (e, n) {
              if (n) {
                var i = n.querySelector(".md-content");
                if (i) {
                  s ||
                    ((r = c.selection.getRangy()),
                    (a = c.selection.buildUndo(r)),
                    (s = h.makeEmptyCommand(a)));
                  var d = i.textContent,
                    u =
                      n.getAttribute("md-inline") == l.imgtag
                        ? T(d, t)
                        : E(d, t),
                    p = o.extend({}, a),
                    f = u.length - d.length,
                    m = c.findNodeByElem(o(n).closest("[cid]"));
                  c.undo.endSnap(!0);
                  var g = n.querySelector(".md-content");
                  r &&
                    g &&
                    r.comparePoint &&
                    r.comparePoint(g, 1) < 0 &&
                    (p.start += f),
                    r &&
                      g &&
                      r.comparePoint &&
                      r.comparePoint(g, 2) < 0 &&
                      (p.end += f),
                    s.undo.push(h.buildReplaceUndo(m)),
                    (i.textContent = u),
                    c.store(m, !0);
                  var v = c.findElemById(m.cid);
                  c.brush.brushNode(m.cid),
                    v.removeClass("md-expand"),
                    c.undo.exeCommand(p),
                    (r = c.selection.getRangy()) &&
                      o(r.commonAncestorContainer).closest(".md-image")
                        .length &&
                      (p = c.imgEdit.selectComponent("alt", !0)),
                    s.redo.push(h.buildReplaceUndo(m)),
                    s.redo.push(p);
                } else p = this.editor.selection.buildUndo();
              }
            }),
            s && !n)
          ) {
            var d = c.undo.lastRegisteredOperationCommand();
            d && d.src === i ? h.append(d, s) : c.undo.register(s);
          }
          return s;
        }
        async function I(e, t, n, i, r) {
          e &&
            n &&
            t != n &&
            (e.undo.push({ type: "deleteMedia", from: n }),
            e.redo.unshift({ type: "restoreMedia", from: i, to: n }),
            r && S(t) && (await File.editor.imgEdit.deleteMedia(t, !0, e, i)));
        }
        function O(e, t, n, i, r, a) {
          var s = this;
          e &&
            e.length &&
            n &&
            N.call(this, e, t, n, i, !1).then(
              function (t) {
                if (t) {
                  var i = t[0],
                    r = t[1];
                  if (void 0 !== i) {
                    (e = A(n)), k(i, n, e.find("img")[0]);
                    var o = P.call(s, e, i, File.isTextBundle());
                    if (File.isTextBundle()) {
                      var l = s.editor.undo.lastRegisteredOperationCommand();
                      l && l.src === n
                        ? h.append(l, o)
                        : s.editor.undo.register(o);
                    }
                    I(o, n, i, r, a);
                  }
                }
              },
              function (t) {
                (e = A(n)),
                  t && console.error(t),
                  t &&
                    !r &&
                    setTimeout(function () {
                      f.showNotification(
                        o.localize.getString(
                          "Failed to Copy Image to Target Folder."
                        ) +
                          " <code>" +
                          m.escape(t) +
                          "</code>",
                        !0
                      );
                    }, 500);
              }
            );
        }
        (window.imgLastModified = Math.floor((new Date() - 0) / 1e3)),
          (window.uploadImageQueue = new Set()),
          (window.moveImageQueue = new Set()),
          (window.imagePreLoadAfterMove = {}),
          (window.imageDownloadMap = {});
        function $(e) {
          return !/^\s*(https?):/.exec(e);
        }
        var H = {};
        n.exports = class {
          constructor(e) {
            var t = this;
            function n() {
              File.editor.contextMenu.hide(),
                File.editor.contextMenu.restoreLastCursor();
            }
            (this.removeUploadingStyle = _),
              (this.editor = e),
              (this.uniqueFilePathOnNode = M),
              o(e.sessionStr)
                .on("mousemove", ".md-image>.md-meta", function (e) {
                  fastdom.measure(function () {
                    e.offsetX - e.target.offsetLeft < 20 && e.offsetY < 30
                      ? this.nextElementSibling &&
                        this.nextElementSibling.getAttribute("src").trim()
                          .length &&
                        fastdom.mutate(function () {
                          this.classList.add("md-show-hint");
                        }, this)
                      : fastdom.mutate(function () {
                          this.classList.remove("md-show-hint");
                        }, this);
                  }, this);
                })
                .on("mouseleave", ".md-image>.md-meta", function () {
                  fastdom.mutate(function () {
                    this.classList.remove("md-show-hint");
                  }, this);
                })
                .on("click", "img", function (t) {
                  var n = o(t.target)
                    .closest(".md-image")
                    .addClass("md-expand");
                  if (n.length) {
                    var i = u.createRange();
                    n.attr("md-inline") == l.imgtag
                      ? i.selectNodeContents(n.find(".md-meta")[0])
                      : i.moveToBookmark({
                          containerNode: n.children(".md-meta")[0],
                          start: 2,
                          end: 2 + (t.target.getAttribute("alt") || "").length,
                        }),
                      e.selection.setRange(i, !0);
                  }
                })
                .on("btn-action", ".md-image-input-src-btn", function (t) {
                  o("#ty-tooltip").hide();
                  var n = document.createRange();
                  n.setStart(this.parentElement, 0),
                    n.setEnd(this.parentElement, 0),
                    o(this).remove(),
                    e.selection.setRange(n, !0);
                })
                .on(
                  "click btn-action",
                  ".md-image-pick-file-btn",
                  function (e) {
                    return o("#ty-tooltip").hide(), t.insertLocalImage(), !1;
                  }
                )
                .on("cursorChange", function (t, n) {
                  (n && -1 != n.style.inline.indexOf("image")) ||
                    !document.querySelector("#user-context-menu.show") ||
                    e.contextMenu.hide("#user-context-menu");
                }),
              o(".context-menu")
                .on("click", "[data-key='select-img-target'] a", function () {
                  n(), t.copyToSelectedFolderAction();
                })
                .on(
                  "click",
                  "[data-key='select-img-target-move'] a",
                  function () {
                    n(), t.copyToSelectedFolderAction(!0);
                  }
                )
                .on("click", "[data-key='delete-img'] a", function () {
                  n(), t.deleteImageAction(!1);
                })
                .on("click", "[data-key='delete-img-file'] a", function () {
                  n(), t.deleteImageAction(!0);
                })
                .on("click", "[data-key='upload-img'] a", function () {
                  n(), t.uploadAction();
                })
                .on("click", "[data-key='copy-img-to-target'] a", function () {
                  n(), t.copyToTargetFolderAction();
                })
                .on("click", "[data-key='move-img-to-target'] a", function () {
                  n(), t.copyToTargetFolderAction(!0);
                })
                .on("click", "[data-key='copy-img'] a", function () {
                  n(), t.copyImage();
                })
                .on(
                  "click",
                  "[data-key='reveal-img-in-finder'] a",
                  function () {
                    n(), t.revealInFinder();
                  }
                )
                .on(
                  "click",
                  "[data-key='reveal-img-in-browser'] a",
                  function () {
                    n(), t.revealInFinder();
                  }
                )
                .on("click", "[data-key='zoom-smart'] a", function () {
                  n();
                  var e = o(".md-expand.md-img-loaded");
                  e && t.zoomAction(e, this.getAttribute("data-variable"));
                })
                .on("click", "[data-key='zoom-img'] a", function () {
                  o(this.parentElement).trigger("mouseenter");
                }),
              this.registerBridge();
          }
          registerBridge() {
            if (File.isMac) {
              var e = this;
              bridge.registerHandler(
                "images.fetchImageLocalStorageFolder",
                function (t, n) {
                  n(e.getTargetImageStorageFolder() || null);
                }
              ),
                bridge.registerHandler(
                  "images.allImageUploadCallback",
                  function (t, n) {
                    e.allImageUploadCallbackForMac(
                      t.command,
                      t.success,
                      t.message,
                      t.updateMap,
                      t.sources
                    ),
                      n && n();
                  }
                ),
                bridge.registerHandler(
                  "images.tagetImageStorageFolderExcludeSetting",
                  function (t, n) {
                    n && n(e.getTargetImageStorageFolder(!0));
                  }
                ),
                bridge.registerHandler(
                  "images.doSetImageCopyToFolder",
                  function (t, n) {
                    e.doSetImageCopyToFolder(t), n && n();
                  }
                ),
                bridge.registerHandler(
                  "images.doSetImageCopyToIPic",
                  function (t, n) {
                    e.doSetImageCopyToFolder("upload", !0), n && n();
                  }
                ),
                bridge.registerHandler(
                  "images.doRemoveImageCopyToFolder",
                  function (t, n) {
                    e.doRemoveImageCopyToFolder(), n && n();
                  }
                ),
                bridge.registerHandler(
                  "images.doSetImageRootPath",
                  function (t, n) {
                    e.doSetImageRootPath(t), n && n();
                  }
                ),
                bridge.registerHandler(
                  "images.prepareUploadAllImagesOnMac",
                  function (t, n) {
                    e.prepareUploadAllImagesOnMac(n);
                  }
                ),
                bridge.registerHandler("images.insertImage", function (e, t) {
                  var n = b.insertURL(e);
                  t && t(n);
                }),
                bridge.registerHandler("images.zoomImage", function (t, n) {
                  var i = e.zoomAction(null, t);
                  n && n(i);
                }),
                bridge.registerHandler("images.switchSyntax", function (t, n) {
                  e.switchPattern(null, t);
                }),
                bridge.registerHandler(
                  "images.copyAllImages",
                  function ([t, n], i) {
                    e._copyAllImages(t, n), i && i();
                  }
                );
            }
          }
          getLocalRootUrlForInsert() {
            return (
              this.editor.docMenu.getLocalRootUrl() ||
              (File.option.useRelativePathForImg &&
                g.getCurrentFileFolderPath()) ||
              ""
            );
          }
          getSrcFromDom(e, t) {
            return e
              ? e.dataset.isDataSrc && e.querySelector("img")
                ? e.querySelector("img").getAttribute("src")
                : t
                ? this.getAbsolutePath(e.dataset.src)
                : e.dataset.src
              : "";
          }
          getAbsolutePath(e, t) {
            if (!e) return e;
            var n = m.absolutePathFrom(this.getRealSrc(e));
            if (t) {
              if (!/^[a-z]+:/i.exec(n)) return "file://" + n;
            } else
              (!/^https?:/.exec(n) || /^data?:/.exec(n) || /^file?:/.exec(n)) &&
                (n = m.decodeFromEscapedURL(n));
            return n;
          }
          getRealSrc(e, t, n, i) {
            if (!e) return e;
            e = m.decodeFromEscapedPath(e);
            var r = (/#[^.\/\\]+$/.exec(e) || [])[0] || "";
            if (/^data:/.exec(e)) return e;
            if (/^\/\//.exec(e)) return "http:" + e;
            function o(e) {
              return (
                (e = (e = encodeURI(e).replace(/%5C/g, "\\"))
                  .replace(/#[^.\/\\]+$/, "")
                  .replace(/#/g, "%23")),
                n && (e += r),
                e
              );
            }
            function a(e) {
              if (!i || !y.shouldManageResource(e)) return e;
              var t = File.isWin ? "\\" : "/",
                n = File.bundle.filePath + t + "assets" + t,
                r = m.trimPathParam(e.substring(n.length)),
                a = y.deletedAssetsMap();
              return a[r]
                ? (reqnode("fs-extra").copy(
                    a[r],
                    e,
                    { errorOnExist: !1 },
                    () => {
                      var t = a[r];
                      delete a[r],
                        document
                          .querySelectorAll(`[src^="file://${o(t)}"]`)
                          .forEach((t) => {
                            t.src = o(e);
                          });
                    }
                  ),
                  a[r])
                : ((File.bundle.unusedAssets || []).remove(r), e);
            }
            try {
              if (/^(file|ftp|https?):(\/\/|\\\\)/gi.exec(e)) return e;
              if (t)
                return o(
                  (function (e) {
                    if (/^(wk)?file:/.exec(e))
                      return "file://" + a(m.absolutePathFrom(e));
                  })(e)
                );
              var s = /^((\/)|(\/\/)|(\\\\)|([a-z]+\:[\\\/]))/i,
                l = this.editor.docMenu.getLocalRootUrl();
              if (File.isNode) {
                var c = reqnode("path");
                return (l && !File.isTextBundle()) || !s.exec(e)
                  ? o(
                      "file://" +
                        a(
                          c.resolve(
                            l || g.getCurrentFileFolderPath() || "",
                            e.replace(/^\s*(\\\\|\/)/, "")
                          )
                        )
                    )
                  : o("file://" + a(e).replace(/^[\/\\]+/, "/"));
              }
              return !l && s.exec(e)
                ? o(
                    (function (e) {
                      return /[a-z]+:/.exec(e)
                        ? e
                        : "file://" + g.normalizePath(e);
                    })(a(e || ""))
                  )
                : o(
                    a(
                      (function (e, t) {
                        return (
                          "file://" +
                          g.normalizePath(
                            e.replace(/^file:\/\//, "").replace(/\/$/, "") +
                              "/" +
                              t.replace(/^\//gi, "")
                          )
                        );
                      })(l || g.getCurrentFileFolderPath() || "", e || "")
                    )
                  );
            } catch (e) {}
            return e;
          }
          updateImgRef(e) {
            var t = this.editor.brush.inline;
            o("[data-ref='" + m.escapeSelector(e) + "']").each(function () {
              var e = (this.querySelector(".md-content") || {}).textContent;
              void 0 !== e && o(this).replaceWith(t.output(e));
            });
          }
          willUpdateImgRef(e) {
            e &&
              (C && clearTimeout(C),
              (x[e] = !0),
              (w = w || new Date()),
              new Date() - w > 200
                ? setTimeout(
                    function () {
                      Object.keys(x).map(this.updateImgRef, this);
                    }.bind(this),
                    10
                  )
                : (C = setTimeout(
                    function () {
                      Object.keys(x).map(this.updateImgRef, this);
                    }.bind(this),
                    300
                  )));
          }
          startBusyImageLoader() {
            if (window.IntersectionObserver) {
              var e = [];
              this.intersectionObserver = new IntersectionObserver(function (
                t
              ) {
                var n;
                (e = []),
                  t.forEach((t) => {
                    t.intersectionRatio <= 0
                      ? (function (t) {
                          let {
                            naturalHeight: n,
                            naturalWidth: i,
                            height: r,
                          } = t;
                          if (!t.dataset.realSrc) {
                            var o = null;
                            if (n * i > 5e5 && r > 0) {
                              let s = `data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${i} ${n}"%3E%3C/svg%3E`;
                              (o = [t, t.src, s]),
                                a(t.style.height) ||
                                a(t.getAttribute("height")) ||
                                a(t.style.width) ||
                                a(t.getAttribute("width"))
                                  ? ((t.dataset.fixedSize = !0), o.push(0))
                                  : o.push(r),
                                e.push(o);
                            }
                          }
                          function a(e) {
                            return e && "auto" != e;
                          }
                        })(t.target)
                      : (n = t.target).dataset.realSrc &&
                        ((n.src = n.dataset.realSrc),
                        (n.dataset.realSrc = ""),
                        n.dataset.fixedSize || n.removeAttribute("height"),
                        (n.dataset.fixedSize = ""));
                  }),
                  e.forEach((e) => {
                    (e[0].dataset.realSrc = e[1]),
                      (e[0].src = e[2]),
                      e[3] && e[0].setAttribute("height", e[3]);
                  }),
                  (e = []);
              });
            }
          }
          tryAddImageToBusyLoader(e) {
            if (!File.isMac) return;
            if (e.dataset.realSrc) return;
            const { src: t, naturalHeight: n, naturalWidth: i } = e;
            this.intersectionObserver || this.startBusyImageLoader(),
              this.intersectionObserver &&
                (/^file:/.exec(t) && n * i > 2e5
                  ? this.intersectionObserver.observe(e)
                  : this.intersectionObserver.unobserve(e));
          }
          async deleteMedia(e, t, n, i) {
            var r = i || (await L(e));
            if (!n || r) {
              b.recordMediaMoves(null, [r, e]),
                n &&
                  (n.redo.push({ type: "deleteMedia", from: e }),
                  n.undo.unshift({ type: "restoreMedia", from: r, to: e }));
              try {
                if (t && (await JSBridge.invoke("shell.trashItem", e))) return;
                File.isNode && (await reqnode("node:fs/promises").unlink(e)),
                  File.isMac && (await JSBridge.invoke("path.delete", e));
              } catch (e) {
                console.warn(e);
              }
            } else
              console.error(
                "Failed to prepare undo / redo for image move / delete"
              );
          }
          restoreMedia(e, t) {
            if (e)
              try {
                b.recordMediaMoves(t);
                var n = this;
                File.isNode
                  ? reqnode("fs-extra").copySync(e, t)
                  : JSBridge.invoke("path.copyFile", { from: e, to: t }).then(
                      function (t) {
                        if (t) {
                          var i = n.getRealSrc(e, !0, !1);
                          o(".md-image.md-img-error img").each(function () {
                            0 == this.src.indexOf(i) &&
                              n.refreshLocalImgDom(this);
                          });
                        }
                      }
                    );
              } catch (e) {}
          }
          refreshLocalImgDom(e, t, n) {
            var i = function (e) {
              e.target.removeAttribute("width"),
                e.target.removeAttribute("height"),
                e.target.removeEventListener("load", i),
                e.target.removeEventListener("error", i);
            };
            t = t || Math.floor((new Date() - 0) / 1e3);
            var r = (e.parentElement || e).dataset.src || e.dataset.src;
            if (!n || e.parentElement.classList.contains("md-img-error")) {
              var o = this.getRealSrc(r);
              if (o && /^file:/.exec(o)) {
                if (
                  (failImgCache.remove(o),
                  m.fromExternalPath(o) &&
                    ((o = m.file2wkfile(o)), failImgCache.remove(o)),
                  "SOURCE" === e.tagName)
                ) {
                  this.editor.htmlBlock.resetVideoDom(e.parentElement),
                    e.setAttribute("src", o);
                  var a = e.parentElement.parentElement;
                  if (a) {
                    var s = e.parentElement.previousSibling,
                      l = e.parentElement.outerHTML;
                    e.parentElement.remove(),
                      setTimeout(() => {
                        s
                          ? s.insertAdjacentHTML("afterend", l)
                          : a.insertAdjacentHTML("afterbegin", l);
                      }, 0);
                  }
                  return;
                }
                !e.width &&
                  !e.height &&
                  ("VIDEO" === e.tagName ? e.readyState > 2 : e.complete) &&
                  e.clientWidth &&
                  ((e.width = e.clientWidth),
                  (e.height = e.clientHeight),
                  e.addEventListener("load", i),
                  e.addEventListener("error", i)),
                  e.setAttribute("src", o + "?lastModify=" + t),
                  "IMG" === e.tagName &&
                    e.parentElement.dataset.src &&
                    ((e.dataset.localRefresh = !0),
                    (e.onload = onImageLoadedFunc),
                    (e.onerror = onImageErrorFunc)),
                  "VIDEO" === e.tagName &&
                    this.editor.htmlBlock.resetVideoDom(e);
              }
            }
          }
          refreshLocalImg(e) {
            if (e || !File.inBusyMode) {
              e && ((window.failImgCache = []), (window.loadedImgCache = []));
              var t = Math.floor((new Date() - 0) / 1e3),
                n = this,
                i = o(".md-image img"),
                r = 0,
                a = !1;
              if (!e) {
                const e = 1e7;
                i.each(function () {
                  r > e ||
                    (r += (this.naturalHeight || 0) * (this.naturalWidth || 0));
                }),
                  (a = r > e);
              }
              i.each(function () {
                n.refreshLocalImgDom(this, t, a);
              }),
                (imgLastModified = t),
                a ||
                  o(
                    ".md-htmlblock-container video, .md-htmlblock-container img, .md-htmlblock-container source"
                  ).each(function () {
                    n.refreshLocalImgDom(this, t, a);
                  });
            }
          }
          async reloadAllByNode() {
            await JSBridge.invoke("webContents.clearCache"),
              this.refreshLocalImg(!0);
          }
          updateLocalRootUrl() {
            var e = this.editor.docMenu.getLocalRootUrl() || "";
            if (this.editor.localRootUrl != e) {
              for (
                var t = document.querySelectorAll("[md-inline='image']"), n = 0;
                n < t.length;
                n++
              ) {
                var i = (c = t[n]).querySelector("img"),
                  r = c.getAttribute("data-src");
                if (r && r != i.getAttribute("src")) {
                  var s = o.parseHTML(
                    d.decorate({
                      type: a.TYPE.image,
                      markdown: c.textContent,
                      alt: i.getAttribute("alt"),
                      href: r,
                    })
                  )[0];
                  c.parentElement.replaceChild(s, c);
                }
              }
              var l = document.querySelectorAll("[data-ty-watch-src]");
              for (n = 0; n < l.length; n++) {
                var c,
                  u = (c = l[n]).dataset.src;
                c.getAttribute("src") != u &&
                  ((c.src = this.getAbsolutePath(u, !0)),
                  "VIDEO" == c.tagName &&
                    this.editor.htmlBlock.resetVideoDom(c));
              }
            }
          }
          selectComponent(e, t) {
            this.editor.undo.endSnap(!0);
            var n = this.editor.selection.getRangy(),
              i = o(n.startContainer).closest("[md-inline='image']"),
              r = i.text(),
              a = n.getBookmark(i[0]),
              s = r.indexOf("]"),
              l = h.makeEmptyCommand(this.editor.selection.buildUndo());
            if (!a.containerNode) return this.editor.selection.buildUndo();
            "alt" === e
              ? ((a.start = 1), (a.end = s))
              : e
              ? ((a.start = s + 2), (a.end = r.length - 1))
              : ((a.start = 2), (a.end = s)),
              n.moveToBookmark(a),
              this.editor.selection.setRange(n, !0);
            var c = this.editor.selection.buildUndo();
            return l.redo.push(c), !t && this.editor.undo.register(l), c;
          }
          prepareUploadAllImagesOnMac(e) {
            var t = this;
            this.validateBeforeUpload().then((n) => {
              if (n) {
                var i = t.getImageUploader(),
                  r = t.getImageUploaderCommand(i);
                if (r) {
                  "upic" == i && r.replace("-u", "-s -u");
                  var a = t.buildImageMap();
                  e([!0, a, r]),
                    a.length ||
                      f.showNotification(
                        o.localize.getString("No local images found.", "Panel"),
                        void 0,
                        void 0,
                        void 0,
                        !0
                      );
                } else e([!0, [], ""]);
              } else e([!1, [], ""]);
            });
          }
          buildImageMap(e, t) {
            (H = {}), (e = e || $);
            for (
              var n,
                i,
                r = document.querySelectorAll(".md-image.md-img-loaded"),
                o = r.length,
                a = 0;
              a < o;
              a++
            )
              if (
                ((n = r[a]),
                (i = this.getRealSrc(n.dataset.src)),
                e((i = (i = m.absolutePathFrom(i)).replace(/^file:\/\//, ""))))
              ) {
                if (t) return !0;
                (H[i] = H[i] || []), H[i].push(n);
              }
            return !t && Object.keys(H);
          }
          allImageUploadCallbackForMac(e, t, n, i, r) {
            if ("ipic" == e) this.replaceImageMap(i, t, n, e);
            else {
              if (!t) return void this.showError(n, "Failed to upload images:");
              var o = D(n, e);
              o.length == r.length
                ? ((i = {}),
                  r.forEach((e, t) => {
                    i[e] = o[t];
                  }),
                  this.replaceImageMap(i, !0, n, e))
                : this.showError(
                    n,
                    "Failed to fetch {0} images from: ".replace("{0}", r.length)
                  );
            }
          }
          replaceImageMap(e, t, n, i) {
            var r = h.makeEmptyCommand(this.editor.selection.buildUndo()),
              a = this.editor,
              c = new Set(),
              d = 0,
              u = 0;
            a.undo.endSnap(!0),
              Object.keys(e).forEach(function (t) {
                if (H[t]) {
                  u++;
                  var n = e[t];
                  n != t
                    ? H[t].forEach(function (e) {
                        (e.querySelector("img").src = n),
                          m.fromExternalPath(n) &&
                            (e.querySelector("img").src = m.file2wkfile(n)),
                          e.hasAttribute("data-src") &&
                            e.setAttribute("data-src", n);
                        var t,
                          i,
                          d = a.findNodeByElem(o(e).closest("[cid]")),
                          u = e.getAttribute("md-inline");
                        if (
                          (!c.has(d) &&
                            s.isType(u, l.image, l.imgtag) &&
                            (c.add(d), r.undo.push(h.buildReplaceUndo(d))),
                          (t = e.querySelector(".md-content").textContent),
                          u == l.image)
                        )
                          (i = E(t, n)),
                            (e.querySelector(".md-content").textContent = i);
                        else if (u == l.imgtag)
                          (i = T(t, n)),
                            (e.querySelector(".md-content").textContent = i);
                        else if (u == l.refimg) {
                          var p =
                              /^!\[((?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*)\]\s*\[([^\]]*)\]/.exec(
                                t
                              ),
                            f = (p[2] || p[1]).replace(/\s+/g, " "),
                            g = a.nodeMap.link_list.getNodeByRef(f);
                          if (c.has(g)) return;
                          c.add(g),
                            r.undo.push(h.buildReplaceUndo(g)),
                            g.set("href", n),
                            a.findElemById(g.cid).replaceWith(g.toHTML());
                        }
                      })
                    : d++;
                }
              }),
              c.forEach(function (e) {
                e.get("type") !== l.def_link && a.store(e, !0),
                  r.redo.push(h.buildReplaceUndo(e));
              }),
              r.redo.push(a.selection.buildUndo()),
              a.undo.register(r);
            var p = Object.keys(H).length;
            (H = {}),
              t
                ? f.showNotification(
                    o.localize
                      .getString("Successfully uploaded {0} images.")
                      .format(u),
                    !1,
                    o.localize.getString("Undo"),
                    function () {
                      a.undo.undo();
                    }
                  )
                : u
                ? ("upic" == i && (u -= d),
                  f.showNotification(
                    o.localize
                      .getString(
                        "Successfully uploaded {0} images, {1} failed."
                      )
                      .format(u, p - u) +
                      " " +
                      m.truncate(n, 600),
                    !1,
                    o.localize.getString("Undo"),
                    function () {
                      a.undo.undo();
                    }
                  ))
                : this.showError(n, "Failed to upload images:");
          }
          insertLocalImage() {
            function e(e) {
              e && 0 != e.length && b.insertURLs(e);
            }
            File.isLocked ||
              (File.isNode
                ? JSBridge.invoke("dialog.showOpenDialog", {
                    filters: [
                      {
                        name: "Images",
                        extensions: [
                          "png",
                          "jpg",
                          "jpeg",
                          "bmp",
                          "svg",
                          "tiff",
                          "webp",
                          "gif",
                        ],
                      },
                    ],
                    properties: ["openFile", "multiSelections"],
                    buttonLabel: "Select",
                  }).then(({ filePaths: t }) => {
                    e(t);
                  })
                : File.isMac &&
                  window.bridge.callHandler("images.insertLocalImage", e));
          }
          shouldTriggerMove(e, t) {
            return (
              void 0 === t && (t = this.getTargetImageStorageFolder(!1, !0)),
              !(
                "upload" == t &&
                "upload" != this.getTargetImageStorageFolderFromSetting() &&
                !this.checkAutoUploadIsAllowed(!0, !0)
              ) &&
                !!e &&
                (/^\s*(https?|ftp):\/\//.exec(e)
                  ? File.isTextBundle() || File.option.applyImageMoveForWeb
                  : !(
                      (!File.isTextBundle() &&
                        !File.option.applyImageMoveForLocal) ||
                      /^data:/.exec(e) ||
                      (0 == e.indexOf(t) &&
                        !e.substring(t.length + 1).match(/[\\\/]/g))
                    ))
            );
          }
          tryMoveImageDom(e, t, n) {
            this.tryMoveImageDoms([e[0]], t, n);
          }
          tryMoveImageDoms(e, t, n) {
            if (t && e.length) {
              var i = (function (e, t) {
                const n = {};
                return (
                  e.forEach((e) => {
                    const i = t(e),
                      r = n[i];
                    r ? r.push(e) : (n[i] = [e]);
                  }),
                  n
                );
              })(e, (e) => this.getSrcFromDom(e, !0));
              for (var r in i)
                if (this.shouldTriggerMove(r, t)) {
                  var a = o(i[r]);
                  "ipic" == t || "upload" == t
                    ? this.uploadAction(a, !0)
                    : O.call(this, a, t, r, void 0, n);
                }
            }
          }
          prepImageMove(e, t) {
            var n = this;
            return new Promise(function (i, r) {
              if (t) return i();
              function a(e) {
                e && alert(e.message || e), r();
              }
              if (
                (void 0 === e && (e = n.getTargetImageStorageFolder()),
                "upload" == e)
              )
                return i();
              if (!e) return i();
              if (File.isMac)
                bridge.callHandler(
                  "images.prepImageMove",
                  {
                    folder: e,
                    silent: e == n.getTargetImageStorageFolderFromSetting(),
                  },
                  function (e) {
                    "success" != e ? a(e) : i();
                  }
                );
              else {
                var s = reqnode("fs-extra"),
                  l = !1;
                n.getTargetImageStorageFolder(!0) && (l = !File.isTextBundle()),
                  (function (e, t) {
                    var n = reqnode("fs-extra");
                    return new Promise(function (i, r) {
                      if (!t) return i();
                      n.stat(e, function (t) {
                        if (!t) return i();
                        if ("ENOENT" != t.code) return r(t.message);
                        var n = o("#image-create-folder-confirm")
                          .find("#image-create-folder-target")
                          .text(e)
                          .end()
                          .modal({ backdrop: "static", keyboard: !1 });
                        (File.isLocked = !0),
                          n
                            .off(
                              "mousedown",
                              ".image-create-folder-dialog-yes, .image-create-folder-dialog-no, .image-create-folder-dialog-help, .close"
                            )
                            .one(
                              "mousedown",
                              ".image-create-folder-dialog-yes",
                              function () {
                                n.modal("hide"),
                                  (File.isLocked = !1),
                                  File.freshMenu(),
                                  i();
                              }
                            )
                            .one(
                              "mousedown",
                              ".image-create-folder-dialog-no",
                              function () {
                                n.modal("hide"),
                                  (File.isLocked = !1),
                                  File.freshMenu(),
                                  r(!1);
                              }
                            )
                            .one("mousedown", ".close", function () {
                              n.modal("hide"),
                                (File.isLocked = !1),
                                File.freshMenu(),
                                r(!1);
                            })
                            .on(
                              "mousedown",
                              ".image-create-folder-dialog-help",
                              function () {
                                const e = File.option.useMirrorInCN
                                  ? "typoraio.cn"
                                  : "typora.io";
                                JSBridge.showInBrowser(
                                  `https://support.${e}/Images/`
                                );
                              }
                            );
                      });
                    });
                  })(e, l).then(function () {
                    s.ensureDir(e, function (e) {
                      e ? a(e) : i();
                    });
                  }, a);
              }
            });
          }
          tryMoveImageInRange(e, t) {
            var n = this.editor,
              i = this.getTargetImageStorageFolder();
            if (i) {
              this.editor.brush.clearAndPause();
              var r = e.getNodes([document.ELEMENT_NODE], function (e) {
                return (
                  "image" == e.getAttribute("md-inline") ||
                  "imgtag" == e.getAttribute("md-inline")
                );
              });
              if (!r.length && e) {
                var o = e.commonAncestorContainer.parentElement;
                o &&
                  "image" == o.getAttribute("md-inline") &&
                  (r = [e.commonAncestorContainer.parentElement]);
              }
              r.length &&
                this.prepImageMove(i).then(
                  function () {
                    n.imgEdit.tryMoveImageDoms(r, i, t);
                  },
                  () => {}
                ),
                this.editor.brush.resume();
            }
          }
          generateAlt(e) {
            return (g.getFileNameFromPath(e, !0) || "").replace(
              /(^\.)|(\.[^.]+$)/g,
              ""
            );
          }
          insertImageFromURL(e) {
            var t = e;
            function n() {
              return File.editor.imgEdit.generateAlt(e);
            }
            function i() {
              var e = window.getSelection(),
                t = "";
              return (
                !File.editor.sourceView.inSourceMode &&
                  e.startOffset > 0 &&
                  (t = " "),
                t
              );
            }
            function r(e, t) {
              var r = this.editor,
                a = r.getMarkElem();
              if (!a.length || !r.stylize.canContainInline(a)) return !1;
              c.backspaceHandler(r, null, "delSelection");
              var s,
                l = n(),
                d = i(),
                u = r.getNode(a.attr("cid")),
                p = File.isTextBundle() ? e : this.resolveImagePath(e),
                f = d + "![" + l + "](" + p + ")",
                m = r.selection.getRangy();
              if (!m) return null;
              if (
                (s = o(m.startContainer).closest("[md-inline='image']")).length
              )
                return (
                  (t ? window.uploadImageQueue : window.moveImageQueue).add(e),
                  !File.isTextBundle() && P.call(this, s, e),
                  this.selectComponent("alt", File.isTextBundle()),
                  (m = r.selection.getRangy()),
                  (s = o(m.startContainer).closest("[md-inline='image']")).attr(
                    "data-src",
                    p
                  ),
                  s
                );
              var g = m.getBookmark(a[0]).start,
                v = h.makeEmptyCommand();
              v.undo.push(r.selection.buildUndo()),
                c.insertInlineText(r, u, f, g, v, !0),
                (v.src = e);
              var y = r.findElemById(u.cid);
              return (
                r.brush.brushNode(u.cid),
                y.removeClass("md-expand"),
                m.moveToBookmark({
                  containerNode: y[0],
                  start: g + f.length,
                  end: g + f.length,
                }),
                (s = o(m.startContainer).closest(".md-image"))
                  .find("img")
                  .attr("src", "file://" + e),
                r.undo.register(v),
                window.getSelection(),
                s
              );
            }
            e = File.isTextBundle() ? e : this.resolveImagePath(e);
            var a,
              s = t,
              l = this,
              d = this.editor,
              u = this.getTargetImageStorageFolder(!1, !0);
            if (
              (function () {
                var r,
                  a = n(),
                  s = i(),
                  l = d.selection.getRangy();
                l &&
                (r = o(l.startContainer).closest("[md-inline='image']"))
                  .length &&
                !(function (e) {
                  if (
                    e.startContainer.parentElement.classList.contains(
                      "md-image-after-src"
                    ) &&
                    e.startContainer.textContent.length == e.startOffset
                  )
                    return !0;
                })(l)
                  ? (P.call(this, r, t), this.selectComponent("alt"))
                  : (c.pasteHandler(
                      this.editor,
                      s + "![" + a + "](" + e + ")",
                      !0,
                      !0
                    ),
                    (this.editor.undo.lastRegisteredOperationCommand().src =
                      t));
              }.call(this),
              this.shouldTriggerMove(s, u) && u)
            )
              if ("upload" == u)
                l.editor.brush.clearAndPause(),
                  (a = r.call(l, s, !0)),
                  l.uploadAction(a),
                  l.editor.brush.resume();
              else if (u)
                return (
                  (s = g.normalizePath(s)),
                  this.editor.brush.clearAndPause(),
                  (a = r.call(this, s)),
                  l.prepImageMove(u, File.isMac).then(
                    function () {
                      O.call(l, a, u, s);
                    },
                    () => {
                      A(s);
                    }
                  ),
                  void this.editor.brush.resume()
                );
          }
          doInsertVideoFromURL(e) {
            var t = '<video src="{url}"></video>'.replace("{url}", e);
            c.pasteHandler(this.editor, t, !1);
          }
          doInsertAudioFromURL(e) {
            var t = '<audio src="{url}"></audio>'.replace("{url}", e);
            c.pasteHandler(this.editor, t, !1);
          }
          resolveImagePath(e) {
            if (/^\/\//.exec(e)) return "https://" + e;
            if (/^data:/.exec(e)) return e;
            if (/^[^:]+:\/\//.exec(e)) return e;
            if (!e) return e;
            function t(e) {
              return File.option.autoEscapeImageURL ? m.escapeURL(e) : e;
            }
            var n = this.getLocalRootUrlForInsert(),
              i = g.getCurrentFileFolderPath();
            if (File.isTextBundle())
              (e = m.getRelativePath(n, e, !1, !1)),
                !n || ("/" != e[0] && "\\" != e[0]) || (e = e.substring(1));
            else if (n && n.length) {
              var r = m.getRelativePath(
                n,
                e,
                !1,
                File.option.relativePathWithDot
              );
              n == i && (r = r.replace(/^\s*(\\\\|\/)/, "")),
                (e =
                  (!r.match(/^\.[\/\\]/) &&
                  this.editor.docMenu.getLocalRootUrl()
                    ? "/"
                    : "") + r);
            } else {
              if (
                !File.option.useRelativePathForImg ||
                !i ||
                0 !== e.indexOf(i)
              )
                return t(e);
              (e = e.substring(i.length).replace(/^\//, "").replace(/\\/, "/")),
                File.option.relativePathWithDot && (e = "./" + e);
            }
            return File.isWin && (e = e.replace(/[\/\\]{1,2}/g, "/")), t(e);
          }
          getImageUploaderCommand(e) {
            var t,
              n = (i = i || {
                ipic: "ipic",
                "picgo-app": "picgo-app",
                upic: "/Applications/uPic.app/Contents/MacOS/uPic -o url -u",
                picsee: "/Applications/Picsee.app/Contents/MacOS/Picsee -u",
                "picgo-cli": File.isNode
                  ? ((t =
                      JSON.stringify(
                        _options.userDataPath +
                          "/picgo/" +
                          (File.isWin
                            ? "x64" == r.process.arch
                              ? "win64"
                              : "win32"
                            : "linux") +
                          "/picgo" +
                          (File.isWin ? ".exe" : "")
                      ) + " u"),
                    File.isWin && (t = "chcp 65001| " + t),
                    t)
                  : null,
              })[e || File.option.imageUploader || ""];
            return (
              n ||
                "custom" !== File.option.imageUploader ||
                (n = (File.option.customImageUploader || "")
                  .replace("${filepath}", File.bundle.filePath || "")
                  .replace(
                    "${filename}",
                    (File.getFileName() || "").replace(/\.[^.\/\\]+$/, "")
                  )),
              n || ""
            );
          }
          getImageUploader() {
            var e =
              this.editor.localSettingBridge &&
              this.editor.localSettingBridge.getSetting(F);
            return e &&
              !File.editor.sourceView.inSourceMode &&
              "ipic" == e.toLowerCase()
              ? "ipic"
              : "custom" == File.option.imageUploader
              ? this.getImageUploaderCommand(File.option.imageUploader)
              : File.option.imageUploader;
          }
          isFixedImageStorageFolder() {
            function e(e) {
              if (e) return m.isAbsolutePath(e);
            }
            if (File.isTextBundle()) return !1;
            var t =
              (this.editor.localSettingBridge &&
                this.editor.localSettingBridge.getSetting(F)) ||
              "";
            return t
              ? e(t)
              : File.option.defaultImageStorage
              ? e(File.option.defaultImageStorage)
              : void 0;
          }
          assetsFolderForTextBundle() {
            var e = File.isWin ? "\\" : "/";
            return this.editor.docMenu.getLocalRootUrl() + e + "assets";
          }
          getTargetImageStorageFolder(e, t) {
            var n =
              this.editor.localSettingBridge &&
              this.editor.localSettingBridge.getSetting(F);
            if (File.isTextBundle()) return this.assetsFolderForTextBundle();
            if (n && !File.editor.sourceView.inSourceMode) {
              if (
                (File.option.allowImageUpload || t) &&
                ("ipic" == n.toLowerCase() || "upload" == n.toLowerCase())
              )
                return "upload";
              var i = g.getCurrentFileFolderPath();
              if (i)
                return (
                  /[\\/]$/.exec(i[i.length - 1]) || (i += "/"),
                  g.normalizePath(
                    i +
                      n.replace(
                        /\${filename}/g,
                        (File.getFileName() || "").replace(/\.[^.\/\\]+$/, "")
                      ),
                    !0
                  )
                );
            }
            return e ? null : this.getTargetImageStorageFolderFromSetting();
          }
          getTargetImageStorageFolderFromSetting() {
            if (
              "ipic" == File.option.defaultImageStorage ||
              "upload" == File.option.defaultImageStorage
            )
              return "upload";
            var e = g.getCurrentFileFolderPath();
            if (this.cachedFileImageStorage) return this.cachedFileImageStorage;
            var t = File.option.defaultImageStorage;
            if (
              (e && (/[\\/]$/.exec(e[e.length - 1]) || (e += "/")),
              "folder" == t)
            ) {
              if (e)
                return (
                  (this.cachedFileImageStorage = g.normalizePath(
                    e.replace(/[\\/]$/, ""),
                    !0
                  )),
                  this.cachedFileImageStorage
                );
            } else if ("assert" == t) {
              if (e)
                return (
                  (this.cachedFileImageStorage = g.normalizePath(
                    e + "assets",
                    !0
                  )),
                  this.cachedFileImageStorage
                );
            } else if ("per-file-assert" == t) {
              if (e)
                return (
                  (this.cachedFileImageStorage = g.normalizePath(
                    e +
                      File.getFileName().replace(/\.[^.\/\\]+$/, "") +
                      ".assets",
                    !0
                  )),
                  this.cachedFileImageStorage
                );
            } else if (t && !s.isType(t, "upload")) {
              var n = File.getFileName();
              if (t.indexOf("${filename}") > -1) {
                if (!n) return null;
                t = t.replace(/\${filename}/g, n.replace(/\.[^.\/\\]+$/, ""));
              }
              (File.isWin ? /^[^\/\\]+:[\/\\]/.exec(t) : /^[\\\/]/.exec(t))
                ? (this.cachedFileImageStorage = g.normalizePath(t, !0))
                : e &&
                  (this.cachedFileImageStorage = g.normalizePath(e + t, !0));
            }
            return this.cachedFileImageStorage || "";
          }
          async moveToTextbundleByNode(e, t) {
            const n = File.isWin ? "\\" : "/";
            var i = e + n + "assets";
            const r = reqnode("path"),
              o = reqnode("fs-extra"),
              a = r.basename(t || "").replace(/^\..+$/, "");
            async function s(e, t) {
              await File.editor.imgEdit.deleteMedia(t, !0, e);
            }
            var l = this.buildImageMap(),
              c = await this._copyAllImages(i, !0),
              d = await (async function () {
                for (
                  var e = r.dirname(t), n = await o.readdir(e), i = 0, a = 0;
                  a < n.length;
                  a++
                )
                  if (
                    (File.SupportedTextFiles.indexOf(g.getExtension(n[1])) >
                      -1 && i++,
                    i > 1)
                  )
                    return null;
                return e;
              })(),
              u = l.filter(
                (e) =>
                  !(
                    0 == e.indexOf(i + File.isWin ? "\\" : "/") ||
                    !S(e) ||
                    (0 === r.dirname(e).indexOf(n + a)
                      ? (s(c, e), 1)
                      : d && 0 === e.indexOf(e + n) && (s(c, e), 1))
                  )
              );
            u.length &&
              u.forEach(function (e) {
                s(c, e);
              });
          }
          async onFileMoved(e, t) {
            if (
              ((this.cachedFileImageStorage = void 0),
              this.editor.localSettingBridge)
            ) {
              var n = this,
                i = this.getTargetImageStorageFolder();
              t !== i &&
                t &&
                i &&
                m.pathByDeleteLastComponent(t) ==
                  m.pathByDeleteLastComponent(e) &&
                n.buildImageMap(r, !0) &&
                (await (async function (e) {
                  try {
                    if (File.isNode) {
                      var t = reqnode("node:fs/promises");
                      if (await t.stat(e)) return !0;
                    } else if (File.isMac)
                      return await JSBridge.invoke("shell.isFolder", e);
                  } catch (e) {
                    return !1;
                  }
                })(t)) &&
                (await (async function () {
                  var e = m.getFolder(i),
                    t = File.getMountFolder();
                  0 == i.lastIndexOf(t) && (e = i.substr(t.length + 1));
                  var r = o.localize
                    .getString(
                      "Would you like to update image references and move image files to %@ ?",
                      "Panel"
                    )
                    .replace("%@", e);
                  return await n.shouldContinue(
                    r,
                    "noWarningForUpdateImageReference"
                  );
                })()) &&
                (await this._copyAllImages(i, !0, r, !0),
                (async function (e) {
                  if (File.isNode)
                    try {
                      var t = reqnode("node:fs/promises");
                      await t.rmdir(e, { recursive: !1, force: !1 });
                    } catch (e) {}
                  else
                    File.isMac &&
                      (await JSBridge.invoke("shell.removeIfEmpty", e));
                })(t));
            }
            function r(e) {
              return (
                0 ==
                e.indexOf(t.replace(/[\\\/]$/, "") + (File.isWin ? "\\" : "/"))
              );
            }
          }
          revealInFinder() {
            var e = o(".md-expand img").attr("src") || "";
            if (/^(wk)?file:/.exec(e)) {
              var t = m.absolutePathFrom(e);
              JSBridge.showInFinder(t);
            } else /^https?:/.exec(e) && JSBridge.showInBrowser(e);
          }
          async copyImage() {
            var e = o(".md-expand.md-img-loaded");
            if (e) {
              var t = this.getSrcFromDom(e[0], !0);
              File.isNode &&
                (await (async function () {
                  var n,
                    { clipboard: i, nativeImage: r } = reqnode("electron");
                  (n = /^https?:/.exec(t)
                    ? r.createFromBuffer(
                        Buffer.from(await (await fetch(t)).arrayBuffer())
                      )
                    : r.createFromPath(t)),
                    i.writeText(t);
                  var o = (e.find("img")[0] || {}).outerHTML;
                  o && i.writeHTML(o),
                    /\.gif/.exec(t)
                      ? i.writeImage(r.createFromBuffer(n.toBitmap()))
                      : i.writeImage(n);
                })()),
                File.isMac &&
                  (await (async function () {
                    var n = {};
                    if (/\.svg$/.exec(t)) {
                      var i = (e.find("img")[0] || {}).outerHTML;
                      i && (n["text/html"] = i),
                        (n["image/svg+xml"] = await (await fetch(t)).text());
                    }
                    bridge.callHandler("clipboard.writeImage", {
                      otherData: n,
                      path: t,
                    });
                  })());
            }
          }
          moveImageTo_(e, t, n, i, r) {
            O.call(this, e, t, n, i, !1, r);
          }
          async deleteImageAction(e) {
            var t = o(".md-expand.md-img-loaded");
            if (t) {
              var n = this.editor,
                i = this.getSrcFromDom(t[0], !0);
              n.selection.selectAllElem(t);
              var r = c.backspaceHandler(n, null, "delSelection", !1, !1);
              if (r && r == n.undo.lastRegisteredOperationCommand()) {
                if (e && S(i)) {
                  if (
                    !File.isTextBundle() &&
                    !(await this.shouldContinue(
                      "Delete original image file?",
                      "noWarningForDeleteImage"
                    ))
                  )
                    return;
                } else e = !1;
                await this.deleteMedia(i, !0, r);
              }
            }
          }
          async shouldContinue(e, t) {
            if (File.option[t]) return !0;
            var { response: n, checkboxChecked: i } = await f.showWarningDialog(
              o.localize.getString(e),
              !0
            );
            return (
              0 == n &&
              (i &&
                (JSBridge.execForAll(
                  "window.File && File.option && (File.option." + t + " = true)"
                ),
                JSBridge.putSetting(t, !0)),
              !0)
            );
          }
          async copyToSelectedFolderAction(e) {
            var t = o(".md-expand.md-img-loaded");
            if (t) {
              var n,
                i = this.getSrcFromDom(t[0], !0),
                r = g.getFileNameFromPath(i, !0);
              if (/^data:/.exec(i)) {
                var a = (/^data:[\\\/]*image\/([^;]+)/.exec(i) || [])[1];
                (r = t.find("img").attr("alt") || new Date() + ""),
                  a && (r = r + "." + a);
              }
              if (e && S(i)) {
                if (
                  !(await this.shouldContinue(
                    "Move image will delete the image file at original path, are you sure to continue?",
                    "noWarningForMoveImage"
                  ))
                )
                  return;
              } else e = !1;
              (n = File.isMac
                ? await JSBridge.invoke("images.selectImageSavePath", {
                    defaultName: (e ? i : r) || "",
                    absolutePath:
                      i ||
                      File.editor.imgEdit.cachedFileImageStorage ||
                      File.mountFolder_ ||
                      "",
                  })
                : (
                    await JSBridge.invoke("dialog.showSaveDialog", {
                      title: o.localize.getString(
                        "Copy and update image source to…",
                        "Panel"
                      ),
                      defaultPath: (e || File.isLinuxSnap ? i : r) || "",
                      properties: ["showOverwriteConfirmation"],
                    })
                  ).filePath) &&
                n != i &&
                this.moveImageTo_(t, n, i, !0, e);
            }
          }
          async copyToTargetFolderAction(e) {
            this.editor.brush.clearAndPause();
            var t = o(".md-expand.md-img-loaded");
            if (t) {
              var n = this.getSrcFromDom(t[0], !0),
                i = this.getTargetImageStorageFolder(),
                r = this;
              if (e && S(n)) {
                if (
                  !(await r.shouldContinue(
                    "Move image will delete the image file at original path, are you sure to continue?",
                    "noWarningForMoveImage"
                  ))
                )
                  return;
              } else e = !1;
              n &&
                this.prepImageMove(i, File.isMac).then(
                  function () {
                    r.moveImageTo_(t, i, n, void 0, e);
                  },
                  () => {}
                ),
                this.editor.brush.resume();
            }
          }
          switchPattern(e, t, n, i) {
            if (!(e = e || o(".md-expand.md-img-loaded"))) return !1;
            var r,
              a = e.find("img");
            if (i) {
              var s = e.closest("[cid]").attr("cid");
              this.editor.undo.addSnap(s, p.NONE);
            }
            var c,
              u = {
                type: t ? l.imgtag : l.image,
                title: a.attr("title"),
                alt: a.attr("alt"),
                src: e.attr("data-src"),
              },
              h = e.attr("md-inline");
            if (t) {
              if (h == l.imgtag) return !1;
              var f = document.createElement("img");
              return (
                f.setAttribute("src", u.src),
                u.alt && f.setAttribute("alt", u.alt),
                u.title && f.setAttribute("title", u.title),
                (u.markdown = f.outerHTML
                  .replace(/<\/img>$/, "")
                  .replace(/\s*>$/, " />")
                  .replace(/&amp;/g, "&")),
                (c = d.decorateImage(u, u.markdown, u.src)),
                (r = o(c)),
                e.replaceWith(r),
                i &&
                  ((s = e.closest("[cid]").attr("cid")),
                  this.editor.undo.addSnap(s, p.NONE)),
                [u, r]
              );
            }
            if (h == l.image) return !1;
            if (h == l.imgtag && n)
              for (var m = /(\w+)\s*=\s*(["']).+?\2/g; m.exec(void 0); )
                if (!["src", "title", "alt"].exec((void 0)[1].toLowerCase()))
                  return !1;
            var g = [
              "![" + u.alt.replace(/]/g, "") + "](",
              u.src,
              (u.title ? JSON.stringify(title) : "") + ")",
            ];
            return (
              (u.markdown = g.join("")),
              (c = d.decorateImage(u, u.markdown, u.src, g)),
              (r = o(c)),
              e.replaceWith(r),
              i && this.editor.undo.addSnap(s, p.REPLACE),
              [u, r]
            );
          }
          ensureOneImg(e) {
            if ((e = e || o(".md-expand.md-img-loaded")))
              return 1 == e.length
                ? e
                : (this.editor.brush.expand(!0, !0, !0),
                  o(".md-expand.md-img-loaded"));
          }
          addStyle(e, t, n) {
            if ((e = this.ensureOneImg(e))) {
              var i = e.closest("[cid]").attr("cid");
              if (
                (this.editor.undo.addSnap(i, p.NONE),
                n || e.attr("md-inline") == l.imgtag)
              ) {
                var r,
                  a = e.find("img");
                if (e.attr("md-inline") != l.imgtag) {
                  var s = this.switchPattern(e, !0, !1, !0);
                  s && ((r = s[0]), (e = s[1]));
                } else
                  r = {
                    type: l.imgtag,
                    title: a.attr("title"),
                    alt: a.attr("alt"),
                    src: e.attr("data-src"),
                    markdown: e.text(),
                  };
                var c = document.createElement("img"),
                  u = !1;
                (r.markdown = r.markdown.replace(
                  /(style\s*=\s*)(['"])(.*?)\2/,
                  function (e, i, r, o) {
                    c.setAttribute("style", o || ""),
                      (u = !0),
                      (c.style[t] = n);
                    var a = c.getAttribute("style");
                    return a ? i + JSON.stringify(a) : "";
                  }
                )),
                  u ||
                    (r.markdown = r.markdown
                      .replace(/(\s*\/?>)/, ' style="' + t + ":" + n + ';" $1')
                      .replace(/\s+\/>$/, " />"));
                var h = d.decorateImage(r, r.markdown, r.src),
                  f = o(h);
                e.replaceWith(f),
                  f.find("img").click(),
                  this.editor.undo.addSnap(i, p.REPLACE);
              }
            }
          }
          zoomAction(e, t) {
            (e = e || o(".md-expand.md-img-loaded")) &&
              this.addStyle(e, "zoom", "100%" == t ? "" : t);
          }
          quickUploadValidation(e) {
            var t = this.getImageUploader();
            if (t) return t;
            if (e) {
              var n = o.localize.getString(
                "Please set an image uploader in Preferences panel before using this function.",
                "Panel"
              );
              File.isMac
                ? bridge.callHandler("controller.showErrorDialog", n)
                : f.showDialog({ message: n });
            }
            return !1;
          }
          validateBeforeUpload() {
            var e = this;
            return new Promise(function (t) {
              var n = e.quickUploadValidation(!0);
              n
                ? File.isMac && "ipic" == n
                  ? bridge.callHandler("images.iPicValidateBeforeUpload", t)
                  : t(!0)
                : t(!1);
            });
          }
          uploadAction(e, t) {
            if ((e = e || o(".md-expand.md-img-loaded"))) {
              var n = this;
              this.validateBeforeUpload().then((i) => {
                var r = m.absolutePathFrom(n.getRealSrc(e.attr("data-src")));
                if (!i) return A(r), void _(e);
                B.call(n, e, r).then(
                  function (i) {
                    t || k(i, r, e), (e = A(r)), P.call(n, e, i);
                  },
                  function (t) {
                    (e = A(r)),
                      P.call(n, e, r),
                      t &&
                        setTimeout(function () {
                          n.showError(t);
                        }, 500);
                  }
                );
              });
            }
          }
          showError(e, t) {
            e = e.message || e;
            var n = t || "Failed to upload image. Error Message:";
            f.showNotification(
              `${o.localize.getString(
                n
              )} <code style='font-size:0.8em'>${m.escape(
                m.truncate(e, 600)
              )}</code>`,
              !0,
              o.localize.getString("Learn More", "Panel"),
              function () {
                const e = File.option.useMirrorInCN
                  ? "typoraio.cn"
                  : "typora.io";
                JSBridge.showInBrowser(`https://support.${e}/Upload-Image/`);
              }
            );
          }
          async _copyAllImages(e, t, n, i, r, a) {
            var s = this;
            if (
              e &&
              (!t ||
                i ||
                (await s.shouldContinue(
                  "Move image will delete the image file at original path, are you sure to continue?",
                  "noWarningForMoveImage"
                )))
            ) {
              var l,
                c,
                d = r
                  ? Object.keys(H)
                  : this.buildImageMap(function (t) {
                      return (
                        0 != t.indexOf(e + File.isWin ? "\\" : "/") &&
                        (!n || n(t))
                      );
                    }),
                u = [],
                p =
                  _options.userDataPath +
                  (File.iwWin ? "\\" : "/") +
                  "typora-user-images";
              f.hideNotification();
              try {
                await Promise.all(
                  d.map((t) =>
                    N.call(s, o(H[t]), e, t, !1, !0).then(([e, n]) => {
                      u.push([t, e, n]);
                    })
                  )
                ),
                  (c = Promise.all(
                    u.map((e) => {
                      var [n, i, r] = e;
                      if (void 0 !== i) {
                        var o = A(n);
                        k(i, n, o.find("img")[0]);
                        var c = P.call(s, o, i, !0);
                        l ? h.append(l, c) : (l = c);
                        var d = t;
                        return (
                          a && (d = t || 0 == n.indexOf(p)), I(l, n, i, r, d)
                        );
                      }
                    })
                  ).then(function () {
                    return l;
                  }));
              } catch (e) {
                console.error(e);
              }
              if (l) {
                this.editor.undo.register(l);
                var g = t ? "Images moved to %@." : "Images copied to %@.",
                  v = o.localize
                    .getString(g, "Panel")
                    .replace("%@", `<code>${m.getFolder(e)}</code>`);
                a && (v = o.localize.getString("Images saved to TextBundle")),
                  a || f.showNotification(v, !0),
                  await c;
              }
            }
          }
          moveAllImages() {
            return this.copyAllImages(!0);
          }
          async copyAllImages(e) {
            var t = this.getTargetImageStorageFolder();
            if (File.isNode) {
              var n = ((
                await JSBridge.invoke("dialog.showOpenDialog", {
                  defaultPath: t,
                  title: o.localize.getString("Select Container Folder"),
                  properties: ["openDirectory", "createDirectory"],
                  buttonLabel: o.localize.getString("Select"),
                })
              ).filePaths || [])[0];
              this._copyAllImages(n, e);
            } else
              bridge.callHandler("images.startCopyAllImages", [t, e || !1]);
          }
          uploadAllImages() {
            if (this.quickUploadValidation(!0)) {
              var e = this.buildImageMap(),
                t = this;
              R.call(this, e)
                .then((n) => {
                  f.hideNotification();
                  var i = {};
                  e.forEach((e, t) => {
                    i[e] = n[t];
                  }),
                    t.replaceImageMap(i, !0);
                })
                .catch((e) => {
                  t.showError(e, "Failed to upload images:");
                }),
                Object.keys(e).length
                  ? (f.hideNotification(),
                    f.showProcessingNotification(
                      o.localize.getString("Uploading in progress…", "Panel")
                    ))
                  : f.showNotification(
                      o.localize.getString("No local images found.", "Panel"),
                      void 0,
                      void 0,
                      void 0,
                      !0
                    );
            }
          }
          contextMenuItems(e) {
            var t = (e.getAttribute("src") || "").replace(/\?(.+)$/, ""),
              n = [],
              i = !e.closest(".md-img-error"),
              r = this.getTargetImageStorageFolder();
            r &&
              "upload" != r &&
              (r = r.replace(/[\\\/]$/, "") + (File.isWin ? "\\" : "/"));
            var o = m.escapeURL(r);
            if (
              r &&
              "upload" != r &&
              (0 != t.replace(/^file:\/\//, "").indexOf(o) ||
                t
                  .replace(/^file:\/\//, "")
                  .substring(o.length + 1)
                  .match(/[\\\/]/g))
            ) {
              var a = m.getFolder(r);
              a && n.push("copyImgToTarget-" + a.replace(/\|/g, ""));
            }
            var s = /^(wk)?file:\/\//.exec(t);
            i &&
              (n.push("copyImgToSelect"),
              s &&
                (a && n.push("moveImgToTarget-" + a.replace(/\|/g, "")),
                n.push("moveImgToSelect")),
              "upload" == r ? n.unshift("uploadImg") : n.push("uploadImg"),
              n.push("copyImg")),
              s
                ? n.unshift("revealImgInFinder")
                : /^https?:\/\//.exec(t) && n.unshift("revealImgInBrowser");
            var l = e.getAttribute("data-pixel-ratio");
            return (
              l &&
                1 != (l -= 0) &&
                n.push("zoomImgTo-" + m.floatToPercent(1 / l)),
              n.push("zoomImg"),
              e.closest("[md-inline='image']") && n.push("imgSyntaxMarkdown"),
              e.closest("[md-inline='imgtag']") && n.push("imgSyntaxHTML"),
              s ? n.push("deleteImgFile") : n.push("deleteImg"),
              n
            );
          }
          afterUserInsertImage(e) {
            var t = (e.getAttribute("src") || "").replace(/\?(.+)$/, "");
            if (
              t != this.lastUrl &&
              e.parentElement &&
              e.parentElement.contains(window.getSelection().anchorNode)
            ) {
              var n = [],
                i = this.editor,
                r = e.getAttribute("data-pixel-ratio"),
                a = (e) => 1 != (e = (e || 1) - 0) && e != 1 / 0 && !isNaN(e);
              if (
                (r
                  ? a((r -= 0)) &&
                    n.push({
                      label: "Zoom Image to %@",
                      key: "zoom-smart",
                      variable: m.floatToPercent(1 / r),
                    })
                  : File.isMac
                  ? bridge.callHandler(
                      "images.getScale",
                      t.replace(/^wkfile:/, "file:"),
                      function (t) {
                        a(t) &&
                          (e.setAttribute("data-pixel-ratio", t),
                          n.splice(n.length - 1, 0, {
                            label: "Zoom Image to %@",
                            key: "zoom-smart",
                            variable: m.floatToPercent(1 / t),
                          }),
                          d());
                      }
                    )
                  : File.isNode &&
                    v
                      .getImageScaleByElection(t, e.nativeHeight)
                      .then(function (t) {
                        a(t) &&
                          (e.setAttribute("data-pixel-ratio", t),
                          n.splice(n.length - 1, 0, {
                            label: "Zoom Image to %@",
                            key: "zoom-smart",
                            variable: m.floatToPercent(1 / t),
                          }),
                          d());
                      }),
                !File.isTextBundle())
              ) {
                var s = this.getTargetImageStorageFolder();
                if (s && "upload" != s) {
                  (s = s.replace(/[\\\/]$/, "") + (File.isWin ? "\\" : "/")),
                    (t = m.absolutePathFrom(t));
                  var l,
                    c = m.escapeURL(s);
                  0 != t.replace(/[\\]/g, "/").indexOf(c) ||
                  t.substring(c.length + 1).match(/[\\\/]/g)
                    ? (l = m.getFolder(s)) &&
                      n.push({
                        label: "Copy to %@",
                        key: "copy-img-to-target",
                        variable: l,
                      })
                    : (this.lastUrl = t);
                }
                n.push({ label: "Copy Image to…", key: "select-img-target" }),
                  l &&
                    n.push({
                      label: "Move to %@",
                      key: "move-img-to-target",
                      variable: l,
                    }),
                  n.push({
                    label: "Rename or Move Image to…",
                    key: "select-img-target-move",
                  }),
                  !File.isTextBundle() &&
                    this.quickUploadValidation() &&
                    ("upload" == s
                      ? n.unshift({ label: "Upload Image", key: "upload-img" })
                      : n.push({ label: "Upload Image", key: "upload-img" }));
              }
              n.push({
                label: "Zoom Image",
                key: "zoom-img",
                hasExtraMenu: !0,
              }),
                n.length && d();
            }
            function d() {
              var e = i.selection.getRangy(),
                t = o(e.endContainer).closest("[md-inline='image']");
              e &&
                t.length &&
                !t.hasClass("md-on-moving") &&
                !t.hasClass("md-on-uploading") &&
                ((i.lastCursor = i.selection.buildUndo(e)),
                i.contextMenu.showCustom(n, "image"));
            }
          }
          toggleUploadForFile() {
            if ("upload" == this.getTargetImageStorageFolder(!0))
              this.doRemoveImageCopyToFolder(!1);
            else if (this.quickUploadValidation(!0)) {
              if (File.isNode && !this.checkAutoUploadIsAllowed(!0)) return;
              this.doSetImageCopyToFolder("upload", !0);
            }
          }
          checkAutoUploadIsAllowed(e, t) {
            if (File.option.allowImageUpload) return !0;
            if (e) {
              if (t && File.option.noWarnigUploadDisabled) return !1;
              f.showNativeDialog({
                message: o.localize
                  .getString(
                    "The option `%@` must be enabled first to automatically upload images.",
                    "Panel"
                  )
                  .replace(
                    "%@",
                    o.localize.getString(
                      "Allow upload images automatically based on YAML settings",
                      "Panel"
                    )
                  ),
                buttons: [
                  o.localize.getString(
                    "Enable this feature on preferences panel",
                    "Panel"
                  ),
                  o.localize.getString("Close"),
                ],
                checkbox: t
                  ? o.localize.getString("Do not show this again", "Panel")
                  : null,
                callback: function (e, t) {
                  0 === e &&
                    (File.isNode
                      ? File.megaMenu.highlight("image-setting-group")
                      : bridge.callHandler(
                          "setting.showAndHighlight",
                          "image-setting-group"
                        )),
                    t &&
                      (JSBridge.putSetting("noWarnigUploadDisabled", !0),
                      JSBridge.execForAll(
                        "File.option.noWarnigUploadDisabled = true;"
                      ));
                },
              });
            }
            return !1;
          }
          toggleCopyToFolder() {
            var e = this,
              t = this.getTargetImageStorageFolder(!0),
              n = g.getCurrentFileFolderPath();
            if (
              (File.refreshImageCopyStatus(!0),
              !File.isLocked && !File.editor.sourceView.inSourceMode)
            )
              if (t) this.doRemoveImageCopyToFolder(!1);
              else {
                if (!n)
                  return void JSBridge.invoke("dialog.showMessageBox", {
                    title: o.localize.getString(
                      "Document must be saved first.",
                      "Panel"
                    ),
                    message: o.localize.getString(
                      "Typora will copy newly inserted image to folder by selected relative path, so please save the file first.",
                      "Panel"
                    ),
                    defaultId: 0,
                    cancelId: 0,
                    buttons: [o.localize.getString("OK")],
                  });
                JSBridge.invoke("dialog.showOpenDialog", {
                  defaultPath: g.getCurrentFileFolderPath(),
                  title: o.localize.getString("Select Container Folder"),
                  properties: ["openDirectory", "createDirectory"],
                  buttonLabel: o.localize.getString("Select"),
                }).then(({ filePaths: t }) => {
                  t && 0 != t.length && e.doSetImageCopyToFolder(t[0]);
                });
              }
          }
          toggleUseImageRootPath() {
            var e = this.editor.docMenu.getLocalRootUrl(),
              t = this.editor;
            e
              ? this.editor.docMenu.removeProperty("typora-root-url")
              : JSBridge.invoke("dialog.showOpenDialog", {
                  defaultPath: g.getCurrentFileFolderPath(),
                  title: o.localize.getString("Select Container Folder"),
                  properties: ["openDirectory", "createDirectory"],
                  buttonLabel: o.localize.getString("Select"),
                }).then(({ filePaths: e }) => {
                  e && 0 != e.length && t.imgEdit.doSetImageRootPath(e[0]);
                });
          }
          doSetImageCopyToFolder(e, t) {
            (e = t
              ? "upload"
              : m.getRelativePath(g.getCurrentFileFolderPath(), e, !0)),
              this.editor.docMenu.writeProperty(F, e);
          }
          doSetImageRootPath(e) {
            this.editor.docMenu.writeProperty(
              "typora-root-url",
              m.getRelativePath(g.getCurrentFileFolderPath(), e, !0)
            );
          }
          doRemoveImageCopyToFolder(e) {
            return this.editor.docMenu.removeProperty(F, e);
          }
        };
      }
    ),
    $__System.registerDynamic(
      "35",
      ["11", "1d", "26", "20", "19", "13", "30", "28"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("1d"),
          o = e("26"),
          a = e("20"),
          s = (e("19"), e("13")),
          l = e("30"),
          c = e("28"),
          d = s.Node,
          u = s.TYPE,
          h = 5e3;
        var p = null;
        function f(e) {
          return c.markRange(e, "md-search-hit");
        }
        function m(e) {
          try {
            if (e) {
              var t = e.initPos;
              if (!t && e.curSelection)
                if (e.curSelection.isCm) t = e.curSelection;
                else {
                  var n = r.createRange(),
                    i = e.curSelection;
                  if (!i.parentElement) return;
                  n.selectNode(i),
                    (i = $(i).closest("[cid]")[0]) && (t = n.getBookmark(i)),
                    t && (t.cid = i.getAttribute("cid"));
                }
              return t || null;
            }
          } catch (e) {}
          return null;
        }
        n.exports = class {
          constructor(e) {
            (this.editor = e),
              (this.curSel = null),
              this.searchTimer,
              (this.caseSensitive = File.option.caseSensitive),
              (this.wholeWord = File.option.wholeWord),
              (this.useRegexp = File.option.useRegexp),
              this.bindEvents(),
              (this.MAX_HITS_COUNT = h);
          }
          bindEvents() {
            var e,
              t = this,
              n = !1,
              i = o.map;
            !File.isMac &&
              !File.isNode &&
              o("command+f, ctrl+f", function (e) {
                t.showPanel(), e.preventDefault();
              }),
              !File.isMac &&
                !File.isNode &&
                o("command+h, ctrl+h", function (e) {
                  t.showPanel(!0), e.preventDefault();
                }),
              $(document.body)
                .on("keydown", function (e) {
                  if ("Escape" == e.key && t.isOpen())
                    return t.closePanel(), !1;
                })
                .on("mouseup", ".md-search-hit", function () {
                  t.closePanel(!1, $(this));
                })
                .on("mouseup", ".cm-search-hit", function (e) {
                  var n = $(e.target).closest(".CodeMirror")[0].CodeMirror,
                    i = a.posFromMouse(n, e),
                    r = n.indexFromPos(i),
                    o = t.searchStatus.hits.find(function (e) {
                      return e.isCm == n && e.start <= r && e.end >= r;
                    });
                  if ((t.closePanel(!0), o))
                    return (
                      n.doc.setSelection(
                        n.posFromIndex(o.start),
                        n.posFromIndex(o.end)
                      ),
                      !1
                    );
                })
                .on("mouseup", ".CodeMirror", function (e) {
                  t.closePanel(!0);
                }),
              $("#md-searchpanel")
                .on("blur", function () {
                  t.closePanel();
                })
                .on("click", ".close-btn", function () {
                  t.closePanel();
                })
                .on("keydown", "input", function (e) {
                  if ("Escape" == e.key) return t.closePanel(), !1;
                })
                .on("keydown", "#search-panel-input", function (e) {
                  var n = e.keyCode || e.which;
                  return "Enter" == i[n]
                    ? ($(this).val() == t.searchStatus.searchText
                        ? t.highlightNext(e.shiftKey)
                        : t.doSearch($(this).val()),
                      !1)
                    : "Tab" == i[n]
                    ? $("#md-searchpanel.searchpanel-replace-mode").length
                      ? ($("#search-panel-replace-input").focus(), !1)
                      : ((this.value += "\t"), !1)
                    : void 0;
                })
                .on("beforeinput", "#search-panel-input", function (t) {
                  e && clearTimeout(e), (e = null);
                })
                .on("input", "#search-panel-input", function (i) {
                  n ||
                    (e && clearTimeout(e),
                    (e = null),
                    t.doSearch($(this).val()));
                })
                .on("compositionstart", "#search-panel-input", function (e) {
                  n = !0;
                })
                .on("compositionend", "#search-panel-input", function (i) {
                  n = !1;
                  var r = this;
                  e && clearTimeout(e),
                    (e = setTimeout(() => {
                      n || t.doSearch(r.value), (e = null);
                    }, 100));
                })
                .on("keydown", "#search-panel-replace-input", function (e) {
                  var r = e.keyCode || e.which;
                  if ((n = 229 == r) || "Enter" != i[r]) {
                    if ("Tab" == i[r] && !e.shiftKey) return !1;
                  } else t.replaceSelection();
                })
                .on("mousedown", "#search-panel-prev", function () {
                  t.highlightNext(!0);
                })
                .on("mousedown", "#search-panel-next", function () {
                  t.highlightNext();
                })
                .on("click", "#md-search-type-label", function () {
                  $("#md-searchpanel").addClass("searchpanel-replace-mode"),
                    $("#search-panel-replace-input").focus(),
                    document.body.classList.add("on-replace-panel-open");
                })
                .on("click", "#md-replace-type-label", function () {
                  $("#md-searchpanel")
                    .removeClass("searchpanel-replace-mode")
                    .removeClass("searchpanel-msg-mode"),
                    $("#search-panel-input").focus(),
                    document.body.classList.remove("on-replace-panel-open"),
                    $("content").removeClass("on-replace-panel-open");
                })
                .on("click", "#search-panel-replace-btn", function () {
                  t.replaceSelection(),
                    $("#md-searchpanel").removeClass("searchpanel-msg-mode");
                })
                .on("click", "#search-panel-replaceall-btn", function () {
                  $("#md-searchpanel").removeClass("searchpanel-msg-mode"),
                    t.replaceAll();
                })
                .on("click", "#searchpanel-msg-close-btn", function () {
                  $("#md-searchpanel").removeClass("searchpanel-msg-mode");
                })
                .on("click", "#searchpanel-msg-undo-btn", function () {
                  t.editor.undo.undo(),
                    $("#md-searchpanel").removeClass("searchpanel-msg-mode"),
                    !t.editor.sourceView.inSourceMode &&
                      t.doSearch($("#search-panel-input").val());
                })
                .on(
                  "mousedown",
                  "#searchpanel-regexp-option-btn",
                  function (e) {
                    return (
                      this.classList.toggle("active"),
                      (t.useRegexp = !t.useRegexp),
                      File.isMac &&
                        bridge.callHandler("touchBar.updateFindReplaceMode", [
                          !!t.caseSensitive,
                          !!t.wholeWord,
                        ]),
                      JSBridge.putSetting("useRegexp", t.useRegexp),
                      t.doSearch(),
                      !1
                    );
                  }
                )
                .on("mousedown", "#searchpanel-case-option-btn", function (e) {
                  return (
                    this.classList.toggle("active"),
                    (t.caseSensitive = !t.caseSensitive),
                    File.isMac &&
                      bridge.callHandler("touchBar.updateFindReplaceMode", [
                        !!t.caseSensitive,
                        !!t.wholeWord,
                      ]),
                    JSBridge.putSetting("caseSensitive", t.caseSensitive),
                    t.doSearch(),
                    !1
                  );
                })
                .on("mousedown", "#searchpanel-word-option-btn", function () {
                  return (
                    this.classList.toggle("active"),
                    (t.wholeWord = !t.wholeWord),
                    File.isMac &&
                      bridge.callHandler("touchBar.updateFindReplaceMode", [
                        !!t.caseSensitive,
                        !!t.wholeWord,
                      ]),
                    JSBridge.putSetting("wholeWord", t.wholeWord),
                    t.doSearch(),
                    !1
                  );
                }),
              t.wholeWord &&
                document
                  .querySelector("#searchpanel-word-option-btn")
                  .classList.add("active"),
              t.caseSensitive &&
                document
                  .querySelector("#searchpanel-case-option-btn")
                  .classList.add("active"),
              t.useRegexp &&
                document
                  .querySelector("#searchpanel-regexp-option-btn")
                  .classList.add("active");
          }
          replaceAll() {
            if (this.searchStatus && this.searchStatus.hits.length) {
              var e,
                t,
                n = this.searchStatus.searchText,
                i = $("#search-panel-replace-input").val(),
                o = this.searchStatus.hits;
              if (
                (function (e) {
                  p && clearTimeout(p),
                    $("#md-searchpanel.searchpanel-replace-mode")
                      .addClass("searchpanel-msg-mode")
                      .find("#searchpanel-msg-content")
                      .text(e),
                    (p = setTimeout(function () {
                      $("#md-searchpanel").removeClass("searchpanel-msg-mode");
                    }, 5e3));
                }.call(
                  this,
                  ((t = this.searchStatus.hits.length),
                  this.searchStatus.searchText,
                  "Replaced " + t + " occurrence(s)")
                ),
                this.editor.sourceView.inSourceMode)
              ) {
                var a = "",
                  s = 0,
                  l = o.length;
                if (
                  ((e = 0),
                  (n = this.editor.sourceView.cm.getValue()),
                  this.searchStatus.useRegexp)
                )
                  a = n.replace(this.searchStatus.regexp, i);
                else {
                  for (; s < l; s++)
                    (a = a + n.substring(e, o[s].start - 0) + i),
                      (e = o[s].end - 0);
                  a += n.substring(e);
                }
                var c = this.editor.sourceView.cm.getScrollInfo().top;
                return (
                  this.editor.sourceView.cm.setValue(a),
                  this.editor.sourceView.cm.scrollTo(0, c),
                  void this.clearSearch()
                );
              }
              var d = this.editor.undo.UndoManager,
                h = d.makeEmptyCommand(),
                f = this.searchStatus,
                m = f.regexp;
              this.editor.undo.endSnap(!0);
              var g,
                v = this.searchStatus.curSelection;
              if (v && v.isCm)
                h.undo.push({
                  cid: v.cid,
                  start: v.start,
                  end: v.end,
                  type: "cursor",
                });
              else if (v && v.parentElement) {
                var y = r.createRange();
                y.selectNode(v),
                  h.undo.push(this.editor.selection.buildUndo(y));
              }
              for (this.resetSearchStatus(), s = 0; s < o.length; s++) {
                var b =
                  (e = o[s]).isCm || e.isFutureCm
                    ? e.cid
                    : $(e).closest("[cid]").attr("cid");
                g != b && ((g = b), x.call(this, b));
              }
              this.editor.undo.register(h);
            }
            function w(e, t) {
              var n = e.get(t);
              if (((m.lastIndex = 0), n)) {
                var r = n;
                (r = f.useRegexp
                  ? n.replace(m, i)
                  : n.replace(m, function () {
                      return i;
                    })),
                  e.set(t, r);
              }
            }
            function x(e) {
              var t = this.editor.getNode(e);
              h.undo.push(d.buildReplaceUndo(t)),
                w(t, "text"),
                w(t, "title"),
                w(t, "ref"),
                h.redo.push(d.buildReplaceUndo(t));
              var n = this.editor.findElemById(t.cid);
              if (t.get("type") == u.fences) {
                var i = this.editor.fences.intersectionObserver;
                i && i.unobserve(n[0]);
              }
              n.replaceWith(t.toHTML()),
                t.get("type") == u.fences &&
                  this.editor.fences.intersectionObserve(
                    this.editor.findElemById(t.cid)[0]
                  );
            }
          }
          replaceSelection() {
            if (
              (this.editor.sourceView.inSourceMode &&
                !this.searchStatus.curSelection &&
                this.highlightNext(),
              this.searchStatus &&
                this.searchStatus.hits &&
                this.searchStatus.hits.length &&
                $("#md-searchpanel.searchpanel-replace-mode").length)
            )
              if (this.searchStatus.curSelection) {
                var e = $("#search-panel-replace-input").val(),
                  t = this.searchStatus.curPos,
                  n = this.editor.undo.UndoManager.makeEmptyCommand(),
                  i = this.searchStatus.curSelection,
                  o = i.isCm;
                this.editor.undo.endSnap(!0),
                  o
                    ? (this.searchStatus.useRegexp
                        ? o.doc.replaceSelection(
                            o.doc
                              .getSelection()
                              .replace(this.searchStatus.regexp, e),
                            "start",
                            "+findReplace"
                          )
                        : o.doc.replaceSelection(e, "start", "+findReplace"),
                      (function (n) {
                        for (
                          var r, a = t + 1, s = e.length - (i.end - i.start);
                          (r = n.hits[a]);

                        ) {
                          if (!r.isCm || r.isCm.cid != o.cid) return;
                          (r.start += s), (r.end += s), a++;
                        }
                      })(this.searchStatus))
                    : (function (e, t, n, i, o) {
                        e.brush.pause();
                        var a = e.undo.UndoManager,
                          s = e.nodeMap.allNodes.get(
                            $(t).closest("[cid]").attr("cid")
                          );
                        if (!d.isType(s, u.html_block)) {
                          var l = r.createRange();
                          l.selectNode(t);
                          var c = e.selection.buildUndo(l),
                            h = Object.clone(c);
                          if (o) {
                            var p = t.rawText();
                            if (o.source.indexOf("(?") > -1) {
                              var f =
                                  (t.previousSibling || {}).textContent || "",
                                m = (t.nextSibling || {}).textContent || "",
                                g = (f + p + m).replace(o, n);
                              n =
                                0 === g.indexOf(f) &&
                                g.lastIndexOf(m) == g.length - m.length
                                  ? g.substring(f.length, g.length - m.length)
                                  : p.replace(o, n);
                            } else n = p.replace(o, n);
                          }
                          (h.end = h.end + n.length - t.textContent.length),
                            i.undo.push(c),
                            i.undo.push(a.buildReplaceUndo(s));
                          var v,
                            y = null;
                          t.nextSibling && "SCRIPT" == t.nextSibling.tagName
                            ? (t.nextSibling.textContent =
                                n + t.nextSibling.textContent)
                            : t.previousSibling &&
                              "SCRIPT" == t.previousSibling.tagName
                            ? (t.previousSibling.textContent =
                                t.previousSibling.textContent + n)
                            : ((y = document.createTextNode(n)),
                              t.parentElement.insertBefore(y, t),
                              (v = t.parentElement)),
                            t.remove();
                          var b,
                            w = v && v.closest(".md-image");
                          w &&
                            ("img" == w.getAttribute("md-inline") &&
                              (b =
                                (/(^\!\[((?:\[[^\]]*\]|[^\[\]])*)\]\()(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])((?:.|\n)*?)\6[ \t]*)?)(\)(?:\s*{([^{}\(\)]*)})?)/.exec(
                                  w.textContent
                                ) || [])[4]),
                            "imgtag" == w.getAttribute("md-inline") &&
                              ((b = (/src\s*=\s*(['"])((.|\n)*?)\1/.exec(
                                w.textContent
                              ) || [])[2]) ||
                                (b = (/src\s*=\s*([^\s'"]+)(\s|$)/.exec(
                                  w.textContent
                                ) || [])[1])),
                            b &&
                              ((w.dataset.src = b),
                              (w.querySelector("img").src =
                                e.imgEdit.getRealSrc(b, void 0, !0)))),
                            e.store(s.cid),
                            i.redo.push(a.buildReplaceUndo(s)),
                            e.brush.addToQueue(s.cid),
                            y
                              ? (l.selectNode(y),
                                i.redo.push(e.selection.buildUndo(l)))
                              : i.redo.push(h);
                        }
                      })(
                        editor,
                        i,
                        e,
                        n,
                        this.searchStatus.useRegexp
                          ? this.searchStatus.regexp
                          : null
                      ),
                  this.searchStatus.hits.length > 1 && this.highlightNext(),
                  this.searchStatus.hits.splice(t, 1),
                  this.searchStatus.curPos > 0 && this.searchStatus.curPos--,
                  this.searchStatus.hits.length || this.clearSearch(),
                  this.editor.sourceView.inSourceMode ||
                    this.editor.undo.register(n);
              } else this.highlightNext();
          }
          isOpen() {
            return (
              "block" == document.querySelector("#md-searchpanel").style.display
            );
          }
          showPanel(e, t) {
            document.body.classList.remove("ty-show-notification");
            var n = document.querySelector("#search-panel-input");
            if ($("#md-searchpanel").is(":visible")) n.focus(), n.select();
            else {
              var i = editor.selection.getRangy();
              (editor.lastCursor = editor.selection.buildUndo(i)),
                $(".md-search-select").removeClass("md-search-select"),
                this.clearSearch(),
                (this.searchStatus.initPos =
                  editor.selection.getPosBookmark(i)),
                $("#md-searchpanel").show();
              var r =
                document.activeElement &&
                document.activeElement.closest(".CodeMirror");
              r && (n.value = r.CodeMirror.getSelection()),
                i && !i.collapsed && (n.value = i.toString()),
                n.focus(),
                n.select(),
                n.value &&
                  this.doSearch(n.value, {
                    caseSensitive: $("#searchpanel-case-option-btn.active")
                      .length,
                    wholeWord: $("#searchpanel-word-option-btn.active").length,
                    useRegexp: $("#searchpanel-regexp-option-btn.active")
                      .length,
                    noSelect: !t,
                  }),
                document.body.classList.add("on-search-panel-open");
            }
            e
              ? ($("#md-searchpanel").addClass("searchpanel-replace-mode"),
                document.body.classList.add("on-replace-panel-open"))
              : ($("#md-searchpanel").removeClass("searchpanel-replace-mode"),
                document.body.classList.remove("on-replace-panel-open")),
              File.isMac &&
                (bridge.callHandler("touchBar.showFindReplaceTouchBar"),
                bridge.callHandler("touchBar.updateFindReplaceMode", [
                  !!this.caseSensitive,
                  !!this.wholeWord,
                ]));
          }
          closePanel(e, t) {
            (t = t || $(".md-search-select")), this.editor.brush.resume();
            var n = this.editor.getMarkElem().length;
            document.body.classList.remove("on-replace-panel-open"),
              document.body.classList.remove("on-search-panel-open");
            var i = document.querySelector(
              "#file-library-search-result .select"
            );
            if (
              (i && i.classList.remove("select"),
              $("#md-searchpanel").removeClass("searchpanel-msg-mode").hide(),
              this.editor.sourceView.inSourceMode)
            )
              return (
                this.searchStatus &&
                  this.searchStatus.hits.length &&
                  (this.editor.fences.clearSearchAll(),
                  this.editor.sourceView.cm.focus()),
                void this.resetSearchStatus()
              );
            e
              ? (n = !0)
              : t.length
              ? (this.editor.selection.selectAllElem(t),
                (this.editor.lastCursor = this.editor.selection.buildUndo()),
                (n = !1))
              : this.searchStatus &&
                this.searchStatus.curSelection &&
                this.searchStatus.curSelection.isCm &&
                (this.searchStatus.curSelection.isCm.focus(),
                (this.editor.lastCursor = this.editor.selection.buildUndo()),
                (n = !1)),
              $(".md-search-select").removeClass("md-search-select"),
              this.editor.mathInline.renderAll(!1),
              this.clearSearch(),
              $(".md-search-hit").removeClass("md-search-hit"),
              !n && this.editor.restoreLastCursor(),
              !e && this.editor.refocus();
          }
          updateIndexUI() {
            var e = document.querySelector("#search-panel-status");
            if (this.searchStatus.searchText) {
              var t = this.searchStatus.hits.length,
                n = this.searchStatus.curPos;
              t > h
                ? (this.clearSearch(!1, !1, !0),
                  (e.innerHTML = `<span ty-hint="${$.localize.getString(
                    "Too many matches",
                    "Front"
                  )}" class="error-message">${h}+</span>`))
                : t
                ? (e.textContent = `${n + 1} / ${t}`)
                : (e.innerHTML = `<span class="error-message">${$.localize.getString(
                    "No Results",
                    "Front"
                  )}</span>`);
            } else e.textContent = "";
          }
          doSearch(e, t) {
            var n = this.editor,
              r = this,
              o = this.searchStatus,
              a = o && m(o),
              s = a && document.querySelector("[cid='" + a.cid + "']"),
              l = t;
            if (
              (t ||
                (l = {
                  caseSensitive: $("#searchpanel-case-option-btn.active")
                    .length,
                  wholeWord: $("#searchpanel-word-option-btn.active").length,
                  useRegexp: $("#searchpanel-regexp-option-btn.active").length,
                }),
              ((l = Object.assign(
                {
                  caseSensitive: !1,
                  wholeWord: !1,
                  useRegexp: !1,
                  noSelect: !1,
                  delay: File.inBusyMode ? 400 : 50,
                },
                l
              )).initPosContainer = s),
              (l.initPos = a),
              (l.searchText =
                void 0 === e ? $("#search-panel-input").val() : e || ""),
              (o = Object.assign(this.emptySearchStatus(), l)).searchText
                .length)
            ) {
              if (
                ((r = this),
                (o.regexp = (function (e, t) {
                  var n = t.caseSensitive ? "g" : "gi";
                  if (!t.useRegexp) {
                    var r = i.escapeRegExp(e);
                    return t.wholeWord && (r = `\\b${r}\\b`), new RegExp(r, n);
                  }
                  try {
                    return (
                      t.wholeWord &&
                        (e = `\\b${e.replace(/^\\b|\\b$/g, "")}\\b`),
                      new RegExp(e, n)
                    );
                  } catch (e) {
                    return null;
                  }
                })(o.searchText, o)),
                null == o.regexp)
              )
                return void this.updateIndexUI();
              if (this.editor.sourceView.inSourceMode)
                return (
                  this.clearSearch(void 0, !0),
                  (this.searchStatus = o),
                  this.findAtNode(
                    this.editor.sourceView.cm,
                    o.searchText,
                    o,
                    !0
                  ),
                  void (!l.noSelect && r.highlightNext())
                );
              this.searchTimer &&
                (clearTimeout(this.searchTimer), (this.searchTimer = null)),
                (this.searchTimer = setTimeout(function () {
                  r.clearSearch(void 0, !0),
                    $(".md-search-expand").removeClass("md-search-expand"),
                    (r.searchStatus = o);
                  for (var e = n.nodeMap.getFirst(); e; )
                    if (
                      (r.findAtNode(e, o.searchText, o, !1),
                      (e = e.get("after")),
                      o.hits.length > h)
                    )
                      return void r.updateIndexUI();
                  l.noSelect ? r.updateIndexUI() : r.highlightNext();
                }, l.delay));
            } else
              $(".md-search-expand").removeClass("md-search-expand"),
                this.clearSearch(void 0, !0),
                (this.searchStatus = o),
                this.updateIndexUI();
          }
          findAtNode(e, t, n, i) {
            var o = this.editor,
              a = n.initPosContainer,
              s = n.initPos;
            function l(e) {
              var t =
                e.containerNode ||
                document.querySelector("[cid='" + e.cid + "']");
              return (
                !!a &&
                (a.compareDocumentPosition(t) ==
                  Element.DOCUMENT_POSITION_PRECEDING ||
                  (a == t && e.start < s.start))
              );
            }
            function c(e) {
              var t = $(e);
              t.closest(".md-meta, .md-content, script").length ||
              t.hasClass("md-meta") ||
              t.hasClass("md-content") ||
              (t[0] && "script" == t[0].tagName)
                ? t.closest("[md-inline]").addClass("md-search-expand")
                : e
                    .querySelectorAll(".md-meta, .md-content, script")
                    .forEach(function (e) {
                      $(e).closest("[md-inline]").addClass("md-search-expand");
                    });
            }
            function p(e, t, i) {
              var a = n.regexp,
                s = o.findElemById(e.cid)[0];
              if (s) {
                var d,
                  u,
                  p = $(s).rawText(),
                  m = e
                    .getText()
                    .replace(/\r?\n/g, File.useCRLF ? "\r\n" : "\n");
                (p = i ? m : p), (a.lastIndex = 0);
                for (var g = null; (g = a.exec(p)); ) {
                  if (
                    (u = {
                      cid: e.cid,
                      containerNode: s,
                      start: a.lastIndex - g[0].length,
                      end: a.lastIndex,
                    }).start == u.end
                  )
                    return;
                  if (i)
                    n.hits.push({
                      isFutureCm: e.cid,
                      cid: e.cid,
                      start: u.start,
                      end: u.end,
                    });
                  else {
                    (d = d || r.createRange()).moveToBookmark(u);
                    var v = f(d);
                    c(v), n.hits.push(v);
                  }
                  if ((l(u) && n.curPos++, n.hits.length > h)) return;
                }
              } else
                try {
                  console.sendError(
                    "cannot found elem for [" +
                      e.get("type") +
                      "] from [" +
                      e.get("parent").get("type") +
                      "]"
                  );
                } catch (e) {}
            }
            function m(e, t) {
              var i = n.regexp,
                r = e.getValue(),
                a = !1,
                s = null;
              i.lastIndex = 0;
              for (var c = null; (c = i.exec(r)); ) {
                if (
                  ((a = !0),
                  (s = {
                    isCm: e,
                    cid: e.cid,
                    start: i.lastIndex - c[0].length,
                    end: i.lastIndex,
                  }).start == s.end)
                )
                  return;
                if ((n.hits.push(s), l(s) && n.curPos++, n.hits.length > h))
                  return;
              }
              a && o.fences.searchOn(e, t, n);
            }
            i
              ? m(this.editor.sourceView.cm, t)
              : (function e(t, i) {
                  if (t.get("children").length)
                    t.get("children").sortedForEach(function (t) {
                      e(t, i);
                    });
                  else if (d.isType(t, u.fences))
                    if (o.fences.queue[t.cid]) m(o.fences.queue[t.cid], i);
                    else {
                      var a = n.regexp;
                      try {
                        !(function (e, t) {
                          p(e, 0, !0);
                        })(t);
                      } catch (e) {
                        console.error(e);
                      }
                      a.lastIndex = 0;
                    }
                  else
                    d.isType(t, u.math_block)
                      ? (o.mathBlock.currentCm || {}).cid === t.cid &&
                        (o.fences.clearSearchOn(o.mathBlock.currentCm),
                        m(o.mathBlock.currentCm, i))
                      : d.isType(t, u.toc, u.hr) ||
                        (d.isType(t, u.html_block)
                          ? (o.htmlBlock.currentCm || {}).cid === t.cid
                            ? (o.fences.clearSearchOn(o.htmlBlock.currentCm),
                              m(o.htmlBlock.currentCm, i))
                            : (function (e, t) {
                                var i,
                                  a,
                                  s = n.regexp,
                                  c = o
                                    .findElemById(e.cid)[0]
                                    .querySelector(".md-htmlblock-container"),
                                  d = c.textContent;
                                s.lastIndex = 0;
                                for (var u = null; (u = s.exec(d)); ) {
                                  if (
                                    (a = {
                                      cid: e.cid,
                                      containerNode: c,
                                      start: s.lastIndex - u[0].length,
                                      end: s.lastIndex,
                                    }).start == a.end
                                  )
                                    return;
                                  if (
                                    ((i = i || r.createRange()).moveToBookmark(
                                      a
                                    ),
                                    3 == i.commonAncestorContainer.nodeType)
                                  ) {
                                    var p = f(i);
                                    if (
                                      (n.hits.push(p),
                                      l(a) && n.curPos++,
                                      n.hits.length > h)
                                    )
                                      return;
                                  }
                                }
                              })(t)
                          : p(t));
                })(e, t);
          }
          highlightNext(e) {
            if (!$("#md-searchpanel").is(":visible"))
              return this.showPanel(void 0, !0);
            $("#md-searchpanel").removeClass("searchpanel-msg-mode");
            var t,
              n = this.searchStatus,
              i = this.editor;
            if (n && n.hits.length) {
              var r = null;
              n.curSelection
                ? (n.curPos += e ? -1 : 1)
                : (function () {
                    if (i.lastCursor)
                      if (void 0 != i.lastCursor.startId) {
                        var e = i.selection.rangy.createRange();
                        e.moveToBookmark({
                          containerNode: i.findElemById(
                            i.lastCursor.startId
                          )[0],
                          start: i.lastCursor.start,
                          end: i.lastCursor.start,
                        }),
                          (n.curPos = 0);
                        for (var t = 0; t < n.hits.length; t++) {
                          if (!(o(e, (r = n.hits[t])) > 0)) return;
                          n.curPos++;
                        }
                      } else if (i.lastCursor.pos)
                        for (n.curPos = 0, t = 0; t < n.hits.length; t++) {
                          var r = n.hits[t];
                          if (!(a(i.lastCursor, r) > 0)) return;
                          n.curPos++;
                        }
                  })(),
                n.curPos >= n.hits.length
                  ? (n.curPos = 0)
                  : n.curPos < 0
                  ? (n.curPos = n.hits.length - 1)
                  : isNaN(n.curPos - 0) && (n.curPos = 0),
                function (r) {
                  if (
                    (function () {
                      n.curSelection &&
                        ((t = n.curSelection.isCm)
                          ? t.execCommand(e ? "goDocStart" : "goDocEnd")
                          : n.curSelection.classList.remove(
                              "md-search-select"
                            ));
                    }.call(this),
                    (n.curSelection = n.hits[n.curPos]),
                    (n.initPos = null),
                    $(".md-focus").removeClass("md-focus"),
                    n.curSelection.isFutureCm &&
                      ((n.curSelection.isCm = i.fences.addCodeBlock(
                        n.curSelection.isFutureCm
                      )),
                      (n.curSelection.isFutureCm = !1)),
                    (t = n.curSelection.isCm))
                  ) {
                    (n.lastRange = null),
                      t.doc.setSelection(
                        t.posFromIndex(n.curSelection.start),
                        t.posFromIndex(n.curSelection.end)
                      );
                    var o = t.getScrollerElement();
                    if (!o) return;
                    var a = o.querySelector(".CodeMirror-selectedtext");
                    if (!a) return;
                    File.isTypeWriterMode
                      ? i.selection.typeWriterScroll(a)
                      : i.selection.scrollAdjust(a, void 0, 200),
                      $(o).closest("[cid]").addClass("md-focus");
                  } else
                    n.curSelection.classList.add("md-search-select"),
                      (n.lastRange = n.curSelection),
                      File.isTypeWriterMode
                        ? i.selection.typeWriterScroll($(n.curSelection))
                        : i.selection.scrollAdjust(
                            $(n.curSelection),
                            void 0,
                            200
                          ),
                      $(n.curSelection).closest("[cid]").addClass("md-focus");
                }.call(this, n.curPos),
                this.updateIndexUI();
            } else this.updateIndexUI();
            function o(e, t) {
              try {
                var n = i.selection.rangy.createRange();
                return (
                  t.isCm
                    ? n.selectNode(t.isCm.getWrapperElement())
                    : t.isFutureCm
                    ? n.selectNode(i.findElemById(t.isFutureCm)[0])
                    : n.selectNode(t),
                  e.compareBoundaryPoints(Range.END_TO_END, n)
                );
              } catch (e) {
                console.sendError(e, "warning");
              }
            }
            function a(e, t) {
              try {
                if (t.isCm && t.isCm.cid == e.id)
                  return t.isCm.indexFromPos(e.pos) - t.end;
                r ||
                  (r = i.selection.rangy.createRange()).selectNode(
                    i.findElemById(e.id)[0]
                  );
                var n = i.selection.rangy.createRange();
                return (
                  t.isCm
                    ? n.selectNode(t.isCm.getWrapperElement())
                    : t.isFutureCm
                    ? n.selectNode(i.findElemById(t.isFutureCm)[0])
                    : n.selectNode(t),
                  r.compareBoundaryPoints(Range.END_TO_END, n)
                );
              } catch (e) {
                console.sendError(e, "warning");
              }
            }
          }
          clearSearch(e, t, n) {
            var i = m(this.searchStatus);
            if (this.editor.sourceView.inSourceMode)
              return (
                this.editor.fences.clearSearchAll(),
                void (
                  n ||
                  (this.resetSearchStatus(i),
                  clearTimeout(this.searchTimer),
                  (this.searchTimer = null))
                )
              );
            t || $(".md-search-expand").removeClass("md-search-expand");
            var r,
              o = [];
            if (this.searchStatus) {
              for (var a = 0; a < this.searchStatus.hits.length; a++) {
                var s = this.searchStatus.hits[a];
                s.parentElement &&
                  (s.isCm ||
                    (s.parentElement.classList.contains(
                      "md-inline-math-container"
                    )
                      ? o.push(s.closest(".md-inline-math"))
                      : ((r = s), c.unmarkSpan(r))));
              }
              var d = this.searchStatus.curSelection,
                h = (d || {}).isCm;
              h &&
                (h.doc.setSelection(h.posFromIndex(d.start)),
                $(h.display.input.textarea).blur());
            }
            o.forEach((e) => {
              e.outerHTML = l.decorate({
                type: u.inline_math,
                text: $(e.querySelector(".md-inline-math-container")).rawText(),
                pattern: e.querySelector(".md-before").textContent,
              });
            }),
              this.editor.fences.clearSearchAll(),
              n ||
                (this.resetSearchStatus(i),
                clearTimeout(this.searchTimer),
                (this.searchTimer = null));
          }
          emptySearchStatus(e) {
            return {
              hits: [],
              curPos: 0,
              searchText: null,
              lastRange: null,
              initPos: e,
              curSelection: null,
            };
          }
          resetSearchStatus(e) {
            (this.searchStatus = this.emptySearchStatus(e)),
              this.updateIndexUI();
          }
        };
      }
    ),
    $__System.registerDynamic("36", ["11", "e", "13"], !0, function (e, t, n) {
      this || self, e("11");
      var i = e("e"),
        r = e("13"),
        o = r.Node,
        a = r.TYPE,
        s = function (e) {
          if (0 === e.trim().length) return 0;
          var t = 0,
            n = [
              "d",
              e
                .replace(/[\u3040-\uABFF\uD7A4-\uFAFF]/gi, function (e) {
                  return t++, " ";
                })
                .replace(/['’]\w+/g, "b")
                .replace(
                  /(^|\s+)[(\u3000-\u303F)!-\/:-@\[-`{-~]+(\s+|$)/gm,
                  " "
                ),
              "d",
            ]
              .join(" ")
              .split(/[(\u3000-\u303F)\s!-,\\:-@\[-`{-~]+/g).length;
          return t + n - 2;
        },
        l = { WORD: 0, CHAR: 1, LINE: 2, TIME: 3 },
        c = ["Words", "Characters", "Lines", "Minutes"],
        d = ["Word", "Character", "Line", "Minute"];
      class u {
        constructor(e) {
          (this.editor = e),
            (this.delimiter = (File.option.wordCountDelimiter || 0) - 0),
            (this.Delimiter = l),
            (this.defferUpdateTimer = null),
            (this.defferSelectionUpdateTimer = null),
            (this.lastCount = -1),
            (this.selCount = 0),
            (this.excludedCid = null),
            (this.excludedCount = -1),
            File.isNodeHtml && this.bindWordCountOnNode(),
            File.isMac && this.setupBridge();
        }
        setupBridge() {
          var e = this;
          bridge.registerHandler(
            "wordCount.getLabelsToShowOnMac",
            function (t, n) {
              n(e.getLabelsToShowOnMac());
            }
          );
        }
        getText(e) {
          var t = this.editor,
            n = e,
            i = e;
          void 0 === i.nodeType
            ? (i = document.querySelector("[cid='" + n + "']"))
            : (n = i.getAttribute("cid"));
          var r = i && i.getAttribute("mdtype");
          if (r == a.toc) return "toc";
          if (o.isType(r, a.html_block, a.math_block, a.fences)) {
            var s = (i.querySelector(".CodeMirror") || {}).CodeMirror;
            if (s) {
              if (r == a.fences) {
                var l = i.getAttribute("lang");
                return (
                  (l ? "```" + l + "\n" : "") + s.getValue() + (l ? "```" : "")
                );
              }
              return r == a.math_block
                ? "$$\n" + s.getValue() + "\n$$"
                : s.getValue();
            }
            var c = t.getNode(n);
            return c ? c.get("text") : "";
          }
          if (r && !o.canContainBlock(r, !0)) {
            if (this.useWordDelimiter()) {
              var d = i;
              return (
                File.option.enableInlineMath &&
                  i.querySelector("svg") &&
                  (d = i.cloneNode(!0))
                    .querySelectorAll("svg")
                    .forEach(function (e) {
                      e.textContent = "";
                    }),
                d.textContent
              );
            }
            return i.textContent;
          }
          return null;
        }
        useWordDelimiter() {
          return this.delimiter == l.WORD;
        }
        clearTimer() {
          this.defferUpdateTimer &&
            (cancelIdleCallback(this.defferUpdateTimer),
            (this.defferUpdateTimer = null));
        }
        quickUpdate(e, t, n) {
          var i = null,
            r = e;
          e &&
            (e.cid
              ? ((i = e.get("text")), (r = e.cid))
              : (i = this.getText(r))),
            t && ((this.excludedCount = -1), (this.excludedCid = null)),
            null !== i &&
              (this.delimiter == l.CHAR && this.quickUpdateCharCount(r, i, n),
              this.delimiter == l.WORD && this.quickUpdateWordCount(r, i, n),
              this.delimiter == l.LINE && this.quickUpdateLineCount(r, i, n),
              this.delimiter == l.TIME && this.quickUpdateReadTime(r, i, n));
        }
        quickUpdateWordCount(e, t, n, i) {
          var r;
          if (this.excludedCid == e && this.excludedCount >= 0) {
            if (((r = s(t) + this.excludedCount), n && r == this.lastCount))
              return;
            return (
              (this.lastCount = r),
              void this.updateLabel(
                0,
                i
                  ? Math.round(this.lastCount / File.option.wordsPerMinute)
                  : this.lastCount
              )
            );
          }
          if (!n) {
            this.clearTimer();
            var o = this;
            this.defferUpdateTimer = requestIdleCallback(function () {
              (o.lastCount = o.getWordCount()),
                (o.excludedCid = e),
                (o.excludedCount = o.lastCount - s(t)),
                o.updateLabel(
                  -1,
                  i
                    ? Math.round(o.lastCount / File.option.wordsPerMinute)
                    : o.lastCount
                );
            });
          }
        }
        quickUpdateCharCount(e, t, n, i) {
          var r;
          if (this.excludedCid == e && this.excludedCount >= 0) {
            if (
              ((r =
                (i ? t.split(/\n/g).length : t.length) + this.excludedCount),
              n && r == this.lastCount)
            )
              return;
            return (
              (this.lastCount = r), void this.updateLabel(0, this.lastCount)
            );
          }
          if (!n) {
            var o = this.editor.getMarkdown();
            (this.lastCount = i ? o.split(/\n/g).length : o.length),
              (this.excludedCid = e),
              (this.excludedCount =
                this.lastCount - (i ? t.split(/\n/g).length : t.length)),
              this.updateLabel(0, this.lastCount);
          }
        }
        quickUpdateReadTime(e, t, n) {
          this.quickUpdateWordCount(e, t, n, !0);
        }
        quickUpdateLineCount(e, t, n) {
          this.quickUpdateCharCount(e, t, n, !0);
        }
        getLabelsToShowOnMac() {
          File.sync();
          var e = this.getWordCount(),
            t = this.editor.selection.getTextInSelection();
          return t.length
            ? [
                e,
                s(t),
                t.length,
                Math.round(e / File.option.wordsPerMinute),
              ].join("|")
            : [e, 0, 0, Math.round(e / File.option.wordsPerMinute)].join("|");
        }
        updateLabel(e, t) {
          var n = i.localize.getString(c[this.delimiter], "Panel");
          if (
            (e < 0 ? (e = this.selCount) : (this.selCount = e), e > 0 && e < t)
          ) {
            if (File.isMac)
              bridge.callHandler("word.updateWordCount", { sel: e, all: t });
            else if (File.isNodeHtml) {
              var r = document.querySelector("#footer-word-count-label"),
                o = r.textContent,
                a = e + " / " + t + " " + n;
              o != a &&
                fastdom.mutate(function () {
                  r.textContent = a;
                });
            }
          } else if (t >= 0)
            if (File.isMac)
              bridge.callHandler("word.updateWordCount", { sel: e, all: t });
            else if (File.isNodeHtml) {
              var s = document.querySelector("#footer-word-count-label");
              this.delimiter == l.TIME && 0 == t
                ? ((n = i.localize.getString(d[this.delimiter], "Panel")),
                  (t = "≤ 1"))
                : 1 == t &&
                  (n = i.localize.getString(d[this.delimiter], "Panel")),
                fastdom.mutate(function () {
                  s.textContent = t + " " + n;
                });
            }
        }
        updateLineCount(e) {
          var t = (e =
            !0 === e
              ? this.editor.getMarkdown()
              : e || this.editor.getMarkdown()).split(/\n/g).length;
          this.lastCount != t &&
            ((this.lastCount = t), this.updateLabel(0, this.lastCount));
        }
        updateCharCount(e) {
          e = e || this.editor.getMarkdown();
          this.lastCount != e.length &&
            ((this.lastCount = e.length), this.updateLabel(0, this.lastCount));
        }
        getWordCount() {
          var e = "";
          return (
            this.editor.writingArea
              .querySelectorAll("[mdtype]")
              .forEach(function (t) {
                var n = this.getText(t);
                n && (e += "\n" + n);
              }, this),
            s(e)
          );
        }
        updateWordCount() {
          if (this.delimiter == l.WORD) {
            this.clearTimer();
            var e = this;
            this.defferUpdateTimer = requestIdleCallback(function () {
              (e.lastCount = e.getWordCount()), e.updateLabel(0, e.lastCount);
            });
          }
        }
        updateReadTime() {
          this.clearTimer();
          var e = this;
          this.defferUpdateTimer = requestIdleCallback(function () {
            (e.lastCount = e.getWordCount()),
              e.updateLabel(
                0,
                Math.round(e.lastCount / File.option.wordsPerMinute)
              );
          });
        }
        update(e) {
          this.delimiter == l.WORD
            ? this.updateWordCount()
            : this.delimiter == l.CHAR
            ? this.updateCharCount(e)
            : this.delimiter == l.LINE
            ? this.updateLineCount(e)
            : this.delimiter == l.TIME && this.updateReadTime(e);
        }
        updateInSelection(e) {
          this.defferSelectionUpdateTimer &&
            clearTimeout(this.defferSelectionUpdateTimer);
          var t = this.editor,
            n = this;
          this.defferSelectionUpdateTimer = setTimeout(function () {
            var i =
              void 0 == e || null == e ? t.selection.getTextInSelection() : e;
            i = i || "";
            var r = 0;
            if (
              ((this.defferSelectionUpdateTimer = null), n.delimiter == l.CHAR)
            )
              r = i.length;
            else {
              if (n.delimiter != l.WORD) return;
              r = s(i);
            }
            r = Math.min(r, n.lastCount);
            n.updateLabel(r, n.lastCount);
          }, 50);
        }
        getWordCountInSelection() {
          var e = editor.selection.getTextInSelection();
          return s(e);
        }
        getCharCountInSelection() {
          return editor.selection.getTextInSelection().length;
        }
        bindWordCountOnNode() {
          var e = this,
            t = this.editor;
          i("#footer-word-count")
            .on("click", function () {
              if (document.body.classList.contains("ty-show-word-count"))
                document.body.classList.remove("ty-show-word-count"),
                  document.body.classList.remove(
                    "ty-show-word-count-in-selection"
                  );
              else {
                document.body.classList.remove("ty-show-spell-check"),
                  document.body.classList.add("ty-show-word-count"),
                  File.sync();
                var n = e.getWordCount();
                i("#footer-word-count-td").text(n);
                var r = t.getMarkdown(),
                  o = Math.round(n / File.option.wordsPerMinute);
                i("#footer-read-time-count-td").text(o || "≤ 1"),
                  i("#footer-line-count-td").text(
                    (r.match(/\n/g) || []).length + 1
                  ),
                  i("#footer-char-count-td").text(r.length);
                var a = t.selection.getTextInSelection();
                a.length
                  ? (i("#footer-char-count-td-sel").text(a.length),
                    i("#footer-word-count-td-sel").text(s(a)),
                    document.body.classList.add(
                      "ty-show-word-count-in-selection"
                    ))
                  : document.body.classList.remove(
                      "ty-show-word-count-in-selection"
                    );
              }
            })
            .on("before-show-ty-hint", function (e) {
              document.body.classList.contains("ty-show-word-count") &&
                (e.cancel = !0);
            }),
            i("#footer-word-count-info").on(
              "click",
              "[data-delimiter]",
              function () {
                var n = this.dataset.delimiter - 0;
                e.setDelimiter(n);
                var i =
                  this.children[0].textContent +
                  " " +
                  this.children[1].textContent;
                (document.querySelector(
                  "#footer-word-count-label"
                ).textContent = i),
                  document.body.classList.remove("ty-show-word-count"),
                  t.restoreLastCursor(null, !0);
              }
            );
        }
        setDelimiter(e) {
          (this.delimiter = e),
            this.update(!0),
            this.quickUpdate(editor.focusCid, !0),
            JSBridge.putSetting("wordCountDelimiter", this.delimiter);
        }
      }
      (u.Delimiter = l), (n.exports = u);
    }),
    $__System.registerDynamic("37", [], !0, function (e, t, n) {
      "use strict";
      this || self;
      n.exports = class {
        constructor(e) {
          this.editor = e;
        }
        search(e, t, n, i) {
          var r = e.substring(t, t + n);
          return r
            ? new Promise(function (o, a) {
                File.isMac
                  ? bridge.callHandler(
                      "word.getSpellSuggestionInContext",
                      { context: e, start: t, length: n },
                      function (e) {
                        (i.type = "word"),
                          (i.token = r),
                          (i.match = e),
                          (i.found = e.length),
                          (i.pageNo = 0),
                          (i.pageCnt = Math.floor((e.length - 1) / 5 + 1)),
                          o(i);
                      }
                    )
                  : o(i);
              })
            : [];
        }
      };
    }),
    $__System.registerDynamic("38", ["20"], !0, function (e, t, n) {
      this || self;
      var i = e("20"),
        r = "CodeMirror-activeline",
        o = "CodeMirror-activeline-background",
        a = "CodeMirror-activeline-gutter";
      function s(e) {
        for (var t = 0; t < e.state.activeLines.length; t++)
          e.removeLineClass(e.state.activeLines[t], "wrap", r),
            e.removeLineClass(e.state.activeLines[t], "background", o),
            e.removeLineClass(e.state.activeLines[t], "gutter", a);
      }
      function l(e, t) {
        for (var n = [], i = 0; i < t.length; i++) {
          var l = t[i],
            c = e.getOption("styleActiveLine");
          if (
            "object" == typeof c && c.nonEmpty
              ? l.anchor.line == l.head.line
              : l.empty()
          ) {
            var d = e.getLineHandleVisualStart(l.head.line);
            n[n.length - 1] != d && n.push(d);
          }
        }
        (function (e, t) {
          if (e.length != t.length) return !1;
          for (var n = 0; n < e.length; n++) if (e[n] != t[n]) return !1;
          return !0;
        })(e.state.activeLines, n) ||
          e.operation(function () {
            s(e);
            for (var t = 0; t < n.length; t++)
              e.addLineClass(n[t], "wrap", r),
                e.addLineClass(n[t], "background", o),
                e.addLineClass(n[t], "gutter", a);
            e.state.activeLines = n;
          });
      }
      function c(e, t) {
        l(e, t.ranges);
      }
      i.defineOption("styleActiveLine", !1, function (e, t, n) {
        var r = n != i.Init && n;
        t != r &&
          (r &&
            (e.off("beforeSelectionChange", c),
            s(e),
            delete e.state.activeLines),
          t &&
            ((e.state.activeLines = []),
            l(e, e.listSelections()),
            e.on("beforeSelectionChange", c)));
      });
    }),
    $__System.registerDynamic("39", ["20"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = e("20");
      i.defineOption("visibleSpace", !1, function (e, t, n) {
        n == i.Init && (n = !1),
          n && !t
            ? e.removeOverlay("visiblespace")
            : !n &&
              t &&
              e.addOverlay({
                token: function (e, t) {
                  if (!t) return null;
                  if (t.atBlockStart && e.pos < t.atBlockStart)
                    return e.eat(" ")
                      ? "startspace startspace-" + (e.pos - 1)
                      : e.eat("\t")
                      ? "starttab startspace-" + (e.pos - 1)
                      : (e.pos++, null);
                  var n = /(^[ \t]+)|(\s+$)/.exec(e.string),
                    i = e.string.length,
                    r = n && n[1] ? n[1].length : -1;
                  n && n[2] && n[2].length;
                  return r > 0 && r > e.pos
                    ? (e.pos++,
                      "startspace-" +
                        (e.pos - 1) +
                        ("\t" == e.string.charAt(e.pos - 1)
                          ? " starttab"
                          : " startspace"))
                    : ((e.pos = i), null);
                },
                name: "visiblespace",
              });
      });
    }),
    $__System.registerDynamic(
      "3a",
      ["20", "38", "39", "e", "13", "11", "19", "1b"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r = e("20"),
          o = (e("38"), e("39"), e("e")),
          a = e("13"),
          s = e("11"),
          l = e("19"),
          c = e("1b"),
          d = a.Node,
          u = a.TYPE,
          h = o("#typora-source"),
          p = !1,
          f = function (e) {
            (this.editor = e),
              (this.cm = null),
              (this.inSourceMode = !1),
              (this.renderedHTML = "");
          };
        function m(e, t) {
          var n = "number" == typeof e ? e : e.get("tail");
          return void 0 === n
            ? void 0 === t
              ? e.get("after")
                ? 1
                : 0
              : t
            : n;
        }
        function g(e, t) {
          function n(e, t) {
            return e
              .get("children")
              .toArray()
              .reduce(function (e, n) {
                return e + g(n, t);
              }, 0);
          }
          function i(e) {
            return (
              d.isType(e.get("parent"), u.list_item) &&
              !1 !== e.get("parent").get("tight")
            );
          }
          switch (e.get("type")) {
            case u.meta_block:
              return 2 + e.get("text").match(/(\n|$)/g).length + m(e);
            case u.heading:
              return (
                (e.get("ahead") || 0) +
                ((
                  e.get("pattern") ||
                  (!d.isType(e.get("parent"), u.list_item) &&
                  (1 == File.option.headingStyle ||
                    3 == File.option.headingStyle) &&
                  e.get("depth") <= 2
                    ? "==="
                    : "#")
                ).match(/[-=]/)
                  ? 2
                  : 1) +
                m(e)
              );
            case u.paragraph:
              var r = e.get("tail");
              return (
                (t || i(e)) && (r = 0),
                d.isType(e.get("after"), u.paragraph) &&
                  r < 1 &&
                  (e.unset("tail"), (r = 1)),
                void 0 !== r ||
                  (!d.isType(e.get("after"), u.math_block) && e.get("after")) ||
                  (r = 0),
                (e.get("ahead") || 0) +
                  (e.get("text").split(/\n/g).length || 1) +
                  m(void 0 === r ? e : r, r)
              );
            case u.blockquote:
              return (e.get("ahead") || 0) + n(e) + m(e);
            case u.list:
              var o = e.get("ahead") || 0;
              return (
                e.isLoose(!0),
                (o += n(e)),
                d.isType(e.get("after"), u.list) &&
                  (!e.get("tail") || e.get("tail")) < 2 &&
                  e.get("pattern") == e.get("after").get("pattern") &&
                  e.get("style") == e.get("after").get("style") &&
                  (e.unset("tail"), o++, i(e) && o++),
                t || (o += m(e, i(e) || !e.get("after") ? 0 : 1)),
                o
              );
            case u.list_item:
              return e.toMark().split(/\n/).length;
            case u.html_block:
              return (
                (e.get("ahead") || 1) +
                (e.get("text").match(/\n/g) || []).length +
                m(e)
              );
            case u.fences:
              var a = /`|~/.exec(e.get("pattern") || "```"),
                s = (e.get("noCloseTag") ? 1 : 2) + (e.get("empty") ? 0 : 1);
              return (
                (e.get("ahead") || 0) +
                (a ? s : 1) +
                (e.get("text").match(/\n/g) || []).length +
                m(e)
              );
            case u.math_block:
              return (
                (e.get("ahead") || 0) +
                3 +
                (e.get("text").match(/\n/g) || []).length +
                m(
                  e,
                  d.isType(e.get("before"), u.paragraph) &&
                    d.isType(e.get("after"), u.paragraph)
                    ? 0
                    : 1
                )
              );
            case u.hr:
              return (e.get("ahead") || 0) + m(e) + 1;
            case u.toc:
              return (
                (e.get("ahead") || 0) +
                (e.get("pattern") || "").split(/\n/).length +
                m(e)
              );
            case u.def_footnote:
            case u.def_link:
              return (
                (e.get("ahead") || 0) +
                1 +
                m(
                  e,
                  !e.get("after") || d.isType(e.get("after"), d.TYPE.def_link)
                    ? 0
                    : 1
                )
              );
            case u.table:
              return (
                (e.get("ahead") || 0) + e.get("children").length + 1 + m(e)
              );
            case u.table_row:
              return e.get("before") ? 1 : 2;
            case u.table_cell:
              return 0;
            default:
              return 1;
          }
        }
        (f.prototype.prep = function () {
          if (this.cm) this.cm.mode || this.cm.setOption("mode", "gfm");
          else {
            var e = this;
            (this.cm = r(
              document.querySelector("#typora-source"),
              {
                lineWrapping: !0,
                mode: "gfm",
                theme: "typora-default",
                styleSelectedText: !0,
                maxHighlightLength: 1 / 0,
                styleActiveLine: !0,
                visibleSpace: !0,
                viewportMargin: 100,
                autoCloseBrackets: !File.option.noPairingMatch,
                autoCloseTags: !0,
                resetSelectionOnContextMenu: !1,
                extraKeys: {
                  Enter: "newlineAndIndentContinueMarkdownList",
                  Tab: "autoIndentMarkdownList",
                  "Shift-Tab": "autoUnindentMarkdownList",
                },
                lineNumbers: !0,
                dragDrop: !1,
                indentUnit: File.option.codeIndentSize,
                tabSize: File.option.codeIndentSize,
                lineWiseCopyCut: File.option.lineWiseCopyCut,
              },
              this.editor
            )),
              h.css("z-index", "2");
            var t = this.editor;
            this.cm.on("changes", function (n, i) {
              if (
                (t.fences.handleUserReplacement(n, i),
                e.inSourceMode &&
                  (document.querySelector(".on-search-panel-open") &&
                    "+findReplace" !== i[0].origin &&
                    "setValue" !== i[0].origin &&
                    e.editor.searchPanel.closePanel(),
                  File.isTypeWriterMode
                    ? e.scrollAdjust()
                    : i[0] && i[0].text.length > 2 && e.scrollAdjust(),
                  "begin" !== i[0].origin && "sync" !== i[0].origin))
              ) {
                p = !0;
                var r = File.editor.sourceView.cm.doc.historySize();
                JSBridge.menu.update({
                  "Edit→Undo": { enabled: !File.isLocked && r.undo > 0 },
                  "Edit→Redo": { enabled: !File.isLocked && r.redo > 0 },
                }),
                  "fromDisk" !== i[0].origin &&
                    File.updateChangeCount(File.ChangeType.NSChangeDone),
                  t.syncChange([{ type: "sync", srcChanges: i }]),
                  File.needsUpdateSnap();
              }
            }),
              this.cm.on("contextmenu", function (t, n) {
                if (e.inSourceMode) {
                  var i = t.getCursor("from"),
                    r = t.getCursor("to");
                  setTimeout(function () {
                    t.setSelection(i, r, { scroll: !1 });
                  }, 180),
                    File.isNodeHtml && File.editor.contextMenu.show(n);
                }
              });
            var n = !1,
              i = !1;
            this.cm.on("cursorActivity", function (r, o) {
              (i = !1),
                e.inSourceMode &&
                  (File.isFocusMode && t.updateFocusMode(!0),
                  (r.curOp && !r.curOp.scrollToPos) ||
                    (File.isTypeWriterMode
                      ? File.option.scrollWithCursor &&
                        (n ? (i = !0) : e.scrollAdjust())
                      : n || e.normalScrollAdjust()),
                  File.isNodeHtml && File.editor.contextMenu.hide(o));
            }),
              this.cm.on("scrollCursorIntoView", function (t, n) {
                (e.inSourceMode && !File.isTypeWriterMode) ||
                  n.preventDefault();
              }),
              this.cm.display.scroller.addEventListener(
                "mousedown",
                function (e) {
                  n = !0;
                },
                !0
              ),
              window.addEventListener("mouseup", function (t) {
                i && n && e.scrollAdjust(), (i = !1), (n = !1);
              }),
              this.cm.display.scroller.addEventListener(
                "wheel",
                function (e) {
                  Math.abs(e.deltaY) < 4 ||
                    (File.isFocusMode &&
                      File.isTypeWriterMode &&
                      t.updateFocusMode(!1));
                },
                { passive: !0 }
              );
          }
        }),
          (f.prototype.show = function () {
            File.sync();
            var e,
              t = this.editor.getMarkdown();
            try {
              e = C.call(this);
            } catch (t) {
              (e = null), console.warn(t.stack);
            }
            this.editor.refocus(null),
              this.editor.cleanTooltip(),
              this.editor.searchPanel.closePanel(!0),
              (this.inSourceMode = !0),
              File.isNode && JSBridge.invoke("window.setInSourceMode", !0),
              o("body").addClass("typora-sourceview-on");
            var n = o("content");
            o("body").find(".md-tooltip-hide").hide(),
              document.body.classList.remove("ty-show-notification"),
              n.find(".auto-suggest-container.ty-show").removeClass("ty-show"),
              (this.renderedHTML = ""),
              this.prep(),
              this.cm.setValue(t, "begin"),
              (p = !1),
              h.show(),
              F.call(this, e),
              this.cm.refresh(),
              this.cm.focus(),
              this.cm.getDoc().clearHistory(),
              (this.cm.options.readOnly = File.isLocked),
              this.enableTypeWriterMode(File.isTypeWriterMode);
          }),
          (f.prototype.enableTypeWriterMode = function (e) {
            if (this.cm) {
              if (e) {
                var t = this.cm.defaultTextHeight();
                (i = document.querySelector("content").clientHeight),
                  (this.cm.display.lineSpace.parentNode.style.paddingTop =
                    (i - t) / 2 + "px"),
                  (this.cm.display.lineSpace.parentNode.style.paddingBottom =
                    (i - t) / 2 + "px");
              } else
                (this.cm.display.lineSpace.parentNode.style.paddingTop = ""),
                  (this.cm.display.lineSpace.parentNode.style.paddingBottom =
                    "");
              this.scrollAdjust();
            }
          }),
          (f.prototype.setValue = function (e, t, n) {
            this.cm &&
              (e != this.cm.getValue() && this.cm.setValue(e, n || "begin"),
              t && (p = !0));
          }),
          (f.prototype.onSave = function () {
            this.cm.doc.history.lastModTime = 0;
          }),
          (f.prototype.hide = function () {
            var e = this.editor;
            e.searchPanel.closePanel(),
              o("body").removeClass("typora-sourceview-on"),
              (this.inSourceMode = !1),
              File.isNode && JSBridge.invoke("window.setInSourceMode", !1);
            var t = this.cm.getCursor();
            (t.lineText = this.cm.getLine(t.line)),
              (function (e) {
                var t = e.lineText.substring(0, e.ch);
                (e.inRef = t.match(v) && !t.match(y)), (e.textBefore = t);
              })(t),
              p
                ? File.isMac && !File.isDocumentEdited() && this.renderedHTML
                  ? (o(File.editor.sessionStr).html(this.renderedHTML),
                    setTimeout(function () {
                      File.editor.refresh();
                    }, 500),
                    File.editor.syncChange([
                      {
                        type: "sync",
                        allHtml: this.renderedHTML,
                        json: c.buildAllDoc(File.editor.nodeMap).json,
                      },
                    ]))
                  : File.reloadContent(
                      this.cm.getValue(File.useCRLF ? "\r\n" : "\n"),
                      { delayRefresh: !0, skipChangeCount: !0, skipStore: !0 }
                    )
                : File.editor.tryEnterBusyMode(this.cm.getValue()),
              h.hide(),
              x.call(this, t),
              e.selection.scrollAdjust(),
              window.Reporter.fullValidate();
          }),
          (f.prototype.scrollAdjust = function () {
            var e = this.cm.getScrollInfo(),
              t = this.cm.getCursor(),
              n = this.cm.charCoords(t, "local").top,
              i = e.clientHeight / 2;
            this.cm.scrollTo(null, n - i - 5);
          }),
          (f.prototype.normalScrollAdjust = function () {
            var e = this.cm.getScrollInfo(),
              t = this.cm.getCursor(),
              n = this.cm.charCoords(t, "local").bottom;
            e.clientHeight + e.top - 59 < n &&
              this.cm.scrollTo(null, e.top + 60);
          });
        var v = /\[/,
          y = /\]/;
        var b = function (e, t, n, i) {
            var r = null;
            function o(e, t, n) {
              return (
                void 0 === n &&
                  (n =
                    (n = t
                      ? i.lineText.indexOf(e)
                      : i.lineText.lastIndexOf(e)) < 0
                      ? 0
                      : n),
                Math.max(0, i.ch - n)
              );
            }
            var a = e.findElemById(t.cid);
            switch (t.get("type")) {
              case u.paragraph:
                for (
                  var c = t.get("text").split(/\n/), d = 0, h = 0;
                  h < n && h < c.length;
                  h++
                )
                  d += c[h].length + 1;
                a.find(".md-math-after-sym, .md-emoji-control-ch").text(""),
                  e.undo.exeCommand({
                    type: "cursor",
                    id: t.cid,
                    start: d + o(c[n]),
                  }),
                  a.find(".md-math-after-sym, .md-emoji-control-ch").text("​");
                break;
              case u.heading:
                a.find(".md-math-after-sym, .md-emoji-control-ch").text(""),
                  e.undo.exeCommand({
                    type: "cursor",
                    id: t.cid,
                    start: (function (e, t) {
                      var n = t;
                      for (var i in e) void 0 !== i && i <= t && (n += e[i]);
                      return n;
                    })(t.cursorDiff || [], o(t.get("text"))),
                  }),
                  a.find(".md-math-after-sym, .md-emoji-control-ch").text("​");
                break;
              case u.hr:
              case u.toc:
                t.get("after")
                  ? e.selection.jumpIntoElemBegin(
                      e.findElemById(t.get("after").getVeryFirst().cid)
                    )
                  : e.selection.selectNode(t);
                break;
              case u.math_block:
                (r = e.mathBlock.startEditing(t.cid)), n--;
                break;
              case u.html_block:
                r = e.htmlBlock.startEditing(t.cid);
                break;
              case u.fences:
                (t.get("pattern") || "```").match(/`/) && n--,
                  (r = e.fences.getCm(t.cid));
                break;
              case u.def_link:
              case u.def_footnote:
                if (i.inRef)
                  e.undo.exeCommand({
                    type: "cursor",
                    id: t.cid,
                    start: o(t.get("ref"), !0),
                  });
                else {
                  var p = new RegExp(
                      "(]:\\s*)" +
                        s.escapeRegExp(t.get("href") || t.get("text"))
                    ).exec(i.lineText),
                    f = p ? p.index + p[1].length : 0;
                  e.undo.exeCommand({
                    type: "cursor",
                    id: t.cid,
                    start: t.get("ref").length + o(void 0, void 0, f),
                  });
                }
                break;
              case u.meta_block:
                for (
                  c = t.get("text").split(/\n/), f = i.ch, h = 0;
                  h < n - 1;
                  h++
                )
                  f += (c[h] || "").length + 1;
                e.undo.exeCommand({ type: "cursor", id: t.cid, start: f });
                break;
              case u.table_row:
                !(function (e) {
                  var t = e.textBefore;
                  (e.cellsBefore = l.splitTableCell(
                    t.replace(/^\s*\|/, ""),
                    !0
                  ) || [t]),
                    (e.cellsOffset = e.cellsBefore.last().length),
                    (e.cellsBefore = e.cellsBefore.length);
                })(i),
                  e.undo.exeCommand({
                    type: "cursor",
                    id: t.getNthChild(Math.max(0, i.cellsBefore - 1)).cid,
                    start: i.cellsOffset,
                  });
                break;
              default:
                e.selection.jumpIntoElemEnd(
                  e.findElemById(t.getVeryFirst(!0).cid)
                );
            }
            r &&
              (r.focus(),
              n >= r.lineCount()
                ? r.execCommand("goDocEnd")
                : r.setCursor({ line: n, ch: o(r.getLine(n)) }));
          },
          w = function (e, t, n, i) {
            var r,
              o = 0;
            for (
              n + (t.get("ahead") || 0) > i.line &&
                e.selection.jumpIntoElemBegin(
                  e.findElemById(t.getVeryFirst().cid)
                ),
                o = g(t);
              t.get("after") && n + o <= i.line;

            )
              (n += o), (o = g((t = t.get("after"))));
            t.get("children").length && !d.isType(t, u.table_row)
              ? w(e, t.getFirstChild(), n + (t.get("ahead") || 0), i)
              : n + o - ((r = t), d.isType(r, u.table_row) ? 0 : m(r)) > i.line
              ? b(e, t, i.line - n - (t.get("ahead") || 0), i)
              : e.selection.jumpIntoElemEnd(
                  e.findElemById(t.getVeryFirst(!0).cid)
                );
          };
        f.prototype.gotoLine = function (e) {
          var t = this.editor;
          try {
            w(t, t.nodeMap.getFirst(), 0, e);
          } catch (e) {
            console.warn(e.stack);
          }
        };
        var x = function (e) {
            var t = this.editor;
            try {
              w(t, t.nodeMap.getFirst(), 0, e);
            } catch (e) {
              console.warn(e.stack);
            }
            t.refocus();
          },
          C = function (e) {
            if (this.editor.focusCid) {
              var t = this.editor.findElemById(this.editor.focusCid),
                n = this.editor.getNode(this.editor.focusCid),
                i = 0,
                r = "",
                a = "",
                l = this.editor.selection.getRangy();
              if (n) {
                if (
                  ((i =
                    (function e(t, n) {
                      return (
                        (n = n || 0),
                        t
                          ? t.get("before")
                            ? e(t.get("before"), n + g(t.get("before")))
                            : t.get("parent")
                            ? e(
                                t.get("parent"),
                                n + (t.get("parent").get("ahead") || 0)
                              )
                            : n
                          : n
                      );
                    })(n) + (n.get("ahead") || 0)),
                  d.isType(n, u.fences))
                ) {
                  var c = !/`|~/.exec(n.get("pattern") || "```");
                  return (
                    !c && i++,
                    ((e = document.activeElement.classList.contains(
                      "ty-cm-lang-input"
                    )
                      ? { line: -1, before: n.get("pattern") || "```" }
                      : this.editor.fences
                          .getCm(n.cid)
                          .doc.getCursor()).before =
                      (c ? n.get("pattern") : "") +
                      this.editor.fences
                        .getCm(n.cid)
                        .getLine(e.line)
                        .substring(0, e.ch)),
                    (e.line = e.line + i),
                    (e.ch = void 0),
                    e
                  );
                }
                if (d.isType(n, u.math_block))
                  return this.editor.mathBlock.currentCm
                    ? (((e =
                        this.editor.mathBlock.currentCm.doc.getCursor()).line =
                        e.line + i + 1),
                      e)
                    : { line: i, ch: -1 };
                if (d.isType(n, u.toc)) return { line: i, before: "]" };
                if (d.isType(n, u.hr))
                  return { line: i, before: this.get("pattern") || "------" };
                if (d.isType(n, u.def_link, u.def_footnote)) {
                  var h,
                    p = this.editor.getJQueryElem(l.startContainer);
                  if ((h = p.closest(".md-def-content")).length)
                    return (
                      l.setStartBefore(h[0]),
                      { line: i, before: (r = "]: " + l.toString()) }
                    );
                  if (
                    (h = p.closest(".md-def-title")).length &&
                    p.text().length
                  )
                    return (
                      l.setStartBefore(h[0]),
                      { line: i, before: (r = '"' + l.toString()) }
                    );
                }
                if (d.isType(n, u.table, u.table_row))
                  return { line: i, ch: -1 };
                if (
                  (l.setStartBefore(t[0]),
                  (r = o(l.toHtml()).rawText()),
                  d.isType(n, u.table_cell))
                ) {
                  for (a = "", n = n.get("before"); n; )
                    (a = "\\|[^|]*" + a), (n = n.get("before"));
                  return {
                    line: i,
                    beforeRegExp: (r = a + "\\|\\s*" + s.escapeRegExp(r)),
                  };
                }
                if (d.isType(n, u.meta_block))
                  return {
                    line: (i =
                      (
                        (r = r
                          .replace(/^---/gm, "​---")
                          .replace(/\n$/g, "")).match(/\n/g) || []
                      ).length + 1),
                    before: (r = r.substring(r.lastIndexOf("\\n"))),
                  };
                if (d.isType(n, u.html_block))
                  return this.editor.htmlBlock.currentCm
                    ? (((e =
                        this.editor.htmlBlock.currentCm.doc.getCursor()).line =
                        e.line + i),
                      e)
                    : { line: i + 2, ch: -1 };
                if ("" === r && d.isType(n, u.paragraph, u.heading)) {
                  if (d.isType(n, u.heading)) {
                    var f = n.toMark();
                    if (/^\s*#/.exec(f))
                      return { line: i, beforeRegExp: "^\\s*#+\\s*" };
                  }
                  var m = n.getTopBlock();
                  if (d.isType(m, u.list, u.blockquote))
                    return { line: i, ch: 0, afterIndent: !0 };
                }
                var v = r.split(/\n/) || [r];
                return (
                  (r = v.last()),
                  {
                    line: i + v.length - 1,
                    before: r
                      .replace(/(\u200B*):(\u200B*)/g, ":")
                      .replace(/\u200B\$/g, "$"),
                  }
                );
              }
            }
          },
          F = function (e) {
            if (e)
              try {
                var t = e.ch;
                if (
                  (e.line < 0 && (e.line = this.cm.doc.lineCount() - 1),
                  e.afterIndent)
                ) {
                  var n = this.cm.doc.getLine(e.line);
                  t = (/^((\s+)|([-+*]\s)|(\[( |x)\])|>|(\d+(\.|\))\s))+/i.exec(
                    n
                  ) || [""])[0].length;
                }
                if (void 0 === t) {
                  n = this.cm.doc.getLine(e.line) || "";
                  if (e.before) t = n.indexOf(e.before) + e.before.length;
                  else if (e.beforeRegExp) {
                    var i = new RegExp(e.beforeRegExp, "g");
                    i.exec(n), (t = i.lastIndex);
                  }
                }
                this.cm.doc.setCursor({ line: e.line, ch: t > 0 ? t : 0 }),
                  t < 0 && this.cm.execCommand("goLineEnd");
              } catch (e) {
                console.warn(e.stack);
              }
          };
        n.exports = f;
      }
    ),
    $__System.registerDynamic("3b", ["32", "11"], !0, function (e, t, n) {
      this || self;
      var i = e("32"),
        r = e("11");
      const o = ["typora-root-url", "typora-copy-images-to"],
        a = [
          "title",
          "author",
          "default-code-lang",
          "end-of-line",
          "papersize",
          "margin",
          "margin-left",
          "margin-right",
          "margin-top",
          "margin-bottom",
          "append-head",
          "append-body",
        ].concat(o);
      var s = function (e) {
        (this.editor = e),
          (this.levels = []),
          (this.fileSetting = {}),
          (this.projectSetting = {}),
          (this.isLoadingProjectSetting = !1),
          (this.prevFilePath = null);
      };
      function l(e) {
        var t = {};
        function n(t) {
          var n = e(t);
          if (!n) {
            var i = t.replace(/-/g, "_");
            return e(i);
          }
          return n;
        }
        return (
          a.map((e) => {
            var i = n(e);
            !i && /^typora/.exec(e) && (i = n(e.replace(/^typora[-_]/, ""))),
              i && (t[e] = i);
          }),
          t
        );
      }
      (s.prototype.preferCRLF = function () {
        var e = this.getSetting("end-of-line") || "";
        return e.length ? "crlf" == e.toLowerCase() : File.option.preferCRLF;
      }),
        (s.prototype.preferFinalNewline = function () {
          var e = this.getSetting("prefer-final-newline") || "";
          return "true" == e.toLowerCase()
            ? 1
            : "false" == e.toLowerCase()
            ? -1
            : File.option.preferFinalNewline;
        }),
        (s.prototype.getCalculatedSetting = function () {
          return Object.assign({}, this.projectSetting, this.fileSetting);
        }),
        (s.prototype.getSetting = function (e) {
          var t =
            this.projectSetting[e] || this.projectSetting[e.toLowerCase()];
          return (
            ("unset" !== t && void 0 !== t) ||
              (t = this.fileSetting[e] || this.fileSetting[e.toLowerCase()]),
            "unset" === t || void 0 === t ? File.option[e] : t
          );
        });
      var c = ["title", "author", "subject", "creator", "epub-chapter-level"],
        d = [
          "header",
          "footer",
          "sidebar",
          "append-head",
          "append-head-extra",
          "append-body",
          "append-body-extra",
        ].concat(c);
      s.prototype.loadExportOption = function (e) {
        var t = {};
        (e.allowPerFileSetting ? d : c).forEach((e) => {
          var n =
            this.getSetting("typora-" + e) ||
            this.getSetting(e) ||
            this.getSetting(r.capitalize(e));
          void 0 !== n && (t[r.camelize(e)] = n);
        }),
          "true" === t.sidebar && (t.sidebar = !0),
          "false" === t.sidebar && (t.sidebar = !1),
          ("pdf" != e.type && "epub" != e.type) ||
            (t.appendHead && (t.userAppendHead = !0),
            t.appendBody && (t.userAppendBody = !0),
            delete t.appendHead,
            delete t.appendBody,
            delete t.appendHeadExtra,
            delete t.appendBodyExtra);
        var n = Object.assign({}, e, t);
        return (
          Object.keys(n).map((e) => {
            n[e] = "unset" == n[e] ? "" : n[e];
          }),
          n
        );
      };
      var u = null;
      (s.prototype.cacheSetting = async function () {
        (this.projectSetting = await this.getCalculatedProjectSetting()),
          u && clearTimeout(u),
          (u = setTimeout(() => {
            this.editor.imgEdit.refreshLocalImg();
          }, 100));
      }),
        (s.prototype.loadFromFile = function () {
          var e = this.editor.docMenu.buildMetaMap();
          return (this.fileSetting = e), this.fileSetting;
        }),
        (s.prototype.loadFromProject = async function (e) {}),
        (s.prototype.getCalculatedProjectSetting = async function () {
          const e = () => {
            var e = {};
            for (record of this.levels) Object.assign(e, record[1]);
            return e;
          };
          return this.isLoadingProjectSetting
            ? new Promise((t) => {
                setTimeout(() => {
                  this.isLoadingProjectSetting
                    ? setTimeout(() => {
                        t(e());
                      }, 500)
                    : t(e());
                }, 100);
              })
            : e();
        }),
        (s.prototype.onFilePathChanged = async function () {
          if (this.prevFilePath !== File.bundle.filePath) {
            this.prevFilePath = File.bundle.filePath;
            var e = [],
              t = null;
            for (record of this.levels) {
              if (!File.bundle.filePath.startsWith(record[0])) break;
              (t = record[0]), e.push(record);
            }
            (this.levels = e), await this.loadFromProject(t);
          }
        }),
        (s.prototype.searchProjectConfigByNode = async function (e) {
          e || ((this.levels = []), (e = ""));
          const t = reqnode("path"),
            n = reqnode("fs-extra");
          var a = i.getCurrentFileFolderPath() || File.getMountFolder();
          if (!a) return;
          const s = async (e) => {
              try {
                var t = await n.readFile(e + "/.editorConfig", "utf8");
                if (!t) return;
                var i = this.parseFromString(t),
                  r = {};
                return (
                  i.map((e) => {
                    e[0] || (r.notRoot = "true" !== e[1].root),
                      (e[0] && "typora" !== e[0]) ||
                        (r = Object.assign(
                          r,
                          l((t) => e[1][t])
                        ));
                  }),
                  r
                );
              } catch (e) {}
              return null;
            },
            c = async (e) => {
              try {
                var t = await n.readFile(e + "/.typoraConfig", "utf8");
                if (!t) return;
                var i = this.parseFromString(t)[0][1];
                return l((e) => i[e]);
              } catch (e) {}
              return null;
            };
          for (
            var d = !1, u = !1, h = (a = t.normalize(a)), p = [];
            h.length > 1 &&
            e != h &&
            ((this.isLoadingProjectSetting = !0), !d || !u);

          ) {
            var [f, m] = await Promise.all([
              d ? Promise.resolve(null) : s(h),
              u ? Promise.resolve(null) : c(h),
            ]);
            (d = d || !(f || {}).notRoot), (u = !!m);
            var g = null;
            (g = f && m ? Object.assign(f, m) : m || f) &&
              (o.map((e) => {
                var t = g[e];
                t && (g[e] = r.getAbsolutePath(h, t));
              }),
              p.push([h, g])),
              (h = r.pathByDeleteLastComponent(h));
          }
          (this.levels = this.levels.concat(p.reverse())),
            this.cacheSetting(),
            this.levels;
        });
      var h = {
        section: /^\s*\[(([^#;]|\\#|\\;)+)\]\s*([#;].*)?$/,
        param: /^\s*([\w\.\-\_]+)\s*[=:]\s*(.*?)\s*([#;].*)?$/,
        comment: /^\s*[!#;].*$/,
        eatNextLine: /\\\s*$/,
      };
      (s.prototype.parseFromString = function (e) {
        var t = {},
          n = null,
          i = [[n, t]];
        function r(e) {
          return e.replace(/\\([\s\\])/g, "$1").replace(/^[ \t]|[ \t]$/g, "");
        }
        var o = !1;
        return (
          e.split(/\r\n|\r|\n/).forEach(function (e) {
            var a;
            o
              ? ((t[o] += r(e)), (o = !!h.eatNextLine.exec(e) && o))
              : h.comment.test(e) ||
                (h.param.test(e)
                  ? ((a = e.match(h.param)),
                    (t[a[1]] = r(a[2])),
                    !a[3] && h.eatNextLine.exec(a[2]) && (o = a[1]))
                  : h.section.test(e) &&
                    ((a = e.match(h.section)),
                    (n = a[1].toLowerCase()),
                    (t = {}),
                    i.push([n, t])));
          }),
          i
        );
      }),
        (s.prototype.show = async function () {
          File.editor.library.tmpHideSidebar(!0);
          var e = document.querySelector("#ty-local-setting");
          e
            ? e.contentWindow.postMessage(
                {
                  type: "reload",
                  initData: {
                    workspaceSetting: await this.getCalculatedProjectSetting(),
                    fileSetting: this.fileSetting,
                  },
                },
                "*"
              )
            : (e = this.initFrame()),
            document.body.classList.add("ty-show-local-setting");
        }),
        (s.prototype.close = function () {
          File.editor.library.recoverSidebar(),
            document.body.classList.remove("ty-show-local-setting");
        }),
        (s.prototype.initFrame = function () {
          var e = document.createElement("IFRAME");
          return (
            e.setAttribute("id", "ty-local-setting"),
            e.setAttribute(
              "src",
              "http://localhost:3000/local-setting.html?os=win"
            ),
            document.body.appendChild(e),
            window.addEventListener(
              "message",
              async (t) => {
                if (t.source !== e.contentWindow) return;
                var { type: n, _callbackID: i } = t.data;
                const r = (t) => {
                  if (i) {
                    t = t || {};
                    var n = Object.assign({}, t, {
                      _callbackID: i,
                      type: "callback",
                    });
                    e.contentWindow.postMessage(n, "*");
                  }
                  i = null;
                };
                "closeLocalSetting" == n
                  ? this.close()
                  : "fetchLocalSetting" == n &&
                    r({
                      userLocale: File.option.userLocale,
                      workspaceSetting:
                        await this.getCalculatedProjectSetting(),
                      fileSetting: this.fileSetting,
                    }),
                  r();
              },
              !1
            ),
            e
          );
        }),
        (n.exports = s);
    }),
    $__System.registerDynamic(
      "3c",
      ["e", "11", "26", "32"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r = e("e"),
          o = e("11"),
          a = e("26").map,
          s =
            (e("32"),
            function (e) {
              (this.editor = e), (this.worker = null);
            }),
          l = r(r("#typora-quick-open-item-templ").html()),
          c = r(r("#typora-quick-loading-item-templ").html()),
          d = r(".typora-quick-open-list"),
          u = r(".typora-quick-open-list-inner"),
          h = r("#typora-quick-open-input input"),
          p = [],
          f = [],
          m = [],
          g = [],
          v = 0,
          y = [],
          b = "",
          w = [],
          x = 40,
          C = 8,
          F = -1,
          S = null,
          k = null,
          E = 0,
          T = !0,
          _ = -1,
          A = 20;
        function M(e, t) {
          File.isMac &&
            (t
              ? bridge.callHandler("controller.openFolder", e)
              : bridge.callHandler("path.openFile", e)),
            File.isNode &&
              (t
                ? JSBridge.invoke("app.openFolder", e, !0)
                : JSBridge.invoke("app.openFileOrFolder", e, {
                    mountFolder: (function (e, t) {
                      var n = File.isWin ? "\\" : "/";
                      return (
                        e && t && 0 == t.indexOf(e.replace(/[\/\\]$/, "") + n)
                      );
                    })(File.getMountFolder(), e)
                      ? File.getMountFolder()
                      : void 0,
                  }));
        }
        function L(e) {
          var t = File.getMountFolder();
          if (t) {
            let n = t.lastIndexOf(File.isWin ? "\\" : "/"),
              i = t.substring(0, n + 1);
            if (0 === e.indexOf(t)) return e.substring(i.length);
          }
          return (
            !k &&
              File.option.userPath &&
              (k = new RegExp("^" + o.escapeRegExp(File.option.userPath))),
            (e = k ? e.replace(k, "~") : e).length > 60
              ? e.substring(0, 30) +
                "..." +
                e.substring(e.length - 30, e.length)
              : e
          );
        }
        function N(e, t, n, i) {
          var r, a, s;
          if (e.n)
            (r = e.n),
              (a =
                e.p.replace(/[\/\\][^\/\\]+$/, "") + (File.isWin ? "\\" : "/")),
              (s = e.p);
          else {
            s = e;
            var c = /[^\\\/]+$/.exec(e);
            (r = c[0]), (a = s.substring(0, c.index));
          }
          function d(e) {
            return w.length
              ? e
                  .replace(/</g, "")
                  .replace(/>/g, "")
                  .replace(
                    new RegExp("((" + w.join(")|(") + "))", "gi"),
                    function (e, t) {
                      return (
                        "<b>" + t.replace(/</g, "").replace(/>/g, "") + "</b>"
                      );
                    }
                  )
                  .replace(/\uE27A/g, "&lt;")
                  .replace(/\uE27B/g, "&gt;")
                  .replace(/&/g, "&amp;")
                  .replace(/"/g, "&quot;")
                  .replace(/'/g, "&#39;")
              : o.escapeForPreWrap(e);
          }
          (r = d(r)), i && (r += File.isWin ? "\\" : "/");
          var u = t.children(".typora-quick-open-info-item"),
            h = l
              .clone()
              .find(".typora-quick-open-item-title")
              .html(r)
              .end()
              .find(".typora-quick-open-item-path")
              .html(d(e.rp || L(a)))
              .end()
              .attr("data-is-dir", i || !1)
              .attr("data-path", s)
              .attr("data-index", n + "")
              .addClass(_ == n ? "active" : "");
          u.length ? u.before(h) : t.append(h).css("translate3d", "(0, 0, 0)");
        }
        function D(e) {
          var t = 0;
          return (
            y.forEach(function (n) {
              n < e && (t += 20);
            }),
            t
          );
        }
        function B(e) {
          if (p.length) {
            (_ = -1 == _ ? 0 : (_ + e) % p.length),
              r(".typora-quick-open-item.active").removeClass("active"),
              r(".typora-quick-open-item[data-index='" + _ + "']").addClass(
                "active"
              );
            var t = D(_),
              n = _ * x + t,
              i = d.scrollTop();
            (n < i || n > i + x * C - 25) &&
              d.scrollTop(Math.min(n, (p.length - C) * x + D(p.length)) - 4);
          }
        }
        function R(e, t) {
          t = t || u;
          var n = p.length - v;
          function o(e, t) {
            t.append(
              c
                .clone()
                .find(".typora-quick-open-info")
                .text(
                  r.localize.getString(
                    e ? "Gathering more results" : "Searching"
                  )
                )
                .end()
            );
          }
          function a(e) {
            if (!(e < 0)) {
              t.find("[data-block-index='" + e + "']").remove();
              var a = r(
                "<div class='quick-open-group-block' data-block-index='" +
                  e +
                  "'>"
              )
                .css("position", "absolute")
                .css("top", e * A * 40 + "px")
                .css("width", "100%");
              if (((i = Math.min(n + E, e * A + A + E)), !(e * A > i))) {
                for (var s = e * A; s < i; s++)
                  s == n && E ? o(n, a) : N(p[s + v], a, s + v);
                t.append(a);
              }
            }
          }
          var s = d.scrollTop(),
            l = Math.floor(s / 40),
            h = Math.floor(l / A);
          h != F && (a((F = h) - 1), a(F), a(F + 1));
        }
        function P(e, t, n) {
          if (e) {
            var i = n.parent().show();
            return (
              t > 0 ? i.addClass("ty-has-prev") : i.removeClass("ty-has-prev"),
              !0
            );
          }
          n.parent().hide();
        }
        function I(e, t, n, i) {
          O(e),
            e.length && y.push(t),
            n.html(""),
            e.forEach(function (e, r) {
              N(e, n, t + r, i);
            }),
            P(e.length, t, n);
        }
        function O(e) {
          S &&
            _ < 0 &&
            (_ = e.findIndex(function (e) {
              return e.p == S;
            }));
        }
        function $(e) {
          var t,
            n,
            i = (w = e
              .split(/\s+/)
              .filter(o.isNotNullOrEmpty)
              .map(function (e) {
                return e
                  .replace(/[.+?^${}()|[\]\\]/g, "\\$&")
                  .replace(/\*/g, ".*");
              })).map(function (e) {
              return new RegExp("(.)?" + o.normalize(e) + "(.)?", "i");
            });
          (p = File.bundle.filePath ? [File.bundle.filePath] : []),
            (y = []),
            (_ = -1);
          var a = 0;
          File.getMountFolder()
            ? ((n = H(i, w.length ? m : m.slice(0, 12), p)),
              (t = H(i, w.length ? g : g.slice(0, 7), p)))
            : ((t = H(i, w.length ? g : g.slice(0, 7), p)),
              (n = H(i, w.length ? m : m.slice(0, 12), p)));
          var s = H(i, f, p);
          if (
            (p[0] === File.bundle.filePath && p.splice(0, 1),
            I(t, a, r("#ty-quick-open-folder-list-inner"), !0),
            I(n, (a += t.length), r("#ty-quick-open-recent-list-inner")),
            (function (e, t) {
              (F = -1),
                O(e),
                e.length && y.push(t),
                (v = t),
                u.html("").height(x * (e.length + E)),
                P(e.length + E, t, u) &&
                  (0 == v
                    ? u.prev().css("height", "0")
                    : u.prev().css("height", "auto")),
                R(0, u);
            })(s, (a += n.length)),
            (a += s.length) > 0 && !r(".typora-quick-open-item.active").length)
          ) {
            var l = r(".typora-quick-open-item")[0];
            l && l.classList.add("active");
          }
        }
        function H(e, t, n) {
          n = n || [];
          var i = File.getMountFolder() + (File.isWin ? "\\" : "/"),
            r = [],
            o = [];
          return (
            e.length
              ? (t.forEach(function (t) {
                  var a,
                    s = 0;
                  if (n.indexOf(t.p) > -1) return;
                  let l = i && 0 == t.p.indexOf(i);
                  for (var c = 0; c < e.length; c++) {
                    if (!(a = 2 * U(t.n, e[c]))) {
                      let n = t.p;
                      (n =
                        t.rp ||
                        L(
                          n.replace(/[\/\\][^\/\\]+$/, "") +
                            (File.isWin ? "\\" : "/")
                        )),
                        (t.rp = n),
                        (a = U(n, e[c]));
                    }
                    if (!a) return;
                    s += a;
                  }
                  l && (s += 3), (t.s = s), r.push(t), o.push(t.p);
                }),
                r.sort(function (e, t) {
                  var n = t.s - e.s;
                  return n || t.d - e.d;
                }))
              : ((r = t.filter(function (e) {
                  return -1 == n.indexOf(e.p);
                })).sort(function (e, t) {
                  var n =
                    (0 == t.p.indexOf(i) ? 1 : 0) -
                    (0 == e.p.indexOf(i) ? 1 : 0);
                  return n || t.d - e.d;
                }),
                (o = r.map(function (e) {
                  return e.p;
                }))),
            n.splice.apply(n, [n.length, 0].concat(o)),
            r
          );
        }
        function U(e, t) {
          e = o.normalize(e);
          var n = t.exec(e) || t.exec(o.removeDiacritics(e));
          return n
            ? ((n[1] = n[1] || ""),
              (n[3] = n[3] || ""),
              4 -
                n[1].length -
                (/\w/.test(n[1]) ? 1 : 0) -
                (/\w/.test(n[3]) ? 1 : 0))
            : 0;
        }
        function j(e) {
          (S = p[_]),
            T
              ? (File.getMountFolder() && this.setSearchState(1),
                File.isMac && bridge.callHandler("quickOpen.query", e),
                File.isNode &&
                  File.mountFolder_ &&
                  this.worker.postMessage(["quickFind", File.mountFolder_, e]))
              : this.setSearchState(0),
            $.call(this, e),
            File.isMac && bridge.callHandler("quickOpen.reindexFolderIfNeeded");
        }
        (s.prototype.init = function () {
          this.bindEvent(),
            File.isMac
              ? (this.registerBridge(),
                bridge.callHandler("quickOpen.cacheRecentFiles"))
              : File.isNode &&
                (this.initWorker(),
                (T = !1),
                JSBridge.invoke("setting.getRecentFiles").then((e) => {
                  var { files: t, folders: n } = JSON.parse(e);
                  this.setRecentFiles(t.map((e) => e.path)),
                    this.setRecentFolders(n.map((e) => e.path));
                }),
                this.cacheFolder(File.getMountFolder()),
                this.listenIpc());
        }),
          (s.prototype.registerBridge = function () {
            var e = this;
            bridge.registerHandler("quickOpen.initFileCache", function (t, n) {
              e.initFileCache.apply(e, t || []), n && n();
            }),
              bridge.registerHandler("quickOpen.updateResult", function (t, n) {
                e.updateResult(t), n && n();
              }),
              bridge.registerHandler(
                "quickOpen.setSearchState",
                function (t, n) {
                  e.setSearchState(t), n && n();
                }
              ),
              bridge.registerHandler(
                "quickOpen.setRecentFiles",
                function (t, n) {
                  e.setRecentFiles(t), n && n();
                }
              ),
              bridge.registerHandler(
                "quickOpen.setRecentFolders",
                function (t, n) {
                  e.setRecentFolders(t), n && n();
                }
              ),
              bridge.registerHandler(
                "quickOpen.updateCacheByRename",
                function (t, n) {
                  e.updateCacheByRename(t.src, t.dest), n && n();
                }
              ),
              bridge.registerHandler("quickOpen.updateCache", function (t, n) {
                e.updateCache(t.toDel, t.toAdd, t.group), n && n();
              });
          }),
          (s.prototype.bindEvent = function () {
            var e,
              t,
              n,
              i = this;
            h
              .on(
                "input",
                ((e = function () {
                  var e = h.val();
                  e != b &&
                    ((b = e.replace(/[()'"%\\\/.?]/g, " ")), j.call(i, b));
                }),
                (t = 100),
                (n = null),
                function () {
                  n ||
                    (n = setTimeout(function () {
                      e(), (n = null);
                    }, t));
                })
              )
              .on("keydown", function (e) {
                var t = e.keyCode || e.which;
                if ("Esc" == a[t] || ("o" == a[t] && e.shiftKey && e.metaKey))
                  return i.close(), !1;
                if ("Tab" == a[t]) return !1;
                if ("Up" == a[t]) return B(-1), !1;
                if ("Down" == a[t]) return B(1), !1;
                if ("Enter" == a[t]) {
                  var n = r(".typora-quick-open-item.active")[0];
                  if (n)
                    return (
                      M(n.dataset.path, n.dataset.isDir + "" == "true"),
                      i.close(),
                      !1
                    );
                }
                if (File.isMac && e.ctrlKey && !e.metaKey && !e.shiftKey) {
                  if ("P" == String.fromCharCode(t)) return B(-1), !1;
                  if ("N" == String.fromCharCode(t)) return B(1), !1;
                }
                e.stopPropagation();
              })
              .on("blur", function () {
                setTimeout(i.close, 200);
              }),
              d
                .on("mousedown", ".typora-quick-open-item", function (e) {
                  1 == e.which &&
                    M(this.dataset.path, this.dataset.isDir + "" == "true");
                })
                .on("scroll", R);
          }),
          (s.prototype.listenIpc = function () {
            var e = this;
            reqnode("electron").ipcRenderer.on(
              "updateQuickOpenCache",
              function (t, n) {
                e.updateCache(n.toDel, n.toAdd, n.group);
              }
            );
          }),
          (s.prototype.stopQuery = function () {
            File.isMac && bridge.callHandler("quickOpen.stopQuery"),
              File.isNode && this.worker.postMessage(["stopQuery"]);
          }),
          (s.prototype.initWorker = function () {
            this.worker = new Worker("appsrc/finder-worker.js");
            var e = this;
            (this.worker.onmessage = function (t) {
              switch (t.data.type) {
                case "initFileCache":
                  e.initFileCache.apply(e, t.data.detail);
                  break;
                case "addInitFiles":
                  e.addInitFiles.apply(e, t.data.detail);
                  break;
                case "removeInitFiles":
                  e.removeInitFiles.apply(e, t.data.detail);
                  break;
                case "queryMatch":
                  e.updateResult.apply(e, t.data.detail);
                  break;
                case "queryEnd":
                  e.setSearchState.apply(e, [0]);
              }
            }),
              window.dirname &&
                this.worker.postMessage(["nodeInit", window.dirname]),
              this.worker.postMessage([
                "setSupportTextBundle",
                File.option.supportTextBundle,
              ]);
          }),
          (s.prototype.cacheFolder = function (e) {
            (T = !0),
              (f = []),
              File.isNode && this.worker.postMessage(["listAllFiles", e]);
          }),
          (s.prototype.show = function () {
            var e = r("#typora-quick-open:not(:visible)").show();
            this.editor.searchPanel.closePanel(!0),
              e.length &&
                (h[0].select(),
                (_ = -1),
                j.call(this, h.val().replace(/[()'"%\\\/.?]/g, " "))),
              Analytics.record("QuickOpen");
          }),
          (s.prototype.close = function () {
            r("#typora-quick-open:visible").hide().length &&
              File.isMac &&
              bridge.callHandler("quickOpen.stopQuery"),
              (_ = -1);
          }),
          (s.prototype.appendResultAtEnd = function (e, t) {
            var n = u.children().last();
            return (
              !!(
                n.hasClass("quick-open-group-block") &&
                n[0].childElementCount + e.length <= A
              ) &&
              (e.forEach(function (e, i) {
                N(e, n, t + i);
              }),
              !0)
            );
          }),
          (s.prototype.updateResult = function (e) {
            e = e.filter(function (e) {
              return "object" == typeof e && (e.rp = ""), -1 == p.indexOf(e);
            });
            var t = p.length;
            e.length &&
              ((p = p.concat(e)),
              u.height(x * (p.length - v + E)),
              (p.length - t == e.length && this.appendResultAtEnd(e, t)) ||
                ((F = -1), u.html(""), R(0, u)));
          }),
          (s.prototype.addInitFiles = function (e, t, n) {
            var i = {};
            f = (f = f.concat(
              e.map(function (e, i) {
                return { n: t[i], p: e, d: n[i] };
              })
            )).filter(function (e) {
              return !i[e.p] && ((i[e.p] = 1), !0);
            });
          }),
          (s.prototype.removeInitFiles = function (e) {
            var t = e.length;
            (f = f.filter(function (n) {
              return n.p.substring(0, t) != e;
            })),
              this.updateCache(e);
          }),
          (s.prototype.initFileCache = function (e, t, n, i, o) {
            (f = e.map(function (e, i) {
              return { n: t[i], p: e, d: n[i] };
            })),
              o &&
                (m = o.map(function (e) {
                  return { n: (/[^\\\/]+$/.exec(e) || [])[0] || "", p: e };
                })),
              (T = i > e.length),
              r("#typora-quick-open:visible").length &&
                0 == w.length &&
                this.updateResult(f);
          }),
          (s.prototype.updateCache = function (e, t, n) {
            var i = File.isWin ? "\\" : "/";
            if (
              (e &&
                [m, g].forEach(function (t) {
                  t.removeIf(function (t) {
                    return (
                      t.p != e &&
                        0 != (e + i).indexOf(t.p) &&
                        File.isNode &&
                        JSBridge.invoke("setting.removeRecentDocument", e),
                      !0
                    );
                  });
                }, this),
              t && t != File.bundle.filePath)
            ) {
              var r = { recentFiles: m, recentFolders: g }[n];
              r.removeIf(function (e) {
                return e.p == t;
              }),
                r.unshift({ n: (/[^\\\/]+$/.exec(t) || [])[0] || "", p: t });
            }
          }),
          (s.prototype.updateCacheByRename = function (e, t) {
            var n = File.isWin ? "\\" : "/",
              i = [m, g];
            File.isNode && i.push(f),
              i.forEach(function (i) {
                i.forEach(function (i) {
                  (i.p != e && 0 != i.p.indexOf(e + n)) ||
                    ((i.p = t + i.p.substring(e.length)),
                    (i.n = (/[^\\\/]+$/.exec(i.p) || [])[0] || ""));
                });
              }, this);
          }),
          (s.prototype.setRecentFiles = function (e) {
            m = e.map(function (e) {
              return { n: (/[^\\\/]+$/.exec(e) || [])[0] || "", p: e };
            });
          }),
          (s.prototype.setRecentFolders = function (e) {
            g = e.map(function (e) {
              return { n: (/[^\\\/]+$/.exec(e) || [])[0] || "", p: e };
            });
          }),
          (s.prototype.setSearchState = function (e) {
            if (E !== e) {
              if (e && i == p.length - v)
                r(".typora-quick-open-item:last").after(
                  c
                    .clone()
                    .find(".typora-quick-open-info")
                    .text(
                      r.localize.getString(
                        i ? "Gathering more results" : "Searching"
                      )
                    )
                    .end()
                ),
                  i++;
              else if (!e) {
                if (r(".typora-quick-open-info-item").remove().length) {
                  var t = u.height() - 40;
                  u.height(t), t < 10 && u.parent().hide();
                }
                i == p.length - v + 1 && i--;
              }
              E = e;
            }
          }),
          (n.exports = s);
      }
    ),
    $__System.registerDynamic(
      "3d",
      ["2b", "e", "32", "26"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self, e("2b");
        var i = e("e"),
          r = e("32"),
          o = e("26").map,
          a = [
            {
              code: "en-US",
              userLang: "en-US",
              label: "English (US)",
              enLabel: "English (US)",
            },
            {
              code: "en-GB",
              userLang: "en-GB",
              label: "English (UK)",
              enLabel: "English (UK)",
            },
            {
              code: "id",
              userLang: "id-ID",
              label: "Bahasa Indonesia",
              enLabel: "Indonesian",
            },
            {
              code: "nb",
              userLang: "nb-NO",
              label: "Bokmål",
              enLabel: "Norwegian",
            },
            {
              code: "cs",
              userLang: "cs-CZ",
              label: "Čeština",
              enLabel: "Czech",
            },
            {
              code: "ca",
              userLang: "ca-ES",
              label: "Català",
              enLabel: "Catalan",
            },
            {
              code: "da",
              userLang: "da-DK",
              label: "Dansk",
              enLabel: "Danish",
            },
            {
              code: "de",
              userLang: "de-DE",
              label: "Deutsch",
              enLabel: "German",
            },
            {
              code: "de-CH",
              userLang: "de-CH",
              label: "Schweizerdeutsch",
              enLabel: "Swiss German",
            },
            {
              code: "es",
              userLang: "es-ES",
              label: "Español",
              enLabel: "Spanish",
            },
            {
              code: "el",
              userLang: "el-GR",
              label: "Ελληνικά",
              enLabel: "Greek",
            },
            {
              code: "fr",
              userLang: "fr-FR",
              label: "Français",
              enLabel: "French",
            },
            {
              code: "gl",
              userLang: "gl-ES",
              label: "Galego",
              enLabel: "Galician",
            },
            {
              code: "hr",
              userLang: "hr-HR",
              label: "Hrvatski",
              enLabel: "Croatian",
            },
            {
              code: "it",
              userLang: "it-IT",
              label: "Italiano",
              enLabel: "Italian",
            },
            {
              code: "ro",
              userLang: "ro-RO",
              label: "Limba Română",
              enLabel: "Romanian",
            },
            {
              code: "nl",
              userLang: "nl-NL",
              label: "Nederlands",
              enLabel: "Dutch",
            },
            {
              code: "hu",
              userLang: "hu-HU",
              label: "Magyar",
              enLabel: "Hungarian",
            },
            {
              code: "ms",
              userLang: "ms-MY",
              label: "Orang Melayu",
              enLabel: "Malay",
            },
            {
              code: "pl",
              userLang: "pl-PL",
              label: "Polski",
              enLabel: "Polish",
            },
            {
              code: "pt-BR",
              userLang: "pt-BR",
              label: "Português (Brasil)",
              enLabel: "Portuguese (Brazil)",
            },
            {
              code: "pt",
              userLang: "pt-PT",
              label: "Português (Portugal)",
              enLabel: "Portuguese (Portugal)",
            },
            {
              code: "ru",
              userLang: "ru-RU",
              label: "Ру́сский",
              enLabel: "Russian",
            },
            {
              code: "sk",
              userLang: "sk-SK",
              label: "Slovenčina",
              enLabel: "Slovak",
            },
            {
              code: "sl",
              userLang: "sl-SI",
              label: "Slovenščina",
              enLabel: "Slovenian",
            },
            {
              code: "sv",
              userLang: "sv-SE",
              label: "Svenska",
              enLabel: "Swedish ",
            },
            {
              code: "vi",
              userLang: "vi-VN",
              label: "Tiếng Việt",
              enLabel: "Vietnamese",
            },
            {
              code: "tr",
              userLang: "tr-TR",
              label: "Türkçe",
              enLabel: "Turkish",
            },
            {
              code: "uk",
              userLang: "uk-UA",
              label: "Українська мова",
              enLabel: "Ukrainian",
            },
            {
              code: "fa",
              userLang: "fa-IR",
              label: "فارسی",
              enLabel: "Persian",
            },
            {
              code: "hi",
              userLang: "hi-IN",
              label: "हिन्दी",
              enLabel: "Hindi",
            },
            {
              code: "ar",
              userLang: "ar-SA",
              label: "العربية",
              enLabel: "Arabic",
            },
            {
              code: "he",
              userLang: "he-IL",
              label: "עִבְרִית",
              enLabel: "Hebrew",
            },
            {
              code: "ko",
              userLang: "jo-KR",
              label: "한국어",
              enLabel: "Korean",
            },
            { code: "zh", userLang: "zh", label: "中文", enLabel: "Chinese" },
            {
              code: "ja",
              userLang: "ja-JP",
              label: "日本語",
              enLabel: "Japanese",
            },
          ],
          s = "auto",
          l = function (e) {
            (this.editor = e),
              (this.perFileSettingCache_ = new Map()),
              (this.langMode_ = File.option.presetSpellCheck),
              this.missingLocale_,
              this.clear_();
            var t = this;
            window.requestIdleCallback
              ? requestIdleCallback(function () {
                  t.init_(), t.reset();
                })
              : setTimeout(function () {
                  t.init_(), t.reset();
                }, 100);
          };
        (l.prototype.useHunSpell = function () {
          return !/Windows NT (8|10)\./.exec(navigator.userAgent);
        }),
          (l.prototype.loadEnvLang_ = function () {
            var e = new Map();
            (this.labelMap = {}),
              a.forEach(function (t) {
                e.set(t.userLang, t.code), (this.labelMap[t.code] = t.label);
              }, this);
            var t = File.option.userLocale,
              n = e.get(t);
            n ||
              (n = /^zh/.exec(t)
                ? "zh"
                : e.get(File.option.appLocale || "en-US") || "en-US"),
              (this.envLang_ = n);
          }),
          (l.prototype.loadSettingForFile_ = function () {
            if (this.spellCheckFactory) {
              File.bundle.filePath
                ? this.perFileSettingCache_.has(File.bundle.filePath)
                  ? (this.langMode_ =
                      this.perFileSettingCache_.get(File.bundle.filePath) ||
                      File.option.presetSpellCheck)
                  : ((this.langMode_ = r.getItemInDB(
                      "[spellcheck]" + File.bundle.filePath
                    )),
                    this.perFileSettingCache_.set(
                      File.bundle.filePath,
                      this.langMode_
                    ),
                    (this.langMode_ =
                      this.langMode_ || File.option.presetSpellCheck))
                : (this.langMode_ = File.option.presetSpellCheck);
              var e = this;
              this.langMode_ != s &&
                "disabled" != this.langMode_ &&
                File.isNode &&
                setTimeout(async function () {
                  e.curSpellchecker = await e.getSpellChecker(e.langMode_, !0);
                }, 1e3);
            }
          }),
          (l.prototype.init_ = function () {
            File.isNodeHtml &&
              ((this.$label = document.querySelector("#footer-spell-check")),
              this.bindUI_(),
              File.isNode &&
                ((this.detectTimer_ = null),
                this.loadEnvLang_(),
                this.bindSpellChecker_()));
          }),
          (l.prototype.bindUI_ = function () {
            var e = this;
            i("#footer-spell-check").on("click", function () {
              document.body.classList.contains("ty-show-spell-check")
                ? e.hide()
                : e.show();
            }),
              i("#spell-check-panel")
                .on("click", "[data-spell-lang]", function () {
                  e.setLangMode(this.dataset.spellLang, !0),
                    e.hide(),
                    document
                      .querySelector("#footer-spell-check")
                      .classList.contains("ty-spell-check-dict-error") &&
                      e.showDictMissing();
                })
                .on("click", "#ty-spell-check-global-setting", function () {
                  e.hide(),
                    File.megaMenu.highlight("spellcheck-option-wrapper");
                });
            const t = File.option.useMirrorInCN ? "typora.com.cn" : "typora.io";
            i("#md-notification")
              .on("click", ".dropdown-toggle", function () {
                i("#md-notification .dropdown-menu:visible").length
                  ? i("#md-notification .dropdown-menu")
                      .parent()
                      .removeClass("open")
                  : i("#md-notification .dropdown-menu").dropdown("toggle");
              })
              .on("blur", ".dropdown-toggle", function () {
                i("#md-notification .dropdown-menu")
                  .parent()
                  .removeClass("open");
              })
              .on("shown.bs.dropdown", function (e) {
                var t = i(this),
                  n = t.find(".dropdown-toggle-split"),
                  r = t.find(".dropdown-menu"),
                  o = n.offset();
                (o.top += n[0].clientHeight + 4),
                  (o.left += n[0].clientWidth - r[0].clientWidth + 2),
                  r.offset(o);
              })
              .on(
                "click",
                "#ty-spell-check-dict-missing-disable-btn",
                function () {
                  e.setLangMode("disabled", !0),
                    document.body.classList.remove("ty-show-notification");
                }
              )
              .on(
                "click",
                "#ty-spell-check-dict-missing-close-btn",
                function () {
                  document.body.classList.remove("ty-show-notification");
                }
              )
              .on(
                "click",
                "#ty-spell-check-dict-missing-primary-btn",
                function () {
                  e.useHunSpell()
                    ? e.askDownloadDict_()
                    : JSBridge.showInBrowser(
                        `https://support.${t}/Spellcheck/`
                      );
                }
              )
              .on(
                "mousedown",
                "#ty-spell-check-dict-missing-secondary-btn",
                function () {
                  e.useHunSpell()
                    ? JSBridge.showInBrowser(`https://support.${t}/Spellcheck/`)
                    : e.askDownloadDict_();
                }
              ),
              i("#dict-install-dialog").on(
                "click",
                ".btn-primary",
                function () {
                  e.doDownloadDict_();
                }
              );
          }),
          (l.prototype.postSetSpellChecker_ = function (e, t) {
            try {
              this.resetSpellCheckProvider_();
            } catch (e) {
              console.sendError(e);
            }
            var n;
            this.userDictPath &&
              (null == this.curSpellchecker && this.downloadDicts[e] <= 1
                ? i("#footer-spell-check")
                    .attr(
                      "ty-hint",
                      i.localize
                        .getString("Spell Check (%@ downloading)")
                        .replace("%@", this.labelMap[e])
                    )
                    .removeClass("ty-spell-check-dict-error")
                    .addClass("ty-spell-check-dict-downloading")
                : (i("#footer-spell-check").removeClass(
                    "ty-spell-check-dict-downloading"
                  ),
                  null == this.curSpellchecker && t
                    ? (i("#footer-spell-check")
                        .attr(
                          "ty-hint",
                          i.localize
                            .getString("Spell Check (%@ unavailable)")
                            .replace("%@", this.labelMap[e])
                        )
                        .addClass("ty-spell-check-dict-error"),
                      (this.langMode_ == s && e && /^(zh|ja|hi)/.exec(e)) ||
                        this.showDictMissing())
                    : ((n = this.labelMap[e]
                        ? (
                            i.localize.getString("Spell Check") + " (%@)"
                          ).replace("%@", this.labelMap[e])
                        : "disabled" == this.langMode_
                        ? i.localize.getString("Spell Check (Disabled)")
                        : i.localize.getString("Spell Check")),
                      i("#footer-spell-check")
                        .attr("ty-hint", n)
                        .removeClass("ty-spell-check-dict-error"),
                      i("#ty-spell-check-dict-missing-close-btn").length &&
                        document.body.classList.remove(
                          "ty-show-notification"
                        ))));
          }),
          (l.prototype.setLangMode = async function (e, t) {
            this.spellCheckFactory || ((e = "disabled"), (t = !1)),
              (this.langMode_ = e),
              File.bundle.filePath &&
                t &&
                (r.setItemInDB("[spellcheck]" + File.bundle.filePath, e),
                this.perFileSettingCache_.set(
                  File.bundle.filePath,
                  this.langMode_
                ));
            var n,
              o = this.curSpellchecker,
              a = !1;
            "disabled" == this.langMode_
              ? (this.curSpellchecker = null)
              : this.langMode_ == s
              ? this.langAuto_
                ? ((n = this.langAuto_),
                  (this.curSpellchecker = await this.getSpellChecker(
                    this.langAuto_,
                    !0
                  )),
                  (a = !0))
                : ((this.curSpellchecker = null),
                  this.spellCheckFactory.clearCache(),
                  this.scheduleAutoUpdateLang())
              : ((n = this.langMode_),
                (this.curSpellchecker = await this.getSpellChecker(
                  this.langMode_,
                  !0
                )),
                (a = !0)),
              this.postSetSpellChecker_(n, a),
              o &&
                o != this.curSpellchecker &&
                (o || {}).lang != (this.curSpellchecker || {}).lang &&
                i("[contenteditable='true']")
                  .prop("contenteditable", !1)
                  .prop("contenteditable", !0),
              this.updatePanel();
          }),
          (l.prototype.buildPanel_ = function () {
            if (!this.panelBuilt_) {
              (this.$panel = i("#spell-check-panel")),
                this.renderLangCandidate_(a);
              var e = this;
              this.panelBuilt_ = !0;
              var t = null;
              i("#ty-spell-check-panel-item-label")
                .on("keydown", function (t) {
                  t.stopPropagation();
                  var n = t.keyCode || t.which;
                  if ("Esc" == o[n]) e.hide();
                  else {
                    if ("Tab" == o[n]) return !1;
                    if ("Up" == o[n] || "Down" == o[n])
                      return e.selectMove_("Up" == o[n]), !1;
                    "Enter" == o[n]
                      ? i("[data-spell-lang].ty-active").trigger("click")
                      : ("Backspace" != o[n] && "Delete" != o[n]) ||
                        i(this).trigger("input");
                  }
                })
                .on("input cut copy", function (n) {
                  t && clearTimeout(t),
                    (t = setTimeout(function () {
                      e.updateLangCandicate_(), (t = null);
                    }, 50));
                }),
                this.updatePanel();
            }
          }),
          (l.prototype.renderLangCandidate_ = function (e) {
            var t = this.$panel[0].querySelector(".ty-lang-list"),
              n = this.$panel[0]
                .querySelector("#ty-spell-check-panel-item-temp")
                .innerText.trim(),
              i = this.langMode_,
              r = e
                .map(function (e) {
                  return n
                    .replace("%label", e.label)
                    .replace(/%code/g, e.code)
                    .replace(/%select/, i == e.code ? "ty-checked" : "");
                })
                .join("");
            t.innerHTML = r;
          }),
          (l.prototype.updateLangCandicate_ = function () {
            var e = i("#ty-spell-check-panel-item-label")
              .val()
              .trim()
              .toLocaleLowerCase();
            if (!e)
              return this.renderLangCandidate_(a), void this.ensureHighlight_();
            if (!this.$panel[0].style.height) {
              var t = this.$panel[0];
              t.style.height = t.clientHeight + "px";
            }
            var n = {},
              r = a.filter(function (t) {
                var i = [t.code, t.userLang, t.label, t.enLabel]
                  .map(function (t) {
                    var n = t.toLocaleLowerCase().indexOf(e);
                    return ~n ? n : 99;
                  })
                  .sort()[0];
                return 99 != i && ((n[t.code] = i), !0);
              });
            (r = r.sort(function (e, t) {
              return n[e.code] - n[t.code];
            })),
              this.renderLangCandidate_(r),
              this.ensureHighlight_();
          }),
          (l.prototype.ensureHighlight_ = function () {
            var e = this.$panel.find(".ty-active");
            return (
              e.length ||
                (e = this.$panel
                  .find(".ty-lang-list>.ty-spell-check-panel-item")
                  .first()
                  .addClass("ty-active")),
              e
            );
          }),
          (l.prototype.selectMove_ = function (e) {
            var t = this.ensureHighlight_(),
              n = e ? t.prev() : t.next();
            t.removeClass("ty-active"), n.addClass("ty-active");
          }),
          (l.prototype.getSpellCheckLang_ = function () {
            return "disabled" == this.langMode_
              ? null
              : this.langMode_ == s
              ? this.langAuto_ || ""
              : this.langMode_;
          }),
          (l.prototype.updatePanel = function () {
            var e = this.getSpellCheckLang_();
            i("#footer-spell-check-label").html(
              (e || "").toUpperCase() ||
                '<span class="ty-icon ty-spellcheck" style="font-size: 1.1em;vertical-align: middle;"></span>'
            ),
              this.panelBuilt_ &&
                (this.$panel.find(".ty-checked").removeClass("ty-checked"),
                this.$panel
                  .find("[data-spell-lang='" + this.langMode_ + "']")
                  .addClass("ty-checked"),
                this.$panel
                  .find(
                    "[data-spell-lang='auto'] .ty-spell-check-panel-item-code"
                  )
                  .text(this.langAuto_ || ""));
          }),
          (l.prototype.show = function () {
            this.loadSpellCheckErr && this.showLoadModuleError_(),
              (this.editor.lastCursor = this.editor.selection.buildUndo()),
              this.buildPanel_(),
              document.body.classList.add("ty-show-spell-check"),
              document.body.classList.remove("ty-show-word-count"),
              this.autoUpdateLang(!0),
              setTimeout(function () {
                document
                  .querySelector("#ty-spell-check-panel-item-label")
                  .focus();
              }, 10),
              (this.$panel[0].style.height = "");
          }),
          (l.prototype.hide = function () {
            document.body.classList.remove("ty-show-spell-check"),
              this.editor.restoreLastCursor(),
              i("#ty-spell-check-panel-item-label").val(""),
              this.$panel.find(".ty-active").removeClass("ty-active"),
              (this.$panel[0].style.height = ""),
              this.renderLangCandidate_(a);
          }),
          (l.prototype.askDownloadDict_ = function () {
            var e = i("#dict-install-dialog"),
              t = this.missingLocale_;
            e.find("#dict-install-dialog-title").text(
              i.localize
                .getString("Download dictionary file for %@")
                .replace("%@", t.label)
            );
            var n = "https://dict.typora.io/" + t.code + "/LICENSE";
            e.modal({ backdrop: "static" }).focus(),
              setTimeout(function () {
                var t = e.find("webview").attr("src", n);
                File.colorBrightness < 0.5 &&
                  t.length &&
                  t[0].addEventListener("did-stop-loading", () => {
                    File.colorBrightness < 0.5 &&
                      t[0].insertCSS("body{color:white}");
                  });
              }, 100);
          }),
          (l.prototype.onFinishDownloadProgress_ = function (e) {
            this.getSpellCheckLang_() == e &&
              ((this.downloadDicts[e] = void 0),
              this.spellCheckFactory.clearCache(),
              i("#footer-spell-check").addClass(
                "ty-spell-check-dict-downloaded"
              ),
              this.setLangMode(e),
              setTimeout(function () {
                i("#footer-spell-check").removeClass(
                  "ty-spell-check-dict-downloaded"
                );
              }, 1e3));
          }),
          (l.prototype.onUpdateDownloadProgress_ = function (e, t, n) {
            var r = this.downloadDictsDetail_,
              o = t || 0;
            t < 0
              ? ((r[e] = void 0), (this.downloadDicts[e] = void 0))
              : (r[e] || (r[e] = [0, 0]),
                void 0 !== t && (r[e][0] = t),
                void 0 !== n && (r[e][1] = n),
                (o = (r[e][0] + r[e][1]) / 2),
                (this.downloadDicts[e] = o)),
              this.getSpellCheckLang_() == e &&
                (t < 0
                  ? (i("#footer-spell-check")
                      .attr(
                        "ty-hint",
                        i.localize
                          .getString("Spell Check (%@ unavailable)")
                          .replace("%@", this.labelMap[e])
                      )
                      .addClass("ty-spell-check-dict-error")
                      .removeClass("ty-spell-check-dict-downloading"),
                    (document.querySelector(
                      "#footer-spell-check-download-process"
                    ).innerText = ""))
                  : (i("#footer-spell-check")
                      .attr(
                        "ty-hint",
                        i.localize
                          .getString("Spell Check (%@ downloading)")
                          .replace("%@", this.labelMap[e])
                      )
                      .removeClass("ty-spell-check-dict-error")
                      .addClass("ty-spell-check-dict-downloading"),
                    (document.querySelector(
                      "#footer-spell-check-download-process"
                    ).innerText =
                      "#footer-spell-check.ty-spell-check-dict-downloading:before {width: " +
                      100 * o +
                      "%;}")));
          }),
          (l.prototype.doDownloadDict_ = function () {
            var e = this.missingLocale_.code;
            JSBridge.invoke("setting.downloadDict", e),
              this.onUpdateDownloadProgress_(e, 0, 0),
              document.body.classList.remove("ty-show-notification");
          }),
          (l.prototype.bindSpellChecker_ = function () {
            var e = this;
            try {
              var t = reqnode("electron").ipcRenderer;
              t.on("dict-loaded", function (t, n) {
                (e.userDictPath = n),
                  e.spellCheckFactory.setUserDictionaryPath(e.userDictPath),
                  e.langMode_ && e.setLangMode(e.langMode_);
              }),
                (this.downloadDicts = {}),
                (this.downloadDictsDetail_ = {}),
                t.on("dict-download-start", function (t, n) {
                  e.onUpdateDownloadProgress_(n, 0, 0);
                }),
                t.on("dict-download-process", function (t, n) {
                  e.onUpdateDownloadProgress_(
                    n.locale,
                    "dic" == n.type ? n.process : void 0,
                    "dic" == n.type ? void 0 : n.process
                  );
                }),
                t.on("dict-download-end", function (t, n) {
                  e.onUpdateDownloadProgress_(n, 1, 1),
                    e.onFinishDownloadProgress_(n);
                }),
                t.on("dict-download-err", function (t, n) {
                  e.onUpdateDownloadProgress_(n, -1);
                }),
                (this.spellCheckFactory = reqnode("spellchecker")),
                (this.curSpellchecker = null),
                JSBridge.invoke("setting.getDownloadingDicts").then((t) => {
                  JSON.parse(t || "[]").forEach(function (t) {
                    e.onUpdateDownloadProgress_(t, 0, 0);
                  });
                }),
                JSBridge.invoke("setting.getUserDictionaryPath")
                  .then(async (e) => {
                    (this.userDictPath = e),
                      this.userDictPath,
                      this.userDictPath &&
                        this.spellCheckFactory.setUserDictionaryPath(
                          this.userDictPath
                        );
                    var n = new (reqnode("events").EventEmitter)();
                    (n.add = function (e, n) {
                      (n = n.replace(/[’]/g, "'")),
                        t.send("user-dict-add", { lang: e, word: n });
                    }),
                      (n.remove = function (e, n) {
                        (n = n.replace(/[’]/g, "'")),
                          t.send("user-dict-remove", { lang: e, word: n });
                      });
                    var i = await JSBridge.invoke("setting.getUserDict"),
                      r = i ? JSON.parse(i) : {};
                    (n.loadUserDict = function () {
                      return r;
                    }),
                      t.on("user-dict-update", function (e, t) {
                        n.emit("update", t);
                      }),
                      this.spellCheckFactory.setUserDictProvider(n),
                      this.resetSpellCheckProvider_();
                  })
                  .catch((e) => {
                    (this.loadSpellCheckErr = e.stack || e.message),
                      console.error(e);
                  });
            } catch (e) {
              (this.loadSpellCheckErr = e.stack || e.message), console.error(e);
            }
            this.spellCheckFactory ||
              i("#footer-spell-check")
                .off("click")
                .on("click", function () {
                  e.showLoadModuleError_();
                });
          }),
          (l.prototype.showLoadModuleError_ = function () {
            this.editor.EditHelper.showDialog({
              title: i.localize.getString("Failed to load spellcheck module"),
              message: this.loadSpellCheckErr
                .split(/\n/)
                .map(function (e) {
                  return e.replace(/\((.+)(TypeMark|app)/, "(");
                })
                .join("\n"),
              type: "error",
              backdrop: "static",
            });
          }),
          (l.prototype.resetSpellCheckProvider_ = function (e) {
            var t = this;
            if ("disabled" != this.langMode_) {
              var n = this.getSpellCheckLang_() || this.envLang_ || "en-US";
              /^(zh|ja|hi)/.exec(n) && (n = "en-US"),
                reqnode("electron").webFrame.setSpellCheckProvider(n, {
                  spellCheck: function (e, n) {
                    e.length > 1e3
                      ? n([])
                      : window.requestIdleCallback(function () {
                          var i = [],
                            r = Math.min(200, e.length),
                            o = t.curSpellchecker;
                          try {
                            if (o)
                              for (var a = 0, s = 0; s < r && a < 30; s++) {
                                var l = e[s],
                                  c = o.isMisspelled(l.replace(/[’]/g, "'"));
                                c &&
                                  l.indexOf(".") > 0 &&
                                  (c = o.isMisspelled(l + ".")),
                                  c && (i.push(e[s]), a++);
                              }
                            else t.scheduleAutoUpdateLang();
                          } catch (e) {}
                          n(i);
                        });
                  },
                });
            } else this.curSpellchecker = null;
          }),
          (l.prototype.autoDetectLang_ = function () {
            var e = this.editor;
            var t = this.getSpellCheckLang_() || this.envLang_;
            return this.spellCheckFactory
              ? this.spellCheckFactory.detectLanguageForText
                ? this.spellCheckFactory.detectLanguageForText(
                    (function () {
                      for (
                        var t = e.writingArea.querySelectorAll(
                            "p, h1, h2, h3, h4, h5, h6"
                          ),
                          n = Math.min(t.length, 4),
                          i = "",
                          r = 0;
                        r < n &&
                        ((
                          t[r].querySelectorAll("[md-inline='plain']") || []
                        ).forEach(function (e) {
                          i += e.textContent;
                        }),
                        !((i += "\n").length > 100));
                        r++
                      );
                      return i;
                    })(),
                    { httpHint: t }
                  )
                : Promise.resolve("", "detectLanguageForText is not a defined")
              : Promise.resolve("");
          });
        var c = new Date();
        (l.prototype.getSpellChecker = async function (e, t) {
          e = /^(zh|ja|hi)/.exec(e || "") ? "en-US" : e;
          var n = this.spellCheckFactory.getSpellChecker(e, t);
          return new Date() - c > 5e4
            ? n
            : n ||
                (await new Promise((e) => {
                  setTimeout(e, 3e3);
                }),
                this.spellCheckFactory.getSpellChecker(e, !0));
        }),
          (l.prototype.autoUpdateLang = function (e) {
            if (!0 === e || (!this.langAuto_ && "disabled" != this.langMode_)) {
              var t = this;
              this.autoDetectLang_().then(async function (n, i) {
                if (i) console.sendError(i);
                else if (
                  (n &&
                    (/^en/.exec(n)
                      ? (n = /^en/.exec(t.envLang_) ? t.envLang_ : "en-US")
                      : /^zh/.exec(n)
                      ? (n = "zh")
                      : t.labelMap[n] || (n = null)),
                  n)
                ) {
                  if (((t.langAuto_ = n), t.updatePanel(), t.langMode_ != s))
                    return;
                  (t.curSpellchecker = await t.getSpellChecker(n, e)),
                    t.postSetSpellChecker_(n, !0);
                } else
                  e && t.langAuto_ && ((t.langAuto_ = null), t.updatePanel());
              }),
                (this.detectTimer_ = null);
            }
          }),
          (l.prototype.scheduleAutoUpdateLang = function (e) {
            if (this.langMode_ == s || e) {
              this.detectTimer_ && clearTimeout(this.detectTimer_);
              var t = this;
              this.detectTimer_ = setTimeout(function () {
                t.autoUpdateLang(e);
              }, 2e3);
            }
          }),
          (l.prototype.autoSet_ = function () {
            this.loadSettingForFile_(), this.autoUpdateLang();
          }),
          (l.prototype.clear_ = function () {
            (this.langAuto_ = ""),
              (this.curSpellchecker = null),
              this.detectTimer_ && clearTimeout(this.detectTimer_);
          }),
          (l.prototype.reset = function (e) {
            File.isNode &&
              (this.clear_(),
              this.loadSettingForFile_(),
              this.setLangMode(this.langMode_),
              e && this.scheduleAutoUpdateLang(!0));
          }),
          (l.prototype.showDictMissing = function () {
            var e = a.find(function (e) {
              return (
                e.code ==
                (this.langMode_ == s ? this.langAuto_ : this.langMode_)
              );
            }, this);
            if (e) {
              this.missingLocale_ = e;
              var t = document.querySelector(
                "#ty-spell-check-dict-missing-temp"
              ).innerText;
              i("#md-notification").html(
                t
                  .replace(
                    "$1",
                    i.localize.getString(
                      "Dictionary file is missing to enable spellcheck support for %@."
                    )
                  )
                  .replace("%@", e.label)
                  .replace(
                    "$2",
                    i.localize.getString("Install Language Support")
                  )
                  .replace("$3", i.localize.getString("Disable Spell Check"))
                  .replace("$4", i.localize.getString("Dismiss"))
              ),
                document.body.classList.add("ty-show-notification"),
                this.useHunSpell()
                  ? i("#ty-spell-check-dict-missing-secondary-btn").text(
                      i.localize.getString("Learn More…")
                    )
                  : i("#ty-spell-check-dict-missing-secondary-btn").text(
                      i.localize.getString(
                        "Install dictionary file only for Typora"
                      )
                    );
            }
          }),
          (n.exports = l);
      }
    ),
    $__System.registerDynamic("3e", [], !0, function (e, t, n) {
      this || self;
      var i,
        r = "http://www.w3.org/1999/xhtml",
        o = "undefined" == typeof document ? void 0 : document,
        a = o ? o.body || o.createElement("div") : {},
        s = a.hasAttributeNS
          ? function (e, t, n) {
              return e.hasAttributeNS(t, n);
            }
          : a.hasAttribute
          ? function (e, t, n) {
              return e.hasAttribute(n);
            }
          : function (e, t, n) {
              return null != e.getAttributeNode(t, n);
            };
      function l(e, t) {
        var n = e.nodeName,
          i = t.nodeName;
        return (
          n === i ||
          (!!(t.actualize && n.charCodeAt(0) < 91 && i.charCodeAt(0) > 90) &&
            n === i.toUpperCase())
        );
      }
      function c(e, t, n) {
        e[n] !== t[n] &&
          ((e[n] = t[n]),
          e[n] ? e.setAttribute(n, "") : e.removeAttribute(n, ""));
      }
      var d = {
          OPTION: function (e, t) {
            c(e, t, "selected");
          },
          INPUT: function (e, t) {
            c(e, t, "checked"),
              c(e, t, "disabled"),
              e.value !== t.value && (e.value = t.value),
              s(t, null, "value") || e.removeAttribute("value");
          },
          TEXTAREA: function (e, t) {
            var n = t.value;
            e.value !== n && (e.value = n);
            var i = e.firstChild;
            if (i) {
              var r = i.nodeValue;
              if (r == n || (!n && r == e.placeholder)) return;
              i.nodeValue = n;
            }
          },
          SELECT: function (e, t) {
            if (!s(t, null, "multiple")) {
              for (var n = 0, i = t.firstChild; i; ) {
                var r = i.nodeName;
                if (r && "OPTION" === r.toUpperCase()) {
                  if (s(i, null, "selected")) {
                    n;
                    break;
                  }
                  n++;
                }
                i = i.nextSibling;
              }
              e.selectedIndex = n;
            }
          },
        },
        u = 1,
        h = 3,
        p = 8;
      function f() {}
      function m(e) {
        return e.id;
      }
      var g = (function (e) {
        return function (t, n, a) {
          if ((a || (a = {}), "string" == typeof n))
            if ("#document" === t.nodeName || "HTML" === t.nodeName) {
              var s = n;
              (n = o.createElement("html")).innerHTML = s;
            } else
              (c = n),
                !i && o.createRange && (i = o.createRange()).selectNode(o.body),
                i && i.createContextualFragment
                  ? (g = i.createContextualFragment(c))
                  : ((g = o.createElement("body")).innerHTML = c),
                (n = g.childNodes[0]);
          var c,
            g,
            v,
            y = a.getNodeKey || m,
            b = a.onBeforeNodeAdded || f,
            w = a.onNodeAdded || f,
            x = a.onBeforeElUpdated || f,
            C = a.onElUpdated || f,
            F = a.onBeforeNodeDiscarded || f,
            S = a.onNodeDiscarded || f,
            k = a.onBeforeElChildrenUpdated || f,
            E = !0 === a.childrenOnly,
            T = {};
          function _(e) {
            v ? v.push(e) : (v = [e]);
          }
          function A(e, t, n) {
            !1 !== F(e) &&
              (t && t.removeChild(e),
              S(e),
              (function e(t, n) {
                if (t.nodeType === u)
                  for (var i = t.firstChild; i; ) {
                    var r = void 0;
                    n && (r = y(i)) ? _(r) : (S(i), i.firstChild && e(i, n)),
                      (i = i.nextSibling);
                  }
              })(e, n));
          }
          function M(e) {
            w(e);
            for (var t = e.firstChild; t; ) {
              var n = t.nextSibling,
                i = y(t);
              if (i) {
                var r = T[i];
                r && l(t, r) && (t.parentNode.replaceChild(r, t), L(r, t));
              }
              M(t), (t = n);
            }
          }
          function L(i, r, a) {
            var s,
              c = y(r);
            if ((c && delete T[c], !n.isSameNode || !n.isSameNode(t))) {
              if (!a) {
                if (!1 === x(i, r)) return;
                if ((e(i, r), C(i), !1 === k(i, r))) return;
              }
              if ("TEXTAREA" !== i.nodeName) {
                var f,
                  m,
                  g,
                  v,
                  w = r.firstChild,
                  F = i.firstChild;
                e: for (; w; ) {
                  for (g = w.nextSibling, f = y(w); F; ) {
                    if (
                      ((m = F.nextSibling), w.isSameNode && w.isSameNode(F))
                    ) {
                      (w = g), (F = m);
                      continue e;
                    }
                    s = y(F);
                    var S = F.nodeType,
                      E = void 0;
                    if (
                      (S === w.nodeType &&
                        (S === u
                          ? (f
                              ? f !== s &&
                                ((v = T[f])
                                  ? F.nextSibling === v
                                    ? (E = !1)
                                    : (i.insertBefore(v, F),
                                      (m = F.nextSibling),
                                      s ? _(s) : A(F, i, !0),
                                      (F = v))
                                  : (E = !1))
                              : s && (E = !1),
                            (E = !1 !== E && l(F, w)) &&
                              ("svg" == F.tagName && "svg" == w.tagName
                                ? (E = F.innerHTML == w.innerHTML)
                                : L(F, w)))
                          : (S !== h && S != p) ||
                            ((E = !0),
                            F.nodeValue !== w.nodeValue &&
                              (F.nodeValue = w.nodeValue))),
                      E)
                    ) {
                      (w = g), (F = m);
                      continue e;
                    }
                    s ? _(s) : A(F, i, !0), (F = m);
                  }
                  if (f && (v = T[f]) && l(v, w)) i.appendChild(v), L(v, w);
                  else {
                    var N = b(w);
                    !1 !== N &&
                      (N && (w = N),
                      w.actualize && (w = w.actualize(i.ownerDocument || o)),
                      i.appendChild(w),
                      M(w));
                  }
                  (w = g), (F = m);
                }
                for (; F; )
                  (m = F.nextSibling), (s = y(F)) ? _(s) : A(F, i, !0), (F = m);
              }
              var D = d[i.nodeName];
              D && D(i, r);
            }
          }
          !(function e(t) {
            if (t.nodeType === u)
              for (var n = t.firstChild; n; ) {
                var i = y(n);
                i && (T[i] = n), e(n), (n = n.nextSibling);
              }
          })(t);
          var N,
            D,
            B = t,
            R = B.nodeType,
            P = n.nodeType;
          if (!E)
            if (R === u)
              P === u
                ? l(t, n) ||
                  (S(t),
                  (B = (function (e, t) {
                    for (var n = e.firstChild; n; ) {
                      var i = n.nextSibling;
                      t.appendChild(n), (n = i);
                    }
                    return t;
                  })(
                    t,
                    ((N = n.nodeName),
                    (D = n.namespaceURI) && D !== r
                      ? o.createElementNS(D, N)
                      : o.createElement(N))
                  )))
                : (B = n);
            else if (R === h || R === p) {
              if (P === R)
                return (
                  B.nodeValue !== n.nodeValue && (B.nodeValue = n.nodeValue), B
                );
              B = n;
            }
          if (B === n) S(t);
          else if ((L(B, n, E), v))
            for (var I = 0, O = v.length; I < O; I++) {
              var $ = T[v[I]];
              $ && A($, $.parentNode, !1);
            }
          return (
            !E &&
              B !== t &&
              t.parentNode &&
              (B.actualize && (B = B.actualize(t.ownerDocument || o)),
              t.parentNode.replaceChild(B, t)),
            B
          );
        };
      })(function (e, t) {
        var n,
          i,
          r,
          o,
          a,
          l = t.attributes;
        for (n = l.length - 1; n >= 0; --n)
          (r = (i = l[n]).name),
            (o = i.namespaceURI),
            (a = i.value),
            o
              ? ((r = i.localName || r),
                e.getAttributeNS(o, r) !== a && e.setAttributeNS(o, r, a))
              : e.getAttribute(r) !== a && e.setAttribute(r, a);
        for (n = (l = e.attributes).length - 1; n >= 0; --n)
          !1 !== (i = l[n]).specified &&
            ((r = i.name),
            (o = i.namespaceURI)
              ? ((r = i.localName || r),
                s(t, o, r) || e.removeAttributeNS(o, r))
              : s(t, null, r) || e.removeAttribute(r));
      });
      n.exports = g;
    }),
    $__System.registerDynamic(
      "3f",
      ["11", "13", "32", "34", "28", "e", "3e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("13"),
          o = (r.Node, r.TYPE, e("32")),
          a = e("34"),
          s = ((i = e("11")), e("28")),
          l = e("e"),
          c = e("3e"),
          d = !1,
          u = "_recent";
        function h(e, t) {
          if (e.length && t.length) {
            if (!e[0].parentElement) return;
            let n = e.attr("data-has-sub") != t.attr("data-has-sub");
            n && e.attr("data-has-sub", t.attr("data-has-sub")),
              c(e[0], t[0], {
                childrenOnly: !n,
                getNodeKey: function (e) {
                  return e.dataset && e.dataset.path;
                },
                onBeforeElUpdated: function (e, t) {
                  e.classList.contains("file-node-collapsed") &&
                    !n &&
                    (t.classList.add("file-node-collapsed"),
                    t.classList.remove("file-node-expanded"));
                },
              });
          }
        }
        var p = o.statWrapper;
        function f(e, t) {
          return File.isMac
            ? new Promise(function (t) {
                m(e, t);
              })
            : g(e, !1, t);
        }
        function m(e, t) {
          if (!e.path) return t(null);
          bridge.callHandler("library.listDocsUnder", e.path, function (n) {
            if (!n || !n.name) return t(null);
            var r;
            (e.fetched = !0),
              (e.subdir = n.subdir),
              (e.lastModified = n.lastModified),
              (e.createDate = n.createDate),
              (e.alias = n.alias),
              ((r = e.subdir.map(function (t, n) {
                return new Promise(function (r) {
                  t.isOpen
                    ? ((t.fetched = !0), r())
                    : document.querySelector(
                        ".file-node-expanded.file-tree-node[data-path='" +
                          i.escapeSelector(t.path) +
                          "']"
                      )
                    ? m(t, function (t) {
                        (e.subdir[n] = t),
                          e.subdir[n] && (e.subdir[n].isOpen = !0),
                          r();
                      })
                    : r();
                });
              })),
              r && r.length ? Promise.all(r) : Promise.resolve()).then(
                function () {
                  (e.content = n.content),
                    (e.isDirectory = n.isDirectory),
                    (e.isFile = n.isFile),
                    (e.name = n.name),
                    t && t(e);
                }
              );
          });
        }
        function g(e, t, n) {
          var r = reqnode("fs-plus"),
            a = reqnode("path"),
            s = File.isWin ? "\\" : "/";
          return new Promise(function (l, c) {
            var u = e.path;
            if (
              ((e.name = a.basename(u) || u),
              (e.subdir = []),
              (e.content = []),
              (e.fetched = !t),
              "." == e.name[0] && !e.isOpen)
            )
              return l();
            p(u, function (a) {
              if (!a || a.shouldIgnore) return l();
              if (
                ((e.isDirectory = a.isDir),
                (e.isFile = a.isFile),
                File.option.supportTextBundle &&
                  e.isDirectory &&
                  /\.textbundle$/.exec(e.name) &&
                  ((e.type = File.FileType.TextBundle),
                  (e.isDirectory = !1),
                  (e.isFile = !0)),
                (e.lastModified = a.mtime),
                (e.createDate = a.birthtime),
                a.isFile)
              )
                return (e.fetched = !0), o.isSupportedFile(e.name) ? l(e) : l();
              if (a.isDir) {
                if (
                  (function (e) {
                    return (
                      File.bundle.filePath &&
                      e &&
                      0 ==
                        File.bundle.filePath.indexOf(
                          e.replace(/[\/\\]$/, "") + s
                        )
                    );
                  })(u)
                )
                  e.isOpen = !0;
                else if (t) return l(e);
                r.list(u, void 0, function (t, r) {
                  if (t) return l();
                  e.isOpen ||
                    (document.querySelector(
                      ".file-node-expanded.file-tree-node[data-path='" +
                        i.escapeSelector(u) +
                        "']"
                    ) &&
                      (e.isOpen = !0)),
                    Promise.all(
                      r.map(function (t) {
                        return g({ path: t }, !e.isOpen, n);
                      })
                    ).then(function (t) {
                      (e.fetched = !0),
                        "oversize" != d &&
                          File.editor.library.addWatchByUnix(e.path),
                        e.subdir.length + e.content.length > 0
                          ? l(e)
                          : (t.forEach(function (t) {
                              t &&
                                (t.isDirectory
                                  ? e.subdir.push(t)
                                  : e.content.push(t));
                            }),
                            l(e));
                    });
                });
              }
            });
          });
        }
        n.exports = class {
          constructor(e) {
            (this.parent = e),
              (this.editor = e.editor),
              (this.$template = l(
                document.querySelector("#file-library-node-template")
                  .textContent
              )),
              this.root,
              (this.noGroup = File.option.treeNoGroup || !1),
              (this.sortType = File.option.treeSortType);
          }
          getRoot() {
            return this.parent.root;
          }
          setRoot(e) {
            return (this.parent.root = e);
          }
          renderNode(e, t) {
            if (!e) return l();
            var n = this.$template.clone(),
              r = this.parent;
            this.noGroup ||
              t ||
              (e.subdir && e.subdir.sort(r.compareItem.bind(r)),
              e.content && e.content.sort(r.compareItem.bind(r))),
              e == this.getRoot()
                ? ((e.isOpen = !0), n.find(".file-node-open-state").remove())
                : e.isDirectory &&
                  e.subdir &&
                  (e.subdir.length || e.content.length) &&
                  n
                    .attr("data-has-sub", "true")
                    .addClass(
                      e.isOpen ? "file-node-expanded" : "file-node-collapsed"
                    );
            var a = e.name.lastIndexOf(".");
            if (
              ((a < 0 || e.isDirectory) && (a = e.name.length),
              n.find(".file-node-title-name-part").text(e.name.substr(0, a)),
              n.find(".file-node-title-ext-part").text(e.name.substr(a)),
              n
                .attr("data-path", e.path)
                .attr("data-is-directory", e.isDirectory),
              n.find(".file-node-icon").addClass(
                function (e) {
                  return e == this.getRoot()
                    ? e.path == u
                      ? "fa fa-history"
                      : "fa fa-folder"
                    : e.isDirectory
                    ? "fa fa-folder"
                    : e.type == File.FileType.TextBundle
                    ? "ty-icon ty-textbundle"
                    : "fa fa-file-text-o";
                }.call(this, e)
              ),
              n
                .find(".file-node-title")
                .attr("title", i.abbreviatingWithTilde(e.path)),
              e.isDirectory || n.addClass("file-library-file-node"),
              e == this.getRoot()
                ? n.addClass("file-node-root")
                : e.isDirectory ||
                  e.path != o.getCurrentFilePath() ||
                  n.addClass("active"),
              e.isDirectory)
            ) {
              var s = n.find(".file-node-children");
              if ((s.html(""), e.isOpen && e.fetched))
                if (this.noGroup) {
                  let t = (e.subdir || []).concat(e.content || []);
                  t.sort(r.compareItem.bind(r)),
                    t.forEach(function (e) {
                      s.append(this.renderNode(e));
                    }, this);
                } else
                  e.subdir.forEach(function (e) {
                    s.append(this.renderNode(e));
                  }, this),
                    e.content.forEach(function (e) {
                      s.append(this.renderNode(e));
                    }, this);
            }
            return n;
          }
          renderIfNeed() {
            return (
              !d &&
              (this.render(),
              File.isNode && this.parent.addWatch(File.getMountFolder()),
              !0)
            );
          }
          render(e) {
            d = !0;
            var t = this,
              n = File.getMountFolder();
            (t.getRoot()
              ? Promise.resolve(t.getRoot())
              : new Promise(function (e) {
                  t.parent.calcMountFolder().then(function (n) {
                    (t.parent.root = { path: n, isOpen: !0 }),
                      n
                        ? f(t.parent.root, t).then(function (n) {
                            (t.parent.root = n), e(n), (t.parent.silent = !1);
                          })
                        : e(null);
                  });
                })
            ).then(function (i) {
              i && i.path
                ? (e || 1 == d) &&
                  function () {
                    (d = "complete"),
                      l("#file-library-tree")
                        .html("")
                        .append(this.renderNode(this.getRoot()))
                        .attr("data-state", ""),
                      this.parent.markCurrentFile();
                  }.call(t)
                : (l("#file-library-tree").html(""),
                  t.parent.onLoadFolderFailed(!n));
            }),
              l("#file-library-tree").attr("data-state", "rendering").html("");
          }
          findElemFromPath(e) {
            return (
              (e = (this.findNodeFromPath(e) || {}).path),
              l(".file-tree-node[data-path='" + i.escapeSelector(e) + "']")
            );
          }
          focusToFile(e, t, n, i) {
            if (this.getRoot() && e && !0 !== d) {
              var r = File.getMountFolder(),
                o = File.isWin ? "\\" : "/",
                a = this,
                s = window.innerHeight,
                c = File.isMac ? l(".sidebar-content") : l("#file-library"),
                u = c.scrollTop();
              0 === e.indexOf(r) &&
                (function t(r, l) {
                  if (0 != l.length)
                    if (1 == l.length) {
                      var d = n ? a.findElemFromPath(e) : a.markOpenedFile(e);
                      !(function (e) {
                        if (e.length) {
                          var t = e[0].offsetTop;
                          t < u
                            ? ((u = t), c.scrollTop(u))
                            : t - u > s - 200 &&
                              ((u = t - s + 300), c.scrollTop(u));
                        }
                      })(d),
                        0 == c.scrollTop() &&
                          setTimeout(function () {
                            0 != c.scrollTop() || u || c.scrollTop(u);
                          }, 200),
                        i && i(d);
                    } else
                      (r = (r + o + l.shift()).replace(/[\\]+/, "\\")),
                        a.expandNode(a.findElemFromPath(r), r, function () {
                          t(r, l);
                        });
                })(
                  r,
                  e
                    .substr(r.length)
                    .replace(/^[\\/]+/g, "")
                    .split(/[\\/]+/) || []
                );
            }
          }
          highlight(e) {
            var t = this;
            this.focusToFile(e, !1, !0, function (e) {
              e.addClass("blink-area"),
                setTimeout(function () {
                  e.removeClass("blink-area");
                }, 2e3),
                e.length && (t.parent.nextChangeHighlight = null);
            });
          }
          markOpenedFile(e) {
            return this.parent.markOpenedFile(e).filter(".file-tree-node");
          }
          needRepaint() {
            d = !1;
          }
          findNodeFromPath(e, t) {
            if (e && this.getRoot())
              return (
                (t = t || []),
                (function e(n, r) {
                  if (n) {
                    if (i.isSamePath(n.path, r)) return n;
                    t.push(n);
                    for (var o = 0; o < (n.subdir || []).length; o++) {
                      var a = n.subdir[o];
                      if (a) {
                        if (i.isSamePath(a.path, r))
                          return (a.folderPath = n.path), a;
                        if (i.isAncestorPathOf(a.path, r)) return e(a, r);
                      }
                    }
                    var s = n.content.find(function (e) {
                      return i.isSamePath(e.path, r);
                    });
                    return s && (s.folderPath = n.path), s;
                  }
                  return null;
                })(this.getRoot(), e)
              );
          }
          expand(e, t, n) {
            var i;
            return (1 !=
              (i = t ? l(t) : this.findElemFromPath(e))[0].dataset.hasSub &&
              "true" != i[0].dataset.hasSub) ||
              !i.hasClass("file-node-collapsed")
              ? (n && n(), !1)
              : (this.expandNode(i, e, n), !0);
          }
          expandNode(e, t, n) {
            if (!0 !== d) {
              var i = this.findNodeFromPath(t, []),
                r = this;
              i &&
                ((i.isOpen = !0),
                e.children(".file-node-children").children().length
                  ? e
                      .removeClass("file-node-collapsed")
                      .addClass("file-node-expanded")
                  : (!i.fetched ||
                      (i.subdir.length > 0 && !i.subdir[0].fetched)) &&
                    e.length &&
                    e[0].parentElement
                  ? f(i, r).then(function (t) {
                      t &&
                        e.length &&
                        e[0].parentElement &&
                        (e.replaceWith(r.renderNode(t)),
                        l(".file-library-node.active").length ||
                          r.markOpenedFile(o.getCurrentFilePath()),
                        n && n());
                    })
                  : e.replaceWith(this.renderNode(i)),
                l(".file-library-node.active").length ||
                  this.markOpenedFile(o.getCurrentFilePath()),
                n && n());
            }
          }
          setSortType(e) {
            (this.sortType = e),
              JSBridge.putSetting("treeSortType", e),
              "complete" === d &&
                this.getRoot() &&
                this.getRoot().fetched &&
                this.render(!0);
          }
          setGroupByFolder(e) {
            e
              ? l("#ty-group-by-folder-btn").removeClass("active")
              : l("#ty-group-by-folder-btn").addClass("active"),
              "complete" === d &&
                this.noGroup != e &&
                ((this.noGroup = e),
                this.render(!0),
                JSBridge.putSetting("treeNoGroup", e));
          }
          onChangeForMac(e) {
            if (d) {
              var t,
                n = [],
                r = new Set(),
                o = new Set(),
                a = this,
                s = this.parent.dateAffectsSort(),
                c = l(".file-node-on-edit").attr("data-path");
              e.forEach(function (e) {
                if (
                  ((t = this.findNodeFromPath(e.path, n)),
                  (e.oldPath || e.path) != c && this.getRoot())
                )
                  if ("removed" == e.type)
                    e.path == this.getRoot().path
                      ? (this.parent.root = null)
                      : t && n.length && f.call(this, t, n.last());
                  else if ("rename" == e.type) {
                    if (e.oldPath == this.getRoot().path)
                      return void (this.parent.root = null);
                    (n = []),
                      (t = this.findNodeFromPath(e.oldPath, n)),
                      f.call(this, t, n.last()),
                      g(e.newPath, e.isDir);
                  } else
                    "created" == e.type &&
                      t != this.getRoot() &&
                      (t
                        ? s
                          ? ((t.lastModified = new Date()),
                            this.onRemoveFile(t),
                            this.onAddFile(t))
                          : r.add(n.last())
                        : (e.isDir || (e.path && !/~\.[^.]+$/.exec(e.path))) &&
                          g(e.path, e.isDir));
              }, this),
                this.getRoot()
                  ? ((a = this),
                    o.forEach(function (e) {
                      m(e, function (e) {
                        e && u.call(a, e);
                      }),
                        r.delete(e);
                    }, this),
                    r.forEach(function (e) {
                      u.call(this, e);
                    }, this))
                  : this.parent.onRootChanged();
            }
            function u(e) {
              var t = a.findElemFromPath(e.path),
                n = null;
              t.hasClass("file-node-root") &&
                (n = l(".sidebar-content").scrollTop()),
                h(t, a.renderNode(e)),
                n && l(".sidebar-content").scrollTop(n),
                p(e.path);
            }
            function p(e) {
              var t = a.parent.nextChangeHighlight;
              t && 0 == t.indexOf(e) && a.highlight(t);
            }
            function f(e, t) {
              e &&
                (a.findElemFromPath(e.path).remove(),
                a.parent.unwatchByUnix(e.path),
                e.isDirectory ? t.subdir.remove(e) : t.content.remove(e),
                t.subdir.length + t.content.length == 0 &&
                  ((e.isOpen = !1), u.call(this, t)));
            }
            function g(e, t) {
              var n = i.pathByDeleteLastComponent(e),
                s = a.findNodeFromPath(n);
              a.findNodeFromPath(e) ||
                (s &&
                  function (e, t, n) {
                    if (t.fetched && !o.has(t)) {
                      var i;
                      if (
                        (File.option.supportTextBundle &&
                          /\.textbundle$/.exec(e) &&
                          (n = !1),
                        t.content.length + t.subdir.length == 0 && o.add(t),
                        n)
                      ) {
                        if (
                          t.subdir.findIndex(function (t) {
                            return t.path == e;
                          }) > -1
                        )
                          return;
                        o.add(t);
                      } else {
                        if (
                          t.content.findIndex(function (t) {
                            return t.path == e;
                          }) > -1
                        )
                          return;
                        (i = {
                          path: e,
                          isDirectory: !1,
                          name: e.split("/").last(),
                          lastModified: new Date(),
                          createDate: new Date(),
                        }),
                          t.content.push(i);
                      }
                      r.add(t);
                    }
                  }.call(a, e, s, t),
                p(e));
            }
          }
          isPathTooDeepToDisplay(e, t) {
            return (
              (t = t || []),
              this.findNodeFromPath(e, t),
              !t.length ||
                !!e
                  .substr(t.last().path.length)
                  .replace(/^[\\/]+/, "")
                  .match(/[\\/]/)
            );
          }
          onChangeForWin(e, t, n) {
            if (
              d &&
              !this.parent.isSuppressOnChange() &&
              !this.parent.shouldIgnore(e)
            ) {
              var i = l(".file-node-on-edit").attr("data-path");
              if (e != i) {
                var r = [],
                  o = File.isWin ? "\\" : "/",
                  a = this;
                this.isPathTooDeepToDisplay(e, r) ||
                  (function (e, i, r) {
                    if (
                      ((i = i || []),
                      !t.find(function (t) {
                        return t == e || 0 == e.indexOf(t + o);
                      }))
                    ) {
                      t.push(e);
                      var l = reqnode("path").dirname(e),
                        c = a.findNodeFromPath(l);
                      if (c && c.fetched) {
                        var d = !c.isOpen;
                        "unlink" != n
                          ? g({ path: e }, d, a).then(function (t) {
                              t
                                ? ((function (e, t, n) {
                                    var i = a.findNodeFromPath(e);
                                    i && i.fetched
                                      ? i.path != e &&
                                        (a
                                          .findElemFromPath(i.path)
                                          .replaceWith(a.renderNode(t)),
                                        (i.path = t.path),
                                        (i.name = t.name))
                                      : a.onAddFile(t, n);
                                  })(e, t, c),
                                  r && r())
                                : s(e, i);
                            })
                          : s(e, i);
                      }
                    }
                  })(e, r, function () {
                    if (a.parent.useTreeStyle) {
                      var t = a.parent.nextChangeHighlight;
                      t && 0 == t.indexOf(e) && a.highlight(t);
                    }
                  });
              }
            }
            function s(e, t) {
              a.onRemoveFile(e, (t || []).last());
            }
          }
          onFileUpdated(e) {
            var t = this.findNodeFromPath(e);
            t &&
              ((t.lastModified = new Date()),
              this.parent.dateAffectsSort() &&
                (this.onRemoveFile(t), this.onAddFile(t)));
          }
          onRemoveFile(e, t) {
            var n, r;
            if (
              ("string" == typeof e
                ? ((r = e), (n = this.findNodeFromPath(r)))
                : e && e.path && (r = (n = e).path),
              n)
            ) {
              var o = t || this.findNodeFromPath(n.folderPath);
              if ((this.findElemFromPath(r).remove(), !o)) return;
              o.subdir.removeIf(function (e) {
                return i.isSamePath(e.path, n.path);
              }),
                o.content.removeIf(function (e) {
                  return i.isSamePath(e.path, n.path);
                }),
                o.subdir.length + o.content.length == 0 &&
                  this.findElemFromPath(o.path).replaceWith(this.renderNode(o));
            }
          }
          onAddFile(e, t) {
            var n = t || this.findNodeFromPath(e.folderPath),
              i = n.content.length + n.subdir.length == 0,
              r = e.isDirectory ? n.subdir : n.content;
            r.splice(0, 0, e),
              r.sort(this.parent.compareItem.bind(this.parent));
            var o = r.indexOf(e);
            if ((e.isDirectory || (o += n.subdir.length), i))
              this.findElemFromPath(n.path).replaceWith(this.renderNode(n));
            else {
              var a = this.findElemFromPath(n.path).children(
                ".file-node-children"
              );
              if (n.isOpen || a.children().length) {
                var s = this.renderNode(e)[0];
                return a[0] && a[0].insertChildAtIndex(s, o), s;
              }
            }
          }
          newFile(e) {
            this.newFileCommand(this.findElemFromPath(e), !1);
          }
          newFolderCommand(e) {
            this.newFileCommand(e, !0);
          }
          newFileCommand(e, t) {
            var n = this.editor.getJQueryElem(e).closest(".file-library-node"),
              r = n.attr("data-path"),
              o = "true" == n.attr("data-is-directory"),
              a = this;
            async function c(e, t, n, i) {
              if ((t.parent().length || (t = a.findElemFromPath(e.path)), i)) {
                if ((e.content.push(n), a.parent.isDiscardableUntitled()))
                  return (
                    await new Promise((e) => {
                      a.parent.openFile(n.path, e);
                    }),
                    h(t, a.renderNode(e, !0)),
                    a.focusToFile(n.path),
                    void setTimeout(function () {
                      a.parent.markCurrentFile(),
                        a.parent.resumeOnChange(),
                        a.renameFileCommand(a.findElemFromPath(n.path)[0], !0);
                    }, 10)
                  );
              } else e.subdir.push(n);
              h(t, a.renderNode(e, !0)),
                a.renameFileCommand(a.findElemFromPath(n.path)[0], !0);
            }
            function d() {
              var e = this.findNodeFromPath(r);
              if (e) {
                var n = (function (e, t) {
                    var n = 0;
                    return t
                      ? (e.subdir.forEach(function (e) {
                          if (e) {
                            var t = /^untitled folder( (\d+))?$/i.exec(e.name);
                            t && (n = Math.max(n, (t[2] || 0) - 0 + 1));
                          }
                        }),
                        "Untitled Folder" + (n ? " " + n : ""))
                      : (e.content.forEach(function (e) {
                          var t = /^untitled( (\d+))?\./i.exec(e.name);
                          t && (n = Math.max(n, (t[2] || 0) - 0 + 1));
                        }),
                        "Untitled" +
                          (n ? " " + n : "") +
                          "." +
                          (File.option.defaultExtension || "md"));
                  })(e, t),
                  i = File.isNode && reqnode("fs");
                try {
                  var o = this.findElemFromPath(r),
                    d = r + (File.isWin ? "\\" : "/") + n,
                    u = {
                      fetched: !0,
                      subdir: [],
                      content: [],
                      isDirectory: !!t,
                      folderPath: r,
                      isFile: !t,
                      name: n,
                      path: d,
                    };
                  a.parent.pauseOnChange(!0),
                    t
                      ? File.isNode
                        ? i.mkdir(d, function (t) {
                            t ? a.parent.resumeOnChange() : c(e, o, u, !1);
                          })
                        : bridge.callHandler(
                            "library.newFolder",
                            d,
                            function (t) {
                              t ? c(e, o, u, !1) : a.parent.resumeOnChange();
                            }
                          )
                      : File.isNode
                      ? i.writeFile(d, "", function (t) {
                          t
                            ? (s.showErrorDialog(
                                l.localize.getString("Operation Failed"),
                                t
                              ),
                              console.error(t),
                              a.parent.resumeOnChange())
                            : c(e, o, u, !0);
                        })
                      : bridge.callHandler("library.newFile", d, function (t) {
                          t ? c(e, o, u, !0) : a.parent.resumeOnChange();
                        });
                } catch (e) {
                  a.parent.resumeOnChange();
                }
              }
            }
            r ||
              ((n = l("#file-library-tree .file-node-root")),
              (r = n.attr("data-path")),
              (o = !0)),
              r &&
                (o || (r = i.pathByDeleteLastComponent(r)),
                o
                  ? ((a = this),
                    this.expandNode(n, r, function () {
                      d.call(a);
                    }))
                  : d.call(this));
          }
          renameFileCommand(e, t, n) {
            l(".file-node-on-edit").removeClass("file-node-on-edit");
            var r = this.editor
                .getJQueryElem(e)
                .closest(".file-library-node")
                .addClass("file-node-on-edit"),
              c = r.attr("data-path"),
              d = r
                .children(".file-node-content")
                .children(".file-tree-rename-div"),
              u = d.prev().text().trim(),
              h = d.children("input").val(u),
              p = this;
            if (d.length) {
              var f = l("#sidebar-content").width() - 48 - d[0].offsetLeft;
              (f = Math.min(f, 200)),
                (f = Math.max(f, 140)),
                h.width(f),
                d.closest(".file-node-content").attr("draggable", "false");
              var m = "true" === r.attr("data-is-directory");
              this.parent.bindRename(
                h,
                function (e) {
                  File.isMac
                    ? (function (e) {
                        var t = e
                            .val()
                            .replace(/[\/\\]/g, "")
                            .trim(),
                          n = i.pathByDeleteLastComponent(c) + "/" + t;
                        p.parent.pauseOnChange(!0);
                        var a = c == o.getCurrentFilePath();
                        c != n
                          ? bridge.callHandler(
                              "library.renameFile",
                              { old: c, new: n },
                              function (i) {
                                if (i) {
                                  var r = p.findNodeFromPath(c);
                                  if (!r) return;
                                  v(r, n, t),
                                    a &&
                                      setTimeout(function () {
                                        p.parent.markOpenedFile(n, !0),
                                          p.focusToFile(n);
                                      }, 200),
                                    p.parent.scheduleChangeHighlight(n);
                                } else e.val(u);
                              }
                            )
                          : e.val(u),
                          r.removeClass("file-node-on-edit"),
                          p.editor.restoreLastCursor();
                      })(e)
                    : (function (e) {
                        var n = e.val().trim();
                        if (
                          (n = File.isWin
                            ? n
                                .replace(/[\\\/:*?"<>\|\000-\031]/g, "")
                                .replace(/\.+$/, "")
                                .trim()
                            : n.replace(/[\/\\\000-\031]/g, ""))
                        ) {
                          p.parent.pauseOnChange();
                          var o =
                            i.pathByDeleteLastComponent(c) +
                            (File.isWin ? "\\" : "/") +
                            n;
                          (o = o.trim()),
                            e
                              .closest(".file-node-on-edit")
                              .removeClass("file-node-on-edit");
                          var d =
                              File.bundle.filePath &&
                              i.isAncestorPathOf(c, File.bundle.filePath),
                            h = reqnode("fs-extra");
                          i.isSamePath(c, o) || !h.existsSync(o)
                            ? (JSBridge.invoke("app.sendEvent", "willRename", {
                                oldPath: c,
                              }),
                              p.parent
                                .execRenameFileByNode(c, o)
                                .then(function ([e]) {
                                  r.removeClass("file-node-on-edit"),
                                    p.editor.restoreLastCursor(),
                                    e && (o = c),
                                    JSBridge.invoke(
                                      "app.sendEvent",
                                      "didRename",
                                      { oldPath: c, newPath: o }
                                    );
                                  var n = reqnode("path");
                                  p.parent.resumeOnChange();
                                  var i = n.basename(o),
                                    a = p.findNodeFromPath(c);
                                  if (a)
                                    if ((v(a, o, i), e)) f(e);
                                    else if (
                                      (t ||
                                        (JSBridge.invoke(
                                          "filesOp.registerUndo",
                                          o,
                                          c,
                                          l.localize
                                            .getString("Rename %@", "Panel")
                                            .replace("%@", n.basename(c))
                                        ),
                                        p.parent.scheduleChangeHighlight(o)),
                                      !File.bundle.filePath)
                                    )
                                      return;
                                }))
                            : f(
                                l.localize.getString(
                                  "File with same name already exists at target path."
                                )
                              );
                        } else g();
                        function f(e) {
                          s.showErrorDialog(
                            l.localize.getString("Rename Failed"),
                            l.localize
                              .getString('Failed to rename from "{0}" to "{1}"')
                              .format(u, n) +
                              "\n" +
                              e
                          ),
                            d && a.watchFileChange(File.bundle.filePath),
                            JSBridge.invoke("filesOp.clearUndo");
                        }
                      })(e);
                },
                g,
                m,
                !1,
                n,
                i.pathByDeleteLastComponent(c)
              ),
                h.focus();
            }
            function g() {
              h.closest(".file-node-on-edit").removeClass("file-node-on-edit"),
                d.closest(".file-node-content").attr("draggable", "true");
            }
            function v(e, t, n) {
              var i = e.path;
              p.onRemoveFile(e),
                (function e(t, n) {
                  (t.path = t.path.replace(i, n)),
                    (t.content || []).forEach((e) => {
                      e.path = e.path.replace(i, n);
                    }),
                    (t.subdir || []).forEach((t) => {
                      e(t, n);
                    });
                })(e, t),
                (e.name = n),
                p.onAddFile(e);
            }
          }
          isShown() {
            return "file-tree" == this.parent.getActiveTab();
          }
          bindEvents() {
            var e = this;
            l("#file-library-tree").on(
              "click",
              ".file-node-content",
              function (t) {
                if (1 === t.which) {
                  t.preventDefault(),
                    t.stopPropagation(),
                    document.activeElement.blur();
                  var n = l(this).parent(),
                    i = n.attr("data-path"),
                    r = n.attr("data-is-directory");
                  if (n.hasClass("file-node-on-edit")) return !1;
                  (File.isMacOrMacNode ? t.metaKey : t.ctrlKey)
                    ? e.parent.openWithCtrl(i, "true" == r)
                    : "false" == r
                    ? e.parent.openFile(i)
                    : "true" == n.attr("data-has-sub") &&
                      (n.hasClass("file-node-expanded")
                        ? (function (t, n) {
                            ((e.findNodeFromPath(n) || {}).isOpen = !1),
                              t
                                .addClass("file-node-collapsed")
                                .removeClass("file-node-expanded");
                          })(n, i)
                        : e.expandNode(n, i));
                }
              }
            );
          }
        };
      }
    ),
    $__System.registerDynamic(
      "40",
      ["11", "13", "32", "34", "26", "28", "e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r,
          o,
          a,
          s = e("11"),
          l = e("13"),
          c = l.Node,
          d = (l.TYPE, e("32")),
          u = (e("34"), (s = e("11")), e("26").map, e("28")),
          h = e("e"),
          p = h("#file-library-list-children"),
          f = h("#file-library-list"),
          m = function (e) {
            return File.option.strictMarkdown
              ? e
                  .replace(/^\s*(([\n>]+)|([-=*`\s]{3,}))/gm, "")
                  .replace(/^\s*#+\s+/gm, "")
                  .replace(/\s*[*_`$=]+\s*/gm, " ")
                  .replace(/\[([^\]]+)\]\([^)]*\)/gm, "$1")
              : e
                  .replace(/^\s*(([\n#>]+)|([-=*`\s]{3,}))/gm, "")
                  .replace(/\s*[*_`$=]+\s*/gm, " ")
                  .replace(/\[([^\]]+)\]\([^)]*\)/gm, "$1");
          },
          g = function (e, t, n, i) {
            for (var r = t + 1; r < i; r++) {
              if (e[r].indexOf(":") >= 0) return n;
              n += "\n" + e[r];
            }
            return n;
          },
          v = function (e, t) {
            var n = t.lastIndexOf(".");
            n < 0 && (n = t.length),
              e.find(".file-list-item-file-name-part").text(t.substr(0, n)),
              e.find(".file-list-item-file-ext-part").text(t.substr(n));
          },
          y = function (e, t) {
            var n,
              i = e.split(/\r*\n+/),
              r = i.length;
            if ("---" == i[0]) {
              for (var o, a = [], s = 1; s < r; s++) {
                if ("---" == i[s])
                  return (
                    a.length < 3 && a.push(m(i.slice(s + 1).join("\n") || e)),
                    a.join("\n")
                  );
                (n = /^\s*(title)\s*:(.+)$/.exec(i[s]))
                  ? (o = g(i, s, n[2], r)) && a.push(o.trim())
                  : (n = /^\s*(subtitle)\s*:(.+)$/.exec(i[s]))
                  ? (o = g(i, s, n[2], r)) && a.push(o.trim())
                  : (n =
                      /^\s*(overview|summary|description|excerpt)\s*:(.+)$/.exec(
                        i[s]
                      )) &&
                    (o = g(i, s, n[2], r)) &&
                    a.push(o.trim());
              }
              return m(e);
            }
            return m(e);
          },
          b = d.statWrapper;
        function w(e, t, n) {
          var i = File.isWin ? "\\" : "/";
          if (
            t.find(function (t) {
              return t == e || 0 == e.indexOf(t + i);
            })
          )
            return !0;
          !n && t.push(e);
        }
        var x = 400;
        n.exports = class {
          constructor(e) {
            (this.parent = e),
              (this.editor = e.editor),
              (this.$template = h(
                document.querySelector("#file-list-item-template").textContent
              )),
              (this.noGroup = File.option.listNoGroup || !1),
              (this.sortType = File.option.listSortType),
              this.setGroupByFolder(this.noGroup),
              this.registerBridge(),
              this.needRepaint(),
              File.isNode &&
                ((x =
                  Number.parseInt(File.option.maxFetchCountOnFileList) || 200),
                Number.isNaN(x) && (x = 200));
          }
          registerBridge() {
            if (File.isMac) {
              var e = this;
              bridge.registerHandler("fileList.renderAll", function (t, n) {
                if ("oversize" != i) {
                  var r = document.createDocumentFragment();
                  t[0].forEach(function (t) {
                    e.appendItemToView(t, !1, r);
                  }),
                    p.html(""),
                    p.append(r),
                    e.endRender(t[1], t[2], t[2]),
                    n && n(null);
                }
              }),
                bridge.registerHandler("fileList.appendItem", function (t, n) {
                  e.appendItemToView(t[0], t[1], void 0, { forceMark: t[2] }),
                    n && n(null);
                });
            }
          }
          isShown() {
            return this.parent.isFileTabShown() && !this.parent.useTreeStyle;
          }
          isRendering() {
            return i;
          }
          renderIfNeed() {
            return (
              !i &&
              (this.render(),
              File.isNode && this.parent.addWatch(File.getMountFolder()),
              !0)
            );
          }
          appendTreeByNode(e, t, n, r) {
            var o = reqnode("fs-plus"),
              a = reqnode("path"),
              s = this,
              l = File.option.useFsQueue;
            (n = n || 0), (t = t || function () {});
            var c = !!r;
            r = r || f;
            var u = [],
              h = 0,
              p = function () {
                u = [];
              },
              m = function () {
                if ("oversize" != i)
                  for (var e = 0; e < 20 && u.length; ) {
                    e++;
                    var t = u.shift();
                    t[1] ? g(t[0], t[2]) : v(t[0], t[2]);
                  }
                else p();
              },
              g = function (e, t) {
                h++,
                  o.readdir(e, function (e, n) {
                    h--, l && h < 50 && m(), t(e, n);
                  });
              },
              v = function (e, t) {
                h++,
                  b(e, function (e) {
                    h--, l && h < 50 && m(), t(e);
                  });
              },
              y = function (e, t, o, c) {
                if (!e) return c();
                !(function (e, t) {
                  l && h >= 50 ? u.push([e, !0, t]) : g(e, t);
                })(e, function (d, f) {
                  if (d) return c(void 0, d);
                  var m = f.length;
                  m || c();
                  var g = function () {
                    --m <= 0 && c();
                  };
                  f.forEach(function (c) {
                    var d = a.join(e, c);
                    !(function (e, t) {
                      l && h >= 50 ? u.push([e, !1, t]) : v(e, t);
                    })(d, function (a) {
                      if (i) {
                        if (!a || a.shouldIgnore) return g();
                        if (
                          (50 == n &&
                            !0 === i &&
                            "rendering" != r.attr("data-state") &&
                            r.attr("data-state", "rendering"),
                          n > x)
                        )
                          return p(), void s.endRender(!0);
                        a.isFile
                          ? t(a, c, e, d, g) && n++
                          : a.isDir && o(a, c, e, d)
                          ? y(d, t, o, g)
                          : g();
                      }
                    });
                  });
                });
              };
            y(
              e,
              function (e, t, n, i, o) {
                if (!e.shouldIgnore) {
                  var a = {
                    folderPath: n,
                    folderName: d.getFileNameFromPath(n),
                    name: t,
                    path: i,
                    lastModified: e.mtime,
                    createDate: e.birthtime,
                  };
                  return (
                    s.fetchSummaryByNode(i, e, function (e) {
                      (a.summary = e),
                        s.appendItemToView(a, !1, c ? r[0] : void 0),
                        o();
                    }),
                    !0
                  );
                }
                o();
              },
              function (e, t, n, i) {
                return !e.shouldIgnore && (s.parent.addWatchByUnix(i), !0);
              },
              t
            );
          }
          fetchAllDocsByNode() {
            var e = this;
            this.parent.calcMountFolder(!0).then(function (t) {
              e.appendTreeByNode(t || "", e.endRender.bind(e));
            });
          }
          fetchSummaryByNode(e, t, n) {
            var i,
              r = reqnode("fs-plus");
            t.isBundle && (e = t.textFile),
              r
                .createReadStream(e, { start: 0, end: 600 })
                .on("data", function (e) {
                  if ("string" == typeof e) i = e;
                  else {
                    var t = d.detectEncodeByNode(e),
                      n = d.getContentFromBuffer(e, t.replace("-bom", ""), !0);
                    i = n;
                  }
                })
                .on("end", function () {
                  void 0 === i && (i = ""), n(i);
                });
          }
          render(e) {
            if ((e && this.needRepaint(), !i)) {
              (i = !0), (r = new Date()), (o = !1);
              var t = this;
              setTimeout(function () {
                !0 === i &&
                  "rendering" != f.attr("data-state") &&
                  f.attr("data-state", "rendering");
              }, 500),
                p.html("").removeClass("show-folder-name"),
                File.isMac
                  ? this.parent.calcMountFolder(!0).then(function (e) {
                      bridge.callHandler("library.fetchAllDocs", e || "");
                    })
                  : File.isNode && this.fetchAllDocsByNode(),
                setTimeout(function () {
                  !0 === i &&
                    new Date() - r > 8e3 &&
                    (console.warn("render file list timeout"), t.endRender(!0));
                }, 1e4);
            }
          }
          endRender(e, t, n) {
            if ("oversize" != i || !e) {
              if (
                ((i = e ? "oversize" : "complete"),
                h("#file-library-list").attr("data-state", i),
                a && clearTimeout(a),
                (a = setTimeout(function () {
                  "oversize" == i &&
                    h("#file-library-list").attr("data-state", "oversize-end");
                }, 2e3)),
                !e)
              ) {
                if (t && File.getMountFolder())
                  return void this.parent.onLoadFolderFailed();
                this.parent.markCurrentFile(!1);
              }
              this.parent.silent = !1;
            }
          }
          setSortType(e) {
            if (
              ((this.sortType = e),
              JSBridge.putSetting("listSortType", e),
              "complete" === i)
            ) {
              p.html("");
              var t = document.createDocumentFragment();
              this.noGroup
                ? (this.files.sort(this.parent.compareItem.bind(this.parent)),
                  this.files.forEach(function (e) {
                    this.appendItemToView(e, !1, t);
                  }, this))
                : this.dirArr.forEach(function (e) {
                    var n = e.content;
                    (e.content = []),
                      n.forEach(function (e) {
                        this.appendItemToView(e, !1, t);
                      }, this);
                  }, this),
                p.append(t);
            }
          }
          setGroupByFolder(e) {
            if (
              (e
                ? h("#ty-group-by-folder-btn").removeClass("active")
                : h("#ty-group-by-folder-btn").addClass("active"),
              "complete" === i && this.noGroup != e)
            ) {
              (this.noGroup = e),
                JSBridge.putSetting("listNoGroup", e),
                p.html("");
              var t = document.createDocumentFragment();
              e
                ? ((this.files = []),
                  this.dirArr.forEach(function (e) {
                    this.files = this.files.concat(e.content);
                  }, this),
                  (this.dirArr = []),
                  (this.dirMap = {}),
                  this.files.sort(this.parent.compareItem.bind(this.parent)),
                  this.files.forEach(function (e) {
                    this.appendItemToView(e, !1, t);
                  }, this))
                : ((this.dirArr = []),
                  (this.dirMap = {}),
                  this.files.forEach(function (e) {
                    this.appendItemToView(e, !1, t);
                  }, this),
                  (this.files = [])),
                p.append(t),
                "oversize" == i
                  ? this.endRender(!0)
                  : "complete" == i && this.endRender(!1);
            }
          }
          getItem(e) {
            if (this.noGroup)
              for (var t = this.files.length, n = 0; n < t; n++) {
                if (this.files[n].path == e) return this.files[n];
                if (this.files[n].folderPath == e)
                  return { path: e, isDir: !0 };
              }
            else {
              if (this.dirMap[e]) return { path: e, isDir: !0 };
              var i = s.pathByDeleteLastComponent(e);
              if (this.dirMap[i])
                return this.dirMap[i].content.find(function (t) {
                  return t.path == e;
                });
            }
          }
          getIndexOnView(e, t) {
            for (var n = 0; n < e.children.length; n++) {
              if (n >= t) return t;
              e.children[n].classList.contains("ty-to-remove") && t++;
            }
            return t;
          }
          computeIndex(e) {
            return (
              this.noGroup
                ? function (e) {
                    var t = this.files.indexOf(e);
                    if (t > -1) return t;
                    t = 0;
                    for (
                      var n = 0;
                      n < this.files.length &&
                      !(this.parent.compareItem(this.files[n], e) > 0);
                      n++
                    )
                      t++;
                    return this.files.splice(t, 0, e), t;
                  }
                : function (e) {
                    var t = e.folderPath,
                      n = this.dirMap[t],
                      i = 0,
                      r = 0;
                    n ||
                      ((n = { path: t, content: [] }),
                      this.dirArr.push(n),
                      (this.dirMap[t] = n));
                    for (var o = 0; o < this.dirArr.length - 1; o++) {
                      var a = this.dirArr[o];
                      if (a.path == t) break;
                      i += a.content.length;
                    }
                    for (
                      o = 0;
                      o < n.content.length &&
                      !(this.parent.compareItem(n.content[o], e) > 0);
                      o++
                    )
                      r++;
                    return n.content.splice(r, 0, e), r + i;
                  }
            ).call(this, e);
          }
          appendItemToView(e, t, n, r) {
            if ("oversize" != i && i) {
              var a = r || {},
                l = a.forceMark,
                c = a.skipAnim,
                u = this,
                h = this.$template.clone();
              if (e && e.path && File.getMountFolder()) {
                o ||
                  (File.getMountFolder() != e.folderPath &&
                    ((o = !0), p.addClass("show-folder-name"))),
                  h
                    .attr("data-path", e.path)
                    .attr("data-create-date", e.createDate - 0)
                    .attr("data-parent-path", e.folderPath),
                  h
                    .find(".file-list-item-file-name")
                    .attr("title", s.abbreviatingWithTilde(e.path)),
                  h.children(".file-list-item-parent-loc").text(e.folderName),
                  h
                    .children(".file-list-item-time")
                    .text(s.date2NaturalLang(new Date(e.lastModified), !0)),
                  v(h, e.name);
                var f,
                  m = h.children(".file-list-item-summary");
                if (
                  (m.text(y(e.summary, e.name)),
                  m.html(m.html().replace(/([^\s]+)\s*\n+/g, "$1<br/>")),
                  e.path == d.getCurrentFilePath() && h.addClass("active"),
                  n)
                )
                  (f = this.computeIndex(e)), n.insertChildAtIndex(h[0], f);
                else {
                  var g,
                    b,
                    w = this.removeItemFromView(e, !0),
                    x = w.hasClass("active");
                  if (w && w.length)
                    return (
                      (b = w.prevAll().length),
                      (f = this.computeIndex(e)),
                      (f = this.getIndexOnView(p[0], f)),
                      b != f || e.oldPath
                        ? ((e.oldPath = void 0),
                          (g = w[0].clientHeight),
                          w.remove(),
                          p[0].insertChildAtIndex(h[0], f),
                          (x || l) && h.addClass("active"),
                          c ||
                            p.children().each(function (e) {
                              var t = this;
                              if (t == h[0])
                                (t.style.transition = "transform 0s"),
                                  (t.style.transform =
                                    "translate(0px, " + g * (b - e) + "px)");
                              else if (e >= f && e < b)
                                (t.style.transition = "transform 0s"),
                                  (t.style.transform =
                                    "translate(0px, -" + g + "px)");
                              else {
                                if (!(e >= b && e < f)) return;
                                t.style.transform =
                                  "translate(0px, " + g + "px)";
                              }
                              requestAnimationFrame(function () {
                                (t.style.transform = ""),
                                  (t.style.transition = "transform 400ms");
                              });
                            }),
                          d.getCurrentFilePath() == e.path &&
                            this.parent.markCurrentFile(),
                          C(),
                          h[0])
                        : w.find("input").length
                        ? w[0]
                        : (w.replaceWith(h), C(), h[0])
                    );
                  (f = this.computeIndex(e)),
                    (f = this.getIndexOnView(p[0], f)),
                    p[0].insertChildAtIndex(h[0], f);
                }
                return C(), h[0];
              }
            }
            function C() {
              var t = u.parent.nextChangeHighlight;
              t && 0 == t.indexOf(e.path) && u.highlight(t);
            }
          }
          removeFileOrFolder(e, t) {
            var n = this,
              i = File.isWin ? "\\" : "/";
            function r(e) {
              var i = n.findElemFromPath(e);
              i.length &&
                (t
                  ? i.remove()
                  : (i.addClass("ty-to-remove"),
                    i.hide(400, function () {
                      i.remove();
                    })));
            }
            n.noGroup
              ? (function (e) {
                  n.files.removeIf(function (t) {
                    if (t.path == e || 0 == t.path.indexOf(e + i))
                      return r(t.path), !0;
                  });
                })(e)
              : n.findElemFromPath(e).length
              ? n.removeItemFromView({ path: e }, !1, t)
              : (function (e) {
                  Object.keys(n.dirMap)
                    .clone()
                    .forEach(function (t) {
                      (t != e && 0 != t.indexOf(e + i)) ||
                        (n.dirMap[t].content.forEach(function (e) {
                          r(e.path);
                        }),
                        delete n.dirMap[t]);
                    }),
                    n.dirArr.removeIf(function (t) {
                      return t.path == e || 0 == t.path.indexOf(e + i);
                    });
                })(e);
          }
          removeItemFromView(e, t, n) {
            function i(e, t) {
              ~e.indexOf(t)
                ? e.remove(t)
                : e.removeIf(function (e) {
                    return s.isSamePath(e.path, t.oldPath || t.path);
                  }, !0);
            }
            var r = this.findElemFromPath(e.oldPath || e.path);
            if (
              (e.folderPath || (e.folderPath = r.attr("data-parent-path")),
              !r.length)
            )
              return h();
            if (this.noGroup) i(this.files, e);
            else {
              var o = this.dirMap[e.folderPath];
              o && i(o.content, e);
            }
            return (
              t ||
                (n
                  ? r.remove()
                  : (r.addClass("ty-to-remove"),
                    r.hide(400, function () {
                      r.remove();
                    }))),
              r
            );
          }
          appendItemToViewByMac(e, t, n) {
            this.appendItemToView(JSON.parse(e), t, void 0, { forceMark: n });
          }
          bindEvents() {
            var e = this;
            p.on("mousedown", ".file-list-item", function (t) {
              if ("INPUT" == document.activeElement.tagName) {
                var n = this.contains(document.activeElement);
                if ((h(document.activeElement).trigger("blur"), n)) return;
              }
              if (1 == event.which)
                return (
                  event.ctrlKey || event.metaKey
                    ? e.parent.openFileInNewWindowCommand(this)
                    : (h(".file-list-item:focus").blur(),
                      e.parent.openFile(this.getAttribute("data-path"))),
                  !1
                );
            });
            var t = 0;
            h("#file-library")
              .on("dragenter", function (n) {
                e.parent.useTreeStyle ||
                  ((n.originalEvent.dataTransfer.types || []).indexOf("Files") >
                    -1 &&
                    (n.preventDefault(),
                    n.stopPropagation(),
                    t ||
                      document
                        .querySelector("#sidebar-content")
                        .classList.add("on-drop")),
                  t++);
              })
              .on("dragover", function (e) {
                e.preventDefault(), e.stopPropagation();
              })
              .on("dragleave", function (n) {
                e.parent.useTreeStyle ||
                  --t ||
                  document
                    .querySelector("#sidebar-content")
                    .classList.remove("on-drop");
              })
              .on("drop", function (n) {
                if (
                  !e.parent.useTreeStyle &&
                  File.getMountFolder() &&
                  File.isActiveWindow()
                ) {
                  document
                    .querySelector("#sidebar-content")
                    .classList.remove("on-drop"),
                    (t = 0),
                    n.stopPropagation(),
                    n.preventDefault();
                  var i = n.originalEvent.dataTransfer,
                    r = [];
                  if ((i.files.item(o) || {}).path)
                    for (var o = 0; o < i.files.length; o++) {
                      var a = (i.files.item(o) || {}).path;
                      a && r.push(a);
                    }
                  else r = e.parent.filesInDragging || [];
                  e.parent.copyOrMoveFiles(r, File.getMountFolder());
                }
              })
              .on("click", "#switch-to-tree-on-oversize", function () {
                e.parent.switch("file-tree");
              });
          }
          needRepaint(e) {
            (e || !0 !== i) &&
              ((i = !1),
              (this.dirArr = []),
              (this.dirMap = {}),
              (this.files = []));
          }
          findNodeFromPath(e) {
            if (this.noGroup)
              return this.files.find((t) => s.isSamePath(e, t.path));
            for (var t of this.dirArr) {
              if (s.isSamePath(e, t.path)) return t;
              var n = t.content.find((t) => s.isSamePath(e, t.path));
              if (n) return n;
            }
          }
          findElemFromPath(e, t) {
            return (e = t ? e : (this.findNodeFromPath(e) || {}).path || e)
              ? h(".file-list-item[data-path='" + s.escapeSelector(e) + "']")
              : h();
          }
          onAddFile(e) {
            return this.appendItemToView(e, !0);
          }
          onChangeForMac(e) {
            if ("complete" == i && !this.parent.isSuppressOnChange()) {
              for (
                var t = [],
                  n = !1,
                  r = h("input.file-list-item-file-name")
                    .closest(".file-list-item")
                    .attr("data-path"),
                  o = 0;
                o < e.length;
                o++
              ) {
                var a = e[o];
                if ((a.oldPath || a.path) == r) return;
                if (c.isType(a.type, "created", "modified") && w(a.path, t))
                  return;
                if (!this.parent.shouldIgnore(a.path || a.newPath)) {
                  if ("rename" == a.type) {
                    if (a.isDir) {
                      n = !0;
                      break;
                    }
                    var s = d.getCurrentFilePath() == a.oldPath;
                    this.removeFileOrFolder(a.oldPath),
                      bridge.callHandler("library.updateListItem", {
                        path: a.newPath,
                        mark: s || !1,
                      });
                  } else "removed" == a.type && this.removeFileOrFolder(a.path);
                  if (a.isDir && "modified" != a.type) {
                    n = !0;
                    break;
                  }
                  "created" == a.type
                    ? (!a.isDir && /~\.[^.]+$/.exec(a.path)) ||
                      bridge.callHandler("library.updateListItem", {
                        path: a.path,
                        mark: !1,
                      })
                    : "modified" != a.type ||
                      a.isDir ||
                      ("oversize" != i &&
                        bridge.callHandler(
                          "library.updateListItemIfIsOpen",
                          a.path
                        ));
                }
              }
              if (!i && n && this.isShown()) {
                var l = h("#file-library").scrollTop();
                this.render(!0),
                  setTimeout(function () {
                    h("#file-library").scrollTop(l);
                  }, 0);
              }
            }
          }
          onChangeForWin(e, t, n) {
            if ("complete" == i && !this.parent.isSuppressOnChange()) {
              var r = this;
              this.parent.shouldIgnore(e) ||
                (e !=
                  h("input.file-list-item-file-name")
                    .closest(".file-list-item")
                    .attr("data-path") &&
                  (t
                    ? (function (e) {
                        w(e, n, !0) ||
                          (0 != r.findElemFromPath(e).length &&
                            b(e, function (t) {
                              if (t && !t.shouldIgnore && t.isFile) {
                                var i = r.getItem(e);
                                if (!i) return;
                                r.fetchSummaryByNode(e, t, function (e) {
                                  (i.summary = e),
                                    (i.lastModified = t.mtime),
                                    (i.createDate = t.birthtime),
                                    r.appendItemToView(i, !0);
                                }),
                                  n.push(e);
                              }
                            }));
                      })(e)
                    : (function (e) {
                        File.getMountFolder() &&
                          0 == e.indexOf(File.getMountFolder()) &&
                          b(e, function (t) {
                            t && !t.shouldIgnore
                              ? w(e, n) ||
                                (function (e, t) {
                                  if (t.isFile) {
                                    var n = s.pathByDeleteLastComponent(e),
                                      i = {
                                        folderPath: n,
                                        folderName: d.getFileNameFromPath(n),
                                        name: d.getFileNameFromPath(e),
                                        path: e,
                                      };
                                    r.fetchSummaryByNode(e, t, function (e) {
                                      (i.summary = e),
                                        (i.lastModified = t.mtime),
                                        (i.createDate = t.birthtime),
                                        r.appendItemToView(i, !0);
                                    });
                                  } else t.isDir && r.appendTreeByNode(e);
                                })(e, t)
                              : r.removeFileOrFolder(e);
                          });
                      })(e)));
            }
          }
          update(e, t) {
            if (void 0 !== t) {
              var n = this.parent
                .findElemFromPath(e)
                .children(".file-list-item-summary");
              n.text(y(t.substr(0, 500))),
                n.html(n.html().replace(/([^\s]+)\s*\n+/g, "$1<br/>"));
            }
          }
          highlight(e) {
            var t = this.focusToFile(e, !0);
            t &&
              (t.classList.add("blink-area"),
              setTimeout(function () {
                t.classList.remove("blink-area"),
                  (this.parent.nextChangeHighlight = null);
              }, 2e3));
          }
          focusToFile(e, t) {
            var n = this.findElemFromPath(e)[0];
            if (n) {
              var i = n ? n.offsetTop : 0,
                r = n.clientHeight,
                o = n ? { scrollTop: Math.max(0, i - r) } : null,
                a = h(File.isMac ? ".sidebar-content" : "#file-library"),
                s = a.parent().height();
              return (
                !o ||
                  (a.scrollTop() < i + 40 && s + a.scrollTop() > i + 40) ||
                  (t ? a.finish().scrollTop(o.scrollTop) : a.animate(o, 500)),
                n
              );
            }
          }
          newFile() {
            var e,
              t,
              n = this;
            function i(e, t) {
              var i = this.appendItemToView(
                {
                  folderPath: File.getMountFolder(),
                  folderName: d.getFileNameFromPath(File.getMountFolder()),
                  name: t,
                  path: e,
                  lastModified: new Date(),
                  createDate: new Date(),
                  summary: "",
                },
                !0
              );
              if (n.parent.isDiscardableUntitled())
                return (
                  n.parent.openFile(e),
                  void setTimeout(function () {
                    n.renameFileCommand(i, !0);
                  }, 100)
                );
              n.renameFileCommand(i, !0);
            }
            if (File.getMountFolder())
              if (o)
                File.isMac
                  ? bridge.callHandler(
                      "library.newFileUnder",
                      File.getMountFolder()
                    )
                  : File.FileSave.doShowSaveDialog(
                      !1,
                      File.getMountFolder() +
                        "/Untitled." +
                        (File.option.defaultExtension || "md"),
                      {
                        title: "New",
                        buttonLabel: "Create",
                        properties: ["showOverwriteConfirmation"],
                      }
                    ).then(({ filePath: e }) => {
                      e &&
                        (n.parent.scheduleChangeHighlight(e),
                        File.FileSave.saveAsUseNode(e).then(function () {
                          n.parent.openFile(e);
                        }));
                    });
              else {
                var r =
                    ((e = File.getMountFolder()),
                    (t = 0),
                    h(
                      ".file-list-item[data-parent-path='" +
                        s.escapeSelector(e) +
                        "']"
                    ).each(function () {
                      var e = /^untitled( (\d+))?\./i.exec(
                        this.querySelector(
                          ".file-list-item-file-name"
                        ).textContent.trim()
                      );
                      e && (t = Math.max(t, (e[2] || 0) - 0 + 1));
                    }),
                    "Untitled" +
                      (t ? " " + t : "") +
                      "." +
                      (File.option.defaultExtension || "md")),
                  a = File.getMountFolder() + (File.isWin ? "\\" : "/") + r;
                if (((n = this), this.parent.pauseOnChange(!0), File.isMac))
                  this.parent.pauseOnChange(!0),
                    bridge.callHandler("library.newFile", a, function (e) {
                      e
                        ? i.call(n, a, r)
                        : (n.parent.resumeOnChange(),
                          bridge.callHandler(
                            "library.newFileUnder",
                            File.getMountFolder()
                          ));
                    });
                else {
                  var l = reqnode("fs");
                  a = reqnode("path").resolve(a);
                  var c = l.openSync(a, "wx");
                  l.close(c, function () {}),
                    this.parent.pauseOnChange(!0),
                    i.call(this, a, r);
                }
              }
          }
          onFileUpdated(e, t) {
            var n = this.findNodeFromPath(e);
            if (n) {
              t && Object.assign(n, t), (n.lastModified = new Date());
              var i = this.findElemFromPath(n.path, !0);
              i.length &&
                this.appendItemToView(
                  {
                    path: e,
                    folderPath: i.attr("data-parent-path"),
                    folderName: i.children(".file-list-item-parent-loc").text(),
                    lastModified: n.lastModified,
                    createDate: n.createDate,
                    name: d.getFileNameFromPath(e),
                    summary: n.summary,
                    oldPath: e,
                  },
                  !0
                );
            }
          }
          newFileCommand(e) {
            this.newFile();
          }
          renameFileCommand(e, t) {
            (e = h(e).closest(".file-library-node")[0]),
              File.isMac && bridge.callHandler("window.focus");
            var n = this,
              i = h("<input class='file-list-item-file-name' />"),
              r = h(e).find(".file-list-item-file-name"),
              o = r.clone(),
              a = e.getAttribute("data-path"),
              l = r.children().text();
            function c(t, r) {
              if (
                ((r = r.trim()),
                (t = t.trim()),
                v(o, t),
                i.replaceWith(o),
                a != r)
              ) {
                var s = h(e);
                n.appendItemToView(
                  {
                    path: r,
                    folderPath: e.getAttribute("data-parent-path"),
                    folderName: h(e)
                      .children(".file-list-item-parent-loc")
                      .text(),
                    lastModified: new Date(),
                    createDate: new Date(e.dataset.createDate - 0),
                    name: t,
                    summary:
                      ((l = s.children(".file-list-item-summary")),
                      l.length ? l[0].textContent || l[0].innerText : ""),
                    oldPath: a,
                  },
                  !0
                );
              }
              var l;
              n.editor.restoreLastCursor();
            }
            r.replaceWith(i),
              i.val(l),
              this.parent.bindRename(
                i,
                function (e) {
                  return File.isMac
                    ? (function (e) {
                        var t = e.val().replace(/[\/\\]/g, ""),
                          i = s.pathByDeleteLastComponent(a) + "/" + t;
                        n.parent.pauseOnChange(!0),
                          a != i
                            ? bridge.callHandler(
                                "library.renameFile",
                                { old: a, new: i },
                                function (e) {
                                  e
                                    ? (c(t, i),
                                      a == d.getCurrentFilePath() &&
                                        setTimeout(function () {
                                          n.parent.markOpenedFile(i),
                                            n.focusToFile(i, !0);
                                        }, 200),
                                      n.highlight(i))
                                    : c(l, a);
                                }
                              )
                            : c(l, a);
                      })(e)
                    : (function (e) {
                        var i = e.val();
                        if (
                          (i = (
                            File.isWin
                              ? i
                                  .replace(/[\\\/:*?"<>\|\000-\031]/g, "")
                                  .replace(/\.+$/, "")
                              : i.replace(/[\/\\\000-\031]/g, "")
                          ).trim())
                        ) {
                          var r = reqnode("path").resolve(
                              s.pathByDeleteLastComponent(a) +
                                (File.isWin ? "\\" : "/") +
                                i
                            ),
                            o = reqnode("fs");
                          a != r
                            ? s.isSamePath(a, r) || !o.existsSync(r)
                              ? (n.parent.pauseOnChange(!0),
                                JSBridge.invoke("app.sendEvent", "willRename", {
                                  oldPath: a,
                                }),
                                n.parent
                                  .execRenameFileByNode(a, r)
                                  .then(function ([e]) {
                                    JSBridge.invoke(
                                      "app.sendEvent",
                                      "didRename",
                                      { oldPath: a, newPath: e ? a : r }
                                    ),
                                      e
                                        ? d(e)
                                        : (t ||
                                            JSBridge.invoke(
                                              "filesOp.registerUndo",
                                              r,
                                              a,
                                              h.localize
                                                .getString("Rename %@", "Panel")
                                                .replace(
                                                  "%@",
                                                  reqnode("path").basename(a)
                                                )
                                            ),
                                          c(i, r),
                                          n.highlight(r));
                                  }))
                              : d(
                                  h.localize.getString(
                                    "File with same name already exists at target path."
                                  )
                                )
                            : c(l, a);
                        } else c(l, a);
                        function d(e) {
                          c(l, a),
                            u.showErrorDialog(
                              h.localize.getString("Operation Failed"),
                              h.localize
                                .getString(
                                  'Failed to rename from "{0}" to "{1}"'
                                )
                                .format(l, i) +
                                "\n" +
                                e
                            );
                        }
                      })(e);
                },
                function () {
                  c(l, a);
                },
                !1,
                t,
                !0,
                s.pathByDeleteLastComponent(a)
              ),
              i.focus();
          }
        };
      }
    ),
    $__System.registerDynamic(
      "31",
      ["11", "e", "1d", "20", "13", "26"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r = e("11"),
          o = e("e"),
          a = e("1d"),
          s = e("20"),
          l = e("13"),
          c = l.Node,
          d = e("26").map,
          u = c.TYPE,
          h = r.WESTERN_WORD_SPLITTER;
        window.setAttributeOnlyNeeded = function (e, t, n) {
          if (e.getAttribute(t) != n) {
            if (
              "true" == n &&
              "write" == e.id &&
              "<p>&nbsp;</p>" == e.children[0].outerHTML
            )
              return;
            if (
              (e.setAttribute(t, n),
              "write" === e.id && File.isNode && "false" === n)
            ) {
              var i = o(".md-list-item");
              i.css("display", "block"),
                setTimeout(() => {
                  i.css("display", "list-item");
                }, 0);
            }
            if (
              "write" == e.id &&
              "false" == n &&
              File.editor &&
              File.editor.selection
            ) {
              var r = document.activeElement;
              if (r && c.isType(r.tagName, "INPUT", "TEXTAREA")) return;
              if (r && r.classList && r.classList.contains("ty-input")) return;
              var a = File.editor.selection.getRangy(),
                s = a && a.startContainer,
                l = s && s.parentElement;
              if (l) {
                var d = l.closest("[contenteditable]");
                d &&
                  "false" != d.getAttribute("contenteditable") &&
                  (d.focus(), File.editor.selection.setRange(a));
              }
            }
            return !0;
          }
        };
        var p,
          f,
          m = function (e) {
            (this.rangy = a),
              a.init(),
              (this.savedSel = {}),
              (this.editor = e),
              o(document).on("selectionchange", function (t) {
                e.selection.selectWordTime &&
                  new Date() - e.selection.selectWordTime > 200 &&
                  (e.selection.selectWordTime = null);
              }),
              this.updateMetrics();
          },
          g = o.fn.scrollTop;
        function v(e) {
          e.preventDefault(), e.stopPropagation();
        }
        (o.fn.oldScrollTop = g),
          (o.fn.scrollTop = function (e) {
            if (null !== e)
              return void 0 === e
                ? (this[0] || {}).scrollTop
                : (((this[0] || {}).scrollTop = e), e);
          }),
          o(document.body)
            .on("hidden.bs.modal", ".modal", function (e) {
              File.editor.restoreLastCursor();
            })
            .on(".show.bs.modal", ".modal", function () {
              var e = File.editor.selection.buildUndo();
              e && (File.editor.lastCursor = e);
            }),
          (a.rangePrototype.insertNodeAtEnd = function (e) {
            var t = this.cloneRange();
            t.collapse(!1), t.insertNode(e), t.detach(), this.setEndAfter(e);
          }),
          o(window).on("resize", function () {
            File.suppressResize ||
              (f = document.querySelector("content").clientHeight);
          }),
          (m.prototype = {
            clearGlobalColumn: function () {
              p = void 0;
            },
            updateMetrics: function () {
              f = document.querySelector("content").clientHeight;
              var e = this.editor.defaultTextHeight;
              (this.editor.defaultTextHeight = parseInt(
                o("#write p").css("line-height")
              )),
                (!isNaN(this.editor.defaultTextHeight) &&
                  this.editor.defaultTextHeight) ||
                  (this.editor.defaultTextHeight = e);
            },
            jumpIntoElemBegin: function (e, t) {
              try {
                var n = this,
                  i = this.editor,
                  r = e.find(".CodeMirror")[0],
                  s = e.children("[mdtype]");
                if (!e || !e.length)
                  return (
                    console.sendError(
                      "cannot jumpIntoElemBegin to empty elem",
                      "warning"
                    ),
                    window.getSelection().removeAllRanges(),
                    !1
                  );
                if ((e.length > 1 && (e = o(e[0])), r))
                  return (
                    r.CodeMirror.focus(), r.CodeMirror.execCommand("goDocStart")
                  );
                if (F(i, !1, i.findNodeByElem(e))) return;
                if (
                  c.isType(
                    e.attr("mdtype"),
                    c.TYPE.image,
                    c.TYPE.hr,
                    c.TYPE.math_block
                  )
                )
                  return this.selectNode(null, e);
                if (e.hasClass("footnotes"))
                  return this.jumpIntoElemBegin(e.find(".md-def-name"));
                if (s.length) return this.jumpIntoElemBegin(o(s[0]), t);
                var l = a.createRange();
                return (
                  e[0].querySelector("[md-inline]") &&
                    e[0]
                      .querySelector("[md-inline]")
                      .classList.add("md-expand"),
                  l.setStart(e[0], 0),
                  l.setEnd(e[0], 0),
                  this.deRange(l),
                  n.setRange(l, !0),
                  t
                    ? setTimeout(function () {
                        n.setRange(l, !0), n.editor.refocus();
                      }, 20)
                    : !window.getSelection().anchorNode &&
                      e.length &&
                      (!(function e(t) {
                        3 == t.nodeType
                          ? (l.setStart(t, 0), l.setEnd(t, 0))
                          : t.childNodes.length
                          ? e(t.childNodes[0])
                          : (l.setStart(t, 0), l.setEnd(t, 0));
                      })(e[0]),
                      window.getSelection().addRange(l.nativeRange)),
                  window.getSelection().anchorOffset
                );
              } catch (t) {
                console.sendError("cursor may go wrong", !1),
                  Reporter.error("cursor may go wrong", {
                    level: "warning",
                    filename: "Selection.js",
                    extra: { dom: e && Reporter.sanitizeDom(e[0]) },
                  });
              }
            },
            jumpIntoElemEnd: function (e, t) {
              var n = e.find(".CodeMirror")[0];
              if ((e.length > 1 && (e = o(e[0])), n))
                n.CodeMirror.execCommand("goDocEnd");
              else {
                if (F(this.editor, !0, this.editor.findNodeByElem(e))) return;
                if (
                  c.isType(
                    e.attr("mdtype"),
                    c.TYPE.image,
                    c.TYPE.hr,
                    c.TYPE.math_block
                  )
                )
                  return this.selectNode(null, e);
                if (e.children("[mdtype]").length)
                  return this.jumpIntoElemEnd(o(e.children("[mdtype]")[0]), t);
                if (e.hasClass("md-def-footnote")) {
                  var i = a.createRange();
                  i.setStart(e.find(".md-def-content")[0], 1),
                    i.setEnd(e.find(".md-def-content")[0], 1),
                    this.deRange(i, !0);
                } else
                  e.addClass("md-expand"),
                    this.restoreSelection(e[0], e.text().length),
                    e.removeClass("md-expand");
              }
            },
            jumpInto: function (e, t) {
              if ("" == e.text()) return this.jumpIntoElemBegin(e);
              this.restoreSelection(e[0], t);
            },
            fixUnselectableRange: function (e, t) {
              if (!e || !e.collapse) return !1;
              var n = (e.startContainer.childNodes || [])[e.startOffset];
              return (
                !(!n || "IMG" != n.tagName) &&
                (!!t ||
                  (e.setStart(
                    n.previousElementSibling,
                    n.previousElementSibling.childNodes.length - 1
                  ),
                  e.collapse(!0),
                  !0))
              );
            },
            setRange: function (e, t) {
              if (e) {
                if ((this.fixUnselectableRange(e), !t)) {
                  var n = this.editor.brush.closestExpandable(
                      o(e.startContainer)
                    ),
                    r = this.editor.brush.closestExpandable(o(e.endContainer));
                  (r.is(n.next()) &&
                    n.hasClass("md-image") &&
                    e.endContainer.length == e.endOffset) ||
                    n.addClass("md-expand"),
                    r.addClass("md-expand");
                }
                e.commonAncestorContainer &&
                  e.commonAncestorContainer.getAttribute &&
                  "linebreak" ==
                    e.commonAncestorContainer.getAttribute("md-inline") &&
                  "\n" == e.toString() &&
                  e.collapse(!0),
                  File.isTypeWriterMode &&
                    File.option.scrollWithCursor &&
                    (i = setTimeout(() => {
                      this.typeWriterScroll();
                    }, 180)),
                  this.rangy.getSelection().setSingleRange(e, e.isBackward),
                  this.editor.wordCount.updateInSelection(
                    this.getTextInSelection(e)
                  ),
                  o(this.editor.sessionStr).trigger("cursorChange");
              }
            },
            getOffset: function (e, t) {
              if (
                (t && !t.nativeRange && (t = this.wrappedRange(t)),
                (t = t || this.getRangy()))
              )
                try {
                  return (
                    void 0 !== e.length && (e = e[0]), t.getBookmark(e).start
                  );
                } catch (e) {}
              return 0;
            },
            restoreEdge: function (e, t, n, i) {
              e.jquery && (e = e.length ? e[0] : null);
              var r = i,
                o = a.createRange();
              return e
                ? (o.moveToBookmark({ containerNode: e, start: t, end: t }),
                  r
                    ? (n
                        ? r.setEnd(o.endContainer, o.endOffset)
                        : r.setStart(o.startContainer, o.startOffset),
                      r)
                    : o)
                : r || o;
            },
            saveSelection: function (e, t) {
              if (e)
                return (
                  e.jquery && (e = e[0]),
                  (t = t || this.getRangy())
                    ? ((this.savedSel = t.getBookmark(e)), this.savedSel)
                    : void 0
                );
            },
            restoreSelection: function (e, t) {
              if (!e) return window.getSelection().removeAllRanges();
              if ((e.jquery && (e = e[0]), !e))
                return window.getSelection().removeAllRanges();
              var n = "false" === e.getAttribute("contenteditable");
              if (
                (void 0 === t || null === t || "" === t
                  ? (t = this.savedSel)
                  : "number" == typeof t && (t = { start: t, end: t }),
                !x(this.editor, e, t.start))
              ) {
                var i = a.createRange();
                if (
                  (i.moveToBookmark({
                    start: t.start,
                    end: t.end,
                    containerNode: e,
                  }),
                  i.endContainer == e && 0 == i.endOffset && t.end > 0)
                ) {
                  var r = e.rawText().length;
                  t.end > r &&
                    i.moveToBookmark({
                      start: Math.min(t.start, r),
                      end: Math.min(t.end, r),
                      containerNode: e,
                    });
                }
                if (
                  "BODY" == document.activeElement.tagName ||
                  ("write" !== document.activeElement.id &&
                    document.activeElement.hasAttribute("tabindex"))
                ) {
                  var s = o("content").scrollTop();
                  this.editor.writingArea.focus(), o("content").scrollTop(s);
                }
                return (
                  i.collapsed && this.deRange(i),
                  n && e.setAttribute("contenteditable", "true"),
                  this.setRange(i),
                  !n ||
                    e.classList.contains("md-def-link") ||
                    e.classList.contains("md-def-footnote") ||
                    e.setAttribute("contenteditable", "false"),
                  i
                );
              }
            },
            getVeryFirstElem: function (e) {
              return e.children("[cid]").length > 0
                ? this.getVeryFirstElem(e.children("[cid]").first())
                : e;
            },
            getVeryLastElem: function (e) {
              return e.children("[cid]").length > 0
                ? this.getVeryLastElem(e.children("[cid]").last())
                : e;
            },
            getSelection: function () {
              return this.rangy.getSelection();
            },
            prepNode: function (e, t, n, i) {
              var r,
                o = this.editor,
                s = this.getRangy(),
                d = this.editor.undo.UndoManager,
                h = d.SnapFlag,
                f = s && !s.collapsed;
              if (
                !(function () {
                  if (i && f && File.isWin) {
                    var e = s.commonAncestorContainer.closest
                      ? s.commonAncestorContainer
                      : s.commonAncestorContainer.parentElement;
                    if ((e = e.closest("[cid]")) && !e.querySelector("[cid]"))
                      return (
                        o.undo.addSnap(e.getAttribute("cid"), h.NONE),
                        o.brush.addToQueue(e.getAttribute("cid")),
                        !0
                      );
                  }
                })()
              ) {
                (p = void 0),
                  File.inBusyMode &&
                    setAttributeOnlyNeeded(
                      this.editor.writingArea,
                      "contenteditable",
                      "false"
                    );
                try {
                  if (f) {
                    if (n) return r;
                    if (o.UserOp.surroundPair(o, e, s))
                      return void (t && t.preventDefault());
                    r = o.UserOp.backspaceHandler(
                      o,
                      null,
                      "delSelection",
                      !0,
                      !0
                    );
                  }
                  s = this.getRangy();
                  var m,
                    g,
                    v = this.rangy.getSelection(),
                    y = v.anchorOffset == a.dom.getNodeLength(v.anchorNode),
                    b = o.getJQueryElem(v.anchorNode),
                    w = o.getMarkElem(v.anchorNode),
                    x = o.findNodeByElem(w),
                    C = s.getBookmark(w[0]);
                  if (b[0] == this.editor.writingArea) {
                    if (0 != s.startOffset)
                      return (
                        v.removeAllRanges(), void (t && t.preventDefault())
                      );
                    this.jumpTop();
                  }
                  if (b.hasClass("ty-input") || !x) return;
                  if (
                    (r ||
                      n ||
                      (o.undo.addSnap(x.cid, h.NONE),
                      o.brush.addToQueue(x.cid)),
                    File.inBusyMode)
                  ) {
                    var F = b.closest("[contenteditable='true']");
                    document.activeElement !== F[0] && F.focus();
                  }
                  if (b.hasClass("md-def-url") && (e.match(/\s/g) || []).length)
                    return (
                      y && this.jumpIntoElemBegin(w.find(".md-def-title")),
                      t && t.preventDefault()
                    );
                  if (!n && r) {
                    var S = w.attr("cid"),
                      k = e.length > 1 ? h.REPLACE : h.ADD;
                    (r.source = S + "#" + k), (r.date = new Date());
                  }
                  if (
                    ((w.is(".unholdable") ? w : w.closest(".unholdable"))
                      .find(".math-jax-postprocess>.md-math-after-sym")
                      .text(""),
                    c.isType(x, u.def_link, u.def_footnote))
                  ) {
                    if (w[0] == b[0] && s.collapsed)
                      return void this.jumpIntoElemBegin(
                        w.find(".md-def-name")
                      );
                  } else
                    x.get("type") == u.meta_block ||
                      x.get("type") == u.fences ||
                      (x.isBlock() && x.canNotDirectEdit()
                        ? (window.getSelection().removeAllRanges(),
                          t && t.preventDefault())
                        : b.hasClass("md-image") &&
                          (1 != s.startOffset ||
                            b.prev().length ||
                            (b.before("​"),
                            s.setStartBefore(b.parent()),
                            v.setSingleRange(s))));
                  if (x.get("children").length) {
                    var E = window.getSelection().anchorNode.childNodes,
                      T = window.getSelection().anchorOffset,
                      _ = T > 0 ? E[T - 1] : null,
                      A = T < E.length ? E[T] : null,
                      M = o.findNodeByElem(_ ? o.getMarkElem(_) : []),
                      L = o.findNodeByElem(A ? o.getMarkElem(A) : []);
                    if (
                      ((e = e.replace(/\u200B/g, "")),
                      c.isType(L, l.TYPE.table))
                    ) {
                      o.undo.endSnap(!0), (r = r || d.makeEmptyCommand());
                      var N = new c({
                        type: l.TYPE.paragraph,
                        text: e,
                        in: L.get("in"),
                      });
                      L.addBefore(N),
                        d.addUndoForInsert(r, N),
                        o.findElemById(L.id).before(N.toHTML()),
                        o.selection.restoreSelection(
                          o.findElemById(N.id)[0],
                          e.length
                        ),
                        (m = N);
                    } else if (c.isType(M, l.TYPE.table)) {
                      o.undo.endSnap(!0), (r = r || d.makeEmptyCommand());
                      N = new c({
                        type: l.TYPE.paragraph,
                        text: e,
                        in: M.get("in"),
                      });
                      M.addAfter(N),
                        d.addUndoForInsert(r, N),
                        o.findElemById(M.id).after(N.toHTML()),
                        o.selection.restoreSelection(
                          o.findElemById(N.id)[0],
                          e.length
                        ),
                        (m = N);
                    } else
                      L
                        ? ((L = L.getVeryFirst()),
                          o.undo.addSnap(L.cid, h.NONE),
                          L.set("text", e + L.safeGetStrAttr("text", !0)),
                          o.findElemById(L.id).replaceWith(L.toHTML()),
                          L && o.selection.jumpInto(o.findElemById(L.id), 1),
                          (r = null))
                        : M &&
                          ((M = M.getVeryFirst(!0)),
                          o.undo.addSnap(M.cid, h.NONE),
                          M.set("text", M.safeGetStrAttr("text", !0) + e),
                          o.findElemById(M.id).replaceWith(M.toHTML()),
                          o.selection.jumpIntoElemEnd(o.findElemById(M.id)),
                          (r = null));
                    r && r.redo.push(this.buildUndo()),
                      !n && o.refocus(m ? m.id : void 0),
                      t && t.preventDefault();
                  }
                  return (
                    n ||
                      (!f && e
                        ? (!(function (e, t) {
                            var n = e.rawText(),
                              i = e.rawText(!0),
                              r = 0,
                              o = 0;
                            if (n != i) {
                              for (; r < t.start; )
                                if (n[r] == i[o]) r++, o++;
                                else {
                                  if ("​" != n[r]) break;
                                  r++;
                                }
                              (t.start -= r - o), (t.end -= r - o);
                            }
                          })(w, C),
                          (g = o.UserOp.handlePair(o, e, x, C, r, s)) ||
                            (g = o.UserOp.PunctuationOp.handlerCh(
                              o,
                              e,
                              x,
                              C,
                              r,
                              s
                            )),
                          g ||
                            (g = o.htmlBlock.autoCloseTagWhenInput(
                              o,
                              e,
                              x,
                              C,
                              r,
                              s
                            )),
                          g &&
                            ("object" == typeof g && (r = g),
                            t && t.preventDefault()))
                        : r &&
                          (o.UserOp.insertInlineText(o, x, e, C.start, r, !0),
                          t && t.preventDefault())),
                    !n && r && this.editor.undo.register(r),
                    r
                  );
                } catch (e) {
                  console.warn(e);
                }
              }
            },
            getPosBookmark: function (e) {
              var t = editor.getMarkElem();
              if (t.length) {
                var n = this.editor.fences.queue[t.attr("cid")];
                return n
                  ? {
                      isCm: n,
                      cid: n.cid,
                      start: n.indexFromPos(n.getCursor()),
                    }
                  : e
                  ? {
                      isCm: !1,
                      cid: t.attr("cid"),
                      start: e.getBookmark(t[0]).start,
                    }
                  : null;
              }
            },
            wrappedRange: function (e) {
              if (window.StaticRange && e instanceof StaticRange) {
                var t = this.rangy.createRange();
                return (
                  t.setStart(e.startContainer, e.startOffset),
                  t.setEnd(e.endContainer, e.endOffset),
                  t
                );
              }
              return this.rangy.WrappedRange(t);
            },
            getRangy: function (e) {
              var t = this.rangy.getSelection(),
                n = t.rangeCount ? t.getRangeAt(0) : null;
              return (
                n && ((n.isBackward = t.isBackward()), e && this.deRange(n)), n
              );
            },
            storeToJson: function (e) {
              return (
                e || (e = this.buildUndo()),
                e && e.pos ? { id: e.id, pos: e.pos } : e
              );
            },
            buildUndo: function (e, t, n) {
              var i = { type: "cursor" };
              if (this.editor.sourceView && this.editor.sourceView.inSourceMode)
                return (
                  (i.pos = this.editor.sourceView.cm.getCursor()),
                  (i.inSourceMode = !0),
                  i
                );
              try {
                if (
                  (t =
                    ((e = e || this.getRangy()) && e.commonAncestorContainer
                      ? this.editor.getMarkElem(e.commonAncestorContainer)
                      : t) || this.editor.getMarkElem()).find(".CodeMirror")
                    .length
                ) {
                  var r = t.find(".CodeMirror")[0].CodeMirror;
                  (i.id = r.cid),
                    (i.pos = r.getCursor()),
                    (i.selections = r.listSelections());
                } else if (
                  t.attr("mdtype") &&
                  t.children("[tabindex]").addBack("[tabindex]").length
                )
                  (i.id = t.attr("cid")), (i.focus = t.attr("mdtype"));
                else {
                  if (!e) return null;
                  var o = this.editor.getMarkElem(
                      this.getDetailPos(e.startContainer, e.startOffset)[0]
                    ),
                    a = this.editor.getMarkElem(
                      this.getDetailPos(e.endContainer, e.endOffset)[0]
                    ),
                    s = e.getBookmark(o[0], n);
                  if (
                    (c.isType(
                      o.attr("mdtype"),
                      u.fences,
                      u.html_block,
                      u.math_block
                    ) && (s.start = 0),
                    o[0] === a[0])
                  ) {
                    if (((i.id = o.attr("cid")), !i.id)) return null;
                    (i.start = s.start), (i.end = s.end);
                  } else {
                    if (
                      ((i.startId = o.attr("cid")),
                      (i.endId = a.attr("cid")),
                      !i.startId || !i.endId)
                    )
                      return null;
                    (i.start = s.start), (i.end = e.getBookmark(a[0]).end);
                  }
                }
              } catch (e) {
                return e.stack, null;
              }
              return i;
            },
            selectNode: function (e, t) {
              (t = t || editor.findElemById(e.id)).length &&
                "write" !== t.attr("id") &&
                void 0 !== t.attr("tabindex") &&
                (window.getSelection().removeAllRanges(),
                t.addClass("onfocus"),
                t.focus());
            },
            jumpToLineEdge: function (e, t) {
              return this.extendToLineEdge(e, null, t, !0);
            },
            fixExtendToLineEdge: function (e, t, n, i) {
              t = t || this.editor.getMarkElem()[0];
              var r = this.getRangy();
              if (
                r &&
                t &&
                !isInputComponent(document.activeElement) &&
                !isInputComponent(t) &&
                c.isType(t.getAttribute("mdtype"), u.paragraph, u.heading)
              ) {
                var o,
                  a,
                  s = null,
                  l = this.rangy.createRange();
                if (e) {
                  if (
                    (s = t.querySelectorAll(".md-inline-math").last()) &&
                    (l.setStartBefore(s),
                    l.collapse(!1),
                    (o = l.getBookmark(t)),
                    (a = r.getBookmark(t)),
                    o.end == a.end &&
                      ((a.end = t.textContent.length),
                      i && (a.start = a.end),
                      r.moveToBookmark(a),
                      !n))
                  )
                    return (
                      this.setRange(r), void this.editor.brush.expandOnDelay(!0)
                    );
                } else if (
                  (s = t.querySelectorAll(".md-inline-math")[0]) &&
                  (l.setStartAndEnd(s, s.childNodes.length),
                  (o = l.getBookmark(t)),
                  (a = r.getBookmark(t)),
                  o.start == a.start &&
                    ((a.start = 0),
                    i && (a.end = a.start),
                    r.moveToBookmark(a),
                    !n))
                )
                  return (
                    this.setRange(r), void this.editor.brush.expandOnDelay(!0)
                  );
                this.editor.brush.expandOnDelay(!0);
              }
            },
            extendToLineEdge: function (e, t, n, i) {
              t = t || this.editor.getMarkElem()[0];
              var r = this.getRangy();
              if (
                !r ||
                !t ||
                isInputComponent(document.activeElement) ||
                isInputComponent(t)
              )
                return !1;
              var o = r.getBookmark(t),
                s = a.createRange();
              return (
                e
                  ? ((o.end = t.textContent.length), i && (o.start = o.end))
                  : ((o.start = 0), i && (o.end = 0), (s.isBackward = !0)),
                s.moveToBookmark(o),
                !n && this.setRange(s),
                s
              );
            },
            extendCharFromCollapse: function (e, t) {
              var n,
                i = !1,
                r = !t;
              if (
                (e.commonAncestorContainer.nodeType == document.TEXT_NODE &&
                  (t &&
                    e.startOffset > 0 &&
                    (e.setStart(e.startContainer, e.startOffset - 1),
                    e.startOffset > 0 &&
                      (n = e.toString().charCodeAt(0)) >= 56320 &&
                      n <= 57343 &&
                      (e.setStart(e.startContainer, e.startOffset - 1),
                      ((n = e.toString().charCodeAt(0)) >= 55296 &&
                        n <= 56319) ||
                        e.setStart(e.startContainer, e.startOffset + 1)),
                    (i = !0)),
                  r &&
                    e.endOffset <
                      e.commonAncestorContainer.textContent.length &&
                    (e.setEnd(e.endContainer, e.endOffset + 1),
                    (n = e.toString().charCodeAt(e.toString().length)) >=
                      55296 &&
                      n <= 56319 &&
                      e.endOffset <
                        e.commonAncestorContainer.textContent.length &&
                      e.setEnd(e.endContainer, e.endOffset + 1),
                    (i = !0))),
                !i)
              ) {
                var o = this.editor.getMarkElem(e.startContainer)[0];
                if (!o) return e;
                var a = e.getBookmark(o);
                if (
                  (t && 0 === a.start) ||
                  (r && a.end >= o.textContent.length)
                )
                  return !1;
                if (
                  (t ? a.start-- : a.end++,
                  o.classList.contains("md-def-link") ||
                    o.classList.contains("md-def-footnote"))
                ) {
                  var s = o.querySelector(".md-def-name").textContent.length;
                  (a.start != s &&
                    a.start !=
                      s +
                        1 +
                        o.querySelector(".md-def-content").textContent
                          .length) ||
                    (t
                      ? (a.end - a.start <= 1 && a.end--, a.start--)
                      : (a.end - a.start <= 1 && a.start++, a.end++));
                }
                e.moveToBookmark(a);
              }
              return e;
            },
            isSameRange: function (e, t) {
              try {
                return (
                  e.startContainer == t.startContainer &&
                  e.endContainer == t.endContainer &&
                  e.startOffset == t.startOffset &&
                  e.endOffset == t.endOffset
                );
              } catch (e) {}
              return !1;
            },
            moveLeftOrRight: function (e, t) {
              p = void 0;
              var n = this,
                i = this.editor.getMarkElem()[0],
                r = this.getRangy(),
                s = this.editor;
              if (
                i &&
                "write" !== i.id &&
                i.hasAttribute("tabindex") &&
                t &&
                !t.metaKey &&
                !t.shiftKey &&
                !t.ctrlKey
              )
                return this.moveUpOrDown(e, t, !0);
              if (!((t && isInputComponent(t.target)) || !r) && i) {
                !File.inBusyMode ||
                  (r &&
                    !o(r.startContainer).closest(
                      "[contenteditable='false'][cid]"
                    ).length) ||
                  setAttributeOnlyNeeded(
                    s.writingArea,
                    "contenteditable",
                    "true"
                  );
                var l = t.shiftKey;
                if (
                  t &&
                  o(e ? r.startContainer : r.endContainer).closest(
                    "[mdtype='table_cell']"
                  ).length
                )
                  setTimeout(function () {
                    if (!t || !t.isDefaultPrevented()) {
                      var i = n.getRangy();
                      n.isSameRange(i, r) &&
                        (n.editor.tableEdit.moveToNextCell(!1, e),
                        l &&
                          ((i = n.getRangy()),
                          e
                            ? i.setEnd(r.endContainer, r.endOffset)
                            : i.setStart(r.startContainer, r.startOffset),
                          (i.isBackward = e),
                          o(r.endContainer)
                            .closest("figure")
                            .attr("contenteditable", !0),
                          n.setRange(i)));
                    }
                  }, 0);
                else {
                  var c = r.getBookmark(i),
                    d = a.createRange();
                  if (t) {
                    if (
                      !t.metaKey &&
                      !t.ctrlKey &&
                      !t.shiftKey &&
                      r.toString().length
                    ) {
                      r.collapse(e), this.setRange(r, !0);
                      var u = this.editor.getMarkElem(r.startContainer);
                      return (
                        u.length &&
                          F(this.editor, !e, this.editor.findNodeByElem(u)),
                        t.preventDefault(),
                        !0
                      );
                    }
                    var h = File.isMac && t.metaKey;
                    if (
                      e &&
                      0 === c.start &&
                      (!r || r.collapsed || r.isBackward)
                    ) {
                      if (h) return;
                      return this.moveUpOrDown(!0, t, !0);
                    }
                    var f = o(i).rawText().length;
                    if (
                      !e &&
                      c.end >= f &&
                      (!r || r.collapsed || !r.isBackward) &&
                      (!i.classList.contains("md-def-link") ||
                        0 !=
                          s
                            .getJQueryElem(r.startContainer)
                            .closest(".md-def-title").length)
                    ) {
                      if (h) return;
                      return this.moveUpOrDown(!1, t, !0);
                    }
                    var m = document.querySelector(
                      ".ty-focusable-btn.selected"
                    );
                    if (
                      m &&
                      !t.metaKey &&
                      !t.ctrlKey &&
                      !t.shiftKey &&
                      c.end == c.start
                    )
                      return (
                        m.classList.remove("selected"),
                        (c.end += e ? -1 : 1),
                        (c.start += e ? -1 : 1),
                        d.moveToBookmark(c),
                        this.setRange(d, !0),
                        t.preventDefault(),
                        !0
                      );
                    if (File.isNodeHtml && !e && t.ctrlKey && !t.shiftKey) {
                      var g = i.textContent.substring(c.end) || "";
                      if (!/^[^\$]+\s+[^\$]/.exec(g) && -1 != g.indexOf("$")) {
                        var v = window.getSelection();
                        if (null != v) {
                          v.modify("move", "right", "word");
                          var y =
                            v.anchorNode &&
                            v.anchorNode.parentElement &&
                            v.anchorNode.parentElement.closest("mjx-container");
                          if (0 == v.startOffset && y)
                            0 == (n.getRangy().getBookmark(y) || {}).start &&
                              v.collapse(
                                y.parentElement.previousElementSibling,
                                0
                              );
                          return t.preventDefault(), !0;
                        }
                      }
                      if (/^\w+$/.exec(g))
                        return (
                          (c.start = c.end = f),
                          d.moveToBookmark(c),
                          this.setRange(d, !0),
                          t.preventDefault(),
                          !0
                        );
                    }
                  }
                  var b = Object.assign({}, c);
                  e
                    ? ((c.end = c.start), c.start--)
                    : ((c.start = c.end), c.end++),
                    d.moveToBookmark(c);
                  var w = d.toString();
                  if (/\u200b|\007F/g.exec(w))
                    return (
                      t.shiftKey
                        ? (e ? (b.start -= 2) : (b.end += 2),
                          e && (b.start = Math.max(0, b.start)),
                          d.moveToBookmark(b))
                        : d.collapse(e),
                      (d.isBackward = r && r.isBackward),
                      this.setRange(d, !0),
                      !0
                    );
                  if (
                    (function (t) {
                      return (
                        t.startContainer != t.endContainer &&
                        o(e ? t.startContainer : t.endContainer)
                          .closest(".md-inline-math")
                          .addClass("md-expand").length
                      );
                    })(d) &&
                    !t.ctrlKey &&
                    !t.metaKey &&
                    !t.altKey &&
                    !t.shiftKey
                  )
                    return (
                      d.collapse(e),
                      this.setRange(d, !0),
                      t && t.preventDefault(),
                      !0
                    );
                  var x = o(d.commonAncestorContainer).closest(
                      ".md-def-content"
                    ),
                    C = o(r.commonAncestorContainer).closest(".md-def-name");
                  r.collapsed &&
                    i &&
                    !t.shiftKey &&
                    (t.ctrlKey || t.metaKey) &&
                    (x.length
                      ? setTimeout(function () {
                          var t = n.getRangy();
                          (t && i.contains(t.commonAncestorContainer)) ||
                            (e
                              ? n.jumpIntoElemBegin(o(i))
                              : n.jumpIntoElemEnd(o(i)));
                        }, 0)
                      : C.length
                      ? e ||
                        r.endOffset != r.endContainer.length ||
                        n.jumpIntoElemEnd(o(i))
                      : setTimeout(function () {
                          var t = n.getRangy();
                          if (t && t.endContainer) {
                            var i = o(e ? t.startContainer : t.endContainer)
                              .closest(".md-inline-math")
                              .addClass("md-expand");
                            File.isMac &&
                              !i.length &&
                              t.endContainer.length == t.endOffset &&
                              t.endContainer.nodeType == document.TEXT_NODE &&
                              (i = o(t.endContainer.parentElement).next(
                                ".md-inline-math"
                              )),
                              i.length &&
                                (e
                                  ? (t.setStart(i.find(".md-before")[0], 0),
                                    t.collapse(!0))
                                  : (t.setEnd(
                                      i.find(".md-math-after-sym")[0],
                                      0
                                    ),
                                    t.collapse(!1)),
                                n.setRange(t));
                          }
                        }, 0));
                }
              }
            },
            addUnholdable: function (e, t, n, i) {
              var r = (function (e, t, n) {
                  var i = u.paragraph;
                  e.get("type") == u.list_item && (i = u.list_item);
                  var r = new c({ type: i });
                  return (
                    t ? e.addBefore(r) : e.addAfter(r), c.normalizeNode(r), r
                  );
                })(e, n),
                a = this.editor.findElemById(e.id),
                s = n ? e : void 0,
                l = n ? void 0 : e;
              return (
                n ? a.before(r.toHTML()) : a.after(r.toHTML()),
                this.editor.undo.endSnap(!0),
                (t = t || this.editor.undo.UndoManager.makeEmptyCommand()),
                o(".unholdable").removeClass("unholdable"),
                this.editor.findElemById(r.id).addClass(i ? "" : "unholdable"),
                this.editor.undo.UndoManager.addUndoForInsert(t, r, l, s),
                (t.discardable = !0),
                r
              );
            },
            jumpToNextBlock: function (e, t) {
              var n,
                i = e.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(!1);
              if (i);
              else {
                if (!t) return void window.getSelection().removeAllRanges();
                i = this.addUnholdable(e, t);
              }
              (n = this.editor.findElemById(i.cid)),
                this.jumpIntoElemBegin(n),
                t.redo.push(this.buildUndo());
              var r = this.editor;
              setTimeout(function () {
                r.refocus();
              }, 50);
            },
            unlockBlockUpOrDown: function (e, t) {
              var n = this.editor;
              File.inBusyMode &&
                (t.shiftKey || t.metaKey || t.ctrlK) &&
                setAttributeOnlyNeeded(
                  n.writingArea,
                  "contenteditable",
                  "true"
                );
              var i = this.getRangy(),
                r = n.getMarkElem(i && i.startContainer),
                a = n.findNodeByElem(r);
              if (a) {
                for (
                  var s = [],
                    l =
                      "false" === r.attr("contenteditable")
                        ? r
                        : r.closest("[mdtype][contenteditable=false]");
                  l.length;

                )
                  l.attr("contenteditable", "true"),
                    s.push(l),
                    (l = l.closest("[mdtype][contenteditable=false]"));
                var c = a
                    .getClosetBlock(!0)
                    .getVeryFirstBrotherIncludeTopBlock(e),
                  d = c ? n.findElemById(c.id) : o();
                for (
                  l =
                    "false" === d.attr("contenteditable")
                      ? d
                      : d.closest("[mdtype][contenteditable=false]");
                  l.length;

                )
                  l.attr("contenteditable", "true"),
                    s.push(l),
                    (l = l.closest("[mdtype][contenteditable=false]"));
                s.length &&
                  setTimeout(function () {
                    s.forEach(function (e) {
                      e.attr("contenteditable", "false");
                    });
                  }, 0);
              }
            },
            moveUpOrDown: function (e, t, n) {
              File.inBusyMode &&
                t &&
                (t.shiftKey || t.metaKey || t.ctrlK) &&
                this.editor.writingArea.setAttribute("contenteditable", "true");
              var i,
                r = this.getRangy(),
                s = this,
                h = t && c.isType(d[t.keyCode || t.which], "Right", "Left"),
                f = File.isNode && t && t.ctrlKey && !t.shiftKey,
                m = t && t.shiftKey;
              function g(e, t) {
                return t
                  ? !e ||
                      c.isType(
                        e,
                        u.fences,
                        u.html_block,
                        u.table,
                        u.math_block,
                        u.hr,
                        u.toc
                      )
                  : c.isType(
                      e,
                      u.fences,
                      u.html_block,
                      u.table,
                      u.math_block,
                      u.hr,
                      u.toc,
                      u.def_footnote,
                      u.def_link
                    );
              }
              function v(e, t, n, i, r) {
                var o = e.getVeryFirstBrotherIncludeTopBlock(t),
                  a = s.editor.undo.UndoManager.makeEmptyCommand();
                return (
                  ((!h && !o && !e.get(t ? "before" : "after")) ||
                    (g(e) && g(e.get(t ? "before" : "after"), !0))) &&
                    ((t && c.isType(e, u.meta_block)) ||
                      (o = s.addUnholdable(
                        (function e(t, n) {
                          if (
                            c.isType(
                              t,
                              u.fences,
                              u.html_block,
                              u.table,
                              u.hr,
                              u.def_link,
                              u.def_footnote
                            )
                          )
                            return t;
                          var i = n ? "before" : "after";
                          return t.get("parent")
                            ? t.get("parent").get(i)
                              ? t
                              : t.get(i)
                              ? t
                              : e(t.get("parent"))
                            : t;
                        })(e),
                        a,
                        t
                      ))),
                  a.undo.push(s.buildUndo()),
                  n && n(),
                  h
                    ? t
                      ? s.jumpIntoElemEnd(s.editor.findElemById(o.id))
                      : s.jumpIntoElemBegin(s.editor.findElemById(o.id))
                    : f
                    ? s.jumpIntoElemBegin(s.editor.findElemById(o.id), !0)
                    : E(o, i, a, r),
                  a
                );
              }
              function x(e, n, i) {
                (N = v(e.getClosetBlock(), n, void 0, i)),
                  t && t.preventDefault();
                var r = s.editor.undo.UndoManager;
                r.isEmptyCommand(N) ||
                  (N.redo.push(s.buildUndo()),
                  r.isEmptyOrUnchangedCommand(N) || s.editor.undo.register(N)),
                  s.scrollAdjust();
              }
              function k(e, i, r, a) {
                var l,
                  c = r || s.editor.fences.getCm(e.id),
                  d =
                    a[0].contains(document.activeElement) &&
                    document.activeElement.classList.contains("ty-input"),
                  h = i && 0 == c.doc.getCursor().line,
                  m = !i && c.doc.getCursor().line == c.lineCount() - 1;
                if (
                  (h &&
                    i &&
                    (h =
                      (l = c.cursorCoords().top) ==
                      c.cursorCoords({ line: 0, ch: 0 }).top),
                  m &&
                    !i &&
                    (m =
                      (l = c.cursorCoords().top) ==
                      c.cursorCoords({
                        line: c.lineCount() - 1,
                        ch: c.getLine(c.lineCount() - 1).length,
                      }).top),
                  f && (h = !0),
                  n ||
                    void 0 != p ||
                    (p = d
                      ? o(document.activeElement).offset().left +
                        document.activeElement.clientWidth
                      : c.cursorCoords(c.getCursor()).right),
                  d)
                ) {
                  var g =
                    document.activeElement.classList.contains(
                      "ty-input-before"
                    );
                  if (!g && i)
                    return s.editor.fences.jumpCmEnd(c), !n && C(c, p), y(t);
                  if (g && !i)
                    return s.editor.fences.jumpCmBegin(c), !n && C(c, p), y(t);
                  m =
                    m ||
                    document.activeElement.classList.contains("ty-input-after");
                } else if (m && !i) {
                  if (
                    e.get("type") == u.fences ||
                    (e.get("type") == u.math_block && e.get("tagAfter"))
                  )
                    return (
                      c.getInputField().blur(),
                      setTimeout(function () {
                        s.selectAllElem(a.find(".ty-input-after").focus());
                      }, 0),
                      y(t)
                    );
                } else if (
                  h &&
                  i &&
                  e.get("type") == u.math_block &&
                  e.get("tagBefore")
                )
                  return (
                    c.getInputField().blur(),
                    setTimeout(function () {
                      s.selectAllElem(a.find(".ty-input-before").focus());
                    }, 0),
                    y(t)
                  );
                if (h || m) {
                  var b = c.getCursor();
                  d ||
                    (f =
                      !p &&
                      (0 == b.ch ||
                        l !=
                          c.cursorCoords({ line: b.line, ch: b.ch - 1 }).top)),
                    n && (f = !i),
                    (N = v(
                      e,
                      i,
                      function () {
                        c.getInputField().blur();
                      },
                      a,
                      n ? void 0 : p
                    )),
                    s.editor.undo.UndoManager.isEmptyCommand(N) ||
                      (i && N.redo.push(s.buildUndo()),
                      s.editor.undo.register(N)),
                    y(t),
                    c.hasFocus() || _(N);
                }
                t && t.stopPropagation();
              }
              function E(i, r, l, d) {
                if (i) {
                  var h = s.editor.findElemById(i.id);
                  !(function (e, t, n) {
                    e.hasClass("unholdable") &&
                      t &&
                      (e.text().length
                        ? e.removeClass("unholdable")
                        : (s.editor.undo.endSnap(!0),
                          s.editor.undo.UndoManager.addUndoForRemove(n, t),
                          n.redo.push(s.buildUndo()),
                          t.remove(),
                          e.remove(),
                          s.editor.undo.register(n)));
                  })(r.closest(".unholdable"), L, l);
                  var f = t && t.shiftKey;
                  if (!f && w(h))
                    return y(t), h.find("img:first").trigger("click"), !0;
                  if (
                    f &&
                    (c.isType(i, u.fences, u.html_block, u.math_block) || b(i))
                  ) {
                    if (h.length) {
                      var m = a.createRange();
                      m.setStart(h[0], 0),
                        m.setEnd(h[0], h[0].childNodes.length),
                        s.deRange(m, !0),
                        "false" == h.attr("contenteditable") &&
                          h.attr("contenteditable", "true");
                    }
                  } else if (F(s.editor, e, i, t, l, n ? void 0 : p));
                  else if (
                    c.isType(
                      i,
                      u.paragraph,
                      u.heading,
                      u.def_link,
                      u.def_footnote
                    ) &&
                    !i.get("text")
                  )
                    s.jumpIntoElemBegin(h), t && t.preventDefault();
                  else if (c.isType(i, u.meta_block) && e)
                    s.jumpIntoElemEnd(h), t && t.preventDefault();
                  else if (c.isType(i, u.table, u.table_row, u.table_cell))
                    s.jumpIntoElemBegin(h), y(t);
                  else if (h.length) {
                    if (n || 0 == r.closest("#write").length)
                      e ? s.jumpIntoElemEnd(h) : s.jumpIntoElemBegin(h);
                    else {
                      editor.selection.scrollAdjust(h, void 0, !0, !0),
                        File.inBusyMode &&
                          editor.writingArea.setAttribute(
                            "contenteditable",
                            "true"
                          );
                      var g = p;
                      if (
                        (void 0 !== d &&
                          (g =
                            m && m.getBookmark(r[0]).end == r.text().length
                              ? p
                              : d),
                        void 0 != g)
                      ) {
                        var v = s.getRangy(),
                          x = null;
                        if (
                          (v && v.nativeRange.getClientRects()[0]) ||
                          void 0 != d
                        ) {
                          var C = (
                              h.children[0] || h[0]
                            ).getBoundingClientRect(),
                            S = e ? C.y + C.height - 8 : C.y + 4;
                          x = document.caretRangeFromPoint(g, S);
                        }
                        var k =
                            x &&
                            (h[0] == x.startContainer ||
                              h[0].contains(x.startContainer)),
                          E = x
                            ? o(x.startContainer).closest(
                                ".md-reverse-footnote-area"
                              )
                            : o();
                        k &&
                          E.length &&
                          (x.setStart(E[0].previousElementSibling, 1),
                          x.setEnd(E[0].previousElementSibling, 1),
                          s.deRange(x)),
                          k
                            ? s.setRange(x)
                            : void 0 == d && v
                            ? window
                                .getSelection()
                                .modify(
                                  "move",
                                  e ? "backward" : "forward",
                                  "line"
                                )
                            : (e
                                ? s.jumpIntoElemEnd(h)
                                : s.jumpIntoElemBegin(h),
                              v || (v = s.getRangy()),
                              (C = v && v.nativeRange.getClientRects()[0]) &&
                                (x = document.caretRangeFromPoint(g, C.y)),
                              x &&
                                (h[0] == x.startContainer ||
                                  h[0].contains(x.startContainer)) &&
                                s.setRange(x));
                      } else e ? s.jumpIntoElemEnd(h) : s.jumpIntoElemBegin(h);
                    }
                    File.isFocusMode &&
                      (o(".md-focus").removeClass("md-focus"),
                      h.addClass("md-focus")),
                      y(t);
                  }
                }
              }
              function T(n, a, l) {
                var c = o(r.commonAncestorContainer.parentElement);
                if (!e && c.hasClass("md-image-after-src")) {
                  var d = c.closest(".md-image").next();
                  return (
                    d.length ? (s.jumpIntoElemBegin(d), y(t)) : x(a, e, n), !1
                  );
                }
                if (i && i.left) {
                  var u = !e && r.collapsed;
                  if (u) {
                    var h = r.startContainer.parentElement.classList;
                    u = h.contains("md-def-name") || h.contains("md-tab");
                  }
                  if (u) {
                    var p = i.left,
                      f = e ? i.top - 9 : i.bottom + 9,
                      m = document.caretRangeFromPoint(p, f);
                    this.setRange(m, !0), y(t);
                  } else if (
                    l ||
                    (File.isTypeWriterMode && File.option.scrollWithCursor)
                  ) {
                    (p = l || i.left),
                      (f = e ? i.top - 9 : i.bottom + 9),
                      (m = document.caretRangeFromPoint(p, f));
                    !e &&
                      this.fixUnselectableRange(m, !0) &&
                      ((f =
                        ((
                          m.startContainer.getClientRects &&
                          (m.startContainer.getClientRects() || [{}])[0]
                        ).bottom || f) + 9),
                      (m = document.caretRangeFromPoint(p, f)),
                      this.deRange(m)),
                      this.editor.writingArea.contains(m.startContainer) &&
                        (S(m) || {}).top != i.top &&
                        (this.setRange(m), y(t));
                  }
                }
              }
              function _(n) {
                if (m && r) {
                  var i = s.getRangy();
                  i &&
                    ((i.isBackward = r.isBackward || (r.collapsed && e)),
                    i.isBackward
                      ? i.setEnd(r.endContainer, r.endOffset)
                      : i.setStart(r.startContainer, r.startOffset),
                    s.setRange(i),
                    n.redo.push(s.buildUndo(i)),
                    y(t));
                }
              }
              try {
                var A = this.editor.getMarkElem(),
                  M = A.attr("mdtype"),
                  L = this.editor.findNodeByElem(A),
                  N = s.editor.undo.UndoManager.makeEmptyCommand();
                if (!L) return;
                if (b(L, A) || A.hasClass("rawedit")) {
                  if (document.activeElement !== this.editor.writingArea) {
                    var D = o("content").scrollTop();
                    this.editor.writingArea.focus(),
                      o("content").scrollTop(D),
                      window.getSelection().removeAllRanges();
                  }
                  x(L, e, A), _(N);
                } else if (M == l.TYPE.fences) k(L, e, void 0, A);
                else if (
                  M == l.TYPE.html_block &&
                  this.editor.htmlBlock.currentCm
                )
                  k(L, e, this.editor.htmlBlock.currentCm, A);
                else if (
                  M == l.TYPE.math_block &&
                  this.editor.mathBlock.currentCm
                )
                  k(L, e, this.editor.mathBlock.currentCm, A);
                else if (A.closest(".td-span").length) {
                  if (t && (t.altKey || t.ctrlKey || t.metaKey)) return;
                  var B = (function (e, t) {
                    var n,
                      i = e.closest("td"),
                      r = i.prevAll().length + 1;
                    if (!i.length) {
                      if (t) return [];
                      r = (i = e.closest("th")).prevAll().length + 1;
                    }
                    return "TD" == i[0].tagName
                      ? ((n = i
                          .closest("tr")
                          [t ? "prev" : "next"]()
                          .find("td:nth-child(" + r + ")>.td-span")),
                        t &&
                          !n.length &&
                          (n = i
                            .closest("tbody")
                            .prev()
                            .find(
                              "tr:last > th:nth-child(" + r + ") > .td-span"
                            )),
                        n)
                      : t
                      ? []
                      : i
                          .closest("thead")
                          .next()
                          .find("tr:first > td:nth-child(" + r + ")>.td-span");
                  })(A.closest(".td-span"), e);
                  if (B.length)
                    t && t.preventDefault(),
                      e ? this.jumpIntoElemEnd(B) : this.jumpIntoElemBegin(B),
                      this.scrollAdjust(void 0, void 0, !0);
                  else {
                    if (h) return y(t), !1;
                    x(L, e, A);
                  }
                } else if (A.closest(".md-meta-block").length && !e)
                  A[0].normalize(),
                    !A.text()
                      .substring(window.getSelection().focusOffset)
                      .match(/\S+\n+/) && x(L, e, A);
                else {
                  if (!n && void 0 == p) {
                    var R = r.nativeRange.getClientRects();
                    p = (1 == R.length ? R[0] : {}).left;
                  }
                  var P = L.getClosetBlock(
                    !0
                  ).getVeryFirstBrotherIncludeTopBlock(e);
                  N.undo.push(this.editor.lastCursor);
                  var I = function (e, t) {
                    if (!(t = t || this.getRangy())) return 0;
                    if (
                      m ||
                      t.collapsed ||
                      e[0].contains(t.commonAncestorContainer) ||
                      e[0] == t.commonAncestorContainer
                    ) {
                      if (!1 === (i = S(t.nativeRange, !0))) return 0;
                      if (!i || !e.length || !e.text().length) return 3;
                      var n = 0,
                        r = e[0].getBoundingClientRect();
                      return (
                        (function (e, t) {
                          var n =
                            t.endContainer.nodeType == document.TEXT_NODE
                              ? t.endContainer.parentElement.parentElement
                              : null;
                          if (
                            (n &&
                              n.classList.contains("md-meta") &&
                              (n = n.parentElement),
                            n && n.classList.contains("md-image"))
                          ) {
                            if (
                              t.endContainer.textContent.length ==
                                t.endOffset &&
                              e.rawText().length == t.getBookmark(e[0]).end
                            )
                              return !0;
                            var i = t.nativeRange.getClientRects();
                            if (!i.length) return;
                            var r = i[i.length - 1],
                              o = document.elementFromPoint(r.x, r.y + 28);
                            if (
                              o &&
                              "IMG" == o.tagName &&
                              (t.collapseAfter(o),
                              e.rawText().length == t.getBookmark(e[0]).end)
                            )
                              return !0;
                          }
                        })(e, t)
                          ? (n |= 1)
                          : r.bottom - i.bottom <
                              parseInt(e.css("paddingBottom")) + 10 && (n |= 1),
                        i.top - r.top < parseInt(e.css("paddingTop")) + 10 &&
                          (n |= 2),
                        n
                      );
                    }
                  }.call(this, A);
                  I & (e ? 2 : 1)
                    ? P
                      ? E(P, A, N, p)
                      : !e && A.text().trim().length && x(L, e, A)
                    : I
                    ? T.call(this, A, L, p)
                    : T.call(this, A, L),
                    _(N),
                    !t.isDefaultPrevented() &&
                      File.isTypeWriterMode &&
                      setTimeout(this.scrollAdjust.bind(this), 0);
                }
              } catch (e) {
                e.stack;
              }
            },
            click: function (e, t, n) {
              window.getSelection().removeAllRanges();
              var i = document.createEvent("MouseEvent"),
                r = document.elementFromPoint(e, t);
              (n = "click"),
                i.initMouseEvent(
                  n,
                  !0,
                  !0,
                  window,
                  null,
                  e,
                  t,
                  0,
                  0,
                  !1,
                  !1,
                  !1,
                  !1,
                  0,
                  null
                ),
                r.dispatchEvent(i);
            },
            jumpDefComponent: function (e) {
              var t = this.editor.getMarkElem(),
                n = a.createRange();
              e
                ? (n.selectNodeContents(t.find(".md-def-name")[0]),
                  this.deRange(n, !0))
                : (n.selectNodeContents(t.find(".md-def-content")[0]),
                  this.deRange(n, !0)),
                this.editor.refocus();
            },
            jumpSelection: function () {
              return this.scrollAdjust(null, 20);
            },
            jumpTop: function (e) {
              var t = this.editor;
              if (t.sourceView && t.sourceView.inSourceMode)
                t.sourceView.cm.execCommand("goDocStart");
              else {
                var n = this.getRangy();
                if (e && n) n.setStart(t.writingArea, 0), this.deRange(n, !0);
                else if (t.nodeMap) {
                  var i = t.nodeMap.getFirst();
                  i && (i = i.getVeryFirst() || i),
                    this.jumpIntoElemBegin(t.findElemById((i || {}).cid));
                }
                File.isTypeWriterMode ||
                  o("content").animate(
                    { scrollTop: 0 },
                    "100",
                    "swing",
                    function () {
                      t.library.outline.highlightVisibleHeader();
                    }
                  );
              }
            },
            jumpBottom: function (e) {
              var t = this.editor;
              if (t.sourceView && t.sourceView.inSourceMode)
                t.sourceView.cm.execCommand("goDocEnd");
              else {
                var n = this.getRangy();
                if (e && n) {
                  n.setEnd(t.writingArea, t.writingArea.childNodes.length),
                    (n = this.deRange(n, !0));
                  try {
                    n.endContainer.parentElement.classList.contains(
                      "md-def-title"
                    ) &&
                      "" == n.endContainer.parentElement.textContent &&
                      (n.setEndAfter(
                        n.endContainer.parentElement.previousSibling
                          .previousSibling
                      ),
                      (n = this.deRange(n, !0)));
                  } catch (e) {}
                } else {
                  var i = t.nodeMap.getLast();
                  i && (i = i.getVeryFirst(!0) || i),
                    this.jumpIntoElemEnd(t.findElemById(i.cid));
                }
                File.isTypeWriterMode ||
                  o("content").animate(
                    {
                      scrollTop:
                        document.querySelector(this.editor.sessionStr)
                          .scrollHeight - window.innerHeight,
                    },
                    "100",
                    "swing",
                    function () {
                      t.library.outline.highlightVisibleHeader();
                    }
                  );
              }
            },
            lockNativeScroll: function () {
              window.addEventListener("wheel", v, { passive: !1 }),
                window.addEventListener("DOMMouseScroll", v, { passive: !1 }),
                (this.nativeScrollLocked = !1);
              var e = () => {
                this.nativeScrollLocked = setTimeout(() => {
                  this.editor.isScrolling()
                    ? e()
                    : ((this.nativeScrollLocked = !1),
                      window.removeEventListener("wheel", v, { passive: !1 }),
                      window.removeEventListener("DOMMouseScroll", v, {
                        passive: !1,
                      }));
                }, 100);
              };
              e();
            },
            typeWriterScroll: function (e, t, n) {
              var r = this.editor;
              function a(e) {
                return (
                  !(!e || (0 == e.top && 0 == e.bottom)) &&
                  (isNaN(r.defaultTextHeight) && r.selection.updateMetrics(),
                  (e = e.top - f / 2 + r.defaultTextHeight / 2),
                  Math.abs(e) > 2
                    ? n
                      ? o("content").animate(
                          { scrollTop: o("content").scrollTop() + e },
                          120,
                          "swing",
                          n
                        )
                      : o("content").scrollTop(o("content").scrollTop() + e)
                    : n && n(),
                  !0)
                );
              }
              if ((i && clearTimeout(i), (i = null), File.isTypeWriterMode)) {
                var s;
                if (t)
                  return void (
                    (s =
                      e.jquery && e.length && e[0].getBoundingClientRect()) &&
                    ((s = document.caretRangeFromPoint(
                      (s.left + s.right) / 2,
                      s.bottom - 10
                    )),
                    this.typeWriterScroll(s))
                  );
                if (!e || e.getBoundingClientRect) {
                  if (
                    (s =
                      e ||
                      (window.getSelection().rangeCount &&
                        window.getSelection().getRangeAt(0)))
                  )
                    a(S(s));
                  else n && n();
                  return;
                }
                e.top
                  ? a(e)
                  : e.jquery && e.length && a(e[0].getBoundingClientRect());
              }
            },
            scrollAdjust: function (e, t, n, i) {
              if (this.editor.sourceView && this.editor.sourceView.inSourceMode)
                this.editor.sourceView.scrollAdjust();
              else if (!this.editor.isScrolling() || this.nativeScrollLocked) {
                if (File.isTypeWriterMode && !i)
                  return this.typeWriterScroll(e);
                if (n) {
                  var r = typeof n;
                  n =
                    "number" === r || ("string" === r && !window.isNaN(n - 0))
                      ? n - 0
                      : 70;
                }
                try {
                  var a,
                    s,
                    l,
                    c,
                    d = window.innerHeight,
                    u = document.querySelector("content").scrollTop,
                    h = this.editor,
                    p =
                      e &&
                      e.jquery &&
                      e.closest("[mdtype='heading']").toArray();
                  if (e && e.jquery) {
                    if (!e.length) return;
                    a = e.offset().top + u;
                  } else if (e && e.closest) {
                    var f = e.closest(".md-diagram, .md-math-block"),
                      m = e.getBoundingClientRect();
                    (s =
                      (f ? f.getBoundingClientRect().bottom - 40 : m.top) + u) +
                      40 -
                      (a = m.top + u) >
                      d - 160 && (s = m.bottom + u);
                  } else if (e && void 0 !== e.startContainer)
                    a = (e.nativeRange || e).getClientRects()[0].top + u;
                  else {
                    var g =
                      document.activeElement.closest &&
                      document.activeElement.closest(".CodeMirror-focused");
                    if (
                      g &&
                      (g = g.querySelector(".CodeMirror-selected")).length
                    )
                      return this.scrollAdjust(g);
                    if (
                      ((l = window.getSelection().getRangeAt(0)),
                      !document.activeElement ||
                        ("VIDEO" != document.activeElement.tagName &&
                          "IMG" != document.activeElement.tagName &&
                          "IFRAME" != document.activeElement.tagName) ||
                        (l = null),
                      l)
                    )
                      if ((c = l.getBoundingClientRect()) && c.height)
                        a = c.top + u;
                      else {
                        var v = l.endContainer;
                        if (v.nodeType === document.TEXT_NODE)
                          void 0 ===
                            (c = v.parentElement.getClientRects()[0]) &&
                            (s =
                              (c = v.parentElement
                                .closest("[cid]")
                                .getClientRects()[0]).bottom + u),
                            (a = c.top + u);
                        else if (
                          ((a = void 0),
                          v !== this.editor.writingArea &&
                            (c = v.getClientRects()[0]).height < 50 &&
                            (a = c.top + u),
                          void 0 === a)
                        )
                          return;
                      }
                    else a = o(document.activeElement).offset().top;
                  }
                  s = s || a;
                  var y = 30;
                  File.inBusyMode ||
                    (y =
                      (File.isNodeHtml
                        ? o("#top-titlebar").height()
                        : document.body.classList.contains("mac-seamless-mode")
                        ? 30
                        : 0) + (o("#md-searchpanel:visible").height() || 0)),
                    void 0 !== t && null !== t
                      ? File.inBusyMode
                        ? ((o("content")[0].scrollTop = a - t - y),
                          h.library.outline.highlightVisibleHeaderWithDelay(p))
                        : o("content").animate(
                            { scrollTop: a - t - y },
                            "500",
                            "swing",
                            function () {
                              h.library.outline.highlightVisibleHeaderWithDelay(
                                p
                              );
                            }
                          )
                      : a < u + y
                      ? b(a - y - (n || 140))
                      : s > d + u - (n ? 70 : 140)
                      ? b(s - d + (n || 140))
                      : h.library.outline.highlightVisibleHeaderWithDelay();
                } catch (e) {}
              }
              function b(e) {
                File.inBusyMode
                  ? (o("content")[0].scrollTop = e)
                  : o("content").scrollTop(e),
                  h.library.outline.highlightVisibleHeaderWithDelay(),
                  h.selection.lockNativeScroll();
              }
            },
            selectAllElem: function (e) {
              if (
                !e[0] ||
                ("INPUT" != e[0].tagName && "TEXTAREA" != e[0].tagName)
              )
                if (this.editor.sourceView.inSourceMode)
                  this.editor.sourceView.cm.execCommand("selectAll");
                else {
                  if (o("body").hasClass("typora-sourceview-on"))
                    return this.editor.sourceView.cm.execCommand("selectAll");
                  (editor.needRemoveMathAfterSym = !0),
                    e
                      .find(".math-jax-postprocess>.md-math-after-sym")
                      .text("​");
                  var t = a.createRange();
                  if (e.children().length)
                    t.setStart(e.children()[0]),
                      t.setEndAfter(e.children()[e.children().length - 1]);
                  else {
                    if (!e.length) return;
                    t.selectNode(e[0]);
                  }
                  this.deRange(t, !0);
                }
              else e[0].select();
            },
            selectAll: function (e) {
              if (this.editor.sourceView.inSourceMode)
                this.editor.sourceView.cm.execCommand("selectAll");
              else if (
                (File.inBusyMode &&
                  !File.isLocked &&
                  this.editor.writingArea.setAttribute(
                    "contenteditable",
                    "true"
                  ),
                (editor.needRemoveMathAfterSym = !0),
                o(".math-jax-postprocess>.md-math-after-sym").text("​"),
                document.activeElement &&
                  c.isType(document.activeElement.tagName, "INPUT", "TEXTAREA"))
              )
                document.activeElement.select();
              else {
                var t = this.editor.getMarkElem(),
                  n = a.createRange();
                if (t.hasClass("rawedit"))
                  e || (n.selectNode(t[0]), this.setRange(n));
                else {
                  if (e && c.isType(e.target.tagName, "INPUT", "TEXTAREA"))
                    return e.target.select(), !0;
                  if (
                    isInputComponent((e && e.target) || document.activeElement)
                  )
                    return (
                      this.selectAllElem(
                        o((e && e.target) || document.activeElement)
                      ),
                      !1
                    );
                  t.find(".CodeMirror").length
                    ? t
                        .find(".CodeMirror")[0]
                        .CodeMirror.execCommand("selectAll")
                    : t.closest('[mdtype="table"]').length
                    ? (this.selectAllElem(t.closest("[mdtype='table_cell']")),
                      e && e.preventDefault())
                    : t.closest(".md-meta-block").length
                    ? (this.selectAllElem(t.closest("[mdtype='meta_block']")),
                      e && e.preventDefault())
                    : (o(this.editor.sessionStr).addClass("md-expand"),
                      o(".footnotes, .md-fences, .hr, .md-rawblock").attr(
                        "contenteditable",
                        !0
                      ),
                      n.setStart(o(this.editor.sessionStr).children()[0]),
                      o(this.editor.sessionStr)
                        .children()[0]
                        .classList.contains("md-hr") &&
                        n.setStart(o(this.editor.sessionStr).children()[1]),
                      n.setEndAfter(
                        o(this.editor.sessionStr).children().last()[0]
                      ),
                      o(this.editor.sessionStr).removeClass("md-expand"),
                      (n = this.deRange(n)),
                      this.fixSafariRange(n),
                      this.setRange(n),
                      e && e.preventDefault(),
                      File.isMac &&
                        setTimeout(function () {
                          o(".footnotes, .md-fences, .hr, .md-rawblock").prop(
                            "contenteditable",
                            !1
                          );
                        }, 10));
                }
                this.editor.lastCursor = this.buildUndo();
              }
            },
            getEndNode: function (e) {
              return this.getDetailPos(e.endContainer, e.endOffset)[0];
            },
            getDetailPos: function (e, t, n) {
              var i = {};
              function r(e) {
                1 === e.nodeType &&
                  0 === e.childNodes.length &&
                  e.appendChild(document.createTextNode(""));
              }
              function o(e) {
                if ((r(e), e.childNodes.length)) return e.childNodes.length;
                if (3 === e.nodeType) return e.textContent.length;
                if (void 0 !== e.length) return e.length;
                throw i;
              }
              if (
                e.parentElement &&
                e.parentElement.classList.contains("md-def-split")
              )
                return 0 == t
                  ? this.getDetailPos(
                      e.parentElement.previousElementSibling,
                      e.parentElement.previousElementSibling.textContent.length,
                      n
                    )
                  : this.getDetailPos(e.parentElement.nextElementSibling, 0, n);
              if (1 == e.nodeType) {
                var a = e.childNodes;
                if (
                  (e.classList.contains("md-image") && 2 === t && (t = 1),
                  e.tagName == "mjx-assistive-mml".toUpperCase())
                ) {
                  if (!n)
                    return this.getDetailPos(
                      e.parentElement.parentElement.parentElement,
                      e.parentElement.parentElement.parentElement
                        .childElementCount
                    );
                } else if (e.tagName == "mjx-container".toUpperCase())
                  return 0 == t
                    ? this.getDetailPos(e.parentElement.parentElement, 0)
                    : this.getDetailPos(
                        e.parentElement.parentElement,
                        e.parentElement.parentElement.childElementCount
                      );
                if (
                  (r(e),
                  !a ||
                    !a.length ||
                    (e.classList && e.classList.contains("md-fences")))
                )
                  return [e, t];
                try {
                  var s =
                    a[t] &&
                    a[t].getAttribute &&
                    "checkbox" === a[t].getAttribute("type");
                  return n
                    ? (s && t++,
                      t == a.length
                        ? this.getDetailPos(a[t - 1], o(a[t - 1]))
                        : this.getDetailPos(a[t], 0, !0))
                    : 0 == t
                    ? (s && t++, this.getDetailPos(a[t], 0))
                    : this.getDetailPos(a[t - 1], o(a[t - 1]));
                } catch (n) {
                  return [e, t];
                }
              }
              return [e, t];
            },
            fixSafariRange: function (e) {
              if (File.isSafari) {
                var t,
                  n,
                  i = o(e.startContainer).closest(".md-meta, .md-content");
                i.length &&
                  0 == e.startOffset &&
                  (n = (t = i.closest(
                    "[contenteditable='true'], [cid]"
                  )).children()[0]) &&
                  e.setStart(n, 0),
                  (i = o(e.endContainer).closest(".md-meta, .md-content"))
                    .length &&
                    ((t = i.closest(
                      "[contenteditable='true'], [cid]"
                    )).hasClass("md-meta") &&
                      (t = t
                        .parent()
                        .closest("[contenteditable='true'], [cid]")),
                    (n = t.children().last()[0]) && e.setEndAfter(n));
              }
            },
            deRange: function (e, t, n) {
              var i = n || e.cloneRange();
              try {
                var r = this.getDetailPos(e.startContainer, e.startOffset, !0),
                  o = this.getDetailPos(e.endContainer, e.endOffset, !1);
                return (
                  t &&
                    r[0].parentElement &&
                    "HR" == r[0].parentElement.tagName &&
                    (r[0] = r[0].parentElement.parentElement),
                  e.setStart.apply(e, r),
                  e.setEnd.apply(e, o),
                  n && n.equals(e) ? n : (t && this.setRange(e, !0), e)
                );
              } catch (e) {}
              return i;
            },
            selectBlock: function () {
              this._selectLine("block");
            },
            selectLine: function () {
              return this._selectLine(!1);
            },
            selectLineWrap: function () {
              this._selectLine("line");
            },
            _selectLine: function (e) {
              var t, n;
              if (this.editor.sourceView.inSourceMode)
                return (
                  (n = (t = this.editor.sourceView.cm).getCursor(!0)),
                  void t.setSelection(
                    s.Pos(n.line, 0),
                    s.Pos(n.line, t.getLine(n.line).length)
                  )
                );
              var i = o(document.activeElement).closest(".CodeMirror");
              if (i.length)
                return (
                  (n = (t = i[0].CodeMirror).getCursor(!0)),
                  void ("block" == e
                    ? t.execCommand("selectAll")
                    : t.setSelection(
                        s.Pos(n.line, 0),
                        s.Pos(n.line, t.getLine(n.line).length)
                      ))
                );
              if (
                document.activeElement &&
                c.isType(document.activeElement.tagName, "INPUT")
              )
                document.activeElement.select();
              else if ((d = window.getSelection()).rangeCount) {
                var r = this.editor.getMarkElem(d.commonAncestorContainer),
                  l = a.createRange();
                if (r.length) {
                  if ("block" == e)
                    return (
                      r.closest('[mdtype="table"]').length &&
                        (r = r.closest('[mdtype="table"]')),
                      this.selectAllElem(r),
                      r
                    );
                  if (!r.closest("tr[mdtype='table_row']").length) {
                    r.addClass("md-expand-on-selection");
                    var d = window.getSelection();
                    (l = this.getRangy()).getBookmark(r[0]).start &&
                      d.modify(
                        "move",
                        "backward",
                        e ? "paragraphboundary" : "sentence"
                      ),
                      d.modify(
                        "extend",
                        "forward",
                        e ? "paragraphboundary" : "sentence"
                      ),
                      (l = this.getRangy());
                    var u = o(l.commonAncestorContainer).closest(".md-meta");
                    return (
                      u.length
                        ? this.selectAllElem(u.closest("[md-inline]"))
                        : (u = this.editor.getMarkElem(l.startContainer))
                            .length &&
                          u[0] !== this.editor.getMarkElem(l.endContainer)[0] &&
                          (l.setEndAfter(u[0]), this.deRange(l, !0)),
                      r.removeClass("md-expand-on-selection"),
                      r
                    );
                  }
                  var h = r.closest("tr[mdtype='table_row']");
                  l.selectNode(h[0]),
                    h.closest('[mdtype="table"]').attr("contenteditable", !0),
                    this.deRange(l, !0),
                    h.closest('[mdtype="table"]').attr("contenteditable", !1);
                }
              }
            },
            fixTripleClick: function (e) {
              var t = this.editor.getMarkElem(e.target);
              t.attr("mdtype") == l.TYPE.table_cell
                ? this.selectAllElem(t)
                : this.selectLineWrap();
            },
            fixDblClick: function (e) {
              var t = this,
                n = this.editor,
                i = this.getRangy();
              (function () {
                var t = o(e.target).closest(
                  "[md-inline='image'],[md-inline='imgtag']"
                );
                if (t.length) {
                  if ("image" == t.attr("md-inline")) {
                    var r = o(e.target);
                    if (
                      (r.hasClass("md-image-src-span") ||
                        (r = r.closest(".md-image-src-span")),
                      r.length)
                    ) {
                      if (i) {
                        var a = (r.text().match(/\s['"]/) || {}).index;
                        if ((i.setStart(r[0], 0), a)) {
                          if (i.endOffset > a) return !0;
                          i.setEnd(r[0].childNodes[0], a);
                        } else i.setEnd(r[0], 1);
                        return n.selection.setRange(i), !0;
                      }
                    } else r = o(e.target).closest(".md-image-before-src");
                    if (r.length && i) {
                      var s = r.text(),
                        l = s.indexOf("]") + 2;
                      if (i.startOffset > l)
                        return (
                          i.setStart(r[0].childNodes[0], l),
                          i.setEnd(r[0].childNodes[0], s.length - 1),
                          i.select(i.isBackward),
                          !0
                        );
                      if (
                        i.startOffset >= 2 &&
                        i.endOffset > i.startOffset &&
                        i.endOffset < l - 1
                      )
                        return (
                          i.setStart(r[0].childNodes[0], 2),
                          i.setEnd(r[0].childNodes[0], l - 2),
                          i.select(i.isBackward),
                          !0
                        );
                    }
                    return n.selection.selectAllElem(t), !0;
                  }
                  if ("IMG" == e.target.tagName)
                    return n.selection.selectAllElem(t), !0;
                }
              })() ||
                (function () {
                  if (
                    i &&
                    i.endContainer &&
                    3 == i.endContainer.nodeType &&
                    1 == i.endOffset
                  ) {
                    var e = i.endContainer,
                      n = e.textContent.substring(0, 1);
                    if (/\s/.exec(n)) {
                      var r = s(e.parentElement);
                      if (r) {
                        for (var o = l(r), a = !1; o; )
                          i.containsNode(o) &&
                            !o.offsetWidth &&
                            ((a = !0), i.setEndBefore(o)),
                            (o = (r = s(r)) && l(r));
                        return a && t.setRange(i), a;
                      }
                    }
                  }
                  function s(e) {
                    for (
                      var t = e.previousElementSibling;
                      !t && !(e = e.parentElement).getAttribute("cid") && e;

                    )
                      t = e.previousElementSibling;
                    return t;
                  }
                  function l(e) {
                    if (e.classList.contains("md-meta")) return e;
                    for (; e; ) {
                      if (!e.children) return null;
                      if (
                        (e = e.children[e.children.length - 1]) &&
                        e.classList &&
                        e.classList.contains("md-meta")
                      )
                        return e;
                    }
                    return null;
                  }
                })();
            },
            selectWord: function (e, t, n, i, a) {
              var s, l;
              if (this.editor.sourceView.inSourceMode)
                return (
                  (l = (s = this.editor.sourceView.cm).findWordAt(
                    s.getCursor()
                  )),
                  void (!i && s.extendSelection(l.anchor, l.head))
                );
              this.selectWordTime = new Date();
              var c = o(document.activeElement).closest(".CodeMirror");
              if (c.length)
                return (
                  (l = (s = c[0].CodeMirror).findWordAt(s.getCursor())),
                  void (!i && s.extendSelection(l.anchor, l.head))
                );
              if ((n = n || this.getRangy())) {
                var d = null;
                if (
                  e &&
                  (d = o(n.startContainer).closest(".md-meta, .md-content"))
                    .length
                )
                  return (
                    n.selectNode(d.closest("[md-inline]")[0]),
                    !i && this.setRange(n),
                    n
                  );
                if (
                  (d = o(n.startContainer).closest(
                    ".md-content, [md-inline='url'], [md-inline='emoji'], [md-inline='escape']"
                  )).length
                )
                  return (
                    n.selectNode(d.closest("[md-inline]")[0]),
                    !i && this.setRange(n, !0),
                    n
                  );
                if (
                  ((d = o(n.startContainer).closest("[md-inline]")).length ||
                    (d = o(n.startContainer).closest("[cid]")),
                  d.length)
                ) {
                  var u = n.getBookmark(d[0]).start,
                    p = d.rawText(),
                    f = /[\u3040-\uABFF\uD7A4-\uFAFF]/,
                    m = /[a-zA-Z\u00C0-\u00ff]/,
                    g = /[0-9a-zA-Z\u00C0-\u00ff]/,
                    v = /^['’‚‛]$/,
                    y = [],
                    b = null;
                  if (
                    (p
                      .split(a ? r.WESTERN_WORD_SPLITTER_SPELLCHECKER : h)
                      .filter(function (e) {
                        return !!e;
                      })
                      .forEach(function (e) {
                        if (f.test(e)) b ? (b += e) : (b = e);
                        else {
                          if (b) y.push(b);
                          else {
                            var t = y.length;
                            if (v.exec(y[t - 1] || "")) {
                              if (m.exec(e) && m.exec(y[t - 2] || ""))
                                return void (y[t - 2] = y[t - 2] + y.pop() + e);
                            } else if (
                              "." == y[t - 1] &&
                              g.exec(e) &&
                              g.exec(y[t - 2] || "")
                            )
                              return void (y[t - 2] = y[t - 2] + y.pop() + e);
                          }
                          y.push(e), (b = null);
                        }
                      }),
                    b && y.push(b),
                    y.length)
                  ) {
                    var w = 0,
                      x = p.length,
                      C = 0,
                      F = 0,
                      S = !1;
                    for (F = 0; F < y.length; F++) {
                      var k = y[F].length;
                      if (C + k >= u) {
                        S = C + k == u;
                        break;
                      }
                      C += k;
                    }
                    if (F >= y.length - 1) {
                      if (
                        ((w = (x = p.length) - y.last().length),
                        e && r.NOT_WORD.exec(y.last()))
                      )
                        return;
                    } else if (S && !r.NOT_WORD.exec(y[F + 1]))
                      (x = (w = C + y[F].length) + y[1 + F].length),
                        t && /\s/.exec(y[F + 2] || "a") && (x += 1);
                    else if (r.NOT_WORD.exec(y[F])) {
                      if (e) return;
                      x = (w = C + y[F].length) + y[1 + F].length;
                    } else
                      (x = (w = C) + y[F].length),
                        t && /\s/.exec(y[F + 1] || "a") && (x += 1);
                    return (
                      n.moveToBookmark({
                        containerNode: d[0],
                        start: w,
                        end: x,
                      }),
                      i ||
                        (this.setRange(n, !0),
                        this.editor.wordCount.updateInSelection()),
                      n
                    );
                  }
                }
              }
            },
            selectPhrase: function () {
              if (this.editor.sourceView.inSourceMode) {
                var e = this.editor.sourceView.cm,
                  t = e.findWordAt(e.getCursor());
                e.extendSelection(t.anchor, t.head);
              } else if (
                document.activeElement &&
                c.isType(document.activeElement.tagName, "INPUT")
              )
                document.activeElement.select();
              else {
                var n = o(document.activeElement).closest(".CodeMirror");
                if (n.length) (e = n[0].CodeMirror).execCommand("selectAll");
                else {
                  var i,
                    r = this.getRangy(!0),
                    a = !1;
                  if (r) {
                    if (this.editor.styleBookmark.style) {
                      var s = this.editor.styleBookmark.style.block;
                      if (
                        (s.indexOf(u.def_footnote) > -1 ||
                        s.indexOf(u.def_link) > -1
                          ? /md-def-(name|url|title)|/gi.exec(
                              document.activeElement.className
                            ) &&
                            ((a = !0),
                            (i = o(r.startContainer).closest(
                              ".md-def-name, .md-def-url, .md-def-title"
                            )[0]))
                          : s.indexOf(u.table) > -1 &&
                            ((a = !0),
                            (i = o(r.startContainer).closest(
                              "[mdtype='table_cell']"
                            )[0])),
                        (i =
                          i ||
                          (function e(t) {
                            return t
                              ? t.nodeType === t.ELEMENT_NODE
                                ? t.hasAttribute("md-inline") &&
                                  t.getAttribute("md-inline") !== u.plain
                                  ? t
                                  : t.hasAttribute("mdtype")
                                  ? t
                                  : t.classList.contains("md-def-name") ||
                                    t.classList.contains("md-def-content") ||
                                    t.classList.contains("md-def-title")
                                  ? t
                                  : e(t.parentElement)
                                : t.nodeType === t.TEXT_NODE
                                ? e(t.parentElement)
                                : null
                              : null;
                          })(r.startContainer)))
                      )
                        return (
                          (function (e, t, n) {
                            e.getAttribute("md-inline") == u.image &&
                              ((n = !1), (e = e.children[0])),
                              n
                                ? t.selectNodeContents(e)
                                : (t.selectNode(e),
                                  editor.selection.deRange(t));
                          })(i, r, a),
                          this.setRange(r, !0)
                        );
                    }
                    return this.selectWord();
                  }
                }
              }
            },
            isCrossBlock: function (e) {
              return (e = e || this.getRangy())
                ? !e.collapsed &&
                    this.editor
                      .getJQueryElem(e.commonAncestorContainer)
                      .find("[mdtype]").length
                : e;
            },
            handleMouseSelection: function (e) {
              "false" ==
                this.editor.writingArea.getAttribute("contenteditable") &&
                (this.getBlockFromMouseEvent(e).closest(".md-focus").length ||
                  this.editor.writingArea.setAttribute(
                    "contenteditable",
                    "true"
                  ));
            },
            getBlockFromMouseEvent: function (e) {
              var t = e.target;
              return (
                this.editor.writingArea.contains(e.target) ||
                  (t = document.elementFromPoint(e.clientX, e.clientY)),
                o(t).closest("[cid]")
              );
            },
            getTextAround: function () {
              var e,
                t,
                n = this.getRangy();
              if (n && n.collapsed) {
                var i = o(n.startContainer).closest(
                  "[md-inline='plain'], .md-lang"
                )[0];
                if (i) {
                  var r = n.getBookmark(i);
                  return (
                    n.setStartBefore(i),
                    (e = n.toString()),
                    n.collapse(!1),
                    n.setEndAfter(i),
                    (t = n.toString()),
                    n.setStart(i, 0),
                    [e, t, r]
                  );
                }
              }
              return [];
            },
            getTextInSelection: function (e) {
              var t = o(document.activeElement).closest(".CodeMirror");
              return t.length
                ? t[0].CodeMirror.getSelection()
                : (e = e || this.getRangy()) &&
                  !e.collapsed &&
                  o(e.commonAncestorContainer).closest("#write").length
                ? o(o.parseHTML("<div>" + e.toHtml() + "</div>"))
                    .find("[mdtype]")
                    .after("\n")
                    .filter(".md-toc")
                    .text("[toc]")
                    .end()
                    .filter(".md-math-block")
                    .text(function () {
                      return o(this).find("script").html();
                    })
                    .end()
                    .find(".CodeMirror-gutter-wrapper")
                    .remove()
                    .end()
                    .end()
                    .text()
                : "";
            },
            extendRange: function (e, t) {
              if (e.commonAncestorContainer.nodeType === document.TEXT_NODE) {
                if (
                  t > 0 &&
                  e.endOffset + t <= e.commonAncestorContainer.length
                )
                  return (
                    e.setEnd(e.commonAncestorContainer, e.endOffset + t), e
                  );
                if (t < 0 && e.startOffset + t >= 0)
                  return (
                    e.setStart(e.commonAncestorContainer, e.startOffset + t), e
                  );
              }
              var n = o(e.startContainer).closest("[cid]")[0],
                i = e.getBookmark(n);
              return i.containerNode
                ? (t > 0 ? (i.end += t) : (i.start += t),
                  e.moveToBookmark(i),
                  e)
                : e;
            },
            createRange: function (e, t, n, i) {
              var r = a.createRange();
              return (
                r.setStart(e, t), r.setEnd(n, i), r.startContainer ? r : null
              );
            },
            moveToSelectable: function (e, t) {
              return F(this.editor, e, t);
            },
            includeTrailMeta: function (e) {
              if (!e || e.collapsed) return e;
              function t(n, i, r) {
                var a = i ? n.previousElementSibling : n.nextElementSibling;
                return n == e.commonAncestorContainer ||
                  n.parentElement == e.commonAncestorContainer ||
                  !n.parentElement ||
                  (n.getAttribute && n.getAttribute("cid"))
                  ? r
                  : (a &&
                      a.classList &&
                      a.classList.contains("md-meta") &&
                      !o(a.parentElement).closest(".md-expand").length &&
                      (r = a),
                    t(n.parentElement, i, r));
              }
              var n;
              if (0 == e.startOffset) {
                var i = t(e.startContainer, !0);
                i && ((n = !0), e.setStart(i, 0));
              }
              if (
                (e.endContainer.childNodes &&
                  e.endOffset == e.endContainer.childNodes.length) ||
                (e.endContainer.nodeType == document.TEXT_NODE &&
                  e.endOffset == e.endContainer.nodeValue.length)
              ) {
                var r = t(e.endContainer, !1);
                r && ((n = !0), e.setEnd(r, r.childNodes.length));
              }
              return n && this.setRange(e, !0), e;
            },
          });
        var y = function (e) {
            e &&
              ((e.codemirrorIgnore = !0),
              e.preventDefault(),
              e.stopPropagation());
          },
          b = function (e, t) {
            return (
              c.isType(e, c.TYPE.hr, c.TYPE.toc) &&
              (!t ||
                ("write" !== t.attr("id") && t[0].hasAttribute("tabindex")))
            );
          },
          w = function (e) {
            var t = e[0];
            return (
              t.childElementCount > 0 &&
              (function () {
                for (var e = 0; e < t.childElementCount; e++)
                  if (t.children[0].getAttribute("md-inline") !== u.image)
                    return !1;
                return !0;
              })()
            );
          },
          x = function (e, t, n) {
            var i;
            if (
              (t.getAttribute("mdtype") === u.fences &&
                (i = e.fences.getCm(t.getAttribute("cid"))),
              t.getAttribute("mdtype") === u.math_block &&
                (i = e.mathBlock.startEditing(o(t))),
              t.getAttribute("mdtype") === u.html_block &&
                (i = e.htmlBlock.startEditing(o(t))),
              i)
            )
              return (
                i.then
                  ? i.then((e) => {
                      e.focus(), e.setCursor(n);
                    })
                  : (i.focus(), i.setCursor(n)),
                !0
              );
          },
          C = function (e, t) {
            if (void 0 != t) {
              var n = e.cursorCoords(e.getCursor());
              n.left = n.right = t;
              var i = e.coordsChar(n);
              e.setCursor(i);
            }
          },
          F = function (e, t, n, i, r, o) {
            if (!n) return !1;
            var a = e.findElemById(n.id);
            e.lastCursor = e.selection.buildUndo();
            var s = !r;
            if (c.isType(n, u.fences))
              return (
                (l = e.fences.getCm(n.id)).focus(),
                t
                  ? (a.find(".ty-input-after").focus(),
                    setTimeout(function () {
                      File.isTypeWriterMode &&
                        File.option.scrollWithCursor &&
                        e.selection.typeWriterScroll(a.find(".ty-input-after"));
                    }, 0))
                  : (l.execCommand("goDocStart"), C(l, o)),
                y(i),
                !0
              );
            if (c.isType(n, u.math_block))
              return (
                t
                  ? ((l = e.mathBlock.startEditing(
                      a,
                      !n.get("tagAfter") && "end",
                      s
                    )),
                    n.get("tagAfter")
                      ? setTimeout(function () {
                          e.selection.selectAllElem(
                            a.find(".ty-input-after").focus()
                          );
                        }, 0)
                      : C(l, o))
                  : ((l = e.mathBlock.startEditing(
                      a,
                      !n.get("tagBefore") && "start",
                      s
                    )),
                    n.get("tagBefore")
                      ? setTimeout(function () {
                          e.selection.selectAllElem(
                            a.find(".ty-input-before").focus()
                          );
                        }, 0)
                      : C(l, o)),
                y(i),
                !0
              );
            if (c.isType(n, u.html_block)) {
              var l = e.htmlBlock.startEditing(a, t ? "end" : "start", s);
              return C(l, o), y(i), !0;
            }
            return (
              !!b(n) &&
              (y(i),
              window.getSelection().removeAllRanges(),
              e.findElemById(n.id).focus(),
              e.refocus(),
              !0)
            );
          },
          S = function (e, t) {
            if (
              (function (e) {
                return (
                  e.collapsed &&
                  e.startContainer &&
                  e.startContainer.nodeType == document.TEXT_NODE &&
                  "\n" == e.startContainer.textContent &&
                  (e.startContainer.nextSibling || {}.classList) &&
                  e.startContainer.nextSibling.classList.contains(
                    "md-emptyline"
                  )
                );
              })(e)
            )
              return e.startContainer.nextSibling.getBoundingClientRect();
            var n,
              i = e.getClientRects(),
              r = 1 == i.length && i[i.length - 1];
            if (i.length > 1) {
              if (t) return !1;
              r = e.getBoundingClientRect();
            }
            return !r && e.collapsed
              ? (n =
                  e.startContainer.nodeType == document.TEXT_NODE
                    ? e.startContainer.parentElement
                    : e.startContainer) && "write" != n.getAttribute("id")
                ? (r = n.getBoundingClientRect()).height > 150
                  ? null
                  : r
                : null
              : r;
          };
        (n.exports = m),
          (n.exports.buildRange = function (e, t, n) {
            if (!e) return window.getSelection().removeAllRanges();
            var i = 0,
              r = a.createRange(),
              o = !1,
              s = {};
            r.collapseToPoint(e, 0);
            try {
              !(function e(a) {
                if (3 == a.nodeType) {
                  var l = i + a.textContent.length;
                  if (
                    (!o && t >= i && t <= l && (r.setStart(a, t - i), (o = !0)),
                    o && n >= i && n <= l)
                  )
                    throw (r.setEnd(a, n - i), s);
                  i = l;
                } else
                  for (var c = 0, d = a.childNodes.length; c < d; ++c)
                    e(a.childNodes[c]);
              })(e);
            } catch (e) {
              if (e == s) return r;
              throw e;
            }
          }),
          (n.exports.rangy = a);
      }
    ),
    $__System.registerDynamic(
      "41",
      ["11", "13", "e", "19", "31", "32", "1b", "34", "30"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("13"),
          o = r.Node,
          a = r.TYPE,
          s = e("e"),
          l = e("19"),
          c = (e("31").rangy, e("32")),
          d = e("1b"),
          u = e("34"),
          h = e("30");
        class p {
          constructor() {
            this.reset(),
              Object.defineProperty(this, "length", {
                get: function () {
                  return this._set.length;
                },
              });
          }
          get(e) {
            return this._map.get(e);
          }
          add(e) {
            e.cid && this._map.set(e.cid, e), this._set.push(e);
          }
          push(e) {
            this.add(e);
          }
          remove(e) {
            if (e.cid) {
              var t = this._map.get(e.cid);
              this._map.delete(e.cid), t && this._set.remove(t);
            }
            this._set.remove(e);
          }
          reset() {
            (this._set = []), (this._map = new Map());
          }
          forEach(e, t) {
            this._set.clone().forEach(e, t);
          }
          indexOf(e) {
            for (var t = 0, n = this.sortedFirst(); n; ) {
              if (e == n) return t;
              (n = n.get("after")), t++;
            }
            return -1;
          }
          getNodeByRef(e) {
            for (let t of this._set)
              if (
                i.escape(t.get("ref")).toLowerCase() ==
                i.escape(e).toLowerCase()
              )
                return t;
          }
          getFootHTMLByRef(e, t) {
            var n = this.getNodeByRef(e);
            return n
              ? (t && File.editor.store(n.cid, !0),
                "<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'>" +
                  editor.brush.inline.output(n.get("text")) +
                  "</div></div>")
              : null;
          }
          getHrefByRef(e, t, n) {
            var r = this.getNodeByRef(e);
            r && t && File.editor.store(r.cid, !0);
            var o = r ? r.get("href") : void 0;
            return n ? o : o ? i.escape(o) : void 0;
          }
        }
        var f,
          m = function (e) {
            switch (e.type) {
              case a.strong:
                return "<strong>" + e.inner + "</strong>";
              case a.em:
                return "<em>" + e.inner + "</em>";
              case a.code:
                return "<code>" + i.escape(e.text) + "</code>";
              case a.plain:
                return i.escape(e.text);
              case a.tag:
                return "";
              case a.imgtag:
              case a.refimg:
              case a.image:
                return "";
              case a.inline_math:
                return h.decorateAsExport(e, { forPrint: !0 });
              case a.underline:
                return "<u>" + e.inner + "</u>";
              case a.del:
                return "<del>" + e.inner + "</del>";
              case a.footnote:
                return "";
              case a.escape:
                return i.escape(e.text);
              case a.highlight:
                return "<mark>" + e.inner + "</mark>";
              case a.superscript:
                return "<sup>" + e.inner + "</sup>";
              case a.subscript:
                return "<sub>" + e.inner + "</sub>";
              case a.linebreak:
                return "";
              case a.tab:
                return "<span>" + e.inner + "</span>";
              default:
                return e.inner || i.escape(e.text || "");
            }
          };
        function g() {
          return f || (f = new l.InlineLexer(null, m)), f;
        }
        class v {
          constructor(e) {
            (this.nodeMap = e),
              this.refresh(),
              (this.delay = 300),
              (this.refreshTimeout = null);
          }
          remove(e) {
            var t = this.headers.indexOf(e);
            t > -1 && this.headers.splice(t, 1);
          }
          updateHeaderText(e) {
            if (
              !this.refreshTimeout &&
              !File._onInitPars &&
              this.headers &&
              -1 != this.headers.indexOf(e)
            ) {
              var t = f.output(e.get("text"));
              s(".md-toc-item[data-ref='" + e.cid + "']")
                .children(".md-toc-inner")
                .html(t),
                s(
                  "#outline-content .outline-label[data-ref='" + e.cid + "']"
                ).html(t),
                window.File &&
                  File.editor &&
                  File.editor.mathInline &&
                  File.editor.mathInline.renderInToc();
            }
          }
          refresh(e, t) {
            if (!File._onInitParse) {
              var n = this;
              this.refreshTimeout && clearTimeout(this.refreshTimeout),
                (this.refreshTimeout = null),
                e
                  ? i.call(n)
                  : (this.refreshTimeout = setTimeout(function () {
                      i.call(n);
                    }, this.delay));
            }
            function i() {
              var e = this.nodeMap.getFirst();
              for (this.headers = []; e; )
                o.isType(e, o.TYPE.heading)
                  ? this.headers.push(e)
                  : File.option.expandSimpleBlock &&
                    o.isType(e, o.TYPE.paragraph) &&
                    e.get("depth") &&
                    this.headers.push(e),
                  (e = e.get("after"));
              !t && this.updateHTML(), (this.refreshTimeout = null);
            }
          }
          getTocInnerHTML() {
            var e = "";
            return (
              (this.headers || []).map(function (t) {
                var n, i;
                t.isDeleted() ||
                  (e +=
                    ((i = (n = t).get("text")),
                    o.isType(n, o.TYPE.paragraph) &&
                      (i = n.getText().replace(/(^#+\s*)|(#+\s*$)|\n.*/, "")),
                    "<span role='listitem' class='md-toc-item md-toc-h" +
                      n.get("depth") +
                      "' data-ref='" +
                      n.cid +
                      "'><a class='md-toc-inner'>" +
                      f.output(i) +
                      "</a></span>"));
              }),
              e
            );
          }
          updateHTML(e) {
            var t = 0,
              n = document.querySelectorAll(".md-toc-content");
            if (n.length > 0) {
              var i = this.getTocInnerHTML();
              for (t = 0; t < n.length; t++)
                n[t].innerHTML != i && (n[t].innerHTML = i);
            }
            File.editor.library &&
              File.editor.library.outline.updateOutlineHtml(this, e),
              File.editor.mathInline && File.editor.mathInline.renderInToc(),
              File.editor.tryEnterBusyModeWithDelay();
          }
        }
        class y {
          constructor(e) {
            var t = this;
            g(),
              (this.expandedOutlineItem = []),
              (e.nodeMap.foot_list = new p()),
              (e.nodeMap.link_list = new p()),
              (e.nodeMap.toc = new v(e.nodeMap)),
              (this.editor = e),
              (function () {
                var e,
                  n,
                  i = t.editor;
                function r() {
                  (e = !1),
                    setTimeout(function () {
                      e || s(".md-f-tooltip").remove();
                    }, 500);
                }
                setTimeout(function () {
                  s(document)
                    .on("mouseenter mousemove", ".md-footnote", function () {
                      if (!e || n !== i.focusCid) {
                        if (
                          window.getSelection().anchorNode &&
                          this.contains(
                            window.getSelection().anchorNode.parentElement
                          )
                        )
                          return;
                        (e = !0),
                          (n = i.focusCid),
                          t.showTooltipForSup(s(this));
                      }
                    })
                    .on("mouseleave", ".md-footnote", r)
                    .on("mouseenter", ".md-f-tooltip", function () {
                      e = !0;
                    })
                    .on("mouseleave", ".md-f-tooltip", r);
                }, 300);
              })(),
              this.registerBridge();
          }
          registerBridge() {
            if (File.isMac) {
              var e = this;
              bridge.registerHandler(
                "docMenu.getLocalRootUrl",
                function (t, n) {
                  n(e.getLocalRootUrl() || "");
                }
              ),
                bridge.registerHandler(
                  "docMenu.removeProperty",
                  function (t, n) {
                    e.removeProperty(t), n && n();
                  }
                );
            }
          }
          getAttrByElem(e) {
            return e.hasClass("md-def-name")
              ? "ref"
              : e.hasClass("md-def-content")
              ? e.hasClass("md-def-url")
                ? "href"
                : "text"
              : e.hasClass("md-def-title")
              ? "title"
              : void 0;
          }
          addEmptyDef(e, t) {
            var n = this.editor;
            function i(i) {
              var r = n.findNodeByElem(i),
                a = n.undo.UndoManager.makeEmptyCommand();
              r.addAfter(new o({ type: t, ref: e, url: "", text: "" })),
                n.undo.UndoManager.addUndoForInsert(a, r.get("after")),
                i.after(r.get("after").toHTML()),
                n.selection.jumpIntoElemBegin(i.next().find(".md-def-content")),
                a.redo.push(n.selection.buildUndo()),
                n.undo.register(a),
                n.refocus();
            }
            n.undo.endSnap(!0);
            var r = s(n.sessionStr)
              .find(t == o.TYPE.def_link ? ".md-def-link" : ".md-def-footnote")
              .last();
            !r.length || r.nextAll(":not(.footnotes)").length
              ? i(s(n.sessionStr).children().last())
              : i(r);
          }
          jumpToFootnote(e, t) {
            this.editor.undo.endSnap(!0);
            var n = e.find(".md-def-name").text() || "",
              r = s(
                ".md-footnote[data-ref='" +
                  i.escape(n.trim()).toLowerCase() +
                  "']"
              )[t];
            if (r) {
              var o = this.editor.selection;
              o.jumpIntoElemEnd(e);
              var a = d.makeEmptyCommand(o.buildUndo());
              o.jumpInto(s(r), 0),
                o.scrollAdjust(void 0, 100),
                a.redo.push(o.buildUndo()),
                (a.cursorOnly = !0),
                this.editor.undo.register(a),
                this.editor.refocus();
            }
          }
          jumpToFootnoteDef(e) {
            var t = this.editor;
            if ((t.undo.endSnap(!0), e.length)) {
              var n = e.find(".md-text").text() || "",
                i = t.nodeMap.foot_list.getNodeByRef(n, !0);
              if (i) {
                t.selection.jumpIntoElemEnd(e);
                var r = d.makeEmptyCommand(t.selection.buildUndo());
                t.selection.jumpIntoElemEnd(t.findElemById(i.cid)),
                  t.selection.scrollAdjust(void 0, 100),
                  r.redo.push(t.selection.buildUndo()),
                  (r.cursorOnly = !0),
                  t.undo.register(r),
                  t.refocus();
              } else this.showTooltipForSup(e);
            }
          }
          refreshFootnoteReverseLink(e) {
            if (!File.inBusyMode)
              try {
                if (e && !e.querySelector(".md-footnote, .md-def-footnote"))
                  return;
                for (
                  var t = this.editor,
                    n = document.querySelectorAll("#write .md-footnote"),
                    r = {},
                    o = 0;
                  o < n.length;
                  o++
                ) {
                  var a = (n[o].getAttribute("data-ref") || "").trim();
                  r[a] = (r[a] || 0) + 1;
                }
                t.nodeMap.foot_list.forEach((e) => {
                  var n =
                      r[i.escape((e.get("ref") || "").trim()).toLowerCase()] ||
                      0,
                    o = t.findElemById(e.cid);
                  if (o.length && o.hasClass("md-def-footnote")) {
                    for (
                      var a = o.find(".md-reverse-footnote-area"),
                        l = a.html() || "",
                        c = "",
                        d = s.localize.getString("back to document", "Front"),
                        u = 0;
                      u < n;
                      u++
                    )
                      c +=
                        " <a class='reversefootnote' title='" +
                        d +
                        "' data-index='" +
                        u +
                        "'>↩</a>";
                    c && !a.length
                      ? o
                          .find(".md-def-content")
                          .after(
                            "<span class='md-reverse-footnote-area' contenteditable='false'>" +
                              c +
                              "</span>"
                          )
                      : a.length && !c
                      ? a.remove()
                      : l.replace(/[\s'"]/g, "") != c.replace(/[\s'"]/g, "") &&
                        a.html(c);
                  }
                });
              } catch (e) {
                console.sendError(e);
              }
          }
          showTooltipForSup(e) {
            var t,
              n,
              i = this.editor;
            if (e.length) {
              var o = e.find(".md-text").text();
              (t = i.nodeMap.foot_list.getFootHTMLByRef(o, !0)),
                s(".md-tooltip-remove").remove(),
                t
                  ? ((n = s(s.parseHTML(t)[0])), s("body").append(n))
                  : File.isLocked ||
                    ((t =
                      "<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'><span class='fa text-warning fa-exclamation-triangle' title='warning' aria-hidden='true' /> " +
                      s.localize
                        .getString(
                          "Need to define the reference footnote <b>{0}</b> with syntax <a>[^{1}]: www.example.com</a>"
                        )
                        .format(o, o)
                        .trim() +
                      " </div></div>"),
                    (n = s(s.parseHTML(t)[0])),
                    s("body").append(n),
                    n
                      .find(".code-tooltip-content a")
                      .unbind("click")
                      .click(function () {
                        i.docMenu.addEmptyDef(o, r.TYPE.def_footnote);
                      })),
                this.editor.EditHelper.fixPopoverPosition(e, n);
            }
          }
          getLocalRootUrl(e) {
            if (File.isTextBundle())
              return File.bundle.filePath
                ? c.getCurrentFilePath()
                : u.assetsParentForUntitled();
            var t = null,
              n = this.getMetaNode();
            if (n) {
              t = (/^\s*typora-root-url\s*:\s*(.*)$/im.exec(n.get("text")) ||
                [])[1];
            }
            if (
              (t ||
                e ||
                !this.editor.localSettingBridge ||
                (t =
                  this.editor.localSettingBridge.getSetting(
                    "typora-root-url"
                  ) || null),
              t)
            ) {
              var r = c.getCurrentFilePath();
              return r ? i.getAbsolutePath(r, t) : t;
            }
            return null;
          }
          buildMetaMap() {
            var e = this.getMetaNode(),
              t = /^\s*([^\s\[\{:]+)\s*:\s*(.*)$/,
              n = /^\s*#/,
              i = {};
            function r(e) {
              var t;
              if ((t = e.match(/^\s*\[(.*)\]\s*$/)))
                return t[1].split(/\s*,\s*/).map(r);
              if ((t = e.match(/^\s*\{(.*)\}\s*$/))) {
                var n = {};
                if (
                  (t[1].split(/\s*,\s*/).forEach((e) => {
                    var t = e.split(/\s*:\s*/);
                    2 == t.length && (n[t[0]] = t[1]);
                  }),
                  Object.keys(n).length)
                )
                  return n;
              }
              return /^"/.exec(e)
                ? e
                    .replace(/^"/, "")
                    .replace(/"$/, "")
                    .replace(/\n\n/g, "\n")
                    .replace(/\\\n/g, "")
                    .replace(/\n/g, " ")
                    .replace(/\\n/g, "\n")
                : /^'/.exec(e)
                ? e
                    .replace(/^'/, "")
                    .replace(/'$/, "")
                    .replace(/\n\n/g, "\n")
                    .replace(/''/g, "'")
                    .replace(/\n/g, " ")
                : e.trim();
            }
            function o(e, t, n) {
              for (var i = []; t < e.length; ) {
                let r = e[t];
                if (0 != r.indexOf(n) && r.trim().length) break;
                i.push(r.substr(n.length)), t++;
              }
              return [i, t];
            }
            if (e) {
              if (
                "string" ==
                typeof (i = (function e(i) {
                  for (var a, s, l = 0, c = {}, d = !1; l < i.length; l++) {
                    var u = i[l];
                    if (u.match(n));
                    else if (!d && (s = /^\s+/.exec(u))) {
                      var h = s[0],
                        p = "";
                      (s = /^\s*([\|\>])\s*$/.exec(c[a] || "")) && (p = s[1]),
                        (f = o(i, l, h))[1] - 1 > l && (l = f[1] - 1),
                        (c[(a = a || "")] =
                          "|" == p
                            ? f[0].join("\n")
                            : ">" == p
                            ? f[0]
                                .map((e) => (e.trim() ? e.trim() + " " : "\n"))
                                .join("")
                                .trim()
                            : e(f[0]));
                    } else if ((s = /^[-+]\s/.exec(u))) {
                      var f;
                      (d = !1),
                        (f = o(i, l + 1, (h = s[0].replace(/^[-+]/, " "))))[1] -
                          1 >
                          l && (l = f[1] - 1),
                        (c[(a = a || "")] = c[a] || []),
                        c[a].push &&
                          c[a].push(e([u.substr(h.length)].concat(f[0])));
                    } else
                      (s = t.exec(u))
                        ? ((d = !1),
                          (a = s[1]),
                          (c[a] = s[2].trim()),
                          (s = /^["']/.exec(c[a])) &&
                            c[a][c[a].length - 1] != s[0] &&
                            (d = s[0]))
                        : ((a = a || ""),
                          (u = u.trim()),
                          c[a] ? (c[a] += "\n" + u) : (c[a] = u),
                          u[u.length - 1] == d && (d = !1));
                  }
                  return 1 == Object.keys(c).length && void 0 !== c[""]
                    ? c[""]
                    : (Object.keys(c).map((e) => {
                        "string" == typeof c[e] && (c[e] = r(c[e]));
                      }),
                      c);
                })((e.get("text") || "").split(/\r|\n|\r\n/g)))
              )
                return {};
              if (i instanceof Array) return {};
              delete i[""];
            }
            return i;
          }
          getMetaNode() {
            var e = this.editor.nodeMap.getFirst();
            return o.isType(e, a.meta_block) ? e : null;
          }
          getValueInMeta(e, t) {
            if ((t = t || this.getMetaNode())) {
              var n = (new RegExp("^s*" + e + "s*:s*(.*)$", "mi").exec(
                t.get("text")
              ) || [])[1];
              return n ? n.trim() : n;
            }
            return null;
          }
          writeProperty(e, t) {
            this.editor.undo.endSnap(!0);
            var n = this.editor.docMenu.getMetaNode(),
              i = this.editor.selection.buildUndo() || {},
              r = d.makeEmptyCommand(i),
              o = e + ": " + t,
              a = n && i && (i.id || i.startId) == n.id,
              l = s.extend({}, i),
              c = 0;
            if (n) {
              r.undo.push(d.buildReplaceUndo(n));
              var u = n.get("text"),
                h = b(e, u);
              if (h) {
                l.start > h.index + h[0].length
                  ? (c = o.length - h[0].length)
                  : l.start > h.index && (c = l.start - h.index + o.length),
                  (l.end = l.start = l.start - c);
                var p = new RegExp("^s*" + e + "s*:s*(.*)$", "mi");
                n.set("text", u.replace(p, o));
              } else n.set("text", u ? u.replace(/\n?$/, "\n" + o) : o);
              r.redo.push(d.buildReplaceUndo(n)),
                this.editor.findElemById(n.cid).replaceWith(n.toHTML()),
                a && this.editor.undo.exeCommand(l);
            } else {
              var f = this.editor.stylize.insertMetaBlock(!0, o);
              if (!f) return;
              (n = f.node),
                d.append(r, f.command),
                this.editor.findElemById(n.get("after").cid).before(n.toHTML());
            }
            r.redo.push(l), this.editor.undo.register(r);
          }
          removeProperty(e, t) {
            this.editor.undo.endSnap(!0);
            var n = this.editor.docMenu.getMetaNode(),
              i = this.editor.selection.buildUndo(),
              r = d.makeEmptyCommand(i),
              o = !!i && (i.id || i.startId) == (n || {}).id,
              a = new RegExp("^s*" + e + "s*:s*(.*)$", "mi"),
              l = s.extend({}, i || void 0),
              c = 0;
            if (n) {
              if ((r.undo.push(d.buildReplaceUndo(n)), o)) {
                var u = b(e, n.get("text"));
                u &&
                  (l.start > u.index + u[0].length
                    ? (c = u[0].length)
                    : l.start > u.index && (c = l.start - u.index),
                  (l.end = l.start = l.start - c));
              }
              n.set("text", n.get("text").replace(a, "")),
                r.redo.push(d.buildReplaceUndo(n)),
                this.editor.findElemById(n.cid).replaceWith(n.toHTML()),
                r.redo.push(l),
                o && this.editor.undo.exeCommand(l),
                !t && this.editor.undo.register(r);
            }
            return r;
          }
        }
        function b(e, t) {
          return new RegExp("^s*" + e + "s*:s*(.*)$", "mig").exec(t);
        }
        (y.getTocInlineLexer = g), (n.exports = y);
      }
    ),
    $__System.registerDynamic(
      "42",
      ["11", "e", "1d", "26", "28", "13", "41"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r,
          o = e("11"),
          a = e("e"),
          s = e("1d"),
          l = (e("26").map, e("28")),
          c = e("13"),
          d = (c.Node, c.TYPE),
          u = e("41"),
          h = null,
          p = function (e) {
            var t = "",
              n = [];
            try {
              !(function (e) {
                for (var r = 0; r < e.length; r++)
                  if (!e[r].isDeleted()) {
                    (a = e[r]),
                      (t +=
                        "<li class='outline-item-wrapper outline-h" +
                        a.get("depth") +
                        "'><div class='outline-item'><span class='outline-expander'></span><span class='outline-label' data-ref='" +
                        a.cid +
                        "'>" +
                        i.output(a.get("text")) +
                        "</span></div><ul class='outline-children'>"),
                      n.push(a.get("depth"));
                    var o =
                      e[r + 1] && !e[r + 1].isDeleted()
                        ? e[r + 1].get("depth")
                        : 1;
                    if (o <= e[r].get("depth"))
                      for (; n.last() && n.last() >= o; )
                        (t += "</ul></li>"), n.pop();
                  }
                var a;
              })(e.headers);
            } catch (e) {
              window.debugMode && console.warn(e.stack), (t = "");
            }
            return t;
          };
        function f(e, t) {
          for (
            var n = e.find(".outline-item-wrapper"), i = 0;
            i < n.length;
            i++
          )
            n[i].querySelector(".outline-item-wrapper")
              ? t &&
                n[i].classList.contains("outline-h1") &&
                n[i].classList.add("outline-item-open")
              : (n[i].classList.add("outline-item-signle"),
                n[i].classList.add("outline-item-single"));
        }
        n.exports = class {
          constructor(e) {
            (this.editor = e.editor),
              (this.parent = e),
              (this.headerStr =
                "h1, h2, h3, h4, h5, h6, [mdlike='h1'], [mdlike='h2'], [mdlike='h3'], [mdlike='h4'], [mdlike='h5'], [mdlike='h6']"),
              (i = u.getTocInlineLexer()),
              this.bindEvents();
          }
          bindEventForSearch() {
            var e = this;
            a("#typora-sidebar")
              .on("click", "#close-outline-filter-btn", function () {
                e.hideSearch();
              })
              .on("input", "#file-library-search-input", function () {
                var t;
                e.parent.isOutlineShown() &&
                  ((t = this.value),
                  e.searchTimer && clearTimeout(e.searchTimer),
                  (e.searchTimer = setTimeout(function () {
                    e.search(t);
                  })));
              });
          }
          bindEventForToc() {
            var e = this.editor;
            a(document)
              .on("mousedown", ".md-toc-inner", function (t) {
                if (1 === t.which) {
                  var n = this.parentElement.getAttribute("data-ref"),
                    i = e.findElemById(n);
                  return (
                    e.store(),
                    e.selection.jumpIntoElemEnd(i),
                    e.selection.scrollAdjust(i, 10),
                    !1
                  );
                }
              })
              .on("mousedown", ".md-delete-toc", function (t) {
                1 === t.which &&
                  e.UserOp.deleteSelectable(e, a(this).closest(".md-toc"));
              })
              .on("click", "#md-notification .close-btn", function (e) {
                document.body.classList.remove("ty-show-notification");
              })
              .on("click", "#md-notification .ty-icon-close-btn", function (e) {
                document.body.classList.remove("ty-show-notification");
              });
          }
          toggleSearch() {
            this.isShown_ ? this.hideSearch() : this.showSearch();
          }
          expandAll() {
            a("#outline-content .outline-item-wrapper").addClass(
              "outline-item-open"
            );
          }
          collapseAll() {
            a("#outline-content .outline-item-wrapper").removeClass(
              "outline-item-open"
            );
          }
          useCollapsibleOutline() {
            JSBridge.putSetting("can_collapse_outline_panel", !0),
              File.setCanCollapsePinnedOutline(!0),
              a("#outline-content>.outline-item-wrapper").addClass(
                "outline-item-open"
              ),
              this.highlightVisibleHeader();
          }
          useFlatOutline() {
            JSBridge.putSetting("can_collapse_outline_panel", !1),
              File.setCanCollapsePinnedOutline(!1);
          }
          bindContext() {
            var e = this;
            a("#outline-menu").on("mousedown", "[data-key]", function (t) {
              var n = this.getAttribute("data-action");
              n &&
                1 == t.which &&
                (a(".context-menu")
                  .removeClass("show")
                  .find(".active")
                  .removeClass("active"),
                setTimeout(function () {
                  switch (n) {
                    case "highlight":
                      e.highlightVisibleHeader(void 0, void 0, !0, !0);
                      break;
                    case "filter":
                      e.toggleSearch();
                      break;
                    case "expand-all":
                      return e.expandAll(), !1;
                    case "collapse-all":
                      return e.collapseAll(), !1;
                    case "collapsible-outline":
                      e.useCollapsibleOutline();
                      break;
                    case "flat-outline":
                      return e.useFlatOutline(), !1;
                    default:
                      return;
                  }
                }, 0),
                e.editor.restoreLastCursor(null, !0));
            }),
              a("#outline-content").on("contextmenu", function (t) {
                e.editor.lastCursor = e.editor.selection.buildUndo();
                var n = !document.body.classList.contains(
                  "no-collapse-outline"
                );
                a("#write").blur(),
                  a(".context-menu")
                    .removeClass("show")
                    .find(".active")
                    .removeClass("active");
                var i = a("#outline-menu").addClass("show");
                n && !e.isShown_
                  ? (i
                      .find("[data-action='flat-outline'] a")
                      .removeClass("state-on"),
                    i
                      .find("[data-action='collapsible-outline'] a")
                      .addClass("state-on"),
                    i.find("[data-collapse]").show())
                  : (i
                      .find("[data-action='flat-outline'] a")
                      .addClass("state-on"),
                    i
                      .find("[data-action='collapsible-outline'] a")
                      .removeClass("state-on"),
                    i.find("[data-collapse]").hide()),
                  e.isShown_
                    ? (i.find("[data-action='filter'] a").addClass("state-on"),
                      i.find("[data-view]").hide())
                    : (i
                        .find("[data-action='filter'] a")
                        .removeClass("state-on"),
                      i.find("[data-view]").show());
                var r = i.height() + 48,
                  o =
                    t.clientX > window.innerWidth - 220
                      ? window.innerWidth - 220
                      : t.clientX,
                  s =
                    t.clientY > window.innerHeight - r
                      ? window.innerHeight - r
                      : t.clientY - a("#top-titlebar").height() + 8;
                return i.css({ top: s + "px", left: o + "px" }), !1;
              });
          }
          bindEventForOutline() {
            var e = this,
              t = this.editor;
            a(document)
              .on("click", ".outline-expander", function (e) {
                var t = this.nextElementSibling.getAttribute("data-ref");
                return (
                  a(".outline-label[data-ref='" + t + "']")
                    .parent()
                    .parent()
                    .toggleClass("outline-item-open"),
                  !1
                );
              })
              .on("click", ".outline-item", function (n) {
                var i =
                    this.querySelector(".outline-label").getAttribute(
                      "data-ref"
                    ),
                  r = t.findElemById(i);
                return (
                  e.autoHideOutline(),
                  t.focusAndRestorePos(),
                  t.selection.scrollAdjust(r, 10),
                  File.isFocusMode && t.updateFocusMode(!1),
                  this.parentElement.classList.add("outline-item-open"),
                  !1
                );
              })
              .on("post-wheel", "content", function (t) {
                document.querySelector(".dropmenu.open") &&
                  !File.editor.sourceView.inSourceMode &&
                  e.highlightVisibleHeaderWithDelay();
              })
              .on(
                "click",
                "#close-outline-btn, #close-sidebar-btn",
                function () {
                  return t.focusAndRestorePos(), e.hideOutline(), !1;
                }
              )
              .on("click", "#pin-outline-btn", function () {
                return (
                  t.focusAndRestorePos(), t.library.showSidebar("outline"), !1
                );
              })
              .on("click", "#unpin-outline-btn", function () {
                return (
                  t.focusAndRestorePos(),
                  t.library.hideSidebar(),
                  e.showOutline(),
                  !1
                );
              }),
              document.querySelector("#sidebar-content").addEventListener(
                "mousewheel",
                function () {
                  h && clearTimeout(h);
                },
                !!File.option.passiveEvents && { passive: !0 }
              );
          }
          bindEvents() {
            this.bindEventForToc(),
              this.bindEventForOutline(),
              this.bindEventForSearch(),
              File.isNodeHtml && this.bindContext();
          }
          showSearch() {
            if (this.parent.isOutlineShown()) {
              this.isShown_ = !0;
              var e = a("#typora-sidebar"),
                t = e.find("#file-library-search-input");
              e.hasClass("ty-show-outline-filter") ||
                (t.attr("placeholder", a.localize.getString("Filter", "Front")),
                File.isNodeHtml &&
                  (t.css("width", "calc(100% - 18px)"),
                  e.find("#close-outline-filter-btn").show()),
                e.addClass("ty-show-outline-filter"),
                r != t.val() && t.val(""),
                t.val() ? t.select() : t.focus());
            }
          }
          hideSearch() {
            this.isShown_ &&
              ((this.isShown_ = !1),
              this.searchTimer && clearTimeout(this.searchTimer),
              a("#typora-sidebar").removeClass("ty-show-outline-filter"),
              this.clearSearch());
          }
          isSearchShown() {
            return this.isShown_;
          }
          clearSearch(e) {
            this.searchTimer && clearTimeout(this.searchTimer),
              (this.searchTimer = null);
            var t = a("#typora-sidebar");
            e || t.removeClass("ty-on-outline-filter"),
              t.find(".ty-outline-hit").replaceWith(function () {
                return this.innerHTML;
              }),
              t.find(".outline-item.select").removeClass("select"),
              document
                .querySelectorAll("#outline-content .outline-label")
                .forEach(function (e) {
                  e.parentElement.classList.remove("ty-outline-miss");
                });
          }
          search(e) {
            if (((r = e), e.trim().length)) {
              this.clearSearch(!0);
              var t = document.querySelector("#outline-content"),
                n = new RegExp(o.escapeRegExp(e), "i");
              t.querySelectorAll(".outline-label").forEach(function (e) {
                var t;
                if ((t = n.exec(e.textContent))) {
                  if (
                    (e.parentElement.classList.remove("ty-outline-miss"),
                    t[0] && t[0].trim().length)
                  ) {
                    var i = s.createRange();
                    i.moveToBookmark({
                      containerNode: e,
                      start: t.index,
                      end: t.index + t[0].length,
                    }),
                      l.markRange(i, "ty-outline-hit");
                  }
                } else e.parentElement.classList.add("ty-outline-miss");
              }),
                a("#typora-sidebar").addClass("ty-on-outline-filter"),
                (this.searchTimer = null);
            } else this.clearSearch();
          }
          updateOutlineHtml(e, t) {
            if (t || document.body.classList.contains("pin-outline")) {
              var n = document.querySelector("#outline-content"),
                i = p(e),
                r = n.scrollTop,
                o = !document.body.classList.contains("no-collapse-outline"),
                s = [],
                l = 0 == n.innerHTML.trim().length;
              if (
                ((c = n.innerHTML),
                (d = i),
                (u = a(a.parseHTML("<div>" + c + "<div>")[0])),
                (h = a(a.parseHTML("<div>" + d + "<div>")[0])),
                u
                  .find(
                    ".outline-item-open, .outline-active, .outline-item-active"
                  )
                  .removeClass("outline-item-open")
                  .removeClass("outline-item-active")
                  .removeClass("outline-active"),
                u.html() == h.html())
              )
                return void (t && o && f(a(n)));
              o &&
                !l &&
                a(n)
                  .find(".outline-item-open>.outline-item>.outline-label")
                  .map(function () {
                    s.push(this.getAttribute("data-ref"));
                  }),
                (n.innerHTML = p(e)),
                (n.scrollTop = r),
                o &&
                  (f(a(n)),
                  a(n.querySelector(".outline-active"))
                    .parents(".outline-item-wrapper:not(.outline-item-single)")
                    .addClass("outline-item-open"),
                  l
                    ? 1 == n.children.length &&
                      n.children[0].classList.add("outline-item-open")
                    : s.forEach(function (e) {
                        var t = n.querySelector("[data-ref='" + e + "']");
                        t &&
                          ((t =
                            t.parentElement.parentElement).classList.contains(
                            "outline-item-single"
                          ) ||
                            t.classList.add("outline-item-open"));
                      })),
                this.highlightVisibleHeader();
            }
            var c, d, u, h;
          }
          highlightVisibleHeader(e, t, n, i) {
            if (document.querySelector("#typora-sidebar.open")) {
              var r,
                o = this,
                s = this.editor,
                l = e || a(s.writingArea).children(this.headerStr),
                c = 0,
                d = l.length - 1,
                u = void 0 === t ? null : t;
              if (l.length) {
                for (
                  c = 1 === b(l[l.length - 1]) ? 0 : l.length - 1;
                  d - c > 1 && null == u;

                ) {
                  var p = Math.floor((c + d) / 2),
                    f = b(l[p]);
                  1 == f ? (d = p) : -1 == f ? (c = p) : (u = w(p));
                }
                if ((null == u && (u = c), u < l.length)) {
                  a(".outline-item-active").removeClass("outline-item-active"),
                    (r = a("#outline-content .outline-label")
                      .removeClass("outline-active")
                      .filter("[data-ref='" + l[u].getAttribute("cid") + "']")
                      .addClass("outline-active")
                      .parent()
                      .addClass("outline-item-active"));
                  var m = !document.body.classList.contains(
                    "no-collapse-outline"
                  );
                  if (
                    (i &&
                      (r.addClass("blink-area"),
                      setTimeout(function () {
                        r.removeClass("blink-area");
                      }, 2e3)),
                    m)
                  )
                    if (n)
                      for (var g = r; g.length; )
                        g.addClass("outline-item-open"),
                          (g = g.parent().closest(".outline-item-wrapper"));
                    else {
                      var v = r.closest(".outline-item-open>.outline-children"),
                        y = r[0];
                      v.length || (v = a("#outline-content")),
                        v.length &&
                          (r = v
                            .children()
                            .filter(function () {
                              return this == y || this.contains(y);
                            })
                            .find(".outline-label")
                            .first()
                            .addClass("outline-active")
                            .parent()
                            .addClass("outline-item-active"));
                    }
                  !(function (e) {
                    if (
                      (!o.editor.library ||
                        o.editor.library.isOutlineShown()) &&
                      e.length
                    ) {
                      var t,
                        n,
                        i = a("#outline-content:visible")[0];
                      i &&
                        (File.isNodeHtml || (i = i.parentElement),
                        (t = e.offset().top - a(i).offset().top) < 0
                          ? (n = t - 200 + i.scrollTop)
                          : t > i.offsetHeight - 20 &&
                            (n = t + 200 - i.offsetHeight + i.scrollTop),
                        void 0 !== n && (i.scrollTop = n));
                    }
                  })(r);
                }
              }
              h = null;
            }
            function b(e) {
              var t = a("content").scrollTop(),
                n = e.offsetTop;
              return n < t ? -1 : n > t + window.innerHeight ? 1 : 0;
            }
            function w(e) {
              for (e--; l[e] && 0 == b(l[e]); ) e--;
              return e + 1;
            }
          }
          highlightVisibleHeaderWithDelay(e) {
            h && clearTimeout(h),
              (h = setTimeout(
                () => {
                  this.highlightVisibleHeader(e);
                },
                File.inBusyMode ? 200 : 100
              ));
          }
          renderOutline() {
            var e = p(this.editor.nodeMap.toc),
              t = a(".outline-content");
            if (
              (t.html(e),
              f(t, !0),
              this.editor.mathInline && this.editor.mathInline.renderInToc(),
              this.expandedOutlineItem)
            )
              this.expandedOutlineItem.forEach(function (e) {
                try {
                  t.find("[data-ref='" + e + "']")
                    .parent()
                    .parent()
                    .addClass("outline-item-open");
                } catch (e) {}
              }),
                (this.expandedOutlineItem = null);
            else {
              var n = t.children();
              n.length < 20 && n.addClass(".outline-item-open");
            }
          }
          moveUpOrDown(e) {
            var t,
              n = !document.body.classList.contains("no-collapse-outline"),
              i = document.querySelector("#outline-content"),
              r = i.querySelectorAll(".outline-item:not(.ty-outline-miss)"),
              o = i.querySelector(".select");
            if (!o && (o = i.querySelector(".outline-active"))) {
              if (!(o = o.parentElement).classList.contains("ty-outline-miss"))
                return void o.classList.add("select");
              o = null;
            }
            o
              ? (t = (function t(i, o) {
                  var a = Array.prototype.indexOf.call(r, i),
                    s = r[e ? a - 1 : a + 1] || null;
                  if (!s || o || !n) return s;
                  var l = s.parentElement.parentElement.parentElement;
                  return l.classList.contains("outline-item-open") ||
                    !l.classList.contains("outline-item-wrapper")
                    ? s
                    : t(s, o);
                })(
                  o,
                  document.querySelector("#typora-sidebar.ty-on-outline-filter")
                )) && (o.classList.remove("select"), t.classList.add("select"))
              : (o = r[0]) && o.classList.add("select");
          }
          onEnterKey(e) {
            var t = e.target.value.trim(),
              n = document.querySelector(".outline-item.select");
            n && r == t
              ? (a(n).children(".outline-label").trigger("click"),
                n.parentElement.classList.contains("outline-item-open") ||
                  a(n).children(".outline-expander").trigger("click"),
                setTimeout(function () {
                  e.target.focus();
                }, 0))
              : this.search(t);
          }
          showOutline() {
            this.editor.library.isSidebarShown()
              ? a("#toc-content")
                  .html(a("#outline-content").html())
                  .find(".outline-active, .outline-item-active")
                  .removeClass("outline-active")
                  .removeClass("outline-item-active")
              : this.renderOutline(),
              a(".dropdown-menu.open, .dropdown-menu.show")
                .removeClass("open")
                .removeClass("show"),
              document.querySelector("#toc-dropmenu").classList.add("open");
          }
          storeOutline() {
            this.expandedOutlineItem = [];
            for (
              var e = document.querySelectorAll(
                  ".outline-item-open:not(.outline-h1)>.outline-item>.outline-label"
                ),
                t = 0;
              t < e.length;
              t++
            )
              this.expandedOutlineItem.push(e[t].getAttribute("data-ref"));
            return this.expandedOutlineItem;
          }
          hideOutline(e) {
            this.storeOutline(),
              document.querySelector("#toc-dropmenu").classList.remove("open");
          }
          autoHideOutline() {
            document
              .querySelector("#toc-dropmenu")
              .classList.contains("open") && this.hideOutline();
          }
          toggleOutline() {
            document.querySelector("#toc-dropmenu.open")
              ? this.hideOutline()
              : this.showOutline();
          }
          getHeaderMatrix(e) {
            var t = [];
            return (
              this.editor.nodeMap.toc.headers.map(function (n) {
                var r =
                    n.get("type") == d.heading
                      ? n.get("text")
                      : n.getText().replace(/(^#+)|(#+$)/g, ""),
                  o = i.output(r);
                e && (o = a.parseHTML("<div>" + o + "<div>")[0].textContent),
                  t.push([n.get("depth") - 0, o, n.cid]);
              }),
              t
            );
          }
        };
      }
    ),
    $__System.registerDynamic(
      "43",
      ["11", "e", "32", "26"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r = e("11"),
          o = e("e"),
          a = e("32"),
          s = e("26").map,
          l = 30;
        n.exports = class {
          constructor(e) {
            (this.editor = e.editor),
              (this.parent = e),
              (this.templateDom = o.parseHTML(
                document
                  .querySelector("#file-search-item-template")
                  .innerHTML.trim()
              )[0]),
              (this.caseSensitive = File.option.fileSearchCaseSensitive),
              (this.wholeWord = File.option.fileSearchWholeWord),
              (this.useRegexp = File.option.fileSearchUseRegexp),
              this.bindEvents(),
              File.isMac && this.registerBridge();
          }
          bindEvents() {
            var e = this;
            if ((File.isWin, File.isNode)) {
              var t,
                n,
                r,
                l,
                c = null;
              [
                document.querySelector("#file-library"),
                document.querySelector("#outline-content"),
              ].forEach(function (i, o) {
                var a = 1 == o;
                i.addEventListener("wheel", function (o) {
                  var s = 0 === o.deltaY;
                  if (o.deltaX > 16 || o.deltaX < -16)
                    return (
                      n && clearTimeout(n),
                      void (n = setTimeout(function () {
                        n = null;
                      }, 50))
                    );
                  if (t) !s && o.preventDefault();
                  else {
                    var d = l !== (o.deltaY < 0 ? -1 : 1);
                    (l = o.deltaY < 0 ? -1 : 1),
                      d && (clearTimeout(r), (r = null));
                  }
                  if (
                    (r ? clearTimeout(r) : 0 == o.deltaX && (c = i.scrollTop),
                    (r = setTimeout(function () {
                      (c = null), (r = null);
                    }, 40)),
                    t || -1 == c)
                  )
                    !s && o.preventDefault();
                  else if (0 === c && !n) {
                    var u = a ? e.parent.outline.isSearchShown() : e.isShown_;
                    return o.deltaY < 0 && i.scrollTop < 2 && !u
                      ? ((t = setTimeout(function () {
                          t = null;
                        }, 50)),
                        clearTimeout(r),
                        (r = setTimeout(function () {
                          c = null;
                        }, 50)),
                        e.showSearch(a),
                        o.preventDefault(),
                        void (c = -1))
                      : u && o.deltaY > 0
                      ? (e.hideSearch(a),
                        (t = setTimeout(function () {
                          t = null;
                        }, 50)),
                        clearTimeout(r),
                        (r = setTimeout(function () {
                          c = null;
                        }, 50)),
                        o.preventDefault(),
                        void (c = -1))
                      : void 0;
                  }
                });
              }),
                o("#info-panel-tab-search-back").on("click", function () {
                  e.hide();
                });
            } else
              o(".sidebar-osx-tab")
                .on("click", "#sidebar-search-btn", function () {
                  e.showSearch(e.parent.isOutlineShown());
                })
                .on("click", "#ty-sidebar-search-back-btn", function () {
                  e.hideSearch(e.parent.isOutlineShown());
                });
            function d(e, t) {
              t.scrollTop > e.offsetTop
                ? (t.scrollTop = Math.max(e.offsetTop - 2, 0))
                : t.scrollTop + t.offsetHeight < e.offsetTop + e.offsetHeight &&
                  (t.scrollTop = e.offsetTop);
            }
            var u = document.querySelector("#file-library-search-input");
            u.addEventListener("keydown", function (t) {
              var n,
                r,
                a,
                l,
                c,
                h,
                p = s[t.keyCode || t.which];
              "Esc" == p
                ? ((e.onKeyDown = !0),
                  setTimeout(function () {
                    e.onKeyDown = !1;
                  }, 300),
                  e.hideSearch(e.parent.isOutlineShown()),
                  t.stopPropagation())
                : "Enter" == p
                ? e.isShown_
                  ? ((c = document
                      .querySelector("#file-library-search-result")
                      .querySelector(".select")),
                    (h = u.value.trim()),
                    c && i == h
                      ? (c.classList.contains("ty-search-item") &&
                          (c = c.querySelector(".ty-search-item-summary")),
                        o(c).trigger("click").removeClass("select"))
                      : e.search(h))
                  : e.parent.isOutlineShown() && e.parent.outline.onEnterKey(t)
                : "Up" == p || "Down" == p
                ? e.isShown_
                  ? ((n = "Up" == p),
                    (a = document.querySelector("#file-library-search-result")),
                    (l =
                      a.querySelector(".select") || a.querySelector(".active"))
                      ? (r = n
                          ? l.previousElementSibling
                          : l.nextElementSibling) &&
                        (r.classList.contains("ty-search-item-line-more") &&
                          (r.parentElement.parentElement.classList.contains(
                            "ty-search-item-expand"
                          ) ||
                            (r = null)),
                        r)
                        ? (l.classList.remove("select"),
                          r.classList.add("select"),
                          d(r, a))
                        : l.classList.contains("ty-search-item-line") &&
                          ((l = l.parentElement.parentElement),
                          (r = n
                            ? l.previousElementSibling
                            : l.nextElementSibling) &&
                            (r = n
                              ? r.classList.contains("ty-search-item-line-more")
                                ? r.querySelector(
                                    ".ty-search-item-line:last-child"
                                  )
                                : r.querySelector(
                                    ".ty-search-item-line-expand"
                                  ) ||
                                  r.querySelector(
                                    ".ty-search-item-line:last-child"
                                  )
                              : r.querySelector(
                                  ".ty-search-item-line:first-child"
                                )),
                          r) &&
                          (l.classList.remove("select"),
                          r.classList.add("select"),
                          d(r, a))
                      : ((l = a.querySelector(".ty-search-item")) &&
                          l.classList.add("select"),
                        l && d(l, a)))
                  : e.parent.isOutlineShown() &&
                    e.parent.outline.moveUpOrDown("Up" == p)
                : "Tab" == p && e.editor.searchPanel.closePanel();
            }),
              u.addEventListener("focus", function (e) {
                var t = document.querySelector(
                  "#file-library-search-result .select"
                );
                t && t.classList.remove("select");
              });
            var h = document.querySelector("#filesearch-case-option-btn");
            h.addEventListener("mousedown", function (t) {
              h.classList.toggle("select"),
                (e.caseSensitive = !e.caseSensitive),
                JSBridge.putSetting("fileSearchCaseSensitive", e.caseSensitive),
                t.preventDefault(),
                t.stopPropagation();
            }),
              e.caseSensitive && h.classList.add("select");
            var p = document.querySelector("#filesearch-word-option-btn");
            p.addEventListener("mousedown", function (t) {
              p.classList.toggle("select"),
                (e.wholeWord = !e.wholeWord),
                JSBridge.putSetting("fileSearchWholeWord", e.wholeWord),
                t.preventDefault(),
                t.stopPropagation();
            }),
              e.wholeWord && p.classList.add("select");
            var f = document.querySelector("#filesearch-regexp-option-btn");
            f.addEventListener("mousedown", function (t) {
              f.classList.toggle("select"),
                (e.useRegexp = !e.useRegexp),
                JSBridge.putSetting("fileSearchUseRegexp", e.useRegexp),
                t.preventDefault(),
                t.stopPropagation();
            }),
              e.useRegexp && f.classList.add("select"),
              o("#file-library-search")
                .on("click", ".ty-search-item-line-expand", function (e) {
                  o(this)
                    .closest(".ty-search-item")
                    .addClass("ty-search-item-expand"),
                    e.stopPropagation();
                })
                .on("click", ".ty-search-item-collapse-icon", function (e) {
                  var t = o(this).closest(".ty-search-item");
                  t.hasClass("ty-search-item-collapse")
                    ? (t.removeClass("ty-search-item-collapse"),
                      t.addClass("ty-search-item-expand"))
                    : (t.addClass("ty-search-item-collapse"),
                      t.removeClass("ty-search-item-expand")),
                    e.stopPropagation();
                })
                .on("click", ".ty-search-item-summary", function (t) {
                  o("#file-library-search-result")
                    .find(".active, .select")
                    .removeClass("active select");
                  var n = o(this)
                    .closest("[data-path]")
                    .addClass("active")
                    .attr("data-path");
                  (File.isMacOrMacNode ? t.metaKey : t.ctrlKey)
                    ? e.parent.openWithCtrl(n)
                    : e.parent.openFile(n);
                })
                .on("click", ".ty-search-item-line", function (t) {
                  var n = this.dataset.line,
                    i = this.dataset.match,
                    r = this.dataset.lineText,
                    s = o(this).closest("[data-path]").attr("data-path"),
                    l = this;
                  t.stopPropagation(),
                    t.preventDefault(),
                    void 0 != n &&
                      (i
                        ? (File.isMacOrMacNode ? t.metaKey : t.ctrlKey)
                          ? e.parent.openWithCtrl(s)
                          : s == a.getCurrentFilePath()
                          ? (e.goto(n - 0, i, r),
                            o("#file-library-search-result")
                              .find(".active, .select")
                              .removeClass("active select"),
                            l.classList.add("active"))
                          : ((window._hasSwitchCallback = !0),
                            e.parent.openFile(s, function () {
                              e.goto(n - 0, i, r),
                                o("#file-library-search-result")
                                  .find(".active, .select")
                                  .removeClass("active select"),
                                l.classList.add("active");
                            }))
                        : (File.isMacOrMacNode ? t.metaKey : t.ctrlKey)
                        ? e.parent.openWithCtrl(s)
                        : ((window._hasSwitchCallback = !0),
                          s != a.getCurrentFilePath() &&
                            e.parent.openFile(s, function () {
                              o("#file-library-search-result")
                                .find(".active, .select")
                                .removeClass("active select"),
                                l.classList.add("active");
                            })));
                });
          }
          registerBridge() {
            var e = this;
            bridge.registerHandler("globalSearch.onSearchUpdate", function (t) {
              t.emptyFilePathMatch
                ? t.text &&
                  t.text.split(/\r?\n/g).map(function (t) {
                    e.onSearchUpdate(t, !0, { path: t, matches: [] });
                  })
                : e.onSearchUpdate(t.text, t.pathMatch);
            }),
              bridge.registerHandler("globalSearch.onErrorMsg", function (t) {
                e.onErrorMsg(t);
              });
          }
          toggleSearch() {
            this.isActive() ? this.hide() : this.show();
          }
          showSearch(e) {
            e ? this.parent.outline.showSearch() : this.show();
          }
          hideSearch(e) {
            e ? this.parent.outline.hideSearch() : this.hide();
          }
          markOpenedFile(e) {
            if (document.querySelector(".ty-on-search")) {
              var t = File.getMountFolder();
              t &&
                0 === e.indexOf(t) &&
                (document.querySelector(".ty-search-item-line.active") ||
                  o(
                    ".ty-search-item[data-path='" + r.escapeSelector(e) + "']"
                  ).addClass("active"));
            }
          }
          isActive() {
            return (
              this.isShown_ && o("#typora-sidebar").hasClass("ty-on-search")
            );
          }
          show(e) {
            this.parent.isFileTabShown() || this.parent.showSidebar("files"),
              (this.isShown_ = !0);
            var t = o("#typora-sidebar"),
              n = t.find("#file-library-search-input");
            if (
              (e &&
                i &&
                t.find(".ty-search-item").length &&
                (t.addClass("ty-show-search ty-on-search"), n.val(i).focus()),
              setTimeout(function () {
                JSBridge.menu.update({
                  "View→Search": { state: t.hasClass("ty-on-search") },
                });
              }, 100),
              t.hasClass("ty-show-search"))
            )
              n.focus();
            else {
              n.attr("placeholder", o.localize.getString("Search", "Front")),
                File.isNodeHtml &&
                  (n.css("width", "100%"),
                  t.find("#close-outline-filter-btn").hide()),
                t.addClass("ty-show-search");
              var r = this.editor.selection.getRangy();
              (editor.lastCursor = editor.selection.buildUndo(r)),
                this.clearSearch(),
                r &&
                  r.toString().trim().length &&
                  n.val(r.toString().trim().replace(/\n.*$/, "")),
                n.focus(),
                i != n.val() && n.val(""),
                n.val() && n.select();
            }
          }
          clearSearch() {
            o("#file-library-search-result").html("");
          }
          clearContentHighlight() {
            this.isShown_ &&
              (o("#file-library-search-result")
                .find(".select")
                .removeClass("select"),
              o(".md-search-select").removeClass("md-search-select"),
              this.editor.searchPanel.clearSearch(),
              this.editor.searchPanel.resetSearchStatus(),
              o(".md-search-hit").removeClass("md-search-hit"));
          }
          hide() {
            (this.isShown_ = !1),
              0 != o("#typora-sidebar.ty-show-search").length &&
                (o("#typora-sidebar")
                  .removeClass("ty-show-search")
                  .removeClass("ty-on-search"),
                o("#info-panel-tab-file .info-panel-tab-border").addClass(
                  "ty-fadein-right"
                ),
                setTimeout(function () {
                  o("#info-panel-tab-file .info-panel-tab-border").removeClass(
                    "ty-fadein-right"
                  );
                }, 400),
                this.editor.searchPanel.closePanel());
          }
          onErrorMsg() {
            var e = document.querySelector("#file-library-search-result"),
              t = document.createElement("div");
            t.classList.add("ty-search-result-error-message"),
              (t.textContent = this.curError),
              e.appendChild(t);
          }
          onSearchUpdate(e, t, n) {
            var s = this,
              c = File.isWin ? "\\" : "/",
              d = document.querySelector("#file-library-search-result");
            d.querySelector(".ty-search-result-error-message") &&
              (d.innerHTML = "");
            var u = void 0,
              h = function () {
                if (void 0 == u) {
                  var e = s.caseSensitive ? "g" : "gi",
                    t = i;
                  if (s.useRegexp)
                    try {
                      s.wholeWord &&
                        (t = `\\b${t.replace(/^\\b|\\b$/g, "")}\\b`),
                        (u = new RegExp(t, e));
                    } catch (e) {
                      u = null;
                    }
                  else
                    (t = r.escapeRegExp(i.trim())),
                      s.wholeWord && (t = "\\b" + t + "\\b"),
                      (u = new RegExp(t, e));
                }
                return u && (u.lastIndex = 0), u;
              },
              p = t ? 1 : 0,
              f = File.getMountFolder(),
              m = {
                begin: function (e) {
                  File.isMac &&
                    f &&
                    0 == e.path.text.indexOf(f) &&
                    (e.path.text = e.path.text
                      .substring(f.length)
                      .replace(/^[\/]/, "")),
                    (this.curFile[p] = { path: e.path.text, matches: [] });
                },
                end: function (e) {
                  var n = this.curFile[p].path;
                  if (a.isSupportedFile(n)) {
                    if (t) {
                      u = h();
                      var i = n
                          .replace(/\\/g, "/")
                          .replace(/\/$/, "")
                          .lastIndexOf("/"),
                        r = n.substring(i + 1) || n;
                      if (!u.exec(r)) return void (this.curFile[p] = null);
                    }
                    (this.curFile[p].total = e.stats.matches),
                      v.call(this, this.curFile[p]),
                      (this.curFile[p] = null);
                  } else this.curFile[p] = null;
                },
                match: function (e) {
                  this.curFile[p].matches.push({
                    line: e.line_number,
                    text: e.lines.text,
                    submatches: e.submatches,
                  });
                },
              },
              g = function (e, t) {
                if (e.trim() && !s.useRegexp) {
                  var n = h().exec(e);
                  n
                    ? [
                        e.substring(0, n.index),
                        n[0],
                        e.substring(n.index + n[0].length),
                      ].forEach(function (e, n) {
                        var i =
                          1 == n
                            ? document.createElement("span")
                            : document.createTextNode(e);
                        1 == n &&
                          ((i.innerText = e),
                          i.classList.add("ty-file-search-match-text")),
                          t.appendChild(i);
                      })
                    : (t.innerText = e);
                } else t.innerText = e;
              },
              v = function (e) {
                if (e && e.path) {
                  var n = this.templateDom.cloneNode(!0);
                  n.dataset.path = File.getMountFolder() + c + e.path;
                  var i = (function (e) {
                    var t = e
                        .replace(/\\/g, "/")
                        .replace(/\/$/, "")
                        .lastIndexOf("/"),
                      n = e.substring(t + 1),
                      i = e.substring(0, t);
                    t = n.lastIndexOf(".");
                    var r = n.substring(t);
                    return [i, (n = n.substring(0, t)), r];
                  })(e.path);
                  g(i[1], n.querySelector(".file-list-item-file-name-part")),
                    g(i[2], n.querySelector(".file-list-item-file-ext-part"));
                  var o = i[0] ? (i[0] + c).replace(/[\\\/]/g, " / ") : "";
                  n.querySelector(".file-list-item-parent-loc").innerText = o;
                  var a = t ? 0 : e.total;
                  n.querySelector(".file-list-item-count").innerText =
                    a > 20 ? "20+" : a;
                  var u = 6;
                  s.matchedLines < l &&
                    a > u &&
                    n.classList.add("ty-search-item-expand");
                  var p = n.querySelector(".ty-search-item-matches");
                  t
                    ? (function () {
                        if ((s.matchedLines++, e.matches.length)) {
                          var t = document.createElement("div");
                          t.classList.add("ty-search-item-line");
                          var n = (e.matches[0] || [""]).text.replace(
                            /[\r\n]/g,
                            ""
                          );
                          (t.dataset.line = 0),
                            (t.dataset.lineText = n),
                            n && m(n, 0, n.length, t),
                            p.appendChild(t);
                        }
                      })()
                    : e.matches.forEach(function (t, n) {
                        if ((s.matchedLines++, !(n > 20))) {
                          var i = document.createElement("div");
                          i.classList.add("ty-search-item-line"),
                            n > u - 2 &&
                              (n == u - 1 &&
                                e.matches.length > u &&
                                p.appendChild(
                                  (function (e) {
                                    var t = document.createElement("div");
                                    return (
                                      t.classList.add("ty-search-item-line"),
                                      t.classList.add(
                                        "ty-search-item-line-expand"
                                      ),
                                      (t.innerText =
                                        "show " + e + " more matches"),
                                      t
                                    );
                                  })(e.matches.length - n)
                                ),
                              i.classList.add("ty-search-item-line-more")),
                            (t.text = t.text || "");
                          var r = t.text.replace(/[\r\n]/g, "");
                          (i.dataset.line = t.line - 1),
                            (i.dataset.lineText = r),
                            t.submatches.length &&
                              (i.dataset.match = t.submatches[0].match.text);
                          for (var o, a = 0, l = h(); (o = l.exec(r)); )
                            a < o.index && m(r, 0, o.index, i, "", 0 == n),
                              (a = o.index + o[0].length),
                              m(
                                r,
                                o.index,
                                a,
                                i,
                                "ty-file-search-match-text",
                                !0
                              );
                          a < r.length && m(r, a, r.length, i),
                            p.appendChild(i);
                        }
                      });
                  var f = d.querySelector(
                    "[data-path='" +
                      r.escapeSelector(File.getMountFolder() + c + e.path) +
                      "']"
                  );
                  t
                    ? f || d.appendChild(n)
                    : (f && f.remove(), d.appendChild(n));
                }
                function m(e, n, i, r, o, a) {
                  var s = document.createElement("span");
                  o && s.classList.add(o),
                    (e = e.substring(n, i).replace(/\r*\n/, "")),
                    a &&
                      0 == n &&
                      (e = e.replace(/^\s+/, "").replace(/\s+$/, " ")),
                    !t &&
                      !o &&
                      e.length > 20 &&
                      a &&
                      (e =
                        "..." +
                        ((e = e.substring(e.length - 20, e.length)).replace(
                          /^.+?\b/,
                          ""
                        ) || e)),
                    (s.innerText = e),
                    r.appendChild(s);
                }
              };
            if (n) {
              if (!a.isSupportedFile(e)) return;
              u = h();
              var y = e.replace(/\\/g, "/").replace(/\/$/, "").lastIndexOf("/"),
                b = e.substring(y + 1) || e;
              if (!u.exec(b)) return;
              v.call(this, n);
            } else {
              var w = ((t ? this.pathPrev : this.prev) + e).split(/\r?\n/g);
              t
                ? (this.pathPrev = w.splice(w.length - 1, 1)[0])
                : (this.prev = w.splice(w.length - 1, 1)[0]),
                w.forEach(function (e) {
                  if (e && !(e.length > 1e4))
                    try {
                      var t = JSON.parse(e);
                      m[t.type] && m[t.type].call(this, t.data);
                    } catch (e) {
                      console.warn(e);
                    }
                }, this),
                "" == e && this.endCount--,
                s.matchedLines > l &&
                  o(".ty-search-item.ty-search-item-expand").removeClass(
                    "ty-search-item-expand"
                  ),
                "" != e ||
                  d.childElementCount ||
                  this.endCount ||
                  ((this.curError =
                    this.curError ||
                    o.localize.getString("No result found.", "Front")),
                  this.onErrorMsg());
            }
          }
          goto(e, t, n) {
            this.editor.sourceView.gotoLine({
              line: e,
              ch: 0,
              lineText: n,
              textBefore: n.substring(0, n.indexOf(t)),
            }),
              this.editor.searchPanel.doSearch(t, {
                caseSensitive: this.caseSensitive,
                wholeWord: this.wholeWord,
                useRegexp: this.useRegexp,
                noSelect: !0,
                delay: 0,
              });
            var i = this,
              r = i.editor.getMarkElem(),
              a = r.closest("tr");
            a.length && (r = a),
              o(".md-search-select").removeClass("md-search-select");
            var s = o();
            setTimeout(function () {
              (s = r.find(".md-search-hit").first()).addClass(
                "md-search-select"
              ),
                r.addClass("md-focus");
            }, 10),
              setTimeout(function () {
                s.length && i.editor.selection.scrollAdjust(s, 60, void 0, !0);
              }, 200),
              document.querySelector("#file-library-search-input").focus();
          }
          search(e) {
            if (
              (o("#file-library-search-result .select").removeClass("select"),
              (i = e),
              e)
            ) {
              if (!File.getMountFolder()) return;
              this.clearContentHighlight(),
                this.parent.updateMenu("search"),
                (this.prev = ""),
                (this.curFile = []),
                (this.curError = ""),
                (this.pathPrev = ""),
                (this.endCount = this.useRegexp ? 1 : 2),
                (this.matchedLines = 0),
                File.isNode ? this.searchByNode(e) : this.searchByMac(e);
            } else
              o("#typora-sidebar")
                .removeClass("ty-on-search")
                .find("#file-library-search-result")
                .html("");
          }
          searchByMac(e) {
            e = r.normalize(e);
            var t = r.normalize(e, "NFD");
            bridge.callHandler(
              "library.search",
              {
                text: e,
                caseSensitive: this.caseSensitive || !1,
                wholeWord: this.wholeWord || !1,
                useRegexp: this.useRegexp || !1,
                args: this.buildRpArgs(e, t),
              },
              (e) => {
                e &&
                  o("#typora-sidebar")
                    .addClass("ty-on-search")
                    .find("#file-library-search-result")
                    .html("");
              }
            );
          }
          buildRpArgs(e, t) {
            var n = [
              "-F",
              "--json",
              "--no-multiline",
              "-n",
              "-m",
              "21",
              "--max-filesize",
              "2M",
              "-g",
              "!.*",
              "--no-messages",
              "--",
              e,
            ];
            return (
              this.useRegexp && n.shift(),
              this.caseSensitive || n.unshift("-i"),
              this.wholeWord && n.unshift("-w"),
              n
            );
          }
          searchByNode(e, t) {
            var n = this;
            n.rpTask1 && (n.rpTask1.kill(), (n.rpTask1 = null)),
              n.rpTask2 && (n.rpTask2.kill(), (n.rpTask2 = null)),
              n.rpTask3 && (n.rpTask3.kill(), (n.rpTask3 = null)),
              (e = r.normalize(e));
            var i,
              a = r.normalize(e, "NFD");
            function s(e) {
              var t = reqnode("child_process"),
                n = reqnode("vscode-ripgrep").rgPath.replace(
                  "node_modules.asar",
                  "node_modules"
                ),
                i = t.spawn(n, e, {
                  cwd: File.getMountFolder(),
                  stdio: ["ignore", "pipe", "pipe"],
                });
              return (
                i.stdout.setEncoding("utf8"), i.stderr.setEncoding("utf8"), i
              );
            }
            o("#typora-sidebar")
              .addClass("ty-on-search")
              .find("#file-library-search-result")
              .html(""),
              (function () {
                if (!n.useRegexp) {
                  var t = "*" + r.escapeRegExp(e) + "*",
                    i = s([
                      "-m",
                      "2",
                      "--max-filesize",
                      "2M",
                      ".*",
                      "-H",
                      "-U",
                      "--json",
                      "--no-messages",
                      n.caseSensitive ? "-g" : "--iglob",
                      t,
                    ]);
                  i.stdout.on("data", function (e) {
                    n.onSearchUpdate(e, !0);
                  }),
                    i.on("close", function () {
                      n.onSearchUpdate("", !0), (n.rpTask2 = null);
                    }),
                    (n.rpTask2 = i);
                }
              })(),
              (i = s(n.buildRpArgs(e, a))).stdout.on("data", function (e) {
                n.onSearchUpdate(e);
              }),
              i.on("close", function () {
                n.onSearchUpdate(""), (n.rpTask1 = null);
              }),
              i.stderr.on("data", function (e) {
                n.curError += e;
              }),
              (n.rpTask1 = i),
              (function () {
                if (!n.useRegexp) {
                  var t = "*" + r.escapeRegExp(e) + "*",
                    i = s([
                      "--max-filesize",
                      "0K",
                      "--files",
                      "--no-messages",
                      n.caseSensitive ? "-g" : "--iglob",
                      t,
                    ]);
                  i.stdout.on("data", function (e) {
                    e.split(/\r?\n/g).map(function (e) {
                      n.onSearchUpdate(e, !0, { path: e, matches: [] });
                    });
                  }),
                    i.on("close", function () {
                      n.rpTask3 = null;
                    }),
                    (n.rpTask3 = i);
                }
              })();
          }
        };
      }
    ),
    $__System.registerDynamic(
      "44",
      ["11", "13", "28", "32", "34", "33", "26", "3f", "40", "42", "43", "e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r,
          o,
          a,
          s = e("11"),
          l = e("13"),
          c = l.Node,
          d = (l.TYPE, e("28")),
          u = e("32"),
          h = e("34"),
          p = e("33"),
          f = e("26").map,
          m = e("3f"),
          g = e("40"),
          v = e("42"),
          y = e("43"),
          b = e("e"),
          w = 0;
        function x(e, t) {
          return void 0 === e ? t : e;
        }
        (window._lastFocusTimeMark = new Date() - 0),
          (window.onWindowFocusForNode = function (e, t) {
            if (window.File && File.editor && File.editor.imgEdit) {
              if ((!t && File.freshMenu(!0), File._onFileSwitching))
                return (
                  console.sendLog("File.activeWindow = true"),
                  void (File.activeWindow = !0)
                );
              var n = reqnode("fs-plus");
              r || !File.bundle.filePath || p.isFileSync(File.bundle.filePath)
                ? (File.getMountFolder() &&
                    (n.isDirectorySync(File.getMountFolder()) ||
                      File.editor.library.onRootChanged()),
                  !e && File.editor.selection
                    ? JSBridge.invoke(
                        "document.getSnapWithValidation",
                        File.bundle.lastSnapDate
                      ).then((e) => {
                        var { snap: t, shouldReadFromDisk: n } = JSON.parse(e);
                        C(t, n, !0);
                      })
                    : ((window._lastFocusTimeMark = new Date() - 0),
                      File.editor.imgEdit.refreshLocalImg()))
                : h.onPresentationMoved();
            }
          }),
          (window.onWindowFocusForMac = function () {
            File.editor &&
              File.editor.imgEdit &&
              (File.freshMenu(!0),
              File.editor.imgEdit.refreshLocalImg(),
              File.editor.library.markOpenedFile(u.getCurrentFilePath()),
              (window._lastFocusTimeMark = new Date() - 0),
              File.editor.tryEnterBusyModeWithDelay());
          });
        var C = function (e, t, n, i) {
          console.sendLog("onBecomeActive"),
            File.editor.brush.clearAndPause(),
            console.sendLog("File.activeWindow = true"),
            (File.activeWindow = !0);
          var r = n ? File.editor.lastCursor : null,
            o = File.restoreEditStateFromData(e, n, !1, t, i);
          if ((File.editor.brush.restart(), !n && File.isMac && e))
            File.editor.library._onSwitchDocumentTarget
              ? (a && clearTimeout(a),
                window.getSelection().removeAllRanges(),
                (a = setTimeout(File.recoverPosOrScroll, 400)))
              : File.recoverPosOrScroll();
          else if ((u.refreshTitlebarText(), o))
            Reporter.record({
              message: "Restore state from other window (no change)",
              category: "window.focus",
            });
          else if (r) {
            if (
              ((File.editor.lastCursor = r),
              File.editor.restoreLastCursor(),
              !File.editor.sourceView.inSourceMode)
            ) {
              var s = window.getSelection();
              (r && "None" != s.type) || s.removeAllRanges();
            }
          } else window.getSelection().removeAllRanges();
        };
        (window.onWindowBlur = function () {
          try {
            if (!window.File || !File.editor || !File.editor.sourceView) return;
            File.isMac &&
              ((window.File.isLocked = !0), File.backupDocumentSnap());
          } catch (e) {
            console.sendError(e);
          } finally {
            return "DONE";
          }
        }),
          window.reqnode &&
            (window.addEventListener("blur", function () {
              window.File &&
                File.editor &&
                File.editor.sourceView &&
                !window._onBackup &&
                File.isActiveWindow() &&
                File.backupDocumentSnap();
            }),
            (window.onWindowResignForNode = async () =>
              !!window.File &&
              (console.sendLog("window.onWindowResignForNode"),
              await File.backupDocumentSnap(),
              (File.activeWindow = !1),
              console.sendLog("File.activeWindow = false"),
              !0)));
        var F,
          S = function (e, t) {
            File.isBroken ||
              ((e = e || "").toLowerCase() !=
                (File.bundle.filePath || "").toLowerCase() &&
                ((File._onFileSwitching = !0),
                u.tryLeaveDocument(async function (n) {
                  if (n)
                    return (
                      (File._onFileSwitching = !1),
                      void File.editor.library.resumeOnChange()
                    );
                  await File.editor.library.doSwitchByNode(e), t && t();
                }, !0)));
          },
          k = [],
          E = {
            CreateDateDescend: -3,
            DateDescend: -2,
            AlphabetDescend: -1,
            NaturalDescend: -3,
            Natural: 0,
            Alphabet: 1,
            Date: 2,
            CreateDate: 3,
          };
        n.exports = class {
          constructor(e) {
            (this.editor = e),
              this.root,
              this.items,
              this.fsWatcher,
              this.watchedFolder,
              (this.unixWatchers = {}),
              (this.fileTree = new m(this)),
              (this.fileList = new g(this)),
              (this.fileSearch = new y(this)),
              (this.outline = new v(this)),
              (this.useTreeStyle = File.option.useTreeStyle),
              this.supportResize_,
              (this.onInit_ = !0),
              (this.cursorBackups = {}),
              (this.SortType = E),
              this.bindLiveResize(),
              this.registerBridge(),
              (this.defaultTab =
                File.option.sidebarTab ||
                (File.isMac ? "file-list" : "outline")),
              !File.option.initFilePath &&
                File.mountFolder_ &&
                (this.defaultTab = "files"),
              "outline" == this.defaultTab
                ? document
                    .querySelector("#typora-sidebar")
                    .classList.add("active-tab-outline")
                : document
                    .querySelector("#typora-sidebar")
                    .classList.add("active-tab-files"),
              File.isNode &&
                b("#reveal-folder-from-sidebar-menu").text(
                  b.localize.getString("Reveal in File Explorer")
                ),
              File.option.pinFolder &&
                (this.setMountFolder(
                  File.option.pinFolder,
                  !!File.option.showSidebar,
                  "pinFolder"
                ),
                (File.option.pinFolder = void 0)),
              (this.draggingItem = null),
              (this.filesInDragging = []),
              File.option.showSidebar &&
                ((File.option.sidebarTab = "files"),
                setTimeout(() => {
                  (File.option.sidebarTab = "files"), this.showSidebar("files");
                }, 100)),
              setTimeout(() => {
                document.body.classList.remove("no-animation");
              }, 1e3);
          }
          async doSwitchByNode(e) {
            (File.draftsRecoverList = []),
              this.isDiscardableUntitled() ||
                (await File.buildDocumentSnapForNode(!0)),
              e
                ? await File.loadFile(e, !0)
                : await JSBridge.invoke(
                    "document.switchToUntitled",
                    void 0,
                    !0
                  ),
              window.uploadImageQueue.clear(),
              window.moveImageQueue.clear(),
              (File._onFileSwitching = !1);
          }
          registerBridge() {
            if (File.isMac) {
              var e = this;
              bridge.registerHandler("library.onRootChanged", function (t, n) {
                e.onRootChanged(t), n && n();
              }),
                bridge.registerHandler(
                  "library.scheduleChangeHighlight",
                  function (t, n) {
                    e.scheduleChangeHighlight(t), n && n();
                  }
                ),
                bridge.registerHandler(
                  "library.onFileChanges",
                  function (t, n) {
                    e.onFileChanges(t), n && n();
                  }
                ),
                bridge.registerHandler(
                  "library.onLoadFolderFailed",
                  function (t, n) {
                    e.onLoadFolderFailed(t), n && n();
                  }
                ),
                bridge.registerHandler(
                  "library.setFilesInDragging",
                  function (t, n) {
                    (e.filesInDragging = t[0]),
                      (e.draggingItem = t[1] ? t[0][0] : null),
                      n && n();
                  }
                ),
                bridge.registerHandler("library.refreshOnRefocus", function () {
                  e.isFileTabShown() &&
                    e.useTreeStyle &&
                    e.refreshPanelCommand();
                }),
                bridge.registerHandler("library.getActiveTab", function (t, n) {
                  n(e.getActiveTab());
                }),
                bridge.registerHandler(
                  "window.onBecomeActive",
                  function (e, t) {
                    e[1] && File.setDocumentState(e[1]),
                      C(e[0], (e[0] || {}).isOutDated, e[2], e[3]),
                      t && t();
                  }
                );
            }
          }
          supportResize() {
            return void 0 === this.supportResize_
              ? ((this.supportResize_ = !(
                  !window.CSS ||
                  !window.CSS.supports ||
                  (!window.CSS.supports("--sidebar-width", 0) &&
                    !window.CSS.supports("(--foo: red)"))
                )),
                this.supportResize_)
              : this.supportResize_;
          }
          bindLiveResize() {
            var e = b("#typora-sidebar-resizer"),
              t = this,
              n = File.option.sidebarWidth;
            if ((n && this.setSidebarWidth(n - 0, !1), this.supportResize())) {
              var i,
                r,
                o,
                a = !1;
              e
                .on("mousedown", function (e) {
                  1 === e.which && (i = !0);
                })
                .on("mousemove", function (t) {
                  if (1 === t.which && i)
                    if (
                      (a ||
                        ((a = !0),
                        e.addClass("dragging"),
                        (r = window.innerWidth - 220)),
                      t.pageX < 100)
                    )
                      e.children().css("left", 0), (o = !0);
                    else {
                      o = !1;
                      var n = Math.min(Math.max(160, t.pageX), r);
                      e.children().css("left", n);
                    }
                })
                .on("mouseup", function (n) {
                  if (a)
                    if (
                      ((i = !1),
                      (a = !1),
                      e.removeClass("dragging"),
                      e.children().css("left", ""),
                      n.pageX < 100)
                    )
                      t.hideSidebar();
                    else {
                      var o = Math.min(Math.max(160, n.pageX), r);
                      t.setSidebarWidth(o, !0);
                    }
                }),
                b(window).on("mouseup", function () {
                  a &&
                    ((i = !1),
                    (a = !1),
                    e.removeClass("dragging"),
                    e.children().css("left", ""),
                    o && t.hideSidebar());
                });
            } else e.remove();
          }
          listenCurrentTransition() {
            if (!File.isNode)
              return void window.dispatchEvent(new Event("resize"));
            var e = document.querySelector("#typora-sidebar");
            const t = function () {
                window.dispatchEvent(new Event("resize"));
              },
              n = function () {
                window.dispatchEvent(new Event("optimizedResize")),
                  e.removeEventListener("transitionstart", t),
                  e.removeEventListener("transitionend", n);
              };
            e.addEventListener("transitionstart", t),
              e.addEventListener("transitionend", n);
          }
          setSidebarWidth(e, t) {
            File.isNode && window.dispatchEvent(new Event("beforeResize")),
              e && (e = Math.max(e, 160));
            var n = e ? e + "px" : "";
            document.documentElement.style.setProperty("--sidebar-width", n),
              File.isMac &&
                ("true" !=
                  (
                    window
                      .getComputedStyle(document.body)
                      .getPropertyValue("--typora-center-window-title") || ""
                  ).trim() && document.body.classList.contains("pin-outline")
                  ? bridge.callHandler("window.setTitlebarTextMarginLeft", e)
                  : bridge.callHandler(
                      "window.setTitlebarTextMarginLeft",
                      null
                    )),
              t &&
                setTimeout(function () {
                  JSBridge.putSetting("sidebar-width", e);
                }, 10),
              this.listenCurrentTransition();
          }
          isSuppressOnChange() {
            return i;
          }
          markFocusOnDialogClose() {
            (r = !0),
              setTimeout(function () {
                r = !1;
              }, 200);
          }
          pauseOnChange(e, t) {
            (i = !t || this.findElemFromPath(t).length) &&
              e &&
              setTimeout(
                function () {
                  i = !1;
                },
                File.isMac ? 800 : 200
              );
          }
          resumeOnChange() {
            i = !1;
          }
          isFileTabShown() {
            return !!document.querySelector(".pin-outline .active-tab-files");
          }
          isSidebarShown() {
            return (
              document.body && document.body.classList.contains("pin-outline")
            );
          }
          isOutlineShown() {
            return b(".pin-outline .active-tab-outline").length > 0;
          }
          getActiveTab() {
            return this.isSidebarShown()
              ? this.isFileTabShown()
                ? this.useTreeStyle
                  ? "file-tree"
                  : "file-list"
                : "outline"
              : "";
          }
          togglePanel(e) {
            this.getActiveTab() != e || this.fileSearch.isActive()
              ? this.showSidebar(e)
              : this.toggleSidebar();
          }
          toggleSidebar() {
            this.isSidebarShown() ? this.hideSidebar() : this.showSidebar();
          }
          tmpHideSidebar(e) {
            (this.savedSidebarStatus = this.isSidebarShown()),
              this.outline.autoHideOutline(),
              this.hideSidebar(!e);
          }
          recoverSidebar() {
            this.savedSidebarStatus && this.showSidebar(),
              (this.savedSidebarStatus = void 0);
          }
          updateMenu(e) {
            var t = {};
            (t["View→Outline"] = { state: "outline" == e }),
              (t["View→Articles"] = { state: "file-list" == e }),
              (t["View→File Tree"] = { state: "file-tree" == e }),
              (t["View→Search"] = { state: "search" == e }),
              JSBridge.menu.update(t);
          }
          hideSidebar(e) {
            File.isNode && window.dispatchEvent(new Event("beforeResize")),
              this.outline.storeOutline(),
              document
                .querySelector("#typora-sidebar")
                .classList.remove("open"),
              document.body.classList.remove("pin-outline"),
              !e && JSBridge.putSetting("sidebar_tab", ""),
              this.listenCurrentTransition(),
              File.isMac
                ? (bridge.callHandler("window.setTitlebarTextMarginLeft", null),
                  this.updateMenu(""))
                : window.ClientCommand.refreshViewMenu();
          }
          showSidebar(e, t) {
            this.fileSearch.isActive() && this.fileSearch.hide(),
              this.outline.autoHideOutline(),
              this.isSidebarShown() ? e && !t && this.switch(e) : this.show(e);
          }
          show(e) {
            File.isNode && window.dispatchEvent(new Event("beforeResize")),
              document.querySelector("#typora-sidebar").classList.add("open"),
              document.body.classList.add("pin-outline"),
              this.switch(e || this.getActiveTab() || this.defaultTab),
              this.outline.renderOutline(),
              this.listenCurrentTransition(),
              File.isMac &&
                "true" !=
                  (
                    window
                      .getComputedStyle(document.body)
                      .getPropertyValue("--typora-center-window-title") || ""
                  ).trim() &&
                bridge.callHandler(
                  "window.setTitlebarTextMarginLeft",
                  document
                    .querySelector("#typora-sidebar")
                    .getBoundingClientRect().width
                );
          }
          updateOption() {
            var e = this.getDelegate(),
              t = x(e.sortType, this.sortType());
            e.setGroupByFolder(e.noGroup), this.setSortType(t);
          }
          switchTreeOrList(e) {
            (this.useTreeStyle !== e || this.onInit_) &&
              ((this.onInit_ = !1),
              (this.useTreeStyle = e),
              b(".sidebar-content").scrollTop(0),
              this.useTreeStyle
                ? b("#typora-sidebar")
                    .addClass("use-file-tree-style")
                    .removeClass("use-file-list-style")
                    .find("#sidepanel-segmented-input-files")
                    .data("localize", "Files")
                    .text(b.localize.getString("Files"))
                : b("#typora-sidebar")
                    .addClass("use-file-list-style")
                    .removeClass("use-file-tree-style")
                    .find("#sidepanel-segmented-input-files")
                    .data("localize", "Articles")
                    .text(b.localize.getString("Articles")),
              b.localize.isLoaded() ||
                b("#sidepanel-segmented-input-files").localize("Front", {
                  language: File.language,
                  pathPrefix: "locales",
                }),
              File.isNode
                ? window.ClientCommand.refreshViewMenu()
                : this.updateMenu(e ? "file-tree" : "file-list"),
              JSBridge.putSetting("useTreeStyle", e)),
              this.isFileTabShown() &&
                !this.renderIfNeed() &&
                this.markCurrentFile(!0),
              b("[data-side-mode]").removeClass("selected-folder-menu-item"),
              this.useTreeStyle
                ? b("[data-side-mode='file-tree']").addClass(
                    "selected-folder-menu-item"
                  )
                : b("[data-side-mode='file-list']").addClass(
                    "selected-folder-menu-item"
                  ),
              this.updateOption(),
              this.refreshMenuVisibility(),
              JSBridge.putSetting("sidebar_tab", e ? "file-tree" : "file-list");
          }
          backupCursor() {
            if (File.bundle.filePath) {
              var e = this.editor.selection.storeToJson() || {},
                t = File.editor.sourceView.inSourceMode;
              (e.scrollOffset = t ? 0 : b("content").scrollTop()),
                (e.date = new Date()),
                (this.cursorBackups[File.bundle.filePath] = e);
            }
          }
          openFile(e, t) {
            if (!this._onSwitchDocumentTarget && !File._onFileSwitching) {
              t || (window._hasSwitchCallback = !1);
              var n = this;
              e &&
                !File.isBroken &&
                (b("#sidebar-files-menu").trigger("blur"),
                this.editor.searchPanel &&
                  this.editor.searchPanel.resetSearchStatus(null),
                this.backupCursor(),
                File.isMac
                  ? ((this._onSwitchDocumentTarget = !0),
                    bridge.callHandler(
                      "controller.switchDocumentTarget",
                      e,
                      function (e) {
                        (n._onSwitchDocumentTarget = !1),
                          t && t(e),
                          e || n.refreshPanelCommand();
                      }
                    ),
                    setTimeout(() => {
                      n._onSwitchDocumentTarget = !1;
                    }, 200))
                  : (File.megaMenu.hide(), S(e, t)),
                Analytics.record("openFile", {
                  format: (/\.[^.\\\/]+$/.exec(e) || [""])[0],
                }));
            }
          }
          openWithCtrl(e, t) {
            this.openFileInNewWindow(e, t);
          }
          openFileInNewWindow(e, t) {
            e &&
              File.backupDocumentSnap().then(function () {
                File.isMac
                  ? t
                    ? bridge.callHandler("controller.openFolder", e)
                    : bridge.callHandler("controller.openInNewWindow", e)
                  : JSBridge.invoke("app.openFileOrFolder", e, {
                      forceCreateWindow: !0,
                      mountFolder: File.getMountFolder(),
                    });
              });
          }
          onLoadFolderFailed(e) {
            e = e || this.silent;
            var t = this;
            File.option.pinFolder &&
              File.mountFolder_ == File.option.pinFolder &&
              ((File.option.pinFolder = void 0), (this.silent = "pinFolder")),
              "pinFolder" == this.silent
                ? JSBridge.invoke("dialog.showMessageBox", {
                    type: "question",
                    message: b.localize
                      .getString("Cannot open folder {0}")
                      .format(File.mountFolder_),
                    buttons: [
                      b.localize.getString("Choose Default Folder", "Panel"),
                      b.localize.getString("Ignore", "Panel"),
                    ],
                    defaultId: 0,
                    cancelId: 1,
                    normalizeAccessKeys: !0,
                  }).then(({ response: e }) => {
                    JSBridge.putSetting("restoreWhenLaunch", 0),
                      JSBridge.putSetting("pinFolder", ""),
                      0 == e &&
                        JSBridge.invoke("dialog.showOpenDialog", {
                          defaultPath: File.mountFolder_ || "",
                          properties: ["openDirectory", "promptToCreate"],
                        }).then(({ filePaths: e }) => {
                          e &&
                            e.length > 0 &&
                            (JSBridge.putSetting("restoreWhenLaunch", 3),
                            JSBridge.putSetting("pinFolder", e[0]),
                            t.setMountFolder(e[0]));
                        });
                  })
                : e ||
                  alert(
                    b.localize
                      .getString("Cannot open folder {0}")
                      .format(File.mountFolder_)
                  ),
              File.isNode &&
                JSBridge.invoke(
                  "setting.removeRecentFolder",
                  File.getMountFolder()
                ),
              b("#file-library-tree, #file-library-list-children")
                .attr("data-state", "")
                .html(""),
              (File.mountFolder_ = null),
              (this.root = null),
              (this.silent = !1),
              this.refreshMenuVisibility();
          }
          addWatch(e) {
            (this.fsWatcher && e && e == this.watchedFolder) ||
              (File.isWin
                ? this.addFolderWatchByWin(e)
                : this.addWatchByUnix(e));
          }
          unwatchByUnix(e) {
            if ((File.isLinux || File.isMacNode) && e)
              for (var t in this.unixWatchers)
                -1 == t.indexOf(e) &&
                  (this.unixWatchers[t] && this.unixWatchers[t].close(),
                  (this.unixWatchers[t] = null));
          }
          addWatchByUnix(e) {
            if ((File.isLinux || File.isMacNode) && e) {
              var t = this,
                n = this.unixWatchers[e];
              try {
                n && (n.close(), (n = null)),
                  (this.unixWatchers[e] = reqnode("fs").watch(
                    e,
                    function (n, r) {
                      !(function (e, n) {
                        t.isSuppressOnChange() ||
                          t.shouldIgnore(n) ||
                          (o && clearTimeout(o),
                          k.push([n, e]),
                          (o = setTimeout(i, 200)));
                      })(n, e + "/" + r);
                    }
                  ));
              } catch (e) {
                console.warn(e);
              }
            }
            function i() {
              if (!t.isSuppressOnChange()) {
                var e = k.clone();
                (o = null), (k = []);
                var n = [],
                  i = [];
                e.forEach(function (e) {
                  t.fileTree.onChangeForWin(e[0], n, e[1]),
                    t.fileList.onChangeForWin(e[0], "change" == e[1], i);
                });
              }
            }
          }
          addFolderWatchByWin(e, t) {
            var n = this;
            if (
              (this.fsWatcher &&
                (this.fsWatcher.close(),
                (this.fsWatcher = null),
                (this.watchedFolder = null)),
              e)
            )
              try {
                (this.watchedFolder = e),
                  (this.fsWatcher = reqnode("fs").watch(
                    e,
                    { recursive: !0 },
                    function (t, n) {
                      if (!i) {
                        if (
                          ((n = e + "\\" + n),
                          "rename" == t &&
                            File.bundle.filePath &&
                            0 == File.bundle.filePath.indexOf(n + "\\"))
                        ) {
                          var o =
                            n + "\\" + File.bundle.filePath.substr(n.length);
                          window.doApplyRename(o);
                        }
                        !(function (e, t) {
                          F && clearTimeout(F),
                            k.push([e, t]),
                            (F = setTimeout(r, 200));
                        })(n, "rename" !== t);
                      }
                    }
                  ));
              } catch (e) {
                console.warn(e);
              }
            function r() {
              var e = k.clone();
              (F = null), (k = []);
              var t = [],
                i = [];
              e.forEach(function (e) {
                e[1] || n.fileTree.onChangeForWin(e[0], t),
                  n.fileList.onChangeForWin(e[0], e[1], i);
              });
            }
          }
          bindContext() {
            var e,
              t = this;
            function n(n) {
              if (
                ((e = this),
                this == document.querySelector("#file-library") &&
                  t.useTreeStyle)
              ) {
                if (n.target != this || !File.editor.library.root) return !1;
                (e = t.findElemFromPath(File.editor.library.root.path)[0]),
                  b("#file-menu")
                    .children("li")
                    .hide()
                    .end()
                    .find('[data-action="new_file"],[data-action="new_folder"]')
                    .show();
              } else b("#file-menu li").show();
              File.sync(),
                (t.editor.lastCursor = t.editor.selection.buildUndo()),
                b("#write").blur(),
                b(".context-menu")
                  .removeClass("show")
                  .find(".active")
                  .removeClass("active");
              var r = b(e)
                  .closest(".file-library-node, .ty-search-item")
                  .focus(),
                o = b("#file-menu").addClass("show");
              File.isWin && o.find("[for-win]").show(),
                o.find("li[data-key], .divider").show(),
                b("#typora-sidebar.ty-show-search").length
                  ? o.find("[data-action='search'] a").addClass("state-on")
                  : o.find("[data-action='search'] a").removeClass("state-on"),
                r.hasClass("ty-search-item")
                  ? (o.find("li[data-key], .divider").hide(),
                    o.find("[for-search]").show())
                  : (o.find("[for-search-only]").hide(),
                    t.useTreeStyle
                      ? (o.find('[data-action="new_folder"]').show(),
                        r.attr("data-path") == File.getMountFolder()
                          ? o.find("[for-file]").hide()
                          : "true" == r.attr("data-is-directory")
                          ? o.find("[for-file]:not([for-folder])").hide()
                          : o.find("[for-folder]:not([for-file])").hide())
                      : (o.find('[data-action="new_folder"]').hide(),
                        o.find("[for-folder]:not([for-file])").hide(),
                        t.editor
                          .getJQueryElem(e)
                          .closest(".file-library-node")
                          .attr("data-path") ||
                          o.find("[for-folder],[for-file]").hide()),
                    File.isWin || o.find("[for-win]").hide());
              var a = File.getMountFolder();
              return (
                (a = a ? a + (File.isWin ? "\\" : "/") : ""),
                o.find("[for-undo]").hide(),
                File.isNode &&
                  JSBridge.invoke("filesOp.undoLabel", a).then((e) => {
                    if (e) {
                      var t = b.localize
                        .getString("Undo %@", "Panel")
                        .replace("%@", e);
                      o.find('[data-action="undo_file_op"] a').text(t),
                        o.find("[for-undo]").show();
                    }
                  }),
                t.useTreeStyle
                  ? (o
                      .find('[data-action="list_view"] a')
                      .removeClass("state-on"),
                    o.find('[data-action="tree_view"] a').addClass("state-on"))
                  : (o.find('[data-action="list_view"] a').addClass("state-on"),
                    o
                      .find('[data-action="tree_view"] a')
                      .removeClass("state-on")),
                t.isReadOnlyRoot()
                  ? b("#file-menu").find("[for-new]").hide()
                  : b("#file-menu").find("[for-new]").show(),
                i(n, o),
                r.one("blur", function () {
                  (document.activeElement &&
                    document.activeElement.classList.contains(
                      "file-node-content"
                    )) ||
                    b(".context-menu").removeClass("show");
                }),
                !1
              );
            }
            function i(e, t) {
              var n = t.height() + 48,
                i =
                  e.clientX > window.innerWidth - 220
                    ? window.innerWidth - 220
                    : e.clientX,
                r =
                  e.clientY > window.innerHeight - n
                    ? window.innerHeight - n
                    : e.clientY - b("#top-titlebar").height() + 8;
              t.css({ top: r + "px", left: i + "px" });
            }
            b("#file-menu").on("mousedown", "[data-key]", function (n) {
              var i = this.getAttribute("data-action");
              i &&
                1 == n.which &&
                (b(".context-menu")
                  .removeClass("show")
                  .find(".active")
                  .removeClass("active"),
                setTimeout(function () {
                  switch (i) {
                    case "open":
                      t.openFileCommand(e);
                      break;
                    case "open_in_new_window":
                      t.openFileInNewWindowCommand(e);
                      break;
                    case "new_file":
                      return t.newFileCommand(e), !1;
                    case "new_folder":
                      return t.newFolderCommand(e), !1;
                    case "delete":
                      t.deleteFileCommand(e);
                      break;
                    case "properties":
                      return t.showFilePropertyCommand(e), !1;
                    case "rename":
                      return t.getDelegate().renameFileCommand(e), !1;
                    case "duplicate":
                      return t.duplicateFileCommand(e), !1;
                    case "copy_path":
                      t.copyFullPathCommand(e);
                      break;
                    case "reveal":
                      t.revealFileInFinderCommand(e);
                      break;
                    case "undo_file_op":
                      File.isNode &&
                        JSBridge.invoke("filesOp.getFocusPath").then((e) => {
                          e && t.scheduleChangeHighlight(e),
                            JSBridge.invoke("filesOp.performUndo");
                        });
                      break;
                    case "tree_view":
                      t.switch("file-tree");
                      break;
                    case "list_view":
                      t.switch("file-list");
                      break;
                    case "collapse_all":
                      t.collapseAllSearch();
                      break;
                    case "expand_all":
                      t.expandAllSearch();
                      break;
                    case "search":
                      !t.fileSearch.isActive() &&
                      b("#typora-sidebar.ty-show-search").length
                        ? t.fileSearch.hideSearch()
                        : t.fileSearch.toggleSearch();
                      break;
                    default:
                      return;
                  }
                }, 0),
                t.editor.restoreLastCursor(null, !0));
            }),
              b("#file-library")
                .on("contextmenu", ".file-node-content, .file-list-item", n)
                .on("contextmenu", n),
              b("#file-library-search")
                .on("contextmenu", ".ty-search-item", n)
                .on("contextmenu", function (e) {
                  var t = b("#file-menu").addClass("show");
                  return (
                    t.find("li").hide(),
                    t
                      .find('[data-action="search"]')
                      .show()
                      .find("a")
                      .addClass("state-on")
                      .parent()
                      .next()
                      .show(),
                    t
                      .find(
                        '[data-action="expand_all"], [data-action="collapse_all"]'
                      )
                      .show(),
                    i(e, t),
                    !1
                  );
                });
          }
          clearDraggingItem() {
            this.setDraggingItem(null),
              b(".ty-on-drag-enter").removeClass("ty-on-drag-enter");
          }
          setDraggingItem(e, t, n) {
            if (((this.draggingItem = e), null == e)) w = 0;
            else if (File.isNode) {
              if (!e) return;
              var i = File.isLinux
                ? ""
                : window.dirname +
                  (t
                    ? "/style/windows-folder-icon.png"
                    : "/style/typora-file-icon.png");
              reqnode("electron").ipcRenderer.send("ondragstart", e, i),
                n && n.preventDefault();
            } else File.isMac && bridge.callHandler("controller.startDrag", e);
          }
          expandAllSearch() {
            b(".ty-search-item")
              .removeClass("ty-search-item-collapse")
              .addClass("ty-search-item-expand");
          }
          collapseAllSearch() {
            b(".ty-search-item")
              .addClass("ty-search-item-collapse")
              .removeClass("ty-search-item-expand");
          }
          bindEvents() {
            var e,
              t = this,
              n = this.editor,
              i = b("#typora-sidebar");
            function r() {
              b(".show-sidebar-footer-context").removeClass(
                "show-sidebar-footer-context"
              );
            }
            var o = 0;
            function a(e) {
              if (!t.strollingBySelect) {
                t.strollingBySelect = !0;
                var n = b("#sidebar-content"),
                  i = n[0].scrollHeight - window.innerHeight,
                  r = e ? 0 : i;
                n.stop(!0).animate(
                  { scrollTop: r },
                  (Math.abs(r - n.scrollTop()) / 256) * 1e3,
                  "linear"
                );
              }
            }
            function s() {
              (o = 0),
                t.strollingBySelect &&
                  (b("#sidebar-content").stop(!0), (t.strollingBySelect = !1));
            }
            b("#sidepanel-segmented-input-files").click(function () {
              t.switch("files", !0);
            }),
              b("#sidepanel-segmented-input-outline").click(function () {
                t.switch("outline", !0);
              }),
              i
                .on("keydown", "[tabindex]", function (e) {
                  "Esc" == f[e.keyCode || e.which] &&
                    t.editor.focusCid &&
                    t.editor.restoreLastCursor(null, !0);
                })
                .on("mousedown", "[tabindex]", function (e) {
                  if ("INPUT" != e.target.tagName) {
                    var n = t.editor.selection.buildUndo();
                    n && (t.editor.lastCursor = n);
                  }
                }),
              i
                .on("dragstart", ".file-node-content", function (e) {
                  if ("INPUT" != document.activeElement.tagName) {
                    var n = this.parentElement,
                      i = n.dataset.path;
                    t.setDraggingItem(
                      i,
                      n.dataset.isDirectory + "" == "true",
                      e
                    ),
                      e.originalEvent.dataTransfer.setData("file", i),
                      e.originalEvent.dataTransfer.setData("text/plain", i);
                  }
                })
                .on(
                  "dragenter",
                  "[data-is-directory='true'] > .file-node-content",
                  function (n) {
                    function i(t) {
                      setTimeout(function () {
                        a.classList.contains("ty-on-drag-enter") &&
                          a == e &&
                          (b(a)
                            .addClass("file-node-collapsed")
                            .removeClass("file-node-expanded"),
                          r(5e3));
                      }, t || 1e3);
                    }
                    function r(n) {
                      setTimeout(function () {
                        a.classList.contains("ty-on-drag-enter") &&
                          a == e &&
                          t.fileTree.expandNode(
                            b(a),
                            a.dataset.path,
                            function () {
                              i(5e3);
                            }
                          );
                      }, n || 1e3);
                    }
                    w++, n.stopPropagation(), n.preventDefault();
                    var o = n.originalEvent.dataTransfer;
                    if (
                      (File.isWK &&
                        !t.draggingItem &&
                        (t.draggingItem = o.getData("file")),
                      t.draggingItem || (o.types || []).indexOf("Files") > -1)
                    ) {
                      var a = this.parentElement;
                      setTimeout(function () {
                        e = a;
                      }, 0),
                        b(this)
                          .closest(".ty-on-drag-enter")
                          .removeClass("ty-on-drag-enter"),
                        (!0 !== a.dataset.hasSub &&
                          "true" != a.dataset.hasSub) ||
                          (a.classList.contains("file-node-expanded")
                            ? i(3e3)
                            : r()),
                        b(".ty-on-drag-enter").removeClass("ty-on-drag-enter"),
                        a.classList.add("ty-on-drag-enter");
                    }
                  }
                )
                .on(
                  "dragleave",
                  ".ty-on-drag-enter > .file-node-content",
                  function (t) {
                    w--, (e = null);
                  }
                )
                .on(
                  "dragleave",
                  ".ty-on-drag-enter[data-is-directory='true']",
                  function (e) {
                    if (!(w > 0)) {
                      var t = e.target;
                      t.classList.contains("file-node-content") &&
                        (t = t.parentElement),
                        t.classList.contains("ty-on-drag-enter") &&
                          (t.classList.remove("ty-on-drag-enter"),
                          e.stopPropagation());
                    }
                  }
                )
                .on("drop", "[data-is-directory='true']", function (e) {
                  e.stopPropagation(), e.preventDefault();
                  var n = [],
                    i = e.originalEvent.dataTransfer;
                  if (File.isActiveWindow()) {
                    if (t.draggingItem) n.push(t.draggingItem);
                    else if (i.files && i.files.length) {
                      if (
                        ((i.files.item(r) || {}).path ||
                          (n = t.filesInDragging || []),
                        File.isNodeHtml)
                      )
                        for (var r = 0; r < i.files.length; r++) {
                          var o = (i.files.item(r) || {}).path;
                          o && n.push(o);
                        }
                    } else
                      i.getData("text/uri-list") &&
                        n.push(
                          i.getData("text/uri-list").replace(/^file:[\/]+/, "")
                        );
                    t.clearDraggingItem(),
                      n.length &&
                        (t.fileTree.expand(this.dataset.path),
                        t.copyOrMoveFiles(n, this.dataset.path));
                  }
                })
                .on("drop", function (e) {
                  e.stopPropagation(), e.preventDefault();
                })
                .on("mouseup", function () {
                  t.clearDraggingItem(), s();
                }),
              File.isMac &&
                i
                  .on("dragenter", ".sidebar-tabs", function (e) {
                    e.preventDefault(), o++, a(!0);
                  })
                  .on("dragleave", ".sidebar-tabs", function (e) {
                    e.preventDefault(), !--o && s();
                  })
                  .on("dragenter", "#ty-sidebar-footer", function (e) {
                    e.preventDefault(), o++, a(!1);
                  })
                  .on("dragleave", "#ty-sidebar-footer", function (e) {
                    e.preventDefault(), !--o && s();
                  }),
              b("#ty-sidebar-footer")
                .on("click", "#sidebar-new-file-btn", function () {
                  return (
                    n.focusAndRestorePos(), t.newFile(File.getMountFolder()), !1
                  );
                })
                .on("click", "#switch-file-list-btn", function () {
                  return (
                    n.focusAndRestorePos(),
                    t.switchTreeOrList(!t.useTreeStyle),
                    !1
                  );
                })
                .on("click", "#target-cur-file-btn", function () {
                  return (
                    n.focusAndRestorePos(),
                    File.getMountFolder() &&
                      t.getDelegate().focusToFile(u.getCurrentFilePath()),
                    !1
                  );
                })
                .on("mousedown", "#sidebar-menu-btn", function () {
                  return (
                    n.focusAndRestorePos(),
                    b(".show-sidebar-footer-context").length
                      ? r()
                      : t.showSidebarMenu(),
                    !1
                  );
                }),
              b(".sidebar-tabs")
                .on("click", "#hide-sidebar-btn", function () {
                  return n.focusAndRestorePos(), t.hideSidebar(), !1;
                })
                .on("click", "#switch-sidebar-icon", function () {
                  return (
                    n.focusAndRestorePos(),
                    t.switch(t.isFileTabShown() ? "outline" : "files"),
                    !1
                  );
                }),
              b("#sidebar-files-menu")
                .on("blur", function () {
                  setTimeout(r, 10);
                })
                .on("mousedown", "#close-sidebar-menu-btn", function () {
                  r();
                })
                .on("mousedown", "#new-file-from-sidebar-menu", function (e) {
                  1 == e.which && t.newFile(File.getMountFolder());
                })
                .on(
                  "mousedown",
                  "#reveal-folder-from-sidebar-menu",
                  function (e) {
                    1 == e.which &&
                      File.getMountFolder() &&
                      JSBridge.openFolder(File.getMountFolder());
                  }
                )
                .on("mousedown", "#search-from-sidebar-menu", function (e) {
                  1 == e.which &&
                    File.getMountFolder() &&
                    t.fileSearch.show(!0);
                })
                .on("mousedown", "#refresh-from-sidebar-menu", function (e) {
                  1 == e.which && t.refreshPanelCommand();
                })
                .on(
                  "mousedown",
                  "#open-folder-from-sidebar-menu",
                  function (e) {
                    1 == e.which &&
                      (b("#sidebar-files-menu").trigger("blur"),
                      setTimeout(t.selectFolder.bind(t), 100));
                  }
                )
                .on("mousedown", "[data-side-mode]", function (e) {
                  1 == e.which && t.switch(this.getAttribute("data-side-mode"));
                })
                .on("mousedown", ".folder-menu-item", function (e) {
                  1 == e.which &&
                    ((File.isMacOrMacNode ? e.metaKey : e.ctrlKey)
                      ? t.openWithCtrl(this.getAttribute("data-path"), !0)
                      : File.getMountFolder() !=
                          this.getAttribute("data-path") &&
                        JSBridge.invoke(
                          "controller.switchFolder",
                          this.getAttribute("data-path")
                        ));
                })
                .on("mousedown", "#ty-group-by-folder-btn", function (e) {
                  return (
                    t.getDelegate().setGroupByFolder(!t.getDelegate().noGroup),
                    !1
                  );
                })
                .on("mousedown", "#ty-sort-by-natural-btn", function () {
                  return (
                    this.classList.contains("active")
                      ? t.setSortType(
                          t.sortType() ? E.Natural : E.NaturalDescend
                        )
                      : t.setSortType(
                          this.classList.contains("ty-sort-by-natural-d")
                            ? E.NaturalDescend
                            : E.Natural
                        ),
                    b(this).trigger("mouseenter"),
                    !1
                  );
                })
                .on("mousedown", "#ty-sort-by-name-btn", function () {
                  return (
                    this.classList.contains("active")
                      ? t.setSortType(-t.sortType())
                      : t.setSortType(
                          this.classList.contains("ty-sort-a") ? -1 : 1
                        ),
                    b(this).trigger("mouseenter"),
                    !1
                  );
                })
                .on("mousedown", "#ty-sort-by-date-btn", function () {
                  return (
                    this.classList.contains("active")
                      ? t.setSortType(-t.sortType())
                      : t.setSortType(
                          this.classList.contains("ty-sort-t") ? -2 : 2
                        ),
                    b(this).trigger("mouseenter"),
                    !1
                  );
                })
                .on("mousedown", "#ty-sort-by-create-btn", function () {
                  return (
                    this.classList.contains("active")
                      ? t.setSortType(-t.sortType())
                      : t.setSortType(
                          this.classList.contains("ty-sort-new-down") ? -3 : 3
                        ),
                    b(this).trigger("mouseenter"),
                    !1
                  );
                })
                .on("keydown", function (e) {
                  "Esc" != f[e.keyCode || e.which] ||
                    e.metaKey ||
                    e.ctrlKey ||
                    this.blur();
                }),
              this.fileTree.bindEvents(),
              this.fileList.bindEvents(),
              File.isNodeHtml && this.bindContext();
          }
          async execRenameFileByNode(e, t, n) {
            const i = reqnode("fs-extra"),
              r = reqnode("path");
            var o = t;
            if (n) {
              let e = r.basename(t);
              try {
                (o = File.option.tempPath + sep + "typora-undo" + sep + e),
                  i.copySync(file, o, {
                    overwrite: !0,
                    preserveTimestamps: !0,
                  });
              } catch (e) {
                o = "";
              }
            }
            var a = null;
            try {
              if (await this.tryChangeEmptyFileFormat(e, t)) return [];
              await (async function (e, t) {
                try {
                  await i.rename(e, t);
                } catch (n) {
                  n &&
                    "EPERM" == n.code &&
                    (await i.move(e, t, { overwrite: !0 }));
                }
              })(e, t);
            } catch (e) {
              a = e;
            }
            return [a, o];
          }
          copyOrMoveFiles(e, t) {
            var n = File.isWin ? "\\" : "/",
              i = File.getMountFolder();
            if (i) {
              i += n;
              var r = this,
                o = 1 == e.length && this.isDiscardableUntitled();
              e.forEach(function (e) {
                e != t &&
                  (0 != t.indexOf(e + n) &&
                  e.substring(0, e.lastIndexOf(n)) != t
                    ? File.isNode
                      ? (function (e, n) {
                          var i = reqnode("fs-extra"),
                            o = reqnode("path"),
                            a = o.basename(e),
                            l = o.join(t, a);
                          function c(e) {
                            d.showNotification(
                              "<strong>" +
                                b.localize.getString(
                                  "Operation Failed",
                                  "Panel"
                                ) +
                                "</strong>  " +
                                s.escape(e.message || ""),
                              !0
                            ),
                              JSBridge.invoke("filesOp.clearUndo");
                          }
                          async function h(e, t, o) {
                            var [a, s] = await r.execRenameFileByNode(e, t, o);
                            !(function (e, t, o) {
                              o
                                ? ("EXDEV" == o.code || "EPERM" == o.code
                                    ? i.copy(e, t, async function (e) {
                                        e
                                          ? c(e)
                                          : s &&
                                            (await JSBridge.invoke(
                                              "filesOp.clearUndo"
                                            ),
                                            r.scheduleChangeHighlight(t));
                                      })
                                    : c(o),
                                  (t = e))
                                : s &&
                                  JSBridge.invoke(
                                    "filesOp.registerUndo",
                                    s,
                                    e,
                                    b.localize
                                      .getString("Move %@", "Panel")
                                      .replace(
                                        "%@",
                                        reqnode("path").basename(e)
                                      )
                                  ),
                                o ||
                                  (n
                                    ? File.isNode &&
                                      u.statWrapper(t, function (e) {
                                        e.isFile &&
                                          u.isSupportedFile(e.name) &&
                                          r.openFile(t);
                                      })
                                    : r.scheduleChangeHighlight(t)),
                                JSBridge.invoke("app.sendEvent", "didRename", {
                                  oldPath: e,
                                  newPath: t,
                                });
                            })(e, t, a);
                          }
                          function p() {
                            JSBridge.invoke("app.sendEvent", "willRename", {
                              oldPath: e,
                            }),
                              i.existsSync(l)
                                ? JSBridge.invoke("dialog.showMessageBox", {
                                    type: "warning",
                                    message: b.localize.getString(
                                      "File/directory already exists at target path.",
                                      "Panel"
                                    ),
                                    buttons: [
                                      b.localize.getString(
                                        "Keep Both",
                                        "Panel"
                                      ),
                                      b.localize.getString("Replace"),
                                      b.localize.getString("Cancel"),
                                    ],
                                    defaultId: 1,
                                    cancelId: 2,
                                  }).then(({ response: s }) => {
                                    0 == s
                                      ? (function s() {
                                          var d = a.indexOf("."),
                                            u = -1 == d ? a : a.substring(0, d),
                                            h = -1 == d ? "" : a.substring(d);
                                          (a = u + " (copy)" + h),
                                            (l = o.join(t, a)),
                                            i.existsSync(l)
                                              ? s()
                                              : r
                                                  .execRenameFileByNode(e, l)
                                                  .then(function ([t]) {
                                                    t
                                                      ? (c(t), (l = e))
                                                      : (JSBridge.invoke(
                                                          "filesOp.registerUndo",
                                                          l,
                                                          e,
                                                          b.localize
                                                            .getString(
                                                              "Move %@",
                                                              "Panel"
                                                            )
                                                            .replace(
                                                              "%@",
                                                              reqnode(
                                                                "path"
                                                              ).basename(e)
                                                            )
                                                        ),
                                                        n
                                                          ? r.openFile(l)
                                                          : r.scheduleChangeHighlight(
                                                              l
                                                            )),
                                                      JSBridge.invoke(
                                                        "app.sendEvent",
                                                        "didRename",
                                                        {
                                                          oldPath: e,
                                                          newPath: l,
                                                        }
                                                      );
                                                  });
                                        })()
                                      : 1 == s
                                      ? h(e, l, !0)
                                      : ((l = e),
                                        JSBridge.invoke(
                                          "app.sendEvent",
                                          "didRename",
                                          { oldPath: e, newPath: l }
                                        ));
                                  })
                                : h(e, l);
                          }
                          var f = r.useTreeStyle
                            ? "noWarnigForMoveFile"
                            : "noWarnigForMoveFileToList";
                          File.option[f]
                            ? p()
                            : d
                                .showWarningDialog(
                                  b.localize
                                    .getString(
                                      "Are you sure you want to move %@?",
                                      "Panel"
                                    )
                                    .replace("%@", a),
                                  !0
                                )
                                .then(({ response: e, checkboxChecked: t }) => {
                                  0 == e &&
                                    (p(),
                                    t &&
                                      (JSBridge.execForAll(
                                        "window.File && File.option && (File.option.%@ = true)".replace(
                                          "%@",
                                          f
                                        )
                                      ),
                                      JSBridge.putSetting(f, !0)));
                                });
                        })(e, o)
                      : File.isMac &&
                        (function (e, n) {
                          var i = u.getFileNameFromPath(e);
                          n = n && u.isSupportedFile(i);
                          var r = t + "/" + i;
                          bridge.callHandler("library.moveFile", {
                            source: e,
                            dest: r,
                            shouldOpen: n || !1,
                          });
                        })(e, o)
                    : r.getDelegate().highlight(e));
              });
            }
          }
          sortType() {
            return x(
              this.getDelegate().sortType,
              this.fileList.sortType || this.fileTree.sortType || 0
            );
          }
          dateAffectsSort() {
            return c.isType(
              this.sortType,
              E.Date,
              E.DateDescend,
              E.CreateDate,
              E.CreateDateDescend
            );
          }
          compareItem(e, t) {
            if (!e || !t) return 1;
            function n(e, t) {
              if (e == t) return 0;
              (e = e.toLowerCase()), (t = t.toLowerCase());
              var n = e.replace(/\..+/, ""),
                i = t.replace(/\..+/g, "");
              return File.isWin
                ? n == i
                  ? 0 == [e, t].sort().indexOf(e)
                    ? -1
                    : 1
                  : 0 == [n, i].sort().indexOf(n)
                  ? -1
                  : 1
                : n == i
                ? e.localeCompare(t)
                : n.localeCompare(i);
            }
            var i = this.sortType();
            return i == E.Alphabet
              ? n(e.name, t.name)
              : i == E.Date
              ? e.lastModified - t.lastModified
              : i == E.AlphabetDescend
              ? n(t.name, e.name)
              : i == E.DateDescend
              ? t.lastModified - e.lastModified
              : i == E.CreateDate
              ? e.createDate - t.createDate
              : i == E.CreateDateDescend
              ? t.createDate - e.createDate
              : i == E.NaturalDescend
              ? -s.naturalCompare(e.name, t.name)
              : s.naturalCompare(e.name, t.name);
          }
          setSortType(e) {
            b(".ty-side-sort-btn2").removeClass("active"),
              e == E.Alphabet
                ? b("#ty-sort-by-name-btn")
                    .removeClass("ty-sort-a")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString("Sort by Name (Ascending)")
                    )
                : e == E.Date
                ? b("#ty-sort-by-date-btn")
                    .removeClass("ty-sort-t")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString(
                        "Sort by Modification Date (Ascending)"
                      )
                    )
                : e == E.AlphabetDescend
                ? b("#ty-sort-by-name-btn")
                    .addClass("ty-sort-a")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString("Sort by Name (Descending)")
                    )
                : e == E.DateDescend
                ? b("#ty-sort-by-date-btn")
                    .addClass("ty-sort-t")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString(
                        "Sort by Modification Date (Descending)"
                      )
                    )
                : e == E.CreateDate
                ? b("#ty-sort-by-create-btn")
                    .removeClass("ty-sort-new-down")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString("Sort by Creation Date (Ascending)")
                    )
                : e == E.CreateDateDescend
                ? b("#ty-sort-by-create-btn")
                    .addClass("ty-sort-new-down")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString("Sort by Creation Date (Descending)")
                    )
                : e == E.NaturalDescend
                ? b("#ty-sort-by-natural-btn")
                    .addClass("ty-sort-by-natural-d")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString("Sort Naturally (Descending)")
                    )
                : b("#ty-sort-by-natural-btn")
                    .removeClass("ty-sort-by-natural-d")
                    .addClass("active")
                    .attr(
                      "ty-hint",
                      b.localize.getString("Sort Naturally (Ascending)")
                    ),
              this.getDelegate().sortType != e &&
                this.getDelegate().setSortType(e);
          }
          selectFolder() {
            if (File.isMac) bridge.callHandler("controller.selectFolder");
            else {
              var e = this;
              JSBridge.invoke("dialog.showOpenDialog", {
                buttonLabel: b.localize.getString("Select"),
                properties: ["openDirectory"],
              }).then(({ filePaths: t }) => {
                var n = (t || [])[0];
                n && e.onRootChanged(n);
              });
            }
          }
          showSidebarMenu() {
            b(".sidebar-footer").addClass("show-sidebar-footer-context");
            var e,
              t = b("#sidebar-files-menu").focus();
            function n(e, t) {
              var n = b(b("#folder-menu-item-template").html());
              return (
                n.find("span").text(u.getFileNameFromPath(e)),
                n.attr("data-path", e),
                n.attr("ty-hint", s.abbreviatingWithTilde(e)),
                t.before(n),
                n
              );
            }
            (e = function (e) {
              t.find(".folder-menu-item")
                .remove()
                .end()
                .find(".folder-menu-group")
                .show();
              var i = b(".sidebar-content").height(),
                r = t.find("#reveal-folder-from-sidebar-menu")[0].clientHeight,
                o = t[0].clientHeight,
                a = Math.max(0, Math.min(6, Math.floor((i - o - 20) / r)));
              (e = e.slice(0)),
                File.getMountFolder()
                  ? (e.remove(File.getMountFolder()),
                    (e = e.slice(0, (a || 1) - 1)))
                  : (e = e.slice(0, a));
              for (
                var s = b("#folder-menu-item-after"), l = 0;
                l < e.length;
                l++
              )
                n(e[l], s);
              File.getMountFolder()
                ? n(File.getMountFolder(), s).addClass(
                    "selected-folder-menu-item"
                  )
                : 0 == e.length &&
                  t.find(".folder-menu-group").removeClass("show");
            }),
              File.isMac
                ? bridge.callHandler("library.getRecentFolders", e)
                : File.isNode
                ? JSBridge.invoke("setting.getRecentFiles").then((t) => {
                    var { folders: n } = JSON.parse(t);
                    e(n.map((e) => e.path));
                  })
                : e([]);
          }
          init() {
            this.bindEvents();
            var e = this;
            File.option.sidebarTab && this.show(),
              File.isMac &&
                !u.getCurrentFilePath() &&
                bridge.callHandler("controller.shouldLoadFolder", function (t) {
                  t &&
                    (e.isFileTabShown() ||
                      e.show(e.useTreeStyle ? "file-tree" : "file-list"));
                });
          }
          switch(e, t) {
            if ((b(".sidebar-content").scrollTop(0), "outline" == e)) {
              var n;
              this.fileSearch.hide(),
                b("#typora-sidebar")
                  .addClass("active-tab-outline")
                  .removeClass("active-tab-files"),
                b("[data-side-mode]").removeClass("selected-folder-menu-item"),
                b("[data-side-mode='outline']").addClass(
                  "selected-folder-menu-item"
                ),
                b("#sidebar-footer-main-item-label").text(
                  b.localize.getString("Outline")
                ),
                this.outline.highlightVisibleHeader(),
                this.useTreeStyle
                  ? ((n = b.localize.getString("Switch to File Tree view")),
                    b("#switch-sidebar-icon")
                      .html('<span class="ty-icon ty-file-tree"></span>')
                      .attr("ty-hint", n)
                      .attr("aria-label", n))
                  : ((n = b.localize.getString("Switch to File List view")),
                    b("#switch-sidebar-icon")
                      .html('<span class="ty-icon ty-three-cells"></span>')
                      .attr("ty-hint", n)
                      .attr("aria-label", n));
            } else {
              this.outline.hideSearch(),
                b("#typora-sidebar")
                  .removeClass("active-tab-outline")
                  .addClass("active-tab-files");
              var i = this.useTreeStyle || !1;
              "file-list" == e
                ? (i = !1)
                : "file-tree" == e
                ? (i = !0)
                : (e = i ? "file-tree" : "file-list"),
                this.switchTreeOrList(i),
                this.refreshMenuVisibility(),
                b("#switch-sidebar-icon")
                  .html('<span class="ty-icon ty-list"></span>')
                  .attr(
                    "ty-hint",
                    b.localize.getString("Switch to Outline view")
                  );
            }
            b("#switch-sidebar-icon").localize("Front", {
              language: File.language,
              pathPrefix: "locales",
            }),
              JSBridge.putSetting("sidebar_tab", e),
              File.isNode
                ? window.ClientCommand.refreshViewMenu()
                : (this.updateMenu(e),
                  b(".sidebar-tab")
                    .removeClass("active")
                    .filter(
                      "outline" == e
                        ? "#sidepanel-segmented-input-outline"
                        : "#sidepanel-segmented-input-files"
                    )
                    .addClass("active"));
          }
          shouldIgnore(e) {
            var t =
              "/" + (e || "").substring((File.getMountFolder() || "").length);
            return !!/[\\\/](\.\w|node_modules[\\\/])/.exec(t);
          }
          calcMountFolder(e) {
            var t = this;
            return new Promise(function (n, i) {
              function r(e) {
                (File.mountFolder_ = e),
                  n(e),
                  t.isFileTabShown() && t.refreshMenuVisibility();
              }
              File.isMac
                ? bridge.callHandler("controller.calcMountFolder", r)
                : File.mountFolder_
                ? r(File.getMountFolder())
                : File.isNode &&
                  r(
                    (function (t) {
                      var n = reqnode("path"),
                        i = reqnode("fs"),
                        r = t;
                      if (!t) return null;
                      for (; r && /^\w*\/+\w/.exec(r); ) {
                        var o = i.readdirSync(r);
                        if (
                          o.indexOf(".git") > -1 ||
                          o.indexOf(".svn") > -1 ||
                          o.indexOf(".hg") > -1 ||
                          o.indexOf("package.json") > -1
                        )
                          return r;
                        if (
                          /((dropbox\/apps\/[^\/]+)|pages|articles?|blogs?|content)\/?$/i.exec(
                            r
                          )
                        )
                          return r;
                        if (/(_?posts?|_?drafts?)\/?$/i.exec(r)) return r;
                        if (/(node_modules)\/[^\/]+\/?$/i.exec(r)) return r;
                        var a = r;
                        if ((r = n.join(r, "../")) == a || e) break;
                      }
                      return t || null;
                    })(u.getCurrentFileFolderPath())
                  );
            });
          }
          renderIfNeed() {
            return this.useTreeStyle
              ? this.fileTree.renderIfNeed()
              : this.fileList.renderIfNeed();
          }
          findElemFromPath(e) {
            return b(
              ".file-library-node[data-path='" + s.escapeSelector(e) + "']"
            );
          }
          revealInSidebar() {
            this.fileSearch.hide(),
              this.isFileTabShown()
                ? this.markCurrentFile()
                : u.getCurrentFilePath() && this.showSidebar("files");
          }
          revealInFileList() {
            this.showSidebar("file-list"), this.markCurrentFile();
          }
          revealInFileTree() {
            this.showSidebar("file-tree"), this.markCurrentFile();
          }
          markCurrentFile(e, t) {
            var n = u.getCurrentFilePath();
            n &&
              (this.markOpenedFile(n),
              !t && this.getDelegate().focusToFile(n, e),
              this.fileSearch.markOpenedFile(n));
          }
          markOpenedFile(e) {
            if (!e) return b();
            var t = this.findElemFromPath(e);
            return (
              b(".file-library-node.active").removeClass("active"),
              t.length && t.addClass("active"),
              t
            );
          }
          end() {
            if (
              (this.fileTree.needRepaint(),
              this.fileList.needRepaint(!0),
              (this.root = null),
              (File.mountFolder_ = null),
              this.fsWatcher)
            )
              this.fsWatcher.close(),
                (this.fsWatcher = null),
                (this.watchedFolder = null),
                F && clearTimeout(F);
            else {
              for (var e in this.unixWatchers)
                this.unixWatchers[e] && this.unixWatchers[e].close();
              this.unixWatchers = {};
            }
          }
          refreshMenuVisibility() {
            var e = b("#ty-sidebar-footer");
            File.getMountFolder()
              ? (e.find(".empty-menu-group").removeClass("show"),
                e.find(".not-empty-menu-group").addClass("show"),
                b("#typora-sidebar").removeClass("ty-no-mount-folder"),
                this.isReadOnlyRoot()
                  ? document
                      .querySelector("#sidebar-new-file-btn")
                      .classList.add("hide")
                  : document
                      .querySelector("#sidebar-new-file-btn")
                      .classList.remove("hide"))
              : (e.find(".empty-menu-group").addClass("show"),
                e.find(".not-empty-menu-group").removeClass("show"),
                b("#typora-sidebar").addClass("ty-no-mount-folder")),
              b("#sidebar-footer-main-item-label").text(
                u.getFileNameFromPath(File.getMountFolder()) ||
                  b.localize.getString("Open Folder...")
              );
          }
          isReadOnlyRoot() {
            const e = File.getMountFolder();
            if (e)
              return File.isMac
                ? e.toLowerCase().indexOf("typora.app") > -1
                : !window.debugMode &&
                    (window.dirname
                      ? e.toLowerCase().indexOf(window.dirname.toLowerCase()) >
                        -1
                      : void 0);
          }
          onRootChanged(e, t) {
            if (
              (this.end(),
              e &&
                (File.setMountFolder(e),
                File.isNode &&
                  !t &&
                  JSBridge.invoke("setting.addRecentFolder", e)),
              b("#file-library:visible").length && this.renderIfNeed(),
              this.editor.quickOpenPanel)
            )
              this.editor.quickOpenPanel.cacheFolder(e);
            else {
              var n = this.editor;
              setTimeout(function () {
                n.quickOpenPanel && n.quickOpenPanel.cacheFolder(e);
              }, 1e3);
            }
            this.refreshMenuVisibility();
          }
          setMountFolder(e, t, n) {
            (this.silent = n),
              this.onRootChanged(e),
              t &&
                this.showSidebar(
                  this.useTreeStyle ? "file-tree" : "file-library",
                  !0
                );
          }
          onFileUpdated(e) {
            var t = (e || {}).path;
            try {
              t == File.bundle.filePath &&
                (File.bundle.modifiedDate = e.lastModifiedDate),
                this.fileList.onFileUpdated(t, e),
                this.fileTree.onFileUpdated(t);
            } catch (e) {
              console.warn(e);
            }
            try {
              this.pauseOnChange(!0, t);
            } catch (e) {}
          }
          onFileChanges(e) {
            if (File.getMountFolder()) {
              this.fileTree.onChangeForMac(e), this.fileList.onChangeForMac(e);
              var t = !1,
                n = u.getCurrentFilePath();
              if (
                (e.map(function (e) {
                  e.oldPath == n && "rename" == e.type && (t = !0);
                }),
                t)
              ) {
                var i = this;
                setTimeout(function () {
                  i.markCurrentFile();
                }, 1e3);
              }
            }
          }
          getDelegate() {
            return this.useTreeStyle ? this.fileTree : this.fileList;
          }
          isDiscardableUntitled() {
            return !(File.isDocumentEdited() || File.bundle.filePath);
          }
          newFile(e) {
            File.getMountFolder() && this.getDelegate().newFile(e);
          }
          openFileCommand(e) {
            e || retrun;
            var t = this.editor
              .getJQueryElem(e)
              .closest(".file-library-node, .ty-search-item")
              .attr("data-path");
            this.openFile(t), this.outline.autoHideOutline();
          }
          openFileInNewWindowCommand(e) {
            if (
              (e = this.editor
                .getJQueryElem(e)
                .closest(".file-library-node, .ty-search-item")[0])
            ) {
              var t = "true" == e.dataset.isDirectory,
                n = e.dataset.path;
              this.openFileInNewWindow(n, t);
            }
          }
          copyFullPathCommand(e) {
            var t = this.editor
              .getJQueryElem(e)
              .closest(".file-library-node, .ty-search-item")
              .attr("data-path");
            this.editor.UserOp.setClipboard(
              "<span>" + t + "</span>",
              null,
              t,
              !0
            );
          }
          revealFileInFinderCommand(e) {
            var t =
              "string" == typeof e
                ? e
                : this.editor
                    .getJQueryElem(e)
                    .closest(".file-library-node, .ty-search-item")
                    .attr("data-path");
            JSBridge.showInFinder(t);
          }
          renameFileCommand(e, t) {
            this.getDelegate().renameFileCommand(e, t);
          }
          newFileCommand(e, t) {
            this.getDelegate().newFileCommand(e, t);
          }
          newFolderCommand(e) {
            this.fileTree.newFolderCommand(e);
          }
          doDeleteFile(e, t, n) {
            var i = t
                ? this.editor.getJQueryElem(t).closest(".file-library-node")
                : this.findElemFromPath(e),
              r = (e = e || i.attr("data-path")) == u.getCurrentFilePath();
            if (e) {
              var o = this;
              if (File.isMac)
                bridge.callHandler("library.trashItem", e, function (e) {
                  e && (s(), i.hide()), n && n(e);
                });
              else if (File.isNode)
                if (File.option.noWarnigForDeleteFile) l();
                else {
                  var a = reqnode("path").basename(e);
                  JSBridge.invoke("dialog.showMessageBox", {
                    type: "question",
                    message: b.localize
                      .getString("Are you sure you want to delete %@?", "Panel")
                      .replace("%@", a),
                    detail: b.localize.getString(
                      "You can restore from the Trash.",
                      "Panel"
                    ),
                    defaultId: 0,
                    cancelId: 1,
                    buttons: [
                      b.localize.getString("OK"),
                      b.localize.getString("Cancel"),
                    ],
                    checkboxLabel: b.localize.getString(
                      "Do not show this again",
                      "Panel"
                    ),
                  }).then(({ response: e, checkboxChecked: t }) => {
                    0 == e
                      ? (t &&
                          (JSBridge.execForAll(
                            "window.File && File.option && (File.option.noWarnigForDeleteFile = true)"
                          ),
                          JSBridge.putSetting("noWarnigForDeleteFile", !0)),
                        l())
                      : n && n(!1);
                  });
                }
            } else n && n(!1);
            function s() {
              if (r) {
                var e = o.useTreeStyle
                  ? b()
                  : i.filter(".file-list-item").next();
                !n && e.length
                  ? o.openFileCommand(e[0])
                  : File.isNode
                  ? S(null, () => {
                      n && n(!0);
                    })
                  : n && n(!0);
              }
            }
            async function l() {
              if (await JSBridge.invoke("shell.trashItem", e))
                s(),
                  i.hide(),
                  JSBridge.invoke("filesOp.clearUndo"),
                  JSBridge.invoke("app.sendEvent", "updateQuickOpenCache", {
                    toDel: e,
                  });
              else {
                var t = File.option.tempPath + "/" + new Date().getTime(),
                  r = reqnode("fs-extra"),
                  o = !1;
                try {
                  await r.copyFile(e, t), (o = !0);
                } catch (e) {}
                JSBridge.invoke("dialog.showMessageBox", {
                  type: "info",
                  title: b.localize.getString("Operation Failed", "Panel"),
                  message: b.localize.getString(
                    "Failed to move target file or folder to trash",
                    "Panel"
                  ),
                  defaultId: 0,
                  cancelId: 2,
                  buttons: [
                    b.localize.getString("Reveal in File Explorer"),
                    b.localize.getString(
                      "Delete Permanently" + (o ? "" : " (cannot be undo)")
                    ),
                    b.localize.getString("Cancel"),
                  ],
                }).then(({ response: i }) => {
                  0 == i
                    ? (JSBridge.invoke("shell.openItem", e), n && n(!1))
                    : 1 == i
                    ? r.unlink(e, function (i) {
                        i
                          ? JSBridge.invoke("dialog.showMessageBox", {
                              type: "info",
                              title: b.localize.getString("Error", "Panel"),
                              message: b.localize.getString(
                                "Operation Failed",
                                "Panel"
                              ),
                              detail:
                                i.stack || i.message || (i || "").toString(),
                              defaultId: 0,
                              cancelId: 1,
                              buttons: [
                                b.localize.getString("Reveal in File Explorer"),
                                b.localize.getString("Cancel"),
                              ],
                            }).then(({ response: t }) => {
                              0 == t && JSBridge.invoke("shell.openItem", e),
                                n && n(!1);
                            })
                          : (o
                              ? JSBridge.invoke(
                                  "filesOp.registerUndo",
                                  t,
                                  e,
                                  b.localize
                                    .getString("Delete %@", "Menu")
                                    .replace("%@", reqnode("path").basename(e))
                                )
                              : JSBridge.invoke("filesOp.clearUndo"),
                            s());
                      })
                    : n && n(!1);
                });
              }
            }
          }
          deleteFileCommand(e) {
            this.doDeleteFile(null, e);
          }
          showFilePropertyCommand(e) {
            var t = this.editor
              .getJQueryElem(e)
              .closest(".file-library-node")
              .attr("data-path");
            t &&
              (File.isWin
                ? u.winShell().openProperties(File.bundle.filePath)
                : File.isMac && bridge.callHandler("library.showProperty", t));
          }
          duplicateFileCommand(e) {
            var t,
              n,
              i,
              r,
              o,
              a,
              l,
              c = this.editor
                .getJQueryElem(e)
                .closest(".file-library-node")
                .attr("data-path"),
              h = this;
            function p(e) {
              var t = h.findElemFromPath(c),
                n = File.isMac
                  ? e.replace(/\/[^\/]+$/, "")
                  : reqnode("path").dirname(e),
                i = h
                  .getDelegate()
                  .onAddFile({
                    isDirectory: !1,
                    isFile: !0,
                    name: u.getFileNameFromPath(e),
                    path: e,
                    folderPath: n,
                    folderName: u.getFileNameFromPath(n),
                    lastModified: new Date(),
                    summary: t.find(".file-list-item-summary").text(),
                    fetched: !0,
                  });
              i &&
                (h.getDelegate().focusToFile(e, !1, !0),
                h.renameFileCommand(i, !0));
            }
            File.isNode
              ? ((n = reqnode("path")),
                (i = n.basename(c)),
                (r = i.lastIndexOf(".")),
                (o = n.dirname(c)),
                (a = reqnode("fs")),
                (l = n.sep),
                r < 0 && (r = newFileName.length),
                (t = i.substr(r)),
                (i = i.substr(0, r)),
                JSBridge.invoke("filesOp.clearUndo"),
                (function e(t, n, i, r) {
                  n = "%@ (copy)".replace("%@", n);
                  var o = r + l + n + i;
                  a.copyFile(t, o, a.constants.COPYFILE_EXCL, function (a) {
                    a
                      ? "EEXIST" == a.code
                        ? e(t, n, i, r)
                        : a &&
                          d.showNotification(
                            "<strong>" +
                              b.localize.getString(
                                "Operation Failed",
                                "Panel"
                              ) +
                              "</strong>  " +
                              s.escape(a.message || ""),
                            !0
                          )
                      : (h.scheduleChangeHighlight(o),
                        File.isWin && p(o),
                        h.isDiscardableUntitled() && h.openFile(o));
                  });
                })(c, i, t, o))
              : (function (e) {
                  bridge.callHandler("library.duplicate", e, function (e) {
                    e &&
                      (h.isDiscardableUntitled() && h.openFile(e),
                      h.scheduleChangeHighlight(e),
                      p(e));
                  });
                })(c);
          }
          scheduleChangeHighlight(e) {
            this.nextChangeHighlight = e;
            var t = this;
            t.getDelegate().highlight(e),
              this.nextChangeHighlightTimer &&
                clearTimeout(this.nextChangeHighlightTimer),
              (this.nextChangeHighlightTimer = setTimeout(function () {
                (t.nextChangeHighlight = null),
                  (t.nextChangeHighlightTimer = null);
              }, 2e3));
          }
          refreshPanelCommand() {
            var e = File.getMountFolder();
            e &&
              (this.end(),
              File.isNode
                ? (File.setMountFolder(e),
                  this.renderIfNeed(),
                  this.refreshMenuVisibility())
                : bridge.callHandler("controller.switchFolder", e, function () {
                    bridge.callHandler("controller.bindFolderMonitor");
                  }));
          }
          async tryChangeEmptyFileFormat(e, t) {
            const n = reqnode("node:fs/promises");
            let i = u.getExtension(e).toLowerCase(),
              r = u.getExtension(t).toLowerCase();
            return !(
              !(
                ("textbundle" != i && "textbundle" == r) ||
                ("textbundle" == i && "textbundle" != r)
              ) ||
              !(await p.isEmptyFile(e)) ||
              (await n.rm(e, { force: !0, recursive: !0 }),
              File.FileSave.saveAsUseNode(t),
              JSBridge.invoke("filesOp.clearUndo"),
              0)
            );
          }
          async cannotRename(e, t, n) {
            if (!File.option.supportTextBundle) return !1;
            let i = u.getExtension(e).toLowerCase(),
              r = u.getExtension(t).toLowerCase();
            const o =
              'Cannot rename from $1 to $2, please use "File" → "Move To…" from menubar instead.';
            return "textbundle" == i ||
              "textbundle" != r ||
              (await p.isEmptyFile(e))
              ? "textbundle" == i &&
                  "textbundle" != r &&
                  !(await p.isEmptyFile(e)) &&
                  (d.showWarningDialog(
                    b.localize.getString(
                      o
                        .replace("$1", "TextBundle package")
                        .replace("$2", "Markdown file"),
                      "Panel"
                    )
                  ),
                  !0)
              : (d.showWarningDialog(
                  b.localize.getString(
                    o
                      .replace("$1", "Markdown file")
                      .replace("$2", "TextBundle file"),
                    "Panel"
                  )
                ),
                !0);
          }
          bindRename(e, t, n, i, r, o, a, s) {
            var l,
              c,
              u = e.val(),
              h = this;
            function p(e) {
              return (
                File.isWin
                  ? e.replace(/[\\\/:*?"<>\|\000-\031]/g, "")
                  : e.replace(/[\/\\\000-\031]/g, "")
              ).trim();
            }
            async function m() {
              if (!c) {
                c = !0;
                var r = p(e.val()),
                  l = File.isWin ? "\\" : "/",
                  d = s + l + u,
                  f = s + l + r;
                if (r.length > 0 && r != u) {
                  if (!i && !a && (await h.cannotRename(d, f, o)))
                    return void n();
                  e.val(r), t(e);
                } else n();
              }
            }
            function g(t) {
              var n = e.val(),
                i = n.lastIndexOf(".");
              i < 0 && t && (i = n.length),
                i > 0 && e[0].setSelectionRange(0, i);
            }
            e.off("blur")
              .on("blur", function () {
                if (!l) {
                  if (h.stopRename) return !1;
                  (l = !0),
                    r
                      ? m()
                      : (function (e) {
                          e.val(p(e.val())),
                            u != e.val()
                              ? d.confirm(
                                  b.localize
                                    .getString('Rename to "{0}" ?')
                                    .format(e.val()),
                                  function (e) {
                                    h.markFocusOnDialogClose(), m();
                                  },
                                  function () {
                                    n();
                                  }
                                )
                              : n();
                        })(e);
                }
              })
              .off("keydown")
              .on("keydown", function (e) {
                return "Enter" == f[e.keyCode || e.which]
                  ? ((l = !0), m(), !1)
                  : "Esc" == f[e.keyCode || e.which]
                  ? ((l = !0), n(), !1)
                  : "A" == f[e.keyCode || e.which] &&
                    (File.isMacOrMacNode ? e.metaKey : e.ctrlKey)
                  ? (g(!0), !1)
                  : void 0;
              })
              .off("mousedown")
              .on("mousedown", function (e) {
                e.stopPropagation();
              })
              .off("click")
              .on("click", function (e) {
                e.stopPropagation();
              })
              .off("dblclick")
              .on("dblclick", function (e) {
                if (this.selectionEnd == this.value.length) return g(), !1;
              })
              .on("focus", g);
          }
        };
      }
    ),
    $__System.registerDynamic(
      "45",
      [
        "2b",
        "e",
        "11",
        "13",
        "19",
        "12",
        "14",
        "1a",
        "18",
        "1c",
        "27",
        "2a",
        "25",
        "31",
        "28",
        "17",
        "46",
        "2e",
        "1b",
        "26",
        "2f",
        "29",
        "34",
        "47",
        "48",
        "41",
        "2c",
        "35",
        "49",
        "36",
        "37",
        "4a",
        "3a",
        "32",
        "3b",
        "3c",
        "4b",
        "3d",
        "44",
      ],
      !0,
      function ($__require, exports, module) {
        "use strict";
        var global = this || self,
          GLOBAL = global,
          _polyfill = $__require("2b"),
          $ = $__require("e"),
          StringUtils = $__require("11"),
          NodeDef = $__require("13"),
          Node = NodeDef.Node,
          TYPE = NodeDef.TYPE,
          MarkParser = $__require("19"),
          Node2Mark = $__require("12"),
          Node2HTML = $__require("14"),
          NodeOperation = $__require("1a"),
          Fences = $__require("18"),
          MathBlock = $__require("1c"),
          MathInline = $__require("27"),
          Brush = $__require("2a"),
          AutoComplete = $__require("25"),
          Selection = $__require("31"),
          rangy = Selection.rangy,
          EditHelper = $__require("28"),
          HTMLBlock = $__require("17"),
          TableEdit = $__require("46"),
          ImageEdit = $__require("2e"),
          UndoManager = $__require("1b"),
          SnapFlag = UndoManager.SnapFlag,
          KeyMaster = $__require("26"),
          keyNames = KeyMaster.map,
          UserOp = $__require("2f"),
          MediaOp = $__require("29"),
          FileInfoPanel = $__require("34"),
          File = $__require("47"),
          FileAction = $__require("48"),
          DocMenu = $__require("41"),
          Stylize = $__require("2c"),
          SearchPanel = $__require("35"),
          Emoji = $__require("49"),
          WordCount = $__require("36"),
          Word = $__require("37"),
          Export = $__require("4a"),
          SourceView = $__require("3a"),
          FileHelper = $__require("32"),
          LocalSettingBridge = $__require("3b"),
          QuickOpenPanel = $__require("3c"),
          ContextMenu = $__require("4b"),
          SpellCheck = $__require("3d"),
          Library = $__require("44"),
          DBCLICK_DELAY = 180,
          clicks = 0,
          clickTimer = null,
          busyLoadTimer,
          $curLinkElem,
          isInputComponent = function (e) {
            return (
              !!e &&
              ("TEXTAREA" == e.tagName ||
                "INPUT" == e.tagName ||
                "SELECT" == e.tagName ||
                (e.classList && e.classList.contains("ty-input")))
            );
          };
        window.isInputComponent = isInputComponent;
        class Editor {
          constructor(e, t) {
            (this.sessionStr = e),
              (this.EditHelper = EditHelper),
              (this.MarkParser = MarkParser),
              (this.writingArea = document.querySelector(this.sessionStr)),
              t.setEditor(this),
              t.readOption(),
              (t._onInitTheme = !0),
              t.setTheme(),
              setTimeout(function () {
                t._onInitTheme = !1;
              }, 300),
              (this.nodeMap = new NodeDef.NodeMap()),
              (this.imgEdit = new ImageEdit(this)),
              (this.docMenu = new DocMenu(this)),
              (this.undo = new UndoManager(this)),
              (this.localSettingBridge = new LocalSettingBridge(this)),
              t.exitOversize(),
              this.registerBridge(),
              t.setup(),
              t.loadFile(t.option.initFilePath),
              (this.library = new Library(this)),
              this.library.init(),
              (this._pasteboard = {}),
              (this.timerPool_ = {}),
              this._bindGlobal(),
              this._bindKeyEvents(),
              this._bindMouseEvents(),
              (this.focusCid = null),
              (this.selection = new Selection(this)),
              (this.keypressMsg = ""),
              (this.mathInline = new MathInline(this)),
              (this.wordCount = new WordCount(this)),
              (this.brush = new Brush(this)),
              (this.tableEdit = new TableEdit(this)),
              (this.fences = new Fences(this)),
              (this.mathBlock = new MathBlock(this)),
              (this.htmlBlock = new HTMLBlock(this)),
              (this.stylize = new Stylize(this)),
              this.brush.run(),
              (this.UserOp = UserOp),
              (this.searchPanel = new SearchPanel(this)),
              this.writingArea.focus(),
              (this.sourceView = new SourceView(this)),
              (this.emoji = new Emoji(this)),
              (this.word = new Word(this)),
              (this.export = new Export(this)),
              (t.isMac || t.isNode) && setTimeout(t.bindMenu, 200),
              t.freshLock(),
              (this.quickOpenPanel = new QuickOpenPanel(this)),
              this.quickOpenPanel.init(),
              (this.spellChecker = new SpellCheck(this)),
              (this.contextMenu = new ContextMenu(this.sessionStr)),
              (this.dropTargetDom = null),
              (this.strollingBySelect = !1),
              this.updateFocusMode(t.isFocusMode, !0, !0),
              this.setTypeWriterMode(t.isTypeWriterMode, !0, !0),
              setTimeout(function () {
                t.option.silentOpenFailure = !1;
              }, 400),
              (this.autoComplete = new AutoComplete(this)),
              (this.useIMEKeyboard = !1),
              this.busyModeSource;
          }
          registerBridge() {
            if (File.isMac) {
              var e = this;
              bridge.registerHandler("editor.applyChange", function (t, n) {
                e.applyChange(t), n && n();
              }),
                bridge.registerHandler(
                  "editor.applyFullContent",
                  function (t, n) {
                    e.applyFullContent(t[0], t[1]).then(() => {
                      n && n();
                    });
                  }
                ),
                bridge.registerHandler("editor.insertText", function (t, n) {
                  e.insertText(t), n && n();
                }),
                bridge.registerHandler("editor.setPasteboard", function (t, n) {
                  e.setPasteboard(t[0], t[1]), n && n();
                }),
                bridge.registerHandler(
                  "editor.resetPasteboard",
                  function (t, n) {
                    e.resetPasteboard(), n && n();
                  }
                ),
                bridge.registerHandler(
                  "window.showNotificationWithTitle",
                  function (e, t) {
                    EditHelper.showNotificationWithTitle(e[0], e[1]), t && t();
                  }
                ),
                bridge.registerHandler("editor.showZoomPanel", function (e, t) {
                  EditHelper.showZoomPanel(e), t && t();
                }),
                bridge.registerHandler("editor.getSpeechText", function (e, t) {
                  t(UserOp.getSpeechText());
                }),
                bridge.registerHandler("editor.jumpToAnchor", function (t, n) {
                  "#" == (t || "")[0] &&
                    t.trim().length > 1 &&
                    (File._onInitParse
                      ? (File.option.initAnchor = t)
                      : (File._scrollTopTimer &&
                          clearTimeout(File._scrollTopTimer),
                        (File._scrollTopTimer = setTimeout(() => {
                          e.tryOpenUrl(t);
                        }, 0)))),
                    n && n();
                });
            }
          }
          beforeSpellChecking() {
            File.isLocked ||
              setAttributeOnlyNeeded(
                this.writingArea,
                "contenteditable",
                "true"
              );
            var e = this.writingArea.children[0];
            e && "false" == e.getAttribute("contenteditable")
              ? (e.setAttribute("contenteditable", "true"),
                (this.afterSpellChecking = function () {
                  e.setAttribute("contenteditable", "false");
                }))
              : (this.afterSpellChecking = function () {});
          }
          freeLayout() {
            File.isLocked ||
              setAttributeOnlyNeeded(
                this.writingArea,
                "contenteditable",
                "true"
              );
          }
          tryEnterBusyModeWithDelay(e) {
            busyLoadTimer && clearTimeout(busyLoadTimer),
              (busyLoadTimer = setTimeout(() => {
                this.tryEnterBusyMode();
              }, e || 100));
          }
          tryEnterBusyMode(e, t, n) {
            var i = this.writingArea,
              r = this;
            function o() {
              !File.inBusyMode && console.sendLog("enter busy mode"),
                (File.inBusyMode = !0),
                !t && setAttributeOnlyNeeded(i, "contenteditable", "false");
            }
            function a(e) {
              (e && r.busyModeSource && r.busyModeSource !== e) ||
                ((r.busyModeSource = null),
                File.inBusyMode && console.sendLog("leave busy mode"),
                (File.inBusyMode = !1),
                File.isLocked ||
                  (!t && setAttributeOnlyNeeded(i, "contenteditable", "true")));
            }
            if (void 0 !== n) return void (n ? o() : a());
            const s = this.useIMEKeyboard || File.isMac;
            if (void 0 !== e && null !== e) {
              if (File.inBusyMode) return;
              e.length > 1e3 * (s ? 35 : 60)
                ? (o(), (this.busyModeSource = "content"))
                : a("content");
            } else {
              var l = i.innerHTML.length,
                c =
                  this.nodeMap.allNodes.length > 1e4 ||
                  l > 1e3 * (s ? 1500 : 3e3);
              c ||
                ((l +=
                  1e3 * i.querySelectorAll("img, svg, .CodeMirror").length * 5),
                File.option.showLineNumbersForFence &&
                  (l += 1e3 * i.querySelectorAll(".CodeMirror").length * 2),
                (c = l > 1e3 * (s ? 1200 : 2400))),
                c ? (o(), (this.busyModeSource = "html")) : a("html");
            }
          }
          runAllScript() {
            this.scriptTimer &&
              (clearTimeout(this.scriptTimer), (this.scriptTimer = null));
            var writingArea = this.writingArea;
            this.scriptTimer = setTimeout(function () {
              writingArea
                .querySelectorAll("script[data-run]")
                .forEach(function (d) {
                  d.removeAttribute("data-run"), eval(d.textContent);
                });
            }, 100);
          }
          reset(e) {
            window.Reporter.record("editor.reset"),
              (File._onInitParse = !0),
              File.bundle.unsupported && (e = "");
            var t = new NodeDef.Node({
              type: NodeDef.TYPE.raw_edit,
              in: this.nodeMap,
              attachTo: this.nodeMap,
              text: e,
            });
            (this.writingArea.innerHTML = t.parseFrom({
              skips: { old_code: !1 },
            })[0]),
              this.tryEnterBusyMode(e),
              (this.focusCid = null),
              (this.lastCursor = null),
              (File._needsUpdateSnap = new Date()),
              (File._onInitParse = !1);
            var n = this;
            setTimeout(function () {
              n.refresh(void 0, void 0, !0),
                n.wordCount && n.wordCount.update(e);
            }, 80),
              this.spellChecker && this.spellChecker.reset(),
              this.fences && this.fences.onLeaveDocument(),
              this.mathInline && this.mathInline.onLeaveDocument(),
              document
                .querySelectorAll("[guest-id]")
                .forEach(window.loadedWebview),
              window.Reporter.fullValidate();
          }
          quickRefresh() {
            this.refresh(!1, !0);
          }
          refreshUnder(e, t, n) {
            let i;
            return (
              t ||
                ((i =
                  n && !File.inBusyMode
                    ? this.mathBlock.forceRefresh()
                    : this.mathBlock.renderUnder(e, n)),
                this.docMenu && this.docMenu.refreshFootnoteReverseLink(e)),
              this.fences.modeLoaded && this.fences.refreshEditor(!1, t, e),
              this.diagrams.modeLoaded &&
                (t && File.editor.diagrams.loadMermaidTheme(),
                this.diagrams.refreshDiagram(t, e)),
              !t && this.htmlBlock && this.htmlBlock.refreshUnder(e),
              e && this.wordCount.quickUpdate(e.getAttribute("cid"), !0),
              i
            );
          }
          refresh(e, t, n) {
            if (File._onInitParse) return;
            var i = File.isActiveWindow();
            if (this.sourceView && this.sourceView.inSourceMode)
              return void (e && this.sourceView.cm.refresh());
            if (!this.brush)
              return void (this._brushInitCallback = function () {
                this.refresh(e, t);
              }.bind(this));
            $(this.writingArea).find(".md-mathblock-panel").length ||
              (this.mathBlock && (this.mathBlock.currentCm = void 0)),
              t || e || this.nodeMap.toc.refresh(!0);
            let r = this.refreshUnder(void 0, e, n);
            i &&
              (e ||
                (this.wordCount.quickUpdate(this.focusCid, !0),
                this.brush &&
                  this.stylize &&
                  (isInputComponent(document.activeElement) ||
                    this.brush.expand(void 0, !0),
                  File.isNode && File.refreshImageCopyStatus(!0)),
                this.runAllScript(),
                $(
                  "#typora-table-row-tracker, #typora-table-col-tracker"
                ).hide(),
                this.tryEnterBusyModeWithDelay(500),
                r &&
                  r.then(() => {
                    this.tryEnterBusyModeWithDelay();
                  })));
          }
          getJQueryElem(e) {
            return e
              ? e.nodeType == e.ELEMENT_NODE
                ? $(e)
                : $(e.parentNode)
              : $();
          }
          getMarkElem(e) {
            if (
              !e &&
              document.activeElement.nodeType == window.Node.ELEMENT_NODE &&
              (("write" !== document.activeElement.id &&
                document.activeElement.hasAttribute("tabindex")) ||
                Node.isType(
                  document.activeElement.tagName,
                  "TEXTAREA",
                  "INPUT"
                ))
            )
              return $(document.activeElement).closest("[cid]");
            if (
              !(e =
                e || window.getSelection().focusNode || document.activeElement)
            )
              return [];
            var t = e.nodeType == e.ELEMENT_NODE ? $(e) : $(e.parentNode);
            return (
              !t.length ||
                ("TH" !== t[0].tagName && "TD" !== t[0].tagName) ||
                (t = t.children(".td-span")),
              StringUtils.isNullOrEmpty(t.attr("cid")) &&
                (t = t.closest("[cid]")),
              t
            );
          }
          autoRemoveUnholdable(e) {
            var t =
              this.focusCid &&
              this.findElemById(this.focusCid).closest(".unholdable");
            if (t && t.length)
              try {
                if ((this.undo.endSnap(!0), t.next().length || t.text().length))
                  t.removeClass("unholdable");
                else {
                  var n = this.findNodeByElem(t),
                    i =
                      i ||
                      UndoManager.makeEmptyCommand(this.selection.buildUndo()),
                    r = this.selection.getRangy();
                  if (
                    t[0] &&
                    (r.commonAncestorContainer === t[0] ||
                      t[0].contains(r.commonAncestorContainer))
                  )
                    return;
                  this.undo.UndoManager.addUndoForRemove(i, n),
                    i.redo.push(this.selection.buildUndo(r));
                  var o = n.getVeryFirstBrother(!0, !0);
                  if (!o) return;
                  e ||
                    (n.remove(),
                    t.remove(),
                    this.selection.jumpIntoElemEnd(this.findElemById(o.cid)),
                    i.redo.push(this.selection.buildUndo()),
                    this.undo.register(i),
                    this.refocus(o.cid, !1, !0));
                }
              } catch (e) {
                console.warn(e.stack);
              }
            else
              $("#write .unholdable")
                .filter(function () {
                  return this.textContent.length;
                })
                .removeClass("unholdable");
          }
          store(e, t) {
            if (
              (!this.sourceView || !this.sourceView.inSourceMode) &&
              (e = e || this.focusCid)
            ) {
              var n = e.id ? e : this.nodeMap.allNodes.get(e);
              if (n) {
                var i = this.findElemById(n.id);
                if (i.length > 0) {
                  var r = i.rawText(!0);
                  return (
                    Node.isType(n, TYPE.hr, TYPE.toc) ||
                      (Node.isType(n, TYPE.meta_block)
                        ? ((r = r.replace(/\n$/, "")), n.set("text", r))
                        : Node.isType(n, TYPE.math_block)
                        ? i.find(".CodeMirror-code").length &&
                          this.mathBlock.syncToNode(n)
                        : Node.isType(n, TYPE.fences)
                        ? i.find(".CodeMirror-code").length &&
                          this.fences.syncToNode(n)
                        : Node.isType(n, TYPE.html_block)
                        ? i.find(".CodeMirror-code").length &&
                          this.htmlBlock.syncToNode(n)
                        : Node.isType(n, TYPE.def_footnote, TYPE.def_link)
                        ? Node.reverseAttrFromElem(n, i.clone(), void 0, !0)
                        : Node.isType(
                            n,
                            TYPE.heading,
                            TYPE.raw_edit,
                            TYPE.paragraph,
                            TYPE.table_cell
                          ) && !i[0].querySelector("[cid]")
                        ? Node.isType(n, TYPE.paragraph)
                          ? n.set("text", r.replace(/^( {4}|\t)/, "​$1"))
                          : n.set("text", r)
                        : t &&
                          n.get("children").map(function (e) {
                            i[0].querySelector("[cid='" + e.cid + "']")
                              ? this.store(e)
                              : e.remove();
                          }, this)),
                    n && this.wordCount.quickUpdate(n, !1, !0),
                    Node.isType(n, Node.TYPE.meta_block) &&
                      !t &&
                      this.imgEdit.updateLocalRootUrl(),
                    n
                  );
                }
                this.focusCid = null;
              }
            }
          }
          cleanTooltip() {
            $("content")
              .find(".auto-suggest-container.ty-show")
              .removeClass("ty-show"),
              normalCleanTooltip_(),
              this.mathBlock.stopEditing();
          }
          refocus(e, t, n, i, r) {
            if ((clickTimer && clearTimeout(clickTimer), this.isIME)) return e;
            if (!this.sourceView || !this.sourceView.inSourceMode) {
              var o,
                a = e ? this.findElemById(e) : this.getMarkElem(),
                s = this,
                l = this.nodeMap.allNodes.get(this.focusCid),
                c = s.findElemById(this.focusCid);
              if (
                (s.library && s.library.outline.autoHideOutline(),
                e &&
                  a.find("[cid]").length &&
                  (e = (a = this.getMarkElem()).attr("cid")),
                (e = void 0 === e ? a.attr("cid") : e),
                t && e && s.store(e),
                this.focusCid != e || !a.hasClass("md-focus"))
              ) {
                if (
                  (this.focusCid != e &&
                    (function () {
                      var e = s.findElemById(s.focusCid);
                      r
                        ? e.trigger("endfocus")
                        : e.trigger("blur").trigger("losefocus"),
                        e.find(".md-tooltip-hide").hide(),
                        normalCleanTooltip_(),
                        Node.isType(l, Node.TYPE.paragraph) && l.unset("depth"),
                        s.undo.endSnap();
                    })(),
                  this.focusCid == e)
                )
                  return (
                    a.hasClass("md-focus") ||
                      a.addClass("md-focus").trigger("refocus"),
                    e
                  );
                var d;
                if (
                  ((d = this.undo.lastRegisteredOperationCommand()) &&
                    !d.incomplete &&
                    (d = null),
                  this.store(this.focusCid),
                  this.lastCursor &&
                    this.lastCursor.startId === this.lastCursor.endId &&
                    this.lastCursor.startId &&
                    (this.lastCursor.id = this.lastCursor.startId),
                  d &&
                    this.lastCursor &&
                    this.focusCid == this.lastCursor.id &&
                    (d.redo.push(this.lastCursor),
                    s.undo.endSnap(!0),
                    (d = null)),
                  a.hasClass(".md-meta-block") && a[0].normalize(),
                  a.addClass("md-focus").trigger("refocus"),
                  $(document.activeElement).trigger("focus"),
                  File.option.expandSimpleBlock &&
                  (this.focusCid = UserOp.simpleExpand(this, e))
                    ? ("block" ==
                        document.querySelector("#md-searchpanel").style
                          .display && this.searchPanel.closePanel(),
                      (e = this.focusCid))
                    : (n || r || this.brush.expandOnDelay(!1),
                      this.wordCount.quickUpdate(e),
                      (this.focusCid = e)),
                  File.isLocked)
                )
                  return this.focusCid;
                ((this.focusCid &&
                  l &&
                  !(
                    $.contains(c, a) ||
                    $.contains(a, c) ||
                    (a.length && a.is(c))
                  )) ||
                  (l && !this.focusCid)) &&
                  (o = !r && this.simpleParse(l, i)) &&
                  ((o[0].undo[0] = s.lastCursor),
                  setTimeout(function () {
                    o[0].redo.push(s.selection.buildUndo()),
                      s.findElemById(o[2]).replaceWith(o[1]),
                      d
                        ? (UndoManager.append(d, o[0]), (o[0] = d))
                        : s.undo.register(o[0], !0),
                      s.quickRefresh(),
                      s.selection.scrollAdjust(),
                      s.undo.exeCommand(o[0].redo.last());
                  }, 50)),
                  s.undo.endSnap(!0),
                  this.library.outline.highlightVisibleHeader(),
                  this.focusCid && this.brush.focusContainer(a);
              }
              return (s.isIME = 0), n || r || this.brush.expandOnDelay(), e;
            }
          }
          focusAndRestorePos() {
            if (
              document.activeElement != this.writingArea ||
              !this.writingArea.contains(document.activeElement)
            ) {
              var e = $("content"),
                t = e.scrollTop();
              this.writingArea.focus(), e.scrollTop(t);
            }
          }
          resetPasteboard() {
            this._pasteboard = {};
          }
          setPasteboard(e, t) {
            (this._pasteboard = this._pasteboard || {}),
              (this._pasteboard[e] = t);
          }
          _bindGlobal() {
            var e,
              t = this;
            function n() {
              $(".ty-table-edit").length &&
                t.tableEdit.resizeTableEdit($(".ty-table-edit").next()),
                $(".typora-table-tracker").hide(),
                t.setTypeWriterMode(File.isTypeWriterMode, !0),
                (e = null);
            }
            File.option.moveColLeftKey &&
              KeyMaster(File.option.moveColLeftKey, function (e) {
                File.editor.tableEdit.moveColLeftOrRight(!0) &&
                  (e.preventDefault(), e.stopPropagation());
              }),
              File.option.moveColRightKey &&
                KeyMaster(File.option.moveColRightKey, function (e) {
                  File.editor.tableEdit.moveColLeftOrRight(!1) &&
                    (e.preventDefault(), e.stopPropagation());
                }),
              File.option.moveRowUpKey &&
                KeyMaster(File.option.moveRowUpKey, function (e) {
                  File.editor.tableEdit.moveRowUpOrDown(!0) &&
                    (e.preventDefault(), e.stopPropagation());
                }),
              File.option.moveRowDownKey &&
                KeyMaster(File.option.moveRowDownKey, function (e) {
                  File.editor.tableEdit.moveRowUpOrDown(!1) &&
                    (e.preventDefault(), e.stopPropagation());
                }),
              File.isNodeHtml
                ? (KeyMaster("ctrl+home", function (e) {
                    File.editor.selection.jumpTop();
                  }),
                  KeyMaster("ctrl+end", function (e) {
                    File.editor.selection.jumpBottom();
                  }),
                  KeyMaster("end", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !0,
                        null,
                        !1,
                        !0
                      );
                    }, 0);
                  }),
                  KeyMaster("home", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !1,
                        null,
                        !1,
                        !0
                      );
                    }, 0);
                  }),
                  KeyMaster("shift+end", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !0,
                        null,
                        !1,
                        !1
                      );
                    }, 0);
                  }),
                  KeyMaster("shift+home", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !1,
                        null,
                        !1,
                        !1
                      );
                    }, 0);
                  }),
                  KeyMaster("ctrl+z, command+z", function (e) {
                    return ClientCommand.undo(e), !1;
                  }),
                  KeyMaster(
                    "ctrl+y, command+y, command+shift+z, ctrl+shift+z",
                    function (e) {
                      return ClientCommand.redo(e), !1;
                    }
                  ))
                : (KeyMaster("ctrl+k", function (e) {
                    var n = t.selection.getRangy();
                    if (n && !isInputComponent(document.activeElement)) {
                      if (n.collapsed) {
                        var i = t.getMarkElem();
                        n.setEnd(i[0], i[0].childNodes.length),
                          t.selection.setRange(n, !0);
                      }
                      n.toString().length
                        ? UserOp.backspaceHandler(t, e, "delSelection")
                        : UserOp.backspaceHandler(t, e, !0),
                        e.preventDefault(),
                        e.stopPropagation();
                    }
                  }),
                  KeyMaster("command+right", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !0,
                        null,
                        !1,
                        !0
                      );
                    }, 0);
                  }),
                  KeyMaster("command+left", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !1,
                        null,
                        !1,
                        !0
                      );
                    }, 0);
                  }),
                  KeyMaster("command+shift+right", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !0,
                        null,
                        !1,
                        !1
                      );
                    }, 0);
                  }),
                  KeyMaster("command+shift+left", function (e) {
                    setTimeout(function () {
                      File.editor.selection.fixExtendToLineEdge(
                        !1,
                        null,
                        !1,
                        !0
                      );
                    }, 0);
                  }),
                  KeyMaster("command+up, command+down", function (e) {
                    setTimeout(function () {
                      t.refocus();
                    }, 0);
                  }),
                  KeyMaster("ctrl+h", function (e) {
                    t.selection.getRangy() &&
                      !isInputComponent(document.activeElement) &&
                      UserOp.backspaceHandler(t, e, "Backspace");
                  }),
                  KeyMaster("ctrl+d", function (e) {
                    t.selection.getRangy() &&
                      !isInputComponent(document.activeElement) &&
                      UserOp.backspaceHandler(t, e, "Delete");
                  }),
                  KeyMaster("ctrl+tab", function (e) {
                    File.isMac && bridge.callHandler("window.selectNextTab");
                  }),
                  KeyMaster("ctrl+shift+tab", function (e) {
                    File.isMac &&
                      bridge.callHandler("window.selectPreviousTab");
                  }),
                  KeyMaster("command+y", function (e) {
                    if (File.isLocked) return !1;
                    File.editor.undo.redo(e), File.freshMenu();
                  })),
              File.isMac ||
                File.isNode ||
                (File.isNodeHtml ||
                  (KeyMaster("command+z, ctrl+z", function (e) {
                    if (File.isLocked) return !1;
                    t.writingArea.contains(e.target) && t.undo.undo(e);
                  }),
                  KeyMaster("ctrl+y", function (e) {
                    if (File.isLocked) return !1;
                    t.writingArea.contains(e.target) && t.undo.redo(e);
                  })),
                KeyMaster("command+l, ctrl+l", function (e) {
                  e.preventDefault(), t.selection.selectLine();
                }),
                KeyMaster("command+d, ctrl+d", function (e) {
                  e.preventDefault(), t.selection.selectWord();
                }),
                KeyMaster("command+e, ctrl+e", function (e) {
                  e.preventDefault(), t.selection.selectPhrase();
                }),
                KeyMaster("command+a, ctrl+a", function (e) {
                  e.preventDefault(), t.selection.selectAll();
                }),
                KeyMaster("shift+command+d, shift+ctrl+d", function (e) {
                  if (File.isLocked) return !1;
                  e.preventDefault(),
                    t.selection.selectWord(),
                    UserOp.backspaceHandler(t, null, "delSelection");
                })),
              File.isNodeHtml &&
                (function () {
                  var e = File.isMac || File.isMacNode;
                  if (
                    (KeyMaster(e ? "command+b" : "ctrl+b", function (e) {
                      if (File.isLocked) return !1;
                      e.preventDefault(),
                        t.stylize.toggleStyle(NodeDef.TYPE.strong);
                    }),
                    KeyMaster(e ? "command+i" : "ctrl+i", function (e) {
                      if (File.isLocked) return !1;
                      e.preventDefault(),
                        t.stylize.toggleStyle(NodeDef.TYPE.em);
                    }),
                    KeyMaster(e ? "command+u" : "ctrl+u", function (e) {
                      if (File.isLocked) return !1;
                      e.preventDefault(),
                        t.stylize.toggleStyle(NodeDef.TYPE.underline);
                    }),
                    KeyMaster(e ? "command+a" : "ctrl+a", function (e) {
                      e.preventDefault(),
                        File.isNodeHtml && ClientCommand.selectAll();
                    }),
                    File.isNode)
                  ) {
                    let e =
                      File.option.keys["Paste as Plain Text"] || "ctrl+shift+v";
                    e &&
                      KeyMaster(e, function (e) {
                        ClientCommand.pasteAsPlain(), e.preventDefault();
                      }),
                      "ctrl+v" != (e = File.option.keys.Paste) &&
                        KeyMaster(e, function (e) {
                          ClientCommand.paste(), e.preventDefault();
                        });
                  }
                  File.isLinux &&
                    KeyMaster("ctrl+/", function (e) {
                      File.toggleSourceMode(), e.preventDefault();
                    });
                })(),
              $(document)
                .on("dragover", function (e) {
                  e.originalEvent.dataTransfer.dropEffect = "none";
                })
                .on("dragstart", function (e) {
                  if (t.writingArea.contains(e.target)) return !1;
                })
                .on("drop", function (e) {
                  e.stopPropagation(),
                    e.preventDefault(),
                    setTimeout(function () {
                      t.resetPasteboard();
                    }, 0);
                  var n = e.originalEvent.dataTransfer;
                  if (t.library.draggingItem || n.getData("file"))
                    return t.library.clearDraggingItem(), !1;
                  var i = n.getData("text/html"),
                    r = n.getData("text/plain"),
                    o = t._pasteboard.files || [];
                  function a() {
                    var n = document.caretRangeFromPoint(
                      e.originalEvent.x,
                      e.originalEvent.y
                    );
                    n &&
                      n.startContainer &&
                      (t.writingArea == n.startContainer ||
                        t.writingArea.contains(n.startContainer)) &&
                      ("BODY" == document.activeElement.tagName &&
                        t.writingArea.focus(),
                      t.selection.setRange(n),
                      (t.lastCursor = t.selection.buildUndo()),
                      t.refocus());
                  }
                  if (((o = o || []), t._pasteboard.urlWithTitle)) {
                    if (!FileAction.isKeyWindow()) return !1;
                    a(),
                      UserOp.insertUrlWithTitle(
                        t,
                        t._pasteboard.urlWithTitle[0],
                        t._pasteboard.urlWithTitle[1]
                      );
                  } else if (t._pasteboard.image) {
                    if (!FileAction.isKeyWindow()) return !1;
                    a(), MediaOp.insertURL(t._pasteboard.image);
                  } else if (i) {
                    if (!FileAction.isKeyWindow()) return !1;
                    a(),
                      setTimeout(function () {
                        UserOp.pasteHandler(t, i);
                      }, 20);
                  } else if (o.length || (n.files && n.files.length)) {
                    if (File.isNodeHtml)
                      for (var s = 0; s < n.files.length; s++) {
                        var l = n.files.item(s).path;
                        l && o.push(l);
                      }
                    else if (!o.length) {
                      var c = n.getData("text/uri-list");
                      c && (o = o.concat(c));
                    }
                    if (!o.length) return !1;
                    FileAction.onDropFile(o, n, a);
                  } else {
                    if (!r) return !1;
                    if (!FileAction.isKeyWindow()) return !1;
                    a(),
                      setTimeout(function () {
                        UserOp.pasteHandler(t, r);
                      }, 20);
                  }
                })
                .on("paste", this.sessionStr, function (e) {
                  return (
                    !File.isLocked &&
                    (t.sourceView.inSourceMode
                      ? void 0
                      : UserOp.pasteHandler(
                          t,
                          e.originalEvent,
                          File._PasteContentFlag
                        ))
                  );
                })
                .on("pasteAsPlainText", this.sessionStr, function (e) {
                  if (File.isLocked) return !1;
                  if (
                    File.isMac &&
                    (t.sourceView.inSourceMode ||
                      isInputComponent(document.activeElement))
                  )
                    bridge.callHandler("window.pasteAsPlainText");
                  else if (!t.sourceView.inSourceMode)
                    return UserOp.pasteHandler(t, e.originalEvent, !0);
                })
                .on("copy", this.sessionStr, function (e) {
                  isInputComponent(document.activeElement) ||
                    (UserOp.beforeCopyStart(t),
                    UserOp.copyHandler(t, e.originalEvent)),
                    e.stopPropagation();
                })
                .on("copy", function (e) {
                  e.target == document.body &&
                    t.writingArea.contains(document.activeElement) &&
                    document.activeElement != e.target &&
                    (isInputComponent(document.activeElement) ||
                      UserOp.copyHandler(t, e.originalEvent));
                })
                .on("cut", function (e) {
                  e.target == document.body &&
                    t.writingArea.contains(document.activeElement) &&
                    document.activeElement != e.target &&
                    (isInputComponent(document.activeElement) ||
                      (UserOp.copyHandler(t, e.originalEvent),
                      UserOp.backspaceHandler(t, e, "delSelection")));
                })
                .on("cut", this.sessionStr, function (e) {
                  if ((e.stopPropagation(), File.isLocked)) return !1;
                  if (isInputComponent(document.activeElement)) return !0;
                  function n() {
                    let e =
                        File._CopyContentRange &&
                        t.selection.buildUndo(File._CopyContentRange),
                      n = UserOp.backspaceHandler(t, null, "delSelection");
                    if (n && File._CopyContentRange) {
                      n.undo.unshift(e);
                      let i = UserOp.backspaceHandler(t, null, !0, !0);
                      i && UndoManager.append(n, i);
                    }
                  }
                  if (File.isNode)
                    return (
                      (File._CopyContentFlag = "cut_before"),
                      JSBridge.invoke("webContents.copy"),
                      !1
                    );
                  t.refocus(void 0, !0, !0),
                    UserOp.copyHandler(t, e.originalEvent, n) && n();
                })
                .on("contextmenu", function (e) {
                  if (File.isMac) {
                    if ("TITLEBAR" == e.target.tagName) return;
                    var n = [];
                    if (File.isWK && "IFRAME" == e.target.tagName) {
                      var i = document.elementFromPoint(e.clientX, e.clientY);
                      n = t.contextMenu.getMenuItemsForMac(i);
                    } else n = t.contextMenu.getMenuItemsForMac(e.target);
                    0 == n.length
                      ? (e.preventDefault(), e.stopPropagation())
                      : window.bridge.callSync("contextMenu.setItems", n);
                  }
                })
                .on("contextmenu", this.sessionStr, function (e) {
                  var n,
                    i = $(e.target);
                  if (
                    (i.closest(".CodeMirror")[0] ||
                      (Node.isType(
                        t.getMarkElem(e.target).attr("mdtype"),
                        Stylize.CONST.Selectable
                      )
                        ? window.getSelection().removeAllRanges()
                        : ((n = t.selection.getRangy()) &&
                            "" == n.toString() &&
                            (n.collapse(!0), n.select(n.isBackward)),
                          File.isNodeHtml && File.editor.brush.expand())),
                    "IMG" === e.target.tagName && i.closest(".md-image").length)
                  ) {
                    $(".md-expand").removeClass("md-expand");
                    var r = i.closest(".md-image").addClass("md-expand");
                    if (!r.length) return;
                    (n = rangy.createRange()).selectNodeContents(
                      r.children(".md-meta")[0]
                    ),
                      t.selection.setRange(n, !0),
                      File.editor.brush.expand();
                  }
                  File.isNodeHtml && File.editor.contextMenu.show(e);
                })
                .on("click", "#md-notification .undo-btn", function () {
                  t.undo.undo(),
                    document.body.classList.remove("ty-show-notification");
                })
                .on("click", "#md-notification .ok-btn", function () {
                  document.body.classList.remove("ty-show-notification");
                })
                .on("focus", "body", function (e) {
                  if (e.target == document.body) return !1;
                })
                .on("click", EditHelper.resetClick),
              $(window)
                .on("resize", function () {
                  File.suppressResize ||
                    (e && clearTimeout(e), (e = setTimeout(n, 300)));
                })
                .on("mouseup", function (e) {
                  t.selection.clearGlobalColumn(),
                    t.stopScrolling(),
                    1 == e.which && t.wordCount.updateInSelection();
                }),
              window.addEventListener("mac.enterFullscreen", function () {
                $("body").addClass("typora-fullscreen"),
                  $("#top-hotpot, #bottom-hotpot").show();
              }),
              window.addEventListener("mac.exitFullscreen", function () {
                $("body").removeClass("typora-fullscreen"),
                  $("#top-hotpot, #bottom-hotpot").hide();
              }),
              File.isMac &&
                ($("#top-hotpot").on("mouseenter", function (e) {
                  1 == e.which && t.startScrolling(!0);
                }),
                $("#bottom-hotpot").on("mouseenter", function (e) {
                  1 == e.which && t.startScrolling(!1);
                }),
                $("#top-hotpot").on("mouseleave", function (e) {
                  t.stopScrolling();
                }),
                $("#bottom-hotpot").on("mouseleave", function (e) {
                  e.screenY + 4 > window.innerHeight || t.stopScrolling();
                })),
              $(t.sessionStr).on("change", "[type='checkbox']", function () {
                var e = this.parentElement.getAttribute("cid"),
                  n = this.checked;
                n
                  ? this.setAttribute("checked", "checked")
                  : this.removeAttribute("checked"),
                  t.getNode(e).attr("checked", n, t, !1);
              }),
              document.addEventListener(
                "selectionchange",
                function (e) {
                  var n;
                  File.isNodeHtml &&
                    ((n = t.selection.getRangy()),
                    $("svg.in-text-selection").attr("class", ""),
                    n &&
                      n.getNodes([1], function (e) {
                        "svg" === e.tagName &&
                          e.classList.add("in-text-selection");
                      })),
                    File.isFocusMode && enterFocusMode.call(t);
                },
                !1
              );
          }
          _bindKeyEvents() {
            var e,
              t,
              n,
              i,
              r = this,
              o = !1,
              a = !1;
            function s(e) {
              fastdom.mutate(function () {
                document
                  .querySelector("#write")
                  .querySelectorAll("a, .md-def-url, .md-url")
                  .forEach(function (t) {
                    t.style.cursor = e ? "pointer" : "";
                  });
              });
            }
            (r.isIME = 0),
              (r.lastKeydownEvent = null),
              $(document.body).on("keydown", function (e) {
                if (!(e.metaKey || e.ctrlKey || e.altKey)) {
                  r.library.outline.autoHideOutline();
                  var t = document.body.classList;
                  (t.contains("ty-show-word-count") ||
                    t.contains("ty-show-spell-check")) &&
                    (t.remove("ty-show-word-count"),
                    t.remove("ty-show-spell-check"));
                  var n = e.keyCode || e.which;
                  if (EditHelper.keyOnControl(keyNames[n], e)) return !1;
                  if (
                    document.activeElement == document.body &&
                    !$(".modal-dialog:visible").length
                  ) {
                    var i = window.getSelection();
                    if (
                      !i ||
                      !i.startContainer ||
                      !r.writingArea.contains(startContainer)
                    )
                      return !1;
                    var o = $("content").scrollTop();
                    r.writingArea.focus(),
                      ("Delete" != keyNames[n] &&
                        "Backspace" != keyNames[n] &&
                        "Enter" != keyNames[n]) ||
                        (e.originalEvent != r.lastKeydownEvent &&
                          ((e.target = r.writingArea),
                          (r.lastKeydownEvent = e.originalEvent),
                          $(r.sessionStr).trigger(e)),
                        e.preventDefault()),
                      "IFRAME" == e.target.tagName && e.stopPropagation(),
                      $("content").scrollTop(o);
                  }
                  return (
                    !(r && r.contextMenu && r.contextMenu.handleKeyEvent(e)) &&
                    void 0
                  );
                }
              });
            var l,
              c,
              d,
              u = 0,
              h = function (e) {
                if (r.isIME && !isInputComponent(document.activeElement)) {
                  (r.useIMEKeyboard = !0),
                    e &&
                      ((u = -1),
                      setTimeout(function () {
                        u = 0;
                      }, 0));
                  var t,
                    n,
                    i,
                    o = r.getMarkElem();
                  o.length ||
                    ((t = r.selection.getRangy()),
                    (n = $(t.startContainer).closest("[cid]")),
                    (i = r.findNodeByElem(n)) && n.replaceWith(i.toHTML())),
                    (r.focusCid = o.attr("cid")),
                    r.brush.addToQueue(r.focusCid),
                    (r.isIME = 0),
                    setTimeout(function () {
                      r.brush.brushQueue();
                    }, 10),
                    r.undo.addSnap(r.focusCid, SnapFlag.ADD);
                }
              },
              p = function (e) {
                e && (u = -1),
                  isInputComponent(document.activeElement) ||
                    r.isIME ||
                    (r.selection.prepNode("", e, !1, !0), (r.isIME = 1));
              },
              f = function () {
                c &&
                  !0 !== c &&
                  (c[1]
                    ? (c[0].attr("contenteditable", c[1]),
                      c[2] && c[2].attr("contenteditable", c[3]))
                    : (c[0].removeAttr("contenteditable"),
                      c[2] && c[2].removeAttr("contenteditable")),
                  c[4] && r.selection.setRange(c[4])),
                  (c = !1),
                  d && clearTimeout(d),
                  (d = null);
              };
            function m(e) {
              d && clearTimeout(d), (e = e || r.findElemById(r.focusCid))[0];
              var t = e.attr("contenteditable"),
                n = r.selection.getRangy();
              (c = "false" !== t) &&
                (e.attr("contenteditable", "false"),
                (c = [e, t, null, null, n])),
                (d = setTimeout(f, 100));
            }
            $(r.sessionStr)
              .on("keydown", function (e) {
                (r.lastKeydownEvent = e.originalEvent), (r.keypressMsg = null);
                var t = e.keyCode || e.which,
                  n = isInputComponent(e.target);
                if (229 != t) {
                  if (
                    ("Tab" != keyNames[t] ||
                      e.ctrlKey ||
                      e.altKey ||
                      e.stopPropagation(),
                    r && r.contextMenu && r.contextMenu.handleKeyEvent(e))
                  )
                    return !1;
                  if (
                    r.autoComplete &&
                    !1 === r.autoComplete.handleKeyEvents(e)
                  )
                    return !1;
                  if (EditHelper.keyOnControl(keyNames[t], e, !0)) return !1;
                  if (document.body.classList.contains("megamenu-opened"))
                    "Esc" === keyNames[t] && File.megaMenu.hide();
                  else {
                    if (
                      ($(
                        ".dropdown-menu.open:not(#typora-sidebar), .dropdown-menu.show"
                      )
                        .removeClass("open")
                        .removeClass("show")
                        .find(".active")
                        .removeClass("active"),
                      $(".ty-tooltip").removeClass("shown"),
                      ("Ctrl" != keyNames[t] && "Command" != keyNames[t]) ||
                        s(!0),
                      Node.isType(keyNames[t], "Right", "Left", "Up", "Down"))
                    ) {
                      if (
                        ($(".context-menu:visible").length &&
                          r.contextmenu.handleArrowKey(keyNames[t]),
                        e.target.classList &&
                          e.target.classList.contains("ty-input") &&
                          !e.ctrlKey &&
                          !e.metaKey)
                      ) {
                        if (
                          ((d = r.selection.getRangy()),
                          "Left" == keyNames[t] &&
                            0 == d.startOffset &&
                            0 == d.endOffset)
                        )
                          return r.selection.moveUpOrDown(!0, e, !0), !1;
                        if (
                          "Right" == keyNames[t] &&
                          d.startOffset == d.endOffset &&
                          d.endOffset == e.target.textContent.length
                        )
                          return r.selection.moveUpOrDown(!1, e, !0), !1;
                      }
                      if (n && Node.isType(keyNames[t], "Right", "Left"))
                        return;
                      if (File.isLocked) return !0;
                      if (
                        (File.inBusyMode &&
                          e &&
                          (e.shiftKey || e.metaKey || e.ctrlK) &&
                          setAttributeOnlyNeeded(
                            r.writingArea,
                            "contenteditable",
                            "true"
                          ),
                        $(
                          (r.selection.getRangy() || {}).commonAncestorContainer
                        ).closest("table.md-table").length &&
                          !1 === r.tableEdit.keydownHandler(e))
                      )
                        return !1;
                      if (e.ctrlKey || e.metaKey) {
                        if (
                          File.isMac &&
                          e.metaKey &&
                          !e.ctrlKey &&
                          !e.altKey &&
                          ("Up" == keyNames[t] || "Down" == keyNames[t])
                        )
                          return (
                            "Up" == keyNames[t]
                              ? r.selection.jumpTop(e.shiftKey)
                              : r.selection.jumpBottom(e.shiftKey),
                            !1
                          );
                        if (
                          e.target.classList &&
                          e.target.classList.contains("md-def-name") &&
                          "Right" === keyNames[t]
                        )
                          return (
                            r.selection.jumpIntoElemEnd(
                              $(e.target).closest("[mdtype]")
                            ),
                            !1
                          );
                      }
                      if (File.isMac && e.metaKey) {
                        var i = {};
                        $.extend(i, e),
                          (i.type = "keyup"),
                          setTimeout(function () {
                            $(e.target).trigger(i);
                          }, 10);
                      }
                      e.shiftKey &&
                        ((r.needRemoveMathAfterSym = !0),
                        $(
                          ".md-focus .math-jax-postprocess>.md-math-after-sym"
                        ).text("​")),
                        "Right" == keyNames[t] || "Left" == keyNames[t]
                          ? ((r.lastCursor = r.selection.buildUndo()),
                            r.autoComplete.isShown() &&
                              r.brush.triggerAutoComplete(),
                            r.selection.moveLeftOrRight(
                              "Left" == keyNames[t],
                              e
                            ))
                          : ("Up" != keyNames[t] && "Down" != keyNames[t]) ||
                            ((r.lastCursor = r.selection.buildUndo()),
                            e.shiftKey
                              ? r.selection.unlockBlockUpOrDown(
                                  "Up" == keyNames[t],
                                  e
                                )
                              : r.selection.moveUpOrDown(
                                  "Up" == keyNames[t],
                                  e
                                ));
                    }
                    if (!n) {
                      if ("Esc" == keyNames[t]) {
                        if (
                          $("#table-insert-dialog:visible").modal("hide").length
                        )
                          return void $(File.editor.sessionStr).trigger(
                            "cursorChange"
                          );
                        r.brush.triggerAutoComplete(!0), e.preventDefault();
                      } else if ("Tab" == keyNames[t]) {
                        if (e.metaKey || e.ctrlKey || e.altKey) return;
                        if (
                          (e.preventDefault(),
                          !(e.shiftKey
                            ? UserOp.lessIndent(r)
                            : UserOp.moreIndent(r)))
                        )
                          if ((l = r.getMarkElem()).closest(".md-table").length)
                            r.tableEdit.moveToNextCell(
                              !0,
                              e.shiftKey,
                              void 0,
                              !0
                            );
                          else if (
                            l.hasClass("md-def-link") ||
                            l.hasClass("md-def-footnote")
                          ) {
                            var a = r
                              .getJQueryElem(window.getSelection().anchorNode)
                              .closest("span[contenteditable]");
                            e.shiftKey
                              ? r.selection.selectAllElem(
                                  $(
                                    a.prevAll("span[contenteditable='true']")[0]
                                  )
                                )
                              : r.selection.selectAllElem(
                                  $(
                                    a.nextAll("span[contenteditable='true']")[0]
                                  )
                                );
                          } else
                            e.shiftKey ||
                              (UserOp.pasteHandler(r, "\t", !0, !0, !0),
                              r.refocus(),
                              r.brush.addToQueue(r.focusCid));
                      } else if (
                        "Backspace" == keyNames[t] ||
                        "Delete" == keyNames[t]
                      ) {
                        if (File.bundle.isLocked)
                          return void e.preventDefault();
                        var l,
                          c = !0;
                        if (
                          e.shiftKey &&
                          File.isNode &&
                          !e.ctrlKey &&
                          "Delete" == keyNames[t]
                        )
                          return;
                        if (File.isNodeHtml)
                          e.ctrlKey && (r.selection.getRangy() || {}).collapsed
                            ? UserOp.backspaceHandler(r, e, keyNames[t])
                            : (c = UserOp.backspaceHandler(
                                r,
                                e,
                                keyNames[t],
                                !1,
                                !0
                              ));
                        else if (e.metaKey)
                          (l = r.getMarkElem(
                            window.getSelection().commonAncestorContainer
                          )).addClass("md-expand"),
                            window
                              .getSelection()
                              .modify("extend", "backward", "lineboundary"),
                            UserOp.backspaceHandler(r, e, keyNames[t]);
                        else
                          c = UserOp.backspaceHandler(
                            r,
                            e,
                            keyNames[t],
                            !1,
                            !0
                          );
                        null === c
                          ? (!1,
                            r.undo.addSnap(r.focusCid, SnapFlag.NONE),
                            r.brush.addToQueue(r.focusCid))
                          : e.preventDefault(),
                          e.stopPropagation(),
                          window.Reporter.fullValidate();
                      } else if (
                        "Enter" == keyNames[t] ||
                        (File.isMac &&
                          !e.shiftKey &&
                          !e.metaKey &&
                          e.ctrlKey &&
                          "O" == String.fromCharCode(t))
                      ) {
                        if (1 == $(".ty-focusable-btn.selected").length) {
                          var d;
                          if (
                            (d = r.selection.getRangy()).startContainer
                              .classList &&
                            d.startContainer.classList.contains(
                              "ty-focusable-btn"
                            )
                          )
                            return (
                              $(d.startContainer).trigger("btn-action"),
                              void e.preventDefault()
                            );
                          $(".ty-focusable-btn.selected").trigger("btn-action");
                        }
                        pressReturn.call(
                          r,
                          e.metaKey || e.ctrlKey,
                          e.shiftKey,
                          "O" == String.fromCharCode(t)
                        ),
                          e.preventDefault(),
                          e.stopPropagation();
                      }
                      o &&
                      t == this.lastKey &&
                      [224, 17, 91, 93].indexOf(t) > -1 &&
                      this.lastKeyTime &&
                      performance.now() - this.lastKeyTime < 300
                        ? (e.preventDefault(),
                          r.refocus(void 0, !0),
                          (this.lastKey = 0))
                        : ((this.lastKey = e.keyCode),
                          (this.lastKeyTime = performance.now())),
                        (o = !1);
                    }
                  }
                }
              })
              .on("keypress", function (e) {
                var t = e.keyCode || e.which;
                if (File.isLocked && e.charCode > 0)
                  return e.ctrlKey || e.metaKey;
                if (!isInputComponent(e.target) && !KeyMaster.isCommand(e))
                  if ("Enter" == keyNames[t]) e.preventDefault();
                  else if (e.charCode > 0) {
                    if (r.selection.getRangy()) {
                      String.fromCharCode(e.charCode);
                      var n = r.getMarkElem().attr("cid");
                      n != r.focusCid && r.refocus(n),
                        r.brush.addToQueue(r.focusCid);
                    }
                  }
              })
              .on("keyup", function (e) {
                o = !0;
                var t = e.keyCode || e.which;
                isInputComponent(e.target) ||
                  (("CTRL" != keyNames[t] && "Command" != keyNames[t]) || s(!1),
                  "Right" == keyNames[t] ||
                  "Left" == keyNames[t] ||
                  "Up" == keyNames[t] ||
                  "Down" == keyNames[t] ||
                  "Home" == keyNames[t] ||
                  "End" == keyNames[t] ||
                  "PageUp" == keyNames[t] ||
                  "PageDown" == keyNames[t]
                    ? !(a = e.shiftKey) && !r.isIME && !e.metaKey && r.refocus()
                    : a &&
                      "Shift" == keyNames[t] &&
                      ((a = !1), !r.isIME && !e.metaKey && r.refocus()),
                  "Enter" == keyNames[t] &&
                    (function () {
                      var t = $("#write .md-focus");
                      if (0 == t.length) {
                        var n = r.selection.getRangy();
                        if (!n) return;
                        (t = $(n.startContainer).closest("[cid]")),
                          (t = $("[cid='" + t.attr("cid") + "']"));
                      }
                      t.length > 1 &&
                      t.get(0).getAttribute("cid") ===
                        t.get(1).getAttribute("cid")
                        ? (t
                            .filter(function (e) {
                              return e > 0;
                            })
                            .remove(),
                          r.selection.jumpIntoElemEnd($(t.get(0))),
                          pressReturn.call(
                            r,
                            File.isMacOrMacNode ? e.metaKey : e.ctrlKey,
                            e.shiftKey
                          ))
                        : t.next("div:not('[mdtype]')").remove().length &&
                          pressReturn.call(
                            r,
                            File.isMacOrMacNode ? e.metaKey : e.ctrlKey,
                            e.shiftKey
                          );
                    })());
              })
              .on("compositionend", h)
              .on("compositionstart", p)
              .on("compositionupdate", function () {})
              .on("beforeinput", function (e) {
                if (
                  ((c = !1),
                  (i = !1),
                  (r.lastKeydownEvent = null),
                  !isInputComponent(e.target))
                ) {
                  r.focusCid || r.refocus(void 0, !1, !0);
                  var t = e.originalEvent && e.originalEvent.inputType;
                  if (
                    (e.originalEvent || (t = "deleteContentBackward"),
                    !t && null == e.originalEvent.data && r.isIME && File.isMac)
                  )
                    return (r.isIME = 0), void m();
                  if (
                    "deleteCompositionText" != t &&
                    "deleteByComposition" != t
                  ) {
                    if ("insertFromPaste" == t) {
                      var n = (e.originalEvent || {}).dataTransfer;
                      return (
                        File.isMac && n
                          ? n.getData
                            ? r.UserOp.pasteHandler(
                                r,
                                StringUtils.orDefault(
                                  n.getData("text/html") ||
                                    n.getData("text/plain"),
                                  e.originalEvent
                                )
                              )
                            : n.get
                            ? r.UserOp.pasteHandler(
                                r,
                                StringUtils.orDefault(
                                  n.get("text/html") || n.get("text/plain"),
                                  e.originalEvent
                                )
                              )
                            : r.UserOp.pasteHandler(r, e.originalEvent)
                          : r.UserOp.pasteHandler(r, e.originalEvent),
                        void m()
                      );
                    }
                    if ("insertFromDrop" == t)
                      r.UserOp.pasteHandler(r, e.originalEvent);
                    else if ("insertFromComposition" == t);
                    else if (/composition/i.exec(t || "")) {
                      if (/\n/.exec(e.originalEvent.data || ""))
                        return void m();
                      !(function () {
                        var e = $(".md-meta-block");
                        if (e.next().attr("cid") === r.focusCid) {
                          var t = e.attr("contenteditable");
                          (c = [e, t]),
                            e.attr("contenteditable", "false"),
                            (d = setTimeout(f, 100));
                        }
                      })(),
                        p(e);
                    } else if ("insertReplacementText" == t) {
                      var o =
                        e.originalEvent.dataTransfer.getData("text/plain") ||
                        "";
                      if (
                        (/[\n\r]/.exec(o) && h(o),
                        (u = e.originalEvent.getTargetRanges()[0]) &&
                          o.length &&
                          o[0] !== o[0].toLowerCase() &&
                          o.substr(1) == o.toLowerCase().substr(1))
                      ) {
                        if (
                          u.startContainer == u.endContainer &&
                          3 == u.startContainer.nodeType &&
                          u.startContainer.parentElement &&
                          u.endOffset - u.startOffset
                        ) {
                          if (
                            "SCRIPT" == u.startContainer.parentElement.tagName
                          )
                            return void m();
                          var a = u.startContainer.textContent.substr(
                              u.startOffset,
                              u.endOffset
                            ),
                            s = u.startContainer.textContent.substr(
                              0,
                              u.startOffset
                            );
                          if (!s.trim()) {
                            let e =
                                u.startContainer.parentElement.closest(
                                  "[mdtype]"
                                ),
                              t = r.selection.getOffset(e, u);
                            if (
                              e &&
                              ((s = $(e).rawText().substr(0, t).trim()),
                              /\$$/.exec(s))
                            ) {
                              if (a.replace(/\s*$/, "") == o.toLowerCase())
                                return void m();
                              h(o);
                            }
                          }
                        }
                      } else u && u.endOffset - u.startOffset < 2 && (i = !0);
                    } else if ("insertText" == t) {
                      ((u = e.originalEvent.getTargetRanges()[0]) &&
                        u.collapsed) ||
                        r.undo.endSnap(),
                        /[\r\n]/.exec(e.originalEvent.data || "")
                          ? h(e.originalEvent.data)
                          : (r.selection.prepNode(
                              e.originalEvent.data || "",
                              e
                            ),
                            r.focusCid &&
                              r.undo.addSnap(r.focusCid, SnapFlag.NONE));
                    } else if (/deleteContent/.exec(t)) {
                      var u;
                      if (
                        (u = r.selection.getRangy()) &&
                        !u.collapsed &&
                        u.commonAncestorContainer &&
                        u.commonAncestorContainer.querySelector &&
                        u.commonAncestorContainer.querySelector("[cid]")
                      )
                        return (
                          console.warn("detect deletion from IME"),
                          m($(u.commonAncestorContainer)),
                          void window.getSelection().removeAllRanges()
                        );
                    } else t && (e.preventDefault(), e.stopPropagation());
                  } else
                    !(function () {
                      if (
                        ((l =
                          "false" !==
                          r.writingArea.getAttribute("contenteditable")) &&
                          r.writingArea.setAttribute(
                            "contenteditable",
                            "false"
                          ),
                        r.focusCid)
                      ) {
                        var e = r.findElemById(r.focusCid);
                        if (
                          e.hasClass("md-def-link") ||
                          e.hasClass("md-def-footnote")
                        )
                          e.attr("contenteditable", "false");
                        else if (e.parent().is("th,td,li")) {
                          f();
                          var t = e.parent(),
                            n = t.attr("contenteditable");
                          (c = "false" !== n) &&
                            (t.attr("contenteditable", "false"),
                            t.is("th,td")
                              ? (t.parent().attr("contenteditable", "false"),
                                (c = [t, n, t.parent(), n]))
                              : (c = [t, n]),
                            (d = setTimeout(f, 100)));
                        }
                      }
                    })();
                }
                function h(t) {
                  var n = e.originalEvent.getTargetRanges()[0];
                  if (n) {
                    var i = rangy.createRange();
                    i.setStart(n.startContainer, n.startOffset),
                      i.setEnd(n.endContainer, n.endOffset),
                      r.selection.setRange(i, !0);
                  }
                  r.UserOp.pasteHandler(r, t, !0), m();
                }
              })
              .on("input", function (o) {
                if (((r.lastKeydownEvent = null), isInputComponent(o.target)))
                  f();
                else if (
                  (f(),
                  !(
                    (o && o.target && "VIDEO" == o.target.tagName) ||
                    "IMG" == o.target.tagName
                  ))
                ) {
                  l && r.writingArea.setAttribute("contenteditable", "true"),
                    r.selection.clearGlobalColumn();
                  var a = (o.originalEvent && o.originalEvent.inputType) || "";
                  o.originalEvent || (a = "deleteContentBackward");
                  var s = SnapFlag.NONE;
                  if ("insertReplacementText" == a) {
                    if (
                      (function (e) {
                        if (/[\n\r]/.exec(e || "")) return !0;
                      })(o.originalEvent.dataTransfer.getData("text/plain"))
                    )
                      return !1;
                    s = i ? SnapFlag.ADD : SnapFlag.REPLACE;
                  } else {
                    if ("deleteCompositionText" == a) return;
                    s =
                      /insert/.exec(a) || /composition/i.exec(a)
                        ? SnapFlag.ADD
                        : /deleteContent/.exec(a)
                        ? SnapFlag.DELETE
                        : SnapFlag.REPLACE;
                  }
                  if (((i = !1), r.focusCid)) {
                    var c = $(o.target).closest("[cid]"),
                      d = c.attr("cid");
                    d &&
                      r.focusCid != d &&
                      !c[0].querySelector("[cid='" + d + "']") &&
                      r.refocus(d, !1, !0);
                  } else r.refocus(void 0, !1, !0);
                  if (
                    "insertFromPaste" != a &&
                    "insertCompositionText" != a &&
                    (u > 0 || (r.isIME && "insertText" == a)
                      ? ((u = 0), h())
                      : r.brush.addToQueue(r.focusCid),
                    r.focusCid)
                  ) {
                    r.undo.addSnap(r.focusCid, s);
                    var p = /deleteContent/.exec(a);
                    p || r.UserOp.PunctuationOp.clearLastQuoteState(),
                      n && clearTimeout(n),
                      (n = setTimeout(function () {
                        r.selection.lockNativeScroll(),
                          File.isTypeWriterMode
                            ? r.selection.typeWriterScroll(null, 0)
                            : p || r.selection.scrollAdjust(),
                          (n = null);
                      }, (File.inBusyMode ? 200 : 20) * (File.isMac ? 10 : 1))),
                      r.wordCount.delimiter < WordCount.Delimiter.LINE &&
                        r.wordCount.quickUpdate(r.focusCid),
                      e && (clearTimeout(e), (e = null)),
                      t && r.focusCid != t && m(t),
                      (t = r.focusCid),
                      (e = setTimeout(function () {
                        m(t), (t = null), (e = null);
                      }, 200));
                  }
                }
                function m(e) {
                  r.syncChange([
                    { type: "sync", id: e, html: r.findElemById(e).html() },
                  ]);
                }
              })
              .on("drop", function (e) {
                var t = null;
                if (
                  (t =
                    (File.isWK &&
                      e.originalEvent.dataTransfer.getData("file")) ||
                    r.library.draggingItem)
                ) {
                  var n = document.caretRangeFromPoint(
                    e.originalEvent.x,
                    e.originalEvent.y
                  );
                  return (
                    n &&
                      n.startContainer &&
                      (r.writingArea == n.startContainer ||
                        r.writingArea.contains(n.startContainer)) &&
                      (r.selection.setRange(n),
                      r.refocus(),
                      "BODY" == document.activeElement.tagName &&
                        r.writingArea.focus()),
                    setTimeout(function () {
                      UserOp.insertFileLink(r, t);
                    }, 20),
                    r.library.clearDraggingItem(),
                    e.stopPropagation(),
                    void e.preventDefault()
                  );
                }
              })
              .on("dragover", function (e) {
                e.originalEvent.dataTransfer.types.indexOf("file") > -1 &&
                  (e.preventDefault(), e.stopPropagation());
              })
              .on("dragenter", function (e) {
                this == document.activeElement ||
                  this.contains(document.activeElement) ||
                  document.activeElement.contains(this) ||
                  (r.restoreLastCursor(),
                  e.preventDefault(),
                  e.stopPropagation());
              });
          }
          setCurLinkElem(e) {
            $curLinkElem = e;
          }
          getCurrentLinkHref() {
            var e = this.selection.getRangy().commonAncestorContainer;
            e.closest || (e = e.parentElement);
            var t = "";
            if (!(e = e.closest(".md-link, .md-def-link"))) return "";
            if (e.classList.contains("md-def-link"))
              t = (e = e.querySelector(".md-def-url")).innerText;
            else {
              var n = e.querySelector("a");
              if (
                ((t = n.getAttribute("href")),
                "reflink" == e.getAttribute("md-inline"))
              ) {
                var i = $.localize.getString(
                    "Need to define the reference link <b>[{0}]</b> with syntax <b>[{1}]: www.example.com</b>"
                  ),
                  r = n.dataset.ref;
                if (
                  void 0 ===
                  (t = this.nodeMap.link_list.getHrefByRef(r, !0, !0))
                )
                  return (
                    EditHelper.showNotification(i.format(r, r), !0),
                    !File.isLocked &&
                      this.docMenu.addEmptyDef(r, NodeDef.TYPE.def_link),
                    null
                  );
                if ("" === t)
                  return EditHelper.showNotification(i.format(r, r), !0), null;
              }
            }
            return t;
          }
          openCurrentLink() {
            var e = this.getCurrentLinkHref();
            null != e && this.tryOpenUrl(e, !0);
          }
          copyCurrentLink() {
            var e = this.getCurrentLinkHref();
            null != e && (0, this.UserOp.setClipboard)(null, void 0, e, !0);
          }
          tryOpenLink(e, t) {
            if ((t && (e = $curLinkElem), e.length)) {
              var n = e.attr("href"),
                i = $.localize.getString(
                  "Need to define the reference link <b>[{0}]</b> with syntax <b>[{1}]: www.example.com</b>"
                );
              if (
                (n || (n = e.attr("xlink:href")),
                this.undo.endSnap(!0),
                e.hasClass("md-footnote"))
              )
                return this.docMenu.jumpToFootnoteDef(e), !1;
              if (e.hasClass("reversefootnote"))
                return (
                  this.docMenu.jumpToFootnote(
                    e.closest(".md-def-footnote"),
                    e.attr("data-index") - 0
                  ),
                  !1
                );
              if (e.hasClass("md-def-url")) this.tryOpenUrl(e.text());
              else if (e[0].hasAttribute("data-ref")) {
                var r = e.data("ref");
                if (
                  void 0 ===
                  (n = this.nodeMap.link_list.getHrefByRef(r, !0, !0))
                )
                  return (
                    EditHelper.showNotification(i.format(r, r), !0),
                    !File.isLocked &&
                      this.docMenu.addEmptyDef(r, NodeDef.TYPE.def_link),
                    !1
                  );
                if ("" === n)
                  return EditHelper.showNotification(i.format(r, r), !0), !1;
              }
              n &&
                this.tryOpenUrl(
                  n,
                  e.closest("[md-inline='autolink'], [md-inline='url']").length
                );
            }
          }
          tryOpenUrl(e, t) {
            var n = (e = e.trim().replace(/(^<)|(>$)/g, ""));
            e = StringUtils.decodeFromEscapedPath(e);
            const i = File.option.useMirrorInCN ? "typoraio.cn" : "typora.io";
            function r(e, t) {
              if (
                ((e = e.replace(/^file:\/{0,2}/, "")),
                FileHelper.isSupportedFile(e, !0))
              )
                /\.txt/.exec(e)
                  ? JSBridge.invoke("shell.openItem", e)
                  : JSBridge.invoke("app.openFileOrFolder", e, {
                      forceCreateWindow: !0,
                      mountFolder: File.getMountFolder(),
                      anchor: t || "",
                    });
              else {
                var n = reqnode("path").extname(e);
                /\.(app|bat|bin|cmd|sh|command|csh|exe|gadget|inf|inx|ins|isu|jse|link|msi|msc|ksh|out|prg|reg|res|run|scp|vb.*|ws|wsf|wsh|ahk|jar|py|js)$/i.exec(
                  n
                )
                  ? JSBridge.showInFinder(e.replace(/^file:\/{0,2}/, ""))
                  : JSBridge.invoke("shell.openItem", e);
              }
            }
            function o() {
              if (File.isNode)
                if (/^file:/.exec(e)) r(e);
                else if (/^https?:/.exec(e)) JSBridge.showInBrowser(e);
                else
                  try {
                    JSBridge.showInBrowser(n);
                  } catch (e) {
                    console.warn(e);
                  }
              else
                File.isMac
                  ? bridge.callHandler(
                      "path.openURL",
                      /^https?:/.exec(n) ? n : e
                    )
                  : window.open(encodeURI(e));
            }
            if (e.match(/^#/)) {
              var a = EditHelper.findAnchorElem(e);
              a &&
                (this.selection.jumpIntoElemBegin(a),
                this.selection.scrollAdjust(a, 10));
            } else {
              if (StringUtils.isFullUrl(e)) return o();
              {
                var s = e.trim(),
                  l = (/(#[^./\//]+)$/.exec(s) || [])[0] || "";
                let a = (e = s.replace(/([#?][^./\//]+)$/, "")).replace(
                  /([#?][^/\//]+)$/,
                  ""
                );
                if (e != a) {
                  let t = (
                    (a.split(/[\/\\]/) || [""]).last().split(".") || [""]
                  ).last();
                  File.SupportedFiles.indexOf(t) > -1 &&
                    ((e = a), (l = (/(#[^/\//]+)$/.exec(s) || [])[0] || ""));
                }
                (function (e, t) {
                  return File.isMac
                    ? (function (e, t) {
                        return new Promise(function (n, i) {
                          bridge.callHandler(
                            "path.openFile",
                            {
                              url: e.replace(/\\/g, "/"),
                              relateToFolder: !0,
                              anchor: t || "",
                            },
                            function (e) {
                              e ? n() : i();
                            }
                          );
                        });
                      })(e, t)
                    : (function (e, t) {
                        var n = reqnode("fs-plus"),
                          i = StringUtils.ensureAbsolutePath(
                            File.bundle.filePath || File.bundle.originalPath,
                            e,
                            File.isTextBundle()
                          );
                        return i
                          ? n.existsSync(i)
                            ? (r(i, t), Promise.resolve())
                            : n.isFileSync(i + ".md")
                            ? (r(i + ".md", t), Promise.resolve())
                            : n.isFileSync(i + ".markdown")
                            ? (r(i + ".markdown", t), Promise.resolve())
                            : File.option.supportTextBundle &&
                              n.isFileSync(i + ".textbundle")
                            ? (r(i + ".textbundle", t), Promise.resolve())
                            : Promise.reject(i)
                          : Promise.reject(e);
                      })(e, t);
                })(e, l).then(
                  function () {},
                  function (a) {
                    if (t)
                      (e = /^[A-Za-z.+-]+:/.exec(n) ? n : "https://" + n), o();
                    else if (
                      !(function (e) {
                        var t,
                          n,
                          o = e;
                        function a(e, t) {
                          if (File.isNode) {
                            var n = reqnode("fs-extra");
                            (t ? n.ensureFile : n.ensureDir)(e, function (t) {
                              t ? alert(t.message) : r(e);
                            });
                          } else
                            bridge.callHandler(
                              t
                                ? "path.createFileAndOpen"
                                : "path.createFolderAndOpen",
                              e
                            );
                        }
                        if (
                          (o = StringUtils.ensureAbsolutePath(
                            File.bundle.filePath || File.bundle.originalPath,
                            e
                          )) &&
                          (function () {
                            if (
                              ((t = o
                                .replace(/#([^.\/\\]+)$/, "")
                                .replace(/\?([^.\/\\]+)$/, "")),
                              !(n = (
                                (/\.([^.\/\\]+)$/.exec(o) || "")[1] || ""
                              ).toLowerCase()))
                            ) {
                              let t = (e.split(/[\/\\]/) || [""])[0];
                              if (
                                t.indexOf(".") > 0 ||
                                (t.indexOf(":") > 0 &&
                                  File.isWin &&
                                  /^[A-Z]{1,2}:/.exec(t))
                              )
                                return !1;
                            }
                            return (
                              File.SupportedFiles.indexOf(n) > -1 &&
                              ((t = o), !0)
                            );
                          })()
                        )
                          return (
                            EditHelper.showNotification(
                              $.localize
                                .getString(
                                  "Cannot open location <code>$1</code>, would you want to create file at <code>$2</code> and continue?"
                                )
                                .replace("$2", StringUtils.escape(t))
                                .replace("$1", StringUtils.escape(e)) +
                                ` <a href='https://support.${i}/Links#faq' target="_blank" class='default-btn'>` +
                                $.localize.getString("Learn More…") +
                                "</a>",
                              !0,
                              n
                                ? [$.localize.getString("Create File", "Panel")]
                                : [
                                    $.localize.getString(
                                      "Create Folder",
                                      "Panel"
                                    ),
                                    $.localize.getString(
                                      "Create File",
                                      "Panel"
                                    ),
                                  ],
                              (e) => {
                                1 == e ? a(o + ".md", !0) : a(o, !!n);
                              }
                            ),
                            !0
                          );
                      })(e)
                    ) {
                      var s = "https://";
                      /^\S+@\S+\.\S+$/.exec(e) &&
                        !/[\\\/]/.exec(e) &&
                        (s = "mailto:"),
                        EditHelper.showNotification(
                          $.localize
                            .getString(
                              "Cannot open location <code>$1</code>, do you mean <a href='$3' target='_blank'>$2</a> ?"
                            )
                            .replace("$3", s + StringUtils.escapeForPreWrap(n))
                            .replace("$2", s + StringUtils.escape(n))
                            .replace("$1", StringUtils.escape(a || n)) +
                            `<a href='https://support.${i}/Links#faq' target='_blank' class='default-btn'>` +
                            $.localize.getString("Learn More…") +
                            "</a>",
                          !0
                        );
                    }
                  }
                );
              }
            }
          }
          _bindMouseEvents() {
            var e = this,
              t = !1,
              n = '.footnotes, [mdtype="table"], .md-task-list-item, .md-image';
            window.addEventListener("mouseup", function (t) {
              e.isMousePressed && 1 === t.which && e.brush.expandOnDelay(),
                (e.isMousePressed = !1);
            }),
              $(this.sessionStr)
                .on("mouseenter", ".md-htmlblock-container", function (t) {
                  if (1 == t.which && File.isNodeHtml) {
                    var n = e.selection.getRangy();
                    !n ||
                      this == n.commonAncestorContainer ||
                      this.contains(n.commonAncestorContainer) ||
                      n.commonAncestorContainer.contains(this) ||
                      this.parentElement.classList.contains(
                        "md-rawblock-on-edit"
                      ) ||
                      (-1 ==
                        n.comparePoint(
                          this.parentElement,
                          this.parentElement.childNodes.length
                        ) &&
                        (this.parentElement.setAttribute(
                          "contenteditable",
                          "true"
                        ),
                        n.setStartBefore(this),
                        n.select()));
                  }
                })
                .on("mouseenter", "[md-inline='reflink']", function () {
                  var t = this.querySelector("a"),
                    n = t.dataset.ref,
                    i = e.nodeMap.link_list.getNodeByRef(n),
                    r = (i && i.get("title")) || "";
                  t.setAttribute("title", r);
                })
                .on("mouseenter mouseover mouseleave", n, function (e) {
                  1 == e.which && $(this).attr("contenteditable", !0);
                })
                .on("mouseover mouseleave", ".td-span", function (e) {
                  1 == e.which &&
                    $(this)
                      .closest('[mdtype="table"]')
                      .attr("contenteditable", "true");
                })
                .on("mousedown", function (i) {
                  (t = !1), e.selection.clearGlobalColumn();
                  var r,
                    o = document.body.classList;
                  if (
                    ((o.contains("ty-show-word-count") ||
                      o.contains("ty-show-spell-check")) &&
                      (o.remove("ty-show-word-count"),
                      o.remove("ty-show-spell-check")),
                    File.isNode &&
                      o.contains("typora-fullscreen") &&
                      o.contains("native-window") &&
                      JSBridge.invoke("window.setMenuBarVisibility", !1),
                    "UL" == i.target.tagName)
                  )
                    if (
                      (r = e.getMarkElem(i.target)).attr("mdtype") == TYPE.list
                    ) {
                      var a = r.find("li").offset(),
                        s = a
                          ? document.caretRangeFromPoint(a.left + 1, i.clientY)
                          : null;
                      setTimeout(function () {
                        e.selection.setRange(s);
                      }, 10),
                        (r = s ? $(s.startContainer).closest("[cid]") : null);
                    } else r = null;
                  if (File.inBusyMode || r) {
                    (r = r || e.getMarkElem(i.target)),
                      (!i.shiftKey && r.length) ||
                        r.hasClass("md-focus") ||
                        (document
                          .querySelectorAll(".md-focus")
                          .forEach(function (e) {
                            e.classList.remove("md-focus");
                          }),
                        setAttributeOnlyNeeded(
                          e.writingArea,
                          "contenteditable",
                          "true"
                        ));
                    var l = r.attr("mdtype");
                    !r.length ||
                      Node.canContainBlock(l, !0) ||
                      Node.isType(
                        l,
                        TYPE.fences,
                        TYPE.hr,
                        TYPE.def_link,
                        TYPE.def_footnote,
                        TYPE.math_block
                      ) ||
                      (r.hasClass("md-focus") || r.addClass("md-focus"),
                      setAttributeOnlyNeeded(r[0], "contenteditable", "true"));
                  }
                  var c = $(i.target);
                  if (
                    (Node.isType(
                      c.attr("mdtype"),
                      TYPE.paragraph,
                      TYPE.heading
                    ) &&
                      c
                        .find(".math-jax-postprocess>.md-math-after-sym")
                        .last()
                        .text("​"),
                    $(
                      ".dropdown-menu.open:not(#typora-sidebar), .dropdown-menu.show"
                    )
                      .removeClass("open")
                      .removeClass("show")
                      .find(".active")
                      .removeClass("active"),
                    $(".ty-tooltip").removeClass("shown"),
                    $(n)
                      .filter(function () {
                        return (
                          (this == i.target || this.contains(i.target)) &&
                          "true" !== this.getAttribute("contenteditable")
                        );
                      })
                      .attr("contenteditable", "true"),
                    c.hasClass("md-def-footnote"))
                  )
                    setTimeout(function () {
                      var t = window.getSelection();
                      if (t) {
                        var n = $(t.focusNode).closest(
                          ".md-reverse-footnote-area"
                        );
                        if (n.length)
                          (i = e.selection.getRangy()).isBackward
                            ? i.setStart(n[0].previousSibling, 1)
                            : i.setEnd(n[0].previousSibling, 1),
                            t.anchorNode == self.focusNode && i.collapse(),
                            e.selection.deRange(i, !0);
                        else if (
                          t &&
                          t.isCollapsed &&
                          t.anchorOffset == t.anchorNode.length
                        ) {
                          var i = e.selection.getRangy();
                          e.selection.deRange(i, !0);
                        }
                      }
                    }, 0);
                  else {
                    if (
                      c.closest("a").length &&
                      !c.closest("img").length &&
                      (File.isMacOrMacNode ? i.metaKey : i.ctrlKey)
                    )
                      return i.stopPropagation(), i.preventDefault(), !1;
                    c.closest(".md-fences:not(.CodeMirror)").length;
                  }
                  (e.lastCursor = e.selection.buildUndo()),
                    (e.isMousePressed = 1 === i.which);
                })
                .on(
                  "click",
                  "[md-inline='link']>.md-content, .md-def-url",
                  function (t) {
                    if (t.ctrlKey || t.metaKey)
                      return (
                        JSBridge.putSetting("noHintForOpenLink", !0),
                        e.tryOpenUrl($(this).text()),
                        !1
                      );
                    EditHelper.showHintOrWarning({
                      key: "noHintForOpenLink",
                      title: $.localize.getString(
                        File.isMac
                          ? "You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition."
                          : "You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.",
                        "Front"
                      ),
                      checked: !0,
                    });
                  }
                )
                .on("mousemove", function (n) {
                  (t = !0),
                    1 == n.which &&
                      File.inBusyMode &&
                      e.selection.handleMouseSelection(n);
                })
                .on("mousedown", "mjx-container a", function (t) {
                  if (t.ctrlKey || t.metaKey)
                    return (
                      JSBridge.putSetting("noHintForOpenLink", !0),
                      e.tryOpenLink($(t.target).closest("a")),
                      !1
                    );
                  EditHelper.showHintOrWarning({
                    key: "noHintForOpenLink",
                    title: $.localize.getString(
                      File.isMac
                        ? "You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition."
                        : "You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.",
                      "Front"
                    ),
                    checked: !0,
                  });
                })
                .on("mousedown", function (t) {
                  if (3 == (t.originalEvent || t).detail)
                    return (
                      e.selection.fixTripleClick(t), void t.preventDefault()
                    );
                })
                .on("click", function (t) {
                  if (3 != (t.originalEvent || t).detail) {
                    var n,
                      i = e.getMarkElem(t.target);
                    if (
                      (e.library.outline.autoHideOutline(),
                      e.autoComplete.isShown() && e.brush.triggerAutoComplete(),
                      e.searchPanel.isOpen())
                    ) {
                      let t = e.selection.getRangy();
                      (n = t
                        ? t.nativeRange.getBoundingClientRect().top
                        : null),
                        e.searchPanel.closePanel(!0);
                    }
                    if (
                      "INPUT" !== t.target.tagName ||
                      "checkbox" !== t.target.getAttribute("type")
                    ) {
                      if (
                        isInputComponent(t.target) ||
                        (t.target.classList &&
                          t.target.classList.contains("code-tooltip"))
                      )
                        return (
                          t.preventDefault(), void $(t.target).trigger("focus")
                        );
                      if (
                        i.hasClass("md-fences") &&
                        e.fences.clickEventHandled.call(
                          e.fences,
                          t,
                          i.attr("cid")
                        )
                      )
                        return !1;
                      var r = $(t.target).closest("a, area, .md-footnote");
                      if (r.length) {
                        if (
                          (t.stopPropagation(),
                          t.preventDefault(),
                          r.closest(".md-toc").length)
                        )
                          return;
                        var o = File.isMacOrMacNode ? t.metaKey : t.ctrlKey;
                        if (
                          o ||
                          r.closest(
                            ".md-htmlblock-container, .md-reverse-footnote-area"
                          ).length
                        )
                          return (
                            e.tryOpenLink(r),
                            o && JSBridge.putSetting("noHintForOpenLink", !0),
                            !1
                          );
                        var a = $(t.target).closest(".md-image"),
                          s = a.closest('[md-inline="link"]');
                        (s.length ? s : a).addClass("md-expand"),
                          EditHelper.showHintOrWarning({
                            key: "noHintForOpenLink",
                            title: $.localize.getString(
                              File.isMac
                                ? "You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition."
                                : "You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.",
                              "Front"
                            ),
                            checked: !0,
                          });
                      }
                      var l = e.findNodeByElem(i);
                      Node.isType(
                        l,
                        NodeDef.TYPE.paragraph,
                        NodeDef.TYPE.heading
                      ) && $(".md-tooltip-remove").remove();
                      var c = e.selection.getRangy();
                      if (c && n) {
                        var d = document.querySelector("content"),
                          u = c.nativeRange.getBoundingClientRect().top;
                        u && (d.scrollTop = d.scrollTop + (u - n));
                      }
                      return c &&
                        c.commonAncestorContainer == e.writingArea &&
                        !c.collapsed
                        ? (t.stopPropagation(), !1)
                        : void 0;
                    }
                  }
                })
                .on("dblclick", function (t) {
                  e.selection.fixDblClick(t),
                    e.brush.expand(void 0, void 0, !0, !0);
                })
                .on("mouseup", function (i) {
                  if (
                    ((e.isMousePressed = !1),
                    (e.isIME = !1),
                    !File.isLocked &&
                      !isInputComponent(document.activeElement) &&
                      !isInputComponent(i.target))
                  ) {
                    $(n + ", .md-rawblock")
                      .filter(function () {
                        return (
                          !(this == i.target || this.contains(i.target)) &&
                          "false" != this.getAttribute("contenteditable")
                        );
                      })
                      .attr("contenteditable", "false");
                    var r = e.selection.getRangy();
                    r &&
                      !r.collapsed &&
                      Node.isType(
                        r.commonAncestorContainer.tagName,
                        "LI",
                        "UL",
                        "QUOTEBLOCK",
                        "ARTICLE"
                      ) &&
                      e.refocus(null);
                    var o = r ? r.commonAncestorContainer : i.target;
                    if (
                      (o == e.writingArea || e.writingArea.contains(o)) &&
                      !i.button
                    ) {
                      var a = e.getMarkElem(i.target),
                        s = a[0],
                        l =
                          s && !s.querySelector("[cid]")
                            ? s.getAttribute("cid")
                            : void 0;
                      if (a.closest(".md-fences:not(.CodeMirror)").length) {
                        var c = $("content").scrollTop();
                        e.fences.focus(s.getAttribute("cid")),
                          (r && r.collapsed) || $("content").scrollTop(c);
                      }
                      if (
                        !a.length &&
                        i.target == e.writingArea &&
                        (!t || !r || r.collapsed)
                      )
                        try {
                          var d = e.nodeMap.getLast(),
                            u = e.findElemById(d.cid);
                          if (i.pageY - u.offset().top - u.height() > 0) {
                            if (
                              !Node.isType(d, TYPE.paragraph, TYPE.heading) ||
                              d.get("text").length
                            ) {
                              var h = UndoManager.makeEmptyCommand(
                                  e.selection.buildUndo()
                                ),
                                p = e.selection.addUnholdable(d, h),
                                f = e.findElemById(p.cid);
                              e.undo.register(h),
                                e.selection.jumpIntoElemBegin(f),
                                (a = f);
                            } else
                              e.selection.jumpIntoElemEnd(
                                e.findElemById(d.getVeryFirst(!0).cid)
                              ),
                                (a = u);
                            a.length &&
                              File.inBusyMode &&
                              setAttributeOnlyNeeded(
                                e.writingArea,
                                "contenteditable",
                                "false"
                              ),
                              e.refocus(a.attr("cid")),
                              i.stopPropagation();
                          }
                        } catch (e) {}
                      try {
                        clearTimeout(clickTimer),
                          "BODY" == document.activeElement.tagName
                            ? ((clicks = 0),
                              e.writingArea.contains(i.target) && l && m())
                            : clicks < 2
                            ? ((clickTimer = setTimeout(function t() {
                                e.isMousePressed
                                  ? (clickTimer = setTimeout(t, DBCLICK_DELAY))
                                  : ((clicks = 0), m());
                              }, DBCLICK_DELAY)),
                              clicks++)
                            : ((clicks = 0), m()),
                          (function () {
                            e.undo.endSnap(!0);
                            var t = e.writingArea.querySelector(".unholdable");
                            if (t && t.getAttribute("cid") != e.focusCid)
                              if (t.textContent.length)
                                t.classList.remove("unholdable");
                              else {
                                var n = window.getSelection();
                                if (
                                  !n ||
                                  (n.anchorNode != t && n.extentNode != t)
                                ) {
                                  var i = UndoManager.makeEmptyCommand(
                                      e.selection.buildUndo()
                                    ),
                                    r = e.getNode(t.getAttribute("cid"));
                                  e.undo.UndoManager.addUndoForRemove(i, r),
                                    i.redo.push(e.selection.buildUndo()),
                                    r.remove(),
                                    t.remove(),
                                    e.undo.register(i);
                                } else t.classList.remove("unholdable");
                              }
                          })();
                      } catch (e) {
                        console.warn(e.stack);
                      }
                      File.isLocked ||
                        File._onInitParse ||
                        (File.inBusyMode
                          ? r &&
                            r.collapsed &&
                            setAttributeOnlyNeeded(
                              e.writingArea,
                              "contenteditable",
                              "false"
                            )
                          : setAttributeOnlyNeeded(
                              e.writingArea,
                              "contenteditable",
                              "true"
                            ));
                    }
                  }
                  function m() {
                    File.isTypeWriterMode && File.option.scrollWithCursor
                      ? e.selection.typeWriterScroll(null, null, function () {
                          e.refocus(l);
                        })
                      : e.refocus(l);
                  }
                }),
              $(document)
                .on("mouseup", function (t) {
                  isInputComponent(t.target) ||
                    "SELECT" == t.target.tagName ||
                    isInputComponent(document.activeElement) ||
                    (0 == $(t.target).closest("#write").length &&
                      (window.getSelection().toString().length && (clicks = 0),
                      File.isLocked ||
                        File.inBusyMode ||
                        setAttributeOnlyNeeded(
                          e.writingArea,
                          "contenteditable",
                          "true"
                        ),
                      fastdom.mutate(function () {
                        $(".md-tooltip-hide").hide();
                      })),
                    $(t.target).closest(".context-menu").length ||
                      (e.contextMenu && e.contextMenu.hide()));
                })
                .on("mousedown", "svg a", function (t) {
                  var n = this.getAttribute("href") || "";
                  if (
                    (/^(%20|\s)*(javascript|data)/im.exec(n) &&
                      this.setAttribute("href", ""),
                    t.ctrlKey || t.metaKey)
                  )
                    return (
                      $(t.target).closest(".md-diagram").length ||
                        (e.tryOpenLink($(t.target).closest("a")),
                        JSBridge.putSetting("noHintForOpenLink", !0)),
                      !1
                    );
                  EditHelper.showHintOrWarning({
                    key: "noHintForOpenLink",
                    title: $.localize.getString(
                      File.isMac
                        ? "You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition."
                        : "You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.",
                      "Front"
                    ),
                    checked: !0,
                  });
                })
                .on("click", ".md-f-tooltip", function (t) {
                  var n = $(t.target).closest("a");
                  if (n.length) return e.tryOpenLink(n), !1;
                });
            var i,
              r = function () {
                exitFocusModeTimer && clearTimeout(exitFocusModeTimer),
                  (exitFocusModeTimer = setTimeout(exitFocusMode.bind(e), 100));
              },
              o = document.querySelector("content");
            o.addEventListener(
              "wheel",
              function (t) {
                Math.abs(t.deltaY) < 4 ||
                  t.target.closest(".dropdown-menu") ||
                  e.lazyFireEvent_(o, "post-wheel", 500);
              },
              !!File.option.passiveEvents && { passive: !0 }
            ),
              o.addEventListener(
                "scroll",
                function (t) {
                  e.isMousePressed &&
                    File.isFocusMode &&
                    File.isTypeWriterMode &&
                    r(),
                    (e.lastScrolling = new Date().getTime()),
                    e.lazyFireEvent_(o, "post-scroll");
                },
                !!File.option.passiveEvents && { passive: !0 }
              ),
              o.addEventListener("mousedown", function (e) {
                i = e.target;
              }),
              o.addEventListener("click", function (t) {
                if (
                  (e.library &&
                    e.library.fileSearch &&
                    e.library.fileSearch.clearContentHighlight(),
                  t.target == o || t.target == e.writingArea)
                )
                  i == t.target && e.forceClick(t);
                else if (
                  t.target.hasAttribute &&
                  t.target.getAttribute("mdtype") == TYPE.paragraph
                ) {
                  if (i !== t.target) return void (i = null);
                  var n = e.selection.getRangy();
                  if (!n) return;
                  var r = t.target,
                    a = n.commonAncestorContainer;
                  if (
                    (a && a.classList && a.classList.contains("MathJax_SVG")) ||
                    (r != n.startContainer &&
                      r != n.endContainer &&
                      !r.contains(n.startContainer) &&
                      !r.contains(n.endContainer))
                  ) {
                    if (!r || !r.lastElementChild) return;
                    t.clientX >
                      r.lastElementChild.getBoundingClientRect().right &&
                      e.selection.jumpIntoElemEnd($(r));
                  }
                }
                i = null;
              }),
              $(o)
                .on("post-scroll", function () {
                  $(".auto-suggest-container.ty-show").removeClass("ty-show"),
                    e.autoComplete && e.autoComplete.postScroll();
                })
                .on("post-wheel", function () {
                  File.isFocusMode && File.isTypeWriterMode && r();
                });
          }
          isScrolling() {
            if (this.lastScrolling) {
              if (new Date().getTime() - this.lastScrolling < 60) return !0;
              this.lastScrolling = 0;
            }
            return !1;
          }
          forceClick(e) {
            function t(t, i) {
              i
                ? n.selection.jumpIntoElemEnd(t)
                : n.selection.jumpIntoElemBegin(t),
                e.preventDefault(),
                e.stopPropagation();
            }
            var n = this,
              i = n.selection.getRangy();
            if (i && i.startContainer) {
              if (n.writingArea.contains(i.commonAncestorContainer)) return;
              if (
                $(i.startContainer.parentElement).offset().top >
                e.clientY - 30
              )
                return;
            }
            File.isLocked ||
              setAttributeOnlyNeeded(n.writingArea, "contenteditable", "true");
            for (
              var r,
                o,
                a = window.innerHeight,
                s = document
                  .querySelector("#write > *")
                  .getBoundingClientRect(),
                l = e.pageX > s.right - 2,
                c = e.pageX < s.left + 2,
                d = (s.left + s.right) / 2,
                u = e.pageY;
              u < a;
              u += 20
            )
              if (
                ((o = (r = $(document.elementFromPoint(d, u)))
                  .closest("[mdtype]")
                  .addBack("[mdtype]")),
                !r.find("[mdtype]").length && o.length)
              )
                return (
                  t(o, l),
                  n.refocus(o.attr("cid")),
                  void (File.inBusyMode && o.focus())
                );
            for (u = e.pageY; u > 0; u -= 20)
              if (
                ((o = (r = $(document.elementFromPoint(d, u)))
                  .closest("[mdtype]")
                  .addBack("[mdtype]")),
                !r.find("[mdtype]").length && o.length)
              )
                return (
                  t(o, !c),
                  n.refocus(o.attr("cid")),
                  void (File.inBusyMode && o.focus())
                );
          }
          lazyFireEvent_(e, t, n) {
            var i = this.timerPool_,
              r = this.timerPool_[t];
            (n = n || 100),
              r && clearTimeout(r),
              (r = setTimeout(function () {
                $(e).trigger(t), (i[t] = null);
              }, 100));
          }
          onDropContent(e, t) {
            if (!File.isMac || !File.isActiveWindow())
              return (dropContents = null), !1;
            t && this.selection.setRange(t), UserOp.insertDom(e);
          }
          simpleParse(e, t) {
            var n = Node.isType(e, TYPE.paragraph);
            if (
              Node.isType(e, TYPE.raw_edit, TYPE.paragraph) &&
              /(^[<\u2013\u2014`~>#|\-+*1-9=\[])|\n\s*\S/gm.test(
                e.safeGetStrAttr("text")
              )
            ) {
              this.brush.pause();
              var i,
                r,
                o = this.undo.UndoManager.makeEmptyCommand();
              return (
                o.undo.push(this.selection.buildUndo()),
                o.undo.push(UndoManager.buildReplaceUndo(e)),
                (i = e.parseFrom(
                  t
                    ? { skips: { enableStartMatch: !0, enableRemap: !0 } }
                    : { skips: { enableRemap: !0 } }
                )),
                n && Node.isType(e, TYPE.paragraph) && 1 == i[1].length
                  ? (this.brush.restart(), null)
                  : (o.redo.push(this.undo.buildReplaceUndo(i[1][0])),
                    UndoManager.addUndoForInsertArray(o, i[1].slice(1)),
                    (r = i[0]),
                    this.brush.restart(),
                    [o, r, e.cid, i[1]])
              );
            }
          }
          findElemById(e) {
            return e
              ? $(this.writingArea.querySelector('[cid="' + e + '"]'))
              : $();
          }
          findNodeByElem(e) {
            return e.length ? this.getNode(e.attr("cid"), !1) : null;
          }
          insertText(e) {
            this.UserOp.pasteHandler(this, e, !0, !0, !0);
          }
          finishRawBlockEdit(e) {
            var t = null,
              n = (t = e
                ? $(e.target).closest(".md-rawblock")
                : $(document.activeElement).closest(".md-rawblock")).attr(
                "mdtype"
              );
            n == TYPE.html_block &&
              this.htmlBlock.stopEditing(t.attr("cid"), !0),
              n == TYPE.math_block &&
                this.mathBlock.stopEditing(t.attr("cid"), !0),
              $(".ty-tooltip").removeClass("shown");
          }
          warpContentWithOption(e) {
            return File.finalNewline && "\n" != e.substr(e.length - 1)
              ? e + (File.useCRLF ? "\r\n" : "\n")
              : e;
          }
          getMarkdown() {
            return this.sourceView.inSourceMode
              ? this.sourceView.cm.getValue()
              : this.warpContentWithOption(this.nodeMap.toMark());
          }
          getNode(e, t, n) {
            return (
              n
                ? (e = this.refocus())
                : t && !(e = e || this.focusCid) && (e = this.refocus()),
              this.nodeMap.allNodes.get(e)
            );
          }
          restoreLastCursor(e, t) {
            if ((e && e.preventDefault(), this.lastCursor)) {
              if (document.activeElement != this.writingArea) {
                var n = $("content").scrollTop();
                this.writingArea.focus(), $("content").scrollTop(n);
              }
              this.undo.exeCommand(this.lastCursor, t ? [] : void 0);
            }
          }
          toggleFocusMode() {
            (File.isFocusMode = !File.isFocusMode),
              JSBridge.putSetting("isFocusMode", File.isFocusMode),
              this.updateFocusMode(File.isFocusMode, !0, !0),
              File.isFocusMode ||
                document.body.classList.remove("ty-show-notification");
          }
          updateFocusMode(e, t, n) {
            e ? enterFocusMode.call(this) : exitFocusMode.call(this),
              t &&
                (File.isNode
                  ? window.ClientCommand.refreshViewMenu()
                  : File.isMac &&
                    JSBridge.menu.update("View→Focus Mode", {
                      state: File.isFocusMode,
                    })),
              e && n && EditHelper.showFocusModeWarning();
          }
          setTypeWriterMode(e, t, n) {
            if (File.isTypeWriterMode != e || t) {
              File.isTypeWriterMode = e;
              var i = this;
              e
                ? (document.body.classList.contains("ty-on-typewriter-mode") ||
                    document.body.classList.add("ty-on-typewriter-mode"),
                  setTimeout(function () {
                    var e =
                      (document.querySelector("content").clientHeight -
                        i.defaultTextHeight) /
                      2;
                    (document.querySelector("#write-style").innerHTML =
                      "#write { \npadding-top: $1px;\npadding-bottom: 0;\n}\n#write:after {\nheight: $2px;\n}"
                        .replace(/\$1/g, e - i.defaultTextHeight)
                        .replace(/\$2/g, e + i.defaultTextHeight)),
                      (i.sourceView && i.sourceView.inSourceMode) ||
                        i.selection.typeWriterScroll(null, null);
                  }, 100))
                : t ||
                  ((document.querySelector("#write-style").innerHTML = 0),
                  document.body.classList.remove("ty-on-typewriter-mode"),
                  i.selection.scrollAdjust()),
                i.sourceView && i.sourceView.enableTypeWriterMode(e),
                t ||
                  (File.isNode
                    ? window.ClientCommand.refreshViewMenu()
                    : File.isMac &&
                      JSBridge.menu.update("View→Typewriter Mode", {
                        state: File.isTypeWriterMode,
                      }));
            }
            e && n && EditHelper.showTypeWriterModeWarning();
          }
          toggleTypeWriterMode(e) {
            void 0 === e && (e = !File.isTypeWriterMode),
              this.setTypeWriterMode(e, !1, !0),
              JSBridge.putSetting("isTypeWriterMode", e),
              e || document.body.classList.remove("ty-show-notification");
          }
          syncFullContent() {
            var e = File.editor.sourceView.inSourceMode || !1;
            if (File.isMac) {
              if (File.isActiveWindow()) {
                var t = File.sync();
                bridge.callHandler("controller.syncFullContent", [!!e, t]);
              }
            } else
              File.isNode &&
                File.isActiveWindow() &&
                JSBridge.invoke("document.syncFullContent", e);
          }
          async applyFullContent(e, t) {
            if (!File.isActiveWindow()) {
              var n = t;
              if (
                (File.isNode &&
                  (n = await JSBridge.invoke("document.getContent")),
                void 0 === n)
              )
                return;
              this.undo.exeCommand(
                { type: "sync", content: n, fromSourceMode: e },
                void 0,
                !0
              ),
                this.refresh();
            }
          }
          syncChange(e) {
            function t(e, t) {
              return e.map(function (e) {
                return e ? ("fences" == e.type ? null : e) : null;
              }, t);
            }
            if (e)
              if (File.isMac)
                bridge.callHandler(
                  "document.syncChangeIfNeeded",
                  JSON.stringify(t(e, this)),
                  function (e) {
                    e && scheduleFullContentSync();
                  }
                );
              else if (File.isNode) {
                var n = reqnode("electron").ipcRenderer,
                  i = t(e, this) || [];
                i.length && n.send("doc.syncChange", JSON.stringify(i));
              }
          }
          applyChange(e) {
            try {
              if (!e || File.isActiveWindow()) return;
              var t = "string" == typeof e ? JSON.parse(e) : e,
                n = !1;
              window.debugMode &&
                (i = t[0]) &&
                ("sync" != i.type
                  ? i.type
                  : void 0 !== i.html ||
                    void 0 !== i.allHtml ||
                    void 0 !== i.cmChanges ||
                    void 0 !== i.tex ||
                    void 0 !== i.srcChanges ||
                    i.content),
                t.forEach(function (e) {
                  n = this.undo.exeCommand(e, void 0, !0) || n;
                }, this),
                n && this.refresh();
            } catch (e) {
              console.error(e);
            }
            var i;
          }
          startScrolling(e) {
            this.strollingBySelect = !0;
            var t = $("content"),
              n = t[0].scrollHeight - window.innerHeight,
              i = e ? 0 : n;
            t.stop(!0).animate(
              { scrollTop: i },
              (Math.abs(i - t.scrollTop()) / 256) * 1e3,
              "linear"
            );
          }
          stopScrolling() {
            this.strollingBySelect &&
              ($("content").stop(!0), (this.strollingBySelect = !1));
          }
        }
        var syncTimer,
          doSync = function () {
            editor.syncFullContent(), (syncTimer = null);
          },
          scheduleFullContentSync = function () {
            syncTimer && clearTimeout(syncTimer),
              (syncTimer = setTimeout(doSync, 500));
          };
        if (window.reqnode) {
          var ipc = reqnode("electron").ipcRenderer;
          ipc.on("scheduleFullContentSync", function () {
            scheduleFullContentSync();
          });
        }
        Editor.prototype.scheduleFullContentSync = scheduleFullContentSync;
        var pressReturn = function (e, t, n) {
            this.autoComplete && this.autoComplete.hide(),
              this.undo.endSnap(!0);
            var i = this.getMarkElem();
            this.brush.brushNode(i.attr("cid"));
            var r = (window.getSelection() || {}).focusNode;
            if (
              ((i = this.getMarkElem(r)),
              Node.isType(
                i.attr("mdtype"),
                NodeDef.TYPE.fences,
                NodeDef.TYPE.footnote
              ))
            )
              return !0;
            this.brush.pause(),
              (a = s =
                UserOp.backspaceHandler(this, null, "delSelection", !0, !1));
            var o,
              a,
              s,
              l = (i = this.getMarkElem()).closest(".md-table").length,
              c = l,
              d = this,
              u = i.attr("cid"),
              h = this.store(u),
              p = this.selection.buildUndo();
            if (
              (File.isTypeWriterMode && this.selection.lockNativeScroll(),
              (function (n) {
                if (i.attr("mdtype") == NodeDef.TYPE.meta_block)
                  try {
                    var r = n.selection.getRangy();
                    return !(
                      !e &&
                      !t &&
                      r.collapsed &&
                      r.endContainer.textContent.replace(/\n$/, "").length <=
                        r.endOffset &&
                      r.endContainer.textContent.match(/\n{2,}$/g)
                    );
                  } catch (e) {
                    return !0;
                  }
                return !1;
              })(this))
            )
              (a = a || UndoManager.makeEmptyCommand()).undo.push(p),
                UserOp.insertInlineText(
                  this,
                  null,
                  "\n",
                  this.selection.getOffset(i),
                  a,
                  !0
                ),
                this.undo.register(a),
                this.brush.addToQueue(u);
            else if (
              (function (e) {
                var t = e.getNode(u);
                if (
                  Node.isType(t, TYPE.def_link, TYPE.def_footnote) &&
                  Node.isEmptyBlock(t)
                )
                  return !0;
              })(this)
            )
              (a = this.UserOp.backToParagraph(d, this.getNode(u), !0, !1)),
                s && (a = UndoManager.append(s, a)),
                this.undo.register(a);
            else if (l)
              if (t) this.UserOp.pasteHandler(this, "<br />", !0);
              else if (e)
                (a = this.tableEdit.addRow(!1, s)),
                  s && ((a = UndoManager.append(s, a)), this.undo.register(a));
              else {
                for (; s && s.undo.length; ) this.undo.exeCommand(s.undo.pop());
                this.tableEdit.moveToBelowCell(!0);
              }
            else if (!c && h && (o = h.breakOn(e, this, t))) {
              var f = document.querySelector("content").scrollTop,
                m = this.findElemById(o.oldCid),
                g = $.parseHTML(o.newHtml);
              g.length ? (m.replaceWith(g), g) : m.remove();
              if (n) this.undo.exeCommand(p), o.command.redo.push(p);
              else {
                if (Node.isType(this.getNode(o.nextFocus), TYPE.math_block))
                  o.command.redo.push({
                    type: "fences-pos",
                    id: o.nextFocus,
                    pos: { line: 0, ch: 0 },
                  }),
                    o.nextFocus,
                    setTimeout(function () {
                      d.mathBlock.startEditing(o.nextFocus, "begin");
                    }, 0);
                else if (
                  Node.isType(this.getNode(o.nextFocus), TYPE.html_block)
                )
                  o.command.redo.push({
                    type: "fences-pos",
                    id: o.nextFocus,
                    pos: { line: 0, ch: 0 },
                  }),
                    setTimeout(function () {
                      d.htmlBlock.startEditing(o.nextFocus, "auto");
                    }, 0);
                else {
                  var v = this.findElemById(o.nextFocus);
                  o.cursor
                    ? (t && v.find(".md-emoji-control-ch").text(""),
                      this.undo.exeCommand(o.cursor),
                      t && v.find(".md-emoji-control-ch").text("​"))
                    : o.cursorDiff
                    ? this.selection.jumpInto(v, o.cursorDiff)
                    : this.selection.jumpIntoElemBegin(v),
                    o.command.redo.push(this.selection.buildUndo());
                }
                (this.focusCid = this.refocus(o.nextFocus, void 0, void 0, !0)),
                  this.findElemById(o.nextFocus).addClass("md-focus");
              }
              s && (o.command = UndoManager.append(s, o.command)),
                this.undo.register(o.command),
                this.quickRefresh(),
                (document.querySelector("content").scrollTop = f);
            }
            return (
              (!o || !o.nextFocus) && this.refocus(),
              this.brush.resume(),
              this.selection.scrollAdjust(),
              !0
            );
          },
          normalCleanTooltip_ = function () {
            $(".md-tooltip-remove").remove(),
              $(".md-focus").removeClass("md-focus"),
              $(".md-focus-container").removeClass("md-focus-container");
            var e = document.body.classList;
            (e.contains("ty-show-word-count") ||
              e.contains("ty-show-spell-check")) &&
              (e.remove("ty-show-word-count"), e.remove("ty-show-spell-check"));
          },
          viewInFocusMode = !1,
          exitFocusModeTimer,
          enterFocusMode = function () {
            exitFocusModeTimer && clearTimeout(exitFocusModeTimer),
              viewInFocusMode ||
                ((viewInFocusMode = !0),
                document.body.classList.add("on-focus-mode"),
                (exitFocusModeTimer = setTimeout(enterFocusMode, 100)));
          },
          exitFocusMode = function () {
            exitFocusModeTimer &&
              (clearTimeout(exitFocusModeTimer), (exitFocusModeTimer = null)),
              viewInFocusMode &&
                ((viewInFocusMode = !1),
                document.body.classList.remove("on-focus-mode"));
          };
        function performClick(e, t, n, i) {
          var r = document.createEvent("MouseEvents");
          r.initMouseEvent(
            "mousedown",
            !0,
            !0,
            t.ownerDocument.defaultView,
            1,
            e.screenX + n,
            e.screenY + i,
            e.clientX + n,
            e.clientY + i,
            e.ctrlKey,
            e.altKey,
            e.shiftKey,
            e.metaKey,
            e.button
          ),
            t.dispatchEvent(r);
        }
        module.exports = Editor;
      }
    ),
    $__System.registerDynamic(
      "4c",
      ["e", "b", "c", "d", "f", "10", "47", "45"],
      !0,
      function (e, t, n) {
        this || self;
        (window.$ = e("e")),
          (window.jQuery = window.$),
          (window.fastdom = e("b")),
          (window.fastdomPromised = e("c")),
          (fastdom = fastdom.extend(fastdomPromised)),
          fastdom.strict && fastdom.strict(!1),
          e("d"),
          e("f"),
          (window.NFile = window.File);
        var i = window._options.userLocale || "Base",
          r = (e("10"), e("47")),
          o = e("45");
        window._options && (i = _options.locale || _options.userLocale);
        var a = { language: i, pathPrefix: "locales" };
        if (
          (($.localize.localeOption = a),
          $("[data-lg='Front'], [data-after-content], [ty-hint]").localize(
            "Front",
            a
          ),
          window.reqnode &&
            window._options.sidebarTab &&
            window.innerWidth > 540)
        ) {
          var s = document.querySelector("#typora-sidebar");
          s.classList.add("open"),
            (s.style.transition = "0s"),
            document.body.classList.add("pin-outline"),
            _options.sidebarWidth &&
              document.documentElement.style.setProperty(
                "--sidebar-width",
                _options.sidebarWidth + "px"
              );
        }
        ($.fn.rawText = function (e) {
          return this.length ? this[0].rawText(e) : "";
        }),
          (window.setWritingContent = function (e, t) {
            for (; e.lastChild; ) e.removeChild(e.lastChild);
            var n = document.createElement("div");
            n.innerHTML = t;
            for (var i = document.createDocumentFragment(); n.firstChild; )
              i.appendChild(n.firstChild);
            e.appendChild(i);
          }),
          (window.File = r),
          (r.language = i),
          (init = function () {
            var e = new o("#write", r);
            !(function (e) {
              window.getMarkdown = function () {
                return e.getMarkdown();
              };
            })(e),
              (window.editor = e),
              setTimeout(function () {
                (document.querySelector("#typora-sidebar").style.transition =
                  ""),
                  $("[data-lg='Panel']").localize("Panel", a),
                  $("[data-lg='Menu']").localize("Menu", a);
              }, 20);
          }),
          (t.init = init),
          r.isNodeHtml || init();
      }
    ),
    $__System.registerDynamic(
      "4b",
      ["26", "13", "2c", "2f", "29", "11", "1b"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = "",
          r = e("26"),
          o = e("13"),
          a = o.Node,
          s = o.TYPE,
          l = e("2c"),
          c = e("2f"),
          d = e("29"),
          u = e("11"),
          h = ((r = e("26")), e("1b").SnapFlag, r.map);
        function p(e) {
          (e = e || ".context-menu"),
            $(e).removeClass("show").find(".active").removeClass("active"),
            $(".ty-tooltip").removeClass("shown");
        }
        function f(e) {
          p(), JSBridge.invoke("window.inspectElement", e.clientX, e.clientY);
        }
        var m,
          g,
          v = !1;
        function y() {
          v = !0;
          var e = _options.searchService || [
            ["Search with Google", "https://google.com/search?q=%s"],
          ];
          e.forEach(function (t, n) {
            var r = $(
              $.parseHTML(
                '<li data-group="search" data-key>\n<a role="menuitem">' +
                  u.escape($.localize.getString(t[0], "Menu")) +
                  "</a></li>"
              )[0]
            );
            0 === n
              ? ($("#search-service-placeholder")
                  .after('<li class="divider" data-group="search"></li>')
                  .replaceWith(r),
                r.attr("data-key", "search-default"),
                e.length > 2 &&
                  r.after(
                    '<li data-key="search-with" data-group="search" class="has-extra-menu">\n<a role="menuitem"><span>' +
                      $.localize.getString("Search With…") +
                      '</span><i class="fa fa-caret-right"></i></a></li>'
                  ))
              : 1 === n && 2 == e.length
              ? $("[data-key='search-default']").after(r)
              : $("#search-menu").append(r),
              r.click(function () {
                var e;
                (e = t[1]),
                  p(),
                  JSBridge.showInBrowser(
                    e.replace(/%s/, encodeURIComponent(i))
                  );
              });
          });
        }
        function b(e, t) {
          var n = $("[data-group='" + e + "']");
          t ? n.removeClass("hide") : n.addClass("hide");
        }
        function w() {
          return (
            File.editor &&
            File.editor.spellChecker &&
            File.editor.spellChecker.curSpellchecker
          );
        }
        function x(e, t) {
          if (File.editor.sourceView && File.editor.sourceView.inSourceMode) {
            var n = File.editor.sourceView.cm,
              i = n.getCursor("from"),
              r = n.getCursor("to");
            n.setSelection(i, r, { scroll: !1 }), n.focus();
          } else if (e) {
            if (t && 3 == m.endContainer.nodeType) {
              var o = m.endContainer.textContent;
              "." == o[m.endOffset] &&
                "." != o[m.endOffset - 1] &&
                m.setEnd(m.endContainer, m.endOffset + 1);
            }
            File.editor.selection.setRange(m);
          } else
            File.editor.lastCursor &&
              File.editor.undo.exeCommand(File.editor.lastCursor);
        }
        async function C() {
          if (File.isNode) {
            var e = await JSBridge.invoke("setting.getKeyBinding"),
              t = {
                "Delete Table": "Delete Block",
                "Paragraph (before)": "Insert Paragraph Before",
                "Paragraph (after)": "Insert Paragraph After",
                Table: "Insert Table",
                Image: "Insert Image",
              },
              n = { Backspace: "⌫" },
              i = function (e) {
                return e
                  .trim()
                  .split(/\s*\+\s*/g)
                  .map(function (e) {
                    return u.capitalize(
                      $.localize.getString(n[e] || e, "Menu")
                    );
                  })
                  .join("+");
              },
              r = function (n, i) {
                var r =
                  e[n] ||
                  e[i] ||
                  e[n.replace(/\.\.\.|…/, "")] ||
                  e[i.replace(/\.\.\.|…/, "")];
                return !r && t[n] && (r = e[t[n]]), r;
              };
            document
              .querySelectorAll("#context-menu .menu-style-btn")
              .forEach((e) => {
                var t = e.dataset.label,
                  n = $.localize.getString(t, "Menu"),
                  o = r(t, n) || e.dataset.keyStr;
                o
                  ? e.setAttribute("ty-hint", `${n}\t${i(o)}`)
                  : e.setAttribute("ty-hint", n);
              }),
              document.querySelectorAll(".ty-menu-shortcut").forEach((e) => {
                var t = "";
                if (e.classList.contains("ty-no-key-mod")) t = e.textContent;
                else {
                  var n = e.previousElementSibling;
                  if (n) {
                    var o = n.dataset.localize;
                    t = r(o, n.textContent) || e.textContent;
                  }
                }
                t && t.trim() && (e.textContent = i(t));
              });
          }
        }
        var F = function (e) {
            (this.sessionStr = e), $(k.bind(this));
          },
          S = function () {
            !!document.querySelector("#user-context-menu.show")
              ? this.showCustom(j, U)
              : p();
          },
          k = function () {
            $("content").on("post-wheel", S.bind(this)),
              $(window).on("resize", S.bind(this)),
              D.call(this),
              M.call(this),
              R.call(this),
              File.isMac ||
                (P.call(this),
                E.call(this),
                L.call(this),
                N.call(this),
                window.reqnode &&
                  (setTimeout(B.bind(this), 1e3), setTimeout(C, 1e3)));
          },
          E = function () {
            $("[data-style]").click(function () {
              p(),
                x(),
                File.editor.refocus(),
                File.editor.stylize.toggleStyle(
                  this.getAttribute("data-style")
                );
            });
          },
          T = function () {
            var e = File.editor.getMarkElem(),
              t = !1;
            e.closest("tbody").children().length
              ? ($("[data-key='delete_table_row']").removeClass("hide"),
                (t = !0))
              : $("[data-key='delete_table_row']").addClass("hide"),
              e.closest("tr").children().length >= 2
                ? ($("[data-key='delete_table_col']").removeClass("hide"),
                  (t = !0))
                : $("[data-key='delete_table_col']").addClass("hide"),
              t
                ? $("[data-key='delete_table_col']")
                    .next(".divider")
                    .removeClass("hide")
                : $("[data-key='delete_table_col']")
                    .next(".divider")
                    .addClass("hide");
          };
        F.prototype.updateTableVisibility = T;
        var _,
          A,
          M = function () {
            $("body")
              .on("mouseenter", ".context-menu [data-key]", function () {
                var e = $(this);
                e
                  .closest(".context-menu")
                  .find(".active")
                  .removeClass("active"),
                  e.addClass("active");
              })
              .on("mouseleave", ".context-menu", function (e) {
                $(this)
                  .find(".active:not(.has-extra-menu)")
                  .removeClass("active");
              }),
              $("#context-menu, #user-context-menu").on(
                "mouseenter",
                "[data-key]",
                function () {
                  var e = $(this);
                  "block-style" == e.attr("data-key")
                    ? (O("#block-style-menu", e), e.addClass("active"))
                    : (document
                        .querySelector("#block-style-menu")
                        .classList.remove("show"),
                      document
                        .querySelector("[data-key='block-style']")
                        .classList.remove("active")),
                    "insert" == e.attr("data-key")
                      ? (O("#insert-menu", e), e.addClass("active"))
                      : (document
                          .querySelector("#insert-menu")
                          .classList.remove("show"),
                        document
                          .querySelector("[data-key='insert']")
                          .classList.remove("active")),
                    "copy-as" == e.attr("data-key")
                      ? (O("#edit-menu", e), e.addClass("active"))
                      : (document
                          .querySelector("[data-key='copy-as']")
                          .classList.remove("active"),
                        document
                          .querySelector("#edit-menu")
                          .classList.remove("show")),
                    "zoom-img" == e.attr("data-key")
                      ? (O("#zoom-img-menu", e), e.addClass("active"))
                      : (document
                          .querySelector("[data-key='zoom-img']")
                          .classList.remove("active"),
                        document
                          .querySelector("#zoom-img-menu")
                          .classList.remove("show")),
                    "switch-img-syntax" == e.attr("data-key")
                      ? (O("#switch-img-syntax-menu", e), e.addClass("active"))
                      : (document
                          .querySelector("[data-key='switch-img-syntax']")
                          .classList.remove("active"),
                        document
                          .querySelector("#switch-img-syntax-menu")
                          .classList.remove("show")),
                    "search-with" == e.attr("data-key")
                      ? (O("#search-menu", e), e.addClass("active"))
                      : (document
                          .querySelector("#search-menu")
                          .classList.remove("show"),
                        $("[data-key='search-with']").removeClass("active")),
                    "table" == e.attr("data-key")
                      ? (T(), O("#table-menu", e), e.addClass("active"))
                      : (document
                          .querySelector("#table-menu")
                          .classList.remove("show"),
                        document
                          .querySelector("[data-key='table']")
                          .classList.remove("active"));
                }
              );
          },
          L = function () {
            $("#context-menu")
              .on("click", "[data-indent]", function () {
                var e = this.getAttribute("data-indent");
                p(),
                  x(),
                  File.editor.refocus(),
                  File.editor.stylize.toggleIndent(e);
              })
              .on("click", "[data-tab]", function () {
                p(), x(), File.editor.refocus();
                "left" == this.getAttribute("data-tab")
                  ? c.lessIndent(File.editor)
                  : c.moreIndent(File.editor);
              }),
              $("#block-style-menu").on("click", "[data-block]", function () {
                var e = this.getAttribute("data-block");
                p(),
                  x(),
                  File.editor.refocus(),
                  File.editor.stylize.changeBlock(e);
              }),
              $("#insert-menu")
                .on("click", "[data-insert]", function () {
                  var e = this.getAttribute("data-insert");
                  p(),
                    x(),
                    File.editor.refocus(),
                    e === s.table
                      ? File.editor.tableEdit.insertTable()
                      : e === s.meta_block
                      ? File.editor.stylize.insertMetaBlock()
                      : File.editor.stylize.insertBlock(e);
                })
                .on("click", "[data-insert-p]", function () {
                  var e = "before" == this.getAttribute("data-insert-p");
                  p(),
                    File.editor.refocus(_.attr("cid")),
                    File.editor.UserOp.insertParagraph(e, File.editor, _);
                });
          },
          N = function () {
            $("#edit-menu")
              .on("click", '[data-key="copy_as_mathml"]', function () {
                p(),
                  x(),
                  File.editor.styleBookmark.style.block.indexOf(s.math_block) >
                  -1
                    ? File.editor.mathBlock.copyAsMathML(_[0])
                    : File.editor.mathInline.copyAsMathML();
              })
              .on("click", '[data-key="copy_as_word"]', function () {
                p(),
                  x(),
                  File.editor.styleBookmark.style.block.indexOf(s.math_block) >
                  -1
                    ? File.editor.mathBlock.copyAsMathML(_[0], !0)
                    : File.editor.mathInline.copyAsMathML(!0);
              })
              .on("click", '[data-key="copy_as_math_tex"]', function () {
                p(),
                  x(),
                  File.editor.styleBookmark.style.block.indexOf(s.math_block) >
                  -1
                    ? File.editor.mathBlock.copyAsTex(_[0])
                    : File.editor.mathInline.copyAsTex();
              })
              .on("click", '[data-key="copy_as_math_image"]', function () {
                p(),
                  x(),
                  File.editor.styleBookmark.style.block.indexOf(s.math_block) >
                  -1
                    ? File.editor.mathBlock.copyAsImage(_[0])
                    : File.editor.mathInline.copyAsImage();
              }),
              File.isWin || $("#math-menu [menu-for-win]").addClass("hide");
          },
          D = function () {
            $("#table-menu")
              .on("click", '[data-key="insert_row_before"]', function () {
                p(), x(), File.editor.tableEdit.addRow(!0);
              })
              .on("click", '[data-key="insert_row_after"]', function () {
                p(), x(), File.editor.tableEdit.addRow(!1);
              })
              .on("click", '[data-key="delete_table_row"]', function () {
                p(), x(), File.editor.tableEdit.deleteRow(!1);
              })
              .on("click", '[data-key="insert_col_before"]', function () {
                p(), x(), File.editor.tableEdit.addCol(!0);
              })
              .on("click", '[data-key="insert_col_after"]', function () {
                p(), x(), File.editor.tableEdit.addCol(!1);
              })
              .on("click", '[data-key="delete_table_col"]', function () {
                p(), x(), File.editor.tableEdit.deleteCol();
              })
              .on("click", '[data-key="delete_table"]', function () {
                p(), x(), File.editor.tableEdit.deleteTable();
              })
              .on("click", '[data-key="copy_table"]', function () {
                p(), x(), File.editor.tableEdit.copyTable();
              })
              .on("click", '[data-key="reformat_table"]', function () {
                p(), x(), File.editor.tableEdit.reformatTable();
              })
              .on("click", '[data-key="move_row_up"]', function () {
                p(), x(), File.editor.tableEdit.moveRowUpOrDown(!0);
              })
              .on("click", '[data-key="move_row_down"]', function () {
                p(), x(), File.editor.tableEdit.moveRowUpOrDown(!1);
              })
              .on("click", '[data-key="move_col_left"]', function () {
                p(), x(), File.editor.tableEdit.moveColLeftOrRight(!0);
              })
              .on("click", '[data-key="move_col_right"]', function () {
                p(), x(), File.editor.tableEdit.moveColLeftOrRight(!1);
              });
          },
          B = function () {
            $("#context-menu")
              .on("click", "[data-key='learn']", function () {
                p(), x(), w().add(g);
              })
              .on("click", "[data-key='unlearn']", function () {
                p(), x(), w().remove(g);
              })
              .on("click", "[data-key='correct']", function (e) {
                p();
                var t = $(e.target).text();
                x(!0, !!/\.$/.exec(t)), c.pasteHandler(File.editor, t, !0);
              });
          },
          R = function () {
            $("#zoom-img-menu").on(
              "click",
              "[data-key='zoom-img-to-factor']",
              function () {
                p(),
                  x(),
                  File.editor.imgEdit.zoomAction(null, this.dataset.factor);
              }
            ),
              $("#switch-img-syntax-menu").on(
                "click",
                "[data-key='switch-img-syntax-markdown']",
                function () {
                  p(), x(), File.editor.imgEdit.switchPattern(null, !1);
                }
              ),
              $("#switch-img-syntax-menu").on(
                "click",
                "[data-key='switch-img-syntax-html']",
                function () {
                  p(), x(), File.editor.imgEdit.switchPattern(null, !0);
                }
              );
          },
          P = function () {
            $("#context-menu, #context-menu-for-source")
              .on("click", "[data-key='jumpto']", function () {
                p(), x();
                var e = File.editor.getJQueryElem(
                    window.getSelection().anchorNode
                  ),
                  t = e.closest("a");
                t.length || (t = e.closest("[md-inline]").find("a")),
                  File.editor.tryOpenLink(t);
              })
              .on("click", "[data-key='copy_link']", function () {
                p(), x(), File.editor.copyCurrentLink();
              })
              .on("click", "[data-key='dev-tool']", f)
              .on("click", "[data-key='edit']", function (e) {
                return (
                  p(),
                  x(),
                  File.editor.undo.prepCursorSnap(),
                  $(A).closest(".md-rawblock-container").trigger("startedit"),
                  File.editor.undo.endSnap(),
                  !1
                );
              })
              .on("click", "[data-key='cut']", function (e) {
                var t;
                p(),
                  x(),
                  ClientCommand.cut(),
                  document.activeElement &&
                    (t = document.activeElement.closest(".CodeMirror")) &&
                    setTimeout(function () {
                      t.CodeMirror.replaceSelection("", "start");
                    }, 30);
              })
              .on("click", "[data-key='backspace']", function (e) {
                p(), x(), File.delete();
              })
              .on("click", "[data-key='copy']", function (e) {
                p(),
                  _.find(".md-rawblock-container").focus().length || x(),
                  ClientCommand.copy();
              })
              .on("click", "[data-key='delete-block']", function (e) {
                p(),
                  x(),
                  _.length &&
                    (File.editor.refocus(_.attr("cid")),
                    File.editor.UserOp.deleteBlock(File.editor));
              })
              .on("click", "[data-key='paste']", function (e) {
                p(), x(), ClientCommand.paste();
              })
              .on("click", "[data-key='copy-emoji']", function (e) {
                p(), x();
                var t = $(".md-emoji.md-expand [data-emoji]").attr(
                  "data-emoji"
                );
                File.editor.UserOp.setClipboard("", "", t, !0);
              })
              .on("click", "[data-key='download-as']", function (e) {
                p(), x();
                var t = _.find(
                  ".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg"
                )[0];
                d.downloadAs(t || A.closest("svg, img, video"));
              })
              .on("click", "[data-key='copy-all-code']", function (e) {
                p(), x(), File.editor.fences.copyContent();
              })
              .on("click", "[data-key='format-all-code']", function (e) {
                p(),
                  File.editor.refocus(_.attr("cid")),
                  File.editor.fences.formatContent();
              })
              .on("click", "[data-key='format-selected-code']", function (e) {
                p(),
                  File.editor.refocus(_.attr("cid")),
                  File.editor.fences.formatContent(!0);
              }),
              $(".context-menu").on("mousedown", function (e) {
                if (!$(e.target).closest("a").length) return !1;
              }),
              File.isNode &&
                (File.option.debug
                  ? $("[data-group='dev-tool']").removeClass("hide")
                  : $("[data-group='dev-tool']").addClass("hide")),
              $("#edit-menu")
                .on("click", "[data-key='copy_as_image']", function (e) {
                  p(), x();
                  var t = _.find(
                    ".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg"
                  )[0];
                  d.copyImage(t || A.closest("svg, img, video"));
                })
                .on("click", "[data-key='copy_as_markdown']", function (e) {
                  p(), x(), ClientCommand.copyAsMarkdown();
                })
                .on("click", "[data-key='copy_as_html_source']", function (e) {
                  p(), x(), ClientCommand.copyAsHTMLSource();
                })
                .on("click", "[data-key='copy_as_simple_html']", function (e) {
                  p(), x(), ClientCommand.copyAsSemanticHTML();
                })
                .on("click", "[data-key='paste_as_plain']", function (e) {
                  p(), x(), ClientCommand.pasteAsPlain();
                }),
              $("[data-key='play']").click(function (e) {
                p();
                try {
                  $(A).closest("video")[0].play();
                } catch (e) {}
              }),
              $("[data-key='pause']").click(function (e) {
                p();
                try {
                  $(A).closest("video")[0].pause();
                } catch (e) {}
              });
          },
          I = function (e, t) {
            e.addClass("show");
            var n = e.width() + 20,
              i = e.height() + 48,
              r =
                t.clientX > window.innerWidth - n
                  ? window.innerWidth - n
                  : t.clientX,
              o =
                t.clientY > window.innerHeight - i
                  ? window.innerHeight - i
                  : t.clientY - $("#top-titlebar").height() + 8;
            e.css({ top: o + "px", left: r + "px" });
          };
        (F.prototype.show = function (e, t) {
          if (
            (!v && window.reqnode && y.call(this),
            (A = t || e.target) == document.querySelector("#write") &&
              (A = (window.getSelection() || {}).anchorNode || A),
            (_ = $(A).closest("[cid]")).hasClass("md-rawblock")
              ? File.editor.stylize.putBookmark(
                  null,
                  File.editor.stylize.buildBookmark(_)
                )
              : ($(File.editor.sessionStr).trigger("cursorChange"),
                (File.editor.lastCursor = File.editor.selection.buildUndo()),
                File.editor.stylize.putBookmark(
                  null,
                  File.editor.stylize.buildBookmark(_)
                )),
            $(".context-menu")
              .removeClass("show")
              .find(".active")
              .removeClass("active"),
            File.editor.sourceView.inSourceMode)
          )
            return I($("#context-menu-for-source"), e), !1;
          !(function () {
            try {
              var e = File.editor
                  .getJQueryElem(window.getSelection().anchorNode)
                  .closest("a, .md-link"),
                t = e.attr("href") || e.attr("data-ref");
              if (e.hasClass("md-link")) {
                var n = e.find("a");
                t = n.attr("href") || n.attr("data-ref");
              }
              b("hyperlink", t);
            } catch (e) {
              b("hyperlink", !1);
            }
          })();
          var n =
            (function (e) {
              var t = File.editor,
                n = t.styleBookmark.style,
                i = n.block[0],
                r = document.querySelector("#context-menu"),
                o = !1,
                c = !1,
                d = !1,
                h = !1,
                p = !1;
              b("inline-style", !n.cannotContainInline),
                $("[data-style]").removeClass("active"),
                n.inline.map(function (e) {
                  var t = document.querySelector("[data-style='" + e + "']");
                  t && t.classList.add("active"),
                    a.isType(e, s.inline_math) && (d = !0),
                    (a.isType(e, s.image) || a.isType(e, s.imgtag)) && (h = !0),
                    a.isType(e, s.emoji) && (p = !0),
                    a.isType(e, s.image) && (h = s.image),
                    a.isType(e, s.imgtag) && (h = s.imgtag);
                });
              let f = $(e),
                m = f.closest("[md-inline]").attr("md-inline");
              !h && a.isType(m, s.imgtag, s.image) && (h = m);
              let g = f.closest(".CodeMirror").length;
              h === s.image &&
                ($("[data-key='switch-img-syntax-markdown'] > a").addClass(
                  "state-on"
                ),
                $("[data-key='switch-img-syntax-html'] > a").removeClass(
                  "state-on"
                )),
                h === s.imgtag &&
                  ($("[data-key='switch-img-syntax-markdown'] > a").removeClass(
                    "state-on"
                  ),
                  $("[data-key='switch-img-syntax-html'] > a").addClass(
                    "state-on"
                  )),
                n.block.map(function (e) {
                  a.isType(e, s.blockquote, s.list_item, "ul", "ol") &&
                    (o = !0),
                    a.isType(e, s.table) && (c = !0),
                    a.isType(e, s.math_block) && (d = !0);
                });
              var v = $.localize.getString(l.CONST.StyleToNameMap[i], "Menu");
              if (
                (a.isType(i, s.html_block, s.math_block)
                  ? $("[data-key='block-style']").addClass("hide")
                  : ($("[data-key='block-style']").removeClass("hide"),
                    $("[data-key='block-style'] span").text(
                      v || $.localize.getString("Paragraph", "Menu")
                    )),
                i == s.paragraph)
              ) {
                var y = t.getNode(_.attr("cid"));
                !y ||
                  y.get("before") ||
                  y.get("after") ||
                  (y.get("parent") && (y = y.get("parent"))),
                  y &&
                    (v = $.localize.getString(
                      l.CONST.StyleToNameMap[y.get("type")],
                      "Menu"
                    ));
              }
              if (
                (!v || a.isType(i, s.paragraph, s.heading) || /header/.exec(i)
                  ? $("[data-group='delete-block']").addClass("hide")
                  : $("[data-key='delete-block']")
                      .children("a")
                      .text(
                        $.localize
                          .getString("Delete %@", "Menu")
                          .replace("%@", v || "")
                      )
                      .removeClass("hide"),
                $("#block-style-menu [data-block]")
                  .removeClass("state-on")
                  .filter("[data-block='" + i + "']")
                  .addClass("state-on"),
                n.block.length > 0 &&
                File.editor.stylize.CONST.NormalBlockMap[i]
                  ? ($("[data-block-auto-disable]").removeClass("disabled"),
                    $("[data-block-auto-hide]").removeClass("hide"))
                  : ($("[data-block-auto-disable]").addClass("disabled"),
                    $("[data-block-auto-hide]").addClass("hide")),
                (i != s.def_footnote && i != s.def_link) ||
                  ($("#insert-menu [data-block-auto-disable]").addClass(
                    "disabled"
                  ),
                  $("#insert-menu [data-block-auto-hide]").addClass("hide")),
                i == s.meta_block
                  ? $('[data-insert-p="before"]').parent().addClass("disabled")
                  : $('[data-insert="meta_block"]').removeClass("hide"),
                a.isType(i, s.html_block, s.math_block, s.meta_block)
                  ? $("[data-group='block-wrap']").addClass("hide")
                  : $("[data-group='block-wrap']").removeClass("hide"),
                o
                  ? r
                      .querySelector('[data-group="block-tab"]')
                      .classList.remove("hide")
                  : r
                      .querySelector('[data-group="block-tab"]')
                      .classList.add("hide"),
                g
                  ? ($("[data-group='code']").removeClass("hide"),
                    $("[data-group='inline-style']").addClass("hide"))
                  : ($("[data-group='code']").addClass("hide"),
                    $("[data-group='inline-style']").removeClass("hide")),
                c
                  ? ($('[data-group="table"]').removeClass("hide"),
                    r
                      .querySelector('[data-key="block-style"]')
                      .classList.add("hide"))
                  : ($('[data-group="table"]').addClass("hide"),
                    r
                      .querySelector('[data-key="block-style"]')
                      .classList.remove("hide")),
                p)
              ) {
                var w = $(".md-emoji.md-expand [data-emoji]").attr(
                  "data-emoji"
                );
                w &&
                  (r.querySelector('[data-key="copy-emoji"] a').textContent =
                    $.localize.getString("Copy '%@'", "Menu").replace("%@", w)),
                  $("#context-menu [data-group='emoji']").addClass(
                    w ? "show" : "hide"
                  );
              } else $("#context-menu [data-group='emoji']").addClass("hide");
              $("#context-menu [data-group='image']").addClass("hide"),
                h &&
                  (function () {
                    var e = $(".md-image.md-expand"),
                      t = e.find("img").attr("src") || "",
                      n = !e.hasClass("md-img-error");
                    if (!t) return;
                    const i = /^file:\/\//.exec(t);
                    if (
                      ([
                        "reveal-img-in-finder",
                        "delete-img-file",
                        "select-img-target-move",
                      ].forEach((e) => {
                        var t = r.querySelector(`[data-key="${e}"]`).classList;
                        i ? t.remove("hide") : t.add("hide");
                      }),
                      ["reveal-img-in-browser", "delete-img"].forEach((e) => {
                        var t = r.querySelector(`[data-key="${e}"]`).classList;
                        i ? t.add("hide") : t.remove("hide");
                      }),
                      r
                        .querySelector('[data-key="zoom-img"]')
                        .classList.remove("hide"),
                      r
                        .querySelector('[data-key="switch-img-syntax"]')
                        .classList.remove("hide"),
                      n && !File.isTextBundle())
                    ) {
                      r
                        .querySelector('[data-key="copy-img"]')
                        .classList.remove("hide"),
                        r
                          .querySelector('[data-key="upload-img"]')
                          .classList.remove("hide");
                      var o = File.editor.imgEdit.getTargetImageStorageFolder();
                      if (o && "upload" != o) {
                        var a = u.escapeURL(o);
                        if (-1 == t.replace(/^file:\/\//, "").indexOf(a)) {
                          var s = u.getFolder(o);
                          s &&
                            ($(r)
                              .find('[data-key="copy-img-to-target"] a')
                              .text(
                                $.localize
                                  .getString("Copy to %@", "Menu")
                                  .replace("%@", s)
                              ),
                            r
                              .querySelector('[data-key="copy-img-to-target"]')
                              .classList.remove("hide"));
                        }
                      }
                      r
                        .querySelector('[data-key="select-img-target"]')
                        .classList.remove("hide"),
                        r
                          .querySelector('[data-key="select-img-target-move"]')
                          .classList.remove("hide"),
                        $('.divider[data-group="image"]').removeClass("hide");
                    }
                  })(),
                n.textSelected
                  ? $(
                      "[data-key='copy'], [data-key='cut'], [data-copy-action], [data-key='backspace']"
                    ).removeClass("disabled")
                  : $(
                      "[data-key='copy'], [data-key='cut'], [data-copy-action], [data-key='backspace']"
                    ).addClass("disabled");
              var x = $(A).closest(".md-rawblock-container");
              return (
                x.length
                  ? ($("[data-group='copy-paste']").addClass("hide"),
                    $(
                      "[data-key='copy'], [data-group='edit-block']"
                    ).removeClass("hide"),
                    x.hasClass("md-htmlblock-container") &&
                      $("[data-key='copy']").addClass("hide"))
                  : ($("[data-group='copy-paste']").removeClass("hide"),
                    $("[data-group='edit-block']").addClass("hide")),
                A.closest &&
                A.closest(
                  ".md-diagram-panel, .md-math-container, .md-mathjax-preview"
                )
                  ? $("[data-group='adv-media']").removeClass("hide")
                  : $("[data-group='adv-media']").addClass("hide"),
                d
                  ? ($("[data-group='math']").removeClass("hide"),
                    $(
                      "[data-group='adv-media'].divider, [data-copy-action], [data-paste-action]"
                    ).addClass("hide"),
                    $("[data-key='copy-as']").removeClass("hide"))
                  : ($("[data-group='math']").addClass("hide"),
                    $("[data-copy-action], [data-paste-action]").removeClass(
                      "hide"
                    )),
                A.closest &&
                  A.closest(
                    "img, svg, video, .md-diagram-panel, .md-math-container, .md-mathjax-preview"
                  ) &&
                  $("[data-key='download-as']")
                    .removeClass("hide")
                    .find("[data-localize]")
                    .text(function () {
                      return $.localize
                        .getString(this.dataset.localize, "Menu")
                        .replace("%@", $.localize.getString("Image", "Menu"));
                    }),
                A.closest &&
                  A.closest(".md-diagram") &&
                  $("[data-key='download-as']")
                    .find("[data-localize]")
                    .text(function () {
                      return $.localize
                        .getString(this.dataset.localize, "Menu")
                        .replace("%@", $.localize.getString("Diagram", "Menu"));
                    }),
                d &&
                  $("[data-key='download-as'] [data-localize]").text(
                    function () {
                      return $.localize
                        .getString(this.dataset.localize, "Menu")
                        .replace("%@", $.localize.getString("Math", "Menu"));
                    }
                  ),
                $(A).closest("video").length
                  ? ($("[data-group='video']").removeClass("hide"),
                    $("[data-key='download-as'] [data-localize]").text(
                      function () {
                        return $.localize
                          .getString(this.dataset.localize, "Menu")
                          .replace("%@", $.localize.getString("Video", "Menu"));
                      }
                    ))
                  : $(A).closest("video").length &&
                    $("[data-group='video']").addClass("hide"),
                {
                  showIndent: o,
                  showTable: c,
                  showMath: d,
                  showImage: h,
                  showEmoji: p,
                }
              );
            })(A) || {};
          !(function (e) {
            if (e) b("search", !1);
            else {
              i = "";
              try {
                var t = editor.selection.getRangy();
                if (-1 == (i = t.toString()).indexOf("\n")) {
                  var n = t.toHtml();
                  (n = $("<div>" + t.toHtml() + "</div>")
                    .find(".md-meta")
                    .remove()
                    .end()
                    .text()).trim().length && (i = n);
                }
                b("search", i.trim().length > 0);
              } catch (e) {
                b("search", !1);
              }
            }
          })(n.showImage || n.showMath),
            window.reqnode &&
              (function (e) {
                if (((m = null), (g = ""), e)) b("spell-check", !1);
                else {
                  var t = w(),
                    n = $("#context-menu");
                  if (
                    ((m = File.editor.selection.getRangy()) &&
                      (File.editor.selection.selectWord(!1, !1, m, !0, !0),
                      (g = m.toString().trim())),
                    ";" == g && (g = ""),
                    (g = (g || "").replace(/[’]/g, "'")),
                    t && g.length)
                  )
                    if (
                      (function (e) {
                        let n = File.editor.spellChecker.getSpellCheckLang_();
                        return (
                          !(
                            File.isWin &&
                            "zh" == n &&
                            e &&
                            e.match(/\p{Script=Han}/u)
                          ) &&
                          !!t.isMisspelled(e) &&
                          (!(e.indexOf(".") > -1) || t.isMisspelled(e + "."))
                        );
                      })(g)
                    ) {
                      b("spell-check", !0),
                        n.find("[data-key='correct']").remove(),
                        n.find("[data-key='unlearn']").addClass("hide");
                      var i = t.getCorrectionsForMisspelling(g.trim());
                      0 == i.length
                        ? n.find("#divider-before-learn").addClass("hide")
                        : ((i = i.slice(0, 6)),
                          n
                            .find("#divider-before-learn")
                            .removeClass("hide")
                            .before(
                              i.reduce(function (e, t) {
                                return (e +=
                                  '<li data-group="spell-check" data-key="correct"><a role="menuitem">' +
                                  t +
                                  "</a></li>");
                              }, "")
                            ));
                    } else
                      t.isLearned(g)
                        ? (n.find("[data-key='correct']").remove(),
                          b("spell-check", !0),
                          n
                            .find("[data-key='learn'], #divider-before-learn")
                            .addClass("hide"),
                          n.find("[data-key='unlearn']").removeClass("hide"))
                        : b("spell-check", !1);
                  else b("spell-check", !1);
                }
              })(n.showImage || n.showMath),
            I($("#context-menu"), e),
            e.preventDefault(),
            e.stopPropagation();
        }),
          (F.prototype.hide = p);
        var O = function (e, t) {
          var n = t.width(),
            i = $(e).addClass("show"),
            r = i.width(),
            o = i.height() + 48,
            a = t.offset(),
            s = a.left,
            l = s + n,
            c = a.top - 30,
            d = l + r > window.innerWidth ? Math.max(0, s - r - 6) : l + 6,
            u = c + o > window.innerHeight ? window.innerHeight - o : c;
          return i.css({ top: u + "px", left: d + "px" }), !1;
        };
        F.prototype.showExtMenu = O;
        var H,
          U,
          j,
          q = function (e, t) {
            var n,
              i,
              r = $(e);
            if ("Enter" == t) {
              if (!r.hasClass("has-extra-menu")) {
                var o = r.find("a");
                return o.length ? o.trigger("click") : r.trigger("click"), !0;
              }
              t = "OpenSubmenu";
            }
            if ("Up" == t || "Down" == t) {
              if (
                (r.trigger("mouseleave"),
                (r = r.closest("li")),
                0 == (n = "Up" == t ? r.prev() : r.next()).length)
              ) {
                if (r.closest("#user-context-menu").length) return p(), !0;
                n =
                  "Up" == t
                    ? r.parent().children().last()
                    : r.parent().children().first();
              }
              return n.hasClass("hide") || n.hasClass("divider")
                ? q(n[0], t)
                : ((r = r.closest(".context-menu").find(".active")),
                  n.hasClass("has-btn-submenu")
                    ? ((i =
                        (r.prevAll("a").length /
                          (r.closest(".has-btn-submenu").find("a").length ||
                            1)) *
                        n.find("a").length),
                      (n = $(n.find("[data-key]")[Math.floor(i)])).trigger(
                        "mouseenter"
                      ),
                      !0)
                    : (r.removeClass("active"), n.addClass("active"), !0));
            }
            if (("Left" == t || "Right" == t) && "A" == r[0].tagName)
              return (
                r.trigger("mouseleave"),
                (n = "Left" == t ? r.prev() : r.next()).length ||
                  (n =
                    "Up" == t
                      ? r.parent().children().last("")
                      : r.parent().children().first()),
                n.trigger("mouseenter"),
                r.removeClass("active"),
                n.addClass("active"),
                !0
              );
            if ("Left" == t || "Esc" == t) {
              if ((r = r.closest(".context-menu")).hasClass("ext-context-menu"))
                return (
                  r.find(".active").removeClass("active"),
                  r.removeClass("show"),
                  !0
                );
              if ("Left" == t) return !0;
            }
            return "Right" == t || "OpenSubmenu" == t
              ? (r.hasClass("has-extra-menu") &&
                  (r.trigger("mouseenter"),
                  $(".ext-context-menu:visible [data-key]:visible")
                    .first()
                    .trigger("mouseenter")),
                !0)
              : void 0;
          };
        (F.prototype.handleKeyEvent = function (e) {
          var t = h[e.keyCode || e.which];
          if (
            a.isType(t, "Esc", "Right", "Left", "Up", "Down", "Return", "Enter")
          ) {
            var n,
              i = $(".context-menu:visible");
            return (
              !!i.length &&
              ("Esc" == t
                ? ($(".context-menu")
                    .removeClass("show")
                    .find(".active")
                    .removeClass("active"),
                  !0)
                : i.find(".active").length
                ? (n = $(".ext-context-menu .active")[0])
                  ? q(n, t)
                  : q($(".context-menu .active")[0], t)
                : "Up" == t
                ? (i.find("li[data-key]:visible").last().addClass("active"), !0)
                : "Down" == t
                ? (i.find("li[data-key]:visible").first().addClass("active"),
                  !0)
                : void 0)
            );
          }
        }),
          (F.prototype.getCustomFocuedElem = function () {
            return H.length ? H : null;
          }),
          (F.prototype.hideCustomMenu = function (e) {
            e == U &&
              $("#user-context-menu.show").length &&
              this.addClass("hide");
          }),
          (F.prototype.showCustom = function (e, t) {
            if (((H = null), window.getSelection().rangeCount)) {
              (U = t), (j = e);
              var n = $("#user-context-menu").html(
                e
                  .map(function (e) {
                    return e.key == F.SPLITER
                      ? '<li for-file class="divider"></li>'
                      : '<li data-key="' +
                          e.key +
                          '"' +
                          (e.hasExtraMenu ? ' class="has-extra-menu" ' : "") +
                          '><a role="menuitem"' +
                          (e.variable
                            ? " data-variable=" + JSON.stringify(e.variable)
                            : "") +
                          ">" +
                          $.localize
                            .getString(e.label, "Menu")
                            .replace("%@", e.variable || "") +
                          (e.hasExtraMenu
                            ? '<i class="fa fa-caret-right"></i>'
                            : "") +
                          "</a></li>";
                  })
                  .join("")
              );
              setTimeout(function () {
                var e = window.getSelection().getRangeAt(0),
                  t = e.getClientRects(),
                  i = t.length && t[t.length - 1];
                if (
                  ((!i || (0 == i.left && 0 == i.height)) &&
                    (e.selectNodeContents(e.commonAncestorContainer),
                    (i = (t = e.getClientRects()).length && t[t.length - 1])),
                  i && (0 != i.left || 0 != i.height))
                ) {
                  var r = $(e.commonAncestorContainer).closest("[cid]")[0],
                    o = (r && r.getBoundingClientRect().left) || 0;
                  n
                    .addClass("show")
                    .css({
                      top: i.bottom + "px",
                      left: Math.max(o, i.right - n.width() + 20) + "px",
                    }),
                    (H = $(e.commonAncestorContainer).closest("[md-inline]"));
                }
              }, 100);
            }
          }),
          (F.prototype.getContextTarget = function () {
            return A;
          }),
          (F.prototype.getMenuItemsForMac = function (e, t) {
            if (
              ((A = e),
              (_ = $(A).closest("[cid]")),
              e.closest &&
                !e.closest("body") &&
                e.closest(".CodeMirror-line") &&
                ((e = document.activeElement.closest(".CodeMirror")), (A = e)),
              !e)
            )
              return [];
            if (
              void (
                e.ownerDocument.defaultView != window &&
                (e = (function e(t) {
                  return t.parent == window
                    ? t.frameElement
                    : t && t.parent
                    ? e(t.parent)
                    : null;
                })(e.ownerDocument.defaultView))
              ) ||
              document.querySelector("#write").contains(e)
            )
              return (function () {
                var n = [],
                  i = ["normal"];
                try {
                  var r = editor.getMarkElem(e);
                  if (
                    a.isType(
                      document.activeElement.tagName,
                      "INPUT",
                      "TEXTAREA"
                    ) &&
                    !r.length
                  )
                    return ["input"];
                  r.length &&
                    !t &&
                    (r.hasClass("md-diagram") ||
                      File.editor.refocus(r.attr("cid")));
                  var o = editor.selection.getRangy(),
                    l = $(e).closest(".md-expand"),
                    c = r.attr("mdtype"),
                    d = null;
                  e.closest("img, svg") && (d = "download-image"),
                    e.closest("video") && (d = "download-video"),
                    r.attr("tabindex") &&
                      (n = [
                        "insertParagraphBefore",
                        "insertParagraphAfter",
                        "delete",
                      ]),
                    /^table/g.exec(c) &&
                      !File.isLocked &&
                      (n = [
                        "|",
                        "table",
                        "|",
                        "insertParagraphBefore",
                        "insertParagraphAfter",
                      ]),
                    a.isType(c, s.html_block) &&
                      (n = [
                        "|",
                        "edit",
                        "code-tools",
                        "|",
                        "insertParagraphBefore",
                        "insertParagraphAfter",
                        "delete",
                      ]),
                    a.isType(c, s.math_block) &&
                      ((d = null),
                      (n = [
                        "|",
                        "edit",
                        "copyMathBlock",
                        "download-math",
                        "code-tools",
                        "|",
                        "insertParagraphBefore",
                        "insertParagraphAfter",
                        "delete",
                      ])),
                    a.isType(c, s.fences) &&
                      (r.hasClass("md-diagram")
                        ? ((d = null),
                          (n = [
                            "|",
                            "edit",
                            "copy-as-image",
                            "download-diagram",
                            "code-tools",
                            "|",
                            "insertParagraphBefore",
                            "insertParagraphAfter",
                            "delete-fences",
                          ]))
                        : (n = [
                            "|",
                            "code-tools",
                            "|",
                            "insertParagraphBefore",
                            "insertParagraphAfter",
                            "delete-fences",
                          ]));
                  var u = $(e);
                  if ((i.push(d), r.hasClass("md-def-link"))) {
                    var h = $(o.commonAncestorContainer).closest(".md-def-url");
                    h.length &&
                      (File.editor.setCurLinkElem(h),
                      (i = ["openLink", "copyLink", "|", "normal", d]));
                  }
                  u.closest("a, .md-link").length &&
                    (File.editor.setCurLinkElem(
                      u.closest("a, .md-link").find("a").addBack("a")
                    ),
                    (i = ["openLink", "copyLink", "|", "normal", d])),
                    u.closest(".md-emoji").length &&
                      (i = [
                        "copyEmoji-" +
                          u
                            .closest(".md-emoji")
                            .find("[data-emoji]")
                            .attr("data-emoji"),
                        "|",
                      ].concat(i)),
                    o &&
                      $(o.commonAncestorContainer).closest(".md-inline-math")
                        .length &&
                      (i = ["copyMathInline", "|"].concat(i)),
                    a.isType(
                      l.hasClass("md-img-loaded") && l.attr("md-inline"),
                      s.refimg
                    ) &&
                      /^file:\/\//.exec(l.find("img").attr("src") || "") &&
                      (i = ["revealInFinder", "|"].concat(i)),
                    a.isType(
                      l.hasClass("md-img-loaded") && l.attr("md-inline"),
                      s.image,
                      s.imgtag
                    ) &&
                      (i = File.editor.imgEdit
                        .contextMenuItems(l.find("img")[0])
                        .concat("revealInFinder" == i[0] ? [] : ["|"])
                        .concat(i));
                } catch (e) {}
                return i.concat(n).filter((e) => null != e);
              })();
            if (
              File.editor.sourceView.inSourceMode &&
              document.querySelector("#typora-source").contains(e)
            )
              return ["input"];
            var n = File.editor.getJQueryElem(e),
              i = n.closest(
                ".file-library-node, .ty-search-item, #file-library-search, #outline-content"
              );
            if (i.hasClass("outline-content")) {
              var r = File.editor.library.outline,
                o = !document.body.classList.contains("no-collapse-outline");
              return r.isShown_
                ? ["highlight", "|", "filter-on"]
                : o
                ? [
                    "highlight",
                    "|",
                    "filter-off",
                    "|",
                    "expand-all",
                    "collapse-all",
                    "|",
                    "collapsible-outline-on",
                    "flat-outline-off",
                  ]
                : [
                    "highlight",
                    "|",
                    "filter-off",
                    "|",
                    "collapsible-outline-off",
                    "flat-outline-on",
                  ];
            }
            if (i.hasClass("ty-search-item")) return ["file-search"];
            if ("file-library-search" == i.attr("id"))
              return ["file-search-empty"];
            if (File.editor.library.useTreeStyle) {
              if (i.length)
                return i.attr("data-path") == File.getMountFolder()
                  ? [
                      `folder-root${
                        File.editor.library.isReadOnlyRoot() ? "-readonly" : ""
                      }`,
                    ]
                  : [
                      ("true" == i.attr("data-is-directory")
                        ? "folder"
                        : "file") +
                        (File.editor.library.isReadOnlyRoot()
                          ? "-readonly"
                          : ""),
                    ];
              if (File.getMountFolder() && n.closest("#file-library").length)
                return [
                  `folder-root${
                    File.editor.library.isReadOnlyRoot() ? "-readonly" : ""
                  }`,
                ];
            } else if (i.length)
              return [
                `file-list${
                  File.editor.library.isReadOnlyRoot() ? "-readonly" : ""
                }`,
              ];
            return [];
          }),
          (F.prototype.downloadAsAction = function () {
            var e = _.find(
              ".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg"
            )[0];
            d.downloadAs(e || A.closest("svg, img, video"));
          }),
          (F.prototype.copyAsImageAction = function () {
            var e = _.find(
              ".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg"
            )[0];
            d.copyImage(e || A.closest("svg, img, video"));
          }),
          (F.prototype.insertParagraphBefore = function () {
            File.editor.UserOp.insertParagraph(!0, void 0, _.closest("[cid]"));
          }),
          (F.prototype.insertParagraphAfter = function () {
            File.editor.UserOp.insertParagraph(!1, void 0, _.closest("[cid]"));
          }),
          (F.prototype.editActive = function () {
            File.editActive(A);
          }),
          (F.prototype.deleteActive = function () {
            File.deleteActive(A);
          }),
          (F.prototype.restoreLastCursor = x),
          (F.SPLITER = "divider"),
          (n.exports = F);
      }
    ),
    (function () {
      function e(t, n, i) {
        var r = e.resolve(t);
        if (null == r) {
          (i = i || t), (n = n || "root");
          var o = new Error('Failed to require "' + i + '" from "' + n + '"');
          throw ((o.path = i), (o.parent = n), (o.require = !0), o);
        }
        var a = e.modules[r];
        if (!a._resolving && !a.exports) {
          var s = { exports: {} };
          (s.client = s.component = !0),
            (a._resolving = !0),
            a.call(this, s.exports, e.relative(r), s),
            delete a._resolving,
            (a.exports = s.exports);
        }
        return a.exports;
      }
      (e.modules = {}),
        (e.aliases = {}),
        (e.resolve = function (t) {
          "/" === t.charAt(0) && (t = t.slice(1));
          for (
            var n = [
                t,
                t + ".js",
                t + ".json",
                t + "/index.js",
                t + "/index.json",
              ],
              i = 0;
            i < n.length;
            i++
          ) {
            t = n[i];
            if (e.modules.hasOwnProperty(t)) return t;
            if (e.aliases.hasOwnProperty(t)) return e.aliases[t];
          }
        }),
        (e.normalize = function (e, t) {
          var n = [];
          if ("." != t.charAt(0)) return t;
          (e = e.split("/")), (t = t.split("/"));
          for (var i = 0; i < t.length; ++i)
            ".." == t[i] ? e.pop() : "." != t[i] && "" != t[i] && n.push(t[i]);
          return e.concat(n).join("/");
        }),
        (e.register = function (t, n) {
          e.modules[t] = n;
        }),
        (e.alias = function (t, n) {
          if (!e.modules.hasOwnProperty(t))
            throw new Error('Failed to alias "' + t + '", it does not exist');
          e.aliases[n] = t;
        }),
        (e.relative = function (t) {
          var n = e.normalize(t, "..");
          function i(n) {
            return e(i.resolve(n), t, n);
          }
          return (
            (i.resolve = function (i) {
              var r = i.charAt(0);
              if ("/" == r) return i.slice(1);
              if ("." == r) return e.normalize(n, i);
              var o = t.split("/"),
                a =
                  (function (e, t) {
                    for (var n = e.length; n--; ) if (e[n] === t) return n;
                    return -1;
                  })(o, "deps") + 1;
              return (
                a || (a = 0), (i = o.slice(0, a + 1).join("/") + "/deps/" + i)
              );
            }),
            (i.exists = function (t) {
              return e.modules.hasOwnProperty(i.resolve(t));
            }),
            i
          );
        }),
        e.register("component-classes/index.js", function (e, t, n) {
          var i = t("indexof"),
            r = /\s+/,
            o = Object.prototype.toString;
          function a(e) {
            if (!e) throw new Error("A DOM element reference is required");
            (this.el = e), (this.list = e.classList);
          }
          (n.exports = function (e) {
            return new a(e);
          }),
            (a.prototype.add = function (e) {
              if (this.list) return this.list.add(e), this;
              var t = this.array();
              return (
                ~i(t, e) || t.push(e), (this.el.className = t.join(" ")), this
              );
            }),
            (a.prototype.remove = function (e) {
              if ("[object RegExp]" == o.call(e)) return this.removeMatching(e);
              if (this.list) return this.list.remove(e), this;
              var t = this.array(),
                n = i(t, e);
              return (
                ~n && t.splice(n, 1), (this.el.className = t.join(" ")), this
              );
            }),
            (a.prototype.removeMatching = function (e) {
              for (var t = this.array(), n = 0; n < t.length; n++)
                e.test(t[n]) && this.remove(t[n]);
              return this;
            }),
            (a.prototype.toggle = function (e, t) {
              return this.list
                ? (void 0 !== t
                    ? t !== this.list.toggle(e, t) && this.list.toggle(e)
                    : this.list.toggle(e),
                  this)
                : (void 0 !== t
                    ? t
                      ? this.add(e)
                      : this.remove(e)
                    : this.has(e)
                    ? this.remove(e)
                    : this.add(e),
                  this);
            }),
            (a.prototype.array = function () {
              var e = this.el.className.replace(/^\s+|\s+$/g, "").split(r);
              return "" === e[0] && e.shift(), e;
            }),
            (a.prototype.has = a.prototype.contains =
              function (e) {
                return this.list
                  ? this.list.contains(e)
                  : !!~i(this.array(), e);
              });
        }),
        e.register("segmentio-extend/index.js", function (e, t, n) {
          n.exports = function (e) {
            for (
              var t, n = Array.prototype.slice.call(arguments, 1), i = 0;
              (t = n[i]);
              i++
            )
              if (t) for (var r in t) e[r] = t[r];
            return e;
          };
        }),
        e.register("component-indexof/index.js", function (e, t, n) {
          n.exports = function (e, t) {
            if (e.indexOf) return e.indexOf(t);
            for (var n = 0; n < e.length; ++n) if (e[n] === t) return n;
            return -1;
          };
        }),
        e.register("component-event/index.js", function (e, t, n) {
          var i = window.addEventListener ? "addEventListener" : "attachEvent",
            r = window.removeEventListener
              ? "removeEventListener"
              : "detachEvent",
            o = "addEventListener" !== i ? "on" : "";
          (e.bind = function (e, t, n, r) {
            return e[i](o + t, n, r || !1), n;
          }),
            (e.unbind = function (e, t, n, i) {
              return e[r](o + t, n, i || !1), n;
            });
        }),
        e.register("timoxley-to-array/index.js", function (e, t, n) {
          n.exports = function (e) {
            if (void 0 === e) return [];
            if (null === e) return [null];
            if (e === window) return [window];
            if ("string" == typeof e) return [e];
            if (
              (function (e) {
                return "[object Array]" === Object.prototype.toString.call(e);
              })(e)
            )
              return e;
            if ("number" != typeof e.length) return [e];
            if ("function" == typeof e && e instanceof Function) return [e];
            for (var t = [], n = 0; n < e.length; n++)
              (Object.prototype.hasOwnProperty.call(e, n) || n in e) &&
                t.push(e[n]);
            return t.length ? t : [];
          };
        }),
        e.register("javve-events/index.js", function (e, t, n) {
          var i = t("event"),
            r = t("to-array");
          (e.bind = function (e, t, n, o) {
            e = r(e);
            for (var a = 0; a < e.length; a++) i.bind(e[a], t, n, o);
          }),
            (e.unbind = function (e, t, n, o) {
              e = r(e);
              for (var a = 0; a < e.length; a++) i.unbind(e[a], t, n, o);
            });
        }),
        e.register("javve-get-by-class/index.js", function (e, t, n) {
          n.exports = document.getElementsByClassName
            ? function (e, t, n) {
                return n
                  ? e.getElementsByClassName(t)[0]
                  : e.getElementsByClassName(t);
              }
            : document.querySelector
            ? function (e, t, n) {
                return (
                  (t = "." + t), n ? e.querySelector(t) : e.querySelectorAll(t)
                );
              }
            : function (e, t, n) {
                var i = [];
                null == e && (e = document);
                for (
                  var r = e.getElementsByTagName("*"),
                    o = r.length,
                    a = new RegExp("(^|\\s)" + t + "(\\s|$)"),
                    s = 0,
                    l = 0;
                  s < o;
                  s++
                )
                  if (a.test(r[s].className)) {
                    if (n) return r[s];
                    (i[l] = r[s]), l++;
                  }
                return i;
              };
        }),
        e.register("javve-get-attribute/index.js", function (e, t, n) {
          n.exports = function (e, t) {
            var n = (e.getAttribute && e.getAttribute(t)) || null;
            if (!n)
              for (var i = e.attributes.length, r = 0; r < i; r++)
                void 0 !== t[r] && t[r].nodeName === t && (n = t[r].nodeValue);
            return n;
          };
        }),
        e.register("javve-natural-sort/index.js", function (e, t, n) {
          n.exports = function (e, t, n) {
            var i,
              r,
              o = /(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,
              a = /(^[ ]*|[ ]*$)/g,
              s =
                /(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,
              l = /^0x[0-9a-f]+$/i,
              c = /^0/,
              d =
                ((n = n || {}),
                function (e) {
                  return (n.insensitive && ("" + e).toLowerCase()) || "" + e;
                }),
              u = d(e).replace(a, "") || "",
              h = d(t).replace(a, "") || "",
              p = u
                .replace(o, "\0$1\0")
                .replace(/\0$/, "")
                .replace(/^\0/, "")
                .split("\0"),
              f = h
                .replace(o, "\0$1\0")
                .replace(/\0$/, "")
                .replace(/^\0/, "")
                .split("\0"),
              m =
                parseInt(u.match(l)) ||
                (1 != p.length && u.match(s) && Date.parse(u)),
              g =
                parseInt(h.match(l)) ||
                (m && h.match(s) && Date.parse(h)) ||
                null,
              v = n.desc ? -1 : 1;
            if (g) {
              if (m < g) return -1 * v;
              if (m > g) return 1 * v;
            }
            for (var y = 0, b = Math.max(p.length, f.length); y < b; y++) {
              if (
                ((i =
                  (!(p[y] || "").match(c) && parseFloat(p[y])) || p[y] || 0),
                (r = (!(f[y] || "").match(c) && parseFloat(f[y])) || f[y] || 0),
                isNaN(i) !== isNaN(r))
              )
                return isNaN(i) ? 1 : -1;
              if ((typeof i != typeof r && ((i += ""), (r += "")), i < r))
                return -1 * v;
              if (i > r) return 1 * v;
            }
            return 0;
          };
        }),
        e.register("javve-to-string/index.js", function (e, t, n) {
          n.exports = function (e) {
            return (e = (e =
              null === (e = void 0 === e ? "" : e) ? "" : e).toString());
          };
        }),
        e.register("component-type/index.js", function (e, t, n) {
          var i = Object.prototype.toString;
          n.exports = function (e) {
            switch (i.call(e)) {
              case "[object Date]":
                return "date";
              case "[object RegExp]":
                return "regexp";
              case "[object Arguments]":
                return "arguments";
              case "[object Array]":
                return "array";
              case "[object Error]":
                return "error";
            }
            return null === e
              ? "null"
              : void 0 === e
              ? "undefined"
              : e != e
              ? "nan"
              : e && 1 === e.nodeType
              ? "element"
              : typeof e.valueOf();
          };
        }),
        e.register("list.js/index.js", function (e, t, n) {
          !(function (e, i) {
            "use strict";
            var r = e.document,
              o = t("get-by-class"),
              a = t("extend"),
              s = t("indexof"),
              l = function (e, n, i) {
                var c,
                  d = this,
                  u = t("./src/item")(d),
                  h = t("./src/add-async")(d),
                  p = t("./src/parse")(d);
                (c = {
                  start: function () {
                    (d.listClass = "list"),
                      (d.searchClass = "search"),
                      (d.sortClass = "sort"),
                      (d.page = 200),
                      (d.i = 1),
                      (d.items = []),
                      (d.visibleItems = []),
                      (d.matchingItems = []),
                      (d.searched = !1),
                      (d.filtered = !1),
                      (d.handlers = { updated: [] }),
                      (d.plugins = {}),
                      (d.helpers = { getByClass: o, extend: a, indexOf: s }),
                      a(d, n),
                      (d.listContainer =
                        "string" == typeof e ? r.getElementById(e) : e),
                      d.listContainer &&
                        ((d.list = o(d.listContainer, d.listClass, !0)),
                        (d.templater = t("./src/templater")(d)),
                        (d.search = t("./src/search")(d)),
                        (d.filter = t("./src/filter")(d)),
                        (d.sort = t("./src/sort")(d)),
                        this.items(),
                        d.update(),
                        this.plugins());
                  },
                  items: function () {
                    p(d.list), void 0 !== i && d.add(i);
                  },
                  plugins: function () {
                    for (var e = 0; e < d.plugins.length; e++) {
                      var t = d.plugins[e];
                      (d[t.name] = t), t.init(d, l);
                    }
                  },
                }),
                  (this.add = function (e, t) {
                    if (!t) {
                      var n = [],
                        i = !1;
                      void 0 === e[0] && (e = [e]);
                      for (var r = 0, o = e.length; r < o; r++) {
                        var a = null;
                        e[r] instanceof u
                          ? (a = e[r]).reload()
                          : ((i = d.items.length > d.page),
                            (a = new u(e[r], void 0, i))),
                          d.items.push(a),
                          n.push(a);
                      }
                      return d.update(), n;
                    }
                    h(e, t);
                  }),
                  (this.show = function (e, t) {
                    return (this.i = e), (this.page = t), d.update(), d;
                  }),
                  (this.remove = function (e, t, n) {
                    for (var i = 0, r = 0, o = d.items.length; r < o; r++)
                      d.items[r].values()[e] == t &&
                        (d.templater.remove(d.items[r], n),
                        d.items.splice(r, 1),
                        o--,
                        r--,
                        i++);
                    return d.update(), i;
                  }),
                  (this.get = function (e, t) {
                    for (var n = [], i = 0, r = d.items.length; i < r; i++) {
                      var o = d.items[i];
                      o.values()[e] == t && n.push(o);
                    }
                    return n;
                  }),
                  (this.size = function () {
                    return d.items.length;
                  }),
                  (this.clear = function () {
                    return d.templater.clear(), (d.items = []), d;
                  }),
                  (this.on = function (e, t) {
                    return d.handlers[e].push(t), d;
                  }),
                  (this.off = function (e, t) {
                    var n = d.handlers[e],
                      i = s(n, t);
                    return i > -1 && n.splice(i, 1), d;
                  }),
                  (this.trigger = function (e) {
                    for (var t = d.handlers[e].length; t--; )
                      d.handlers[e][t](d);
                    return d;
                  }),
                  (this.reset = {
                    filter: function () {
                      for (var e = d.items, t = e.length; t--; )
                        e[t].filtered = !1;
                      return d;
                    },
                    search: function () {
                      for (var e = d.items, t = e.length; t--; )
                        e[t].found = !1;
                      return d;
                    },
                  }),
                  (this.update = function () {
                    var e = d.items,
                      t = e.length;
                    (d.visibleItems = []),
                      (d.matchingItems = []),
                      d.templater.clear();
                    for (var n = 0; n < t; n++)
                      e[n].matching() &&
                      d.matchingItems.length + 1 >= d.i &&
                      d.visibleItems.length < d.page
                        ? (e[n].show(),
                          d.visibleItems.push(e[n]),
                          d.matchingItems.push(e[n]))
                        : e[n].matching()
                        ? (d.matchingItems.push(e[n]), e[n].hide())
                        : e[n].hide();
                    return d.trigger("updated"), d;
                  }),
                  c.start();
              };
            n.exports = l;
          })(window);
        }),
        e.register("list.js/src/search.js", function (e, t, n) {
          var i = t("events"),
            r = t("get-by-class"),
            o = t("to-string");
          n.exports = function (e) {
            var t,
              n,
              a,
              s,
              l = {
                resetList: function () {
                  (e.i = 1), e.templater.clear(), (s = void 0);
                },
                setOptions: function (e) {
                  2 == e.length && e[1] instanceof Array
                    ? (n = e[1])
                    : 2 == e.length && "function" == typeof e[1]
                    ? (s = e[1])
                    : 3 == e.length && ((n = e[1]), (s = e[2]));
                },
                setColumns: function () {
                  n = void 0 === n ? l.toArray(e.items[0].values()) : n;
                },
                setSearchString: function (e) {
                  (e = (e = o(e).toLowerCase()).replace(
                    /[-[\]{}()*+?.,\\^$|#]/g,
                    "\\$&"
                  )),
                    (a = e);
                },
                toArray: function (e) {
                  var t = [];
                  for (var n in e) t.push(n);
                  return t;
                },
              },
              c = {
                list: function () {
                  for (var t = 0, n = e.items.length; t < n; t++)
                    c.item(e.items[t]);
                },
                item: function (e) {
                  e.found = !1;
                  for (var t = 0, i = n.length; t < i; t++)
                    if (c.values(e.values(), n[t])) return void (e.found = !0);
                },
                values: function (e, n) {
                  return !!(
                    e.hasOwnProperty(n) &&
                    ((t = o(e[n]).toLowerCase()), "" !== a && t.search(a) > -1)
                  );
                },
                reset: function () {
                  e.reset.search(), (e.searched = !1);
                },
              },
              d = function (t) {
                return (
                  e.trigger("searchStart"),
                  l.resetList(),
                  l.setSearchString(t),
                  l.setOptions(arguments),
                  l.setColumns(),
                  "" === a
                    ? c.reset()
                    : ((e.searched = !0), s ? s(a, n) : c.list()),
                  e.update(),
                  e.trigger("searchComplete"),
                  e.visibleItems
                );
              };
            return (
              (e.handlers.searchStart = e.handlers.searchStart || []),
              (e.handlers.searchComplete = e.handlers.searchComplete || []),
              i.bind(r(e.listContainer, e.searchClass), "keyup", function (t) {
                var n = t.target || t.srcElement;
                ("" === n.value && !e.searched) || d(n.value);
              }),
              i.bind(r(e.listContainer, e.searchClass), "input", function (e) {
                "" === (e.target || e.srcElement).value && d("");
              }),
              (e.helpers.toString = o),
              d
            );
          };
        }),
        e.register("list.js/src/sort.js", function (e, t, n) {
          var i = t("natural-sort"),
            r = t("classes"),
            o = t("events"),
            a = t("get-by-class"),
            s = t("get-attribute");
          n.exports = function (e) {
            e.sortFunction =
              e.sortFunction ||
              function (e, t, n) {
                return (
                  (n.desc = "desc" == n.order),
                  i(e.values()[n.valueName], t.values()[n.valueName], n)
                );
              };
            var t = {
                els: void 0,
                clear: function () {
                  for (var e = 0, n = t.els.length; e < n; e++)
                    r(t.els[e]).remove("asc"), r(t.els[e]).remove("desc");
                },
                getOrder: function (e) {
                  var t = s(e, "data-order");
                  return "asc" == t || "desc" == t
                    ? t
                    : r(e).has("desc")
                    ? "asc"
                    : r(e).has("asc")
                    ? "desc"
                    : "asc";
                },
                getInSensitive: function (e, t) {
                  var n = s(e, "data-insensitive");
                  t.insensitive = "true" === n;
                },
                setOrder: function (e) {
                  for (var n = 0, i = t.els.length; n < i; n++) {
                    var o = t.els[n];
                    if (s(o, "data-sort") === e.valueName) {
                      var a = s(o, "data-order");
                      "asc" == a || "desc" == a
                        ? a == e.order && r(o).add(e.order)
                        : r(o).add(e.order);
                    }
                  }
                },
              },
              n = function () {
                e.trigger("sortStart"), (options = {});
                var n =
                  arguments[0].currentTarget ||
                  arguments[0].srcElement ||
                  void 0;
                n
                  ? ((options.valueName = s(n, "data-sort")),
                    t.getInSensitive(n, options),
                    (options.order = t.getOrder(n)))
                  : ((options = arguments[1] || options),
                    (options.valueName = arguments[0]),
                    (options.order = options.order || "asc"),
                    (options.insensitive =
                      void 0 === options.insensitive || options.insensitive)),
                  t.clear(),
                  t.setOrder(options),
                  (options.sortFunction =
                    options.sortFunction || e.sortFunction),
                  e.items.sort(function (e, t) {
                    return options.sortFunction(e, t, options);
                  }),
                  e.update(),
                  e.trigger("sortComplete");
              };
            return (
              (e.handlers.sortStart = e.handlers.sortStart || []),
              (e.handlers.sortComplete = e.handlers.sortComplete || []),
              (t.els = a(e.listContainer, e.sortClass)),
              o.bind(t.els, "click", n),
              e.on("searchStart", t.clear),
              e.on("filterStart", t.clear),
              (e.helpers.classes = r),
              (e.helpers.naturalSort = i),
              (e.helpers.events = o),
              (e.helpers.getAttribute = s),
              n
            );
          };
        }),
        e.register("list.js/src/item.js", function (e, t, n) {
          n.exports = function (e) {
            return function (t, n, i) {
              var r = this;
              (this._values = {}), (this.found = !1), (this.filtered = !1);
              (this.values = function (t, n) {
                if (void 0 === t) return r._values;
                for (var i in t) r._values[i] = t[i];
                !0 !== n && e.templater.set(r, r.values());
              }),
                (this.show = function () {
                  e.templater.show(r);
                }),
                (this.hide = function () {
                  e.templater.hide(r);
                }),
                (this.matching = function () {
                  return (
                    (e.filtered && e.searched && r.found && r.filtered) ||
                    (e.filtered && !e.searched && r.filtered) ||
                    (!e.filtered && e.searched && r.found) ||
                    (!e.filtered && !e.searched)
                  );
                }),
                (this.visible = function () {
                  return r.elm.parentNode == e.list;
                }),
                (function (t, n, i) {
                  if (void 0 === n) i ? r.values(t, i) : r.values(t);
                  else {
                    r.elm = n;
                    var o = e.templater.get(r, t);
                    r.values(o);
                  }
                })(t, n, i);
            };
          };
        }),
        e.register("list.js/src/templater.js", function (e, t, n) {
          var i = t("get-by-class");
          n.exports = function (e) {
            return new (function (e) {
              var t = (function (t) {
                  if (void 0 === t) {
                    for (
                      var n = e.list.childNodes, i = 0, r = n.length;
                      i < r;
                      i++
                    )
                      if (void 0 === n[i].data) return n[i];
                    return null;
                  }
                  if (-1 !== t.indexOf("<")) {
                    var o = document.createElement("div");
                    return (o.innerHTML = t), o.firstChild;
                  }
                  return document.getElementById(e.item);
                })(e.item),
                n = this;
              (this.get = function (e, t) {
                n.create(e);
                for (var r = {}, o = 0, a = t.length; o < a; o++) {
                  var s = i(e.elm, t[o], !0);
                  r[t[o]] = s ? s.innerHTML : "";
                }
                return r;
              }),
                (this.set = function (e, t) {
                  if (!n.create(e))
                    for (var r in t)
                      if (t.hasOwnProperty(r)) {
                        var o = i(e.elm, r, !0);
                        o &&
                          ("IMG" === o.tagName && "" !== t[r]
                            ? (o.src = t[r])
                            : (o.innerHTML = t[r]));
                      }
                }),
                (this.create = function (e) {
                  if (void 0 !== e.elm) return !1;
                  var i = t.cloneNode(!0);
                  return (
                    i.removeAttribute("id"),
                    (e.elm = i),
                    n.set(e, e.values()),
                    !0
                  );
                }),
                (this.remove = function (t) {
                  e.list.removeChild(t.elm);
                }),
                (this.show = function (t) {
                  n.create(t), e.list.appendChild(t.elm);
                }),
                (this.hide = function (t) {
                  void 0 !== t.elm &&
                    t.elm.parentNode === e.list &&
                    e.list.removeChild(t.elm);
                }),
                (this.clear = function () {
                  if (e.list.hasChildNodes())
                    for (; e.list.childNodes.length >= 1; )
                      e.list.removeChild(e.list.firstChild);
                });
            })(e);
          };
        }),
        e.register("list.js/src/filter.js", function (e, t, n) {
          n.exports = function (e) {
            return (
              (e.handlers.filterStart = e.handlers.filterStart || []),
              (e.handlers.filterComplete = e.handlers.filterComplete || []),
              function (t) {
                if (
                  (e.trigger("filterStart"),
                  (e.i = 1),
                  e.reset.filter(),
                  void 0 === t)
                )
                  e.filtered = !1;
                else {
                  e.filtered = !0;
                  for (var n = e.items, i = 0, r = n.length; i < r; i++) {
                    var o = n[i];
                    t(o) ? (o.filtered = !0) : (o.filtered = !1);
                  }
                }
                return e.update(), e.trigger("filterComplete"), e.visibleItems;
              }
            );
          };
        }),
        e.register("list.js/src/add-async.js", function (e, t, n) {
          n.exports = function (e) {
            return function (t, n, i) {
              var r = t.splice(0, 100);
              (i = (i = i || []).concat(e.add(r))),
                t.length > 0
                  ? setTimeout(function () {
                      addAsync(t, n, i);
                    }, 10)
                  : (e.update(), n(i));
            };
          };
        }),
        e.register("list.js/src/parse.js", function (e, t, n) {
          n.exports = function (e) {
            var n = t("./item")(e),
              i = function (t, i) {
                for (var r = 0, o = t.length; r < o; r++)
                  e.items.push(new n(i, t[r]));
              };
            return function () {
              var t = (function (e) {
                  for (
                    var t = e.childNodes, n = [], i = 0, r = t.length;
                    i < r;
                    i++
                  )
                    void 0 === t[i].data && n.push(t[i]);
                  return n;
                })(e.list),
                n = e.valueNames;
              e.indexAsync
                ? (function (t, n) {
                    var r = t.splice(0, 100);
                    i(r, n),
                      t.length > 0
                        ? setTimeout(function () {
                            init.items.indexAsync(t, n);
                          }, 10)
                        : e.update();
                  })(t, n)
                : i(t, n);
            };
          };
        }),
        e.alias("component-classes/index.js", "list.js/deps/classes/index.js"),
        e.alias("component-classes/index.js", "classes/index.js"),
        e.alias(
          "component-indexof/index.js",
          "component-classes/deps/indexof/index.js"
        ),
        e.alias("segmentio-extend/index.js", "list.js/deps/extend/index.js"),
        e.alias("segmentio-extend/index.js", "extend/index.js"),
        e.alias("component-indexof/index.js", "list.js/deps/indexof/index.js"),
        e.alias("component-indexof/index.js", "indexof/index.js"),
        e.alias("javve-events/index.js", "list.js/deps/events/index.js"),
        e.alias("javve-events/index.js", "events/index.js"),
        e.alias("component-event/index.js", "javve-events/deps/event/index.js"),
        e.alias(
          "timoxley-to-array/index.js",
          "javve-events/deps/to-array/index.js"
        ),
        e.alias(
          "javve-get-by-class/index.js",
          "list.js/deps/get-by-class/index.js"
        ),
        e.alias("javve-get-by-class/index.js", "get-by-class/index.js"),
        e.alias(
          "javve-get-attribute/index.js",
          "list.js/deps/get-attribute/index.js"
        ),
        e.alias("javve-get-attribute/index.js", "get-attribute/index.js"),
        e.alias(
          "javve-natural-sort/index.js",
          "list.js/deps/natural-sort/index.js"
        ),
        e.alias("javve-natural-sort/index.js", "natural-sort/index.js"),
        e.alias("javve-to-string/index.js", "list.js/deps/to-string/index.js"),
        e.alias("javve-to-string/index.js", "list.js/deps/to-string/index.js"),
        e.alias("javve-to-string/index.js", "to-string/index.js"),
        e.alias("javve-to-string/index.js", "javve-to-string/index.js"),
        e.alias("component-type/index.js", "list.js/deps/type/index.js"),
        e.alias("component-type/index.js", "type/index.js"),
        "object" == typeof exports
          ? (module.exports = e("list.js"))
          : $__System.registerDynamic("4d", [], !1, function (t, n, i) {
              return function () {
                return e("list.js");
              }.call(this);
            });
    })(),
    (function () {
      function e(t, n, i) {
        var r = e.resolve(t);
        if (null == r) {
          (i = i || t), (n = n || "root");
          var o = new Error('Failed to require "' + i + '" from "' + n + '"');
          throw ((o.path = i), (o.parent = n), (o.require = !0), o);
        }
        var a = e.modules[r];
        if (!a._resolving && !a.exports) {
          var s = { exports: {} };
          (s.client = s.component = !0),
            (a._resolving = !0),
            a.call(this, s.exports, e.relative(r), s),
            delete a._resolving,
            (a.exports = s.exports);
        }
        return a.exports;
      }
      (e.modules = {}),
        (e.aliases = {}),
        (e.resolve = function (t) {
          "/" === t.charAt(0) && (t = t.slice(1));
          for (
            var n = [
                t,
                t + ".js",
                t + ".json",
                t + "/index.js",
                t + "/index.json",
              ],
              i = 0;
            i < n.length;
            i++
          ) {
            t = n[i];
            if (e.modules.hasOwnProperty(t)) return t;
            if (e.aliases.hasOwnProperty(t)) return e.aliases[t];
          }
        }),
        (e.normalize = function (e, t) {
          var n = [];
          if ("." != t.charAt(0)) return t;
          (e = e.split("/")), (t = t.split("/"));
          for (var i = 0; i < t.length; ++i)
            ".." == t[i] ? e.pop() : "." != t[i] && "" != t[i] && n.push(t[i]);
          return e.concat(n).join("/");
        }),
        (e.register = function (t, n) {
          e.modules[t] = n;
        }),
        (e.alias = function (t, n) {
          if (!e.modules.hasOwnProperty(t))
            throw new Error('Failed to alias "' + t + '", it does not exist');
          e.aliases[n] = t;
        }),
        (e.relative = function (t) {
          function n(i) {
            return e(n.resolve(i), t, i);
          }
          var i = e.normalize(t, "..");
          return (
            (n.resolve = function (n) {
              var r = n.charAt(0);
              if ("/" == r) return n.slice(1);
              if ("." == r) return e.normalize(i, n);
              var o = t.split("/"),
                a =
                  (function (e, t) {
                    for (var n = e.length; n--; ) if (e[n] === t) return n;
                    return -1;
                  })(o, "deps") + 1;
              return a || (a = 0), o.slice(0, a + 1).join("/") + "/deps/" + n;
            }),
            (n.exists = function (t) {
              return e.modules.hasOwnProperty(n.resolve(t));
            }),
            n
          );
        }),
        e.register("component-indexof/index.js", function (e, t, n) {
          n.exports = function (e, t) {
            if (e.indexOf) return e.indexOf(t);
            for (var n = 0; n < e.length; ++n) if (e[n] === t) return n;
            return -1;
          };
        }),
        e.register("component-classes/index.js", function (e, t, n) {
          function i(e) {
            if (!e) throw new Error("A DOM element reference is required");
            (this.el = e), (this.list = e.classList);
          }
          var r = t("indexof"),
            o = /\s+/,
            a = Object.prototype.toString;
          (n.exports = function (e) {
            return new i(e);
          }),
            (i.prototype.add = function (e) {
              if (this.list) return this.list.add(e), this;
              var t = this.array();
              return (
                ~r(t, e) || t.push(e), (this.el.className = t.join(" ")), this
              );
            }),
            (i.prototype.remove = function (e) {
              if ("[object RegExp]" == a.call(e)) return this.removeMatching(e);
              if (this.list) return this.list.remove(e), this;
              var t = this.array(),
                n = r(t, e);
              return (
                ~n && t.splice(n, 1), (this.el.className = t.join(" ")), this
              );
            }),
            (i.prototype.removeMatching = function (e) {
              for (var t = this.array(), n = 0; n < t.length; n++)
                e.test(t[n]) && this.remove(t[n]);
              return this;
            }),
            (i.prototype.toggle = function (e) {
              return this.list
                ? (this.list.toggle(e), this)
                : (this.has(e) ? this.remove(e) : this.add(e), this);
            }),
            (i.prototype.array = function () {
              var e = this.el.className.replace(/^\s+|\s+$/g, "").split(o);
              return "" === e[0] && e.shift(), e;
            }),
            (i.prototype.has = i.prototype.contains =
              function (e) {
                return this.list
                  ? this.list.contains(e)
                  : !!~r(this.array(), e);
              });
        }),
        e.register("segmentio-extend/index.js", function (e, t, n) {
          n.exports = function (e) {
            for (
              var t, n = Array.prototype.slice.call(arguments, 1), i = 0;
              (t = n[i]);
              i++
            )
              if (t) for (var r in t) e[r] = t[r];
            return e;
          };
        }),
        e.register("component-event/index.js", function (e) {
          var t =
              void 0 !== window.addEventListener
                ? "addEventListener"
                : "attachEvent",
            n =
              void 0 !== window.removeEventListener
                ? "removeEventListener"
                : "detachEvent",
            i = "addEventListener" !== t ? "on" : "";
          (e.bind = function (e, n, r, o) {
            return e[t](i + n, r, o || !1), r;
          }),
            (e.unbind = function (e, t, r, o) {
              return e[n](i + t, r, o || !1), r;
            });
        }),
        e.register("component-type/index.js", function (e, t, n) {
          var i = Object.prototype.toString;
          n.exports = function (e) {
            switch (i.call(e)) {
              case "[object Function]":
                return "function";
              case "[object Date]":
                return "date";
              case "[object RegExp]":
                return "regexp";
              case "[object Arguments]":
                return "arguments";
              case "[object Array]":
                return "array";
              case "[object String]":
                return "string";
            }
            return null === e
              ? "null"
              : void 0 === e
              ? "undefined"
              : e && 1 === e.nodeType
              ? "element"
              : e === Object(e)
              ? "object"
              : typeof e;
          };
        }),
        e.register("timoxley-is-collection/index.js", function (e, t, n) {
          var i = t("type");
          n.exports = function (e) {
            var t = i(e);
            if ("array" === t) return 1;
            switch (t) {
              case "arguments":
                return 2;
              case "object":
                if (
                  (function (e) {
                    return (
                      "object" == typeof e &&
                      /^\[object (NodeList)\]$/.test(
                        Object.prototype.toString.call(e)
                      ) &&
                      e.hasOwnProperty("length") &&
                      (0 == e.length ||
                        ("object" == typeof e[0] && e[0].nodeType > 0))
                    );
                  })(e)
                )
                  return 2;
                try {
                  if (
                    "length" in e &&
                    !e.tagName &&
                    (!e.scrollTo || !e.document) &&
                    !e.apply
                  )
                    return 2;
                } catch (e) {}
              default:
                return 0;
            }
          };
        }),
        e.register("javve-events/index.js", function (e, t) {
          var n = t("event"),
            i = t("is-collection");
          (e.bind = function (e, t, r, o) {
            if (i(e)) {
              if (e && void 0 !== e[0])
                for (var a = 0; a < e.length; a++) n.bind(e[a], t, r, o);
            } else n.bind(e, t, r, o);
          }),
            (e.unbind = function (e, t, r, o) {
              if (i(e)) {
                if (e && void 0 !== e[0])
                  for (var a = 0; a < e.length; a++) n.unbind(e[a], t, r, o);
              } else n.unbind(e, t, r, o);
            });
        }),
        e.register("javve-get-by-class/index.js", function (e, t, n) {
          n.exports = document.getElementsByClassName
            ? function (e, t, n) {
                return n
                  ? e.getElementsByClassName(t)[0]
                  : e.getElementsByClassName(t);
              }
            : document.querySelector
            ? function (e, t, n) {
                return n ? e.querySelector(t) : e.querySelectorAll(t);
              }
            : function (e, t, n) {
                var i = [];
                null == e && (e = document);
                for (
                  var r = e.getElementsByTagName("*"),
                    o = r.length,
                    a = new RegExp("(^|\\s)" + t + "(\\s|$)"),
                    s = 0,
                    l = 0;
                  o > s;
                  s++
                )
                  if (a.test(r[s].className)) {
                    if (n) return r[s];
                    (i[l] = r[s]), l++;
                  }
                return i;
              };
        }),
        e.register("javve-to-string/index.js", function (e, t, n) {
          n.exports = function (e) {
            return (e =
              null === (e = void 0 === e ? "" : e) ? "" : e).toString();
          };
        }),
        e.register("list.fuzzysearch.js/index.js", function (e, t, n) {
          var i = (t("classes"), t("events")),
            r = t("extend"),
            o = t("to-string"),
            a = t("get-by-class");
          n.exports = function (e) {
            r((e = e || {}), {
              location: 0,
              distance: 100,
              threshold: 0.4,
              multiSearch: !0,
              searchClass: "fuzzy-search",
            });
            var n,
              s = t("./src/fuzzy"),
              l = {
                search: function (t, i) {
                  for (
                    var r = e.multiSearch
                        ? t.replace(/ +$/, "").split(/ +/)
                        : [t],
                      o = 0,
                      a = n.items.length;
                    a > o;
                    o++
                  )
                    l.item(n.items[o], i, r);
                },
                item: function (e, t, n) {
                  for (var i = !0, r = 0; r < n.length; r++) {
                    for (var o = !1, a = 0, s = t.length; s > a; a++)
                      l.values(e.values(), t[a], n[r]) && (o = !0);
                    o || (i = !1);
                  }
                  e.found = i;
                },
                values: function (t, n, i) {
                  if (t.hasOwnProperty(n)) {
                    var r = o(t[n]).toLowerCase();
                    if (s(r, i, e)) return !0;
                  }
                  return !1;
                },
              };
            return {
              init: function (t) {
                (n = t),
                  i.bind(
                    a(n.listContainer, e.searchClass),
                    "keyup",
                    function (e) {
                      var t = e.target || e.srcElement;
                      n.search(t.value, l.search);
                    }
                  );
              },
              search: function (e, t) {
                n.search(e, t, l.search);
              },
              name: e.name || "fuzzySearch",
            };
          };
        }),
        e.register("list.fuzzysearch.js/src/fuzzy.js", function (e, t, n) {
          n.exports = function (e, t, n) {
            function i(e, n) {
              var i = e / t.length,
                r = Math.abs(s - n);
              return o ? i + r / o : r ? 1 : i;
            }
            var r = n.location || 0,
              o = n.distance || 100,
              a = n.threshold || 0.4;
            if (t === e) return !0;
            if (t.length > 32) return !1;
            var s = r,
              l = (function () {
                var e,
                  n = {};
                for (e = 0; e < t.length; e++) n[t.charAt(e)] = 0;
                for (e = 0; e < t.length; e++)
                  n[t.charAt(e)] |= 1 << (t.length - e - 1);
                return n;
              })(),
              c = a,
              d = e.indexOf(t, s);
            -1 != d &&
              ((c = Math.min(i(0, d), c)),
              -1 != (d = e.lastIndexOf(t, s + t.length)) &&
                (c = Math.min(i(0, d), c)));
            var u = 1 << (t.length - 1);
            d = -1;
            for (
              var h, p, f, m = t.length + e.length, g = 0;
              g < t.length;
              g++
            ) {
              for (h = 0, p = m; p > h; )
                i(g, s + p) <= c ? (h = p) : (m = p),
                  (p = Math.floor((m - h) / 2 + h));
              m = p;
              var v = Math.max(1, s - p + 1),
                y = Math.min(s + p, e.length) + t.length,
                b = Array(y + 2);
              b[y + 1] = (1 << g) - 1;
              for (var w = y; w >= v; w--) {
                var x = l[e.charAt(w - 1)];
                if (
                  ((b[w] =
                    0 === g
                      ? ((b[w + 1] << 1) | 1) & x
                      : (((b[w + 1] << 1) | 1) & x) |
                        ((f[w + 1] | f[w]) << 1) |
                        1 |
                        f[w + 1]),
                  b[w] & u)
                ) {
                  var C = i(g, w - 1);
                  if (c >= C) {
                    if (((c = C), !((d = w - 1) > s))) break;
                    v = Math.max(1, 2 * s - d);
                  }
                }
              }
              if (i(g + 1, s) > c) break;
              f = b;
            }
            return !(0 > d);
          };
        }),
        e.alias(
          "component-classes/index.js",
          "list.fuzzysearch.js/deps/classes/index.js"
        ),
        e.alias("component-classes/index.js", "classes/index.js"),
        e.alias(
          "component-indexof/index.js",
          "component-classes/deps/indexof/index.js"
        ),
        e.alias(
          "segmentio-extend/index.js",
          "list.fuzzysearch.js/deps/extend/index.js"
        ),
        e.alias("segmentio-extend/index.js", "extend/index.js"),
        e.alias(
          "javve-events/index.js",
          "list.fuzzysearch.js/deps/events/index.js"
        ),
        e.alias("javve-events/index.js", "events/index.js"),
        e.alias("component-event/index.js", "javve-events/deps/event/index.js"),
        e.alias(
          "timoxley-is-collection/index.js",
          "javve-events/deps/is-collection/index.js"
        ),
        e.alias(
          "component-type/index.js",
          "timoxley-is-collection/deps/type/index.js"
        ),
        e.alias(
          "javve-get-by-class/index.js",
          "list.fuzzysearch.js/deps/get-by-class/index.js"
        ),
        e.alias("javve-get-by-class/index.js", "get-by-class/index.js"),
        e.alias(
          "javve-to-string/index.js",
          "list.fuzzysearch.js/deps/to-string/index.js"
        ),
        e.alias(
          "javve-to-string/index.js",
          "list.fuzzysearch.js/deps/to-string/index.js"
        ),
        e.alias("javve-to-string/index.js", "to-string/index.js"),
        e.alias("javve-to-string/index.js", "javve-to-string/index.js"),
        e.alias("list.fuzzysearch.js/index.js", "list.fuzzysearch.js/index.js"),
        "object" == typeof exports
          ? (module.exports = e("list.fuzzysearch.js"))
          : $__System.registerDynamic("4e", [], !1, function (t, n, i) {
              return function () {
                return e("list.fuzzysearch.js");
              }.call(this);
            });
    })(),
    $__System.registerDynamic(
      "4f",
      ["e", "11", "1b", "2b", "28", "32", "50", "51", "34"],
      !0,
      function (e, t, n) {
        this || self;
        var i = e("e"),
          r = e("11"),
          o = e("1b"),
          a = (e("2b"), e("28")),
          s = e("32"),
          l = e("50"),
          c = e("51"),
          d = e("34"),
          u = c.Reporter,
          h = {
            DEFAULT_OPTIONS: {
              keys: {},
              indentByTab: !1,
              indentSize: 2,
              codeIndentSize: 4,
              enableInlineMath: !0,
              autoNumberingForMath: !1,
              enableHighlight: !1,
              enableSubscript: !1,
              enableSuperscript: !1,
              enableDiagram: !1,
              copyMarkdownByDefault: !1,
              showLineNumbersForFence: !1,
              useRelativePathForImg: !1,
              autoCorrectMisspell: !1,
              noPairingMatch: !1,
              autoPairExtendSymbol: !1,
              enableAutoSave: !1,
              scrollWithCursor: !1,
              expandSimpleBlock: !1,
              allowImageMove: !0,
              allowImageUpload: !0,
              headingStyle: 0,
              ulStyle: 0,
              olStyle: 0,
              strictMarkdown: !1,
              preferCRLF: !1,
              sortType: 0,
              sidebarTab: "",
              useTreeStyle: !1,
              noLineWrapping: !1,
              prettyIndent: !1,
              defaultImageStorage: null,
              applyImageMoveForWeb: !1,
              applyImageMoveForLocal: !0,
              ignoreLineBreak: !1,
              preLinebreakOnExport: !1,
              hideBrAndLineBreak: !1,
              indentFirstLine: !1,
              monocolorEmoji: !1,
              useFsQueue: !0,
              isLocked: !1,
              convertSmartOnRender: !1,
              remapUnicodePunctuation: !1,
              smartDash: !1,
              smartQuote: !1,
              userQuotesArray: null,
              autoResizeIframe: !0,
              blockHTML: !0,
              sendAnonymousUsage: !0,
              presetSpellCheck: "auto",
              sidebarWidth: null,
              caseSensitive: !1,
              wholeWord: !1,
              fileSearchCaseSensitive: !1,
              fileSearchWholeWord: !1,
              wordCountDelimiter: 0,
              listNoGroup: !1,
              treeNoGroup: !1,
              wordsPerMinute: 382,
              autoEscapeImageURL: !1,
              mathFormatOnCopy: "svg",
              gitlabMath: !1,
              spellcheckForCodeAndLink: !1,
              preferFinalNewline: !1,
              htmlMath: !1,
              strictNumberStartOnNewLine: !1,
              noDisplayLinesInMath: !1,
              lineWiseCopyCut: !1,
              defaultExtension: "md",
            },
            readOption: function () {
              window._options &&
                (File.option = i.extend(File.option, window._options)),
                window._documentState && File.setDocumentState(_documentState);
              var e = (window._options || {}).autoNumberingForMath;
              (File.option.autoNumberingForMath = e ? "all" : "none"),
                "ams" == e && (File.option.autoNumberingForMath = "ams"),
                ("0" != e && "null" != e && "false" != e && "nil" != e) ||
                  (File.option.autoNumberingForMath = "none"),
                (File.option.headingStyle = File.option.headingStyle || 0),
                (File.option.ulStyle = File.option.ulStyle || 0),
                (File.option.olStyle = File.option.olStyle || 0),
                (File.option.wordCountDelimiter =
                  File.option.wordCountDelimiter || 0),
                (File.option.sortType = File.option.sortType || 0),
                (File.option.indentSize = File.option.indentSize - 0 || 2),
                (File.option.codeIndentSize =
                  File.option.codeIndentSize - 0 || 4),
                (File.option.curTheme =
                  File.option.curTheme || File.option.theme),
                isNaN(File.option.indentSize) && (File.option.indentSize = 2),
                isNaN(File.option.codeIndentSize) &&
                  (File.option.codeIndentSize = 4),
                (window._options || {}).mountFolder &&
                  File.setMountFolder(_options.mountFolder),
                File.setIndentSize(File.option.indentSize),
                window.innerWidth < 540 && (File.option.sidebarTab = null),
                File.option.useCustomFontSize &&
                  (document.body.parentElement.style.fontSize =
                    File.option.customFontSize + "px"),
                File.setCanCollapsePinnedOutline(
                  File.option.canCollapseOutlinePanel
                ),
                3 == File.option.headingStyle &&
                  document.body.classList.add("use-varible-width-setex"),
                File.option.noLineWrapping &&
                  i("#write").addClass("fences-no-line-wrapping"),
                File.isMac &&
                  ((_options.osVersion || "").indexOf(!1) &&
                    document.body.classList.add("mac-os-11"),
                  bridge.callHandler("window.refreshFullContentState")),
                File.isNode && (File.option.arch = process.arch),
                File.setIndentFirstLine(File.option.indentFirstLine, !0),
                File.setHideBrAndLineBreak(
                  File.option.hideBrAndLineBreak || !1,
                  !0
                ),
                (File.isFocusMode = File.option.isFocusMode),
                (File.isTypeWriterMode = File.option.isTypeWriterMode),
                File.setIgnoreLineBreak(File.option.ignoreLineBreak || !1, !0),
                File.option.monocolorEmoji &&
                  document.body.classList.add("monocolor-emoji"),
                h.setConvertSmartOnRender(File.option.convertSmartOnRender),
                File.option.framelessWindow &&
                  setTimeout(function () {
                    i.localize.getString &&
                      a.showHintOrWarning({
                        key: "noHintForUnibody",
                        title: i.localize.getString(
                          "<strong>Unibody</strong> style has been turned on.",
                          "Front"
                        ),
                        body: i.localize.getString(
                          "You can right click titlebar to popup application menu.",
                          "Front"
                        ),
                        checked: !0,
                      });
                  }, 1e3),
                File.option.supportTextBundle &&
                  File.SupportedFiles.push("textbundle");
            },
            setConvertSmartOnRender: function (e) {
              File.option.convertSmartOnRender = e;
            },
            setup: function () {
              window.Reporter.install(),
                window.Analytics.install(),
                File.isMac && (h.setupSafari(), h.setupBridge());
            },
            setupBridge: function () {
              bridge.registerHandler(
                "File.getSuggestedFileName",
                function (e, t) {
                  t(File.getSuggestedFileName());
                }
              ),
                bridge.registerHandler("File.reloadContent", function (e, t) {
                  File.reloadContent.apply(File, e), t(null);
                }),
                bridge.registerHandler("File.setFilePath", function (e, t) {
                  var n = e[2],
                    i =
                      File.editor.imgEdit &&
                      File.editor.imgEdit.getTargetImageStorageFolder();
                  File.bundle.filePath != e[0] &&
                    u.record(
                      `File.setFilePath, File.bundle.filePath = ${r.hashCode(
                        e[0]
                      )}`
                    ),
                    (File.bundle.filePath = e[0]),
                    (File.bundle.currentFolderPath = e[1]),
                    d.onFilePathUpdated(void 0, n, i),
                    t && t(null);
                }),
                bridge.registerHandler("File.loadFile", async function (e, t) {
                  File.loadFile(null, !0, e), t && t(null);
                }),
                bridge.registerHandler(
                  "File.generateSnapForBackup",
                  function (e, t) {
                    try {
                      t(File._needsUpdateSnap ? File.generateSnap() : null);
                    } catch (e) {
                      console.sendError(e, "warning"), t("ERROR");
                    }
                    File._needsUpdateSnap = !1;
                  }
                ),
                bridge.registerHandler("File.getContent", function (e, t) {
                  !1 === File.validateContentForSave() &&
                    (u.record("handler File.getContent"),
                    File.showDataLostError()),
                    t(File.sync(!0, !1, !0, e));
                });
            },
            setupSafari: function () {
              try {
                var e = Object.defineProperty({}, "passive", {
                  get: function () {
                    File.option.passiveEvents = !0;
                  },
                });
                window.addEventListener("test", null, e);
              } catch (e) {}
            },
            shouldRemapPunctuation: function () {
              return (
                File.option.remapUnicodePunctuation ||
                (!File.option.convertSmartOnRender &&
                  (File.option.smartQuote || File.option.smartDash))
              );
            },
            setFinalNewline: function (e) {
              if (!File.finalNewline != !e) {
                File.finalNewline = e;
                var t = o.makeEmptyCommand();
                t.undo.push({
                  type: "option",
                  option: "finalNewline",
                  value: !e,
                }),
                  t.redo.push({
                    type: "option",
                    option: "finalNewline",
                    value: e,
                  }),
                  File.editor.undo.register(t);
              }
            },
            setIndentFirstLine: function (e, t, n) {
              (File.option.indentFirstLine = e),
                File.option.indentFirstLine
                  ? File.editor.writingArea.classList.add("first-line-indent")
                  : File.editor.writingArea.classList.remove(
                      "first-line-indent"
                    ),
                t &&
                  (JSBridge.menu.update(
                    "Edit→Whitespace and Line Breaks→Indent first line of paragraphs",
                    { state: File.option.indentFirstLine }
                  ),
                  l.forceRefreshMenu()),
                n && JSBridge.putSetting("indentFirstLine", e);
            },
            setHideBrAndLineBreak: function (e, t, n) {
              (File.option.hideBrAndLineBreak = e),
                File.option.hideBrAndLineBreak
                  ? document.body.classList.add("hide-br-and-line-break")
                  : document.body.classList.remove("hide-br-and-line-break"),
                t &&
                  (JSBridge.menu.update(
                    "Edit→Whitespace and Line Breaks→Visible <br/>",
                    { state: !File.option.hideBrAndLineBreak }
                  ),
                  l.forceRefreshMenu()),
                n && JSBridge.putSetting("hideBrAndLineBreak", e);
            },
            setIgnoreLineBreak: function (e, t, n) {
              (e = 1 == e || "true" == e)
                ? document.body.classList.add("ignore-line-break")
                : document.body.classList.remove("ignore-line-break"),
                File.option.ignoreLineBreak != e &&
                  (e
                    ? i(".md-softbreak").html(
                        "<span contenteditable='false'></span>\n"
                      )
                    : (i(".md-softbreak-emptyline").replaceWith(
                        "&#10;<span md-inline='emptyline' class='md-emptyline'>&#10;</span>"
                      ),
                      i(".md-softbreak [contenteditable]").remove())),
                (File.option.ignoreLineBreak = e),
                n && JSBridge.putSetting("ignoreLineBreak", e),
                t &&
                  (JSBridge.menu.update(
                    "Edit→Whitespace and Line Breaks→Preserve single line break",
                    { state: !e }
                  ),
                  l.forceRefreshMenu());
            },
            setIndentSize: function (e) {
              (File.option.indentSize = (e || 2) - 0),
                File.option.indentSize < 0
                  ? ((File.option.indentSize = 2),
                    (File.option.indentByTab = !0))
                  : (File.option.indentByTab = !1);
            },
            setLineEnding: function (e, t, n) {
              if (e != File.useCRLF || n) {
                File.useCRLF = e;
                var i = {
                  "Edit→Line Endings→Windows Line Endings (CRLF)": {
                    state: File.useCRLF,
                    enabled: !File.isLocked,
                  },
                  "Edit→Line Endings→Unix Line Endings (LF)": {
                    state: !File.useCRLF,
                    enabled: !File.isLocked,
                  },
                };
                if ((JSBridge.menu.update(i), t)) {
                  File.sync();
                  var r = File.editor.getMarkdown();
                  (r = (r.split(/\r?\n/g) || [r]).join(
                    File.useCRLF ? "\r\n" : "\n"
                  )),
                    File.reloadContent(r),
                    (File.needSaveState = !0),
                    File.backupWindow();
                }
              }
            },
            setTheme: function (e) {
              File.colorBrightness = 1;
              var t = function () {
                  i("#bg_css").remove(),
                    setTimeout(() => {
                      !(function () {
                        var e,
                          t,
                          i,
                          r = (
                            window
                              .getComputedStyle(document.body)
                              .backgroundColor.match(/[\d.]+/gi) || []
                          ).map(function (e) {
                            return e - 0;
                          });
                        function o(e) {
                          var t = Number(e).toString(16).toUpperCase();
                          return 1 == t.length ? "0" + t : t;
                        }
                        if (
                          ((void 0 !== r[3] && null !== r[3]) || (r[3] = 1),
                          r.length &&
                            ((File.colorBrightness =
                              (299 * r[0] + 587 * r[1] + 114 * r[2]) / 256e3),
                            File.isMac
                              ? (r[0] + r[1] + r[2] + r[3] == 0 &&
                                  (r = [255, 255, 255, 0]),
                                bridge.callHandler("window.setBackground", r),
                                bridge.callHandler(
                                  "window.setIsSchemeAwareness",
                                  n()
                                ))
                              : (JSBridge.invoke(
                                  "theme.setThemeSource",
                                  File.colorBrightness < 0.5 ? "dark" : "system"
                                ),
                                JSBridge.putSetting(
                                  "backgroundColor",
                                  ((e = r[0]),
                                  (t = r[1]),
                                  (i = r[2]),
                                  "#" + o(e) + o(t) + o(i))
                                ),
                                JSBridge.putSetting(
                                  "isDarkMode",
                                  File.colorBrightness < 0.5
                                ))),
                          File.isMac)
                        ) {
                          var a = null;
                          "true" !=
                            (
                              window
                                .getComputedStyle(document.body)
                                .getPropertyValue(
                                  "--typora-center-window-title"
                                ) || ""
                            ).trim() &&
                            document.body.classList.contains("pin-outline") &&
                            (a = document
                              .querySelector("#typora-sidebar")
                              .getBoundingClientRect().width),
                            bridge.callHandler(
                              "window.setTitlebarTextMarginLeft",
                              a
                            );
                        }
                      })(),
                        File._onInitTheme || File.editor.refresh(!0),
                        (File._onInitTheme = !1),
                        File.isNode &&
                          File.megaMenu &&
                          File.megaMenu.applyTheme();
                    }, 100),
                    File.isFocusMode &&
                      File.editor.updateFocusMode(File.isFocusMode),
                    File.isTypeWriterMode &&
                      File.editor.setTypeWriterMode(!0, !0);
                },
                n = function () {
                  var e = document.getElementById("theme_css");
                  for (var t of document.styleSheets)
                    if (t.href === e.href && e.href)
                      for (var n of t.rules)
                        if (
                          4 === n.type &&
                          /prefers\-color\-scheme/.exec(n.cssText || "")
                        )
                          return !0;
                  return !1;
                };
              if (File.isMac) {
                var r = document.getElementById("theme_css"),
                  o = r.getAttribute("href"),
                  a = "file://" + _options.currentThemeFolder;
                if (
                  ((e = (e = e || File.option.curTheme || "github")
                    .replace(/\s*([A-Z])/g, "-$1")
                    .replace(/^-/, "")
                    .toLowerCase()),
                  (File.option.curTheme = e),
                  File.option.useCustomFontSize)
                ) {
                  var s = (File.option.customFontSize || 16) + "";
                  document.body.parentElement.style.fontSize = s + "px";
                } else document.body.parentElement.style.fontSize = "";
                (o = (/([^\\\/]+)\.css$/.exec(o) || [])[1]) != e &&
                  r.setAttribute("href", a + "/" + e + ".css"),
                  setTimeout(t, 20),
                  document
                    .querySelector("#base_user_css")
                    .setAttribute("href", a + "/base.user.css"),
                  document
                    .querySelector("#theme_user_css")
                    .setAttribute("href", a + "/" + e + ".user.css");
              } else if (File.isNode) {
                (File.option.curTheme =
                  e || File.option.curTheme || "github.css"),
                  (e = File.option.curTheme.replace(/\.css$/, ""));
                var l = "typora://app/userData",
                  c = File.isWin ? "\\" : "/";
                i("#theme_css").attr("href", [l, "themes", e + ".css"].join(c)),
                  setTimeout(t, 20),
                  document
                    .querySelector("#base_user_css")
                    .setAttribute(
                      "href",
                      [l, "themes", "base.user.css"].join(c)
                    ),
                  document
                    .querySelector("#theme_user_css")
                    .setAttribute(
                      "href",
                      [l, "themes", e + ".user.css"].join(c)
                    ),
                  File.isMacNode && JSBridge.invoke("menu.refreshThemeMenu");
              }
              (document.body.style.backgroundColor = ""),
                document.body.style.setProperty("--bg-color", "");
            },
            setCanCollapsePinnedOutline: function (e) {
              e
                ? document.body.classList.remove("no-collapse-outline")
                : document.body.classList.add("no-collapse-outline"),
                (File.option.canCollapseOutlinePanel = e),
                this.editor &&
                  this.editor.nodeMap &&
                  this.editor.nodeMap.toc &&
                  this.editor.nodeMap.toc.updateHTML(!0);
            },
            decideLineEnding: function (e) {
              var t =
                e.indexOf("\r\n") > -1 || (!(e.indexOf("\n") > -1) && null);
              if (null !== t) File.setLineEnding(t);
              else {
                var n = File.editor.localSettingBridge
                  ? File.editor.localSettingBridge.preferCRLF()
                  : File.option.preferCRLF;
                File.setLineEnding(n);
              }
              var i = e.length,
                r = File.editor.localSettingBridge
                  ? File.editor.localSettingBridge.preferFinalNewline()
                  : File.option.preferFinalNewline;
              i
                ? ((File.finalNewline = "\n" == e.substr(i - 1)),
                  e.length > 1 && "\n" == e.substr(i - 2)
                    ? (File.finalNewline = r)
                    : e.length > 1 &&
                      "\r" == e.substr(i - 2) &&
                      (e.length > 2 && e.substr(i - 3)
                        ? (File.finalNewline = "\n" == e.substr(i - 3))
                        : (File.finalNewline = r)))
                : (File.finalNewline = r);
            },
            setDefaultImageStorage: function (e) {
              (File.option.defaultImageStorage = e),
                File.editor.imgEdit &&
                  (File.editor.imgEdit.cachedFileImageStorage = null);
            },
            exitOversize: function () {
              var e = document.querySelector("#ty-oversize-body");
              e &&
                !e.style.display &&
                ((e.style.display = "none"), console.sendLog("[exitOversize]")),
                (File.bundle.unsupported = !1);
            },
            doEnterOversize: function (e) {
              console.sendLog(
                `[doEnterOversize] ${e ? "fromBroadcast" : "fromSelf"}`
              ),
                (document.querySelector("#ty-oversize-body").style.display =
                  ""),
                (File.bundle.unsupported = File.UNSUPPORTED_REASON.OVERSIZE),
                File.isNode && !e && JSBridge.invoke("document.addSnap", null);
            },
            tryEnterOversize: function (e, t, n) {
              return File.isMac && !File.bundle.filePath
                ? (File.exitOversize(), e)
                : (s.bindOversizePlaceholder(),
                  t || e.length > File.MAX_FILE_SIZE
                    ? (File.doEnterOversize(n), "")
                    : (File.exitOversize(), e));
            },
            recoverPosOrScroll: function (e) {
              File.bundle.filePath;
              var t =
                File.editor.library.cursorBackups[File.bundle.filePath || ""];
              e &&
              ((e.cursorPos && "null" !== e.cursorPos) || e.scrollOffset) &&
              (!t || t.date < e.timeStamp)
                ? (!e.cursorPos ||
                    "null" === e.cursorPos ||
                    ("INPUT" === document.activeElement.tagName &&
                      document.activeElement.closest("#sidebar-content")) ||
                    (File.editor.undo.exeCommand(JSON.parse(e.cursorPos)),
                    File.editor.selection.scrollAdjust()),
                  void 0 != e.scrollOffset &&
                    (e.scrollOffset, i("content").scrollTop(e.scrollOffset)))
                : t
                ? (t.type
                    ? (File.editor.undo.exeCommand(t),
                      File.editor.selection.scrollAdjust())
                    : window.getSelection().removeAllRanges(),
                  void 0 != t.scrollOffset &&
                    i("content").scrollTop(t.scrollOffset))
                : window._hasSwitchCallback ||
                  isInputComponent(document.activeElement) ||
                  (window.getSelection().removeAllRanges(),
                  File.editor.writingArea.focus(),
                  i("content").scrollTop(0));
            },
            getFileName: function (e) {
              if (File.isMac) {
                var t = File.bundle.filePath,
                  n = File.bundle.currentFolderPath,
                  i = void 0;
                return (
                  t && n && (i = t.replace(n, "").replace(/^\//g, "")),
                  i || (e ? File.getSuggestedFileName() : void 0)
                );
              }
              return File.bundle.fileName
                ? File.bundle.fileName
                : File.bundle.filePath
                ? ((File.bundle.fileName = s.getFileNameFromPath(
                    File.bundle.filePath
                  )),
                  File.bundle.fileName)
                : e
                ? File.getSuggestedFileName()
                : void 0;
            },
            getSuggestedFileName: function (e) {
              if (File.bundle.fileName)
                return File.bundle.fileName.replace(/\.[^.]+$/, "");
              if (e) {
                var t = File.getFileName();
                if (t) return t.replace(/\.[^.]+$/, "");
              }
              var n,
                o,
                a = "",
                s = "";
              try {
                (o = File.editor.docMenu.getMetaNode()) &&
                  ((s = File.editor.docMenu.getValueInMeta("date", o) || ""),
                  (s = (/\d+-\d+-\d+/g.exec(s) ||
                    /\d+\/\d+\/\d+/g.exec(s) || [""])[0]),
                  (a = (a =
                    File.editor.docMenu.getValueInMeta("title", o) || "")
                    .replace(/(^\s*("|'))|(("|')\s*)/gi, "")
                    .replace(/\s+(.)/gi, "-$1")
                    .toLocaleString()),
                  (a = s && a ? [s, a].join("-") : a)),
                  (0 != a.trim().length && "-" != a) ||
                    ((n = i(i("#write h1, #write h2, #write h3")[0])),
                    File.editor.sourceView.inSourceMode
                      ? (a =
                          (a = File.editor.getMarkdown()).substr(
                            0,
                            a.indexOf("\n")
                          ) || a).length > 60 &&
                        (a = a.substr(0, a.indexOf(".")) || a)
                      : n.length
                      ? (a = File.editor.UserOp.getDisplayText(n).replace(
                          /\r?\n/gi,
                          ""
                        ))
                      : (a =
                          (a = (n = i(i("[cid]:not(.md-meta-block)")[0])).length
                            ? File.editor.UserOp.getDisplayText(n)
                            : "").substr(0, a.indexOf("\n")) || a).length >
                          60 && (a = a.substr(0, a.indexOf(".")) || a)),
                  a.length > 120 && (a = a.substr(0, 120));
              } catch (e) {}
              return (
                0 == a.trim().length &&
                  (a = i.localize.getString("Untitled", "Front")),
                r.removeInvalidPathCh(a.trim()) || "Untitled"
              );
            },
          };
        n.exports = h;
      }
    ),
    $__System.registerDynamic(
      "48",
      ["e", "11", "1b", "13", "2b", "28", "2f", "29", "52"],
      !0,
      function (e, t, n) {
        this || self;
        var i = e("e"),
          r = e("11"),
          o = (e("1b"), e("13")),
          a = o.Node,
          s = o.TYPE,
          l = (e("2b"), e("28")),
          c = (e("2f"), e("29")),
          d = e("52"),
          u = {
            copy: function () {
              File.editor.UserOp.copyHandler(File.editor);
            },
            delete: function (e) {
              if (((e = e || document.activeElement), isInputComponent(e))) {
                var t = document.activeElement.closest(".CodeMirror");
                t && (t = t.CodeMirror).replaceSelection("", "start");
              } else
                File.editor.UserOp.backspaceHandler(
                  File.editor,
                  null,
                  "Backspace"
                );
            },
            editActive: function (e) {
              var t = File.editor;
              t.undo.prepCursorSnap();
              var n = e ? i(e).closest("[cid]") : t.findElemById(t.focusCid);
              a.isType(n.attr("mdtype"), s.html_block, s.math_block)
                ? n.find(".md-rawblock-container").trigger("startedit")
                : a.isType(n.attr("mdtype"), s.fences) &&
                  t.refocus(n.attr("cid"));
            },
            deleteActive: function (e) {
              var t = File.editor.getMarkElem(e),
                n = File.editor.findNodeByElem(t);
              !n &&
                File.editor.focusCid &&
                (n = File.editor.getNode(File.editor.focusCid));
              var i = File.editor.UserOp.backToParagraph(editor, n, !0);
              File.editor.undo.register(i);
            },
            cut: function () {
              if (File.isLocked) return !1;
              File.editor.refocus(void 0, !0),
                File.editor.UserOp.copyHandler(editor, null),
                File.editor.UserOp.backspaceHandler(
                  editor,
                  null,
                  "delSelection"
                );
            },
            pasteAsPlainText: function () {
              i(File.editor.sessionStr).trigger("pasteAsPlainText");
            },
            lock: function () {
              (File.isLocked = !0), File.freshLock();
            },
            unlock: function () {
              (File.isLocked = !1), File.freshLock();
            },
            toggleSourceMode: function () {
              File.editor.sourceView.inSourceMode
                ? (File.editor.sourceView.hide(),
                  File.editor.library.recoverSidebar())
                : (File.editor.library.tmpHideSidebar(),
                  File.editor.sourceView.show()),
                File.freshMenuWithDelay();
            },
            freshLock: function (e, t) {
              File.editor &&
                (void 0 !== e && (File.isLocked = e),
                i("content input, selector").prop(
                  "readOnly",
                  File.isLocked || !1
                ),
                i(".CodeMirror").each(function () {
                  this.CodeMirror &&
                    (this.CodeMirror.options.readOnly = File.isLocked || !1);
                }),
                File.isLocked
                  ? (File.editor.tableEdit.unfocusAll(),
                    i("[contenteditable=true]")
                      .attr("locked", "true")
                      .attr("contenteditable", "false"),
                    i(File.editor.sessionStr).blur(),
                    i(".md-expand").removeClass("md-expand"))
                  : i("[locked='true']")
                      .attr("locked", "false")
                      .attr("contenteditable", "true"),
                i("#md-searchpanel input").prop("readOnly", !1),
                !t && File.freshMenu(),
                File.editor &&
                  File.editor.sourceView &&
                  File.editor.sourceView.inSourceMode &&
                  File.editor.sourceView.cm.focus());
            },
            validateContentForSave: function () {
              return (
                !!(function () {
                  try {
                    if (
                      File.editor.sourceView &&
                      File.editor.sourceView.inSourceMode
                    )
                      return !0;
                    var e = File.editor.nodeMap.getFirst();
                    if (!e) return !1;
                    var t = e.cid == i("#write [cid]").first().attr("cid");
                    if (
                      !(t = t && 1 == i("#write [cid='" + e.cid + "']").length)
                    )
                      return !1;
                    var n = e.getLastBrother(!1, !1, !0).getVeryFirst(!0);
                    return (
                      !!n &&
                      n.cid == i("#write [cid]").last().attr("cid") &&
                      1 == i("#write [cid='" + n.cid + "']").length
                    );
                  } catch (e) {
                    console.sendError(e);
                  }
                })() ||
                (window.Reporter.record("doValidateContentForSave failed"),
                window.Reporter.buildExtraDebugInfo().then((e) => {
                  console.sendError(
                    `detect data lost (${File.option.appVersion})`,
                    "error",
                    { extra: e }
                  );
                }),
                !1)
              );
            },
            tryRecoveryFromDom: function () {
              var e = i("#write").html(),
                t = File.editor.UserOp.setClipboard;
              t(e, void 0, void 0, !0);
              var n = d.getMarkElemFromCurrentHtml(e, File.editor).html();
              File.editor.nodeMap.reset();
              var r = i("content").scrollTop(),
                o = d.getBlocksFromMarkHtml(n, void 0, void 0, !0),
                s = "string" == typeof o ? o : a.markFromArr(o);
              File.editor.reset(s),
                t(void 0, void 0, s),
                File.editor.writingArea.focus(),
                File.editor.undo.reset(),
                File.changeCounter && File.changeCounter.reset(),
                File.updateChangeCount(
                  File.ChangeType.NSChangeReadOtherContents
                ),
                i("content").scrollTop(r),
                (File._needsUpdateSnap = new Date()),
                File.backupDocumentSnap(),
                (File.needSaveState = !0),
                File.backupWindow();
            },
            showDataLostError: function () {
              l.showDialog({
                title: i.localize.getString("Error"),
                message: i.localize.getString(
                  "Sorry, some error happened, current writing content has been copied to clipboard. You could report this to <hi@typora.io> to help us fix this error.",
                  "Panel"
                ),
                buttons: [
                  i.localize.getString("Try Recovery", "Panel"),
                  i.localize.getString(
                    "Other Options for Data Recovery",
                    "Panel"
                  ),
                ],
                type: "error",
                tag: "content-lost",
                callback: function (e) {
                  const t = File.option.useMirrorInCN
                    ? "typoraio.cn"
                    : "typora.io";
                  1 == e &&
                    JSBridge.showInBrowser(
                      `https://support.${t}/Version-Control/`
                    );
                },
              }),
                File.saveAndBackup(),
                File.tryRecoveryFromDom();
            },
            isKeyWindow: function () {
              return (
                !!File.isActiveWindow() &&
                (File.isMac ? !File.bundle.isLocked : !File.isLocked)
              );
            },
            doImportFile: async function (e) {
              var t = window.ClientCommand;
              (await t.validatePandocInstall()) &&
                (File.changeCounter.isDiscardableUntitled()
                  ? (window.getSelection().removeAllRanges(), t.doImport(e))
                  : JSBridge.invoke("app.openFile").then(({ winId: t }) => {
                      JSBridge.invoke(
                        "executeJavaScript",
                        t,
                        'setTimeout(function(){window.getSelection().removeAllRanges();ClientCommand.doImport("' +
                          r.escapeInQuote(e) +
                          '")}, 200)'
                      );
                    }));
            },
            onDropFile: async function (e, t, n) {
              var i = t.types.indexOf("typora.url") > -1,
                r = File.isNode && t.items.length == t.files.length,
                o = File.editor,
                a = e[0];
              if (!a) return;
              function s(e) {
                if (File.isMac) {
                  if (File.bundle.isLocked) return;
                } else if (File.isLocked) return !1;
                File.editor.sourceView.inSourceMode || c.insertURL(e);
              }
              function l() {
                File.isNode
                  ? JSBridge.invoke("app.openFile", a, { curWindow: !0 })
                  : bridge.callHandler("controller.openInTypora", a);
              }
              if (
                await (function (e, n) {
                  if (/^[a-z-]:/g.exec(e)) return Promise.resolve(!1);
                  if (r) {
                    var i = t.items[n].webkitGetAsEntry();
                    if (i) return Promise.resolve(i.isDirectory);
                  }
                  return new Promise(function (t, n) {
                    if (File.isNode)
                      return reqnode("fs").lstat(e, function (e, n) {
                        t(!e && n.isDirectory());
                      });
                    File.isMac &&
                      bridge.callHandler("path.isDirectory", e, function (e) {
                        t(e);
                      });
                  });
                })(a, 0)
              )
                File.option.supportTextBundle && /\.textbundle$/i.exec(a)
                  ? l()
                  : File.bundle.filePath || File.getMountFolder()
                  ? File.isNode
                    ? JSBridge.invoke("app.openFolder", a)
                    : File.isMac &&
                      bridge.callHandler("controller.openFolder", a)
                  : JSBridge.invoke("controller.switchFolder", a);
              else {
                var d = a.match(/(?:^|\.)([^.]+)$/);
                if (
                  ((d = (d[1] || "").toLowerCase()),
                  ~[
                    "latex",
                    "ltx",
                    "tex",
                    "wiki",
                    "dokuwiki",
                    "docx",
                    "rst",
                    "rest",
                    "org",
                    "textile",
                    "opml",
                  ].indexOf(d))
                )
                  return (
                    File.isNode
                      ? u.doImportFile(a)
                      : bridge.callHandler("controller.openInTypora", a),
                    !1
                  );
                if (~File.SupportedFiles.indexOf(d)) return i ? s(a) : l(), !1;
                if (!u.isKeyWindow()) return !1;
                for (var h = 0; h < e.length; h++)
                  h > 0 ? o.UserOp.insertParagraph(!1, o) : n(), s(e[h]);
              }
            },
            handleFileNotExist: async function (e) {
              if (!File.option.noFileNonExistWarning) {
                let { checkboxChecked: t } = await JSBridge.invoke(
                  "dialog.showMessageBox",
                  {
                    type: "warning",
                    message: i.localize
                      .getString("File does not exist at path %@.")
                      .replace("%@", e),
                    defaultId: 0,
                    buttons: [i.localize.getString("OK")],
                    checkboxLabel: i.localize.getString(
                      "Do not show this again",
                      "Panel"
                    ),
                  }
                );
                t &&
                  (JSBridge.execForAll(
                    "window.File && File.option && (File.option.noFileNonExistWarning = true)"
                  ),
                  JSBridge.putSetting("noFileNonExistWarning", !0));
              }
            },
          };
        n.exports = u;
      }
    ),
    $__System.registerDynamic(
      "53",
      ["e", "11", "2b", "28", "32", "33", "34", "54", "51"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"),
          r = e("11"),
          o = (e("2b"), e("28")),
          a = e("32"),
          s = e("33"),
          l = e("34"),
          c = ((a = e("32")), e("54")),
          d = e("51").Reporter,
          u = function (e, t, n) {
            n = n || {};
            var r,
              o,
              a,
              s,
              l = [
                {
                  name: i.localize.getString("Markdown File", "Panel"),
                  extensions: ["md", "markdown", "mmd", "mdwn", "mdown"],
                },
                {
                  name: i.localize.getString("TextBundle", "Panel"),
                  extensions: ["textbundle"],
                },
                {
                  name: i.localize.getString("Plain Text File", "Panel"),
                  extensions: ["txt", "text", ""],
                },
              ];
            return (
              e &&
                l.push({
                  name: i.localize.getString("All Files", "Panel"),
                  extensions: ["*"],
                }),
              /\.textbundle$/i.exec(t) &&
                ((a = 1), (s = (r = l)[(o = 0)]), (r[o] = r[a]), (r[a] = s)),
              JSBridge.invoke(
                "dialog.showSaveDialog",
                Object.assign(
                  {
                    properties: ["saveFile", "showOverwriteConfirmation"],
                    title: i.localize.getString("Save", "Menu"),
                  },
                  n,
                  { defaultPath: t, filters: l }
                )
              )
            );
          },
          h = function (e, t, n, i) {
            var r = File.bundle.filePath || File.bundle.originalPath;
            r || File.isLinuxSnap || (r = a.getDefaultPathOrName()),
              /\.textbundle$/i.exec(r) &&
                File.bundle.filePath &&
                (r = r.replace(/\.textbundle$/i, "-2.textbundle")),
              u(!0, r).then(
                async ({ filePath: r }) => {
                  if (r) {
                    var o = await p.saveAsUseNode(r, i);
                    o ? n && n(o) : e && e(r);
                  } else t && t();
                },
                (e) => {
                  n && n(e);
                }
              );
          },
          p = {
            doShowSaveDialog: u,
            saveAsUseNode: async function (e, t) {
              var n = File.bundle.filePath,
                o = File.bundle.originalPath,
                a = File.editor.imgEdit.getTargetImageStorageFolder();
              const c = File.isWin ? "\\" : "/";
              (File.option.lastSaveLocation = reqnode("path").dirname(e)),
                JSBridge.invoke("app.sendEvent", "willSave", e),
                File.editor.imgEdit.buildImageMap(null, null, !0);
              var d = File.editor.getMarkdown();
              File.bundle.filePath = e;
              var u = !1;
              if (s.isTextBundle(e)) {
                if (File.isTextBundle() && n && n != e)
                  try {
                    await File.fs.copy(n, e), (u = !0);
                  } catch (e) {}
                (File.bundle.type = File.FileType.TextBundle),
                  u ||
                    ((File.bundle.textFile = File.bundle.textFile || "text.md"),
                    await s.makeTextBundleSkeleton(e)),
                  u
                    ? await s.removeUnusedAssets()
                    : (await File.editor.imgEdit._copyAllImages(
                        e + c + "assets",
                        !1,
                        null,
                        !0,
                        !0,
                        !0
                      ),
                      (d = File.editor.getMarkdown()));
              } else if (File.isTextBundle()) {
                File.bundle.type = File.FileType.Markdown;
                let t =
                  r.pathByDeleteLastComponent(e) +
                  c +
                  r.getFileName(e).replace(/\.[^.\/\\]+$/, "") +
                  ".assets";
                await File.editor.imgEdit._copyAllImages(
                  t,
                  !1,
                  null,
                  !0,
                  !0,
                  !1
                ),
                  (d = File.editor.getMarkdown());
              }
              (File.bundle.originalPath = ""),
                (File.bundle.assetsChanges = null);
              try {
                File.fs.writeFileSync(
                  (function (e) {
                    if (s.isTextBundle(e)) {
                      var t = File.bundle.textFile || "text.md";
                      return e + (File.isWin ? "\\" : "/") + t;
                    }
                    return e;
                  })(e),
                  d,
                  "utf8"
                ),
                  File.updateChangeCount(File.ChangeType.NSChangeAutoSaved);
                try {
                  File.bundle.modifiedDate = File.fs.statSync(e).mtimeMs;
                } catch (e) {
                  console.error(e), (File.bundle.modifiedDate = new Date());
                }
              } catch (e) {
                return (
                  console.sendError(e),
                  alert(
                    i.localize.getString("Save File Failed", "Panel") +
                      "\n" +
                      e.stack
                  ),
                  (File.inSavingProcess = !1),
                  (File._onFileSwitching = !1),
                  e
                );
              }
              (File.inSavingProcess = !1), (File._onFileSwitching = !1);
              var h = t || (n || o) != e;
              h
                ? (h = await JSBridge.invoke(
                    "document.checkIfMoveOnSave",
                    e
                  )) &&
                  (JSBridge.invoke("app.sendEvent", "didRename", {
                    oldPath: n,
                    newPath: e,
                  }),
                  l.onFilePathUpdated(void 0, n, a))
                : File.FileInfoPanel.onFilePathUpdated(),
                File.needsUpdateSnap(),
                (File.bundle.savedContent = d),
                JSBridge.invoke("app.sendEvent", "didSave", {
                  path: e,
                  summary: d.substr(0, 200),
                  lastModifiedDate: File.bundle.modifiedDate,
                }),
                n != e && t && n && JSBridge.invoke("shell.trashItem", n),
                JSBridge.invoke(
                  "document.setLastSync",
                  File.bundle.modifiedDate
                ),
                Analytics.record("saveFile");
            },
            saveUseNode: async function (e, t, n) {
              if (
                File.isActiveWindow() &&
                !File.bundle.unsupported &&
                (n || !File.isFileLoading())
              ) {
                var u = File.sync();
                if (void 0 !== u) {
                  if (!1 === File.validateContentForSave())
                    return (
                      d.record(
                        `saveUseNode to ${r.hashCode(
                          File.bundle.filePath
                        )} saveAs: ${e}`
                      ),
                      File.showDataLostError(),
                      !1
                    );
                  var f,
                    m = File.bundle.filePath,
                    g = m,
                    v = File.bundle.fileEncode || "utf8",
                    y = !1;
                  if (
                    (/-bom$/.exec(v) && ((y = !0), (v = v.replace("-bom", ""))),
                    File.bundle.fileMissingWhenOpen &&
                      !m &&
                      (m = File.bundle.originalPath),
                    !e && File.isTextBundle())
                  ) {
                    let e = !1;
                    try {
                      e = (await File.fs.stat(m)).isDirectory();
                    } catch (e) {}
                    if (!e && m)
                      return (
                        await l.saveFileToRecover(!0),
                        void (await p.saveAsUseNode(m))
                      );
                  }
                  if ((m || !t) && File.isNode)
                    return new Promise(async (n) => {
                      var i = reqnode("iconv-lite");
                      try {
                        if ("utf8" != v || y) {
                          var r,
                            o = u;
                          if (
                            ((f = i.encode(u, v, { addBOM: y })),
                            v && -1 == v.indexOf("utf"))
                          ) {
                            try {
                              r = i.decode(f, v);
                            } catch (e) {}
                            if (o != r)
                              throw (
                                (console.error(
                                  `Failed to save in ${v} due to untransliteral char, saving in utf8`
                                ),
                                new Error("iconv-lite transliteration error"))
                              );
                          }
                        } else f = Buffer.from(u, "utf-8");
                      } catch (e) {
                        b();
                      }
                      if (
                        ("" != u &&
                          (0 == f.length ||
                            (f.length > 1 && 0 == f[0] && 0 == f[1])) &&
                          b(),
                        m && !e)
                      ) {
                        File.markSaved(), (File.bundle.assetsChanges = null);
                        let i = s.getTextFile();
                        (File.inSavingProcess = File.inSavingProcess || !e),
                          JSBridge.invoke("app.sendEvent", "willSave", m),
                          (File.bundle.savedContent = u),
                          (File.bundle.modifiedDate = new Date()),
                          await l.saveFileToRecover(),
                          c.writeFile(i, f, async function (r, o) {
                            if (r)
                              return (
                                n(!1),
                                d.error(r, {
                                  fingerprint: ["steno2", "writeFile"],
                                }),
                                void x(r.stack, r.code)
                              );
                            o && l.watchFileChange(m),
                              File.bundle.filePath ||
                                (File.bundle.filePath = m),
                              (File.bundle.fileMissingWhenOpen = !1),
                              (File.bundle.savedContent = u);
                            try {
                              var s = null;
                              if (
                                ((s = t
                                  ? await File.fs.stat(i)
                                  : File.fs.statSync(i)),
                                f.length && 0 == Number(s.size))
                              )
                                return (
                                  n(!1),
                                  x("Failed to write file"),
                                  void d.error(
                                    "Failed to write file: File size is 0 but data is not",
                                    {
                                      fingerprint: ["steno2", "afterWriteFile"],
                                    }
                                  )
                                );
                              File.bundle.modifiedDate = s.mtimeMs;
                            } catch (e) {
                              return n(!1), void x(e.stack, e.code);
                            }
                            n(!0),
                              JSBridge.invoke(
                                "document.setLastSync",
                                File.bundle.modifiedDate
                              ),
                              File.changeCounter.isDocumentEdited() &&
                                File.updateChangeCount(
                                  File.ChangeType.NSChangeAutoSaved
                                ),
                              JSBridge.invoke("app.sendEvent", "didSave", {
                                path: m,
                                summary: u.substr(0, 200),
                                lastModifiedDate: File.bundle.modifiedDate,
                              }),
                              (File.inSavingProcess = !1),
                              a.refreshTitlebarText(),
                              (File.option.enableAutoSave && !e) ||
                                (await File.backupWindow());
                          }),
                          s.removeUnusedAssets(),
                          File.updateChangeCount(
                            File.ChangeType.NSChangeAutoSaved
                          );
                      } else if (!t) {
                        await p.saveUseNode(!1, !0);
                        var g = () => {
                          (File.inSavingProcess = !1),
                            (File._onFileSwitching = !1);
                        };
                        h(
                          async (e) => {
                            n(!0), g();
                          },
                          () => {
                            n(void 0), g();
                          },
                          () => {
                            n(!1), g();
                          }
                        ),
                          Analytics.record("saveFile");
                      }
                      File.editor.nodeMap.toc.updateHTML();
                    });
                }
              }
              function b() {
                console.log("switch to utf8 encode"),
                  (f = Buffer.from(u)),
                  (File.bundle.fileEncode = "utf8"),
                  a.removeItemInDB("[encode]" + m),
                  File.needsUpdateSnap();
              }
              function w(t) {
                var n =
                  e && g
                    ? [
                        i.localize.getString("Save As", "Menu"),
                        i.localize.getString("Open File Location", "Menu"),
                        i.localize.getString("Cancel"),
                      ]
                    : [
                        i.localize.getString("Save As", "Menu"),
                        i.localize.getString("Cancel"),
                      ];
                o.showDialog({
                  title: i.localize.getString("Save File Failed"),
                  message: t,
                  buttons: n,
                  type: "error",
                  callback: function (e) {
                    0 == e
                      ? ClientCommand.saveAs()
                      : e == n.length - 2 && ClientCommand.openFileLocation();
                  },
                });
              }
              function x(e, n) {
                d.record(`onSaveError ${n || ""}`),
                  t ||
                    (w(
                      "EPERM" == n
                        ? i.localize.getString(
                            "The file is read-only, or you do not have right permissions to modify the file."
                          )
                        : e
                    ),
                    console.sendError("fs write failed", !1, n || e),
                    File.saveAndBackup()),
                  (File.inSavingProcess = !1),
                  (File._onFileSwitching = !1),
                  File.updateChangeCount(File.ChangeType.NodeSaveFailed);
              }
            },
            moveTo: async function () {
              return new Promise(function (e) {
                var t = () => {
                  e(!1),
                    (File.inSavingProcess = !1),
                    (File._onFileSwitching = !1);
                };
                h(
                  () => {
                    e(!0),
                      (File.inSavingProcess = !1),
                      (File._onFileSwitching = !1);
                  },
                  t,
                  t,
                  !0
                );
              });
            },
            markSaved: function () {
              var e =
                File.editor &&
                File.editor.undo.lastRegisteredOperationCommand();
              e && (e.date = void 0);
            },
          };
        n.exports = p;
      }
    ),
    $__System.registerDynamic("54", [], !0, function (e, t, n) {
      "use strict";
      var i = this || self;
      if (window.reqnode) {
        var r = reqnode("fs"),
          o = reqnode("path"),
          a = {},
          s = function (e) {
            return o.join(o.dirname(e), ".~" + o.basename(e));
          },
          l = function (e) {
            (this.file = e),
              (this.callbacks = []),
              (this.nextData = null),
              (this.nextCallbacks = []);
          };
        (l.prototype.write = function (e, t) {
          var n = this;
          function o(e) {
            for (; this.callbacks.length; ) this.callbacks.shift()(e);
            t(e), a();
          }
          function a() {
            if (((n.lock = !1), n.nextData)) {
              var e = n.nextData;
              (n.callbacks = n.nextCallbacks),
                (n.nextData = null),
                (n.nextCallbacks = []),
                n.write(e, n.callbacks.pop());
            }
          }
          function l(e, n) {
            for (; this.callbacks.length; ) this.callbacks.shift()(e);
            t(null, n), a();
          }
          function c(t) {
            r.readFile(this.file, (n, i) => {
              t(!!n || 0 == Buffer.compare(e, i));
            });
          }
          this.lock
            ? (t && this.nextCallbacks.push(t), (this.nextData = e))
            : ((this.lock = !0),
              r.stat(
                this.file,
                function (t, n) {
                  if (!t && n) {
                    var a = s(this.file);
                    r.writeFile(
                      a,
                      e,
                      function (t) {
                        t &&
                          (console.log("[Warn] write to tmp file failed"),
                          i.File &&
                            i.File.backupVersionWorker &&
                            File.backupVersionWorker()),
                          r.writeFile(
                            this.file,
                            e,
                            function (e) {
                              e
                                ? o.call(this, e)
                                : c.call(this, (e) => {
                                    e
                                      ? (r.open(this.file, (e, t) => {
                                          e
                                            ? o(!0)
                                            : r.fsync(t, function () {
                                                r.close(t, function () {});
                                              });
                                        }),
                                        r.unlink(a, l.bind(this)))
                                      : o.call(
                                          this,
                                          new Error("write data failed")
                                        );
                                  });
                            }.bind(this)
                          );
                      }.bind(this)
                    );
                  } else
                    (function () {
                      r.writeFile(
                        this.file,
                        e,
                        function (e) {
                          e
                            ? o.call(this, e)
                            : c.call(this, (e) => {
                                e
                                  ? l.call(this, null, !0)
                                  : o.call(
                                      this,
                                      new Error("write data failed")
                                    );
                              });
                        }.bind(this)
                      );
                    }.call(this));
                }.bind(this)
              ));
        }),
          (t.writeFile = function (e, t, n) {
            (e = o.resolve(e)), (a[e] = a[e] || new l(e)), a[e].write(t, n);
          }),
          (t.writeFileSync = function (e, t) {
            r.writeFileSync(s(e), t), r.renameSync(s(e), e);
          });
      }
    }),
    (f = function () {
      return (function e(t, n, i) {
        function r(a, s) {
          if (!n[a]) {
            if (!t[a]) {
              var l = "function" == typeof require && require;
              if (!s && l) return l(a, !0);
              if (o) return o(a, !0);
              var c = new Error("Cannot find module '" + a + "'");
              throw ((c.code = "MODULE_NOT_FOUND"), c);
            }
            var d = (n[a] = { exports: {} });
            t[a][0].call(
              d.exports,
              function (e) {
                var n = t[a][1][e];
                return r(n || e);
              },
              d,
              d.exports,
              e,
              t,
              n,
              i
            );
          }
          return n[a].exports;
        }
        for (
          var o = "function" == typeof require && require, a = 0;
          a < i.length;
          a++
        )
          r(i[a]);
        return r;
      })(
        {
          1: [
            function (e, t, n) {
              function i(e) {
                (this.name = "RavenConfigError"), (this.message = e);
              }
              (i.prototype = new Error()),
                (i.prototype.constructor = i),
                (t.exports = i);
            },
            {},
          ],
          2: [
            function (e, t, n) {
              var i = e(5);
              t.exports = {
                wrapMethod: function (e, t, n) {
                  var r = e[t],
                    o = e;
                  if (t in e) {
                    var a = "warn" === t ? "warning" : t;
                    e[t] = function () {
                      var e = [].slice.call(arguments),
                        s = i.safeJoin(e, " "),
                        l = {
                          level: a,
                          logger: "console",
                          extra: { arguments: e },
                        };
                      "assert" === t
                        ? !1 === e[0] &&
                          ((s =
                            "Assertion failed: " +
                            (i.safeJoin(e.slice(1), " ") || "console.assert")),
                          (l.extra.arguments = e.slice(1)),
                          n && n(s, l))
                        : n && n(s, l),
                        r && Function.prototype.apply.call(r, o, e);
                    };
                  }
                },
              };
            },
            { 5: 5 },
          ],
          3: [
            function (e, t, n) {
              (function (n) {
                var i = e(6),
                  r = e(7),
                  o = e(8),
                  a = e(1),
                  s = e(5),
                  l = s.isErrorEvent,
                  c = s.isDOMError,
                  d = s.isDOMException,
                  u = s.isError,
                  h = s.isObject,
                  p = s.isPlainObject,
                  f = s.isUndefined,
                  m = s.isFunction,
                  g = s.isString,
                  v = s.isArray,
                  y = s.isEmptyObject,
                  b = s.each,
                  w = s.objectMerge,
                  x = s.truncate,
                  C = s.objectFrozen,
                  F = s.hasKey,
                  S = s.joinRegExp,
                  k = s.urlencode,
                  E = s.uuid4,
                  T = s.htmlTreeAsString,
                  _ = s.isSameException,
                  A = s.isSameStacktrace,
                  M = s.parseUrl,
                  L = s.fill,
                  N = s.supportsFetch,
                  D = s.supportsReferrerPolicy,
                  B = (s.serializeKeysForMessage, s.serializeException),
                  R = s.sanitize,
                  P = e(2).wrapMethod,
                  I = "source protocol user pass host port path".split(" "),
                  O =
                    /^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/;
                function $() {
                  return +new Date();
                }
                var H =
                    "undefined" != typeof window
                      ? window
                      : void 0 !== n
                      ? n
                      : "undefined" != typeof self
                      ? self
                      : {},
                  U = H.document,
                  j = H.navigator;
                function q(e, t) {
                  return m(t)
                    ? function (n) {
                        return t(n, e);
                      }
                    : t;
                }
                function W() {
                  for (var e in ((this._hasJSON = !(
                    "object" != typeof JSON || !JSON.stringify
                  )),
                  (this._hasDocument = !f(U)),
                  (this._hasNavigator = !f(j)),
                  (this._lastCapturedException = null),
                  (this._lastData = null),
                  (this._lastEventId = null),
                  (this._globalServer = null),
                  (this._globalKey = null),
                  (this._globalProject = null),
                  (this._globalContext = {}),
                  (this._globalOptions = {
                    release: H.SENTRY_RELEASE && H.SENTRY_RELEASE.id,
                    logger: "javascript",
                    ignoreErrors: [],
                    ignoreUrls: [],
                    whitelistUrls: [],
                    includePaths: [],
                    headers: null,
                    collectWindowErrors: !0,
                    captureUnhandledRejections: !0,
                    maxMessageLength: 0,
                    maxUrlLength: 250,
                    stackTraceLimit: 50,
                    autoBreadcrumbs: !0,
                    instrument: !0,
                    sampleRate: 1,
                    sanitizeKeys: [],
                  }),
                  (this._fetchDefaults = {
                    method: "POST",
                    keepalive: !0,
                    referrerPolicy: D() ? "origin" : "",
                  }),
                  (this._ignoreOnError = 0),
                  (this._isRavenInstalled = !1),
                  (this._originalErrorStackTraceLimit = Error.stackTraceLimit),
                  (this._originalConsole = H.console || {}),
                  (this._originalConsoleMethods = {}),
                  (this._plugins = []),
                  (this._startTime = $()),
                  (this._wrappedBuiltIns = []),
                  (this._breadcrumbs = []),
                  (this._lastCapturedEvent = null),
                  this._keypressTimeout,
                  (this._location = H.location),
                  (this._lastHref = this._location && this._location.href),
                  this._resetBackoff(),
                  this._originalConsole))
                    this._originalConsoleMethods[e] = this._originalConsole[e];
                }
                (W.prototype = {
                  VERSION: "3.26.4",
                  debug: !1,
                  TraceKit: i,
                  config: function (e, t) {
                    var n = this;
                    if (n._globalServer)
                      return (
                        this._logDebug(
                          "error",
                          "Error: Raven has already been configured"
                        ),
                        n
                      );
                    if (!e) return n;
                    var r = n._globalOptions;
                    t &&
                      b(t, function (e, t) {
                        "tags" === e || "extra" === e || "user" === e
                          ? (n._globalContext[e] = t)
                          : (r[e] = t);
                      }),
                      n.setDSN(e),
                      r.ignoreErrors.push(/^Script error\.?$/),
                      r.ignoreErrors.push(
                        /^Javascript error: Script error\.? on line 0$/
                      ),
                      (r.ignoreErrors = S(r.ignoreErrors)),
                      (r.ignoreUrls = !!r.ignoreUrls.length && S(r.ignoreUrls)),
                      (r.whitelistUrls =
                        !!r.whitelistUrls.length && S(r.whitelistUrls)),
                      (r.includePaths = S(r.includePaths)),
                      (r.maxBreadcrumbs = Math.max(
                        0,
                        Math.min(r.maxBreadcrumbs || 100, 100)
                      ));
                    var o = {
                        xhr: !0,
                        console: !0,
                        dom: !0,
                        location: !0,
                        sentry: !0,
                      },
                      a = r.autoBreadcrumbs;
                    "[object Object]" === {}.toString.call(a)
                      ? (a = w(o, a))
                      : !1 !== a && (a = o),
                      (r.autoBreadcrumbs = a);
                    var s = { tryCatch: !0 },
                      l = r.instrument;
                    return (
                      "[object Object]" === {}.toString.call(l)
                        ? (l = w(s, l))
                        : !1 !== l && (l = s),
                      (r.instrument = l),
                      (i.collectWindowErrors = !!r.collectWindowErrors),
                      n
                    );
                  },
                  install: function () {
                    var e = this;
                    return (
                      e.isSetup() &&
                        !e._isRavenInstalled &&
                        (i.report.subscribe(function () {
                          e._handleOnErrorStackInfo.apply(e, arguments);
                        }),
                        e._globalOptions.captureUnhandledRejections &&
                          e._attachPromiseRejectionHandler(),
                        e._patchFunctionToString(),
                        e._globalOptions.instrument &&
                          e._globalOptions.instrument.tryCatch &&
                          e._instrumentTryCatch(),
                        e._globalOptions.autoBreadcrumbs &&
                          e._instrumentBreadcrumbs(),
                        e._drainPlugins(),
                        (e._isRavenInstalled = !0)),
                      (Error.stackTraceLimit =
                        e._globalOptions.stackTraceLimit),
                      this
                    );
                  },
                  setDSN: function (e) {
                    var t = this._parseDSN(e),
                      n = t.path.lastIndexOf("/"),
                      i = t.path.substr(1, n);
                    (this._dsn = e),
                      (this._globalKey = t.user),
                      (this._globalSecret = t.pass && t.pass.substr(1)),
                      (this._globalProject = t.path.substr(n + 1)),
                      (this._globalServer = this._getGlobalServer(t)),
                      (this._globalEndpoint =
                        this._globalServer +
                        "/" +
                        i +
                        "api/" +
                        this._globalProject +
                        "/store/"),
                      this._resetBackoff();
                  },
                  context: function (e, t, n) {
                    return (
                      m(e) && ((n = t || []), (t = e), (e = {})),
                      this.wrap(e, t).apply(this, n)
                    );
                  },
                  wrap: function (e, t, n) {
                    var i = this;
                    if (f(t) && !m(e)) return e;
                    if ((m(e) && ((t = e), (e = void 0)), !m(t))) return t;
                    try {
                      if (t.__raven__) return t;
                      if (t.__raven_wrapper__) return t.__raven_wrapper__;
                    } catch (e) {
                      return t;
                    }
                    function r() {
                      var r = [],
                        o = arguments.length,
                        a = !e || (e && !1 !== e.deep);
                      for (n && m(n) && n.apply(this, arguments); o--; )
                        r[o] = a ? i.wrap(e, arguments[o]) : arguments[o];
                      try {
                        return t.apply(this, r);
                      } catch (t) {
                        try {
                          i._ignoreNextOnError(), i.captureException(t, e);
                        } catch (e) {}
                        throw t;
                      }
                    }
                    for (var o in t) F(t, o) && (r[o] = t[o]);
                    return (
                      (r.prototype = t.prototype),
                      (t.__raven_wrapper__ = r),
                      (r.__raven__ = !0),
                      (r.__orig__ = t),
                      r
                    );
                  },
                  uninstall: function () {
                    return (
                      i.report.uninstall(),
                      this._detachPromiseRejectionHandler(),
                      this._unpatchFunctionToString(),
                      this._restoreBuiltIns(),
                      this._restoreConsole(),
                      (Error.stackTraceLimit =
                        this._originalErrorStackTraceLimit),
                      (this._isRavenInstalled = !1),
                      this
                    );
                  },
                  _promiseRejectionHandler: function (e) {
                    this._logDebug(
                      "debug",
                      "Raven caught unhandled promise rejection:",
                      e
                    ),
                      this.captureException(e.reason, {
                        mechanism: {
                          type: "onunhandledrejection",
                          handled: !1,
                        },
                      });
                  },
                  _attachPromiseRejectionHandler: function () {
                    return (
                      (this._promiseRejectionHandler =
                        this._promiseRejectionHandler.bind(this)),
                      H.addEventListener &&
                        H.addEventListener(
                          "unhandledrejection",
                          this._promiseRejectionHandler
                        ),
                      this
                    );
                  },
                  _detachPromiseRejectionHandler: function () {
                    return (
                      H.removeEventListener &&
                        H.removeEventListener(
                          "unhandledrejection",
                          this._promiseRejectionHandler
                        ),
                      this
                    );
                  },
                  captureException: function (e, t) {
                    if (
                      ((t = w({ trimHeadFrames: 0 }, t || {})), l(e) && e.error)
                    )
                      e = e.error;
                    else {
                      if (c(e) || d(e)) {
                        var n = e.name || (c(e) ? "DOMError" : "DOMException"),
                          r = e.message ? n + ": " + e.message : n;
                        return this.captureMessage(
                          r,
                          w(t, {
                            stacktrace: !0,
                            trimHeadFrames: t.trimHeadFrames + 1,
                          })
                        );
                      }
                      if (u(e)) e = e;
                      else {
                        if (!p(e))
                          return this.captureMessage(
                            e,
                            w(t, {
                              stacktrace: !0,
                              trimHeadFrames: t.trimHeadFrames + 1,
                            })
                          );
                        (t = this._getCaptureExceptionOptionsFromPlainObject(
                          t,
                          e
                        )),
                          (e = new Error(t.message));
                      }
                    }
                    this._lastCapturedException = e;
                    try {
                      var o = i.computeStackTrace(e);
                      this._handleStackInfo(o, t);
                    } catch (t) {
                      if (e !== t) throw t;
                    }
                    return this;
                  },
                  _getCaptureExceptionOptionsFromPlainObject: function (e, t) {
                    var n = Object.keys(t).sort(),
                      i = w(e, {
                        message: JSON.stringify(t),
                        fingerprint: [o(n)],
                        extra: e.extra || {},
                      });
                    return (i.extra.__serialized__ = B(t)), i;
                  },
                  captureMessage: function (e, t) {
                    if (
                      !this._globalOptions.ignoreErrors.test ||
                      !this._globalOptions.ignoreErrors.test(e)
                    ) {
                      var n,
                        r = w({ message: (e += "") }, (t = t || {}));
                      try {
                        throw new Error(e);
                      } catch (e) {
                        n = e;
                      }
                      n.name = null;
                      var o = i.computeStackTrace(n),
                        a = v(o.stack) && o.stack[1];
                      a &&
                        "Raven.captureException" === a.func &&
                        (a = o.stack[2]);
                      var s = (a && a.url) || "";
                      if (
                        (!this._globalOptions.ignoreUrls.test ||
                          !this._globalOptions.ignoreUrls.test(s)) &&
                        (!this._globalOptions.whitelistUrls.test ||
                          this._globalOptions.whitelistUrls.test(s))
                      ) {
                        if (
                          this._globalOptions.stacktrace ||
                          t.stacktrace ||
                          "" === r.message
                        ) {
                          (r.fingerprint =
                            null == r.fingerprint ? e : r.fingerprint),
                            ((t = w(
                              { trimHeadFrames: 0 },
                              t
                            )).trimHeadFrames += 1);
                          var l = this._prepareFrames(o, t);
                          r.stacktrace = { frames: l.reverse() };
                        }
                        return (
                          r.fingerprint &&
                            (r.fingerprint = v(r.fingerprint)
                              ? r.fingerprint
                              : [r.fingerprint]),
                          this._send(r),
                          this
                        );
                      }
                    }
                  },
                  captureBreadcrumb: function (e) {
                    var t = w({ timestamp: $() / 1e3 }, e);
                    if (m(this._globalOptions.breadcrumbCallback)) {
                      var n = this._globalOptions.breadcrumbCallback(t);
                      if (h(n) && !y(n)) t = n;
                      else if (!1 === n) return this;
                    }
                    return (
                      this._breadcrumbs.push(t),
                      this._breadcrumbs.length >
                        this._globalOptions.maxBreadcrumbs &&
                        this._breadcrumbs.shift(),
                      this
                    );
                  },
                  addPlugin: function (e) {
                    var t = [].slice.call(arguments, 1);
                    return (
                      this._plugins.push([e, t]),
                      this._isRavenInstalled && this._drainPlugins(),
                      this
                    );
                  },
                  setUserContext: function (e) {
                    return (this._globalContext.user = e), this;
                  },
                  setExtraContext: function (e) {
                    return this._mergeContext("extra", e), this;
                  },
                  setTagsContext: function (e) {
                    return this._mergeContext("tags", e), this;
                  },
                  clearContext: function () {
                    return (this._globalContext = {}), this;
                  },
                  getContext: function () {
                    return JSON.parse(r(this._globalContext));
                  },
                  setEnvironment: function (e) {
                    return (this._globalOptions.environment = e), this;
                  },
                  setRelease: function (e) {
                    return (this._globalOptions.release = e), this;
                  },
                  setDataCallback: function (e) {
                    var t = this._globalOptions.dataCallback;
                    return (this._globalOptions.dataCallback = q(t, e)), this;
                  },
                  setBreadcrumbCallback: function (e) {
                    var t = this._globalOptions.breadcrumbCallback;
                    return (
                      (this._globalOptions.breadcrumbCallback = q(t, e)), this
                    );
                  },
                  setShouldSendCallback: function (e) {
                    var t = this._globalOptions.shouldSendCallback;
                    return (
                      (this._globalOptions.shouldSendCallback = q(t, e)), this
                    );
                  },
                  setTransport: function (e) {
                    return (this._globalOptions.transport = e), this;
                  },
                  lastException: function () {
                    return this._lastCapturedException;
                  },
                  lastEventId: function () {
                    return this._lastEventId;
                  },
                  isSetup: function () {
                    return (
                      !!this._hasJSON &&
                      (!!this._globalServer ||
                        (this.ravenNotConfiguredError ||
                          ((this.ravenNotConfiguredError = !0),
                          this._logDebug(
                            "error",
                            "Error: Raven has not been configured."
                          )),
                        !1))
                    );
                  },
                  afterLoad: function () {
                    var e = H.RavenConfig;
                    e && this.config(e.dsn, e.config).install();
                  },
                  showReportDialog: function (e) {
                    if (U) {
                      if (
                        !(e = Object.assign(
                          {
                            eventId: this.lastEventId(),
                            dsn: this._dsn,
                            user: this._globalContext.user || {},
                          },
                          e
                        )).eventId
                      )
                        throw new a("Missing eventId");
                      if (!e.dsn) throw new a("Missing DSN");
                      var t = encodeURIComponent,
                        n = [];
                      for (var i in e)
                        if ("user" === i) {
                          var r = e.user;
                          r.name && n.push("name=" + t(r.name)),
                            r.email && n.push("email=" + t(r.email));
                        } else n.push(t(i) + "=" + t(e[i]));
                      var o = this._getGlobalServer(this._parseDSN(e.dsn)),
                        s = U.createElement("script");
                      (s.async = !0),
                        (s.src = o + "/api/embed/error-page/?" + n.join("&")),
                        (U.head || U.body).appendChild(s);
                    }
                  },
                  _ignoreNextOnError: function () {
                    var e = this;
                    (this._ignoreOnError += 1),
                      setTimeout(function () {
                        e._ignoreOnError -= 1;
                      });
                  },
                  _triggerEvent: function (e, t) {
                    var n, i;
                    if (this._hasDocument) {
                      for (i in ((t = t || {}),
                      (e =
                        "raven" + e.substr(0, 1).toUpperCase() + e.substr(1)),
                      U.createEvent
                        ? (n = U.createEvent("HTMLEvents")).initEvent(e, !0, !0)
                        : ((n = U.createEventObject()).eventType = e),
                      t))
                        F(t, i) && (n[i] = t[i]);
                      if (U.createEvent) U.dispatchEvent(n);
                      else
                        try {
                          U.fireEvent("on" + n.eventType.toLowerCase(), n);
                        } catch (e) {}
                    }
                  },
                  _breadcrumbEventHandler: function (e) {
                    var t = this;
                    return function (n) {
                      if (
                        ((t._keypressTimeout = null),
                        t._lastCapturedEvent !== n)
                      ) {
                        var i;
                        t._lastCapturedEvent = n;
                        try {
                          i = T(n.target);
                        } catch (e) {
                          i = "<unknown>";
                        }
                        t.captureBreadcrumb({
                          category: "ui." + e,
                          message: i,
                        });
                      }
                    };
                  },
                  _keypressEventHandler: function () {
                    var e = this;
                    return function (t) {
                      var n;
                      try {
                        n = t.target;
                      } catch (e) {
                        return;
                      }
                      var i = n && n.tagName;
                      if (
                        i &&
                        ("INPUT" === i ||
                          "TEXTAREA" === i ||
                          n.isContentEditable)
                      ) {
                        var r = e._keypressTimeout;
                        r || e._breadcrumbEventHandler("input")(t),
                          clearTimeout(r),
                          (e._keypressTimeout = setTimeout(function () {
                            e._keypressTimeout = null;
                          }, 1e3));
                      }
                    };
                  },
                  _captureUrlChange: function (e, t) {
                    var n = M(this._location.href),
                      i = M(t),
                      r = M(e);
                    (this._lastHref = t),
                      n.protocol === i.protocol &&
                        n.host === i.host &&
                        (t = i.relative),
                      n.protocol === r.protocol &&
                        n.host === r.host &&
                        (e = r.relative),
                      this.captureBreadcrumb({
                        category: "navigation",
                        data: { to: t, from: e },
                      });
                  },
                  _patchFunctionToString: function () {
                    var e = this;
                    (e._originalFunctionToString = Function.prototype.toString),
                      (Function.prototype.toString = function () {
                        return "function" == typeof this && this.__raven__
                          ? e._originalFunctionToString.apply(
                              this.__orig__,
                              arguments
                            )
                          : e._originalFunctionToString.apply(this, arguments);
                      });
                  },
                  _unpatchFunctionToString: function () {
                    this._originalFunctionToString &&
                      (Function.prototype.toString =
                        this._originalFunctionToString);
                  },
                  _instrumentTryCatch: function () {
                    var e = this,
                      t = e._wrappedBuiltIns;
                    function n(t) {
                      return function (n, i) {
                        for (
                          var r = new Array(arguments.length), o = 0;
                          o < r.length;
                          ++o
                        )
                          r[o] = arguments[o];
                        var a = r[0];
                        return (
                          m(a) &&
                            (r[0] = e.wrap(
                              {
                                mechanism: {
                                  type: "instrument",
                                  data: { function: t.name || "<anonymous>" },
                                },
                              },
                              a
                            )),
                          t.apply ? t.apply(this, r) : t(r[0], r[1])
                        );
                      };
                    }
                    var i = this._globalOptions.autoBreadcrumbs;
                    function r(n) {
                      var r = H[n] && H[n].prototype;
                      r &&
                        r.hasOwnProperty &&
                        r.hasOwnProperty("addEventListener") &&
                        (L(
                          r,
                          "addEventListener",
                          function (t) {
                            return function (r, o, a, s) {
                              try {
                                o &&
                                  o.handleEvent &&
                                  (o.handleEvent = e.wrap(
                                    {
                                      mechanism: {
                                        type: "instrument",
                                        data: {
                                          target: n,
                                          function: "handleEvent",
                                          handler:
                                            (o && o.name) || "<anonymous>",
                                        },
                                      },
                                    },
                                    o.handleEvent
                                  ));
                              } catch (e) {}
                              var l, c, d;
                              return (
                                i &&
                                  i.dom &&
                                  ("EventTarget" === n || "Node" === n) &&
                                  ((c = e._breadcrumbEventHandler("click")),
                                  (d = e._keypressEventHandler()),
                                  (l = function (e) {
                                    if (e) {
                                      var t;
                                      try {
                                        t = e.type;
                                      } catch (e) {
                                        return;
                                      }
                                      return "click" === t
                                        ? c(e)
                                        : "keypress" === t
                                        ? d(e)
                                        : void 0;
                                    }
                                  })),
                                t.call(
                                  this,
                                  r,
                                  e.wrap(
                                    {
                                      mechanism: {
                                        type: "instrument",
                                        data: {
                                          target: n,
                                          function: "addEventListener",
                                          handler:
                                            (o && o.name) || "<anonymous>",
                                        },
                                      },
                                    },
                                    o,
                                    l
                                  ),
                                  a,
                                  s
                                )
                              );
                            };
                          },
                          t
                        ),
                        L(
                          r,
                          "removeEventListener",
                          function (e) {
                            return function (t, n, i, r) {
                              try {
                                n =
                                  n &&
                                  (n.__raven_wrapper__
                                    ? n.__raven_wrapper__
                                    : n);
                              } catch (e) {}
                              return e.call(this, t, n, i, r);
                            };
                          },
                          t
                        ));
                    }
                    L(H, "setTimeout", n, t),
                      L(H, "setInterval", n, t),
                      H.requestAnimationFrame &&
                        L(
                          H,
                          "requestAnimationFrame",
                          function (t) {
                            return function (n) {
                              return t(
                                e.wrap(
                                  {
                                    mechanism: {
                                      type: "instrument",
                                      data: {
                                        function: "requestAnimationFrame",
                                        handler: (t && t.name) || "<anonymous>",
                                      },
                                    },
                                  },
                                  n
                                )
                              );
                            };
                          },
                          t
                        );
                    for (
                      var o = [
                          "EventTarget",
                          "Window",
                          "Node",
                          "ApplicationCache",
                          "AudioTrackList",
                          "ChannelMergerNode",
                          "CryptoOperation",
                          "EventSource",
                          "FileReader",
                          "HTMLUnknownElement",
                          "IDBDatabase",
                          "IDBRequest",
                          "IDBTransaction",
                          "KeyOperation",
                          "MediaController",
                          "MessagePort",
                          "ModalWindow",
                          "Notification",
                          "SVGElementInstance",
                          "Screen",
                          "TextTrack",
                          "TextTrackCue",
                          "TextTrackList",
                          "WebSocket",
                          "WebSocketWorker",
                          "Worker",
                          "XMLHttpRequest",
                          "XMLHttpRequestEventTarget",
                          "XMLHttpRequestUpload",
                        ],
                        a = 0;
                      a < o.length;
                      a++
                    )
                      r(o[a]);
                  },
                  _instrumentBreadcrumbs: function () {
                    var e = this,
                      t = this._globalOptions.autoBreadcrumbs,
                      n = e._wrappedBuiltIns;
                    function i(t, n) {
                      t in n &&
                        m(n[t]) &&
                        L(n, t, function (n) {
                          return e.wrap(
                            {
                              mechanism: {
                                type: "instrument",
                                data: {
                                  function: t,
                                  handler: (n && n.name) || "<anonymous>",
                                },
                              },
                            },
                            n
                          );
                        });
                    }
                    if (t.xhr && "XMLHttpRequest" in H) {
                      var r = H.XMLHttpRequest && H.XMLHttpRequest.prototype;
                      L(
                        r,
                        "open",
                        function (t) {
                          return function (n, i) {
                            return (
                              g(i) &&
                                -1 === i.indexOf(e._globalKey) &&
                                (this.__raven_xhr = {
                                  method: n,
                                  url: i,
                                  status_code: null,
                                }),
                              t.apply(this, arguments)
                            );
                          };
                        },
                        n
                      ),
                        L(
                          r,
                          "send",
                          function (t) {
                            return function () {
                              var n = this;
                              function r() {
                                if (n.__raven_xhr && 4 === n.readyState) {
                                  try {
                                    n.__raven_xhr.status_code = n.status;
                                  } catch (e) {}
                                  e.captureBreadcrumb({
                                    type: "http",
                                    category: "xhr",
                                    data: n.__raven_xhr,
                                  });
                                }
                              }
                              for (
                                var o = ["onload", "onerror", "onprogress"],
                                  a = 0;
                                a < o.length;
                                a++
                              )
                                i(o[a], n);
                              return (
                                "onreadystatechange" in n &&
                                m(n.onreadystatechange)
                                  ? L(n, "onreadystatechange", function (t) {
                                      return e.wrap(
                                        {
                                          mechanism: {
                                            type: "instrument",
                                            data: {
                                              function: "onreadystatechange",
                                              handler:
                                                (t && t.name) || "<anonymous>",
                                            },
                                          },
                                        },
                                        t,
                                        r
                                      );
                                    })
                                  : (n.onreadystatechange = r),
                                t.apply(this, arguments)
                              );
                            };
                          },
                          n
                        );
                    }
                    t.xhr &&
                      N() &&
                      L(
                        H,
                        "fetch",
                        function (t) {
                          return function () {
                            for (
                              var n = new Array(arguments.length), i = 0;
                              i < n.length;
                              ++i
                            )
                              n[i] = arguments[i];
                            var r,
                              o = n[0],
                              a = "GET";
                            if (
                              ("string" == typeof o
                                ? (r = o)
                                : "Request" in H && o instanceof H.Request
                                ? ((r = o.url), o.method && (a = o.method))
                                : (r = "" + o),
                              -1 !== r.indexOf(e._globalKey))
                            )
                              return t.apply(this, n);
                            n[1] && n[1].method && (a = n[1].method);
                            var s = { method: a, url: r, status_code: null };
                            return t
                              .apply(this, n)
                              .then(function (t) {
                                return (
                                  (s.status_code = t.status),
                                  e.captureBreadcrumb({
                                    type: "http",
                                    category: "fetch",
                                    data: s,
                                  }),
                                  t
                                );
                              })
                              .catch(function (t) {
                                throw (
                                  (e.captureBreadcrumb({
                                    type: "http",
                                    category: "fetch",
                                    data: s,
                                    level: "error",
                                  }),
                                  t)
                                );
                              });
                          };
                        },
                        n
                      ),
                      t.dom &&
                        this._hasDocument &&
                        (U.addEventListener
                          ? (U.addEventListener(
                              "click",
                              e._breadcrumbEventHandler("click"),
                              !1
                            ),
                            U.addEventListener(
                              "keypress",
                              e._keypressEventHandler(),
                              !1
                            ))
                          : U.attachEvent &&
                            (U.attachEvent(
                              "onclick",
                              e._breadcrumbEventHandler("click")
                            ),
                            U.attachEvent(
                              "onkeypress",
                              e._keypressEventHandler()
                            )));
                    var o = H.chrome,
                      a =
                        !(o && o.app && o.app.runtime) &&
                        H.history &&
                        H.history.pushState &&
                        H.history.replaceState;
                    if (t.location && a) {
                      var s = H.onpopstate;
                      H.onpopstate = function () {
                        var t = e._location.href;
                        if ((e._captureUrlChange(e._lastHref, t), s))
                          return s.apply(this, arguments);
                      };
                      var l = function (t) {
                        return function () {
                          var n = arguments.length > 2 ? arguments[2] : void 0;
                          return (
                            n && e._captureUrlChange(e._lastHref, n + ""),
                            t.apply(this, arguments)
                          );
                        };
                      };
                      L(H.history, "pushState", l, n),
                        L(H.history, "replaceState", l, n);
                    }
                    if (t.console && "console" in H && console.log) {
                      var c = function (t, n) {
                        e.captureBreadcrumb({
                          message: t,
                          level: n.level,
                          category: "console",
                        });
                      };
                      b(
                        ["debug", "info", "warn", "error", "log"],
                        function (e, t) {
                          P(console, t, c);
                        }
                      );
                    }
                  },
                  _restoreBuiltIns: function () {
                    for (var e; this._wrappedBuiltIns.length; ) {
                      var t = (e = this._wrappedBuiltIns.shift())[0],
                        n = e[1],
                        i = e[2];
                      t[n] = i;
                    }
                  },
                  _restoreConsole: function () {
                    for (var e in this._originalConsoleMethods)
                      this._originalConsole[e] =
                        this._originalConsoleMethods[e];
                  },
                  _drainPlugins: function () {
                    var e = this;
                    b(this._plugins, function (t, n) {
                      var i = n[0],
                        r = n[1];
                      i.apply(e, [e].concat(r));
                    });
                  },
                  _parseDSN: function (e) {
                    var t = O.exec(e),
                      n = {},
                      i = 7;
                    try {
                      for (; i--; ) n[I[i]] = t[i] || "";
                    } catch (t) {
                      throw new a("Invalid DSN: " + e);
                    }
                    if (n.pass && !this._globalOptions.allowSecretKey)
                      throw new a(
                        "Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key"
                      );
                    return n;
                  },
                  _getGlobalServer: function (e) {
                    var t = "//" + e.host + (e.port ? ":" + e.port : "");
                    return e.protocol && (t = e.protocol + ":" + t), t;
                  },
                  _handleOnErrorStackInfo: function (e, t) {
                    ((t = t || {}).mechanism = t.mechanism || {
                      type: "onerror",
                      handled: !1,
                    }),
                      this._ignoreOnError || this._handleStackInfo(e, t);
                  },
                  _handleStackInfo: function (e, t) {
                    var n = this._prepareFrames(e, t);
                    this._triggerEvent("handle", { stackInfo: e, options: t }),
                      this._processException(
                        e.name,
                        e.message,
                        e.url,
                        e.lineno,
                        n,
                        t
                      );
                  },
                  _prepareFrames: function (e, t) {
                    var n = this,
                      i = [];
                    if (
                      e.stack &&
                      e.stack.length &&
                      (b(e.stack, function (t, r) {
                        var o = n._normalizeFrame(r, e.url);
                        o && i.push(o);
                      }),
                      t && t.trimHeadFrames)
                    )
                      for (var r = 0; r < t.trimHeadFrames && r < i.length; r++)
                        i[r].in_app = !1;
                    return (i = i.slice(
                      0,
                      this._globalOptions.stackTraceLimit
                    ));
                  },
                  _normalizeFrame: function (e, t) {
                    var n = {
                      filename: e.url,
                      lineno: e.line,
                      colno: e.column,
                      function: e.func || "?",
                    };
                    return (
                      e.url || (n.filename = t),
                      (n.in_app = !(
                        (this._globalOptions.includePaths.test &&
                          !this._globalOptions.includePaths.test(n.filename)) ||
                        /(Raven|TraceKit)\./.test(n.function) ||
                        /raven\.(min\.)?js$/.test(n.filename)
                      )),
                      n
                    );
                  },
                  _processException: function (e, t, n, i, r, o) {
                    var a,
                      s = (e ? e + ": " : "") + (t || "");
                    if (
                      (!this._globalOptions.ignoreErrors.test ||
                        (!this._globalOptions.ignoreErrors.test(t) &&
                          !this._globalOptions.ignoreErrors.test(s))) &&
                      (r && r.length
                        ? ((n = r[0].filename || n),
                          r.reverse(),
                          (a = { frames: r }))
                        : n &&
                          (a = {
                            frames: [{ filename: n, lineno: i, in_app: !0 }],
                          }),
                      (!this._globalOptions.ignoreUrls.test ||
                        !this._globalOptions.ignoreUrls.test(n)) &&
                        (!this._globalOptions.whitelistUrls.test ||
                          this._globalOptions.whitelistUrls.test(n)))
                    ) {
                      var l = w(
                          {
                            exception: {
                              values: [{ type: e, value: t, stacktrace: a }],
                            },
                            transaction: n,
                          },
                          o
                        ),
                        c = l.exception.values[0];
                      null == c.type &&
                        "" === c.value &&
                        (c.value = "Unrecoverable error caught"),
                        !l.exception.mechanism &&
                          l.mechanism &&
                          ((l.exception.mechanism = l.mechanism),
                          delete l.mechanism),
                        (l.exception.mechanism = w(
                          { type: "generic", handled: !0 },
                          l.exception.mechanism || {}
                        )),
                        this._send(l);
                    }
                  },
                  _trimPacket: function (e) {
                    var t = this._globalOptions.maxMessageLength;
                    if (
                      (e.message && (e.message = x(e.message, t)), e.exception)
                    ) {
                      var n = e.exception.values[0];
                      n.value = x(n.value, t);
                    }
                    var i = e.request;
                    return (
                      i &&
                        (i.url &&
                          (i.url = x(i.url, this._globalOptions.maxUrlLength)),
                        i.Referer &&
                          (i.Referer = x(
                            i.Referer,
                            this._globalOptions.maxUrlLength
                          ))),
                      e.breadcrumbs &&
                        e.breadcrumbs.values &&
                        this._trimBreadcrumbs(e.breadcrumbs),
                      e
                    );
                  },
                  _trimBreadcrumbs: function (e) {
                    for (
                      var t, n, i, r = ["to", "from", "url"], o = 0;
                      o < e.values.length;
                      ++o
                    )
                      if (
                        (n = e.values[o]).hasOwnProperty("data") &&
                        h(n.data) &&
                        !C(n.data)
                      ) {
                        i = w({}, n.data);
                        for (var a = 0; a < r.length; ++a)
                          (t = r[a]),
                            i.hasOwnProperty(t) &&
                              i[t] &&
                              (i[t] = x(
                                i[t],
                                this._globalOptions.maxUrlLength
                              ));
                        e.values[o].data = i;
                      }
                  },
                  _getHttpData: function () {
                    if (this._hasNavigator || this._hasDocument) {
                      var e = {};
                      return (
                        this._hasNavigator &&
                          j.userAgent &&
                          (e.headers = { "User-Agent": j.userAgent }),
                        H.location &&
                          H.location.href &&
                          (e.url = H.location.href),
                        this._hasDocument &&
                          U.referrer &&
                          (e.headers || (e.headers = {}),
                          (e.headers.Referer = U.referrer)),
                        e
                      );
                    }
                  },
                  _resetBackoff: function () {
                    (this._backoffDuration = 0), (this._backoffStart = null);
                  },
                  _shouldBackoff: function () {
                    return (
                      this._backoffDuration &&
                      $() - this._backoffStart < this._backoffDuration
                    );
                  },
                  _isRepeatData: function (e) {
                    var t = this._lastData;
                    return (
                      !(
                        !t ||
                        e.message !== t.message ||
                        e.transaction !== t.transaction
                      ) &&
                      (e.stacktrace || t.stacktrace
                        ? A(e.stacktrace, t.stacktrace)
                        : (!e.exception && !t.exception) ||
                          _(e.exception, t.exception))
                    );
                  },
                  _setBackoffState: function (e) {
                    if (!this._shouldBackoff()) {
                      var t = e.status;
                      if (400 === t || 401 === t || 429 === t) {
                        var n;
                        try {
                          (n = N()
                            ? e.headers.get("Retry-After")
                            : e.getResponseHeader("Retry-After")),
                            (n = 1e3 * parseInt(n, 10));
                        } catch (e) {}
                        (this._backoffDuration =
                          n || 2 * this._backoffDuration || 1e3),
                          (this._backoffStart = $());
                      }
                    }
                  },
                  _send: function (e) {
                    var t = this._globalOptions,
                      n = {
                        project: this._globalProject,
                        logger: t.logger,
                        platform: "javascript",
                      },
                      i = this._getHttpData();
                    i && (n.request = i),
                      e.trimHeadFrames && delete e.trimHeadFrames,
                      ((e = w(n, e)).tags = w(
                        w({}, this._globalContext.tags),
                        e.tags
                      )),
                      (e.extra = w(w({}, this._globalContext.extra), e.extra)),
                      (e.extra["session:duration"] = $() - this._startTime),
                      this._breadcrumbs &&
                        this._breadcrumbs.length > 0 &&
                        (e.breadcrumbs = {
                          values: [].slice.call(this._breadcrumbs, 0),
                        }),
                      this._globalContext.user &&
                        (e.user = this._globalContext.user),
                      t.environment && (e.environment = t.environment),
                      t.release && (e.release = t.release),
                      t.serverName && (e.server_name = t.serverName),
                      (e = this._sanitizeData(e)),
                      Object.keys(e).forEach(function (t) {
                        (null == e[t] || "" === e[t] || y(e[t])) && delete e[t];
                      }),
                      m(t.dataCallback) && (e = t.dataCallback(e) || e),
                      e &&
                        !y(e) &&
                        ((m(t.shouldSendCallback) &&
                          !t.shouldSendCallback(e)) ||
                          (this._shouldBackoff()
                            ? this._logDebug(
                                "warn",
                                "Raven dropped error due to backoff: ",
                                e
                              )
                            : "number" == typeof t.sampleRate
                            ? Math.random() < t.sampleRate &&
                              this._sendProcessedPayload(e)
                            : this._sendProcessedPayload(e)));
                  },
                  _sanitizeData: function (e) {
                    return R(e, this._globalOptions.sanitizeKeys);
                  },
                  _getUuid: function () {
                    return E();
                  },
                  _sendProcessedPayload: function (e, t) {
                    var n = this,
                      i = this._globalOptions;
                    if (this.isSetup())
                      if (
                        ((e = this._trimPacket(e)),
                        this._globalOptions.allowDuplicates ||
                          !this._isRepeatData(e))
                      ) {
                        (this._lastEventId =
                          e.event_id || (e.event_id = this._getUuid())),
                          (this._lastData = e),
                          this._logDebug("debug", "Raven about to send:", e);
                        var r = {
                          sentry_version: "7",
                          sentry_client: "raven-js/" + this.VERSION,
                          sentry_key: this._globalKey,
                        };
                        this._globalSecret &&
                          (r.sentry_secret = this._globalSecret);
                        var o = e.exception && e.exception.values[0];
                        this._globalOptions.autoBreadcrumbs &&
                          this._globalOptions.autoBreadcrumbs.sentry &&
                          this.captureBreadcrumb({
                            category: "sentry",
                            message: o
                              ? (o.type ? o.type + ": " : "") + o.value
                              : e.message,
                            event_id: e.event_id,
                            level: e.level || "error",
                          });
                        var a = this._globalEndpoint;
                        (i.transport || this._makeRequest).call(this, {
                          url: a,
                          auth: r,
                          data: e,
                          options: i,
                          onSuccess: function () {
                            n._resetBackoff(),
                              n._triggerEvent("success", { data: e, src: a }),
                              t && t();
                          },
                          onError: function (i) {
                            n._logDebug(
                              "error",
                              "Raven transport failed to send: ",
                              i
                            ),
                              i.request && n._setBackoffState(i.request),
                              n._triggerEvent("failure", { data: e, src: a }),
                              (i =
                                i ||
                                new Error(
                                  "Raven send failed (no additional details provided)"
                                )),
                              t && t(i);
                          },
                        });
                      } else
                        this._logDebug(
                          "warn",
                          "Raven dropped repeat event: ",
                          e
                        );
                  },
                  _makeRequest: function (e) {
                    var t = e.url + "?" + k(e.auth),
                      n = null,
                      i = {};
                    if (
                      (e.options.headers &&
                        (n = this._evaluateHash(e.options.headers)),
                      e.options.fetchParameters &&
                        (i = this._evaluateHash(e.options.fetchParameters)),
                      N())
                    ) {
                      i.body = r(e.data);
                      var o = w({}, this._fetchDefaults),
                        a = w(o, i);
                      return (
                        n && (a.headers = n),
                        H.fetch(t, a)
                          .then(function (t) {
                            if (t.ok) e.onSuccess && e.onSuccess();
                            else {
                              var n = new Error(
                                "Sentry error code: " + t.status
                              );
                              (n.request = t), e.onError && e.onError(n);
                            }
                          })
                          .catch(function () {
                            e.onError &&
                              e.onError(
                                new Error(
                                  "Sentry error code: network unavailable"
                                )
                              );
                          })
                      );
                    }
                    var s = H.XMLHttpRequest && new H.XMLHttpRequest();
                    s &&
                      ("withCredentials" in s ||
                        "undefined" != typeof XDomainRequest) &&
                      ("withCredentials" in s
                        ? (s.onreadystatechange = function () {
                            if (4 === s.readyState)
                              if (200 === s.status)
                                e.onSuccess && e.onSuccess();
                              else if (e.onError) {
                                var t = new Error(
                                  "Sentry error code: " + s.status
                                );
                                (t.request = s), e.onError(t);
                              }
                          })
                        : ((s = new XDomainRequest()),
                          (t = t.replace(/^https?:/, "")),
                          e.onSuccess && (s.onload = e.onSuccess),
                          e.onError &&
                            (s.onerror = function () {
                              var t = new Error(
                                "Sentry error code: XDomainRequest"
                              );
                              (t.request = s), e.onError(t);
                            })),
                      s.open("POST", t),
                      n &&
                        b(n, function (e, t) {
                          s.setRequestHeader(e, t);
                        }),
                      s.send(r(e.data)));
                  },
                  _evaluateHash: function (e) {
                    var t = {};
                    for (var n in e)
                      if (e.hasOwnProperty(n)) {
                        var i = e[n];
                        t[n] = "function" == typeof i ? i() : i;
                      }
                    return t;
                  },
                  _logDebug: function (e) {
                    this._originalConsoleMethods[e] &&
                      (this.debug || this._globalOptions.debug) &&
                      Function.prototype.apply.call(
                        this._originalConsoleMethods[e],
                        this._originalConsole,
                        [].slice.call(arguments, 1)
                      );
                  },
                  _mergeContext: function (e, t) {
                    f(t)
                      ? delete this._globalContext[e]
                      : (this._globalContext[e] = w(
                          this._globalContext[e] || {},
                          t
                        ));
                  },
                }),
                  (W.prototype.setUser = W.prototype.setUserContext),
                  (W.prototype.setReleaseContext = W.prototype.setRelease),
                  (t.exports = W);
              }.call(
                this,
                "undefined" != typeof global
                  ? global
                  : "undefined" != typeof self
                  ? self
                  : "undefined" != typeof window
                  ? window
                  : {}
              ));
            },
            { 1: 1, 2: 2, 5: 5, 6: 6, 7: 7, 8: 8 },
          ],
          4: [
            function (e, t, n) {
              (function (n) {
                var i = e(3),
                  r =
                    "undefined" != typeof window
                      ? window
                      : void 0 !== n
                      ? n
                      : "undefined" != typeof self
                      ? self
                      : {},
                  o = r.Raven,
                  a = new i();
                (a.noConflict = function () {
                  return (r.Raven = o), a;
                }),
                  a.afterLoad(),
                  (t.exports = a),
                  (t.exports.Client = i);
              }.call(
                this,
                "undefined" != typeof global
                  ? global
                  : "undefined" != typeof self
                  ? self
                  : "undefined" != typeof window
                  ? window
                  : {}
              ));
            },
            { 3: 3 },
          ],
          5: [
            function (e, t, n) {
              (function (n) {
                var i = e(7),
                  r =
                    "undefined" != typeof window
                      ? window
                      : void 0 !== n
                      ? n
                      : "undefined" != typeof self
                      ? self
                      : {};
                function o(e) {
                  return void 0 === e;
                }
                function a(e) {
                  return (
                    "[object Object]" === Object.prototype.toString.call(e)
                  );
                }
                function s(e) {
                  return (
                    "[object String]" === Object.prototype.toString.call(e)
                  );
                }
                function l(e) {
                  return "[object Array]" === Object.prototype.toString.call(e);
                }
                function c() {
                  if (!("fetch" in r)) return !1;
                  try {
                    return new Headers(), new Request(""), new Response(), !0;
                  } catch (e) {
                    return !1;
                  }
                }
                function d(e, t) {
                  var n, i;
                  if (o(e.length))
                    for (n in e) h(e, n) && t.call(null, n, e[n]);
                  else if ((i = e.length))
                    for (n = 0; n < i; n++) t.call(null, n, e[n]);
                }
                function u(e, t) {
                  if ("number" != typeof t)
                    throw new Error(
                      "2nd argument to `truncate` function should be a number"
                    );
                  return "string" != typeof e || 0 === t
                    ? e
                    : e.length <= t
                    ? e
                    : e.substr(0, t) + "…";
                }
                function h(e, t) {
                  return Object.prototype.hasOwnProperty.call(e, t);
                }
                function p(e) {
                  for (var t, n = [], i = 0, r = e.length; i < r; i++)
                    s((t = e[i]))
                      ? n.push(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1"))
                      : t && t.source && n.push(t.source);
                  return new RegExp(n.join("|"), "i");
                }
                function f(e) {
                  var t,
                    n,
                    i,
                    r,
                    o,
                    a = [];
                  if (!e || !e.tagName) return "";
                  if (
                    (a.push(e.tagName.toLowerCase()),
                    e.id && a.push("#" + e.id),
                    (t = e.className) && s(t))
                  )
                    for (n = t.split(/\s+/), o = 0; o < n.length; o++)
                      a.push("." + n[o]);
                  var l = ["type", "name", "title", "alt"];
                  for (o = 0; o < l.length; o++)
                    (i = l[o]),
                      (r = e.getAttribute(i)) &&
                        a.push("[" + i + '="' + r + '"]');
                  return a.join("");
                }
                function m(e, t) {
                  return !!(!!e ^ !!t);
                }
                function g(e, t) {
                  if (m(e, t)) return !1;
                  var n,
                    i,
                    r = e.frames,
                    o = t.frames;
                  if (void 0 === r || void 0 === o) return !1;
                  if (r.length !== o.length) return !1;
                  for (var a = 0; a < r.length; a++)
                    if (
                      ((n = r[a]),
                      (i = o[a]),
                      n.filename !== i.filename ||
                        n.lineno !== i.lineno ||
                        n.colno !== i.colno ||
                        n.function !== i.function)
                    )
                      return !1;
                  return !0;
                }
                var v = 3,
                  y = 51200,
                  b = 40;
                function w(e) {
                  return (function (e) {
                    return ~-encodeURI(e).split(/%..|./).length;
                  })(JSON.stringify(e));
                }
                function x(e) {
                  if ("string" == typeof e) {
                    return u(e, 40);
                  }
                  if (
                    "number" == typeof e ||
                    "boolean" == typeof e ||
                    void 0 === e
                  )
                    return e;
                  var t = Object.prototype.toString.call(e);
                  return "[object Object]" === t
                    ? "[Object]"
                    : "[object Array]" === t
                    ? "[Array]"
                    : "[object Function]" === t
                    ? e.name
                      ? "[Function: " + e.name + "]"
                      : "[Function]"
                    : e;
                }
                t.exports = {
                  isObject: function (e) {
                    return "object" == typeof e && null !== e;
                  },
                  isError: function (e) {
                    switch (Object.prototype.toString.call(e)) {
                      case "[object Error]":
                      case "[object Exception]":
                      case "[object DOMException]":
                        return !0;
                      default:
                        return e instanceof Error;
                    }
                  },
                  isErrorEvent: function (e) {
                    return (
                      "[object ErrorEvent]" ===
                      Object.prototype.toString.call(e)
                    );
                  },
                  isDOMError: function (e) {
                    return (
                      "[object DOMError]" === Object.prototype.toString.call(e)
                    );
                  },
                  isDOMException: function (e) {
                    return (
                      "[object DOMException]" ===
                      Object.prototype.toString.call(e)
                    );
                  },
                  isUndefined: o,
                  isFunction: function (e) {
                    return "function" == typeof e;
                  },
                  isPlainObject: a,
                  isString: s,
                  isArray: l,
                  isEmptyObject: function (e) {
                    if (!a(e)) return !1;
                    for (var t in e) if (e.hasOwnProperty(t)) return !1;
                    return !0;
                  },
                  supportsErrorEvent: function () {
                    try {
                      return new ErrorEvent(""), !0;
                    } catch (e) {
                      return !1;
                    }
                  },
                  supportsDOMError: function () {
                    try {
                      return new DOMError(""), !0;
                    } catch (e) {
                      return !1;
                    }
                  },
                  supportsDOMException: function () {
                    try {
                      return new DOMException(""), !0;
                    } catch (e) {
                      return !1;
                    }
                  },
                  supportsFetch: c,
                  supportsReferrerPolicy: function () {
                    if (!c()) return !1;
                    try {
                      return (
                        new Request("pickleRick", { referrerPolicy: "origin" }),
                        !0
                      );
                    } catch (e) {
                      return !1;
                    }
                  },
                  supportsPromiseRejectionEvent: function () {
                    return "function" == typeof PromiseRejectionEvent;
                  },
                  wrappedCallback: function (e) {
                    return function (t, n) {
                      var i = e(t) || t;
                      return (n && n(i)) || i;
                    };
                  },
                  each: d,
                  objectMerge: function (e, t) {
                    return t
                      ? (d(t, function (t, n) {
                          e[t] = n;
                        }),
                        e)
                      : e;
                  },
                  truncate: u,
                  objectFrozen: function (e) {
                    return !!Object.isFrozen && Object.isFrozen(e);
                  },
                  hasKey: h,
                  joinRegExp: p,
                  urlencode: function (e) {
                    var t = [];
                    return (
                      d(e, function (e, n) {
                        t.push(
                          encodeURIComponent(e) + "=" + encodeURIComponent(n)
                        );
                      }),
                      t.join("&")
                    );
                  },
                  uuid4: function () {
                    var e = r.crypto || r.msCrypto;
                    if (!o(e) && e.getRandomValues) {
                      var t = new Uint16Array(8);
                      e.getRandomValues(t),
                        (t[3] = (4095 & t[3]) | 16384),
                        (t[4] = (16383 & t[4]) | 32768);
                      var n = function (e) {
                        for (var t = e.toString(16); t.length < 4; )
                          t = "0" + t;
                        return t;
                      };
                      return (
                        n(t[0]) +
                        n(t[1]) +
                        n(t[2]) +
                        n(t[3]) +
                        n(t[4]) +
                        n(t[5]) +
                        n(t[6]) +
                        n(t[7])
                      );
                    }
                    return "xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(
                      /[xy]/g,
                      function (e) {
                        var t = (16 * Math.random()) | 0;
                        return ("x" === e ? t : (3 & t) | 8).toString(16);
                      }
                    );
                  },
                  htmlTreeAsString: function (e) {
                    for (
                      var t, n = [], i = 0, r = 0, o = " > ".length;
                      e &&
                      i++ < 5 &&
                      !(
                        "html" === (t = f(e)) ||
                        (i > 1 && r + n.length * o + t.length >= 80)
                      );

                    )
                      n.push(t), (r += t.length), (e = e.parentNode);
                    return n.reverse().join(" > ");
                  },
                  htmlElementAsString: f,
                  isSameException: function (e, t) {
                    return (
                      !m(e, t) &&
                      ((e = e.values[0]),
                      (t = t.values[0]),
                      e.type === t.type &&
                        e.value === t.value &&
                        ((n = e.stacktrace),
                        (i = t.stacktrace),
                        (!o(n) || !o(i)) && g(e.stacktrace, t.stacktrace)))
                    );
                    var n, i;
                  },
                  isSameStacktrace: g,
                  parseUrl: function (e) {
                    if ("string" != typeof e) return {};
                    var t = e.match(
                        /^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/
                      ),
                      n = t[6] || "",
                      i = t[8] || "";
                    return {
                      protocol: t[2],
                      host: t[4],
                      path: t[5],
                      relative: t[5] + n + i,
                    };
                  },
                  fill: function (e, t, n, i) {
                    if (null != e) {
                      var r = e[t];
                      (e[t] = n(r)),
                        (e[t].__raven__ = !0),
                        (e[t].__orig__ = r),
                        i && i.push([e, t, r]);
                    }
                  },
                  safeJoin: function (e, t) {
                    if (!l(e)) return "";
                    for (var n = [], i = 0; i < e.length; i++)
                      try {
                        n.push(String(e[i]));
                      } catch (e) {
                        n.push("[value cannot be serialized]");
                      }
                    return n.join(t);
                  },
                  serializeException: function e(t, n, r) {
                    if (!a(t)) return t;
                    r =
                      "number" != typeof (n = "number" != typeof n ? v : n)
                        ? y
                        : r;
                    var o = (function e(t, n) {
                      return 0 === n
                        ? x(t)
                        : a(t)
                        ? Object.keys(t).reduce(function (i, r) {
                            return (i[r] = e(t[r], n - 1)), i;
                          }, {})
                        : Array.isArray(t)
                        ? t.map(function (t) {
                            return e(t, n - 1);
                          })
                        : x(t);
                    })(t, n);
                    return w(i(o)) > r ? e(t, n - 1) : o;
                  },
                  serializeKeysForMessage: function (e, t) {
                    if ("number" == typeof e || "string" == typeof e)
                      return e.toString();
                    if (!Array.isArray(e)) return "";
                    if (
                      0 ===
                      (e = e.filter(function (e) {
                        return "string" == typeof e;
                      })).length
                    )
                      return "[object has no keys]";
                    if (((t = "number" != typeof t ? b : t), e[0].length >= t))
                      return e[0];
                    for (var n = e.length; n > 0; n--) {
                      var i = e.slice(0, n).join(", ");
                      if (!(i.length > t)) return n === e.length ? i : i + "…";
                    }
                    return "";
                  },
                  sanitize: function (e, t) {
                    if (!l(t) || (l(t) && 0 === t.length)) return e;
                    var n,
                      r = p(t),
                      o = "********";
                    try {
                      n = JSON.parse(i(e));
                    } catch (t) {
                      return e;
                    }
                    return (function e(t) {
                      return l(t)
                        ? t.map(function (t) {
                            return e(t);
                          })
                        : a(t)
                        ? Object.keys(t).reduce(function (n, i) {
                            return r.test(i) ? (n[i] = o) : (n[i] = e(t[i])), n;
                          }, {})
                        : t;
                    })(n);
                  },
                };
              }.call(
                this,
                "undefined" != typeof global
                  ? global
                  : "undefined" != typeof self
                  ? self
                  : "undefined" != typeof window
                  ? window
                  : {}
              ));
            },
            { 7: 7 },
          ],
          6: [
            function (e, t, n) {
              (function (n) {
                var i = e(5),
                  r = { collectWindowErrors: !0, debug: !1 },
                  o =
                    "undefined" != typeof window
                      ? window
                      : void 0 !== n
                      ? n
                      : "undefined" != typeof self
                      ? self
                      : {},
                  a = [].slice,
                  s = "?",
                  l =
                    /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;
                function c() {
                  return "undefined" == typeof document ||
                    null == document.location
                    ? ""
                    : document.location.href;
                }
                (r.report = (function () {
                  var e,
                    t,
                    n = [],
                    d = null,
                    u = null,
                    h = null;
                  function p(e, t) {
                    var i = null;
                    if (!t || r.collectWindowErrors) {
                      for (var o in n)
                        if (n.hasOwnProperty(o))
                          try {
                            n[o].apply(null, [e].concat(a.call(arguments, 2)));
                          } catch (e) {
                            i = e;
                          }
                      if (i) throw i;
                    }
                  }
                  function f(t, n, o, a, d) {
                    var u = i.isErrorEvent(d) ? d.error : d,
                      f = i.isErrorEvent(t) ? t.message : t;
                    if (h)
                      r.computeStackTrace.augmentStackTraceWithInitialElement(
                        h,
                        n,
                        o,
                        f
                      ),
                        m();
                    else if (u && i.isError(u)) p(r.computeStackTrace(u), !0);
                    else {
                      var g,
                        v = { url: n, line: o, column: a },
                        y = void 0;
                      if ("[object String]" === {}.toString.call(f))
                        (g = f.match(l)) && ((y = g[1]), (f = g[2]));
                      (v.func = s),
                        p({ name: y, message: f, url: c(), stack: [v] }, !0);
                    }
                    return !!e && e.apply(this, arguments);
                  }
                  function m() {
                    var e = h,
                      t = d;
                    (d = null),
                      (h = null),
                      (u = null),
                      p.apply(null, [e, !1].concat(t));
                  }
                  function g(e, t) {
                    var n = a.call(arguments, 1);
                    if (h) {
                      if (u === e) return;
                      m();
                    }
                    var i = r.computeStackTrace(e);
                    if (
                      ((h = i),
                      (u = e),
                      (d = n),
                      setTimeout(
                        function () {
                          u === e && m();
                        },
                        i.incomplete ? 2e3 : 0
                      ),
                      !1 !== t)
                    )
                      throw e;
                  }
                  return (
                    (g.subscribe = function (i) {
                      t || ((e = o.onerror), (o.onerror = f), (t = !0)),
                        n.push(i);
                    }),
                    (g.unsubscribe = function (e) {
                      for (var t = n.length - 1; t >= 0; --t)
                        n[t] === e && n.splice(t, 1);
                    }),
                    (g.uninstall = function () {
                      t && ((o.onerror = e), (t = !1), (e = void 0)), (n = []);
                    }),
                    g
                  );
                })()),
                  (r.computeStackTrace = (function () {
                    function e(e) {
                      if (void 0 !== e.stack && e.stack) {
                        for (
                          var t,
                            n,
                            i,
                            r =
                              /^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,
                            o =
                              /^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx(?:-web)|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,
                            a =
                              /^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,
                            l = /(\S+) line (\d+)(?: > eval line \d+)* > eval/i,
                            d = /\((\S*)(?::(\d+))(?::(\d+))\)/,
                            u = e.stack.split("\n"),
                            h = [],
                            p = (/^(.*) is undefined$/.exec(e.message), 0),
                            f = u.length;
                          p < f;
                          ++p
                        ) {
                          if ((n = r.exec(u[p]))) {
                            var m = n[2] && 0 === n[2].indexOf("native");
                            n[2] &&
                              0 === n[2].indexOf("eval") &&
                              (t = d.exec(n[2])) &&
                              ((n[2] = t[1]), (n[3] = t[2]), (n[4] = t[3])),
                              (i = {
                                url: m ? null : n[2],
                                func: n[1] || s,
                                args: m ? [n[2]] : [],
                                line: n[3] ? +n[3] : null,
                                column: n[4] ? +n[4] : null,
                              });
                          } else if ((n = o.exec(u[p])))
                            i = {
                              url: n[2],
                              func: n[1] || s,
                              args: [],
                              line: +n[3],
                              column: n[4] ? +n[4] : null,
                            };
                          else {
                            if (!(n = a.exec(u[p]))) continue;
                            n[3] &&
                            n[3].indexOf(" > eval") > -1 &&
                            (t = l.exec(n[3]))
                              ? ((n[3] = t[1]), (n[4] = t[2]), (n[5] = null))
                              : 0 !== p ||
                                n[5] ||
                                void 0 === e.columnNumber ||
                                (h[0].column = e.columnNumber + 1),
                              (i = {
                                url: n[3],
                                func: n[1] || s,
                                args: n[2] ? n[2].split(",") : [],
                                line: n[4] ? +n[4] : null,
                                column: n[5] ? +n[5] : null,
                              });
                          }
                          if (
                            (!i.func && i.line && (i.func = s),
                            i.url && "blob:" === i.url.substr(0, 5))
                          ) {
                            var g = new XMLHttpRequest();
                            if (
                              (g.open("GET", i.url, !1),
                              g.send(null),
                              200 === g.status)
                            ) {
                              var v = g.responseText || "",
                                y = (v = v.slice(-300)).match(
                                  /\/\/# sourceMappingURL=(.*)$/
                                );
                              if (y) {
                                var b = y[1];
                                "~" === b.charAt(0) &&
                                  (b =
                                    ("undefined" == typeof document ||
                                    null == document.location
                                      ? ""
                                      : document.location.origin
                                      ? document.location.origin
                                      : document.location.protocol +
                                        "//" +
                                        document.location.hostname +
                                        (document.location.port
                                          ? ":" + document.location.port
                                          : "")) + b.slice(1)),
                                  (i.url = b.slice(0, -4));
                              }
                            }
                          }
                          h.push(i);
                        }
                        return h.length
                          ? {
                              name: e.name,
                              message: e.message,
                              url: c(),
                              stack: h,
                            }
                          : null;
                      }
                    }
                    function t(e, t, n, i) {
                      var r = { url: t, line: n };
                      if (r.url && r.line) {
                        if (
                          ((e.incomplete = !1),
                          r.func || (r.func = s),
                          e.stack.length > 0 && e.stack[0].url === r.url)
                        ) {
                          if (e.stack[0].line === r.line) return !1;
                          if (!e.stack[0].line && e.stack[0].func === r.func)
                            return (e.stack[0].line = r.line), !1;
                        }
                        return e.stack.unshift(r), (e.partial = !0), !0;
                      }
                      return (e.incomplete = !0), !1;
                    }
                    function n(e, o) {
                      for (
                        var a,
                          l,
                          d =
                            /function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,
                          u = [],
                          h = {},
                          p = !1,
                          f = n.caller;
                        f && !p;
                        f = f.caller
                      )
                        if (f !== i && f !== r.report) {
                          if (
                            ((l = {
                              url: null,
                              func: s,
                              line: null,
                              column: null,
                            }),
                            f.name
                              ? (l.func = f.name)
                              : (a = d.exec(f.toString())) && (l.func = a[1]),
                            void 0 === l.func)
                          )
                            try {
                              l.func = a.input.substring(
                                0,
                                a.input.indexOf("{")
                              );
                            } catch (e) {}
                          h["" + f] ? (p = !0) : (h["" + f] = !0), u.push(l);
                        }
                      o && u.splice(0, o);
                      var m = {
                        name: e.name,
                        message: e.message,
                        url: c(),
                        stack: u,
                      };
                      return (
                        t(
                          m,
                          e.sourceURL || e.fileName,
                          e.line || e.lineNumber,
                          e.message || e.description
                        ),
                        m
                      );
                    }
                    function i(t, i) {
                      var o = null;
                      i = null == i ? 0 : +i;
                      try {
                        if ((o = e(t))) return o;
                      } catch (e) {
                        if (r.debug) throw e;
                      }
                      try {
                        if ((o = n(t, i + 1))) return o;
                      } catch (e) {
                        if (r.debug) throw e;
                      }
                      return { name: t.name, message: t.message, url: c() };
                    }
                    return (
                      (i.augmentStackTraceWithInitialElement = t),
                      (i.computeStackTraceFromStackProp = e),
                      i
                    );
                  })()),
                  (t.exports = r);
              }.call(
                this,
                "undefined" != typeof global
                  ? global
                  : "undefined" != typeof self
                  ? self
                  : "undefined" != typeof window
                  ? window
                  : {}
              ));
            },
            { 5: 5 },
          ],
          7: [
            function (e, t, n) {
              function i(e, t) {
                for (var n = 0; n < e.length; ++n) if (e[n] === t) return n;
                return -1;
              }
              function r(e, t) {
                var n = [],
                  r = [];
                return (
                  null == t &&
                    (t = function (e, t) {
                      return n[0] === t
                        ? "[Circular ~]"
                        : "[Circular ~." + r.slice(0, i(n, t)).join(".") + "]";
                    }),
                  function (o, a) {
                    if (n.length > 0) {
                      var s = i(n, this);
                      ~s ? n.splice(s + 1) : n.push(this),
                        ~s ? r.splice(s, 1 / 0, o) : r.push(o),
                        ~i(n, a) && (a = t.call(this, o, a));
                    } else n.push(a);
                    return null == e
                      ? a instanceof Error
                        ? (function (e) {
                            var t = {
                              stack: e.stack,
                              message: e.message,
                              name: e.name,
                            };
                            for (var n in e)
                              Object.prototype.hasOwnProperty.call(e, n) &&
                                (t[n] = e[n]);
                            return t;
                          })(a)
                        : a
                      : e.call(this, o, a);
                  }
                );
              }
              (t.exports = function (e, t, n, i) {
                return JSON.stringify(e, r(t, i), n);
              }).getSerialize = r;
            },
            {},
          ],
          8: [
            function (e, t, n) {
              function i(e, t) {
                var n = (65535 & e) + (65535 & t);
                return (
                  (((e >> 16) + (t >> 16) + (n >> 16)) << 16) | (65535 & n)
                );
              }
              function r(e, t, n, r, o, a) {
                return i(
                  ((s = i(i(t, e), i(r, a))) << (l = o)) | (s >>> (32 - l)),
                  n
                );
                var s, l;
              }
              function o(e, t, n, i, o, a, s) {
                return r((t & n) | (~t & i), e, t, o, a, s);
              }
              function a(e, t, n, i, o, a, s) {
                return r((t & i) | (n & ~i), e, t, o, a, s);
              }
              function s(e, t, n, i, o, a, s) {
                return r(t ^ n ^ i, e, t, o, a, s);
              }
              function l(e, t, n, i, o, a, s) {
                return r(n ^ (t | ~i), e, t, o, a, s);
              }
              function c(e, t) {
                var n, r, c, d, u;
                (e[t >> 5] |= 128 << t % 32),
                  (e[14 + (((t + 64) >>> 9) << 4)] = t);
                var h = 1732584193,
                  p = -271733879,
                  f = -1732584194,
                  m = 271733878;
                for (n = 0; n < e.length; n += 16)
                  (r = h),
                    (c = p),
                    (d = f),
                    (u = m),
                    (p = l(
                      (p = l(
                        (p = l(
                          (p = l(
                            (p = s(
                              (p = s(
                                (p = s(
                                  (p = s(
                                    (p = a(
                                      (p = a(
                                        (p = a(
                                          (p = a(
                                            (p = o(
                                              (p = o(
                                                (p = o(
                                                  (p = o(
                                                    p,
                                                    (f = o(
                                                      f,
                                                      (m = o(
                                                        m,
                                                        (h = o(
                                                          h,
                                                          p,
                                                          f,
                                                          m,
                                                          e[n],
                                                          7,
                                                          -680876936
                                                        )),
                                                        p,
                                                        f,
                                                        e[n + 1],
                                                        12,
                                                        -389564586
                                                      )),
                                                      h,
                                                      p,
                                                      e[n + 2],
                                                      17,
                                                      606105819
                                                    )),
                                                    m,
                                                    h,
                                                    e[n + 3],
                                                    22,
                                                    -1044525330
                                                  )),
                                                  (f = o(
                                                    f,
                                                    (m = o(
                                                      m,
                                                      (h = o(
                                                        h,
                                                        p,
                                                        f,
                                                        m,
                                                        e[n + 4],
                                                        7,
                                                        -176418897
                                                      )),
                                                      p,
                                                      f,
                                                      e[n + 5],
                                                      12,
                                                      1200080426
                                                    )),
                                                    h,
                                                    p,
                                                    e[n + 6],
                                                    17,
                                                    -1473231341
                                                  )),
                                                  m,
                                                  h,
                                                  e[n + 7],
                                                  22,
                                                  -45705983
                                                )),
                                                (f = o(
                                                  f,
                                                  (m = o(
                                                    m,
                                                    (h = o(
                                                      h,
                                                      p,
                                                      f,
                                                      m,
                                                      e[n + 8],
                                                      7,
                                                      1770035416
                                                    )),
                                                    p,
                                                    f,
                                                    e[n + 9],
                                                    12,
                                                    -1958414417
                                                  )),
                                                  h,
                                                  p,
                                                  e[n + 10],
                                                  17,
                                                  -42063
                                                )),
                                                m,
                                                h,
                                                e[n + 11],
                                                22,
                                                -1990404162
                                              )),
                                              (f = o(
                                                f,
                                                (m = o(
                                                  m,
                                                  (h = o(
                                                    h,
                                                    p,
                                                    f,
                                                    m,
                                                    e[n + 12],
                                                    7,
                                                    1804603682
                                                  )),
                                                  p,
                                                  f,
                                                  e[n + 13],
                                                  12,
                                                  -40341101
                                                )),
                                                h,
                                                p,
                                                e[n + 14],
                                                17,
                                                -1502002290
                                              )),
                                              m,
                                              h,
                                              e[n + 15],
                                              22,
                                              1236535329
                                            )),
                                            (f = a(
                                              f,
                                              (m = a(
                                                m,
                                                (h = a(
                                                  h,
                                                  p,
                                                  f,
                                                  m,
                                                  e[n + 1],
                                                  5,
                                                  -165796510
                                                )),
                                                p,
                                                f,
                                                e[n + 6],
                                                9,
                                                -1069501632
                                              )),
                                              h,
                                              p,
                                              e[n + 11],
                                              14,
                                              643717713
                                            )),
                                            m,
                                            h,
                                            e[n],
                                            20,
                                            -373897302
                                          )),
                                          (f = a(
                                            f,
                                            (m = a(
                                              m,
                                              (h = a(
                                                h,
                                                p,
                                                f,
                                                m,
                                                e[n + 5],
                                                5,
                                                -701558691
                                              )),
                                              p,
                                              f,
                                              e[n + 10],
                                              9,
                                              38016083
                                            )),
                                            h,
                                            p,
                                            e[n + 15],
                                            14,
                                            -660478335
                                          )),
                                          m,
                                          h,
                                          e[n + 4],
                                          20,
                                          -405537848
                                        )),
                                        (f = a(
                                          f,
                                          (m = a(
                                            m,
                                            (h = a(
                                              h,
                                              p,
                                              f,
                                              m,
                                              e[n + 9],
                                              5,
                                              568446438
                                            )),
                                            p,
                                            f,
                                            e[n + 14],
                                            9,
                                            -1019803690
                                          )),
                                          h,
                                          p,
                                          e[n + 3],
                                          14,
                                          -187363961
                                        )),
                                        m,
                                        h,
                                        e[n + 8],
                                        20,
                                        1163531501
                                      )),
                                      (f = a(
                                        f,
                                        (m = a(
                                          m,
                                          (h = a(
                                            h,
                                            p,
                                            f,
                                            m,
                                            e[n + 13],
                                            5,
                                            -1444681467
                                          )),
                                          p,
                                          f,
                                          e[n + 2],
                                          9,
                                          -51403784
                                        )),
                                        h,
                                        p,
                                        e[n + 7],
                                        14,
                                        1735328473
                                      )),
                                      m,
                                      h,
                                      e[n + 12],
                                      20,
                                      -1926607734
                                    )),
                                    (f = s(
                                      f,
                                      (m = s(
                                        m,
                                        (h = s(
                                          h,
                                          p,
                                          f,
                                          m,
                                          e[n + 5],
                                          4,
                                          -378558
                                        )),
                                        p,
                                        f,
                                        e[n + 8],
                                        11,
                                        -2022574463
                                      )),
                                      h,
                                      p,
                                      e[n + 11],
                                      16,
                                      1839030562
                                    )),
                                    m,
                                    h,
                                    e[n + 14],
                                    23,
                                    -35309556
                                  )),
                                  (f = s(
                                    f,
                                    (m = s(
                                      m,
                                      (h = s(
                                        h,
                                        p,
                                        f,
                                        m,
                                        e[n + 1],
                                        4,
                                        -1530992060
                                      )),
                                      p,
                                      f,
                                      e[n + 4],
                                      11,
                                      1272893353
                                    )),
                                    h,
                                    p,
                                    e[n + 7],
                                    16,
                                    -155497632
                                  )),
                                  m,
                                  h,
                                  e[n + 10],
                                  23,
                                  -1094730640
                                )),
                                (f = s(
                                  f,
                                  (m = s(
                                    m,
                                    (h = s(
                                      h,
                                      p,
                                      f,
                                      m,
                                      e[n + 13],
                                      4,
                                      681279174
                                    )),
                                    p,
                                    f,
                                    e[n],
                                    11,
                                    -358537222
                                  )),
                                  h,
                                  p,
                                  e[n + 3],
                                  16,
                                  -722521979
                                )),
                                m,
                                h,
                                e[n + 6],
                                23,
                                76029189
                              )),
                              (f = s(
                                f,
                                (m = s(
                                  m,
                                  (h = s(h, p, f, m, e[n + 9], 4, -640364487)),
                                  p,
                                  f,
                                  e[n + 12],
                                  11,
                                  -421815835
                                )),
                                h,
                                p,
                                e[n + 15],
                                16,
                                530742520
                              )),
                              m,
                              h,
                              e[n + 2],
                              23,
                              -995338651
                            )),
                            (f = l(
                              f,
                              (m = l(
                                m,
                                (h = l(h, p, f, m, e[n], 6, -198630844)),
                                p,
                                f,
                                e[n + 7],
                                10,
                                1126891415
                              )),
                              h,
                              p,
                              e[n + 14],
                              15,
                              -1416354905
                            )),
                            m,
                            h,
                            e[n + 5],
                            21,
                            -57434055
                          )),
                          (f = l(
                            f,
                            (m = l(
                              m,
                              (h = l(h, p, f, m, e[n + 12], 6, 1700485571)),
                              p,
                              f,
                              e[n + 3],
                              10,
                              -1894986606
                            )),
                            h,
                            p,
                            e[n + 10],
                            15,
                            -1051523
                          )),
                          m,
                          h,
                          e[n + 1],
                          21,
                          -2054922799
                        )),
                        (f = l(
                          f,
                          (m = l(
                            m,
                            (h = l(h, p, f, m, e[n + 8], 6, 1873313359)),
                            p,
                            f,
                            e[n + 15],
                            10,
                            -30611744
                          )),
                          h,
                          p,
                          e[n + 6],
                          15,
                          -1560198380
                        )),
                        m,
                        h,
                        e[n + 13],
                        21,
                        1309151649
                      )),
                      (f = l(
                        f,
                        (m = l(
                          m,
                          (h = l(h, p, f, m, e[n + 4], 6, -145523070)),
                          p,
                          f,
                          e[n + 11],
                          10,
                          -1120210379
                        )),
                        h,
                        p,
                        e[n + 2],
                        15,
                        718787259
                      )),
                      m,
                      h,
                      e[n + 9],
                      21,
                      -343485551
                    )),
                    (h = i(h, r)),
                    (p = i(p, c)),
                    (f = i(f, d)),
                    (m = i(m, u));
                return [h, p, f, m];
              }
              function d(e) {
                var t,
                  n = "",
                  i = 32 * e.length;
                for (t = 0; t < i; t += 8)
                  n += String.fromCharCode((e[t >> 5] >>> t % 32) & 255);
                return n;
              }
              function u(e) {
                var t,
                  n = [];
                for (
                  n[(e.length >> 2) - 1] = void 0, t = 0;
                  t < n.length;
                  t += 1
                )
                  n[t] = 0;
                var i = 8 * e.length;
                for (t = 0; t < i; t += 8)
                  n[t >> 5] |= (255 & e.charCodeAt(t / 8)) << t % 32;
                return n;
              }
              function h(e) {
                var t,
                  n,
                  i = "";
                for (n = 0; n < e.length; n += 1)
                  (t = e.charCodeAt(n)),
                    (i +=
                      "0123456789abcdef".charAt((t >>> 4) & 15) +
                      "0123456789abcdef".charAt(15 & t));
                return i;
              }
              function p(e) {
                return unescape(encodeURIComponent(e));
              }
              function f(e) {
                return (function (e) {
                  return d(c(u(e), 8 * e.length));
                })(p(e));
              }
              function m(e, t) {
                return (function (e, t) {
                  var n,
                    i,
                    r = u(e),
                    o = [],
                    a = [];
                  for (
                    o[15] = a[15] = void 0,
                      r.length > 16 && (r = c(r, 8 * e.length)),
                      n = 0;
                    n < 16;
                    n += 1
                  )
                    (o[n] = 909522486 ^ r[n]), (a[n] = 1549556828 ^ r[n]);
                  return (
                    (i = c(o.concat(u(t)), 512 + 8 * t.length)),
                    d(c(a.concat(i), 640))
                  );
                })(p(e), p(t));
              }
              t.exports = function (e, t, n) {
                return t ? (n ? m(t, e) : h(m(t, e))) : n ? f(e) : h(f(e));
              };
            },
            {},
          ],
        },
        {},
        [4]
      )(4);
    }),
    "object" == typeof exports && void 0 !== module
      ? (module.exports = f())
      : $__System.registerDynamic("55", [], !1, function (e, t, n) {
          return f.call(this);
        }),
    $__System.registerDynamic("51", ["55"], !0, function (e, t, n) {
      var i = this || self,
        r = e("55");
      function o() {
        var e = new Date().getTime();
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
          /[xy]/g,
          function (t) {
            var n = (e + 16 * Math.random()) % 16 | 0;
            return (
              (e = Math.floor(e / 16)),
              ("x" == t ? n : (3 & n) | 8).toString(16)
            );
          }
        );
      }
      var a = () =>
          !window.debugMode &&
          File &&
          File.option &&
          File.option.sendAnonymousUsage,
        s = function () {
          (this.sendInterval = -1),
            (this.lastSend = 0),
            (this.initialized = !1);
        };
      (s.prototype.record = function (e) {
        try {
          if (!e || !this.initialized) return;
          "string" == typeof e && (e = { message: e }),
            (e.fromApp = !0),
            r.captureBreadcrumb(e),
            e.message;
        } catch (e) {}
      }),
        (s.prototype.error = function (e, t) {
          if (this.initialized)
            try {
              "string" == typeof e
                ? r.captureMessage(e, t)
                : r.captureException(e, t);
            } catch (e) {}
        }),
        (s.prototype.sanitizeDom = function (e) {
          var t = "<dom>";
          return e
            ? (e.nodeType !== e.ELEMENT_NODE
                ? (t += "[nodeType=" + e.nodeType + "]")
                : ((t += e.tagName),
                  e.getAttribute("cid") &&
                    ((t += "[cid=" + e.getAttribute("cid") + "]"),
                    (t += "[type=" + e.getAttribute("mdtype") + "]"),
                    (t += "[class=" + e.getAttribute("class") + "]"))),
              t)
            : t + "null";
        }),
        (s.prototype.assert = function (e) {
          if (i.debugMode && !e) throw new Error("assert fail");
        }),
        (s.prototype.fullValidate = function (e) {
          if (i.debugMode || e) {
            var t = File.editor.nodeMap.blocks.sortedFirst(),
              n = document.querySelector(`[cid="${t.cid}"]`);
            try {
              r(n, t);
            } catch (e) {
              throw (window.alert("error"), e);
            }
          }
          function r(e, t) {
            var n = e,
              i = t;
            if (
              e.previousElementSibling &&
              e.previousElementSibling.getAttribute("cid")
            )
              throw (
                (console.log(t),
                console.error(e),
                new Error(`fullValidate fail under ${i.cid}`))
              );
            for (; i; ) {
              if ("table_row" == i.get("type") || "table_row" == i.get("type"))
                return;
              o(n, i), (i = i.get("after")), (n = n.nextElementSibling);
            }
            if (n)
              throw (
                (console.error(n),
                new Error(`fullValidate fail for ${n.getAttribute("cid")}`))
              );
          }
          function o(e, t) {
            var n = e.getAttribute("mdtype");
            if (n == t.get("type") && e.getAttribute("cid") == t.cid) {
              var i = t.getFirstChild();
              if (!i) {
                if (
                  "list" == n ||
                  "list_item" == n ||
                  "blockquote" == n ||
                  "table" == n.substring(0, "table".length)
                )
                  throw new Error(`no children for ${n} ${t.cid}`);
                if (e.querySelector("[cid]"))
                  throw (
                    (console.log(t),
                    console.error(e),
                    new Error(`fullValidate under for ${t.cid}`))
                  );
                return !0;
              }
              return r(e.querySelector(`[cid="${i.cid}"]`), i);
            }
            throw (
              (console.log(t),
              console.error(e),
              new Error(`fullValidate fail for ${t.cid}`))
            );
          }
        }),
        (s.prototype.sanitizeData = function (e) {
          if (e) {
            var t = e.stacktrace || [];
            ((e.exception || {}).values || []).forEach(function (e, n) {
              e &&
                (e.value &&
                  (e.value = e.value.replace(
                    /[^\s."'{]+\.(md|mmd|markdown|mdwn|txt|text)/g,
                    "{filepath}"
                  )),
                e.stacktrace &&
                  e.stacktrace.frames &&
                  (t = t.concat(e.stacktrace.frames)));
            }),
              t.length &&
                t.forEach(function (e) {
                  var t = -1;
                  File.isNode && (t = e.filename.lastIndexOf("typora://app")),
                    -1 == t && (t = e.filename.lastIndexOf("TypeMark")),
                    t > -1 &&
                      (e.filename = e.filename
                        .substring(t)
                        .replace(/\\/g, "/")
                        .replace(/#[^.\/]*$/, "")
                        .replace("lib.asar", "lib")
                        .replace(
                          /^(typora:\/\/app\/typemark)\/(.+)$/,
                          "http://typora/$2"
                        )
                        .replace(/([^\/:])(?:\/{2,})/g, "$1/"));
                });
          }
        }),
        (s.prototype.install = function () {
          if (!this.initialized && window._options) {
            var e = this,
              t = window._options.buildTime,
              n = window._options.tooOldToReport,
              i = 0.1,
              s = new Date() - t;
            isNaN(t) ||
              (s > 864e5 * (File.option.devVersion ? 45 : 20) && (n = !0),
              s > 3456e5 && (i = 0.03),
              s > 6048e5 && (i = 0.02),
              s > 1296e6 && (i = 0.01),
              s > 2592e6 && (i = 0.001)),
              File.option.devVersion && (i = Math.min(0.4, 8 * i));
            var l = {
              autoBreadcrumbs: { xhr: !1, console: !1, location: !1, dom: !1 },
              logger: "render",
              release:
                "<%= releaseHash %>" == window._releaseNo
                  ? void 0
                  : window._releaseNo,
              sanitizeKeys: [],
            };
            !window.debugMode && window._options
              ? (r
                  .config(
                    "https://41af752e6d61480d85276af874a7f69b@sentry.typora.io/2",
                    l
                  )
                  .install(),
                r.setTagsContext({ conversation: o() }),
                r.setShouldSendCallback(function (t) {
                  if ((!File.isMac && n) || !a() || File.option.hasUpdates)
                    return !1;
                  var r = t.message || "";
                  if (
                    (r.indexOf("EPERM") > -1 || r.indexOf("ENOENT") > -1) &&
                    r.indexOf("Typora\\draftsRecover") > -1
                  )
                    return !1;
                  if (new Date() - e.lastSend > e.sendInterval) {
                    if (Math.random() < i) return !0;
                    if ("detect data lost" == t.message) return !0;
                  }
                }),
                r.setDataCallback(function (t) {
                  try {
                    if (((e.lastSend = new Date()), !t)) return;
                    if (
                      (t.request && (t.request.url = "http://typora/"),
                      t.mechanism && delete t.mechanism,
                      t.transaction)
                    ) {
                      var n = t.transaction.split(/[\/\\]/) || [];
                      (t.transaction = n.last().replace(/[#][^.\/]*$/, "")),
                        n.length >= 2 &&
                          (t.transaction =
                            n[n.length - 2] + "/" + t.transaction);
                    }
                    return (
                      t.exception && e.sanitizeData(t),
                      "detect data lost" != t.message &&
                        "[logic error]" != t.message &&
                        t.breadcrumbs &&
                        (t.breadcrumbs.values = t.breadcrumbs.values.filter(
                          (e) => "exeCommand" != e.fromSource
                        )),
                      t
                    );
                  } catch (e) {}
                  return t;
                }),
                r.setBreadcrumbCallback(function (e) {
                  try {
                    return (
                      !(!e.fromApp && "sentry" != e.category) &&
                      (delete e.fromApp, e)
                    );
                  } catch (e) {}
                }),
                r.setTagsContext({
                  appVersion: File.option.appVersion,
                  instance: File.option.instance,
                  arch: window.process ? process.arch : "x64",
                  lang: File.option.userLocale,
                }),
                r.setExtraContext({
                  setting: {
                    indentSize: File.option.indentSize,
                    mountFolder: File.mountFolder_,
                    isFocusMode: File.option.isFocusMode,
                    isTypeWriterMode: File.option.isTypeWriterMode,
                    ignoreLineBreak: File.option.ignoreLineBreak,
                    enableAutoSave: File.option.enableAutoSave,
                    enableDiagram: File.option.enableDiagram,
                    enableInlineMath: File.option.enableInlineMath,
                    theme: File.option.curTheme,
                    strictMarkdown: File.option.strictMarkdown,
                    zoomFactor: File.option.zoomFactor,
                    smartQuote: File.option.smartQuote,
                  },
                }),
                r.setUserContext({ id: File.option.uuid }),
                window.reqnode &&
                  window.debugMode &&
                  (process.traceDeprecation = !0),
                (window.onerror = function (e, t, n, i, r) {
                  r
                    ? (console.sendError && console.sendError(r), r.message)
                    : console.sendError &&
                      console.sendError(t + ":" + n + "\n" + e);
                }),
                (this.initialized = !0),
                this.record("renderer process start"))
              : (l.instrument = { tryCatch: !1 });
          }
        }),
        (s.prototype.processDom = function (e) {
          try {
            var t = e.clone();
            return (
              t
                .find("[cid]")
                .removeAttr("class")
                .removeAttr("contentediable")
                .filter(function () {
                  return !this.querySelector("[cid]");
                })
                .html(function () {
                  return this.getAttribute("cid");
                }),
              t.html()
            );
          } catch (e) {
            s.error(e);
          }
        }),
        (s.prototype.buildNodeSnip = function () {
          return File.editor.nodeMap.blocks.map(function e(t) {
            if (t.isDeleted()) return "[node deleted]";
            var n = [];
            return (
              t.get("children").sortedForEach((t) => {
                n.push(e(t));
              }),
              { cid: t.cid, type: t.get("type"), children: n }
            );
          });
        });
      var l = new Date();
      (s.prototype.buildExtraDebugInfo = async function () {
        var e, t, n, r;
        e = this.processDom($("#write"));
        try {
          t = this.buildNodeSnip();
        } catch (e) {
          n = e.stack;
        }
        if (File.isNode)
          try {
            const e = i.process,
              t = await Promise.all([
                e.getSystemMemoryInfo(),
                e.getProcessMemoryInfo(),
                e.getBlinkMemoryInfo(),
              ]);
            r = { system: t[0], process: t[1], blink: t[2] };
          } catch (e) {
            n = n + "\n" + e.stack;
          }
        return {
          htmlSnip: e,
          nodeSnip: t,
          memory: r,
          enableAutoSave: File.option.enableAutoSave,
          useIME: File.editor.useIMEKeyboard,
          inBusyMode: File.inBusyMode,
          timePass: new Date() - l,
          msg: n,
        };
      }),
        (s.prototype.reportLogicError = function (e, t) {
          var n = new Error("[logic error]");
          (n.stack = e + "\t" + n.stack.split("\n").join("\n")),
            console.sendError(`[logic error] ${e}`, !0),
            this.buildExtraDebugInfo().then((e) => {
              (e.detail = t), this.error(n, { extra: e });
            }),
            File.showDataLostError();
        });
      var c = new s();
      (t.Reporter = c), (window.Reporter = c);
      const d = "4eeda6df022d46e1ab4d602858fd58e3";
      var u,
        h,
        p,
        f = new Date(),
        m = function () {
          (this.pinpoint = null),
            (this.buffers = []),
            (this.loadLib = new Promise((e) => {
              $.getScript(
                window.debugMode
                  ? "./lib/aws-sdk.js"
                  : window.reqnode
                  ? "./lib.asar/aws-sdk.min.js"
                  : "./lib/aws-sdk.min.js",
                e
              );
            }));
        };
      m.prototype.install = function () {
        (u = File.option.uuid),
          (h = File.option.instance),
          u &&
            h &&
            ((p = o()),
            this.loadLib.then(() => {
              if (a()) {
                var e = new AWS.CognitoIdentityCredentials({
                  IdentityPoolId:
                    "us-west-2:146e5a95-002f-46c1-b09e-05b32fc3280b",
                });
                (AWS.config = new AWS.Config({
                  credentials: e,
                  region: "us-west-2",
                })),
                  (this.pinpoint = new AWS.Pinpoint({
                    apiVersion: "2016-12-01",
                  })),
                  this.start(),
                  this.flush();
              }
            }),
            File.isMac &&
              bridge.registerHandler("Analytics.record", (e, t) => {
                this.record(e[0], e[1]), t && t();
              }));
      };
      var g = (e, t, n) => {
          var i = {
            Address: u,
            Attributes: ((e) => {
              if (!e) return {};
              var t = {};
              return (
                Object.keys(e).forEach((n) => {
                  var i = e[n];
                  "string" == typeof i
                    ? (t[n] = [i])
                    : i instanceof Array && (t[n] = i);
                }),
                t
              );
            })(e),
            ChannelType: "APNS",
            EffectiveDate: new Date().toISOString(),
            EndpointStatus: "ACTIVE",
            OptOut: "ALL",
            User: { UserAttributes: {}, UserId: u },
          };
          return n && (i.Location = n), t && (i.Demographic = t), i;
        },
        v = (e, t) => {
          var n = {};
          return (
            (n[o()] = {
              EventType: e,
              Timestamp: new Date().toISOString(),
              Attributes: Object.assign({}, t),
              Session: (() => ({
                Id: p,
                StartTimestamp: f.toISOString(),
                Duration: new Date() - f,
              }))(),
            }),
            n
          );
        };
      (m.prototype.start = async function () {
        var e = (File.option.userLocale || File.option.locale || "").replace(
          "-",
          "_"
        );
        "Base" == e && (e = "en_US");
        var t = {
          AppVersion: File.option.appVersion,
          Locale: e,
          Platform: "macOS",
        };
        window.reqnode
          ? (JSBridge.invoke("setting.fetchAnalytics").then((e) => {
              var t = JSON.parse(e);
              this.flush(t);
            }),
            (t.Platform = process.platform))
          : bridge.callHandler("setting.fetchAnalytics", {}, (e) => {
              this.flush(e);
            }),
          (t.Make = await (async function (e) {
            var t = e,
              n = window.navigator.userAgent;
            if ("win32" == e)
              (t = "Windows"),
                n.indexOf("Windows NT 10") > -1
                  ? (t =
                      t + " 10 " + ("x64" === process.arch ? "(64)" : "(32)"))
                  : n.indexOf("Windows NT 6.3") > -1
                  ? (t =
                      t + " 8.1 " + ("x64" === process.arch ? "(64)" : "(32)"))
                  : n.indexOf("Windows NT 6.2") > -1
                  ? (t = t + " 8 " + ("x64" === process.arch ? "(64)" : "(32)"))
                  : n.indexOf("Windows NT 6.1") > -1 &&
                    (t =
                      t + " 7 " + ("x64" === process.arch ? "(64)" : "(32)"));
            else if ("linux" === e)
              try {
                let e = reqnode("getos");
                t = await new Promise((t) => {
                  e(function (e, t) {
                    return e ? "Linux" : t.dist;
                  });
                });
              } catch (e) {
                t = "Linux";
              }
            else
              "macOS" === e &&
                (t =
                  "macOS " +
                  ((/Mac OS X (10_[0-9_]+)/.exec(n) || [])[1] || "")
                    .replace(/_/, ".")
                    .replace(/_.+/, ""));
            return t;
          })(t.Platform));
        const n = new Date();
        var i = {
            theme: File.option.curTheme,
            lastSeen: n.getUTCFullYear() + "" + (n.getMonth() + 1),
            majorVersion: File.option.appVersion.replace(/\.[^.]+$/, ""),
          },
          r = File.isWin ? "win" : File.isMac ? "mac" : "linux";
        (i[`${r}Arch`] = File.option.arch),
          (i.releaseType = File.option.devVersion ? "dev" : "stable"),
          File.option.devVersion
            ? ((i[`${r}DevHasLicense`] = File.option.hasLicense ? "YES" : "NO"),
              (i[`${r}HasLicense`] = "undefined"),
              (i.StableHasLicense = "undefined"),
              (i.DevHasLicense = File.option.hasLicense ? "YES" : "NO"))
            : ((i[`${r}HasLicense`] = File.option.hasLicense ? "YES" : "NO"),
              (i[`${r}DevHasLicense`] = "undefined"),
              (i.StableHasLicense = File.option.hasLicense ? "YES" : "NO"),
              (i.DevHasLicense = "undefined")),
          (i.hasLicense = File.option.hasLicense ? "YES" : "NO"),
          File.option.devVersion ||
            (File.option.hasLicense
              ? (i.upgradePolicy = File.option.enableAutoUpdate
                  ? File.option.autoUpdateToDev
                    ? "dev"
                    : "stable"
                  : "off")
              : (i.upgradePolicy = "none")),
          File.option.devVersion ||
            File.isLinux ||
            (i.trail = File.option.hasLicense ? "ACTIVATED" : "TRAIL"),
          this.updateContext(i, t);
      }),
        (m.prototype.updateContext = function (e, t, n) {
          try {
            if (!a()) return;
            if (!this.pinpoint)
              return void this.buffers.push(["updateContext", e]);
            var i = {
              ApplicationId: d,
              EndpointId: u,
              EndpointRequest: g(e, t, n),
            };
            this.pinpoint.updateEndpoint(i, function (e, t) {
              e ? console.warn(e, e.stack) : window.debugMode;
            });
          } catch (e) {
            console.warn(e);
          }
        }),
        (m.prototype.record = function (e, t) {
          try {
            if (!a()) return;
            if (!this.pinpoint) return void this.buffers.push([e, t]);
            var n = { ApplicationId: d, EventsRequest: { BatchItem: {} } };
            (n.EventsRequest.BatchItem[u] = { Endpoint: {} }),
              (n.EventsRequest.BatchItem[u].Events = v(e, t)),
              this.pinpoint.putEvents(n, function (e, t) {
                e ? console.warn(e, e.stack) : window.debugMode;
              });
          } catch (e) {
            console.warn(e);
          }
        });
      var y = 1;
      (m.prototype.updateLocation = function () {
        fetch("https://typora.io/api/endpoint")
          .then((e) => {
            if (200 === e.status) return e.text();
            throw new Error("wrong response status");
          })
          .then((e) => {
            if (e) {
              var t = window.atob(e).split(":");
              this.updateContext({}, null, {
                City: t[0],
                Region: t[1],
                Country: t[2],
              });
            }
          })
          .catch((e) => {
            this.updateContext({}, null, { Country: "XX" }),
              setTimeout(this.updateLocation.bind(this), 10 * y * 1e3),
              (y *= 4);
          });
      }),
        (m.prototype.flush = function (e) {
          try {
            if (!a()) return;
            if (!this.pinpoint) return;
            for (var t of e || this.buffers)
              "updateContext" == t[0]
                ? this.updateContext(t[1])
                : "updateLocation" == t[0]
                ? this.updateLocation()
                : this.record(t[0], t[1]);
            this.buffers = [];
          } catch (t) {
            console.warn(t);
          }
        });
      var b = new m();
      (t.Analytics = b), (window.Analytics = b);
    }),
    $__System.registerDynamic(
      "47",
      [
        "e",
        "11",
        "1b",
        "13",
        "2b",
        "28",
        "32",
        "4f",
        "48",
        "53",
        "33",
        "50",
        "34",
        "52",
        "54",
        "51",
      ],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r = e("e"),
          o = e("11"),
          a = e("1b"),
          s = (a.SnapFlag, e("13")),
          l = (s.Node, s.TYPE, e("2b").safePromise, e("28")),
          c = e("32"),
          d = e("4f"),
          u = e("48"),
          h = e("53"),
          p = e("33"),
          f = e("50"),
          m = e("34"),
          g = (e("52"), c.ChangeCounter),
          v = (c.ChangeType, e("54"), e("51").Reporter),
          y = ["md", "markdown", "mmd", "mkd", "mdwn", "mdown", "mdx"],
          b = {
            Markdown: "markdown",
            TextBundle: "textbundle",
            TextPack: "textpack",
          },
          w = {
            OVERSIZE: "OVERSIZE",
            UNSUPPORTED: "UNSUPPORTED",
            OTHER_FILE: "OTHER_FILE",
          },
          x = [
            "mdtxt",
            "mdtext",
            "apib",
            "rmarkdown",
            "rmd",
            "qmd",
            "txt",
            "text",
          ].concat(y),
          C = {
            FileSave: h,
            FileType: b,
            MarkdownFiles: y,
            SupportedTextFiles: x,
            SupportedFiles: x.concat([""]),
            activeWindow: !0,
            MAX_FILE_SIZE: 2e6,
            option: d.DEFAULT_OPTIONS,
            needSaveState: !1,
            fileHasModified: !1,
            UNSUPPORTED_REASON: w,
            bundle: {
              filePath: null,
              originalPath: null,
              untitledId: new Date() - 0,
              fileName: null,
              fileEncode: null,
              removed: !1,
              useCRLF: !1,
              unsupported: "",
              hasModified: !1,
              modifiedDate: null,
              lastSnapDate: null,
              savedContent: null,
              isLocked: !1,
              oversize: !1,
              fileMissingWhenOpen: !1,
            },
            draftsRecoverList: [],
            setDocumentState: function (e) {
              const { currentFilePath: t } = e;
              C.bundle.filePath == t
                ? Object.assign(C.bundle, e)
                : ((C.bundle = e),
                  (C.bundle.filePath = t),
                  (C.isLocked = e.isLocked)),
                delete C.bundle.currentFilePath,
                C.bundle.oversize
                  ? ((C.bundle.unsupported = w.OVERSIZE),
                    C.tryEnterOversize(null, !0))
                  : C.exitOversize(),
                v.record(
                  `[File] setDocumentState File.filePath = ${o.hashCode(
                    C.filePath
                  )}`
                );
            },
            readOption: d.readOption,
            setConvertSmartOnRender: d.setConvertSmartOnRender,
            setup: d.setup,
            shouldRemapPunctuation: d.shouldRemapPunctuation,
            setFinalNewline: d.setFinalNewline,
            setIndentFirstLine: d.setIndentFirstLine,
            setHideBrAndLineBreak: d.setHideBrAndLineBreak,
            setIgnoreLineBreak: d.setIgnoreLineBreak,
            setIndentSize: d.setIndentSize,
            setLineEnding: d.setLineEnding,
            getTextFile: p.getTextFile,
            setEditor: function (e) {
              (C.isLocked = C.isMac && C.bundle.isLocked),
                (C.editor = e),
                C.isMac || (C.changeCounter = new g());
            },
            isTextBundle: function () {
              return C.bundle.type === b.TextBundle;
            },
            onFileOpened: function () {
              if (C.isNode) {
                try {
                  reqnode("electron").ipcRenderer.send(
                    "addBackup",
                    JSON.stringify({
                      path: C.bundle.filePath,
                      type: C.bundle.type,
                      mountFolder: C.mountFolder_,
                      encode: C.bundle.encode,
                    }),
                    !1,
                    !0
                  );
                } catch (e) {
                  console.sendError(e);
                }
                C.needSaveState = !1;
              }
            },
            recoverFromBackup: function (e) {
              if (!C.isNode) return !1;
              if (!e || !e.content) return !1;
              if (
                (C.setLineEnding(e.useCRLF),
                (C.bundle.filePath = e.path),
                (C.bundle.fileEncode = e.encode),
                (C.bundle.hasModified = !0),
                (C.bundle.untitledId = e.untitledId),
                (C.bundle.type = e.type),
                m.onFilePathUpdated(),
                C.setMountFolder(e.mountFolder),
                console.sendLog("recoverFromBackup"),
                C.editor.reset(e.content),
                C.editor.writingArea.focus(),
                C.updateChangeCount(c.ChangeType.NSChangeDone),
                e.path)
              ) {
                C.editor.undo.endSnap(!0);
                var t = a.makeEmptyCommand();
                (t.tag = "reload"),
                  t.redo.push(a.buildAllDoc(C.editor.nodeMap)),
                  C.fs.readFile(e.path, e.encode || "utf8", function (e, n) {
                    e ||
                      (t.undo.push({ type: "initSrc", src: n }),
                      C.changeCounter.doneStack.unshift(
                        c.ChangeType.NSChangeCleared
                      ),
                      C.editor.undo.register(t, !0, void 0, !0));
                  });
              }
              return (
                Analytics.record("newWindow", { type: "recoverBackup" }), !0
              );
            },
            stillNeedToLoadFromDiskByNode: function (e, t) {
              return !(
                !(t && e && t.changeCounter && t.changeCounter.curState) ||
                (e == t.content &&
                  (t.fileEncode || "utf8") == (C.bundle.fileEncode || "utf8"))
              );
            },
            loadFile: async function (e, t, n) {
              function i(e) {
                var t = C.editor,
                  n = t.selection;
                n && n.lockNativeScroll(),
                  C.decideLineEnding(e),
                  t.reset(e),
                  (C.bundle.savedContent = e),
                  t.writingArea.focus(),
                  C.option.initAnchor
                    ? (t.tryOpenUrl(C.option.initAnchor),
                      (C.option.initAnchor = ""))
                    : ((C._scrollTopTimer = setTimeout(() => {
                        document.querySelector("content").scrollTop = 0;
                      }, 1)),
                      void 0 != e && e.trim().length
                        ? n &&
                          ((document.querySelector("content").scrollTop = 0),
                          n.jumpIntoElemEnd(r("[cid]").last()),
                          (document.querySelector("content").scrollTop = 0))
                        : (r(t.sessionStr + ">*:first-child").addClass(
                            "md-focus"
                          ),
                          n && n.jumpTop())),
                  p.recordUnusedAssets();
              }
              (C.draftsRecoverList = []),
                (C.bundle = { filePath: e, untitledId: new Date() - 0 }),
                (C._onInitParse = !0),
                C.editor.brush && C.editor.brush.clearAndPause(),
                C.editor.library && (C.editor.library.stopRename = !0),
                e ||
                  "textbundle" !== C.option.defaultExtension ||
                  (C.bundle.type = "textbundle"),
                n ||
                  (n = t
                    ? await JSBridge.invoke("document.switchDocument", e)
                    : await JSBridge.invoke("document.loadData")),
                C.changeCounter && C.changeCounter.reset(),
                C.editor.undo.reset(),
                C.editor.nodeMap.reset(!1, !0),
                editor.fences && editor.fences.onLeaveDocument(),
                editor.mathInline && editor.mathInline.onLeaveDocument(),
                C.isNode
                  ? await (async function (e) {
                      var {
                        snap: n,
                        filePath: r,
                        backups: o,
                        shouldReadFromDisk: a,
                      } = JSON.parse(e);
                      if (!o || !C.recoverFromBackup(o)) {
                        Analytics.record("newWindow", {
                          type: r ? "openFile" : "newFile",
                        }),
                          window._options.initMountFolder &&
                            (C.setMountFolder(window._options.initMountFolder),
                            (window._options.initMountFolder = void 0));
                        var s,
                          c = null;
                        try {
                          c = (r && C.fs.statSync(r)) || null;
                        } catch (e) {
                          (c = null),
                            "ENOENT" != e.code || t
                              ? d(e)
                              : (u.handleFileNotExist(r),
                                (C.bundle.fileMissingWhenOpen = !0),
                                d(e, !0));
                        }
                        c
                          ? (c.isDirectory()
                              ? (s = await p.loadFile(r))
                              : c.isFile() &&
                                (s = await (async function () {
                                  var [e, t, n] = await C.readContentFrom(r);
                                  if (e)
                                    return (
                                      (C.bundle.fileEncode = n || "utf8"),
                                      (C.bundle.filePath = r),
                                      (C.bundle.savedContent = t),
                                      (C.bundle.modifiedDate = new Date()),
                                      t
                                    );
                                  d(t);
                                })()),
                            m.onFilePathUpdated())
                          : (s = ""),
                          C.stillNeedToLoadFromDiskByNode(s, n) && (a = !0),
                          (n || {}).nodeMap
                            ? C.restoreEditStateFromData(n, !1, !0, a, s)
                            : (i(s),
                              JSBridge.invoke(
                                "document.setLastSync",
                                C.bundle.modifiedDate
                              )),
                          C.onFileOpened();
                      }
                      function d(e, t) {
                        if (
                          (console.warn(`onLoadFail ${C.bundle.filePath}`), !t)
                        ) {
                          if (!C.option.silentOpenFailure) {
                            var n = e.message || "";
                            debugMode ||
                              (n = (n.splits && n.splits(/\n/)[0]) || n),
                              l.showErrorDialog("Failed to load file", n),
                              C.editor &&
                                C.editor.library &&
                                C.editor.library.isFileTabShown() &&
                                C.editor.library.refreshPanelCommand();
                          }
                          C.option.silentOpenFailure = !1;
                        }
                        "ENOENT" == e.code
                          ? (m.onFilePathUpdated(), m.onFilePathRemoved())
                          : (C.bundle.filePath &&
                              (JSBridge.invoke(
                                "document.switchToUntitled",
                                C.bundle.filePath
                              ),
                              (C.bundle.filePath = "")),
                            m.onFilePathUpdated());
                      }
                    })(n)
                  : C.isMac
                  ? await (function (e) {
                      const [t, n, r] = e;
                      C.setDocumentState(r),
                        m.onFilePathUpdated(),
                        (C.bundle.savedContent = t),
                        (C.bundle.modifiedDate = new Date()),
                        n && n.nodeMap
                          ? C.restoreEditStateFromData(
                              n,
                              !1,
                              !0,
                              n.isOutDated,
                              t
                            )
                          : (t.substr(0, 100), i(t));
                    })(n)
                  : (m.onFilePathUpdated(), i("")),
                t &&
                  (C.bundle.filePath ||
                    C.editor.undo.hasUndo() ||
                    C.updateChangeCount(c.ChangeType.NSChangeDone),
                  C.inBusyMode || C.recoverPosOrScroll(),
                  C.option.lastExport && (C.option.lastExportNoOverwrite = !0),
                  (window._hasSwitchCallback = !1)),
                C.editor.brush && C.editor.brush.restart(),
                C.editor.library && (C.editor.library.stopRename = !1),
                C.editor.library && C.editor.library.markCurrentFile(),
                (C._onInitParse = !1),
                C.freshMenu();
            },
            readContentFrom: async function (e, t) {
              if ((console.sendLog(`readContentFrom ${e}`), C.isMac))
                return await new Promise((e) => {
                  bridge.callHandler("document.getContent", function (t) {
                    (t = C.tryEnterOversize(t || "")), e([!0, t]);
                  });
                });
              if (!C.isNode) return [!0, ""];
              var n;
              try {
                if (e) {
                  var i = await Promise.all([C.fs.readFile(e), C.fs.stat(e)]),
                    r = i[0],
                    o = i[1],
                    a = t;
                  return (
                    (C.bundle.modifiedDate = o.mtimeMs),
                    r.length > C.MAX_FILE_SIZE
                      ? ((C.bundle.unsupported = w.OVERSIZE),
                        (n = ""),
                        C.tryEnterOversize(null, !0))
                      : (C.exitOversize(),
                        (a =
                          a ||
                          c.getItemInDB("[encode]" + e) ||
                          c.detectEncodeByNode(r)),
                        (n = c.getContentFromBuffer(
                          r,
                          (a || "").replace("-bom", ""),
                          () => {
                            a = (a || "utf8").replace("-bom", "") + "-bom";
                          }
                        ))),
                    [!0, n, a, r]
                  );
                }
                return [!0, ""];
              } catch (e) {
                return [!1, e];
              }
            },
            getContent: async function (e, t) {
              if (!e && C.isTextBundle())
                return await p.quickGetContent(p.getTextFile());
              var n = void 0 == e || null == e ? C.bundle.filePath : e,
                [i, r, o, a] = await C.readContentFrom(n, t);
              if (!i) {
                const e = r;
                if (((r = ""), !C.option.silentOpenFailure)) {
                  var s = e.message || "";
                  debugMode || (s = (s.splits && s.splits(/\n/)[0]) || s),
                    l.showErrorDialog("Failed to load file", s),
                    C.editor &&
                      C.editor.library &&
                      C.editor.library.isFileTabShown() &&
                      C.editor.library.refreshPanelCommand();
                }
                return (
                  (C.option.silentOpenFailure = !1),
                  n && JSBridge.invoke("document.switchToUntitled", n),
                  ""
                );
              }
              try {
                m.saveToRecover(a);
              } catch (e) {
                console.sendError(e, "skip");
              }
              return r;
            },
            setContent: async function (e, t) {
              C.bundle.unsupported ||
                ((C.isMac || t) &&
                  !(await JSBridge.invoke("document.setContent", e)) &&
                  C.editor.tryEnterBusyMode(e, !0));
            },
            getMountFolder: function () {
              return C.mountFolder_;
            },
            setMountFolder: function (e, t) {
              e && (e = e.replace(/[\/\\]$/, "")), (C.mountFolder_ = e);
            },
            sync: function (e, t, n, i) {
              if (!C.bundle.unsupported && C.editor) {
                var o = "";
                if (C.editor.sourceView && C.editor.sourceView.inSourceMode) {
                  if (
                    ((o = C.editor.sourceView.cm.getValue(
                      C.useCRLF ? "\r\n" : "\n"
                    )),
                    !n && C.setContent(o, t),
                    C.isMac && e)
                  ) {
                    var a = i;
                    void 0 == a && (a = C.isDocumentEdited()),
                      a && C.editor.sourceView.onSave();
                  }
                  return o;
                }
                C.editor.store(null, !0),
                  isInputComponent(document.activeElement) &&
                    r(document.activeElement)
                      .trigger("change")
                      .trigger("inline-change");
                try {
                  C.editor.autoRemoveUnholdable(!0);
                } catch (e) {
                  console.sendError(e, "warning");
                }
                var s = C.editor.getMarkdown();
                return !n && C.setContent(s, t), s;
              }
            },
            isActiveWindow: function () {
              return C.activeWindow;
            },
            validateContentForSave: u.validateContentForSave,
            tryRecoveryFromDom: u.tryRecoveryFromDom,
            showDataLostError: u.showDataLostError,
            isFileLoading: function () {
              return (
                C._onInitParse ||
                C._onFileSwitching ||
                (C.editor &&
                  C.editor.library &&
                  C.editor.library._onSwitchDocumentTarget)
              );
            },
            saveAsUseNode: h.saveAsUseNode,
            saveUseNode: h.saveUseNode,
            moveTo: h.moveTo,
            markSaved: h.markSaved,
            updateChangeCount: function (e) {
              if (!C.bundle.unsupported)
                if (
                  (e != C.ChangeType.NodeSaveFailed &&
                    ((C.needSaveState = !0), C.scheduleBackupWindow()),
                  C.editor.sourceView && C.editor.sourceView.inSourceMode)
                )
                  C.isMac
                    ? e == C.ChangeType.NSChangeAutoSaved
                      ? bridge.callHandler("document.updateChangeCount", e)
                      : e == C.ChangeType.NSChangeCleared
                      ? bridge.callHandler("document.updateChangeCount", e)
                      : bridge.callHandler(
                          "document.updateChangeCountIfUnedited",
                          C.ChangeType.NSChangeDone
                        )
                    : C.changeCounter.updateChangeCount(e);
                else {
                  e !== C.ChangeType.NSChangeAutoSaved &&
                    e != C.ChangeType.NodeSaveFailed &&
                    C.needsUpdateSnap();
                  var t = null;
                  C.isMac
                    ? (bridge.callHandler("document.updateChangeCount", e),
                      (t = {
                        "Edit→Undo": { enabled: C.editor.undo.hasUndo() },
                        "Edit→Redo": { enabled: C.editor.undo.hasRedo() },
                      }))
                    : (C.changeCounter.updateChangeCount(e),
                      (S =
                        e !== C.ChangeType.NSChangeAutoSaved ||
                        e == C.ChangeType.NodeSaveFailed),
                      C.isNode &&
                        (t = {
                          "Edit→Undo": {
                            enabled:
                              C.editor &&
                              C.editor.undo &&
                              C.editor.undo.hasUndo(),
                          },
                          "Edit→Redo": {
                            enabled:
                              C.editor &&
                              C.editor.undo &&
                              C.editor.undo.hasRedo(),
                          },
                        })),
                    JSBridge.menu.update(t);
                }
            },
            setDefaultImageStorage: d.setDefaultImageStorage,
            exitOversize: d.exitOversize,
            doEnterOversize: d.doEnterOversize,
            tryEnterOversize: d.tryEnterOversize,
            recoverPosOrScroll: d.recoverPosOrScroll,
            restoreEditStateFromData: function (e, t, n, i, o) {
              if (!e || !e.undoRedo || !e.nodeMap) return !0;
              if (e.timeStamp > 0 && e.timeStamp == C.bundle.lastSnapDate)
                return !0;
              (C.bundle.hasModified = !0),
                C.isNode &&
                  !C.bundle.modifiedDate &&
                  (C.bundle.modifiedDate = e.lastSync),
                console.sendLog(`do restoreEditStateFromData ${n} ${i}`);
              var a = null,
                l = C.editor,
                c = l.sourceView && l.sourceView.inSourceMode;
              (C._onInitParse = !0),
                (C.editor.focusCid = null),
                (C.editor.lastCursor = null),
                l.nodeMap.restoreFromJson(JSON.parse(e.nodeMap)),
                l.undo.restoreFromJson(JSON.parse(e.undoRedo)),
                C.setLineEnding(e.useCRLF),
                (C.finalNewline = e.finalNewline),
                (C._onInitParse = !1),
                (C.bundle.lastSnapDate = e.timeStamp);
              let d = JSON.parse(e.bundle || "{}");
              function u() {
                if (
                  (C.editor.tryEnterBusyMode(), C.editor.writingArea.focus(), t)
                ) {
                  if ("object" == typeof t)
                    try {
                      l.undo.exeCommand(t);
                    } catch (e) {}
                } else
                  a ||
                    ((C._scrollTopTimer = setTimeout(() => {
                      document.querySelector("content").scrollTop = 0;
                    }, 1)),
                    C.editor.selection.jumpIntoElemEnd(r("[cid]").last()),
                    (document.querySelector("content").scrollTop = 0));
              }
              if (
                ((C.bundle.unusedAssets = d.unusedAssets),
                (C.bundle.deletedAssetsMap = d.deletedAssetsMap),
                (C.bundle.assetsChanges = d.assetsChanges),
                c
                  ? (t && (a = l.sourceView.cm.getScrollInfo().top),
                    e.srcHist &&
                      (C.reloadContent(e.srcContent, {
                        skipUndo: !0,
                        skipChangeCount: !0,
                      }),
                      l.sourceView.cm.doc.clearHistory(),
                      l.sourceView.cm.doc.setHistory(JSON.parse(e.srcHist))),
                    e.fromSourceMode ||
                      C.reloadContent(e.content, {
                        skipChangeCount:
                          n || (C.isMac && !C.isDocumentEdited()),
                      }),
                    t && l.sourceView.cm.scrollTo(0, a))
                  : (t && (a = r("content").scrollTop()),
                    e.fromSourceMode
                      ? (C.reloadContent(e.srcContent, {
                          skipChangeCount: !0,
                          onInit: n,
                        }),
                        setTimeout(function () {
                          null !== a && r("content").scrollTop(a);
                        }, 0))
                      : i ||
                        (!C.inBusyMode &&
                          l.nodeMap.allNodes.length > 1e4 &&
                          l.tryEnterBusyMode(void 0, void 0, !0),
                        r(l.sessionStr).html(
                          s.NodeCollectionUtils.toHTML(l.nodeMap.blocks)
                        ),
                        n || (l.focusCid = void 0),
                        setTimeout(function () {
                          l.mathBlock && l.mathBlock.cleanUpAMS(),
                            l.refresh(),
                            C.option.initAnchor
                              ? (l.tryOpenUrl(C.option.initAnchor),
                                (C.option.initAnchor = ""))
                              : a && r("content").scrollTop(a);
                        }, 200),
                        u())),
                (C._needsUpdateSnap = !1),
                C.isNode &&
                  (C.changeCounter.reset(e.changeCounter),
                  (C.bundle.hasModified = C.changeCounter.isDocumentEdited()),
                  C.editor.spellChecker && C.editor.spellChecker.reset(!0)),
                i)
              )
                (void 0 != o ? Promise.resolve(o) : C.getContent()).then(
                  function (e) {
                    (C.bundle.savedContent = e),
                      (C.bundle.modifiedDate = new Date()),
                      C.reloadContent(e, { fromDiskChange: !0, onInit: n }),
                      C.updateChangeCount(
                        C.isMac
                          ? C.ChangeType.NSChangeCleared
                          : C.ChangeType.NSChangeAutoSaved
                      ),
                      (C._needsUpdateSnap = new Date()),
                      u();
                  }
                );
              else {
                var h = C.editor.wordCount;
                h && h.update(), C.freshMenuWithDelay();
              }
            },
            needsUpdateSnap: function () {
              C.isMac && bridge.callHandler("document.needsUpdateSnap"),
                (C._needsUpdateSnap = new Date());
            },
            backupDocumentSnap: async function () {
              C.editor &&
                ((C.editor.lastCursor = C.editor.selection.buildUndo()),
                C.isMac
                  ? await new Promise(function (e) {
                      bridge.callHandler("document.requestBuildSnap", e);
                    })
                  : C.isNode &&
                    (C._onInitParse ||
                      C._onFileSwitching ||
                      window._onBackup ||
                      (await C.buildDocumentSnapForNode())));
            },
            generateSnap: function (e) {
              if (!C.bundle.unsupported) {
                var t = void 0 == e ? C.sync(!1, !0) : e,
                  n = C.editor.sourceView.inSourceMode,
                  i = {
                    nodeMap: JSON.stringify(C.editor.nodeMap.storeToJson()),
                    undoRedo: JSON.stringify(C.editor.undo.storeToJson()),
                    timeStamp: (C._needsUpdateSnap || new Date()) - 0,
                    cursorPos: JSON.stringify(C.editor.selection.storeToJson()),
                    scrollOffset: n ? 0 : r("content").scrollTop(),
                    useCRLF: C.useCRLF,
                    finalNewline: C.finalNewline,
                    content: t || "",
                    bundle: JSON.stringify(C.bundle),
                  };
                return (
                  n &&
                    ((i.fromSourceMode = !0),
                    (i.srcHist = JSON.stringify(
                      C.editor.sourceView.cm.doc.getHistory()
                    ))),
                  C.isNode &&
                    ((i.fileEncode = C.bundle.fileEncode),
                    (i.changeCounter = C.changeCounter.clone())),
                  i
                );
              }
            },
            buildDocumentSnapForNode: async function (e) {
              if (C.bundle.unsupported || !C.isNode) return Promise.resolve();
              if (!C._needsUpdateSnap && !C.isActiveWindow())
                return Promise.resolve();
              window._onBackup = !0;
              var t = C.sync(!1, !0),
                n = null;
              if (C._needsUpdateSnap)
                (n = C.generateSnap(t)),
                  await JSBridge.invoke(
                    "document.addSnapAndLastSync",
                    JSON.stringify({ snap: n, lastSync: C.bundle.modifiedDate })
                  );
              else if (
                e &&
                (n = JSON.parse(
                  (await JSBridge.invoke("document.getSnap", 0)) || "null"
                )) &&
                n.content == t
              ) {
                var i = C.editor.sourceView.inSourceMode;
                (n.cursorPos = JSON.stringify(
                  C.editor.selection.storeToJson()
                )),
                  (n.scrollOffset = i ? 0 : r("content").scrollTop()),
                  await JSBridge.invoke(
                    "document.addSnap",
                    JSON.stringify(n || null)
                  );
              }
              (C._needsUpdateSnap = !1),
                n && (C.bundle.lastSnapDate = n.timeStamp),
                (window._onBackup = !1);
            },
            presentedItemChanged: async function (e, t, n) {
              if (
                C.isActiveWindow() &&
                !C.bundle.unsupported &&
                !C._isAskingForContentReload &&
                !C._onFileSwitching &&
                (!n || n == p.getTextFile())
              )
                if (
                  (console.sendLog(
                    `presentedItemChanged, path is ${o.hashCode(n)}`,
                    !0
                  ),
                  e && clientHandlerOnPresentationMoved(),
                  C.isNode)
                ) {
                  if (C.bundle.filePath) {
                    if (C.inSavingProcess) return;
                    if (
                      C.bundle.modifiedDate &&
                      new Date() - C.bundle.modifiedDate < 500
                    )
                      return void window.debugMode;
                  } else m.onFilePathRemoved();
                  if (C.bundle.filePath) {
                    if (!t || C.bundle.modifiedDate >= t.mtimeMs)
                      return void console.sendLog(
                        "presentedItemChanged ignored",
                        !0
                      );
                    C.bundle.modifiedDate = t.mtimeMs;
                    if (
                      C.bundle.filePath &&
                      (await i()) === C.bundle.savedContent
                    )
                      return void console.sendLog(
                        "presentedItemChanged ignore because content not changed",
                        !0
                      );
                    console.sendLog("presentedItemChanged did happen"),
                      C.changeCounter.isDocumentEdited()
                        ? ((C._isAskingForContentReload = !0),
                          l.confirm(
                            r.localize.getString(
                              "File content is changed by external applications. Reload content from disk ?"
                            ) +
                              " " +
                              r.localize.getString(
                                "You could undo this operation later via `Edit` → `Undo`."
                              ),
                            function () {
                              (C._isAskingForContentReload = !1), a(!0);
                            },
                            function () {
                              (C._isAskingForContentReload = !1), a(!1);
                            }
                          ))
                        : ((C._isAskingForContentReload = !1), a(!0));
                  }
                } else
                  C.isMac &&
                    ((C.isDocumentEdited() &&
                      !confirm(
                        r.localize.getString(
                          "File content is changed by external applications. Reload content from disk ?"
                        ) +
                          " " +
                          r.localize.getString(
                            "You could undo this operation later via `Edit` → `Undo`."
                          )
                      )) ||
                      bridge.callHandler("document.refreshContentFromDisk"));
              function i() {
                return (
                  console.sendLog("getDataFromFile"),
                  new Promise(function (e) {
                    C.isMac
                      ? bridge.callHandler("document.getDataFromFile", e)
                      : C.isNode
                      ? C.isTextBundle()
                        ? p.quickGetContent(p.getTextFile(), !0).then(e)
                        : C.getContent(
                            C.bundle.filePath,
                            C.bundle.fileEncode
                          ).then(e)
                      : e("");
                  })
                );
              }
              function a(e) {
                console.sendLog("doHandlerPresentedItemChange");
                var t = r("content").scrollTop();
                e
                  ? i().then(function (e) {
                      if (C.bundle.unsupported)
                        C.isNode &&
                          (console.sendLog("document.enterOversize"),
                          JSBridge.invoke("document.enterOversize"));
                      else {
                        C.reloadContent(e, { fromDiskChange: !0 }),
                          C.updateChangeCount(C.ChangeType.NSChangeAutoSaved);
                        var n = C.editor.sourceView;
                        if (n.inSourceMode) {
                          var i = n.cm.getScrollInfo().top,
                            o = n.cm.listSelections();
                          n.setValue(e),
                            n.cm.setSelections(o),
                            n.cm.scrollTo(0, i);
                        }
                        setTimeout(function () {
                          C.setContent(e), r("content").scrollTop(t);
                        }, 0),
                          (C.bundle.savedContent = e),
                          (C.bundle.modifiedDate = new Date());
                      }
                    })
                  : C.updateChangeCount(C.ChangeType.NSChangeReadOtherContents);
              }
            },
            reloadWithEncoding: function (e) {
              C.isTextBundle() ||
                (C.isNode &&
                  C.bundle.filePath &&
                  e != C.bundle.fileEncode &&
                  (c.setItemInDB("[encode]" + C.bundle.filePath, e),
                  (C.bundle.fileEncode = e),
                  C.getContent(C.bundle.filePath, e).then(function (e) {
                    C.reloadContent(e),
                      C.updateChangeCount(C.ChangeType.NSChangeCleared);
                  })));
            },
            reloadContent: function (e, t) {
              var {
                skipUndo: n,
                delayRefresh: i,
                fromDiskChange: o,
                skipChangeCount: l,
                onInit: c,
                skipStore: d,
              } = t || {};
              if (
                (console.sendLog(`File.reloadContent, ${JSON.stringify(t)}`),
                (C.bundle.assetsChanges = null),
                !C.bundle.unsupported &&
                  C.isMac &&
                  o &&
                  ((e = C.tryEnterOversize(e)),
                  C.bundle.unsupported &&
                    (console.sendLog("document.enterOversize"),
                    bridge.callHandler("document.enterOversize"))),
                !C.bundle.unsupported)
              ) {
                o && C.needsUpdateSnap(), C.editor.undo.endSnap(!0);
                var u,
                  h,
                  p,
                  f = a.makeEmptyCommand(),
                  m = C.editor.sourceView && C.editor.sourceView.inSourceMode;
                if (
                  ((f.tag = "reload"),
                  C.decideLineEnding(e),
                  m ||
                    c ||
                    d ||
                    (C.editor.store(),
                    f.undo.push(C.editor.selection.buildUndo())),
                  (C.editor.focusCid = null),
                  (C.editor.lastCursor = null),
                  f.undo.push(a.buildAllDoc(C.editor.nodeMap, o)),
                  m &&
                    ((p = C.editor.sourceView.cm.getScrollInfo().top),
                    (h = C.editor.sourceView.cm.getCursor()),
                    C.editor.sourceView.setValue(
                      e,
                      !0,
                      o || l ? "fromDisk" : "begin"
                    )),
                  (m && o) ||
                    (C.editor.nodeMap.reset(),
                    (u = s.Node.parseFrom(e, C.editor.nodeMap, {
                      skips: { old_code: !1 },
                    }))[1].map(function (e) {
                      e.set("attachTo", C.editor.nodeMap);
                    }),
                    f.redo.push(a.buildAllDoc(C.editor.nodeMap, o)),
                    (f.date = new Date()),
                    C.editor.tryEnterBusyMode(e),
                    m
                      ? ((C.editor.sourceView.renderedHTML = u[0]),
                        C.editor.undo.register(f, l))
                      : ((C.editor.writingArea.innerHTML = u[0]),
                        C.editor.runAllScript())),
                  m)
                ) {
                  var g = C.editor.sourceView.cm.getInputField();
                  return (
                    g.setSelectionRange && g.setSelectionRange(0, 0),
                    C.editor.sourceView.cm.setCursor(h),
                    void (
                      o &&
                      void 0 !== p &&
                      C.editor.sourceView.cm.scrollTo(0, p)
                    )
                  );
                }
                if (o) {
                  var v = C.editor.undo.lastRegisteredOperationCommand(),
                    y = v && v.undo.last();
                  y &&
                    "reload" == y.type &&
                    y.reloadFromDisk &&
                    v.date > new Date() - 1e3 &&
                    ((f.undo = [y]),
                    C.editor.undo.removeLastRegisteredOperationCommand());
                }
                n || C.editor.undo.register(f, l),
                  !1 !== i &&
                    setTimeout(
                      function () {
                        C.editor.mathBlock && C.editor.mathBlock.cleanUpAMS(),
                          C.editor.refresh();
                      },
                      i ? 500 : 0
                    ),
                  c ||
                    (n
                      ? (C.editor.undo.reset(),
                        C.updateChangeCount(C.ChangeType.NSChangeAutoSaved))
                      : window.getSelection().removeAllRanges(),
                    setTimeout(
                      function () {
                        C.editor.selection.scrollAdjust();
                      },
                      i ? 500 : 0
                    )),
                  !1 === i &&
                    (C.editor.mathBlock && C.editor.mathBlock.cleanUpAMS(),
                    C.editor.refresh()),
                  c &&
                    (C.option.initAnchor
                      ? (C.editor.tryOpenUrl(C.option.initAnchor),
                        (C.option.initAnchor = ""))
                      : (C.editor.selection.jumpIntoElemEnd(r("[cid]").last()),
                        (document.querySelector("content").scrollTop = 0))),
                  window.Reporter.fullValidate();
              }
            },
            copy: u.copy,
            delete: u.delete,
            editActive: u.editActive,
            deleteActive: u.deleteActive,
            cut: u.cut,
            pasteAsPlainText: u.pasteAsPlainText,
            lock: u.lock,
            unlock: u.unlock,
            toggleSourceMode: u.toggleSourceMode,
            isFocusedOnWriteDiv: function () {
              return r(document.activeElement).closest("#write").length > 0;
            },
            getCurBlockType: function () {
              try {
                if (
                  "write" !== document.activeElement.id &&
                  document.activeElement.hasAttribute &&
                  document.activeElement.hasAttribute("tabindex")
                )
                  return (
                    r(document.activeElement)
                      .closest("[mdtype]")
                      .attr("mdtype") || ""
                  );
                if (rangy.getSelection().rangeCount) {
                  var e = C.editor.selection.getRangy();
                  return (
                    r(e.commonAncestorContainer)
                      .closest("[mdtype]")
                      .attr("mdtype") || ""
                  );
                }
              } catch (e) {}
              return "";
            },
            winShell: c.winShell,
            freshLock: u.freshLock,
            setTheme: d.setTheme,
            getFileName: d.getFileName,
            getSuggestedFileName: d.getSuggestedFileName,
            setCanCollapsePinnedOutline: d.setCanCollapsePinnedOutline,
            refreshImageCopyStatus: function (e, t) {
              e
                ? (F && clearTimeout(F),
                  (F = setTimeout(function () {
                    f.doRefreshImageCopyStatus(t);
                  }, 500)))
                : f.doRefreshImageCopyStatus(t);
            },
            onMetaDataChanged: function (e) {
              F && clearTimeout(F);
              const t = () => {
                C.isNode && C.refreshImageCopyStatus(!0);
                var e = C.editor.localSettingBridge;
                e && e.loadFromFile(), (F = null);
              };
              e ? t() : (F = setTimeout(t, 100));
            },
            isDocumentEdited: function () {
              return C.isNode
                ? C.changeCounter.isDocumentEdited()
                : C.isMac
                ? bridge.callSync("document.isDocumentEdited")
                : void 0;
            },
            trashSelf: function () {
              C.bundle.filePath &&
                C.editor.library.doDeleteFile(C.bundle.filePath, null, (e) => {
                  e &&
                    C.isNode &&
                    (C.reloadContent(C.editor.warpContentWithOption(""), {
                      fromDiskChange: !0,
                    }),
                    m.onFilePathRemoved(),
                    C.editor.selection.jumpTop());
                });
            },
            backupWindow: async function (e) {
              if (
                (i && (window.cancelSmartSchedule(i), (i = null)),
                e && C.sync(),
                C.isNode)
              )
                if (C._onInitParse) C.needSaveState = !1;
                else
                  try {
                    if (
                      !C.needSaveState ||
                      !C.editor.brush.timerID ||
                      !C.isActiveWindow()
                    )
                      return;
                    var t =
                      C.bundle.hasModified &&
                      C.changeCounter.isDocumentEdited();
                    if (
                      !t &&
                      C.changeCounter.isDiscardableUntitled() &&
                      !C.mountFolder_
                    )
                      return;
                    t &&
                      C.option.enableAutoSave &&
                      (await C.saveUseNode(null, !0),
                      (t = C.changeCounter.isDocumentEdited()),
                      C.changeCounter.curState);
                    var n = {
                      path: C.bundle.filePath,
                      untitledId: C.bundle.untitledId || 0,
                      type: C.bundle.type || "",
                      encode: C.encode,
                      hasUnsaved: t,
                      scrollPos: r("content").scrollTop(),
                      useCRLF: C.useCRLF,
                      finalNewline: C.finalNewline,
                      syncDate: new Date() - 0,
                      mountFolder: C.mountFolder_,
                      content: null,
                    };
                    return (
                      t &&
                        (C.editor.store(null, !0),
                        (n.content = C.editor.getMarkdown())),
                      reqnode("electron").ipcRenderer.send(
                        "addBackup",
                        JSON.stringify(n)
                      ),
                      (C.needSaveState = !1),
                      console.sendLogForDebug("backupWindow sent"),
                      n
                    );
                  } catch (e) {
                    console.sendError(e);
                  }
            },
            scheduleBackupWindow: function () {
              C.isNode &&
                (console.sendLogForDebug("scheduleBackupWindow"),
                i && window.cancelSmartSchedule(i),
                (i = window.requestSmartSchedule(
                  async () => {
                    await C.backupWindow();
                  },
                  1e3,
                  1e4
                )));
            },
            decideLineEnding: d.decideLineEnding,
          },
          F = null,
          S = !1,
          k = function () {
            S &&
              C.editor.brush &&
              C.editor.brush.timerID &&
              C.isActiveWindow() &&
              S &&
              ((S = !1), m.saveToRecover(C.editor.getMarkdown()));
          };
        (C.ChangeType = c.ChangeType),
          (C.isMacLegacy = void 0 !== window.app),
          (C.isWK = C.isWk = window.isWk),
          (C.isMac = C.isMacLegacy || C.isWK),
          (C.isNode = void 0 !== window.reqnode),
          (C.isMacNode = C.isNode && "darwin" == window.process.platform),
          (C.isMacOrMacNode = C.isMac || C.isMacNode),
          (C.isNodeHtml = window.isOnWindowHtml),
          (C.isWin = C.isNode && "win32" == window.process.platform),
          (C.isLinux = C.isNode && "linux" == window.process.platform),
          (C.isLinuxSnap =
            C.isNode && "typora" == window.process.env.SNAP_NAME),
          (C.isUnixNode = C.isLinux || C.isMacNode),
          (C.FileInfoPanel = m),
          (C.backupVersionWorker = k),
          (C.freshMenu = f.freshMenu),
          (C.freshMenuWithDelay = f.freshMenuWithDelay),
          (C.bindMenu = f.bindMenu),
          (C.MenuHelper = f);
        var E = navigator.userAgent.toLowerCase();
        (C.isSafari =
          C.isMac || (E.indexOf("safari/") > -1 && -1 == E.indexOf("chrome"))),
          C.isMac && JSBridge.invoke("window.loadFinished"),
          (C.startAutoSaveAndBackupService = function () {
            if (C.isNode) {
              var e = C.option.autoSaveTimer;
              (e && !Number.isNaN(e)) || (e = 3), setInterval(k, 6e5);
            }
          }),
          (C.saveAndBackup = function () {
            k();
          }),
          C.isNode &&
            ((C.fs = reqnode("fs-extra")),
            C.startAutoSaveAndBackupService(),
            setInterval(() => {
              C.draftsRecoverList = [];
            }, 144e5)),
          (window.onPowerChange = function (e) {
            console.sendLog(`[powerMonitor] ${e}`), (C.draftsRecoverList = []);
          }),
          (n.exports = C);
      }
    ),
    $__System.registerDynamic(
      "56",
      ["13", "11", "1c", "15", "19", "17", "32", "29", "28"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("13"),
          r = i.Node,
          o = i.NodeMap,
          a = i.TYPE,
          s = e("11"),
          l = e("1c"),
          c = e("15"),
          d = e("19"),
          u = e("17"),
          h = e("32"),
          p = e("29"),
          f = e("28"),
          m = {
            "\b": "\\b",
            "\t": "\\t",
            "\n": "\\n",
            "\f": "\\f",
            "\r": "\\r",
            '"': '\\"',
            "'": "'",
            "\\": "\\\\",
          };
        const g = {
          USE_PROFILES: { mathMl: !0, svg: !0 },
          ALLOW_DATA_ATTR: !1,
          ADD_ATTR: ["id", "style"],
        };
        var v,
          y,
          b = "",
          w = {},
          x = [],
          C = [];
        function F(e, t, n, i) {
          var r = e.split(/(\uE040\d+)\uE041/g);
          if (!r) return t(e);
          Promise.all(
            r.map(async function (e) {
              if (e.charAt(0) == b) {
                var t = e.substring(1) - 0,
                  r = v[t].cid,
                  o = await (async function (e) {
                    var t = document.querySelector("[cid='" + e + "'] svg"),
                      n = $(t).closest("[lang='mermaid']").length,
                      i = await p.saveSVGToTempPath(t, n);
                    return i && C.push(i), i;
                  })(r);
                return (
                  y.delete(r),
                  "latex" == n &&
                    (o = await ((a = o),
                    (s = i),
                    s
                      ? new Promise(function (e) {
                          if (File.isNode) {
                            var t = reqnode("path").basename(a);
                            reqnode("fs-extra").move(
                              a,
                              s + "/" + t,
                              function () {
                                e(t);
                              }
                            );
                          } else File.isMac && bridge.callHandler("path.moveTo", { source: a, folder: s }, e);
                        })
                      : Promise.resolve(a))),
                  JSON.stringify(o)
                );
              }
              return e;
              var a, s;
            })
          ).then(
            function (n) {
              (e = n.join("")), t(e);
            },
            function (n) {
              (e = r.join("").replace(/[\uE040-\uE041]/g, "")), t(e);
            }
          );
        }
        function S() {
          if (File.isNode)
            for (; C.length; ) reqnode("fs").unlink(C.pop(), function () {});
          else
            File.isMac && (bridge.callHandler("path.removeFiles", C), (C = []));
        }
        var k,
          E = function (e) {
            return d
              .recoverEscape(e)
              .replace(/["'\\\b\t\n\f\r]/g, function (e) {
                return m[e];
              })
              .replace(/\u200b/g, "");
          },
          T = { left: "AlignLeft", right: "AlignRight", center: "AlignCenter" },
          _ = function (e, t, n, i, r) {
            (t = void 0 === t ? "," : t), (i = i || w);
            for (var o, a = [], s = n || e.getFirstChild(); s; )
              (o = B(s, i, r)) && a.push(o), (s = s.get("after"));
            return a.join(t);
          },
          A = function (e, t) {
            return (
              (t = t || e.get("text")),
              k.output(t).replace(/, $/, "") || 'Str ""'
            );
          },
          M = function (e) {
            return r.isType(e, "epub", "rst", "opml", "textile", "markdown");
          },
          L = /([^\\]|^)\\tag{([^}]+)}\s*/,
          N = /([^\\]|^)\\label{([^}]+)}\s*/,
          D = /([^\\]|^)\\over[^\w\d]/,
          B = function (e, t, n) {
            var i,
              o = function (e, n, i, r) {
                return _(e, n, i, t, r);
              },
              h = M(t.target),
              p = function (e, t) {
                if (
                  ((i = e
                    .get("text")
                    .trim()
                    .replace(/\u200b/g, "")),
                  "epub" == t.target)
                ) {
                  var n = DOMPurify.sanitize(
                    MathJax.tex2mml(i, { display: !0 }),
                    g
                  );
                  if (n)
                    return (
                      'RawBlock (Format "html") ' +
                      JSON.stringify(
                        (function (e) {
                          try {
                            var t = new DOMParser().parseFromString(
                              e,
                              "text/html"
                            );
                            return (
                              t
                                .querySelectorAll("mtable")
                                .forEach(function (e) {
                                  e.hasAttribute("columnalign") &&
                                    !e.getAttribute("columnalign") &&
                                    e.removeAttribute("columnalign");
                                }),
                              t.body.innerHTML
                            );
                          } catch (e) {}
                          return e;
                        })(n)
                      ) +
                      " "
                    );
                } else if ("latex" == t.target) {
                  if (
                    i.match(
                      /^\\(begin|newcommand|renewcommand|newenvironment|renewenvironment|def|let){/
                    )
                  )
                    return 'RawBlock (Format "latex") ' + JSON.stringify(i);
                } else if (
                  "docx" == t.target &&
                  File.option.autoNumberingForMath
                ) {
                  var r = (function (e, t) {
                    var n;
                    if (
                      ((t.number = t.number || 1),
                      File.option.autoNumberingForMath &&
                        ((n = t.number), t.number++),
                      D.test(e))
                    )
                      return [e, n];
                    var i = L.exec(e);
                    return (
                      (e = e.replace(
                        /([^\\]|^)\\eqref{([^}]+)}\s*/g,
                        "$1($2)"
                      )),
                      i
                        ? ((n = i[2]),
                          [
                            (e =
                              e.replace(/([^\\]|^)\\tag{([^}]+)}\s*/g, "$1") +
                              "\\qquad\\text{(" +
                              s.escapeInQuote(n) +
                              ")}"),
                            n,
                          ])
                        : ((e = e +=
                            "\\qquad\\text{(" + s.escapeInQuote(n + "") + ")}"),
                          (i = N.exec(e)) && (n = i[2]),
                          [e, n])
                    );
                  })(i, t);
                  return (
                    "Plain [" +
                    ['Math DisplayMath "' + E(r[0]) + '" '].join(",") +
                    "]"
                  );
                }
                return 'Plain [Math DisplayMath "' + E(i) + '"]';
              },
              f = t.versionAfter2_10;
            switch (e.get("type")) {
              case a.paragraph:
                return (i = A(e)), "Para [" + (n || "") + i + "]";
              case a.meta_block:
                return "";
              case a.heading:
                var m = t.anchorMap[e.cid];
                return (
                  "Header " +
                  e.get("depth") +
                  ' ("' +
                  s.escapeInQuote(m) +
                  '", [], []) [' +
                  (n || "") +
                  A(e) +
                  "]"
                );
              case a.blockquote:
                return "BlockQuote [" + (i = o(e)) + "]";
              case a.list:
                var w = e.get("style");
                return (
                  (i = o(e)),
                  w == r.ListType.ol
                    ? "OrderedList (1,Decimal,Period) [" + i + "]"
                    : "BulletList [" + i + "]"
                );
              case a.list_item:
                let g = "";
                return (
                  e.get("parent") &&
                    e.get("style") === r.ListType.task &&
                    (g = e.get("checked")
                      ? 'Str "\\9746" , Space , '
                      : 'Str "\\9744" , Space , '),
                  "[" + (i = o(e, void 0, void 0, g)) + "]"
                );
              case a.fences:
                if (
                  c.isDiagramType(e.get("lang")) &&
                  r.isType(t.target, "epub", "docx", "odt", "latex")
                ) {
                  v.push(e), y.add(e.cid);
                  var x = document
                    .querySelector("[cid='" + e.cid + "'] svg")
                    .getBoundingClientRect();
                  return (
                    'Div ("",[],[("style","text-align:center"), ("align", "center")]) [Para [Image ("",[' +
                    JSON.stringify(e.get("lang")) +
                    '],[("width", "' +
                    (x.right - x.left) +
                    '"), ("align", "center")]) [Str ""] (' +
                    (b + (v.length - 1)) +
                    ',"fig:")]] '
                  );
                }
                if (l.isMathType(e.get("lang"))) return p(e, t);
                var C = d.parsePandocAttr(e.get("lang"));
                if (Object.keys(C).length) {
                  var F = [];
                  for (var S in C.nativeAttr)
                    F.push(
                      '("' +
                        S.replace(/['"]/g, "") +
                        '","' +
                        C.nativeAttr[S].replace(/['"]/g, "") +
                        '")'
                    );
                  return (
                    'CodeBlock ("' +
                    E(C.id || "") +
                    '",[' +
                    (C.class || "")
                      .trim()
                      .split(/\s+/)
                      .map(function (e) {
                        return '"' + E(e) + '"';
                      })
                      .join(",") +
                    "],[" +
                    F.join(",") +
                    ']) "' +
                    E(e.get("text")) +
                    '"'
                  );
                }
                return (
                  'CodeBlock ("",["' +
                  E(getCodeMirrorMode(e.get("lang") || "", !1, !0, !0)) +
                  '"],[]) "' +
                  E(e.get("text")) +
                  '"'
                );
              case a.math_block:
                return p(e, t);
              case a.hr:
                return "HorizontalRule";
              case a.def_footnote:
              case a.def_link:
                return "";
              case a.toc:
                return "latex" == t.target
                  ? 'RawBlock (Format "latex") "\\\\tableofcontents"'
                  : "wiki" == t.target
                  ? 'RawBlock (Format "mediawiki") "__TOC__", RawBlock (Format "mediawiki") ""'
                  : "rst" == t.target
                  ? 'RawBlock (Format "rst") ".. contents::", RawBlock (Format "rst") "\n"'
                  : "opml" == t.target
                  ? ""
                  : "textile" == t.target
                  ? 'RawBlock (Format "textile") "{toc}", RawBlock (Format "textile") "\n"'
                  : "";
              case a.table:
                var k = e.getFirstChild(),
                  R = k.get("after"),
                  P = "";
                if (f) {
                  var I = e
                    .get("align")
                    .fill()
                    .map(function (e) {
                      return `(${T[e] || "AlignDefault"},ColWidthDefault)`;
                    });
                  return (
                    (P = R
                      ? `(TableBody ("",[],[]) (RowHeadColumns 0) [] [${o(
                          e,
                          ",",
                          k.get("after")
                        )}])`
                      : '(TableBody ("",[],[]) (RowHeadColumns 0) [] [])'),
                    `Table ("",[],[]) (Caption Nothing []) [${I.join(
                      ","
                    )}] (TableHead ("",[],[]) [${B(
                      k,
                      t
                    )}]) [${P}] (TableFoot ("",[],[])\n\t\t\t\t[])`
                  );
                }
                var O = e
                    .get("align")
                    .fill()
                    .map(function (e) {
                      return T[e] || "AlignDefault";
                    }),
                  H = O.map(() => "0.0");
                return (
                  "Table [] [" +
                  O.join(",") +
                  "] [" +
                  H.join(",") +
                  "] [" +
                  o(k) +
                  "] [" +
                  (R ? o(e, ",", k.get("after")) : "[]") +
                  "]"
                );
              case a.table_row:
                return f ? `Row ("",[],[]) [${o(e)}]` : "[" + o(e) + "]";
              case a.table_cell:
                return f
                  ? `Cell ("",[],[]) AlignDefault (RowSpan 1) (ColSpan 1) [Plain [${A(
                      e
                    )}]]`
                  : "[Plain [" + A(e) + "]]";
              case a.html_block:
                var U = u.buildHTMLForExport(
                    e.get("text"),
                    File.editor,
                    t.target
                  ),
                  j = "";
                if (h)
                  return (
                    (j = u.convertToXHTML(U)),
                    'RawBlock (Format "html") "' +
                      E(j.replace(/\r\n/g, "")) +
                      '"'
                  );
                try {
                  j = $.parseHTML(U)[0].textContent || "";
                } catch (e) {}
                return 'Para [Str "' + E(j) + '"]';
              default:
                return "";
            }
          },
          R = [];
        (R[a.strong] = "Strong"),
          (R[a.em] = "Emph"),
          (R[a.del] = "Strikeout"),
          (R[a.subscript] = "Subscript"),
          (R[a.superscript] = "Superscript"),
          (R[a.underline] = "Underline");
        var P,
          I = {
            html: 'RawInline (Format "html") "<u>", $0, RawInline (Format "html") "</u>", ',
            docx: 'RawInline (Format "openxml") "<w:r><w:rPr><w:u w:val=\\"single\\" /></w:rPr><w:t>$0</w:t></w:r>", ',
            rtf: 'RawInline (Format "rtf") "{\\\\ul ", $0, RawInline (Format "rtf") " }", ',
            latex:
              'RawInline (Format "latex") "\\\\underline{", $0, RawInline (Format "latex") "}", ',
          },
          O = {
            html: 'RawInline (Format "html") "<mark>", $0, RawInline (Format "html") "</mark>", ',
            docx: 'RawInline (Format "openxml") "<w:r><w:rPr><w:shd w:val=\\"clear\\" w:fill=\\"ffff00\\" /></w:rPr><w:t>$0</w:t></w:r>", ',
            rtf: 'RawInline (Format "rtf") "{{\\\\colortbl;\\\\red255\\\\green255\\\\blue0;} \\\\cb1 ", $0, RawInline (Format "rtf") "}", ',
            latex:
              'RawInline (Format "latex") "\\\\hl{", $0, RawInline (Format "latex") "}", ',
          },
          H = { atag: !1, imgtag: !1, comment: !0 },
          U = function (e) {
            var t = function (e) {
              return e.inner || e.text || "";
            };
            P || (P = new d.InlineLexer({ skipOp: H }, t));
            try {
              return P.output(e.text, t, !0);
            } catch (e) {
              return !1;
            }
          },
          j = function (e, t) {
            var n,
              i,
              r,
              o,
              l,
              c,
              d = /^(\S*)(?:(\n)|(\s*))/,
              u = function (e) {
                for (var t, n = ""; e.length && (t = d.exec(e)); )
                  (e = e.substring(t[0].length)),
                    t[1] && (n += 'Str "' + E(t[1]) + '", '),
                    t[2]
                      ? (n += File.option.preLinebreakOnExport
                          ? "LineBreak, "
                          : "SoftBreak, ")
                      : t[3] && (n += "Space, ");
                return n;
              };
            e.inner && (e.inner = e.inner.replace(/, $/, ""));
            var h = /^file:[\\\/]{0,2}/i;
            switch (e.type) {
              case a.strong:
              case a.em:
              case a.del:
              case a.subscript:
              case a.superscript:
                return R[e.type] + " [" + e.inner + "], ";
              case a.plain:
              case a.escape:
              case a.tab:
              case a.emptyline:
                return u(e.text);
              case a.html_entity:
                return u(s.decodeHtmlEntity(e.text) || e.text);
              case a.pants:
                return u(e.inner);
              case a.softbreak:
                return File.option.preLinebreakOnExport
                  ? "LineBreak, "
                  : "SoftBreak, ";
              case a.code:
                return 'Code ("", [], []) "' + E(e.text.trim()) + '", ';
              case a.autolink:
              case a.url:
                return (
                  'Link ("", [], []) [Str "' +
                  E(e.text) +
                  '"] ("' +
                  E(e.href) +
                  '", ""), '
                );
              case a.atag:
                if (!M(t.target))
                  return (
                    'Link ("", [], []) [' +
                    e.inner +
                    '] ("' +
                    E(e.href) +
                    '", "' +
                    E("") +
                    '"), '
                  );
              case a.imgtag:
                if (!M(t.target)) {
                  var p = $($.parseHTML(e.text));
                  return (
                    'Image ("",[],[]) [Str "' +
                    E(p.attr("title") || p.attr("alt") || "") +
                    '"] ("' +
                    E(File.editor.imgEdit.getRealSrc(e.href).replace(h, "")) +
                    '","fig:"), '
                  );
                }
              case a.tag:
              case a.comment:
              case a.ruby:
                return 'RawInline (Format "html") "' + E(e.text) + '", ';
              case a.link:
                return (
                  "#" == (e.href || "").trim()[0] &&
                    (e.href = f.normalizeAnchor(e.href, t.anchorList)),
                  'Link ("", [], []) [' +
                    e.inner +
                    '] ("' +
                    E(e.href) +
                    '", "' +
                    E(e.title || "") +
                    '"), '
                );
              case a.image:
                return (
                  'Image ("",[],[]) [Str "' +
                  E(e.title || "") +
                  '"] ("' +
                  E(File.editor.imgEdit.getRealSrc(e.href).replace(h, "")) +
                  '","fig:"), '
                );
              case a.refimg:
                o = "Image";
              case a.reflink:
                return (
                  (i = (n = t.nodeMap.link_list.getNodeByRef(e.ref || e.text))
                    ? E(n.get("href").replace(h, ""))
                    : ""),
                  (r = E((n && n.get("title")) || "")),
                  "Image" == (o = o || "Link") &&
                    (e.inner = 'Str "' + E(r || "") + '"'),
                  o +
                    ' ("", [], []) [' +
                    e.inner +
                    '] ("' +
                    i +
                    '", "' +
                    r +
                    '"), '
                );
              case a.footnote:
                var m = t.nodeMap.foot_list.getNodeByRef(e.text);
                return m ? "Note [Para [" + A(m) + "]], " : u(e.text);
              case a.attr:
                return u(e.text);
              case a.emoji:
                return 'Str "' + E(e.inner) + '", ';
              case a.inline_math:
                if ("epub" == t.target) {
                  var v = DOMPurify.sanitize(
                    MathJax.tex2mml(
                      e.text.replace(/(^\s*\$+)|(\$+\s*$)|\u200b/g, "").trim(),
                      { display: !1 }
                    ),
                    g
                  );
                  if (v)
                    return (
                      'RawInline (Format "html") ' + JSON.stringify(v) + ", "
                    );
                }
                return (
                  'Math InlineMath "' +
                  E(e.text.replace(/(^\s*\$+)|(\$+\s*$)|\u200b/g, "")) +
                  '", '
                );
              case a.br:
              case a.linebreak:
                return "LineBreak, ";
              case a.highlight:
                if ("latex" == t.target)
                  -1 == x.indexOf("\\usepackage{color}") &&
                    (x.push("\\usepackage{color}"),
                    x.push("\\usepackage{soulutf8}"));
                else if ("docx" == t.target)
                  return (c = U(e)), O[t.target].replace("$0", E(s.escape(c)));
                return ((l = O)[t.target] || l.html).replace("$0", e.inner);
              case a.underline:
                return t.versionAfter2_10
                  ? R[e.type] + " [" + e.inner + "], "
                  : ((l = I),
                    "docx" == t.target
                      ? ((c = U(e)), l[t.target].replace("$0", E(s.escape(c))))
                      : (l[t.target] || l.html).replace("$0", e.inner));
              default:
                return u(e.text || "");
            }
          };
        o.prototype.exportToNative = function (e, t, n, i) {
          (File.editor.export.cleanUpTempFiles = S),
            (i = i || {}),
            function (e) {
              if (
                ((w = {
                  forExport: !0,
                  target: e,
                  nodeMap: this,
                  skipOp: H,
                  version: window.pandocVersion,
                }),
                (x = []),
                (v = []),
                (y = new Set()),
                void 0 === File.canvasratio)
              ) {
                File.canvasratio = 1;
                var t = document.createElement("canvas").getContext("2d"),
                  n = window.devicePixelRatio || 1,
                  i =
                    t.webkitBackingStorePixelRatio ||
                    t.mozBackingStorePixelRatio ||
                    t.msBackingStorePixelRatio ||
                    t.oBackingStorePixelRatio ||
                    t.backingStorePixelRatio ||
                    1;
                File.canvasratio = n / i;
              }
            }.call(this, e),
            "epub" == e &&
              (File.editor.mathBlock.saveMathState(), MathJax.texReset(0)),
            (i = Object.assign({}, w, i)),
            (k && k.options.nodeMap === this) || (k = new d.InlineLexer(i, j)),
            (i.anchorMap = {}),
            (i.anchorList = f.fetchAnchorList(i.anchorMap)),
            (i.versionAfter2_10 = s.compareVersion(i.version, "2.10") >= 0);
          var o = _(null, "\n ,", this.getFirst(), i),
            a = File.editor.docMenu.buildMetaMap() || {},
            l = null;
          (o = o.replace(/\uE088/g, function () {
            return (
              null === l &&
                (l = (function (e, t, n) {
                  try {
                    return (
                      'Div ("toc", [], []) [Para [' +
                      e.toc.headers
                        .map(
                          t
                            ? function (e) {
                                return (
                                  'Str "' +
                                  " ".repeat(e.get("depth") - 1) +
                                  '", Link ("", [], []) [' +
                                  A(e) +
                                  `] ("#${n[e.cid] || "header-" + e.cid}","")`
                                );
                              }
                            : function (e) {
                                return (
                                  'Str "' +
                                  "\\t".repeat(e.get("depth") - 1) +
                                  '", Link ("", [], []) [' +
                                  A(e) +
                                  `] ("#${n[e.cid] || "header-" + e.cid}","")`
                                );
                              }
                        )
                        .join(",LineBreak,") +
                      "]]"
                    );
                  } catch (e) {
                    return console.warn(e.stack), 'Para [Str ""]';
                  }
                })(File.editor.nodeMap, M(e), i.anchorMap)),
              l
            );
          })),
            "epub" == e &&
              void 0 == a.title &&
              (a.title = s.capitalizeEachWord(
                (File.bundle.fileName || "")
                  .replace(/\.[^.]+$/, "")
                  .replace(/-/g, " ")
              ));
          var c =
            "Pandoc (Meta {unMeta = fromList [" +
            (function (e) {
              var t = [];
              function n(e, t) {
                return (
                  "cover-image" == e &&
                    "string" == typeof t &&
                    /^\.+[\\\/]/.exec(t) &&
                    (t = h.normalizePath(
                      (h.getCurrentFileFolderPath() || "") + "/" + (t || "")
                    )),
                  `("${E(e)}",${i(t)})`
                );
              }
              function i(e) {
                return "string" == typeof e
                  ? /^\\[a-zA-Z]/.exec(e)
                    ? `${
                        e.indexOf("\n") > -1
                          ? "MetaBlocks [ RawBlock"
                          : "MetaInlines [ RawInline"
                      } (Format "tex") "${E(e)}"]`
                    : "MetaInlines [ " +
                      (k.output(e).replace(/, $/, "") || 'Str ""') +
                      "]"
                  : e instanceof Array
                  ? "MetaList [" + e.map(i).join(", ") + "]"
                  : `MetaMap ( fromList [${Object.keys(e)
                      .map((t) => n(t, e[t]))
                      .join(", ")}])`;
              }
              for (var r in (x.length &&
                (e["header-includes"] && "string" == typeof e["header-includes"]
                  ? (e["header-includes"] = e["header-includes"] + x.join("\n"))
                  : (e["header-includes"] = x.join("\n"))),
              e))
                t.push(n(r, e[r]));
              return t;
            })(a) +
            "]})\n [" +
            o +
            "]";
          return (
            r.isType(e, "epub", "docx", "odt", "latex") ? F(c, t, e, n) : t(c),
            "epub" == e && File.editor.mathBlock.restoreMathState(),
            c
          );
        };
      }
    ),
    $__System.registerDynamic(
      "1c",
      ["20", "e", "13", "1b", "11", "29", "26"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r = e("20"),
          o = e("e"),
          a = e("13"),
          s = a.Node,
          l = e("1b"),
          c = (l.SnapFlag, e("11")),
          d = e("29"),
          u = e("26"),
          h = u.map,
          p = a.TYPE,
          f =
            ((h = u.map),
            document.querySelector("#md-rawblock-tooltip-templ").innerHTML),
          m = function () {
            return !!(
              window.MathJax &&
              window.MathJax.config &&
              MathJax.startup.document
            );
          },
          g = async function () {
            if (!m())
              return new Promise((e) => {
                var t = function () {
                  m() ? e() : setTimeout(t, 50);
                };
                setTimeout(t, 50);
              });
          },
          v = !1;
        function y(e) {
          return window.requestIdleCallback
            ? new Promise((t) => requestIdleCallback(t, { timeout: e }))
            : (function (e) {
                return new Promise((t) => setTimeout(t, e));
              })(e);
        }
        async function b() {
          function e() {}
          var t, n, r;
          v ||
            (await g(),
            MathJax.startup.document.removeRenderAction("addMenu"),
            MathJax.startup.document.addRenderAction(
              "afterRender",
              1001,
              e,
              (e, i) => {
                var o = e.typesetRoot.querySelector("svg");
                (r = n = /^mjx-/i),
                  (t = o).querySelectorAll("[id]").forEach((e) => {
                    r.exec(e.id) || (e.id = "mjx-" + e.id);
                  }),
                  t.querySelectorAll("[class]").forEach((e) => {
                    e.setAttribute(
                      "class",
                      e
                        .getAttribute("class")
                        .split(/\s+/)
                        .filter((e) => n.exec(e))
                        .join(" ")
                    );
                  }),
                  o.parentElement == e.typesetRoot &&
                    e.typesetRoot.hasAttribute("aria-label") &&
                    o.setAttribute(
                      "alt",
                      e.typesetRoot.getAttribute("aria-label")
                    );
              }
            ),
            (i = MathJax.getMetricsFor(
              document.querySelector("#write>p") ||
                document.querySelector("#write"),
              !0
            )),
            (v = !0),
            File.option.noDisplayLinesInMath ||
              MathJax.startup.document.addRenderAction(
                "displayLines",
                1,
                e,
                (e, t) => {
                  e.math = (function (e) {
                    if ("\\u32E" == e[0]) return e.substr(1);
                    if (!/\\(\\|newline)/.exec(e)) return e;
                    var t = /^(?:\s|(?:\s*%[^\n]*\n))*\\([a-z]+)/i.exec(e);
                    return t &&
                      (/(begin|command|matrix|align|eq)/.exec(t[1]) ||
                        [
                          "def",
                          "let",
                          "newenvironment",
                          "array",
                          "displaylines",
                          "enclose",
                          "gather",
                          "gathered",
                          "leqalignno",
                          "multiline",
                          "split",
                        ].indexOf(t[1]) > -1)
                      ? e
                      : `\\displaylines{\n${e}\n}`;
                  })(e.math);
                }
              ));
        }
        function w() {
          return MathJax.startup.document.inputJax[0].parseOptions.tags;
        }
        function x(e) {
          var t = Array.from(document.querySelectorAll(".md-math-block")),
            n = null;
          if (e.hasAttribute("data-tag-before")) return e.dataset.mathTagBefore;
          if (t.indexOf(e) > -1)
            return (n = t[t.indexOf(e) - 1]) ? n.dataset.mathTagAfter : 0;
          for (const i of t) {
            if (e.compareDocumentPosition(i) != e.DOCUMENT_POSITION_FOLLOWING)
              break;
            n = i;
          }
          return n ? n.dataset.mathTagAfter : 0;
        }
        function C(e, t) {
          t || (t = w().allLabels), MathJax.texReset(e), (w().allLabels = t);
        }
        function F(e, t) {
          e.forEach((e) => {
            delete t[e];
          });
        }
        function S(e, t) {
          var n = [];
          return (
            t.forEach((t) => {
              -1 == e.indexOf(t) && n.push(t);
            }),
            n
          );
        }
        function k(e, t, n, r) {
          t = t || {};
          var o = w().counter;
          r && C((o = t.mathTagBefore)),
            F(JSON.parse(t.mathLabels || "[]"), w().allLabels);
          var a = Object.keys(w().allLabels);
          function s(e) {
            var t = {};
            return (
              (t.dom = e),
              (t.mathTagBefore = o),
              (t.mathTagAfter = w().counter),
              (t.mathLabels = JSON.stringify(S(a, Object.keys(w().allLabels)))),
              t
            );
          }
          try {
            return n
              ? s(MathJax.tex2svg(e, i))
              : new Promise((t) => {
                  MathJax.tex2svgPromise(e, i).then(
                    (e) => {
                      t(s(e));
                    },
                    () => {
                      MathJax.tex2svgPromise("", i).then((e) => {
                        t(s(e));
                      });
                    }
                  );
                });
          } catch (e) {}
        }
        async function E(e, t, n) {
          for (var i = [], r = 0; r < t.length; r++) {
            let a = t[r];
            if (!document.body.contains(a)) return !1;
            let s = e.getNode(a.getAttribute("cid")).get("text");
            r % 60 == 0 && (await y(100));
            var o = await k(s, a.dataset, !1, n);
            i.push(o);
          }
          return (
            t.forEach((e, t) => {
              var n = i[t];
              e.dataset.mathTagBefore = n.mathTagBefore;
              var r = e.querySelector(
                ".md-math-container, .md-mathjax-preview"
              );
              (r.innerHTML = ""),
                r.appendChild(n.dom),
                r.classList.remove("math-jax-preprocess"),
                (e.dataset.mathTagAfter = n.mathTagAfter),
                (e.dataset.mathLabels = n.mathLabels);
            }),
            t.length
          );
        }
        class T {
          constructor(e) {
            (this.isMathJaxReady = m),
              (this.getMathJaxTags = w),
              (this.renderTex = k),
              (this.editor = e),
              (this.queue = {}),
              (this.cache = {}),
              this.preview,
              this.bindEvent(),
              b();
          }
          saveMathState() {
            this.state = { count: w().counter, allLabels: w().allLabels };
          }
          restoreMathState() {
            this.state &&
              (MathJax.texReset(this.state.count),
              (w().allLabels = this.state.allLabels));
          }
          beforeRenderMath() {
            document
              .querySelector("#write")
              .classList.add("ty-before-first-render");
          }
          cacheUnder(e) {
            e &&
              e.querySelectorAll &&
              e.querySelectorAll("mjx-container").forEach((e) => {
                var t = e.closest(".md-math-block.mathjax-block"),
                  n = t && this.editor.getNode(t.getAttribute("cid"));
                if (n && !n.isDeleted()) {
                  var i = n.get("text");
                  this.cache[i]
                    ? delete this.cache[i]
                    : (this.cache[i] = {
                        attr: `data-math-tag-before="${
                          t.dataset.mathTagBefore
                        }" data-math-tag-after="${
                          t.dataset.mathTagAfter
                        }" data-math-labels="${c.escape(
                          t.dataset.mathLabels
                        )}"`,
                        inner: e.outerHTML,
                      });
                }
              });
          }
          clearCache() {
            this.cache = {};
          }
          bindEvent() {
            var e = this,
              t = this.editor;
            o(this.editor.sessionStr)
              .on("mousedown", ".md-math-container", function (e) {
                t.undo.prepCursorSnap();
              })
              .on("click startedit", ".md-math-container", async function (n) {
                if (void 0 === n.which || 1 == n.which) {
                  var i = o(this).closest("[cid]");
                  return await e.startEditing(i, "auto"), t.undo.endSnap(), !1;
                }
              })
              .on("losefocus", ".md-math-block", function (n) {
                e.stopEditing(this.getAttribute("cid")),
                  document.activeElement != t.writingArea &&
                    t.selection.scrollAdjust();
              })
              .on("endfocus", ".md-math-block", function (n) {
                e.stopEditing(this.getAttribute("cid"), !1, !0),
                  document.activeElement != t.writingArea &&
                    t.selection.scrollAdjust();
              })
              .on("keydown", ".md-math-block", async function (t) {
                var n = t.keyCode || t.which;
                if ("Enter" === h[n])
                  return (
                    await e.startEditing(o(this), "auto"),
                    t.stopPropagation(),
                    t.preventDefault()
                  );
              })
              .on(
                "blur inline-change",
                ".md-math-block .ty-input",
                function () {
                  if (e.currentCm) {
                    var t = e.editor.getNode(e.currentCm.cid);
                    e.tryAddTagUndo(t, o(this));
                  }
                }
              )
              .on("keydown", ".md-math-block .ty-input", function (t) {
                "Enter" == h[t.keyCode || t.which] &&
                  e.editor.selection.moveUpOrDown(!1, t);
              })
              .on(
                "click",
                ".md-math-block .md-rawblock-after, .md-math-block .md-rawblock-before",
                function (e) {
                  e.target == this && this.querySelector(".ty-input").focus();
                }
              )
              .on("keydown", ".md-math-block .ty-input", function (t) {
                var n,
                  i = t.keyCode || t.which;
                if ("Delete" == h[i]) {
                  if (
                    (n = e.editor.selection.getRangy()).commonAncestorContainer
                      .parentElement != this
                  )
                    return !1;
                  if (
                    n.startOffset == n.endOffset &&
                    n.endOffset == this.textContent.length
                  )
                    return e.editor.selection.moveUpOrDown(!1), !1;
                } else if ("Backspace" == h[i]) {
                  if (
                    (n = e.editor.selection.getRangy()).commonAncestorContainer
                      .parentElement != this
                  )
                    return !1;
                  if (n.startOffset == n.endOffset && 0 == n.startOffset)
                    return e.editor.selection.moveUpOrDown(!0), !1;
                } else if ("Return" == h[i] || "Enter" == h[i])
                  return e.editor.selection.moveUpOrDown(!1), !1;
              })
              .on("paste", ".md-math-block .ty-input", function (e) {
                setTimeout(function () {
                  (e.target.textContent = e.target.textContent
                    .replace(/(^[\n{]+)|([\n}]+$)/g, "")
                    .split(/\r?\n/)[0]),
                    o(e.target).trigger("change");
                }, 0);
              })
              .on(
                "click",
                ".md-fences-math .md-fences-adv-panel",
                function (e) {
                  var t = o(this).prevAll(".CodeMirror");
                  if (t.length && !t.hasClass("CodeMirror-focused")) {
                    var n = t[0].CodeMirror;
                    n && (n.refresh(), n.focus());
                  }
                }
              );
          }
          tryAddTagUndo(e, t) {
            if (!t.hasClass("ty-input")) return !1;
            e || (e = this.editor.getNode(this.currentCm.cid));
            var n = t.hasClass("ty-input-before") ? "tagBefore" : "tagAfter",
              i = e.get(n),
              r = t.text();
            if (i != r) {
              var o = l.makeEmptyCommand();
              return (
                o.undo.push({
                  id: e.cid,
                  type: "attr",
                  key: n,
                  value: i || "",
                }),
                e.set(n, r),
                o.redo.push({ id: e.cid, type: "attr", key: n, value: r }),
                self.editor.undo.register(o),
                !0
              );
            }
            return !1;
          }
          async renderAfterLabelChanges(e) {
            var t = Array.from(document.querySelectorAll(".md-math-block"));
            e = e || [];
            var n = t.filter((t) => {
              if (~e.indexOf(t)) return !1;
              try {
                var n = this.editor.getNode(t.getAttribute("cid")).get("text");
                return !!/\\(eq)?ref\{/.exec(n);
              } catch (e) {}
              return !1;
            });
            return await E(this.editor, n, !0);
          }
          async renderAfter(e, t) {
            await g();
            var n = Array.from(document.querySelectorAll(".md-math-block")),
              i = n.indexOf(e) + 1,
              r = 0;
            if (!i)
              for (var o in n) {
                const t = n[o];
                if (
                  !(
                    e.compareDocumentPosition(t) & e.DOCUMENT_POSITION_PRECEDING
                  )
                )
                  break;
                i = o + 1;
              }
            if (
              (i &&
                !t &&
                !(r = e.dataset.mathTagAfter) &&
                n[i - 1] &&
                (r = n[i - 1].dataset.mathTagAfter),
              !t && C(r),
              n[i] && n[i].dataset.mathTagBefore - 0 == w().counter)
            )
              return !1;
            var a = n.slice(i);
            return 0 != (await E(this.editor, a)) && !!a.length && a;
          }
          async renderUnder(e, t) {
            await g();
            var n = document.querySelector("#write").classList;
            n.contains("ty-before-first-render") &&
              setTimeout(() => {
                n.remove("ty-before-first-render");
              }, 10);
            var i = Array.from(
              (e || document).querySelectorAll(".md-math-block")
            );
            (e &&
              e.classList &&
              e.classList.contains("md-math-block") &&
              (i = [e]),
            t) ||
              i.find((e) => !e.querySelector("mjx-container")) ||
              (i = []);
            if (i.length) {
              i.length > 30 && (await y(100));
              var r = this.editor,
                o = Object.entries(w().allLabels).map((e) => [e[0], e[1].tag]),
                a = (e && e.dataset && e.dataset.needRefresh) || !1;
              a && e.removeAttribute("data-need-refresh");
              var s = x(i[0]),
                l = i.last().dataset.mathTagAfter;
              if ((C(s), !1 !== (await E(r, i)))) {
                a = a || l != w().counter;
                var c = Object.entries(w().allLabels).map((e) => [
                  e[0],
                  e[1].tag,
                ]);
                if (
                  (a =
                    a ||
                    (function (e, t) {
                      if (e.length != t.length) return !0;
                      for (var n of e)
                        if (!t.find((e) => e[0] == n[0] && e[1] == n[1]))
                          return !0;
                      return !1;
                    })(o, c))
                ) {
                  var d = await this.renderAfter(i.last(), !0);
                  await Promise.all([
                    this.renderAfterLabelChanges(d),
                    this.editor.mathInline.renderAll(!0, void 0, !0),
                  ]);
                }
                a || (await this.editor.mathInline.renderAll(!1, e)),
                  e || this.editor.tryEnterBusyMode();
              }
            } else await this.editor.mathInline.renderAll(!1, e);
          }
          getTex(e) {
            return this.editor.getNode(e).get("text");
          }
          getCidAndElem(e) {
            var t = e,
              n = e;
            return (
              "string" == typeof e
                ? (n = this.editor.findElemById(t))
                : (t = n.attr("cid")),
              [t, n]
            );
          }
          syncToNode(e) {
            var t = "string" == typeof e ? this.editor.getNode(e) : e;
            return (
              (this.currentCm || {}).cid === t.cid &&
                t.set("text", this.currentCm.getValue()),
              t
            );
          }
          remove(e) {
            var t,
              n = this.getCidAndElem(e),
              i = n[0],
              r = n[1],
              a = editor.getNode(i),
              s = editor.undo.UndoManager,
              l = s.makeEmptyCommand(),
              c = this.currentCm;
            this.beforeDeleteFences(a),
              c && c.cid === a.cid
                ? l.undo.push({
                    type: "fences-pos",
                    pos: c.getCursor(),
                    id: c.cid,
                  })
                : l.undo.push(this.editor.selection.buildUndo()),
              l.undo.push(s.buildReplaceUndo(a)),
              a.set("type", p.paragraph),
              a.set("text", ""),
              l.redo.push(s.buildReplaceUndo(a)),
              (t = o(o.parseHTML(a.toHTML())[0])),
              r.replaceWith(t),
              editor.selection.jumpIntoElemEnd(t),
              l.redo.push(editor.selection.buildUndo()),
              editor.undo.register(l),
              (this.currentCm = void 0);
          }
          beforeDeleteFences(e) {
            var t = e.cid,
              n = e,
              i = this;
            t || ((t = e), (n = this.syncToNode(t))), (this.currentCm = void 0);
            var r = this.editor.findElemById(t);
            if (
              (F(JSON.parse(r.attr("data-math-labels") || "[]"), w().allLabels),
              this.stopEditing(n.cid, !1, !0),
              File.option.autoNumberingForMath && !File.inBusyMode)
            ) {
              var o = r.next();
              setTimeout(async () => {
                o.length && o.closest("body")
                  ? (await i.renderAfter(o[0])) &&
                    (await i.editor.mathInline.renderAll(!0, void 0, !0))
                  : i.forceRefreshSoon();
              }, 10);
            }
          }
          async stopEditing(e, t, n) {
            if ((this.currentCm && this.currentCm.cid) || e) {
              var i = this.getCidAndElem(e || this.currentCm.cid),
                r = i[0],
                a = i[1],
                s = this.editor,
                c = this.currentCm;
              if (a[0] && c) {
                if (c.cid == r) {
                  var d = a[0].querySelector(".md-mathjax-preview");
                  if (d) {
                    var u = l.makeEmptyCommand();
                    u.undo.push({
                      type: "fences-pos",
                      pos: c.getCursor(),
                      id: c.cid,
                    });
                    var h = this.syncToNode(r);
                    d &&
                      ((this.currentCm = void 0),
                      a
                        .html(
                          f.replace(
                            "{type}",
                            o.localize.getString("Math", "Menu")
                          )
                        )
                        .removeClass("md-rawblock-on-edit"),
                      d.setAttribute(
                        "class",
                        "md-rawblock-container md-math-container"
                      ),
                      d.setAttribute("tabindex", "-1"),
                      a[0].appendChild(d),
                      await this.renderUnder(a[0], !0),
                      t && s.selection.jumpToNextBlock(h, u),
                      !n && s.undo.register(u));
                  } else this.currentCm = void 0;
                }
              } else this.currentCm = void 0;
            }
          }
          async startEditing(e, t) {
            if (!File.isLocked) {
              var n = this.getCidAndElem(e),
                i = n[0],
                a = n[1],
                l = this.editor,
                c = this.editor.getNode(i);
              if (
                (this.currentCm &&
                  this.currentCm.cid != i &&
                  (await this.stopEditing()),
                s.isType(c, p.math_block))
              ) {
                var d = document.querySelector("content"),
                  u = null;
                o(document.activeElement).closest(".md-math-block").length &&
                  (u = d.scrollHeight - d.scrollTop - d.clientHeight);
                var h,
                  g,
                  v = null,
                  y = !1,
                  b = null;
                if (i) {
                  if (this.currentCm && this.currentCm.cid === i) {
                    if (
                      l.writingArea.contains(this.currentCm.getWrapperElement())
                    )
                      return this.currentCm.focus(), this.currentCm;
                    this.currentCm = null;
                  }
                  this.currentCm &&
                    (await this.stopEditing(this.currentCm.cid),
                    window.getSelection().removeAllRanges()),
                    a
                      .html(
                        f.replace(
                          "{type}",
                          o.localize.getString("Math", "Menu")
                        ) +
                          document.querySelector("#md-mathblock-panel-templ")
                            .textContent
                      )
                      .addClass("md-rawblock-on-edit"),
                    c.get("tagBefore") &&
                      a
                        .find(".md-rawblock-before .ty-input")
                        .text(c.get("tagBefore")),
                    c.get("tagAfter") &&
                      a
                        .find(".md-rawblock-after .ty-input")
                        .text(c.get("tagAfter"));
                  var k = a.children(".md-mathblock-panel");
                  if (!k.length) return;
                  (this.currentCm = (function (e) {
                    var t = r(
                      k[0].querySelector(".md-rawblock-input"),
                      {
                        styleSelectedText: !0,
                        styleActiveLine: !0,
                        lineWrapping: !File.option.noLineWrapping,
                        mode: "stex",
                        placeholder: o.localize.getString(
                          "Input Math TeX here"
                        ),
                        theme: " inner null-scroll",
                        autoCloseBrackets: !File.option.noPairingMatch,
                        autoCloseTags: !File.option.noPairingMatch,
                        value: c.get("text").trim(),
                        lineNumbers: File.option.showLineNumbersForFence,
                        resetSelectionOnContextMenu: !0,
                        dragDrop: !1,
                        indentUnit: File.option.codeIndentSize,
                        tabSize: File.option.codeIndentSize,
                        lineWiseCopyCut: File.option.lineWiseCopyCut,
                      },
                      e,
                      i
                    );
                    return (
                      t.on("changes", function (n, i) {
                        var r;
                        e.fences.handleUserReplacement(n, i),
                          e.wordCount.quickUpdate(t.cid),
                          (r = a[0]),
                          b && clearTimeout(b),
                          (b = setTimeout(async () => {
                            await E(r), (b = null);
                          }, 100)),
                          e.selection.clearGlobalColumn(),
                          e.syncChange([
                            { type: "sync", id: c.id, tex: t.getValue() },
                          ]),
                          File.isTypeWriterMode &&
                            !File.option.scrollWithCursor &&
                            e.selection.typeWriterScroll(
                              t.cursorCoords(t.getCursor())
                            );
                      }),
                      t.on("cursorActivity", function () {
                        e.fences.handleCursorActivity(t);
                      }),
                      t.on("blur", function (e) {
                        setTimeout(function () {
                          document.body.contains(e.getWrapperElement()) &&
                            c.set("text", e.getValue());
                        }, 0);
                      }),
                      t.on("keydown", function (t, n) {
                        e.fences.onKeyDown(
                          t,
                          n,
                          e,
                          function (t) {
                            if (!t.getValue().length)
                              return (
                                e.mathBlock.remove(t.cid),
                                n.preventDefault(),
                                n.codemirrorIgnore
                              );
                          },
                          function (t, n) {
                            return n.shiftKey
                              ? (n.stopPropagation(), !0)
                              : (n.ctrlKey || n.metaKey) &&
                                (function (e) {
                                  var t = e.doc.getCursor();
                                  return (
                                    !t ||
                                    e.doc.indexFromPos(t) >=
                                      e.doc.getValue().length
                                  );
                                })(t)
                              ? (setTimeout(function () {
                                  e.UserOp.insertParagraph();
                                }, 20),
                                n.stopPropagation(),
                                !0)
                              : void 0;
                          }
                        );
                      }),
                      t.focus(),
                      t
                    );
                  })(this.editor)),
                    E(a[0]).then(() => {
                      File.option.autoNumberingForMath &&
                        !File.inBusyMode &&
                        this.renderAfter(a[0]);
                    }),
                    (g = this.currentCm).focus(),
                    t &&
                      ("<Empty \\space Math \\space Block>" == g.getValue()
                        ? g.execCommand("selectAll")
                        : "end" == t || "auto" == t
                        ? g.execCommand("goDocEnd")
                        : "start" == t && g.execCommand("goDocStart"),
                      l.refocus(i),
                      null === u || u > 100
                        ? l.selection.scrollAdjust()
                        : (d.scrollTop = d.scrollHeight - u - d.clientHeight));
                }
                return this.currentCm;
              }
            }
            async function E(e) {
              if (m()) {
                !(function (e) {
                  v ||
                    (e.hasAttribute("data-math-tag-before")
                      ? ((v = e.dataset.mathTagBefore),
                        (h = JSON.parse(e.dataset.mathLabels || "[]")))
                      : (v = x(e))),
                    v
                      ? (C(v), (e.dataset.mathTagBefore = v))
                      : (e.dataset.mathTagBefore = w().counter),
                    F(JSON.parse(e.dataset.mathLabels || "[]"), w().allLabels);
                })(e);
                var t = Object.keys(w().allLabels),
                  n = e.querySelector(".CodeMirror").CodeMirror,
                  i = e.querySelector(".md-mathjax-preview");
                if (i) {
                  var r = n.getValue() || "<Empty \\space Math \\space Block>",
                    o = MathJax.getMetricsFor(i, !0);
                  try {
                    let e = await MathJax.tex2svgPromise(r, o);
                    e.querySelector("[data-mml-node='merror']") &&
                    i.children.length
                      ? (i.children[1] && i.children[1].remove(),
                        (e.style.marginTop = "8px"),
                        i.appendChild(e))
                      : ((i.innerHTML = ""), i.appendChild(e));
                  } catch (e) {}
                  !(function (e) {
                    var t = w().counter;
                    e.dataset.mathTagAfter &&
                      e.dataset.mathTagAfter - 0 != t &&
                      ((e.dataset.mathTagAfter = t), (y = !0)),
                      JSON.stringify(h) != e.dataset.mathLabels && (y = !0);
                  })(e);
                  var a = Object.keys(w().allLabels);
                  (e.dataset.mathLabels = JSON.stringify(S(t, a))),
                    y && (e.dataset.needRefresh = !0);
                }
              }
            }
          }
          copyAsTex(e) {
            var t = (e || document.activeElement || document.body).getAttribute(
                "cid"
              ),
              n = "";
            t && (n = this.editor.getNode(t).get("text").trim()),
              this.editor.UserOp.setClipboard(null, null, n, !0);
          }
          copyAsMathML(e, t) {
            var n = "",
              i = this.editor,
              r =
                (e || document.activeElement || document.body).getAttribute(
                  "cid"
                ) || i.focusCid;
            r &&
              ((n = i.getNode(r).get("text")),
              File.option.noDisplayLinesInMath || (n = "\\u32E" + n));
            var o = MathJax.tex2mml(n, { display: !0 });
            if (t) i.UserOp.nativeCopyText(o);
            else {
              var a =
                "<pre class='md-fences' lang='xml'>" + c.escape(o) + "</pre>";
              i.UserOp.setClipboard(a, null, o, !0);
            }
          }
          copyAsImage(e) {
            var t = (
                (e && e.querySelector) ||
                document.activeElement
              ).querySelector("svg"),
              n = this.editor,
              i = d.SVG2HtmlImg(t);
            n.UserOp.setClipboard(i, null, i, !0);
          }
          forceRefreshSoon() {
            this.forceRefreshTimer_ &&
              (clearTimeout(this.forceRefreshTimer_),
              (this.forceRefreshTimer_ = null));
            var e = this;
            this.forceRefreshTimer_ = setTimeout(function () {
              e.forceRefresh(), (e.forceRefreshTimer_ = null);
            }, 10);
          }
          cleanUpAMS() {
            window.MathJax && MathJax.texReset && MathJax.texReset(0);
          }
          async forceRefresh() {
            (this.editor.sourceView && this.editor.sourceView.inSourceMode) ||
              (m()
                ? (await b(),
                  this.editor.brush.clearAndPause(),
                  this.cleanUpAMS(),
                  await this.renderUnder(document, !0),
                  File.option.enableInlineMath &&
                    (await File.editor.mathInline.renderAll(!0)),
                  this.editor.brush.resume())
                : setTimeout(this.forceRefresh.bind(this), 500));
          }
        }
        (T.isMathType = function (e) {
          return (
            File.option.gitlabMath &&
            "string" == typeof e &&
            s.isType((e || "").toLowerCase(), "math")
          );
        }),
          (n.exports = T);
      }
    ),
    $__System.registerDynamic(
      "4a",
      [
        "13",
        "11",
        "19",
        "30",
        "56",
        "28",
        "17",
        "15",
        "1c",
        "32",
        "29",
        "e",
        "57",
        "58",
        "2b",
      ],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("13"),
          r = i.Node,
          o = i.TYPE,
          a = (i.NodeCollectionUtils, e("11")),
          s = e("19"),
          l = e("30"),
          c = (e("56"), e("28")),
          d = e("17"),
          u = e("15"),
          h = e("1c"),
          p = e("32"),
          f = e("29"),
          m = e("e"),
          g = e("57"),
          v = e("58"),
          y =
            (e("2b"),
            function () {
              for (
                var e = document.querySelectorAll("figure>table"), t = 0;
                t < e.length;
                t++
              ) {
                var n = e[t],
                  i = n.parentElement,
                  r = i.scrollWidth,
                  o = i.offsetWidth;
                r > o &&
                  r > 50 &&
                  ((n.style.zoom = o / r), (i.style.overflowX = "visible"));
              }
            }),
          b = function () {
            for (
              var e = document.querySelectorAll("#write a, #write [id]"),
                t = /^\s*#(.+)$/,
                n = {
                  "\b": "\\b",
                  "\t": "\\t",
                  "\n": "\\n",
                  "\f": "\\f",
                  "\r": "\\r",
                  '"': '\\"',
                  "'": "\\'",
                  "\\": "\\\\",
                },
                i = function (e) {
                  return e
                    .replace(/["\\\b\t\n\f\r]/g, function (e) {
                      return n[e];
                    })
                    .replace(/\u200b/g, "");
                },
                r = 0;
              r < e.length;
              r++
            ) {
              var o,
                a = e[r],
                s = a.getAttribute("name") || a.getAttribute("id"),
                l = a.getAttribute("href");
              if (!a.classList.contains("md-print-anchor")) {
                if (s) {
                  var c = document.createElement("a"),
                    d = document.createTextNode(" ");
                  c.appendChild(d),
                    c.setAttribute("class", "md-print-anchor"),
                    c.setAttribute("href", "uaf://" + i(s)),
                    a.parentNode.insertBefore(c, a);
                }
                l &&
                  (o = t.exec(l)) &&
                  ((l = o[1]), a.setAttribute("href", "uat://" + i(l)));
              }
            }
          };
        var w = async function (e, t, n, i, r, o) {
            "custom" == (n = n || {}).type && (e = "custom");
            var s = m.localize.getString(
                File.isMac ? "Reveal in Finder" : "Reveal in File Explorer",
                "Front"
              ),
              l = !1,
              d = n.saveDialog;
            if (n.runCommand) {
              d = !0;
              var u = F.processExportVariables(n.runCommandStr || "", {
                  outputPath: t,
                }),
                h =
                  p.getCurrentFileFolderPath() ||
                  window._options.documentsPath ||
                  "/",
                f = await (function (e, t) {
                  return File.isNode
                    ? v.runExportCommand(e, t)
                    : File.isMac
                    ? new Promise((n) => {
                        bridge.callHandler(
                          "controller.runCommand",
                          { args: e, cwd: t || "" },
                          function (e) {
                            n({
                              code: e[0] ? 0 : -1,
                              message: e[1],
                              error: e[2],
                            });
                          }
                        );
                      })
                    : void 0;
                })(u, h);
              (i = f.message || ""),
                0 != f.code && ((l = !0), (r = f.error || ""));
            }
            if (l || n.showOutput) {
              var g = "",
                y = "";
              r &&
                (g = `<pre style='user-select: text;font-size: .9em;cursor: text;line-height: 1.4;text-align:left;'>${a.escape(
                  r
                )}</pre>`),
                (!i && r) ||
                  (y = `<pre style='user-select: text;font-size: .9em;cursor: text;line-height: 1.4;text-align:left;'>${
                    a.escape(i) || "(empty)"
                  }</pre>`);
              var b = `<pre style='user-select: text;font-size: .9em;cursor: text;line-height: 1.4;text-align:left;'>${
                a.escape(n.runCommandStr || n.args || n.command) || "(empty)"
              }</pre>`;
              c.showDialog({
                leftAlign: !0,
                title: m.localize.getString(
                  l ? "Run command after export failed" : "Export Success!",
                  "Panel"
                ),
                html: `<div>${m.localize.getString(
                  "Command Arguments:",
                  "Panel"
                )}</div>${b}<div>${m.localize.getString(
                  "Console Output:",
                  "Panel"
                )}</div>${g}${y}`,
                buttons: d
                  ? [s, m.localize.getString("Close")]
                  : [m.localize.getString("Close")],
                callback: function (e) {
                  d && !e && JSBridge.showInFinder(t);
                },
              }),
                c.hideNotification();
            } else
              !(function () {
                var a = r
                  ? "Export operation succeeded with warnings."
                  : "Export operation finished successfully.";
                (a = m.localize.getString(a, "Panel")),
                  "custom" == e
                    ? (n.showOutput && (a = i.trim().split("\n").last() || a),
                      n.saveDialog || (s = void 0))
                    : n.runCommand && (a = i.trim().split("\n").last() || a);
                var l = [
                  r || "",
                  "custom" == e && o
                    ? m.localize.getString("Command Arguments:", "Panel") +
                      " " +
                      o.join("")
                    : "",
                ]
                  .join("\n----------\n")
                  .replace(/^\n\-+\n/, "");
                c.showNotificationWithTitle(
                  a,
                  l,
                  s,
                  function () {
                    JSBridge.showInFinder(t);
                  },
                  { checkFocus: !0 }
                );
              })();
            n.openExportLocation &&
              (JSBridge.showInFinder(t),
              !r && setTimeout(c.hideNotification, 2e3)),
              n.openExportFile &&
                (JSBridge.openFile(t),
                !r && setTimeout(c.hideNotification, 2e3)),
              File.isMac && File.editor.export.cleanUpTempFiles();
          },
          x = function (e, t, n, i) {
            (t = t || {}), (n = n || {});
            var r = t.outputPath || n.outputPath || "";
            function o(e) {
              return "string" == typeof e
                ? "unset" == e
                  ? ""
                  : e.replace(/\n(.|\n\r)+/g, "")
                : e instanceof Array
                ? e.join(", ")
                : void 0 === e || null === e
                ? e
                : e + "";
            }
            function s(...e) {
              for (var t of e) if (void 0 !== t) return t;
            }
            return e
              .replace(/\${([^:}]+)}/gi, function (e, l) {
                var c = (l || "").toLowerCase();
                if ("today" == c)
                  return new Date().toISOString().substring(0, 10);
                if ("outputpath" == c) return r;
                if ("outputfolder" == c) return a.getFolder(r);
                if ("outputfilename" == c)
                  return p.getFileNameFromPath(r).replace(/\..+$/, "");
                if ("outputfilefullname" == c) return p.getFileNameFromPath(r);
                if ("currentpath" == c) return File.bundle.filePath || "";
                if ("currentfolder" == c)
                  return p.getCurrentFileFolderPath() || "";
                if ("currentfilename" == c)
                  return p
                    .getFileNameFromPath(File.bundle.filePath || "")
                    .replace(/\..+$/, "");
                if ("currentfilefullname" == c)
                  return p.getFileNameFromPath(File.bundle.filePath || "");
                if ("openedFolder" == c) return File.getMountFolder();
                var d = File.editor.localSettingBridge,
                  u = o(
                    s(n[l], n[c], d.getSetting(l), d.getSetting(c), t[l], t[c])
                  );
                if (void 0 == u && c.indexOf(".") > 0) {
                  let e = c.split(/\./);
                  var h;
                  for (var f of e)
                    if (
                      !(h = h
                        ? h[f]
                        : d.getSetting(f) || d.getSetting(f.toLowerCase()))
                    )
                      break;
                  if (void 0 != h)
                    return (function (e) {
                      return i && /['";&|><\s]/.exec(e)
                        ? "" + e.replace(/['"]/g, "") + ""
                        : e;
                    })(o(h));
                }
                return s(u, "${" + l + "}");
              })
              .replace(/(['"])(.*?)\1/g, function (e, t, n) {
                return t + n.replace(/\uE033|\uE034/g, "") + t;
              })
              .replace(/\uE033(.*?)\uE034/g, function (e, t) {
                return '"' + t + '"';
              });
          };
        const C = (e, t) => {
          if (
            e &&
            (e = g.renderHeaderFooterText(
              e,
              t,
              "${pageNo}",
              "${totalPages}"
            )).trim().length
          ) {
            var n = document.createElement("SPAN");
            return (
              (n.textContent = e),
              (n.style.color = m("p").css("color")),
              (n.style.fontFamily = "-apple-system"),
              (n.style.fontSize = "6pt"),
              n.outerHTML
            );
          }
        };
        class F {
          constructor(e) {
            (this.editor = e),
              (this.processExportVariables = x),
              (this.onExportSuccess = w),
              this.registerBridge();
          }
          recordLastExport(e, t) {
            delete e.overwrite, delete e.path;
            var n = Object.assign({ path: t }, e);
            JSBridge.invoke("export.recordLastExport", n),
              (File.option.lastExport = n),
              (File.option.lastExportNoOverwrite = !1);
          }
          registerBridge() {
            if (File.isMac) {
              var e = this;
              bridge.registerHandler("export.exportToNative", function (t, n) {
                e.exportToNative(
                  t.target,
                  function (e, t) {
                    n({ native: e, option: t });
                  },
                  t.folder,
                  t.option
                );
              }),
                bridge.registerHandler(
                  "export.onExportSuccess",
                  function (e, t) {
                    w(e.type, e.path, e.option, e.message, e.error, e.args),
                      t && t();
                  }
                ),
                bridge.registerHandler(
                  "export.onExportCanceled",
                  function (e, t) {
                    c.hideNotification();
                  }
                ),
                bridge.registerHandler(
                  "export.onExportFailed",
                  function (e, t) {
                    var n = document.createElement("DIV");
                    (n.innerHTML = m.localize
                      .getString(
                        "Failed to export file to <em>{0}</em>",
                        "Panel"
                      )
                      .format(
                        e.path
                          ? a.escape(e.path)
                          : m.localize.getString("Export Failed", "Panel")
                      )),
                      c.hideNotification(),
                      c.showErrorDialog(n.textContent, a.escape(e.error)),
                      console.sendError(e.error, "warning"),
                      t && t();
                  }
                ),
                bridge.registerHandler(
                  "export.dataForExport",
                  async function (t, n) {
                    e.showExportNotification(!0),
                      setTimeout(
                        function () {
                          setTimeout(
                            async function () {
                              t.forImage &&
                                (t = Object.assign(
                                  { fontSize: "24px", width: 640 },
                                  t
                                ));
                              var i = m("[cid]").text(),
                                r = !!/[\u4E00-\u9FCC]{4}/.exec(i);
                              n({
                                suggestedFilename:
                                  File.getSuggestedFileName() || "",
                                content: await e.exportToHTML(t || {}),
                                pdfHeader: C(t.header, t),
                                pdfFooter: C(t.footer, t),
                                hasNonAlphabet: r,
                              });
                            },
                            e.beforeExport(t.forPrint) ? 1e3 : 0
                          ),
                            e.showExportNotification(!0);
                        },
                        File.isMac ? 50 : 0
                      );
                  }
                ),
                bridge.registerHandler("export.exportToHTML", function (t, n) {
                  e.showExportNotification(!0),
                    setTimeout(
                      async function () {
                        File.sync();
                        var i = await e.exportToHTML(t);
                        n(i);
                      },
                      File.isMac ? 400 : 0
                    );
                }),
                bridge.registerHandler(
                  "export.exportWithCommand",
                  async function (t, n) {
                    var i = await e.exportWithCommand(t);
                    t.path || (t.path = t.output), n(i);
                  }
                ),
                bridge.registerHandler("pdf.getFixData", function (t, n) {
                  t = t || {};
                  try {
                    t[":headers:"] = e.editor.library.outline.getHeaderMatrix(
                      !0
                    );
                    var i = e.editor.localSettingBridge.getCalculatedSetting();
                    t = Object.assign(t, i);
                  } catch (e) {
                    console.sendError(e);
                  }
                  n(t);
                }),
                bridge.registerHandler("export.prepare", function (e, t) {
                  File.editor.EditHelper.hideNotification(),
                    t((e = File.editor.localSettingBridge.loadExportOption(e)));
                });
            }
          }
          beforeExport(e) {
            return (
              File.editor.sourceView.inSourceMode
                ? (File.editor.sourceView.hide(),
                  File.editor.library.recoverSidebar(),
                  File.isMac &&
                    bridge.callHandler("window.updateUIAfterExitSourceMode"))
                : (File.editor.store(!0), (e = !1)),
              File.sync(),
              File.editor.nodeMap.toc.updateHTML(),
              File.megaMenu && File.megaMenu.hide(),
              document.body.classList.remove("ty-show-notification"),
              e
            );
          }
          showExportNotification(e) {
            c.showProcessingNotification("Exporting in progress...", e);
          }
          exportToNative(e, t, n, i) {
            (t = t || function () {}), (i = i || {});
            var r =
              "pandoc" == e || "native" == e ? i.raw || i.targetFormat : e;
            "latex-pdf" == r ? (r = "latex") : "mediawiki" == r && (r = "wiki");
            var o = Object.assign({ cwd: p.getCurrentFileFolderPath() }, i, {
              target: r,
              folder: n,
            });
            return (
              File.isMac &&
                i.extraArguments &&
                (o.extraArguments = i.extraArguments.map((e) =>
                  File.editor.export.processExportVariables(e, {
                    outputPath: i.path,
                  })
                )),
              this.editor.nodeMap.exportToNative(
                r,
                function (e) {
                  t(e, o);
                },
                n,
                Object.assign({}, o)
              )
            );
          }
          exportToImage(e) {
            g.exportToImage(e);
          }
          async exportAndSaveHTML(e) {
            var t = await p.showExportDialog("html", e);
            if (t) {
              this.recordLastExport(e, t);
              var n = await this.exportToHTML(e);
              File.fs.writeFile(t, n, (n) => {
                n
                  ? (c.showDialog({
                      title: m.localize.getString("Error"),
                      html:
                        m.localize
                          .getString(
                            "Failed to export file to <em>{0}</em>",
                            "Panel"
                          )
                          .format(a.escape(t)) +
                        "<br/>" +
                        a.escape(n.message),
                      backdrop: "static",
                      type: "error",
                    }),
                    console.sendError(n, "warn"))
                  : w("html", t, e);
              });
            }
          }
          exportCollection(e, t, n) {
            var i = n || {},
              p = i.forPrint,
              g = i.noStyle,
              v = i.exportFooter,
              y = i.exportInline,
              b = i.forImage,
              w = i.anchorMap || {},
              x = i.anchorList || c.fetchAnchorList(w, g);
            (i.anchorList = x), (i.anchorMap = w);
            var C = this.editor.nodeMap,
              F = this.editor,
              k =
                ((y =
                  y ||
                  new s.InlineLexer(
                    {
                      nodeMap: C,
                      count: 1,
                      footnoteList: [],
                      appendFootnote: function (e, n) {
                        if (!t[n]) {
                          t[n] = [""];
                          var i = y.output(
                            e.get("text"),
                            l.decorateAsExport,
                            !1,
                            { parent: e, skipFootnote: n }
                          );
                          t[n][0] =
                            "<span class='md-fn-count'>" + n + "</span> " + i;
                        }
                        var r = t[n].length - 1,
                          o = n + (r ? "-" + r : "");
                        return (
                          t[n].push(
                            " <a name='dfref-footnote-" +
                              o +
                              "' href='#ref-footnote-" +
                              o +
                              "' title='" +
                              m.localize.getString("back to document") +
                              "' class='reversefootnote' >↩</a>"
                          ),
                          o
                        );
                      },
                      noStyle: g,
                      forPrint: p,
                      anchorList: x,
                      skipOp: {
                        atag: !0,
                        underline: !0,
                        comment: !0,
                        imgtag: !0,
                      },
                    },
                    l.decorateAsExport
                  )),
                ""),
              E =
                void 0 === i.split || null === i.split
                  ? g
                    ? "\n"
                    : ""
                  : i.split,
              T = this;
            function _(e, n) {
              if ("string" == typeof e) return y.output(e, l.decorateAsExport);
              var o = e.get("children");
              return r.canContainBlock(e.get("type"))
                ? o && o.length > 0
                  ? ((i.exportFooter = !1), T.exportCollection(o, t, i))
                  : y.output(e.get("text"), l.decorateAsExport)
                : y.output(
                    e.get("text"),
                    l.decorateAsExport,
                    void 0,
                    void 0,
                    n
                  );
            }
            (i.exportInline = y), (t = t || []);
            var A = null;
            function M() {
              if (g) return "<div>[TOC]</div>";
              if (!A) {
                var e = m(document.querySelector(".md-toc-content")).clone();
                if (!e[0]) return "";
                e.find("[data-ref]").each(function () {
                  p
                    ? this.querySelector("a").setAttribute(
                        "href",
                        (File.isMac ? "at://" : "#header-") +
                          this.getAttribute("data-ref")
                      )
                    : this.querySelector("a").setAttribute(
                        "href",
                        "#" + w[this.getAttribute("data-ref")]
                      );
                }),
                  e.find(".md-meta").remove(),
                  (A =
                    "<div class='md-toc' mdtype='toc'>" +
                    e[0].outerHTML +
                    "</div>");
              }
              return A;
            }
            function L(e) {
              function t(e) {
                return e
                  ? C.toc.headers.findIndex(function (t) {
                      return t.cid == e;
                    })
                  : -1;
              }
              var n = { cid: e.cid };
              switch (e.get("type")) {
                case o.paragraph:
                  if (-1 == e.get("text").indexOf("\n")) {
                    var l = r.parseFrom(
                      e.getText(),
                      null,
                      { noTop: !0, skips: { fromP: !0, old_code: !1 } },
                      !0
                    )[1][0];
                    if (
                      r.isType(l, o.heading) &&
                      ((l.cid = e.cid), -1 == t(l.cid) && e.isTopBlock())
                    ) {
                      var c = F.findElemById(l.cid)
                        .prevAll(".md-heading")
                        .first()
                        .attr("cid");
                      C.toc.headers.splice(t(c) + 1, 0, l);
                    }
                    if (r.isType(l, o.heading, o.def_footnote, o.def_link))
                      return (l.cid = e.cid), L(l);
                  }
                  var m = _(e, n);
                  return "" == m || n.hasContent
                    ? !i.noStyle &&
                      (function (e) {
                        if (/^\s*<img /.exec(e || "")) {
                          var t = DOMPurify.sanitize(
                            e,
                            d.getDomPurifyConfig(d.INLINE_CONFIG)
                          );
                          if (
                            1 == t.childNodes.length &&
                            1 === t.children.length
                          ) {
                            var n = t.children[0];
                            return !(
                              !n.style.float && !n.getAttribute("align")
                            );
                          }
                          return !1;
                        }
                        return !1;
                      })(m)
                      ? "<p><span class='md-image'>" + m + "</span></p>"
                      : "<p>" + (m || "&nbsp;") + "</p>"
                    : m;
                case o.heading:
                  var v = "";
                  p &&
                    1 == e.get("depth") &&
                    !e.get("parent") &&
                    e.get("before") &&
                    (v = " data-breakpage");
                  var y = null,
                    x = "";
                  return (
                    p
                      ? ((y = document.createElement("a")),
                        (x = "header-" + e.cid),
                        y.setAttribute("name", x),
                        y.setAttribute(
                          "class",
                          "md-header-anchor md-print-anchor"
                        ),
                        y.setAttribute("href", "af://" + e.cid),
                        (y.innerText = " "))
                      : (x = w[e.cid]),
                    `<h${e.get("depth")}${v}${
                      y || !x ? "" : " id='" + a.escapeInQuote(x) + "'"
                    }>${y ? y.outerHTML : ""}${_(e, n)}</h${e.get("depth")}>`
                  );
                case o.blockquote:
                  return "<blockquote>" + _(e, n) + "</blockquote>";
                case o.list:
                  var S = e.get("style"),
                    k = (function () {
                      for (
                        var t = e.get("children").toArray(), n = 0;
                        n < t.length;
                        n++
                      ) {
                        var i = t[n].getFirstChild();
                        if (!r.isType(i, o.paragraph) || i.get("after"))
                          return !0;
                      }
                      return !1;
                    })();
                  e.set("loose", k);
                  var A = "";
                  return (
                    S == r.ListType.ol &&
                      ((A =
                        "" === e.get("start") ? void 0 : e.get("start") - 0),
                      (A =
                        Number.isNaN(A) || 1 == A
                          ? ""
                          : " start='" + e.get("start") + "' ")),
                    "<" + S + A + ">" + E + _(e, n) + E + "</" + S + ">"
                  );
                case o.list_item:
                  return e.get("style") === r.ListType.task
                    ? "<li" +
                        (g
                          ? ""
                          : " class='md-task-list-item task-list-item task-list-" +
                            (e.get("checked") ? "done" : "not-done") +
                            "' ") +
                        "><input type='checkbox' " +
                        (e.get("checked") ? "checked" : "") +
                        "/>" +
                        _(e, n) +
                        "</li>"
                    : "<li>" +
                        (function (e, t) {
                          return g && !1 === e.get("parent").get("loose")
                            ? _(e.getFirstChild(), t)
                            : _(e, t);
                        })(e, n) +
                        "</li>";
                case o.fences:
                  if (g) {
                    var M = e.get("lang") || "";
                    return M
                      ? "<pre" +
                          s.attrToString(s.parsePandocAttr(M)) +
                          "><code class='language-" +
                          (M = a.escapeInQuote(getCodeMirrorMode(M, !1, !0))) +
                          "' lang='" +
                          M +
                          "'>" +
                          a.escape(e.get("text")) +
                          E +
                          "</code></pre>"
                      : "<pre><code>" +
                          a.escape(e.get("text")) +
                          E +
                          "</code></pre>";
                  }
                  var N,
                    D = F.findElemById(e.id).clone();
                  if (u.isDiagramType(e.get("lang"))) {
                    N = !1;
                    var B = F.findElemById(e.id).find("svg");
                    i.mermaidSVGs &&
                      i.mermaidSVGs[e.id] &&
                      D.find("svg").replaceWith(i.mermaidSVGs[e.id]);
                    var R = D.find("svg");
                    B.attr("width") && !B.attr("viewBox")
                      ? (R.attr(
                          "viewBox",
                          "0 0 " + B.attr("width") + " " + B.height()
                        ),
                        R.css("max-width", "100%"),
                        R.css("height", "auto"))
                      : B.attr("max-width") &&
                        (R.css("width", B.attr("max-width")),
                        R.css("max-width", ""));
                    var P = D.find(".md-diagram-panel").html(
                      D.find(".md-diagram-panel-preview").html()
                    )[0];
                    return P ? f.processExportedSVG(P.outerHTML, !0) : "";
                  }
                  if (h.isMathType(e.get("lang")))
                    return T.getSVGForExport(e, b);
                  !1 !== N && (N = e.get("text").split(/\n/).length > 13);
                  var I = document.querySelector(
                    ".md-fences .CodeMirror-linenumber"
                  );
                  if (!i.fenceLineFontSize && I && b) {
                    i.fenceLineFontSize = window.getComputedStyle(I).fontSize;
                    let e = document.querySelector(
                      ".md-fences .CodeMirror-line"
                    );
                    e &&
                      i.fontSize &&
                      ("number" == typeof i.fontSize
                        ? (e.style.fontSize = `${i.fontSize}px`)
                        : (e.style.fontSize = i.fontSize),
                      (i.lineNumberLineHeightStyle =
                        window.getComputedStyle(e).lineHeight),
                      (i.lineNumberLineHeightStyle = `line-height:${i.lineNumberLineHeightStyle};`),
                      (e.style.fontSize = ""));
                  }
                  if (
                    (D.children(".CodeMirror").length &&
                      (D.removeAttr("cid")
                        .removeAttr("contenteditable")
                        .removeAttr("mdtype")
                        .html(D.children(".CodeMirror")[0].outerHTML)
                        .find(
                          ".CodeMirror-cursors, .CodeMirror-hscrollbar, .CodeMirror-vscrollbar, .CodeMirror-selected"
                        )
                        .remove()
                        .end()
                        .find(".CodeMirror-sizer")
                        .css("min-height", "")
                        .end()
                        .find(".CodeMirror-selectedtext")
                        .removeClass("CodeMirror-selectedtext")
                        .end()
                        .find("[cm-zwsp]")
                        .text("\n"),
                      i.fenceLineFontSize &&
                        D.find(".CodeMirror-linenumber")
                          .each(function () {
                            i.fenceLineFontSize &&
                              this.setAttribute(
                                "style",
                                this.getAttribute("style") +
                                  ";font-size:" +
                                  i.fenceLineFontSize +
                                  " !important;" +
                                  (i.lineNumberLineHeightStyle || "")
                              );
                          })
                          .end()
                          .find(".CodeMirror-gutters")
                          .css("height", "100%")),
                    p &&
                      File.option.noLineWrapping &&
                      D.children(".CodeMirror")
                        .addClass("CodeMirror-wrap")
                        .find(".CodeMirror-sizer")
                        .css("min-width", ""),
                    N && D.css("page-break-inside", "unset"),
                    p && File.isNode)
                  ) {
                    var O =
                      window.getComputedStyle(File.editor.writingArea)
                        .fontFamily || "initial";
                    (O = O.replace(/'/g, "\\'")),
                      D.find(".CodeMirror-line > span").each(function () {
                        !(function e(t, n) {
                          if (t.nodeType == document.TEXT_NODE) {
                            var i = t.textContent;
                            (i = i
                              .split(/(;|-)/)
                              .map(function (e) {
                                return ";" == e || "-" == e
                                  ? "<span style='font-family:" +
                                      n +
                                      "'>" +
                                      e +
                                      "</span>"
                                  : a.escape(e);
                              })
                              .join("")) != t.textContent && (t.innerHTML = i);
                          } else
                            1 == t.nodeType &&
                              t.childNodes.forEach(function (t) {
                                e(t, n);
                              });
                        })(this, O);
                      });
                  }
                  return D[0].outerHTML.trim();
                case o.html_block:
                  return d.buildHTMLForExport(e.get("text"), F, p, e);
                case o.math_block:
                  return i.noStyle && "latex" == File.option.mathFormatOnCopy
                    ? "<div>$$\n%@\n$$</div>".replace(
                        "%@",
                        a.escape(e.get("text"))
                      )
                    : T.getSVGForExport(
                        e,
                        b,
                        !i.forPrint && !i.forImage && !i.noStyle
                      );
                case o.hr:
                  return "<hr />";
                case o.def_footnote:
                case o.def_link:
                  return "";
                case o.table:
                  for (
                    var $ = "<figure><table>" + E, H = e.getFirstChild();
                    H;

                  )
                    H.get("before")
                      ? ($ += L(H))
                      : ($ +=
                          "<thead>" + E + L(H) + "</thead>" + E + "<tbody>"),
                      (H = H.get("after")) || ($ += "</tbody>" + E);
                  return ($ += "</table></figure>");
                case o.table_row:
                  ($ = "<tr>"), (H = e.getFirstChild());
                  for (
                    var U,
                      j = e.get("parent").get("align"),
                      q = 0,
                      W = e.get("before") ? "td" : "th";
                    H;

                  )
                    ($ +=
                      "<" +
                      W +
                      (U = (U = j[q])
                        ? " style='text-align:" + U + ";' "
                        : "") +
                      ">" +
                      L(H) +
                      "</" +
                      W +
                      ">"),
                      (H = H.get("after")),
                      q++;
                  return ($ += "</tr>");
                case o.table_cell:
                  return _(e, n) || "&nbsp;";
                case o.meta_block:
                  return "";
                case o.toc:
                  return "";
                default:
                  return "<p>" + _(e, n) + "</p>";
              }
            }
            if ("string" == typeof e) return _(e);
            if (e.length) {
              var N = e instanceof Array,
                D = N ? e[0] : e.sortedFirst();
              do {
                (k += L(D) + E), (D = D.get("after"));
              } while (D && (!N || e.indexOf(D) > -1));
            }
            return (
              (k = k.replaceAll
                ? k.replaceAll("", function () {
                    return M();
                  })
                : k.replace(/\uE088/g, function () {
                    return M();
                  })) + (v ? S(t) : "")
            );
          }
          getSVGForExport(e, t, n) {
            var i,
              r = this.editor,
              o = r.findElemById(e.refcid || e.id).clone(),
              s = o.find("svg");
            if (
              (n || o.find("mjx-assistive-mml").remove(),
              !s.length &&
                e.refcid &&
                ((e.refcid = void 0),
                (s = (o = r.findElemById(e.id)).find("svg"))),
              t)
            ) {
              var l = o.find("mjx-container").clone();
              return l[0]
                ? f.processExportedSVG(l[0].outerHTML, !0)
                : "<p class='md-math-block'>$$" +
                    a.escape(e.get("text")) +
                    "$$</p>";
            }
            return (
              (o = o.clone())
                .find(".md-rawblock-tooltip, .CodeMirror")
                .remove(),
              o.length
                ? f.processExportedSVG(
                    ((i = o[0]),
                    (i.innerHTML = i.innerHTML.trim()),
                    (i.children[0].innerHTML = i.children[0].innerHTML.trim()),
                    i).outerHTML,
                    !0
                  )
                : "<p class='md-math-block'>{math}</p>".replace(
                    "{math}",
                    "$$\n" + a.escape(e.get("text")) + "\n$$"
                  )
            );
          }
          async exportToHTML(e) {
            var t = (e = e || {}).forPrint,
              n = e.noStyle,
              i = e.noBackground,
              r = e.forImage,
              o = e.extraCss,
              s = "",
              l = this.editor.nodeMap,
              c = this.editor,
              d = [],
              u =
                File.editor.docMenu.getValueInMeta("title") ||
                (File.getFileName() || "").replace(
                  /\.(md|mmd|markdown|txt|text|mdwn)$/i,
                  ""
                ),
              h =
                File.option.enableDiagram &&
                m(".md-fences[lang='mermaid']").length,
              p = Object.keys(File.editor.fences.queue).length,
              f = "";
            n ||
              (c.mathBlock.currentCm &&
                c.mathBlock.currentCm.cid &&
                (await c.mathBlock.stopEditing(c.mathBlock.currentCm.cid)),
              c.fences.decorateAll()),
              "latex" != File.option.mathFormatOnCopy &&
                (await c.mathInline.renderAll(!1, c.writingArea, !1, !0)),
              File.option.showLineNumbersForFence && c.fences.refreshEditor(!0);
            var g = {
              forPrint: t,
              noStyle: n,
              forImage: r,
              fontSize: e.fontSize,
              anchorMap: {},
            };
            function v(e, t) {
              return void 0 === e || null === e || "" === e ? t : e;
            }
            function w(e) {
              if (File.isMac) return bridge.callSync("path.readText", e);
              if (File.isNode) {
                try {
                  return reqnode("fs").readFileSync(e, "utf-8");
                } catch (e) {}
                return "";
              }
            }
            var C = 0;
            function F(e) {
              return (
                "file://" +
                (File.isNode
                  ? window._options.userDataPath + "/themes/" + e
                  : _options.currentThemeFolder + "/" + e)
              );
            }
            function k() {
              return `\n<script>(${function () {
                var e = document.body.parentElement,
                  t = [],
                  n = null,
                  i = document.body.classList.contains(
                    "typora-export-collapse-outline"
                  ),
                  r = function (e, t, n) {
                    document.addEventListener(
                      e,
                      function (e) {
                        if (!e.defaultPrevented)
                          for (
                            var i = e.target;
                            i && i != this;
                            i = i.parentNode
                          )
                            if (i.matches(t)) {
                              !1 === n.call(i, e) &&
                                (e.preventDefault(), e.stopPropagation());
                              break;
                            }
                      },
                      !1
                    );
                  };
                function o() {
                  return e.scrollTop;
                }
                r("click", ".outline-expander", function (e) {
                  var t = this.closest(".outline-item-wrapper").classList;
                  return (
                    t.contains("outline-item-open")
                      ? t.remove("outline-item-open")
                      : t.add("outline-item-open"),
                    d(),
                    !1
                  );
                }),
                  r("click", ".outline-item", function (e) {
                    var t = this.querySelector(".outline-label");
                    if (((location.hash = "#" + t.getAttribute("href")), i)) {
                      var n = this.closest(".outline-item-wrapper").classList;
                      n.contains("outline-item-open") ||
                        n.add("outline-item-open"),
                        c(),
                        n.add("outline-item-active");
                    }
                  });
                var a,
                  s,
                  l = function () {
                    var e = o();
                    n = null;
                    for (var i = 0; i < t.length && t[i][1] - e < 60; i++)
                      n = t[i];
                  },
                  c = function () {
                    document
                      .querySelectorAll(".outline-item-active")
                      .forEach((e) =>
                        e.classList.remove("outline-item-active")
                      ),
                      document
                        .querySelectorAll(
                          ".outline-item-single.outline-item-open"
                        )
                        .forEach((e) =>
                          e.classList.remove("outline-item-open")
                        );
                  },
                  d = function () {
                    if (n) {
                      c();
                      var e = document.querySelector(
                        '.outline-label[href="#' +
                          (CSS.escape ? CSS.escape(n[0]) : n[0]) +
                          '"]'
                      );
                      if (e)
                        if (i) {
                          var t = e.closest(
                            ".outline-item-open>ul>.outline-item-wrapper"
                          );
                          if (t) t.classList.add("outline-item-active");
                          else {
                            for (
                              var r = (e = e.closest(
                                ".outline-item-wrapper"
                              )).parentElement.closest(".outline-item-wrapper");
                              r;

                            )
                              r = (e = r).parentElement.closest(
                                ".outline-item-wrapper"
                              );
                            e.classList.add("outline-item-active");
                          }
                        } else
                          e.closest(".outline-item-wrapper").classList.add(
                            "outline-item-active"
                          );
                    }
                  };
                window.addEventListener("scroll", function (e) {
                  a && clearTimeout(a),
                    (a = setTimeout(function () {
                      l(), d();
                    }, 300));
                });
                var u = function () {
                  s = setTimeout(function () {
                    !(function () {
                      t = [];
                      var e = o();
                      document
                        .querySelector("#write")
                        .querySelectorAll("h1, h2, h3, h4, h5, h6")
                        .forEach((n) => {
                          var i = n.getAttribute("id");
                          t.push([i, e + n.getBoundingClientRect().y]);
                        });
                    })(),
                      l(),
                      d();
                  }, 300);
                };
                window.addEventListener("resize", function (e) {
                  s && clearTimeout(s), u();
                }),
                  u();
              }.toString()})();<\/script>`;
            }
            function E(t) {
              if (!t) return ["", !1];
              t = t || "";
              var n = !1;
              try {
                t instanceof Array && (t = t.join("\n"));
                var i = new DOMParser().parseFromString(t, "text/html");
                return (
                  i.querySelectorAll("meta").forEach((t) => {
                    t.content = x(t.content, e);
                  }),
                  i.querySelectorAll("title").forEach((t) => {
                    (n = !0), (t.innerText = x(t.innerText, e));
                  }),
                  [(t = i.head.innerHTML + i.body.innerHTML), n]
                );
              } catch (e) {
                return [t, n];
              }
            }
            function T(e, n, i) {
              if (!e) return "";
              n = n || [];
              var r,
                o,
                a =
                  /^\s*@include-when-export\s+(url)?([('"]+)([^\)"']+)([)'"]+)/im;
              function s(e, t) {
                e && n.push(_(e, t));
              }
              if (!t)
                try {
                  (o = e.match(/^\s*@include-when-export\s.+$/gim)) &&
                    o.map(function (e) {
                      s((r = a.exec(e) || [])[3]);
                    });
                } catch (e) {}
              a = /^\s*@import\s+(url)?([('"]+)([^\)"']+)([)'"]+)/im;
              try {
                (o = e.match(/^\s*@import\s.+$/gim)) &&
                  o.map(function (e) {
                    (r = a.exec(e) || [])[3] &&
                      ((/\.css/.exec(r[3]) && !/^https?:/.exec(r[3])) ||
                        s(r[3], i));
                  });
              } catch (e) {}
              return n
                .map(function (e) {
                  return (
                    "<link href='" + e + "' rel='stylesheet' type='text/css' />"
                  );
                })
                .join("\n");
            }
            function _(e, t) {
              return (
                (e = (e = e.replace(/^typora:\/\/app\/typemark/i, function () {
                  return location.href.replace(/[\\\/]+[^\\\/]+$/g, "");
                })).replace(/^wkfile:/, "file:")),
                (e = a.getFilePathFromProxy(e)),
                /:\/\//.exec(e) ||
                  (e = "file://" + (e = a.getAbsolutePath(t, e))),
                e
              );
            }
            if (
              (e.exportTheme ||
                (t &&
                  !r &&
                  File.colorBrightness < 0.5 &&
                  (File.isNode && (e.exportTheme = "github"),
                  i && File.isMac && (e.exportTheme = "github")),
                e.exportTheme),
              n ||
                (s = (function () {
                  var n,
                    i,
                    r,
                    o,
                    s,
                    l,
                    c = [];
                  function d() {
                    void 0 !== e.splitPages &&
                      (f +=
                        "<style type='text/css'>@media print {[data-breakpage]{page-break-before: %@;}#write>[data-breakpage]:first-child {page-break-before: avoid}}</style>".replace(
                          "%@",
                          e.splitPages ? "always" : "avoid"
                        ));
                  }
                  if (((f = ""), t)) {
                    if (
                      (document
                        .querySelectorAll("link[css-include]")
                        .forEach(function (e) {
                          f +=
                            "<link rel='stylesheet' href='" +
                            a.escapeInQuote(_(e.href)) +
                            "' type='text/css' />";
                        }),
                      e.exportTheme)
                    ) {
                      var u = e.exportTheme;
                      [`${u}.css`, "base.user.css", `${u}.user.css`].map(
                        (e) => {
                          "base.user.css" == e && d(),
                            (f +=
                              "<link rel='stylesheet' href='" +
                              a.escapeInQuote(F(e)) +
                              "' type='text/css' />\n");
                        }
                      );
                    } else
                      ["theme_css", "base_user_css", "theme_user_css"].map(
                        function (e) {
                          "base_user_css" == e && d(),
                            File.isMac
                              ? (f +=
                                  "<link rel='stylesheet' href='" +
                                  a.escapeInQuote(
                                    m("#" + e)
                                      .attr("href")
                                      .replace(/^wkfile:/, "file:")
                                  ) +
                                  "' type='text/css' />\n")
                              : (f +=
                                  "<link rel='stylesheet' href='" +
                                  a.escapeInQuote(_(m("#" + e).attr("href"))) +
                                  "' type='text/css' />\n");
                        }
                      );
                    return "";
                  }
                  function g(e) {
                    var t = [];
                    try {
                      t = e.cssRules;
                    } catch (t) {
                      e.href;
                    }
                    for (var n in t) {
                      var i = e.cssRules[n];
                      if (i.styleSheet) {
                        if (i.href.match(/mermaid/i) && !h) continue;
                        if (i.href.match(/sourcemode\.dark\.css/i)) continue;
                        g(i.styleSheet);
                      } else
                        /@font\-face/.exec(i.cssText || "") ||
                          c.push(
                            (i.cssText || "").replace(
                              /content: ([^;]{1});/g,
                              "content: '$1';"
                            )
                          );
                    }
                  }
                  (i = ["(base\\.css)"]),
                    (r = ["theme_css", "base_user_css", "theme_user_css"]
                      .map(function (t) {
                        return (
                          (s = []),
                          (l =
                            e.exportTheme && "theme_css" == t
                              ? F(`${e.exportTheme}.css`).replace(
                                  /^file:\/\//,
                                  ""
                                )
                              : e.exportTheme && "theme_css" == t
                              ? F(`${e.exportTheme}.user.css`).replace(
                                  /^file:\/\//,
                                  ""
                                )
                              : _(m("#" + t).attr("href")).replace(
                                  /^file:\/\//,
                                  ""
                                )),
                          T((o = w(l)), s, l),
                          s.forEach(function (e) {
                            (/^\/\//.exec(e) || /.+:\/\//.exec(e)) &&
                              (f +=
                                "<link href='" +
                                e.replace(/^wkfile:/, "file:") +
                                "' rel='stylesheet' type='text/css' />");
                          }),
                          (function e(t, n) {
                            var i = /^["']/,
                              r = [];
                            function o(t) {
                              var o = (t.match(i) || [""])[0];
                              return (
                                (t = decodeURI(
                                  o.length ? t.substring(1, t.length - 1) : t
                                )),
                                (t = a.getAbsolutePath(n, t)).match(/\.css$/)
                                  ? (r.push(e(w(t), t)), (t = ""))
                                  : (t =
                                      (File.isMac ? "file://" : "file:///") +
                                      t),
                                o + encodeURI(t) + o
                              );
                            }
                            return (
                              (n = _(n).replace(/^file:\/\/?/, "")),
                              (t = (t || "")
                                .replace(/@charset[^;\n]+;?/g, "")
                                .replace(/@font\-face\s*{[^}]+}\s*\n/g, "")
                                .replace(
                                  /(^|;|\n)[\s]*@import([^;\n]+)(;|$|\n)/g,
                                  function (e, t) {
                                    var n = (/['"]([^"']+)['"]/.exec(e) ||
                                      [])[0];
                                    return n ? e.replace(n, o(n)) : e;
                                  }
                                )
                                .replace(/url\([^:)]+\)/gi, function (e) {
                                  return (
                                    "url(" +
                                    o((e = e.substring(4, e.length - 1))) +
                                    ")"
                                  );
                                })),
                              (t = r.join("\n") + t)
                            );
                          })(o, l)
                        );
                      })
                      .join("\n")) || i.push("(theme)"),
                    p && i.push("(codemirror)"),
                    h && i.push("(mermaid)"),
                    (i = new RegExp(i.join("|"), "i"));
                  for (var v = 0; v < document.styleSheets.length; v++)
                    if (
                      ((n = document.styleSheets[v]),
                      i.exec(n.href) && (g(n), /themes/.exec(n.href)))
                    )
                      try {
                        var y = _(n.href),
                          b = decodeURI(
                            y.replace(
                              File.isWin ? /^[\w_-]+:[\/]+/ : /^[\w_-]+:\/\/?/,
                              ""
                            )
                          );
                        f += T(w(b), void 0, b);
                      } catch (e) {}
                  return r && c.push(r), c.join("\n");
                })()),
              h && e.exportTheme && !n)
            ) {
              var A = s;
              A ||
                [`${e.exportTheme}.css`, `${e.exportTheme}.user.css`].map(
                  (e) => {
                    A += (function e(t) {
                      C++;
                      var n = w(t);
                      if (C > 10) return n;
                      var i = [];
                      return (
                        T(n, i, t),
                        i.forEach(function (t) {
                          /^file:\/\//.exec(t) &&
                            (n = e(t.replace(/^file:\/\//, "")) + n);
                        }),
                        n
                      );
                    })(F(e).replace("file://", ""));
                  }
                ),
                (g.mermaidSVGs = await c.diagrams.mermaidSvgForExportTheme(A));
            }
            return (function (i, l) {
              d.length &&
                (i +=
                  "<div class='footnotes-area' " +
                  (t ? "data-breakpage" : "") +
                  " ><hr/>" +
                  S(d) +
                  "</div>");
              var u = t
                  ? "<script> window.setBreakPage = function(b){var node = document.querySelectorAll('[data-breakpage]'); for(var i=0;i<node.length;i++){node[i].style.pageBreakBefore = b ? 'always':'auto' } return node[0] && node[0].style.pageBreakBefore};</script>"
                  : "",
                h = t ? (File.isMac ? "is-mac" : "is-node") : "",
                p =
                  e.fontSize ||
                  document.body.parentElement.style.fontSize ||
                  "";
              p &&
                ("number" == typeof p && ((p = `${p}px`), (e.fontSize = p)),
                (p = " style='font-size:" + p + " !important'")),
                t &&
                  File.isMac &&
                  (u += "<script>(" + b.toString() + ")();</script>"),
                t && (u += "<script>(" + y.toString() + ")();</script>");
              var w = E(e.appendHead),
                x = E(e.appendHeadExtra);
              (w[0] = w[0] + x[0]),
                (w[1] =
                  w[1] || x[1] ? "" : `<title>${a.escape(l || "")}</title>`);
              var C = E(e.appendBody)[0] + E(e.appendBodyExtra)[0];
              if (n)
                return (
                  `<!doctype html>\n<html>\n<head>\n<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>\n${w[1]}\n${w[0]}</head>\n<body>` +
                  i +
                  `${C}</body>\n</html>`
                );
              var F = ["typora-export"];
              r
                ? (F.push("for-image"),
                  (s += " ::-webkit-scrollbar {display: none;} "))
                : t &&
                  (s += (function () {
                    for (var e = [""], t = 1; t < 7; t++) {
                      var n = `h${t}`,
                        i = document.querySelector(`#write ${n}`);
                      if (i) {
                        var r = window.getComputedStyle(i);
                        if (
                          /^0px/.exec(r.border || "") &&
                          / 0px$/.exec(r.outline || "") &&
                          "none" === r.boxShadow &&
                          "none" === r.backgroundImage &&
                          "rgba(0, 0, 0, 0)" === r.backgroundColor
                        ) {
                          var o = window.getComputedStyle(i, "after").content;
                          ("none" !== o && o) ||
                            e.push(
                              `.typora-export ${n}::after {content: "";display: block;height: 100px;margin-bottom: -100px;}`
                            );
                        }
                      }
                    }
                    return e.join("\n");
                  })()),
                document.querySelector("mjx-container") &&
                  ((s += MathJax.svgStylesheet().innerHTML),
                  r ||
                    (s +=
                      'mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {\n\t\t\t\t\t\t\tstroke-width: 0;\n\t\t\t\t\t\t}')),
                File.isMac
                  ? (s +=
                      " @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}")
                  : e["paper.margin"] &&
                    ("custom" === e["paper.margin"]
                      ? (s +=
                          " @media print { @page {margin: $1mm 0 $3mm 0;} body.typora-export {padding-left: $2mm; padding-right: $4mm;} #write {max-width: initial;}}"
                            .replace("$1", v(e["paper.marginTop"], "16"))
                            .replace("$2", v(e["paper.marginLeft"], "16"))
                            .replace("$3", v(e["paper.marginBottom"], "16"))
                            .replace("$4", v(e["paper.marginRight"], "16")))
                      : F.push(
                          "typora-export-margin-" +
                            (e["paper.margin"] || "default")
                        )),
                File.option.preLinebreakOnExport ||
                  (s +=
                    " .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} h1,h2,h3,h4,h5 {white-space:pre-line}"),
                File.option.indentFirstLine && (h += " first-line-indent"),
                document.body.classList.contains("os-windows") &&
                  (F.push("os-windows"),
                  File.option.monocolorEmoji && F.push("monocolor-emoji")),
                o && (s += " " + o);
              var T = "";
              return (
                e.sidebar &&
                  ((T = (function () {
                    c.library.outline.updateOutlineHtml(c.nodeMap.toc, !0);
                    var e = m("#outline-content").html();
                    if (
                      !e ||
                      m("#outline-content").find(".outline-item").length <= 1
                    )
                      return "";
                    var t = m(
                      "<div class='typora-export-sidebar'><div class='outline-content'>" +
                        e +
                        "</div></div>"
                    );
                    return (
                      t.find(".outline-label").each(function () {
                        this.classList.contains("outline-active") &&
                          (this.classList.remove("outline-active"),
                          this.parentElement.classList.remove(
                            "outline-item-active"
                          )),
                          this.setAttribute(
                            "href",
                            "#" + g.anchorMap[this.getAttribute("data-ref")]
                          ),
                          this.removeAttribute("data-ref"),
                          (this.outerHTML = this.outerHTML
                            .replace(/^<span/, "<a")
                            .replace(/<\/span>$/, "</a>"));
                      }),
                      t
                        .find(".outline-item-signle")
                        .removeClass("outline-item-signle"),
                      document.body.classList.contains("no-collapse-outline") &&
                        t
                          .find(".outline-item-single")
                          .removeClass("outline-item-single"),
                      t[0].outerHTML
                    );
                  })()) &&
                    (F.push("typora-export-show-outline"),
                    document.body.classList.contains("no-collapse-outline")
                      ? F.push("typora-export-no-collapse-outline")
                      : F.push("typora-export-collapse-outline")),
                  (u += k())),
                `<!doctype html>\n<html${p}>\n<head>\n<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>\n${
                  w[0]
                }\n${f}<style type='text/css'>html {overflow-x: initial !important;}${s}\n</style>${
                  w[1]
                }\n</head>\n<body class='${F.join(
                  " "
                )}'><div class='typora-export-content'>\n${T}<div id='write' ${
                  t ? "style='top:auto'" : ""
                } class='${h}'>${i}</div></div>\n${u}${C}</body>\n</html>`
              );
            })(this.exportCollection(l.blocks, d, g), u);
          }
          cleanUpTempFiles() {}
          async exportWithCommand(e) {
            var t = "";
            if (
              ("saveFolder" == e.saveDialog &&
                (t = await p.showExportDialog(
                  void 0,
                  Object.assign({ selectFolder: !0 }, e)
                )),
              "saveFile" == e.saveDialog)
            ) {
              var n = ((e.extensions || "").trim().split(/\s+/g) || []).map(
                (e) => e.replace(/^\./, "")
              );
              t = await p.showExportDialog(
                void 0,
                e,
                n
                  ? [
                      { name: e.label || "Exported File", extensions: n },
                      {
                        name: m.localize.getString("All Files", "Panel"),
                        extensions: ["*"],
                      },
                    ]
                  : void 0
              );
            }
            var i = F.processExportVariables(e.command || "", {
              outputPath: t,
            });
            if (!t && e.saveDialog)
              return (
                document.body.classList.remove("ty-show-notification"), null
              );
            var r =
              p.getCurrentFileFolderPath() ||
              window._options.documentsPath ||
              "/";
            return (
              File.isNode && v.customExport(t, i, r, e),
              this.recordLastExport(e, t),
              { output: t, args: i || "", cwd: r, option: e }
            );
          }
        }
        function S(e) {
          return e
            .map(function (e) {
              return "<div class='footnote-line'>" + e.join("") + "</div>";
            })
            .join("\n");
        }
        (F.processExportVariables = x),
          (F.onExportSuccess = w),
          (n.exports = F);
      }
    ),
    $__System.registerDynamic("57", ["28", "11", "32"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = e("28"),
        r = e("11"),
        o = e("32");
      const a = 1.3281472327365,
        s = 1 / 72;
      const l = (e, t) => {
        if ("custom" === e["paper.margin"]) {
          const n = e["paper." + t];
          return void 0 === n || "" === n
            ? 45
            : Math.round((72 / 25.4) * (n - 0));
        }
        return 30;
      };
      function c(e, t, n, i) {
        return File.editor.export.processExportVariables(
          e,
          Object.assign(
            {
              title: o
                .getFileNameFromPath(File.bundle.filePath || "")
                .replace(/\..+$/, ""),
              author: "",
            },
            t
          ),
          { pageno: n, totalpages: i, pagecount: i }
        );
      }
      t.renderHeaderFooterText = c;
      const d = async function (e, t) {
        const n = e.getPages();
        var i = Math.min(l(t, "marginTop"), 30),
          o = Math.min(l(t, "marginBottom"), 30),
          d = n[0].getWidth();
        const h = t.header,
          p = t.footer,
          [f, m] = await (async function (n, l, u) {
            function h(e, n) {
              var { fontFamily: i, color: o } = t.textStyles || {};
              i && (i = r.escapeForPreWrap(i));
              var s = (n - 8) * a;
              return `<p style="font-size:12px;text-align:center;margin:0;padding:0;height:${s}px;line-height:${s}px;page-break-before:avoid;page-break-after:always;font-family:${
                i || "inherit"
              };color:${
                o || "inherit"
              };"><span style="display: inline-block;vertical-align: middle;">${r.escape(
                e
              )}</span></p>`;
            }
            async function p(n, i, o) {
              if (!n) return null;
              for (var a = [], l = 0; l < u.length; l++) {
                let e = c(n, t, l + 1, u.length);
                a.push(h(e, i));
              }
              var p = `<html style="margin:0;padding:0;"><head><meta charset="utf-8"></head><body style="margin:0;padding:0;">${a.join(
                "\n"
              )}</body></html>`;
              return await (async function (t, n, i) {
                var o = r.tempString() + ".html",
                  a = reqnode("path").normalize(File.option.tempPath + "/" + o);
                await reqnode("fs-extra").outputFile(a, t);
                var [l] = await JSBridge.invoke("export.printToPDF", a, {
                  printBackground: !1,
                  marginsType: 1,
                  margins: { top: 0, bottom: 0, left: 0, right: 0 },
                  pageSize: { width: d * s, height: n * s },
                });
                let c = (await PDFLib.PDFDocument.load(l)).getPages();
                return await e.embedPages(c);
              })(p, i);
            }
            return [await p(n, i), await p(l, o)];
          })(h, p, n);
        for (var g = 0; g < n.length; g++) {
          const e = n[g];
          f && e.drawPage(f[g], { x: 0, y: e.getHeight() - i }),
            m && e.drawPage(m[g], { x: 0, y: 0 });
        }
        return u(e, t), await e.save();
      };
      var u = function (e, t) {
          e.setTitle(t.title || ""),
            e.setSubject(t.subject || ""),
            e.setAuthor(t.author || ""),
            e.setCreator(t.creator || "Typora"),
            e.setProducer("Typora, Electron");
        },
        h = async function (e, t, n) {
          var r = Buffer.from(t),
            o = { data: t };
          try {
            var a = File.editor.localSettingBridge.getCalculatedSetting();
            n = Object.assign(n, a);
          } catch (e) {
            console.sendError(e);
          }
          function s(e) {
            return (
              (o.warning =
                "Failed to add book to exported PDF\n" +
                (e.message || e.details)),
              i.showNotification(
                `<span class='typora-pdf-warning'>${$.localize.getString(
                  "[Warning] Failed to attach bookmark for PDF file.",
                  "Panel"
                )}</span>`,
                !0
              ),
              (o.data = r),
              o
            );
          }
          if (e) return s(e);
          try {
            const e = (function (e) {
              const t = e.getPages(),
                n = t.length,
                i = t[0].getHeight(),
                r = {},
                o = PDFLib.PDFName.of("Subtype"),
                a = PDFLib.PDFName.of("Rect"),
                s = PDFLib.PDFName.of("URI"),
                l = PDFLib.PDFName.of("A");
              for (var c = 0; c < n; c++) {
                const e = t[c].node.Annots(),
                  n = e ? e.size() : 0;
                for (var d = 0; d < n; d++)
                  try {
                    const t = e.lookup(d, PDFLib.PDFDict),
                      n = t.get(o);
                    if (n && "/Link" === n.asString()) {
                      const e = t.get(l);
                      if (!e) continue;
                      const n = e.get(s).asString(),
                        o = t.get(a).asRectangle();
                      var u;
                      (u = /^af:\/\/(.+)$/.exec(n || "")) &&
                        (r[u[1]] = [c + 1, i - o.height - o.y]);
                    }
                  } catch (e) {
                    console.sendLog(e, !0);
                  }
              }
              return r;
            })(await PDFLib.PDFDocument.load(t));
            return await new Promise((i, r) => {
              var o = new FileReader();
              (o.onloadend = async function () {
                var e = Buffer.from(new Uint8Array(o.result)),
                  t = {};
                try {
                  e = (await d(await PDFLib.PDFDocument.load(e), n)) || e;
                } catch (e) {
                  t.warning =
                    "Failed to add header / footer.\n" +
                    (e.message || e.details);
                }
                (t.data = e), i(t);
              }),
                (o.onerror = o.onabort =
                  (e) => {
                    r(e);
                  }),
                o.readAsArrayBuffer(
                  (function (e, t, n) {
                    n = n || {};
                    var i = new TPDFAnalyst(),
                      r = new TPDFOutLineMaker(),
                      o = File.editor.library.outline.getHeaderMatrix(!0);
                    i.LoadFromStream(t);
                    var a = n.keywords || n.tags || [];
                    "string" == typeof a && (a = [a]),
                      (r.Info.Keywords = a.join(", "));
                    var s = new Date()
                      .toISOString()
                      .replace(/\.\d+Z$/, "")
                      .replace(/[-T:]/g, "");
                    return (
                      (r.Info.CreationDate = s),
                      (r.Info.ModDate = s),
                      (r.View.PageMode = TPDFPageMode.pmUseOutlines),
                      (function t(n, i, a, s) {
                        for (var l = 7, c = null, d = a; d < s; d++) {
                          var u,
                            h = o[d],
                            p = h[0];
                          if ((7 == l && (l = p), p <= i)) return d;
                          if (p > l) d = t(c, l, d, s) - 1;
                          else {
                            if (!(u = e[h[2]])) continue;
                            c = n
                              ? n.AddChild(h[1], u[0], u[1], "", !1, !1, null)
                              : r.OutLine.AddRoot(
                                  h[1],
                                  u[0],
                                  u[1],
                                  "",
                                  !1,
                                  !1,
                                  null
                                );
                          }
                        }
                        return s;
                      })(null, 0, 0, o.length),
                      r.Save(i)
                    );
                  })(e, t, n)
                );
            });
          } catch (e) {
            return s(e);
          }
        },
        p = null,
        f = async (e) => {
          var t = new Date() - 0 + "-" + Math.random() + ".html",
            n = reqnode("path").normalize(File.option.tempPath + "/" + t);
          return await reqnode("fs-extra").outputFile(n, e), n;
        };
      (t.makeTempFile = f),
        (t.print = () => {
          File.editor.export.showExportNotification(),
            File.editor.export.beforeExport(!0),
            (async function (e) {
              var t = await File.editor.export.exportToHTML({
                  forPrint: !0,
                  extraCss: e
                    ? "body {font-variant-ligatures: no-common-ligatures;}"
                    : "",
                }),
                n = await f(t),
                i = JSBridge.invoke("export.genPrintView", n, p);
              return (p = null), i;
            })(!0).then((e) => {
              setTimeout(() => {
                JSBridge.invoke("export.print", e, {
                  silent: !1,
                  cleanupAfter: !0,
                }),
                  document.body.classList.remove("ty-show-notification");
              }, 300),
                Analytics.record("print");
            });
        });
      const m = (e) =>
        new Promise((t) => {
          setTimeout(t, e);
        });
      var g, v;
      t.exportPDF = async function (e) {
        e = e || {};
        var t,
          n,
          a = File.colorBrightness < 0.5;
        if (
          (e.exportTheme &&
            (a = await (async function (e) {
              if (
                ["github", "whitey", "pixyll", "newsprint", "gothic"].indexOf(
                  e
                ) > -1
              )
                return !1;
              var t,
                n = `<html><head><link rel='stylesheet' href='${r.escapeInQuote(
                  ((t = e + ".css"),
                  "file://" +
                    (File.isNode
                      ? window._options.userDataPath + "/themes/" + t
                      : _options.currentThemeFolder + "/" + t))
                )}' type='text/css' /></head></html><body><div id="write"><p>test</p></div></body>`,
                i = await f(n),
                a = await JSBridge.invoke("export.getPageColor", i);
              return o.getColorBrightness(a) < 0.5;
            })(e.exportTheme)),
          a)
        ) {
          var { response: s } = await JSBridge.invoke("dialog.showMessageBox", {
            type: "warning",
            title: $.localize.getString("Dark Theme not support", "Panel"),
            message: $.localize.getString(
              'Sorry, current version of Typora won\'t print background color on exported PDF, So dark theme is not yet supported for PDF exporting. \nPlease choose a light theme or click "Print with default theme"',
              "Panel"
            ),
            buttons: [
              $.localize.getString("Print with default theme", "Panel"),
              $.localize.getString("Cancel"),
            ],
            defaultId: 0,
            cancelId: 1,
          });
          if (0 !== s)
            return void document.body.classList.remove("ty-show-notification");
          e.exportTheme = "github";
        }
        await m(1);
        var l = { forPrint: !0 };
        Object.assign(l, e);
        var c = await File.editor.export.exportToHTML(l),
          d = new Date() - 0 + "-" + Math.random() + ".html",
          u = reqnode("path").normalize(File.option.tempPath + "/" + d);
        function p(e) {
          e
            ? i.showNotificationWithTitle(
                $.localize.getString("Export Failed", "Panel"),
                e,
                $.localize.getString("Support Document"),
                function () {
                  const e = File.option.useMirrorInCN
                    ? "typoraio.cn"
                    : "typora.io";
                  JSBridge.showInBrowser(
                    `https://support.${e}/Export/#trouble-shooting`
                  );
                }
              )
            : document.body.classList.remove("ty-show-notification"),
            t && clearTimeout(t),
            (n = null);
        }
        await reqnode("fs-extra").outputFile(u, c),
          (n = new Promise(async (t, n) => {
            File.editor.export.beforeExport(!0) && (await m(1900)),
              File.editor.export.showExportNotification();
            var i = e.paper;
            "custom" === i &&
              (i = {
                width: (e["paper.custom"][0] || 210) * (1 / 25.4),
                height: (e["paper.custom"][1] || 297) * (1 / 25.4),
              });
            var [r, o, a] = await JSBridge.invoke("export.printToPDF", u, {
              printBackground: !1,
              marginsType: 0,
              pageSize: i,
            });
            (e.textStyles = o ? JSON.parse(o) : null),
              r ? t(await h(null, r, e)) : n("Failed to export as PDF. " + a);
          }));
        var g = await o.showExportDialog("pdf", e);
        console.sendLog("export PDF to " + g),
          g
            ? (File.editor.export.recordLastExport(e, g),
              n.then(function (t) {
                File.fs.writeFile(g, t.data, function (n) {
                  n
                    ? p(n)
                    : $("#md-notification .typora-pdf-warning").length ||
                      File.editor.export.onExportSuccess(
                        "pdf",
                        g,
                        e,
                        "",
                        t.warning
                      );
                });
              }, p))
            : p();
      };
      var y,
        b,
        w = File.isWin ? 8e3 : 960,
        x = File.isWin ? 5 : 40,
        C = w * x,
        F = 1;
      function S(e) {
        (y = null),
          v && (JSBridge.invoke("export.destroyPrintView", v), (v = null)),
          g && (g.postMessage("terminate"), g.terminate(), (g = null)),
          e && document.body.classList.remove("ty-show-notification");
      }
      (window.releaseCaptureWin_ = S),
        (t.exportToImage = async (e) => {
          ((e = Object.assign(
            { imageWidth: 640, imageFontSize: "24px" },
            e || {},
            { forPrint: !0, forImage: !0 }
          )).fontSize = e.imageFontSize),
            e.useThemeFontSize && (e.fontSize = void 0);
          var t,
            n = e.imageWidth,
            r = 0;
          function a(e) {
            console.sendError(e.stack || e, "warning"),
              y && i.showErrorDialog("Export Failed", e.stack || e),
              null === b && (b = e.stack || e),
              S(!0);
          }
          S(!0),
            (b = null),
            File.editor.store(!0),
            File.editor.export.showExportNotification();
          var s = await File.editor.export.exportToHTML(e);
          (g = new Worker(
            (window.debugMode ? "lib" : "lib.asar") + "/image-worker.js"
          )).onmessage = function (t) {
            t.data.success
              ? (File.editor.export.onExportSuccess("image", y, e), S(!0))
              : a(t.data.error);
          };
          var l = new Date() - 0 + "-" + Math.random() + ".html",
            c = reqnode("path").normalize(File.option.tempPath + "/" + l);
          reqnode("fs-extra")
            .outputFile(c, s)
            .then(() => {
              JSBridge.invoke("export.prepareImageCapture", c, {
                imageWidth: n,
                quality: (e.quality || 0) - 0,
              })
                .then((i) => {
                  i
                    ? ((v = i.winId),
                      (t = i.totalHeight),
                      (w = i.pageHeight || w),
                      (F = i.scale || 1),
                      t > C
                        ? a("Generated Image too Large")
                        : (async function i(o) {
                            var s = t - o;
                            if ((s > w && (s = w), g)) {
                              var l = await JSBridge.invoke(
                                "export.captureImage",
                                v,
                                o,
                                {
                                  imageWidth: n,
                                  pageHeight: s,
                                  quality: (e.quality || 0) - 0,
                                }
                              );
                              if (null != l && v) {
                                var { newScrollHeight: c, data: d } =
                                  JSON.parse(l);
                                c > t + 100 &&
                                  (g.postMessage({
                                    action: "updateTotalHeight",
                                    totalHeight: c,
                                  }),
                                  (t = c)),
                                  g.postMessage({
                                    action: "addImage",
                                    buffer: d,
                                    index: r,
                                    position: { width: n * F, offset: o * F },
                                    totalHeight: t * F,
                                    total: Math.ceil(t / w),
                                  }),
                                  o + s < t && (r++, i((o += s)));
                              } else a("");
                            }
                          })(0))
                    : a("Failed to create image view for web content");
                })
                .catch((e) => {
                  S(!0);
                });
            });
          var d = await o.showExportDialog("png", e, [
            { name: "PNG", extensions: ["png"] },
            { name: "JPEG", extensions: ["jpg", "jpeg"] },
          ]);
          if (!d) return S(!0);
          File.editor.export.recordLastExport(e, d),
            (y = d),
            g
              ? g.postMessage({ action: "setPath", path: d })
              : i.showErrorDialog("Export Failed", b);
        });
    }),
    $__System.registerDynamic(
      "59",
      ["47", "e", "4a", "50", "28", "32", "57", "58"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("47"),
          r = e("e"),
          o = (e("4a"), e("50")),
          a = e("28"),
          s = (e("32"), e("57")),
          l = e("58"),
          c = {};
        (c.newFile = function () {
          JSBridge.invoke("app.openFile", null, {
            mountFolder: i.mountFolder_,
          });
        }),
          (c.newWindow = function () {
            JSBridge.invoke("document.newWindow");
          }),
          (c.globalSearch = function () {
            i.editor.library.fileSearch.show(!0);
          }),
          (c.close = function () {
            i.megaMenu && i.megaMenu.hide(), JSBridge.invoke("window.close");
          }),
          (c.openWithPath = function (e) {
            JSBridge.invoke(
              "app.openOrSwitch",
              e,
              i.bundle.hasModified || i.bundle.filePath
            ).then((t) => {
              t && i.editor.library.doSwitchByNode(e);
            });
          }),
          (c.open = function (e) {
            var t = e ? ["openFile", "openDirectory"] : ["openFile"];
            JSBridge.invoke("dialog.showOpenDialog", {
              properties: t,
              filters: [
                {
                  name: r.localize.getString("Markdown File"),
                  extensions: i.SupportedFiles,
                },
                { name: r.localize.getString("All Files"), extensions: ["*"] },
              ],
            }).then(({ filePaths: e }) => {
              e && e.length && (c.openWithPath(e[0]), i.megaMenu.hide());
            });
          }),
          (c.openFolder = function () {
            JSBridge.invoke("dialog.showOpenDialog", {
              properties: ["openDirectory"],
            }).then(({ filePaths: e }) => {
              e && e.length && (c.openWithPath(e[0]), i.megaMenu.hide());
            });
          }),
          (c.quickOpen = function () {
            i.editor.quickOpenPanel.show();
          }),
          (c.import = function () {
            i.megaMenu.hide(), l.prepImport();
          }),
          (c.validatePandocInstall = function () {
            return l.validatePandocInstall();
          }),
          (c.doImport = function (e) {
            l.import(e);
          }),
          (c.openFileLocation = function () {
            i.bundle.filePath && JSBridge.showInFinder(i.bundle.filePath);
          }),
          (c.showPreferencePanel = function () {
            i.megaMenu.showPreferencePanel();
          }),
          (c.togglePreferencePanel = function () {
            i.megaMenu.togglePreferencePanel();
          }),
          (c.save = function () {
            i.saveUseNode();
          }),
          (c.saveAs = function () {
            i.saveUseNode(!0);
          }),
          (c.moveTo = function () {
            i.moveTo();
          }),
          (c.saveAll = function () {
            c.execForAll("function() {\t\tClientCommand.save();\t}");
          }),
          (c.print = function () {
            s.print();
          }),
          (c.exportLast = function (e) {
            var t = i.option.lastExport || i.option._lastExport;
            e =
              !i.option.lastExportNoOverwrite &&
              e &&
              t.path &&
              i.option.lastExport;
            c.export(Object.assign({ overwrite: e }, t));
          }),
          (c.export = function (e) {
            var t = e.type;
            i.editor.export.beforeExport(),
              i.editor.export.showExportNotification(),
              (e = i.editor.localSettingBridge.loadExportOption(e)),
              "html" == t
                ? i.editor.export.exportAndSaveHTML(e)
                : "html-plain" == t
                ? (Object.assign(e, { noStyle: !0 }),
                  i.editor.export.exportAndSaveHTML(e))
                : "image" == t
                ? i.editor.export.exportToImage(e)
                : "pdf" == t
                ? s.exportPDF(e)
                : "custom" == t
                ? i.editor.export.exportWithCommand(e)
                : l.export(t, e),
              /^html/.exec(t) &&
                document.body.classList.remove("ty-show-notification");
          }),
          (c.selectAll = function () {
            if (isInputComponent(document.activeElement))
              i.isNode &&
                (document.activeElement.classList.contains("ty-input")
                  ? i.editor.selection.selectAllElem(r(document.activeElement))
                  : JSBridge.invoke("webContents.selectAll"));
            else {
              if (i.editor.sourceView.inSourceMode)
                return (
                  i.editor.sourceView.cm.focus(),
                  void i.editor.sourceView.cm.execCommand("selectAll")
                );
              i.editor.focusAndRestorePos(),
                i.editor.selection.selectAll(),
                i.editor.brush.expand();
            }
          });
        (c.deleteWord = function () {
          i.isLocked ||
            (i.editor.selection.selectWord(!1, !0),
            i.editor.UserOp.backspaceHandler(i.editor, null, "delSelection"));
        }),
          (c.deleteScope = function () {
            i.isLocked ||
              (i.editor.selection.selectPhrase(),
              i.editor.UserOp.backspaceHandler(i.editor, null, "delSelection"));
          }),
          (c.deleteLine = function () {
            i.isLocked || i.editor.UserOp.deleteLine(i.editor);
          }),
          (c.deleteBlock = function () {
            i.isLocked || i.editor.UserOp.deleteBlock(i.editor);
          });
        (c.undo = function (e) {
          i.isLocked || (i.editor.undo.undo(e), i.freshMenuWithDelay());
        }),
          (c.redo = function (e) {
            i.isLocked || (i.editor.undo.redo(e), i.freshMenuWithDelay());
          }),
          (c.toggleOutline = function () {
            i.editor.library.togglePanel("outline");
          }),
          (c.toggleFileList = function () {
            i.editor.library.togglePanel("file-list");
          }),
          (c.toggleFileTree = function () {
            i.editor.library.togglePanel("file-tree");
          }),
          (c.pinWindow = function () {
            JSBridge.invoke("window.pin"),
              document.body.classList.add("always-on-top"),
              c.refreshViewMenu();
          }),
          (c.execForAll = function (e) {
            var t = e.toString(),
              n = arguments;
            (t = t.replace(/\$(\d+)/gi, function (e, t) {
              return t - 0 < n.length ? n[t] : e;
            })),
              reqnode("electron").ipcRenderer.send("execForAll", t);
          }),
          (c.unpinWindow = function () {
            JSBridge.invoke("window.unpin"),
              document.body.classList.remove("always-on-top"),
              c.refreshViewMenu();
          }),
          (c.toggleStatusBar = function () {
            var e = document.body.classList.contains("show-footer");
            e
              ? c.execForAll(function () {
                  document.body.classList.remove("show-footer"),
                    document.body.classList.add("hide-footer");
                })
              : c.execForAll(function () {
                  document.body.classList.add("show-footer"),
                    document.body.classList.remove("hide-footer");
                }),
              JSBridge.putSetting("showStatusBar", !e);
          });
        (c.toggleDevTools = function () {
          i.megaMenu.isPreferencePanelShown()
            ? document
                .querySelector("#uni-preference-panel-view")
                .openDevTools()
            : JSBridge.invoke("window.toggleDevTools");
        }),
          (c.refreshViewMenu = function () {
            if (i.isNode) {
              var e = {};
              (e["View→Show Status Bar"] = {
                state: document.body.classList.contains("show-footer"),
              }),
                o.refreshViewMenu(e),
                JSBridge.menu.update(e),
                JSBridge.invoke("menu.updateCustomZoom");
            }
          });
        var d,
          u = function (e) {
            "string" == typeof e && (i._CopyContentFlag = e),
              JSBridge.invoke("webContents.copy");
          },
          h = function (e) {
            "string" == typeof e && (i._PasteContentFlag = e),
              JSBridge.invoke("webContents.paste");
          };
        function p() {
          d && clearTimeout(d),
            (d = setTimeout(function () {
              (d = null),
                i.editor &&
                  i.editor.diagrams &&
                  (i.editor.diagrams.loadMermaidTheme(),
                  i.editor.diagrams.refreshDiagram(!0));
            }, 500));
        }
        ((c.cut = function () {
          JSBridge.invoke("webContents.cut");
        }),
        (c.copy = function () {
          u();
        }),
        (c.copyAsPlainText = function () {
          u("copyAsPlainText");
        }),
        (c.copyAsMarkdown = function () {
          u("copyAsMarkdown");
        }),
        (c.copyAsHTMLSource = function () {
          u("copyAsHTMLSource");
        }),
        (c.copyAsSemanticHTML = function () {
          u("copyAsSemanticHTML");
        }),
        (c.paste = function () {
          h(!1);
        }),
        (c.pasteAsPlain = function () {
          h("pasteAsPlain");
        }),
        (c.setTheme = function (e, t) {
          console.log("set theme: " + e),
            JSBridge.invoke("setting.setCurTheme", e, t),
            (i.option.curTheme = e),
            c.execForAll(
              "function(){\t\tFile.setTheme('%@');\t}".replace("%@", e)
            );
        }),
        (c.resetZoom = function () {
          JSBridge.putSetting("customZoom", !1),
            JSBridge.putSetting("zoomFactor", 1),
            JSBridge.putSetting("zoomLevel", 1),
            a.showZoomPanel(1),
            reqnode("electron").webFrame.setZoomFactor(1),
            (i.option.zoomFactor = 1),
            p();
        }),
        (c.zoomIn = function () {
          JSBridge.putSetting("customZoom", !0);
          var e = reqnode("electron").webFrame,
            t = e.getZoomLevel() + 1;
          e.setZoomLevel(t), JSBridge.putSetting("zoomLevel", t);
          var n = e.getZoomFactor();
          JSBridge.putSetting("zoomFactor", n),
            a.showZoomPanel(n),
            (i.option.zoomFactor = n),
            p();
        }),
        (c.zoomOut = function () {
          JSBridge.putSetting("customZoom", !0);
          var e = reqnode("electron").webFrame,
            t = e.getZoomLevel() - 1;
          e.setZoomLevel(t), JSBridge.putSetting("zoomLevel", t);
          var n = e.getZoomFactor();
          JSBridge.putSetting("zoomFactor", n),
            a.showZoomPanel(n),
            (i.option.zoomFactor = n),
            p();
        }),
        window.reqnode) &&
          reqnode("electron").ipcRenderer.on("export", function (e, t) {
            c.export(t);
          });
        (n.exports = c), (window.ClientCommand = c);
      }
    ),
    $__System.registerDynamic(
      "52",
      ["11", "13", "46", "19", "17", "e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("13"),
          o = r.Node,
          a = r.TYPE,
          s = (r.NodeCollectionUtils, e("46")),
          l = e("19"),
          c = e("17"),
          d = e("e"),
          u = [
            "CONTENT",
            "HEADER",
            "FOOTER",
            "ARTICLE",
            "SECTION",
            "DIV",
            "P",
            "BLOCKQUOTE",
            "PRE",
            "UL",
            "OL",
            "TABLE",
            "HR",
            "H1",
            "H2",
            "H3",
            "H4",
            "H5",
            "H6",
            "DL",
            "DT",
            "DD",
            "TBODY",
            "THEAD",
            "TFOOT",
            "ASID",
            "LI",
            "HTML",
            "BODY",
            "IFRAME",
            "STYLE",
            "SCRIPT",
            "FIGURE",
            "VIDEO",
            "AUDIO",
          ],
          h = [
            "TITLE",
            "SELECT",
            "TEXTAREA",
            "INPUT",
            "BUTTON",
            "SELECT",
            "SCRIPT",
            "CANVAS",
            "META",
            "PROGRESS",
            "HEAD",
            "EMBED",
            "STYLE",
            "TEMPLATE",
            "LINK",
            "NOSCRIPT",
            "MENU",
            "EMBED",
            "OBJECT",
          ],
          p = function (e) {
            var t = e.find(".gist-file>.gist-data .blob-wrapper");
            if (!t.length) return null;
            var n = t
                .find(".blob-code.blob-code-inner")
                .map(function () {
                  return this.textContent;
                })
                .toArray()
                .join("\n"),
              i = /\stype-([^\s]+)/.exec(t.attr("class") || ["", ""])[1];
            return (
              "text" == i && (i = ""), { type: a.fences, text: n, lang: i }
            );
          },
          f =
            /^\s*<(iframe|div|p|table|details|figure|img|a|video|audio|script|style|meta|svg|pre|code)(\s|\/?>)/,
          m = /(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)/,
          g = /\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)/,
          v = { NORMAL: "normal", HTML: "html" },
          y = function (e, t, n, r, o) {
            function a(e) {
              var t = ["", e, ""],
                n = /^(\s*)/.exec(e);
              return (
                n && ((e = e.substring(n[0].length)), (t[0] = n[0])),
                (n = /(\s*)$/.exec(e)) &&
                  ((e = e.substring(0, e.length - n[0].length)), (t[2] = n[0])),
                (t[1] = e),
                t
              );
            }
            (n = n || File.editor),
              (function e(t) {
                var s, l, c, u;
                t.find("img").each(function () {
                  var e;
                  (s = d(this)).text(
                    "![" +
                      (s.attr("alt") || s.attr("title") || "img").replace(
                        /\r?\n/gi,
                        " "
                      ) +
                      "](" +
                      ((e = s.attr("src") || ""),
                      File.isMac &&
                        (0 == e.indexOf("file:///") &&
                        -1 == e.substring("file:///".length).indexOf("/")
                          ? ((e = e.substring("file:///".length)),
                            (e = i.getAbsoluteURL(r, e)) &&
                              o &&
                              o[e] &&
                              (e = o[e]))
                          : 0 == e.indexOf("webkit-fake-url:") &&
                            (File.isMacWK ||
                              (e = bridge.callSync(
                                "images.convertFakeUrl",
                                e
                              )))),
                      -1 == e.indexOf(":/") &&
                        n &&
                        n.imgEdit &&
                        (e = n.imgEdit.resolveImagePath(e)),
                      e) +
                      ")"
                  ),
                    s.replaceWith(s[0].childNodes[0]);
                }),
                  t.find("strong, b").each(function () {
                    (s = d(this)),
                      "normal" !== this.style.fontWeight &&
                        (e(s),
                        ((u = a(s.text()))[1] = u[1]
                          ? "**" + u[1].replace(/([^\\])\*/g, "$1\\*") + "**"
                          : ""),
                        s.replaceWith(
                          u.join("").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                        ));
                  }),
                  t.find("em, i").each(function () {
                    e((s = d(this))),
                      ((u = a(s.text()))[1] = u[1]
                        ? "*" +
                          u[1].replace(/([^\\*])\*([^*])/g, "$1\\*$2") +
                          "*"
                        : ""),
                      s.replaceWith(
                        u.join("").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                      );
                  }),
                  t.find("code, pre, tt").each(function () {
                    (s = d(this)).replaceWith(
                      "`" +
                        s.text().replace(/</g, "&lt;").replace(/>/g, "&gt;") +
                        "`"
                    );
                  }),
                  t.find("del, strike").each(function () {
                    e((s = d(this))), s.replaceWith("~~" + s.text() + "~~");
                  }),
                  t.find("span").each(function () {
                    (s = d(this)),
                      (0 != (this.style.fontWeight || "").indexOf("bold") &&
                        700 != this.style.fontWeight &&
                        900 != this.style.fontWeight) ||
                        (e(s),
                        ((u = a(s.text()))[1] = u[1]
                          ? "**" + u[1].replace(/([^\\])\*/g, "$1\\*") + "**"
                          : ""),
                        s.replaceWith(
                          u.join("").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                        )),
                      "italic" == this.style.fontStyle &&
                        (e(s),
                        ((u = a(s.text()))[1] = u[1]
                          ? "*" +
                            u[1].replace(/([^\\*])\*([^*])/g, "$1\\*$2") +
                            "*"
                          : ""),
                        s.replaceWith(
                          u.join("").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                        ));
                  }),
                  t.find("br").each(function () {
                    (s = d(this)).replaceWith("");
                  }),
                  t.find("a[href]:not(:empty)").each(function () {
                    e((s = d(this))),
                      (l = i.getAbsoluteURL(
                        r,
                        i.decodeFromEscapedPath(s.attr("href"))
                      )),
                      0 == (c = s.text()).length
                        ? s.replaceWith("")
                        : l == c && /^(https?|mailto):/.exec(l)
                        ? s.replaceWith(
                            l
                              .replace(/</g, encodeURI("<"))
                              .replace(/>/g, encodeURI(">"))
                          )
                        : s.replaceWith(
                            "[" +
                              c
                                .replace(/([^\\])]([^(]|$)/, "$1\\]$2")
                                .replace(/\r?\n/gi, " ") +
                              "](" +
                              l +
                              ")"
                          );
                  }),
                  File.option.highlight &&
                    t.find("mark").each(function () {
                      e((s = d(this))),
                        s.replaceWith(
                          "==" +
                            s
                              .text()
                              .replace(/</g, "&lt;")
                              .replace(/>/g, "&gt;")
                              .replace(/([^\\])\=/, "\\=") +
                            "=="
                        );
                    });
              })(e);
            var s = (e[0].innerText || e[0].textContent || "")
              .replace(/(^[\r\n]+)|([\r\n]+$)/g, "")
              .replace(/([\r\n]|\u00a0)\s?/gi, " ");
            return t ? s.split(/\uE033/g) : s.replace(/\uE033/g, " ");
          };
        t.parseInlineHTML = function (e, t, n, i) {
          var r = d(d.parseHTML("<div>" + e + "</div>")[0]);
          r
            .find(
              "head, meta, script, css, .gutter, style, title, template, wbr, menu"
            )
            .remove(),
            r[0].normalize && r[0].normalize();
          for (var o = 0; o < r[0].childNodes.length; o++) {
            var a = r[0].childNodes[o];
            a.nodeType == a.TEXT_NODE
              ? /^[\s\r\n]*$/.exec(a.textContent) && (a.remove(), o--)
              : a.nodeType !== a.ELEMENT_NODE && (a.remove(), o--);
          }
          return y(r, void 0, t, n, i);
        };
        var b = new r.NodeMap();
        (t.getMarkElemFromCurrentHtml = function (e, t, n) {
          return (
            /^\<(tbody|thead)/.exec(e) &&
              (e = "<table mdtype='table'>" + e + "</table>"),
            /^\<tr\s/.exec(e) &&
              /\<\/tr\>\s*$/.exec(e) &&
              (e = "<table mdtype='table'>" + e + "</table>"),
            (function (e, t, n) {
              var i, r, o, a;
              return (
                (t = t || File.editor),
                e.find(".md-header-span").replaceWith(function () {
                  var e = d(this).prev();
                  if (e.length) {
                    var t = e.text().trim().length;
                    return (
                      e.remove(),
                      e.next().remove(),
                      "<h" +
                        t +
                        " mdtype='heading'>" +
                        this.innerHTML +
                        "</h" +
                        t +
                        ">"
                    );
                  }
                }),
                e.find(".math-jax-postprocess svg").remove(),
                e
                  .find(".md-fences")
                  .toArray()
                  .map(function (e) {
                    (i = e.getAttribute("cid")),
                      (r = d(e)).attr("lang", r.attr("lang") || ""),
                      i && r.text(t.fences.getValue(i));
                  }),
                void 0 === (n = n || {}).root &&
                  (n.root =
                    File.editor.imgEdit.getLocalRootUrlForInsert() || ""),
                (n && n.skipEmoji) ||
                  e
                    .find(".md-emoji")
                    .toArray()
                    .map(function (e) {
                      (r = d(e)).text(":" + r.attr("data-content") + ":");
                    }),
                e
                  .find("[md-inline='image'], [md-inline='imgtag']")
                  .toArray()
                  .map(function (e, t) {
                    e.setAttribute(
                      "data-root",
                      n.root || File.bundle.filePath || ""
                    ),
                      !t &&
                        e.setAttribute(
                          "data-copy-from-path",
                          File.bundle.filePath || ""
                        );
                  }),
                e.find("img[data-real-src]").attr("src", function () {
                  return this.dataset.realSrc;
                }),
                e
                  .find("[mdtype='math_block']")
                  .toArray()
                  .map(function (e) {
                    (i = e.getAttribute("cid")),
                      (r = d(e)).text(t.mathBlock.getTex(i));
                  }),
                e
                  .find("[mdtype='html_block']")
                  .toArray()
                  .map(function (e) {
                    i = e.getAttribute("cid");
                    var n = t.getNode(i);
                    (r = d(e)).text(n && n.get("text"));
                  }),
                e.find(".md-math-after-sym").remove(),
                (o = e.children("li[cid]")).length &&
                  ((a = d(
                    document.querySelector(
                      "[cid='" + o[0].getAttribute("cid") + "']"
                    ).parentElement
                  ).clone())
                    .empty()
                    .append(o)
                    .wrap("div"),
                  (e = a.parent())),
                e.find("[cid]").each(function () {
                  var e = t.getNode(this.getAttribute("cid")),
                    n = this;
                  [
                    "pattern",
                    "patternEnd",
                    "prespace",
                    "markindent",
                    "isFixed",
                    "ahead",
                    "tail",
                  ].forEach(function (t) {
                    e && e.get(t) && n.setAttribute(t, e.get(t));
                  });
                }),
                e
              );
            })(d(d.parseHTML("<div>" + e + "</div>")), t, n)
          );
        }),
          (t.getBlocksFromMarkHtml = function (e, t, n, i) {
            t || (b.reset(!0), (t = b));
            var r,
              a = e;
            a.jquery
              ? (r = a.html())
              : ((r = e), (a = d(d.parseHTML("<div>" + r + "</div>")[0])));
            var s,
              l = [],
              c = a.children("[mdtype]");
            return c.length
              ? (c.each(function (e) {
                  (s = o.reverse(d(this), t, n, i)),
                    l.length ? l.last().addAfter(s) : s.unset("ahead"),
                    l.push(s);
                }),
                s && s.unset("tail"),
                l)
              : n
              ? (a.find("[data-emoji]").text(function () {
                  return this.getAttribute("data-emoji");
                }),
                a.find(".md-meta, .md-content").remove(),
                a.find("sup, sub").text(function () {
                  return " (" + this.textContent + ")";
                }),
                File.option.convertSmartOnRender &&
                  a.find("[md-inline='pants']").text(function () {
                    return this.getAttribute("data-text") || this.textContent;
                  }),
                a.text())
              : a.rawText();
          }),
          (t.convertToPlain = function (e, t) {
            function n(e, t) {
              for (
                var n = (
                    e instanceof Array ? e[0] : e.sortedFirst()
                  ).getFirstBrother(),
                  r = [],
                  o = 0;
                o < e.length;
                o++
              )
                (r = r.concat(i(n, t))), (n = n.get("after"));
              return r;
            }
            function i(e, t) {
              var r,
                s = [];
              function l(e) {
                return t ? [e] : [e, ""];
              }
              switch (e.get("type")) {
                case a.fences:
                  s = e
                    .get("text")
                    .replace(/\u200B/g, "")
                    .split("\n");
                  for (var c = 0; c < s.length; c++) s[c] = "    " + s[c];
                  return t || s.push(""), s;
                case a.list:
                  var d = e.get("style"),
                    u = Number.isNaN(Number.parseInt(e.get("start")))
                      ? 0
                      : Number.parseInt(e.get("start")) - 1,
                    h = e.get("children").length;
                  if (h) {
                    var p = e.getFirstChild();
                    for (c = 0; p; ) {
                      var f = i(p, !0),
                        m = o.getIndentPrefix(
                          d,
                          c + u,
                          p,
                          void 0,
                          (h + "").length
                        );
                      f.map(function (e, t) {
                        (f[t] = (t ? " ".repeat(m.length) : m) + f[t]),
                          s.push(f[t]);
                      }),
                        c++,
                        (p = p.get("after"));
                    }
                  }
                  return t || s.push(""), s;
                case a.table:
                  for (
                    var g,
                      v,
                      y,
                      b,
                      w,
                      x,
                      C = [],
                      F = [],
                      S = 0,
                      k = e.getFirstChild();
                    k;

                  ) {
                    for (g = k.getFirstChild(), F[S] = [], v = 0; g; )
                      (F[S][v] = g.toMark().trim()),
                        (g = g.get("after")),
                        0 === S && (C[v] = 4),
                        (C[v] = Math.max(F[S][v].length, C[v])),
                        (C[v] = Math.min(C[v], 40)),
                        v++;
                    (k = k.get("after")), S++;
                  }
                  for (S = 0; S < F.length; S++) {
                    for (y = "  ", v = 0; v < C.length; v++)
                      (F[S][v] = F[S][v] || ""),
                        (b = Math.max(C[v] - F[S][v].length, 0)),
                        (y +=
                          "right" == (w = e.get("align")[v])
                            ? " ".repeat(b) + F[S][v]
                            : "center" == w
                            ? " ".repeat((x = ~~(b / 2))) +
                              F[S][v] +
                              " ".repeat(b - x)
                            : F[S][v] + " ".repeat(b)),
                        (y += "\t");
                    s.push(y.replace(/\s$/, ""));
                  }
                  return t || s.push(""), s;
                case a.hr:
                  return l("---");
                case a.def_link:
                  return (
                    (r =
                      "[" +
                      e.get("ref") +
                      "]: " +
                      e.safeGetStrAttr("href") +
                      (e.safeGetStrAttr("title").length
                        ? '\t"' + e.get("title") + '"'
                        : "")),
                    o.isType(e.get("after"), a.def_link) ? [r] : l(r)
                  );
                case a.def_footnote:
                  return (
                    (r = "[" + e.get("ref") + "]: " + e.get("text")),
                    o.isType(e.get("after"), a.def_footnote) ? [r] : l(r)
                  );
                default:
                  return e.get("children") && e.get("children").length > 0
                    ? n(e.get("children"), t)
                    : l(e.get("text"));
              }
            }
            return n(e).join("\n");
          }),
          (t.parseHTML = function (e, t, n, r, b) {
            var w,
              x = e;
            x.jquery
              ? (w = x.html())
              : ((w = e), (x = d(d.parseHTML("<div>" + w + "</div>")[0])));
            var C = [];
            function F(e) {
              var t = !1;
              (e = e || "").length > 2e3 && (e = e.substring(0, 2e3));
              try {
                t = (t =
                  (
                    e.match(
                      /\n\s*(\!?\[|#{1,5}|>|```|([-+*]\s)|(\d+(\.|\))\s))/gm
                    ) || ""
                  ).length > 3 ||
                  e.match(g) ||
                  e.match(m))
                  ? v.NORMAL
                  : null;
              } catch (e) {}
              return (
                t || (t = (t = f.exec(e)) ? v.HTML : null),
                t ||
                  (t = (t = (e.match(/(\/\w*>)|(\n\s+<)/g) || []).length > 6)
                    ? v.HTML
                    : null),
                t
              );
            }
            function S(e, n, i) {
              (e.in = t),
                e &&
                  e.text &&
                  (e.text = e.text
                    .replace(/\u200b/g, "")
                    .replace(/\u00a0/g, " "));
              var r = new o(e);
              return (
                i.length ? i.last().addAfter(r) : n && n.appendChild(r),
                i.push(r),
                r
              );
            }
            function k(e, t, i) {
              var s = [];
              if (t)
                for (var l = 0; l < e[0].childNodes.length; l++)
                  A(d(e[0].childNodes[l]), i, s);
              else
                o.isType(i, a.blockquote, a.list_item)
                  ? T(e, i, s)
                  : i.set("text", y(e, void 0, n, r, b));
            }
            function E(e, r, s) {
              for (var c, d, u, h, p = [], f = null, m = 0; m < e.length; m++)
                if (((c = e[m]), (p = l.reDefLink.exec(c))))
                  (f = null),
                    S(
                      { type: a.def_link, ref: p[1], href: p[3], title: p[8] },
                      r,
                      s
                    );
                else if ((p = l.reDefFootnote.exec(c)))
                  (f = null),
                    S(
                      {
                        type: a.def_footnote,
                        ref: p[1],
                        text: (p[3] || "").trim(),
                      },
                      r,
                      s
                    );
                else if ((p = l.reOL.exec(c))) {
                  (f = new o({ type: a.paragraph, text: c, in: t })),
                    l.quickParse(c, n.brush, f, !1, null, {
                      id: f.cid,
                      start: 0,
                      end: 0,
                    });
                  var g = s.last();
                  g &&
                  ((d = g),
                  (u = f),
                  (h = void 0),
                  o.isType(d, a.list) &&
                    o.isType(u, a.list) &&
                    (h || d.get("style") == d.get("style")))
                    ? (g.appendChildrenTillEnd(f.getFirstChild()), f.remove())
                    : (s.length ? s.last().addAfter(f) : r && r.appendChild(f),
                      s.push(f)),
                    (f = null);
                } else
                  null == f
                    ? (f = S(
                        { type: a.paragraph, text: i.escapeHead(c) },
                        r,
                        s
                      ))
                    : c
                    ? f.set("text", f.get("text") + "\n" + i.escapeHead(c))
                    : (f = null);
            }
            function T(e, t, i) {
              if (e.find("br").length) E(y(e, !0, n.baseURL, b), t, i);
              else {
                if (3 == e[0].nodeType && !e.text().trim().length) return;
                if (1 == e[0].nodeType && "BR" == e[0].tagName) return;
                E([y(e, void 0, n, r, b)], t, i);
              }
            }
            var _ = { center: "center", left: "left", right: "right" };
            function A(e, i, l, f) {
              var m,
                g,
                v,
                w = (function (e) {
                  if (!e[0] || !e[0].tagName) return !1;
                  if (-1 == u.indexOf(e[0].tagName.toUpperCase()))
                    return e[0].querySelector("video, div, p, tr, pre");
                  var t = !1;
                  return (
                    e.children().each(function () {
                      t =
                        t ||
                        (this.tagName &&
                          (u.indexOf(this.tagName.toUpperCase()) > -1 ||
                            "BLOCK" == this.style.display));
                    }),
                    t || e[0].querySelector("video, div, p, tr, pre")
                  );
                })(e),
                x = e[0].tagName;
              function C(e) {
                var t = S({ type: a.paragraph, text: e }, i, l),
                  n = (t.parseFrom(void 0, void 0, !0) || [])[1];
                n &&
                  n.length &&
                  (f &&
                  1 == n.length &&
                  !l.length &&
                  n[0].get("type") == a.html_block
                    ? f.push(e)
                    : (l.remove(t),
                      l.splice.apply(l, [l.length, 0].concat(n))));
              }
              if (
                !(
                  e.data("skip") ||
                  h.indexOf(x) > -1 ||
                  e[0].nodeType === document.COMMENT_NODE
                )
              ) {
                if (f && f.length) f.push(("P" == x ? "\n" : "") + e.text());
                else if ("BLOCKQUOTE" === x)
                  k(e, w, (m = S({ type: a.blockquote }, i, l)));
                else if ("LI" === x && o.isType(i, a.list))
                  k(e, w, (m = S({ type: a.list_item }, i, l)));
                else if ("UL" === x || "OL" === x)
                  k(
                    e,
                    w,
                    (m = S({ type: a.list, style: x.toLowerCase() }, i, l))
                  );
                else if ("DL" === x)
                  (m = S({ type: a.list, style: "ul" }, i, l)),
                    (function (e, t) {
                      for (var i, o = [], s = 0; s < e.length; s++)
                        "DT" == e[s].tagName &&
                          (((i = S({ type: a.list_item }, t, o)).itemList = []),
                          S(
                            {
                              type: a.paragraph,
                              text: y(d(e[s]), void 0, n, r, b),
                            },
                            i,
                            i.itemList
                          )),
                          "DD" == e[s].tagName &&
                            i &&
                            S(
                              {
                                type: a.paragraph,
                                text: y(d(e[s]), void 0, n, r, b),
                              },
                              i,
                              i.itemList
                            );
                    })(e.children(), m);
                else if ("TABLE" === x)
                  (g = e.children().children("tr").add(e.children("tr")))
                    .length &&
                    ((m = S({ type: a.table }, i, l)),
                    (l = []),
                    (m.cols = 1),
                    m.set("align", Array(m.cols - 0).fill()),
                    g.toArray().map(function (e) {
                      A(d(e), m, l);
                    }),
                    s.verify(m, m.cols, 2, function (e, t) {
                      var n = t.split(/(\r|\n)+/);
                      e.set("type", a.paragraph),
                        e.clearChildren(),
                        e.set("text", n[0]);
                      for (var r = 1; r < n.length; r++)
                        n[r].trim().length &&
                          S({ type: a.paragraph, text: n[r] }, i, l);
                    }));
                else if ("THEAD" === x || "TBODY" === x || "TFOOT" === x) {
                  for (
                    var E = [e], M = $elem.next();
                    M.length &&
                    o.isType(M[0].tagName, "THEAD", "TBODY", "TFOOT");

                  )
                    E.push(M), M.data("skip", !0);
                  e.wrap("<table></table>"), A(e.parent(), i, l);
                } else if ("TR" === x && o.isType(i, a.table)) {
                  var L;
                  (L = (g = e.children("th")).length),
                    (g = g.add(e.children("td"))),
                    (i.cols = g.length > i.cols ? g.length : i.cols),
                    (m = S({ type: a.table_row, isHeader: L }, i, l)),
                    (l = []),
                    g.toArray().map(function (e) {
                      A(d(e), m, l);
                    });
                } else if (
                  ("TD" !== x && "TH" !== x) ||
                  !o.isType(i, a.table_row)
                )
                  if ("HR" === x) S({ type: a.hr }, i, l);
                  else if (/H[1-6]/g.exec(x))
                    S(
                      {
                        type: a.heading,
                        text: y(e, void 0, n, r, b),
                        depth: e[0].tagName[1],
                      },
                      i,
                      l
                    );
                  else if (e.hasClass("CodeMirror"))
                    (v = Array.from(
                      e.find(".CodeMirror-line").map(function () {
                        return this.textContent;
                      })
                    ).join("\n")),
                      S({ type: a.fences, text: v }, i, l);
                  else if (
                    "CODE" === x ||
                    ("PRE" === x && 0 == e.find("pre").length) ||
                    ("FIGURE" == x && e.hasClass("highlight"))
                  ) {
                    v = "";
                    var N =
                        e.attr("class") +
                        " " +
                        e.children("code").attr("class"),
                      D =
                        e.attr("lang") ||
                        (/lang(?:uage)?\-([^\s]+)/.exec(N) || [])[1],
                      B = e.find("tr");
                    B.length > 1
                      ? (v = B.map(function () {
                          return this.innerText;
                        })
                          .toArray()
                          .join("\n"))
                      : (e.find("div, prev").each(function () {
                          d(this).before("<br/>");
                        }),
                        (v = e[0].innerText.replace(
                          /(^\s*\n+)|([\r\n]+$)/g,
                          ""
                        )),
                        /\n/.exec(v) ||
                          (e.find("br").each(function () {
                            d(this).before("\n");
                          }),
                          (v = e[0].innerText.replace(
                            /(^\s*\n+)|([\r\n]+$)/g,
                            ""
                          )))),
                      S({ type: a.fences, text: v, lang: D }, i, l);
                  } else {
                    if (
                      o.isType(
                        (x || "").toUpperCase(),
                        "VIDEO",
                        "AUDIO",
                        "IFRAME",
                        "DETAILS",
                        "SVG"
                      )
                    )
                      return (
                        (e[0].style.position = ""),
                        (e[0].style.float = ""),
                        (v = e[0].outerHTML),
                        S({ type: a.html_block, text: v }, i, l),
                        v
                      );
                    if ("SCRIPT" == x) return "";
                    if ("P" != x && w) {
                      if (w) {
                        var R, P;
                        if ("DIV" == x)
                          if (e.is(".gist")) {
                            if ((P = p(e))) return void S(P, i, l);
                          } else if (
                            !i &&
                            /monospace/.exec(e[0].style.fontFamily) &&
                            /pre/.exec(e[0].style.whiteSpace)
                          ) {
                            var I = (function (e) {
                              if (!e) return null;
                              var t = [],
                                n = !1;
                              return (
                                e.children.forEach((e) => {
                                  "DIV" == e.tagName
                                    ? t.push(e.textContent)
                                    : "BR" == e.tagName
                                    ? t.push("")
                                    : e.nodeType == e.ELEMENT_NODE && (n = !0);
                                }),
                                n ? null : t.join("\n")
                              );
                            })(e[0]);
                            if (I && F(I)) return void C(I);
                          }
                        var O = [];
                        if (
                          (Array.from(e[0].childNodes).forEach(function (e, t) {
                            if (
                              e.nodeType != e.TEXT_NODE ||
                              e.nodeValue.trim().length
                            )
                              if (
                                e.nodeType == e.TEXT_NODE ||
                                (c.ALL_INLINE_TYPE.indexOf(
                                  (e.tagName || "").toLowerCase()
                                ) > -1 &&
                                  !e.querySelector(
                                    "p, div, h1, h2, h3, h4, h5, table"
                                  ))
                              )
                                R
                                  ? R.append(d(e))
                                  : "BR" !== e.tagName &&
                                    (R = d(e).wrap("<p></p>").parent());
                              else if (e.nodeType == e.ELEMENT_NODE) {
                                if (
                                  (R && (A(R, i, l, O), (R = null)),
                                  "DIV" == e.tagName &&
                                    !e.textContent &&
                                    !e.querySelector(
                                      "img, video, audio, svg, iframe"
                                    ))
                                )
                                  return;
                                A(d(e), i, l, O);
                              }
                          }),
                          O.length)
                        ) {
                          var $ = O.join("\n"),
                            H = o.parseFrom($, t, void 0, !0)[1];
                          return l.splice.apply(l, [l.length, 0].concat(H)), $;
                        }
                        R && (A(R, i, l), (R = null));
                      }
                    } else {
                      (v = e[0].innerText || e[0].textContent || ""),
                        e[0].style &&
                          "pre" !== e[0].style.whiteSpace &&
                          "line" !== e[0].style.whiteSpace &&
                          (v = v
                            .replace(/(^[\r\n]+)|([\r\n]+$)/g, "")
                            .replace(/[\r\n]/g, " "));
                      var U = !i && F(v);
                      if (
                        ((v = v
                          .replace(/^[\r\n]+\s*/, "")
                          .replace(/\s*[\r\n]+$/, "")),
                        U ? C(v) : T(e, i, l),
                        U)
                      )
                        return v;
                    }
                  }
                else
                  (m = S(
                    { type: a.table_cell, text: y(e, void 0, n, r, b) },
                    i,
                    l
                  )),
                    "TH" === x &&
                      (function (e, t) {
                        if ("TH" === e[0].tagName) {
                          var n = e.attr("style") || "",
                            i = /text\-align:([^;]+)($|;)/.exec(n),
                            r = null;
                          if (
                            (i &&
                              (r = _[i[1].replace(/;/g, "").trim()] || null),
                            r)
                          ) {
                            var o = e.prevAll("th").length;
                            (t.get("parent").get("parent").get("align") || [])[
                              o
                            ] = r;
                          }
                        }
                      })(e, m);
                return null;
              }
            }
            x
              .find(
                "head, meta, css, .gutter, style, title, template, wbr, menu"
              )
              .remove(),
              x[0].normalize && x[0].normalize();
            var M = A(x, null, C);
            return (
              M ||
              (C.length &&
              ((function e(t, n, i, r) {
                var s,
                  l = n,
                  c = [];
                for (
                  (function () {
                    if (n && n !== i) {
                      for (
                        ;
                        l &&
                        l !== i &&
                        o.isType(l, a.paragraph) &&
                        o.isEmptyBlock(l);

                      )
                        (s = l),
                          (l = l.get("after")),
                          s.remove(),
                          r && r.splice(r.indexOf(s), 1);
                      for (
                        n = l.get("before") || l, l = i;
                        l &&
                        l !== n &&
                        o.isType(l, a.paragraph) &&
                        o.isEmptyBlock(l);

                      )
                        (s = l),
                          (l = l.get("before")),
                          s.remove(),
                          r && r.splice(r.indexOf(s), 1);
                    }
                  })(),
                    l = n;
                  l;

                ) {
                  var d = null;
                  if (o.isType(l, a.blockquote, a.list_item))
                    e(l, l.getFirstChild(), l.getLastChild());
                  else if (
                    o.isType(l, a.fences) &&
                    o.isType(l.get("before"), a.fences)
                  )
                    c.push(l),
                      (l.head = l.get("before").head || l.get("before")),
                      l.head.set(
                        "text",
                        l.head.get("text") + "\n" + l.get("text")
                      );
                  else if (
                    o.isType(l, a.list) &&
                    0 === l.get("children").length
                  )
                    l.set("type", a.paragraph);
                  else if (
                    o.isType(l, a.paragraph) &&
                    (d = /^(`+)([\s\S]*?[^`])\1(?!`)\s*$/g.exec(l.get("text")))
                  ) {
                    l.set("type", a.fences), l.set("text", d[2]);
                    continue;
                  }
                  l = l.get("after");
                }
                c.map(function (e) {
                  r && r.splice(r.indexOf(e), 1), e.remove();
                });
              })(0, C[0], C.last(), C),
              1 === C.length && o.isType(C[0], a.paragraph))
                ? C[0].get("text")
                : C)
            );
          });
      }
    ),
    $__System.registerDynamic(
      "46",
      ["e", "13", "1b", "2b", "50", "26"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"),
          r = e("13"),
          o = r.TYPE,
          a = r.Node,
          s = e("1b"),
          l = (e("2b"), e("50")),
          c = e("26").map,
          d = 99,
          u = 40;
        class h {
          constructor(e) {
            var t,
              n = this;
            (this.editor = e),
              (this.TableEdit = h),
              i(e.sessionStr)
                .on("click", ".md-align-gp button", function (t) {
                  var n,
                    r = /md-align-\S+/g.exec(this.className)[0].substring(9),
                    o = i(this).closest('[mdtype="table"]'),
                    a = e.findNodeByElem(o),
                    [l, c] =
                      (function (t) {
                        if (!(t = t || e.selection.getRangy())) return null;
                        var n = i(t.startContainer).closest("td, th"),
                          r = n.prevAll().length,
                          o = i(t.endContainer).closest("td, th");
                        return [
                          r,
                          o.parent().is(n.parent())
                            ? o.prevAll().length
                            : o.parent().children().length,
                        ];
                      })() || [];
                  if (void 0 !== l) {
                    for (var d = null, u = l; u <= c; u++) {
                      n = a.get("align")[u] == r ? null : r;
                      var h = a.attr("align_idx", [u, n], e);
                      u > l
                        ? (e.undo.removeLastRegisteredOperationCommand(),
                          s.append(d, h))
                        : (d = h);
                    }
                    c > l && e.undo.register(d),
                      t.stopPropagation(),
                      e.lastCursor && e.undo.exeCommand(e.lastCursor);
                  }
                })
                .on("click", ".md-delete-table", function () {
                  e.tableEdit.deleteTable(i(this).closest("[mdtype='table']"));
                })
                .on("click", ".md-resize-table", function (t) {
                  i(this).next(".md-table-resize-popover").length
                    ? (i(".md-table-resize-popover").remove(),
                      e.lastCursor && e.undo.exeCommand(e.lastCursor))
                    : (function (t) {
                        var r,
                          o =
                            '<div class="popover bottom md-table-resize-popover" style="display:block; bottom:auto; top:20px; margin-left:-10px;" contenteditable="false">\t\t\t\t<div class="arrow" style="left:20px;"></div>\t\t\t\t<div class="md-grid-board-wrap md-reset code-tooltip-content">\t\t\t\t\t<table role="grid" class="md-grid-board md-reset">\t\t\t\t\t\t<tbody>\t\t\t\t\t\t\t<tr class="md-reset" row="1">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="2">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="3">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="4">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="5">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="6">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="7">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="8">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="9">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="10">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</tbody>\t\t\t\t\t</table>\t\t\t\t\t<div class="popover-title">\t\t\t\t\t\t<input id="md-grid-width" type="text"  max="20" size="2" min="1" value="0" /> x <input id="md-grid-height" maxlength="2" size="2" min="1" value="0"/><button id="md-resize-grid" class="btn btn-primary btn-xs">' +
                            i.localize.getString("OK") +
                            "</button>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>",
                          a = t.closest('[mdtype="table"]'),
                          s = e.findNodeByElem(a),
                          l = s.get("align").length,
                          p =
                            a.children("table").children("tbody").children("tr")
                              .length + 1;
                        function f() {
                          i(this).val().trim().length || i(this).val(2);
                          var e = r.find("#md-grid-width").val(),
                            t = r.find("#md-grid-height").val();
                          r.find("a.md-active").removeClass("md-active"),
                            r
                              .find(
                                "tr:nth-child(-n+" +
                                  t +
                                  ")>td:nth-child(-n+" +
                                  e +
                                  ")>a"
                              )
                              .addClass("md-active");
                        }
                        i(".md-table-resize-popover").remove(),
                          t.append(o),
                          (r = t.find(".md-table-resize-popover"))
                            .find(
                              "tr:nth-child(-n+" +
                                p +
                                ")>td:nth-child(-n+" +
                                l +
                                ")"
                            )
                            .addClass("md-grid-ext"),
                          r
                            .find("#md-grid-width, #md-grid-height")
                            .off("keydown keypress")
                            .on("keypress", function (e) {
                              if (!/\d/.exec(String.fromCharCode(e.which)))
                                return !1;
                            })
                            .on("keydown", function (e) {
                              var t = e.keyCode || e.which;
                              return "Up" === c[t]
                                ? ((this.value = this.value - 0 + 1),
                                  (this.value = Math.min(
                                    "md-grid-height" == this.getAttribute("id")
                                      ? d
                                      : u,
                                    this.value
                                  )),
                                  !1)
                                : "Down" === c[t]
                                ? ((this.value = this.value - 1),
                                  (this.value = Math.max(1, this.value)),
                                  !1)
                                : void 0;
                            }),
                          r
                            .find("#md-grid-width")
                            .val(l)
                            .off("blur focus")
                            .blur(f)
                            .focus(function () {
                              r.find("#md-resize-grid").show();
                            })
                            .blur(function () {
                              this.value > u
                                ? (this.value = u)
                                : this.value < 1 && (this.value = 1);
                            })
                            .on("keydown", function (e) {
                              var t = e.keyCode || e.which;
                              if ("Tab" === c[t] && !e.ctrlKey)
                                return r.find("#md-grid-height").focus(), !1;
                              "Enter" === c[t] &&
                                r.find("#md-grid-height").focus();
                            }),
                          r
                            .find("#md-grid-height")
                            .val(p)
                            .off("blur focus")
                            .blur(f)
                            .focus(function () {
                              r.find("#md-resize-grid").show();
                            })
                            .blur(function () {
                              this.value > d
                                ? (this.value = d)
                                : this.value < 1 && (this.value = 1);
                            })
                            .on("keydown", function (e) {
                              var t = e.keyCode || e.which;
                              if ("Tab" === c[t] && !e.ctrlKey)
                                return r.find("#md-grid-width").focus(), !1;
                              "Enter" === c[t] &&
                                r.find("#md-resize-grid").click();
                            }),
                          r
                            .find(".md-grid-board a")
                            .off("mouseenter mouseleave click")
                            .hover(function () {
                              var e = i(this).closest("td"),
                                t = e.prevAll().length + 1,
                                n = e.closest("tr").prevAll().length + 1;
                              r.find("a.md-active").removeClass("md-active"),
                                r
                                  .find(
                                    "tr:nth-child(-n+" +
                                      n +
                                      ")>td:nth-child(-n+" +
                                      t +
                                      ")>a"
                                  )
                                  .addClass("md-active"),
                                r.find("#md-grid-width").val(t),
                                r.find("#md-grid-height").val(n),
                                r.find("#md-resize-grid").hide();
                            })
                            .click(function (e) {
                              e.stopPropagation(),
                                e.preventDefault(),
                                r.find("#md-resize-grid").click();
                            }),
                          r
                            .find(".md-grid-board")
                            .off("mouseleave")
                            .on("mouseleave", function (e) {
                              i(this).find("a").removeClass("md-active"),
                                i("#md-grid-width").val(l),
                                i("#md-grid-height").val(p);
                            }),
                          r
                            .find("#md-resize-grid")
                            .off("click")
                            .click(function (t) {
                              var i,
                                o = (r.find("#md-grid-width").val() || 0) - 0,
                                l = (r.find("#md-grid-height").val() || 0) - 0,
                                c = s.getFirstChild(),
                                d = s.get("align").length,
                                u = 0,
                                p = e.undo.UndoManager.makeEmptyCommand();
                              for (
                                e.undo.endSnap(!0),
                                  p.undo.push(e.undo.buildReplaceUndo(s));
                                c || u < l;

                              )
                                u < l
                                  ? (c
                                      ? h.resizeRow(c, o, s)
                                      : (c = h.newEmptyRowAfter(i, o, s)),
                                    (c = (i = c).get("after")))
                                  : c &&
                                    ((i = c), (c = c.get("after")), i.remove()),
                                  u++;
                              o < d
                                ? s.set("align", s.get("align").slice(0, o))
                                : s.set(
                                    "align",
                                    s
                                      .get("align")
                                      .concat([].repeat(null, o - d))
                                  ),
                                a.replaceWith(s.toHTML()),
                                e.lastCursor
                                  ? e.undo.exeCommand(e.lastCursor)
                                  : window.getSelection().removeAllRanges(),
                                n.showTableEdit(s),
                                p.redo.push(e.undo.buildReplaceUndo(s)),
                                e.undo.register(p);
                            });
                      })(i(this).parent()),
                    t.stopPropagation();
                })
                .on("click", ".ty-table-edit", function (t) {
                  i(t.target).closest(".md-table-resize-popover").length ||
                    (i(".md-table-resize-popover").remove(),
                    e.lastCursor &&
                      i(".md-table-resize-popover").length &&
                      e.undo.exeCommand(e.lastCursor)),
                    t.stopPropagation();
                })
                .on("mousedown", ".ty-table-edit button", function () {
                  File.editor.lastCursor =
                    File.editor.selection.buildUndo() || File.editor.lastCursor;
                })
                .on("refocus", "[mdtype='table']", function () {
                  i(document.activeElement).closest("[md-inline='image']")
                    .length || n.showTableEdit(i(this));
                })
                .on("mouseup", ".ty-table-edit", function (e) {
                  e.stopPropagation();
                })
                .on("click", ".md-table-more", function () {
                  i(File.editor.sessionStr).trigger("cursorChange"),
                    (File.editor.lastCursor =
                      File.editor.selection.buildUndo()),
                    File.editor.contextMenu.updateTableVisibility(),
                    File.editor.contextMenu.showExtMenu("#table-menu", i(this)),
                    this.focus();
                }),
              (t = i("#table-insert-dialog"))
                .find("#table-insert-col, #table-insert-row")
                .off("keydown keypress keyup change")
                .on("keypress", function (e) {
                  if (!/\d/.exec(String.fromCharCode(e.which))) return !1;
                })
                .on("keydown", function (e) {
                  var n = e.keyCode || e.which;
                  return "Up" === c[n]
                    ? ((this.value = this.value - 0 + 1),
                      (this.value = Math.min(
                        "table-insert-row" == this.getAttribute("id") ? d : u,
                        this.value
                      )),
                      !1)
                    : "Down" === c[n]
                    ? ((this.value = this.value - 1),
                      (this.value = Math.max(1, this.value)),
                      !1)
                    : void ("ESC" === c[n] && t.modal("hide"));
                })
                .on("keyup", function () {
                  i(this).trigger("change");
                })
                .on("change", function () {
                  n.updateInsertTableTouchBar();
                }),
              t
                .find("#table-insert-col")
                .blur(function () {
                  0 === i(this).val().trim().length && i(this).val(2),
                    this.value > u
                      ? (this.value = u)
                      : this.value < 1 && (this.value = 1);
                })
                .on("keydown", function (e) {
                  var n = e.keyCode || e.which;
                  if (("Tab" === c[n] && !event.ctrlKey) || "Enter" === c[n])
                    return t.find("#table-insert-row").focus(), !1;
                }),
              t
                .find("#table-insert-row")
                .blur(function () {
                  0 === i(this).val().trim().length && i(this).val(1),
                    this.value > d
                      ? (this.value = d)
                      : this.value < 1 && (this.value = 1);
                })
                .on("keydown", function (e) {
                  var n = e.keyCode || e.which;
                  "Enter" === c[n] && t.find(".btn-primary").trigger("click");
                }),
              t.find(".btn-primary").click(function () {
                t.modal("hide"),
                  e.restoreLastCursor(),
                  i(File.editor.sessionStr).trigger("cursorChange");
                var n = new a({ type: a.TYPE.table, in: e.nodeMap });
                h.verify(
                  n,
                  t.find("#table-insert-col").val(),
                  t.find("#table-insert-row").val()
                ),
                  e.stylize.insertBlock(a.TYPE.table, n);
              }),
              t.on("hidden.bs.modal", function () {
                File.isMac &&
                  setTimeout(function () {
                    l.refreshBlockMenu(null, !0);
                  }, 100);
              });
            var r,
              o,
              f,
              m,
              g,
              v,
              y,
              b,
              w,
              x,
              C,
              F,
              S,
              k,
              E = 0;
            function T(e) {
              if (!File.isLocked) {
                (n.editor.focusCid = null),
                  (g = !0),
                  window.getSelection().removeAllRanges(),
                  L();
                var t,
                  a = o.children();
                i("#typora-table-row-tracker .typora-table-data-area")
                  .html(
                    ((t = o.height()),
                    o.closest("thead").length
                      ? "<table class='md-table' style='margin:0 ; padding:0; margin-left:0; height:" +
                        t +
                        "px;'><thead>" +
                        o[0].outerHTML +
                        "</thead></table>"
                      : "<table class='md-table' style='margin:0 ; padding:0; margin-left:0; height:" +
                        t +
                        "px;'><tbody>" +
                        o[0].outerHTML +
                        "</tbody></table>")
                  )
                  .find("td, th")
                  .each(function (e) {
                    this.style.width = a[e].offsetWidth + "px";
                  }),
                  (C = e.offsetX),
                  (F = e.offsetY),
                  (b = y =
                    o.closest("thead").length ? 0 : o.prevAll().length + 1),
                  (x = []);
                var s = r.offset().top,
                  l = o.closest("table").find("[mdtype='table_row']");
                return (
                  l.each(function () {
                    x.push(this.offsetTop + s);
                  }),
                  l.length < 2
                    ? !1
                    : (x.push(
                        x.last() + r.find("tbody tr:last-child")[0].offsetHeight
                      ),
                      !1)
                );
              }
            }
            function _(e) {
              if (!File.isLocked) {
                (n.editor.focusCid = null),
                  (v = !0),
                  window.getSelection().removeAllRanges();
                var t = N((b = y = w)),
                  o = i(t[0]).offset();
                i("#typora-table-col-tracker .typora-table-data-area")
                  .offset(o)
                  .html(
                    (function (e) {
                      var t = f[0].offsetWidth;
                      return (
                        "<table class='md-table' style='margin:0 ; padding:0; height:" +
                        r.height() +
                        "px; width:" +
                        t +
                        "px;'><thead><tr>" +
                        e[0].outerHTML +
                        "</tr></thead><tbody>" +
                        e
                          .toArray()
                          .map(function (e, t) {
                            return t
                              ? "<tr style='width:" +
                                  e.offsetWidth +
                                  "px; height:" +
                                  e.offsetHeight +
                                  "px;'>" +
                                  e.outerHTML +
                                  "</tr>"
                              : "";
                          })
                          .join("") +
                        "</tbody></table>"
                      );
                    })(t)
                  ),
                  L(!0),
                  (C = e.offsetX),
                  (F = e.offsetY),
                  (E = i("content").offset().left),
                  (x = []);
                var a = r.offset().left;
                r.find("thead:last-of-type th").each(function () {
                  x.push(this.offsetLeft + a);
                }),
                  x.push(
                    x.last() +
                      r.find("thead [mdtype='table_row'] th:last-child")[0]
                        .offsetWidth
                  );
              }
            }
            function A(e) {
              g
                ? (function (e) {
                    if (!g) return;
                    var t;
                    i("#typora-table-row-tracker").css(
                      "top",
                      e.clientY -
                        F -
                        m +
                        document.querySelector("content").scrollTop
                    ),
                      (t = x.findIndex(function (t, n) {
                        return x[n] > e.clientY;
                      })) > 0 && (t -= 1);
                    -1 == t && (t = x.length - 1);
                    y != t &&
                      (function (e) {
                        var t;
                        if (e >= x.length - 1)
                          (t = r.find("tbody tr:last-child").offset()).top +=
                            r.find("tbody tr:last-child")[0].offsetHeight;
                        else {
                          var n = i(r.find("tr[mdtype]")[e]);
                          if (n[0] == o[0] || !n.length) return void M();
                          t = n.offset();
                        }
                        i("#typora-table-row-insert-marker")
                          .width(r[0].offsetWidth)
                          .show()
                          .offset(t);
                      })((y = t));
                  })(e)
                : v &&
                  (function (e) {
                    if (!v) return;
                    var t;
                    i("#typora-table-col-tracker").css(
                      "left",
                      e.clientX - C - E
                    );
                    var n = r.scrollLeft();
                    (t = x.findIndex(function (t, i) {
                      return x[i] > e.clientX + n;
                    })) > 0 && (t -= 1);
                    -1 == t && (t = x.length - 1);
                    y != t &&
                      (function (e) {
                        var t;
                        if (e >= x.length - 1)
                          (t = r.offset()).left += r[0].offsetWidth;
                        else {
                          if (b == e || b + 1 == e) return void M();
                          t = N(e).offset();
                        }
                        r.find(".ty-table-edit").remove(),
                          i("#typora-table-col-insert-marker")
                            .height(r[0].offsetHeight)
                            .show()
                            .offset(t);
                      })((y = t));
                  })(e);
            }
            function M() {
              i(".typora-table-insert-marker").hide();
            }
            function L(e) {
              i("#write").addClass("no-selection"),
                e
                  ? (N(w).addClass("typora-on-moving"),
                    i("#typora-table-row-tracker").hide())
                  : (o.addClass("typora-on-moving"),
                    i("#typora-table-col-tracker").hide());
            }
            function N(e) {
              return r.find(
                "[mdtype='table_row']>*:nth-child(" + (e + 1) + ")"
              );
            }
            function D() {
              i("#write").removeClass("no-selection"),
                i("content").removeClass("prevent-scroll"),
                i(".typora-on-moving").removeClass("typora-on-moving"),
                M();
            }
            function B(e) {
              g
                ? (function (e) {
                    if (!g) return;
                    (g = !1), D(), p(), n.moveTableRow(b, y, r), R();
                  })()
                : v &&
                  (function (e) {
                    if (!v) return;
                    (v = !1),
                      D(),
                      p(),
                      n.moveTableCol(b, y, r),
                      n.showAlignCol(r),
                      R();
                  })();
            }
            function R() {
              (g = !1),
                (v = !1),
                (r = null),
                (o = null),
                (f = null),
                (b = null),
                (y = null);
            }
            setTimeout(function () {
              m = i("content").offset().top;
            }, 200),
              (S = i("#typora-table-row-tracker")),
              (k = i("#typora-table-col-tracker")),
              i(e.sessionStr).on("mouseenter click", "th, td", function (e) {
                if (0 != (f = i(this)).children("[mdtype]").length) {
                  (o = f.closest("tr")),
                    (r = o.closest("[mdtype='table']")),
                    (w = f.prevAll().length);
                  var t = o.offset(),
                    n = f.offset(),
                    a = r.offset();
                  S.show()
                    .offset(t)
                    .find(".typora-table-drag-area")
                    .height(o[0].offsetHeight + 1),
                    (n.top = a.top);
                  var s = r.width();
                  k.show()
                    .offset(n)
                    .find(".typora-table-drag-area")
                    .width(
                      Math.min(f[0].offsetWidth + 1, s - (a.left - n.left) - 1)
                    );
                }
              }),
              i(document)
                .on("mousedown", "#typora-table-row-tracker", T)
                .on("mousedown", "#typora-table-col-tracker", _)
                .on("mousemove", A)
                .on("mouseup", B);
          }
          updateInsertTableTouchBar() {
            File.isMac &&
              bridge.callHandler("touchBar.updateInsertTableTouchBar", [
                i("#table-insert-row").val() - 0,
                i("#table-insert-col").val() - 0,
              ]);
          }
          moveTableRow(e, t, n) {
            if (e != t && e + 1 != t) {
              n = n || this.editor.getMarkElem().closest("[mdtype='table']");
              var i = this.editor,
                r = i.selection.buildUndo(),
                o = s.makeEmptyCommand(r),
                l = i.findNodeByElem(n),
                c = l.getNthChild(e);
              i.undo.endSnap(!0),
                o.undo.push(s.buildReplaceUndo(l)),
                a.tryResetTable(l),
                e < --t && t--,
                c.detach(),
                t >= 0
                  ? l.getNthChild(t).addAfter(c)
                  : l.getFirstChild().addBefore(c),
                o.redo.push(s.buildReplaceUndo(l)),
                n.replaceWith(l.toHTML()),
                r &&
                  (i.undo.exeCommand(r), o.redo.push(i.selection.buildUndo())),
                i.undo.register(o),
                this.showTableEdit(l);
            }
          }
          moveTableCol(e, t, n) {
            n = n || this.editor.getMarkElem().closest(".md-table");
            var i = this.editor,
              r = i.selection.buildUndo(),
              o = s.makeEmptyCommand(r),
              l = i.findNodeByElem(n),
              c = l.getFirstChild();
            if ((i.undo.endSnap(!0), e != t && e + 1 != t)) {
              for (
                o.undo.push(s.buildReplaceUndo(l)),
                  a.tryResetTable(l),
                  e < --t && t--;
                c;

              ) {
                var d = c.getNthChild(e);
                d.detach(),
                  t >= 0
                    ? c.getNthChild(t).addAfter(d)
                    : c.getFirstChild().addBefore(d),
                  (c = c.get("after"));
              }
              var u = l.get("align").splice(e, 1)[0];
              l.get("align").splice(t + 1, 0, u),
                l.get("alignText") &&
                  ((u = l.get("alignText").splice(e, 1)[0]),
                  l.get("alignText").splice(t + 1, 0, u)),
                o.redo.push(s.buildReplaceUndo(l)),
                n.replaceWith(l.toHTML()),
                r &&
                  (i.undo.exeCommand(r), o.redo.push(i.selection.buildUndo())),
                i.undo.register(o),
                this.showTableEdit(l);
            } else this.showTableEdit(l);
          }
          moveRowUpOrDown(e) {
            var t = this.editor.selection.getRangy();
            if (t && !File.isLocked) {
              var n = i(t.commonAncestorContainer)
                .closest("[mdtype='table_row']")
                .closest("tr");
              if (0 != n.length) {
                var r = n.closest("thead").length ? 0 : n.prevAll().length + 1;
                if (!((e && 0 == r) || (!e && r && 0 == n.nextAll().length)))
                  return (
                    this.moveTableRow(
                      r,
                      e ? r - 1 : r + 2,
                      n.closest("[mdtype='table']")
                    ),
                    !0
                  );
              }
            }
          }
          moveColLeftOrRight(e) {
            var t = this.editor.selection.getRangy();
            if (t && !File.isLocked) {
              var n = i(t.commonAncestorContainer)
                .closest("[mdtype='table_cell']")
                .closest("td, th");
              if (0 != n.length) {
                var r = n.prevAll().length;
                if (!((e && 0 == r) || (!e && 0 == n.nextAll().length)))
                  return (
                    this.moveTableCol(
                      r,
                      e ? r - 1 : r + 2,
                      n.closest("[mdtype='table']")
                    ),
                    !0
                  );
              }
            }
          }
          insertTable() {
            File.isLocked ||
              document.body.classList.contains("modal-open") ||
              ((this.editor.lastCursor = this.editor.selection.buildUndo()),
              i("#table-insert-dialog").modal({ keyboard: !0 }),
              File.isMac &&
                bridge.callHandler("touchBar.showInsertTableTouchBar"),
              setTimeout(function () {
                i("#table-insert-col").focus();
              }, 500));
          }
          resizeTableEdit(e) {
            var t = e.parent().children(".ty-table-edit"),
              n = e.parent()[0].getBoundingClientRect(),
              i = t.length && t[0].getBoundingClientRect();
            t.length &&
              ((t[0].style.marginTop = "-" + i.height + "px"),
              (t[0].style.width = n.width + 10 + "px"));
          }
          showTableEdit(e) {
            var t = e,
              n = e;
            function r(e) {
              var t = [],
                n = i.localize.getString("Align Left"),
                r = i.localize.getString("Align Center"),
                o = i.localize.getString("Align Right"),
                a = i.localize.getString("Resize Table"),
                s = i.localize.getString("Delete Table"),
                l = i.localize.getString("More Actions", "Menu"),
                c =
                  '<span class="btn-group btn-group-xs md-align-gp"><button type="button" class="btn btn-default md-align-left" ty-hint="' +
                  n +
                  '" aria-label="' +
                  n +
                  '"><span class="ty-icon ty-left-alignment"></span></button><button type="button" class="btn btn-default md-align-center" ty-hint="' +
                  r +
                  '" aria-label="' +
                  r +
                  '"><span class="ty-icon ty-justify-align"></span></button><button type="button" class="btn btn-default md-align-right" ty-hint="' +
                  o +
                  '" aria-label="' +
                  o +
                  '"><span class="ty-icon ty-right-alignment"></span></button></span>';
              return (
                t.push(
                  "<div class='ty-table-edit md-table-edit md-tooltip-remove' contenteditable='false'>"
                ),
                t.push(
                  '<span class="md-th-button btn-group-xs md-resize-table-th"><button type="button" class="btn btn-default md-resize-table" ty-hint="' +
                    a +
                    '" aria-label="' +
                    a +
                    '"><span class="ty-icon ty-menu"></span></button></span>'
                ),
                t.push(c),
                t.push(
                  '<span class="md-th-button right-th-button btn-group-xs"><button type="button" class="btn btn-default md-delete-table" ty-hint="' +
                    s +
                    '" aria-label="' +
                    s +
                    '"><span class="ty-icon ty-delete"></span></button></span>'
                ),
                t.push(
                  '<span class="md-th-button right-th-button"><button type="button" class="btn btn-default md-table-more" aria-label="' +
                    l +
                    '"><span class="md-table-more-label">' +
                    l +
                    '</span><span class="ty-icon ty-dots-v" style="margin-left:8px;"></span></button></span>'
                ),
                t.push("</div>"),
                t.join("")
              );
            }
            e.jquery
              ? (t = this.editor.findNodeByElem(e))
              : (n = this.editor.findElemById(t.id)),
              n.children(".md-table").length && (n = n.children(".md-table")),
              n.prev(".ty-table-edit").length ||
                (i(".ty-table-edit").remove(), r(), n.before(r())),
              this.resizeTableEdit(n),
              this.showAlignCol(n);
          }
          showAlignCol(e) {
            var t = this.editor.selection.getRangy(),
              n = t && i(t.commonAncestorContainer).closest("td, th");
            if (n && n.length) {
              File.isMac || i(".md-table-more").show();
              var r = this.editor
                  .findNodeByElem(e.closest("[cid]"))
                  .get("align"),
                o = n.prevAll().length;
              !(function (t, n) {
                var i = e.closest("figure").find(".md-align-gp").show();
                i.find("button").removeClass("active"),
                  i.attr("data-col", t),
                  ("left" !== n && "right" !== n && "center" !== n) ||
                    i.find(".md-align-" + n).addClass("active");
              })(o, r[o]);
            } else i(".md-table-more").hide();
          }
          keydownHandler(e) {
            var t = e.keyCode || e.which;
            if ("Tab" === c[t] && !e.ctrlKey)
              return this.moveToNextCell(!0, e.shiftKey, void 0, !0), !1;
            if ("Enter" === c[t]) {
              var n = this.editor.UserOp.backspaceHandler(
                this.editor,
                null,
                "delSelection"
              );
              if (e.shiftKey)
                this.editor.UserOp.pasteHandler(this.editor, "<br />", !0);
              else if (File.isMacOrMacNode ? e.metaKey : e.ctrlKey) {
                var i = this.addRow(
                  !1,
                  this.editor.undo.commandStack.indexOf(n) > -1
                );
                s.append(n, i);
              } else this.moveToBelowCell(s.isEmptyCommand(n));
              return !1;
            }
          }
          moveToNextCell(e, t, n, i) {
            try {
              var r,
                o = this.editor.selection.getRangy(),
                a = this.editor
                  .getMarkElem(t ? o.startContainer : o.endContainer)
                  .closest("[mdtype='table_cell']")
                  .parent(),
                s = (t ? a.prev() : a.next()).children("[mdtype='table_cell']"),
                l = this.editor.selection;
              if (n) {
                var c = o.getBookmark(a[0]);
                if (t && c.start > 0)
                  return (
                    e ? l.extendToLineEdge(!1, a[0]) : l.jumpIntoElemBegin(a),
                    this.editor.refocus(),
                    !0
                  );
                if (!t && c.end < a.text().length)
                  return (
                    e ? l.extendToLineEdge(!0, a[0]) : l.jumpIntoElemEnd(a),
                    this.editor.refocus(),
                    !0
                  );
              }
              if (
                (!s.length &&
                  a.length &&
                  ((r = a.parent()),
                  (s = (
                    t ? r.prev().children(":last") : r.next().children(":first")
                  ).children("[mdtype='table_cell']")).length ||
                    (t && "TD" === a[0].tagName
                      ? (s = r
                          .closest("table")
                          .find("thead>tr>th:last>[mdtype='table_cell']"))
                      : t ||
                        "TH" !== a[0].tagName ||
                        (s = r
                          .closest("table")
                          .find(
                            "tbody>tr:first>td:first>[mdtype='table_cell']"
                          )))),
                s.focus(),
                s.length)
              ) {
                if (e)
                  if (n) {
                    var d = this.editor.selection.extendToLineEdge(
                      !t,
                      s[0],
                      !0
                    );
                    t
                      ? o.setStart(d.startContainer, d.startOffset)
                      : o.setEnd(d.endContainer, d.endOffset),
                      this.editor.selection.setRange(o);
                  } else this.editor.selection.selectAllElem(s);
                else
                  t
                    ? this.editor.selection.jumpIntoElemEnd(s)
                    : this.editor.selection.jumpIntoElemBegin(s);
                return this.editor.refocus(), !0;
              }
              if (i) return this.addRow(), !0;
            } catch (e) {}
          }
          moveToBelowCell(e, t, n) {
            try {
              var i = this.editor
                  .getMarkElem(window.getSelection().anchorNode)
                  .closest("[mdtype='table_cell']"),
                r = this.editor.findNodeByElem(i),
                o = h.getNextCellInColumn(r, t),
                a = o && this.editor.findElemById(o.cid);
              o
                ? a.length &&
                  (e
                    ? this.editor.selection.selectAllElem(a)
                    : t
                    ? this.editor.selection.jumpIntoElemEnd(a)
                    : this.editor.selection.jumpIntoElemBegin(a))
                : this.editor.selection.moveUpOrDown();
            } catch (e) {}
          }
          getSibling(e, t, n) {
            return h.getSibling(e, t, n);
          }
          unfocusAll(e) {
            e
              ? i(".ty-table-edit").fadeOut(function () {
                  i(".ty-table-edit").remove();
                })
              : i(".ty-table-edit").remove(),
              i(".typora-table-tracker").hide();
          }
          deleteRow() {
            h.deleteRow(this.editor);
          }
          addRow(e, t) {
            return h.addRow(this.editor, e, t);
          }
          deleteCol() {
            h.deleteCol(this.editor);
          }
          addCol(e) {
            h.addCol(this.editor, e);
          }
          copyTable() {
            var e = this.editor
              .getMarkElem(window.getSelection().anchorNode)
              .closest(".md-table-fig");
            if (e.length) {
              (e = e.clone()).find(".md-tooltip-remove").remove(),
                e.find("td, th").attr("style", function (e, t) {
                  return (
                    "border: 1px solid rgb(204, 204, 204);min-height:1ch;min-width:4ch;" +
                    (this.style.textAlign
                      ? "text-align:" + this.style.textAlign + ";"
                      : "")
                  );
                });
              var t = e.html(),
                n = this.editor.UserOp.prepMarkHtml(e[0].outerHTML, editor),
                i = this.editor.UserOp.getMarkdownSourceFrom(n.html());
              this.editor.UserOp.setClipboard(t, n.html(), i, !0);
            }
          }
          deleteTable(e, t) {
            if (
              (p(),
              i("#ty-tooltip").hide(),
              (e =
                e ||
                editor
                  .getMarkElem(window.getSelection().anchorNode)
                  .closest("[mdtype='table']")).attr("cid"))
            ) {
              this.editor.undo.endSnap(!0);
              var n = this.editor.getNode(e.attr("cid")),
                r = editor.undo.UndoManager.makeEmptyCommand(
                  this.editor.selection.buildUndo()
                ),
                a = n.get("after"),
                l = n.get("before");
              return (
                a || l
                  ? (s.addUndoForRemove(r, n), n.remove(), e.remove())
                  : (r.undo.push(s.buildReplaceUndo(n)),
                    n.set("type", o.paragraph),
                    n.set("text", ""),
                    n.clearChildren(),
                    e.replaceWith(n.toHTML()),
                    r.redo.push(s.buildReplaceUndo(n))),
                (editor.focusCid = null),
                a
                  ? this.editor.selection.jumpIntoElemBegin(
                      this.editor.findElemById(a.id)
                    )
                  : this.editor.selection.jumpIntoElemEnd(
                      this.editor.findElemById((l || n).id)
                    ),
                (this.editor.lastCursor = null),
                r.redo.push(this.editor.selection.buildUndo()),
                !t && this.editor.undo.register(r),
                r
              );
            }
          }
          isTableEmpty(e) {
            function t(e) {
              for (var t = 0, n = e.get("children").length; t < n; t++)
                if (e.get("children").at(t).get("text")) return !1;
              return !0;
            }
            for (var n = 0, i = e.get("children").length; n < i; n++)
              if (!t(e.get("children").at(n))) return !1;
            return !0;
          }
          reformatTable(e) {
            if (
              (e =
                e ||
                editor
                  .getMarkElem(window.getSelection().anchorNode)
                  .closest("[mdtype='table']")).length
            ) {
              editor.undo.endSnap(!0);
              var t = this.editor.getNode(e.attr("cid")),
                n = editor.undo.UndoManager.makeEmptyCommand(
                  this.editor.selection.buildUndo()
                );
              n.undo.push(s.buildReplaceUndo(t)),
                t.set("userText", void 0),
                t.set("style", void 0),
                t.set("alignText", void 0);
              for (var i = t.getFirstChild(); i; ) {
                for (var r = i.getFirstChild(); r; )
                  r.set("marginRight", void 0),
                    r.set("marginLeft", void 0),
                    (r = r.get("after"));
                i = i.get("after");
              }
              n.redo.push(s.buildReplaceUndo(t)),
                n.redo.push(this.editor.selection.buildUndo()),
                this.editor.undo.register(n);
            }
          }
        }
        function p() {
          i("#typora-table-row-tracker, #typora-table-col-tracker")
            .hide()
            .find(".typora-table-data-area")
            .html("");
        }
        (h.deleteRow = function (e) {
          e.undo.endSnap(!0), i(".md-tooltip-hide").hide();
          var t,
            n,
            r,
            o = e
              .getMarkElem(window.getSelection().anchorNode)
              .closest("td,th"),
            s = e
              .getMarkElem(window.getSelection().anchorNode)
              .closest("tr[mdtype='table_row']"),
            l = s.prevAll().length,
            c = e.findNodeByElem(s);
          if (c && (c.get("before") || c.get("after"))) {
            (n = c.get("parent")),
              (t = e.undo.UndoManager.makeEmptyCommand()).undo.push(
                e.selection.buildUndo()
              ),
              t.undo.push(e.undo.UndoManager.buildReplaceUndo(n)),
              a.tryResetTable(n);
            var d = !c.get("before");
            c.get("after") || l--,
              c.remove(),
              t.redo.push(e.undo.UndoManager.buildReplaceUndo(n)),
              e.findElemById(n.id).replaceWith(n.toHTML()),
              (r = document.createRange());
            try {
              d || l < 0
                ? r.setStart(
                    e
                      .findElemById(n.id)
                      .find(
                        "thead th:nth-child(" +
                          (o.prevAll().length + 1) +
                          ")>span"
                      )[0],
                    0
                  )
                : r.setStart(
                    e
                      .findElemById(n.id)
                      .find(
                        "tbody>tr:nth-child(" +
                          (l + 1) +
                          ")>td:nth-child(" +
                          (o.prevAll().length + 1) +
                          ")>span"
                      )[0],
                    0
                  ),
                window.getSelection().removeAllRanges(),
                window.getSelection().addRange(r),
                t.redo.push(e.selection.buildUndo());
            } catch (e) {}
            e.undo.register(t), e.tableEdit.showTableEdit(n);
          }
        }),
          (h.addRow = function (e, t, n) {
            e.undo.endSnap(!0), i(".md-tooltip-hide").hide();
            var r,
              o,
              s = e
                .getMarkElem(window.getSelection().anchorNode)
                .closest("tr[mdtype='table_row']"),
              l = "TBODY" == (s.parent()[0] || {}).tagName,
              c = l ? s.prevAll().length + 1 : 0,
              d = e.undo.UndoManager.makeEmptyCommand(),
              u = e.findNodeByElem(s);
            if (!u) return d;
            (r = u.get("parent")),
              d.undo.push(e.selection.buildUndo()),
              d.undo.push(e.undo.UndoManager.buildReplaceUndo(r)),
              a.tryResetTable(r),
              (o = r.getNthChild(c)),
              (o = h.newEmptyRowAfter(
                t ? o.get("before") : o,
                o.get("children").length,
                r,
                t ? o : o.get("after")
              )),
              l
                ? s[t ? "before" : "after"](o.toHTML())
                : e.findElemById(r.id).replaceWith(r.toHTML());
            var p = e.findElemById(o.getFirstChild().id);
            return (
              e.selection.jumpIntoElemBegin(p),
              e.selection.scrollAdjust(),
              d.redo.push(e.undo.UndoManager.buildReplaceUndo(r)),
              d.redo.push(e.selection.buildUndo()),
              !n && e.undo.register(d),
              e.tableEdit.showTableEdit(r),
              d
            );
          }),
          (h.addCol = function (e, t) {
            e.undo.endSnap(!0), i(".md-tooltip-hide").hide();
            var n,
              r,
              o = e
                .getMarkElem(window.getSelection().anchorNode)
                .closest("td, th"),
              s = o.find("[cid]").attr("cid"),
              l = o.prevAll().length;
            if (o.length) {
              if (
                ((r = e
                  .findNodeByElem(o.children("[cid]"))
                  .get("parent")
                  .get("parent")),
                (n = e.undo.UndoManager.makeEmptyCommand()).undo.push(
                  e.selection.buildUndo()
                ),
                n.undo.push(e.undo.UndoManager.buildReplaceUndo(r)),
                a.tryResetTable(r),
                r
                  .get("children")
                  .toArray()
                  .map(function (e) {
                    var n = e.getNthChild(l),
                      i = new a({
                        type: a.TYPE.table_cell,
                        text: "",
                        marginLeft: n.get("marginLeft"),
                        marginRight: n.get("marginRight"),
                      });
                    t ? n.addBefore(i) : n.addAfter(i);
                  }),
                r.get("align").splice(t ? l : l + 1, 0, null),
                r.get("alignText"))
              ) {
                var c = a.adjustAlignText(r, 0, null);
                r.get("align").splice(t ? l : l + 1, 0, c);
              }
              e.findElemById(r.id).replaceWith(r.toHTML()),
                (o = e.findElemById(s).closest("th, td")),
                e.selection.jumpIntoElemBegin(t ? o.prev() : o.next()),
                n.redo.push(e.undo.UndoManager.buildReplaceUndo(r)),
                e.undo.register(n),
                e.tableEdit.showTableEdit(r);
            }
          }),
          (h.deleteCol = function (e) {
            e.undo.endSnap(!0), i(".md-tooltip-hide").hide();
            var t,
              n,
              r = e
                .getMarkElem(window.getSelection().anchorNode)
                .closest("td, th"),
              o = r.prevAll().length,
              s = r.nextAll().length,
              l = r.closest("tr"),
              c = "TBODY" == l.parent()[0].tagName ? l.prevAll().length + 1 : 0;
            if (o || s) {
              (n = e
                .findNodeByElem(r.children("[cid]"))
                .get("parent")
                .get("parent")),
                (t = e.undo.UndoManager.makeEmptyCommand()).undo.push(
                  e.selection.buildUndo()
                ),
                t.undo.push(e.undo.UndoManager.buildReplaceUndo(n)),
                a.tryResetTable(n),
                n
                  .get("children")
                  .toArray()
                  .map(function (e) {
                    e.getNthChild(o).remove();
                  }),
                n.get("align").splice(o, 1),
                n.get("alignText") && n.get("alignText").splice(o, 1),
                e.findElemById(n.id).replaceWith(n.toHTML());
              var d = document.createRange();
              try {
                c
                  ? d.setStart(
                      e
                        .findElemById(n.id)
                        .find(
                          "tbody>tr:nth-child(" +
                            c +
                            ")>td:nth-child(" +
                            (o + 1) +
                            ")>span"
                        )[0],
                      0
                    )
                  : d.setStart(
                      e
                        .findElemById(n.id)
                        .find(
                          "thead>tr[mdtype]>th:nth-child(" + (o + 1) + ")>span"
                        )[0],
                      0
                    ),
                  window.getSelection().removeAllRanges(),
                  window.getSelection().addRange(d),
                  t.redo.push(e.selection.buildUndo());
              } catch (e) {}
              t.redo.push(e.undo.UndoManager.buildReplaceUndo(n)),
                e.undo.register(t),
                e.tableEdit.showTableEdit(n);
            }
          }),
          (h.getSibling = function (e, t, n) {
            if (a.isType(e, a.TYPE.table_cell)) {
              t = t || "after";
              var i = e.get(t),
                r = e.get("parent").get(t);
              return (
                i ||
                  !r ||
                  n ||
                  (i = "after" == t ? r.getFirstChild() : r.getLastChild()),
                i
              );
            }
          }),
          (h.getColumnIndex = function (e) {
            return e.get("before") ? 1 + h.getColumnIndex(e.get("before")) : 0;
          }),
          (h.getCellAt = function (e, t) {
            if (a.isType(e, a.TYPE.table_row)) {
              for (var n = e.getFirstChild(); t > 0; )
                t--, (n = n.get("after"));
              return n;
            }
          }),
          (h.getNextCellInColumn = function (e, t, n) {
            if (a.isType(e, a.TYPE.table_cell)) {
              (n = n || h.getColumnIndex(e)), (t = t || "after");
              var i = e.get("parent").get(t);
              return i ? h.getCellAt(i, n) : void 0;
            }
          }),
          (h.resizeRow = function (e, t) {
            var n,
              i = e.getFirstChild(),
              r = 0,
              o = e.get("before"),
              s = o ? o.getFirstChild() : null,
              l = e.get("parent");
            function c(e) {
              return e.length > 1 ? e[0] : e;
            }
            a.tryResetTable(l);
            for (var d = Math.max(t, e.get("children").length); r < d; )
              r < t
                ? (i ||
                    ((i = new a({
                      type: a.TYPE.table_cell,
                      in: e.get("in"),
                      parent: e,
                      before: n,
                    })),
                    s && void 0 !== s.get("marginLeft")
                      ? (i.set("marginLeft", c(s.get("marginLeft"))),
                        i.set("marginRight", c(s.get("marginRight"))))
                      : !o &&
                        n &&
                        void 0 !== n.get("marginLeft") &&
                        (i.set("marginLeft", c(n.get("marginLeft"))),
                        i.set("marginRight", c(n.get("marginRight")))),
                    l.get("alignText") &&
                      !l.get("alignText")[r] &&
                      (l.get("alignText")[r] = a.adjustAlignText(l, 0, null))),
                  (i = (n = i).get("after")))
                : i && ((i = (n = i).get("after")), n.remove()),
                r++,
                s && (s = s.get("after"));
          }),
          (h.newEmptyRowAfter = function (e, t, n, i) {
            var r = new a({
              type: a.TYPE.table_row,
              in: n.get("in"),
              parent: n,
              before: e,
              after: e ? e.get("after") : i || null,
            });
            return h.resizeRow(r, t), r;
          }),
          (h.verify = function (e, t, n, i) {
            var r;
            if (
              ((n = n || 1),
              void 0 === t &&
                (t = (t = e.get("children").at(0))
                  ? t.get("children").length
                  : 1),
              i && 1 == e.get("children").length && 1 == t)
            ) {
              var o = e.get("children").at(0);
              o.get("children").length
                ? i(e, o.get("children").at(0).get("text"))
                : i(e, o.get("text"));
            } else {
              e.get("children").map(function (e) {
                for (var n = e.get("children").length, i = n; i < t; i++)
                  i === n && (r = e.getLastChild()),
                    (r = new a({
                      type: a.TYPE.table_cell,
                      parent: e,
                      in: e.get("in"),
                      before: r,
                      text: "",
                    }));
              });
              for (var s = e.get("children").length; s < n; s++)
                h.newEmptyRowAfter(e.get("children").at(s - 1), t, e);
              !e.get("align") && t > 0 && e.set("align", Array(t - 0).fill());
            }
          }),
          (a.TableEdit = h),
          (n.exports = h);
      }
    ),
    $__System.registerDynamic("33", ["11", "32", "34"], !0, function (e, t, n) {
      this || self;
      var i = e("11"),
        r = e("32"),
        o = e("34");
      const a = {
        version: 2,
        type: "net.daringfireball.markdown",
        transient: !1,
        creatorIdentifier: "io.appmakes.Typora",
      };
      var s = {
        NotMarkdownError: "NotMarkdown",
        quickGetContent: async function (e, t) {
          var n = reqnode("fs").promises;
          try {
            var i = await n.readFile(e);
            return o.saveToRecover(i, "overwrite"), i.toString("utf8");
          } catch (e) {
            if (t) throw e;
            return "";
          }
        },
        isFileSync: function (e) {
          try {
            let t = reqnode("fs").statSync(e);
            return t.isFile() || t.isDirectory() || /\.textbundle$/.exec(e);
          } catch (e) {
            return !1;
          }
        },
        getTextFile: function () {
          return File.bundle.filePath
            ? File.isTextBundle()
              ? File.bundle.filePath +
                (File.isWin ? "\\" : "/") +
                File.bundle.textFile
              : File.bundle.filePath
            : null;
        },
        deletedAssetsMap: function () {
          return File.isTextBundle()
            ? ((File.bundle.deletedAssetsMap =
                File.bundle.deletedAssetsMap || {}),
              File.bundle.deletedAssetsMap)
            : {};
        },
        saveAssetsBeforeDelete: async function (e) {
          if (File.isNode && File.isTextBundle()) {
            var t = reqnode("fs-extra"),
              n = s.deletedAssetsMap(),
              i = File.isWin ? "\\" : "/",
              r = File.bundle.filePath + i + "assets",
              a = await o.textBundleDraftFolder();
            if (a) {
              var l = a + i + "assets" + i + e;
              await t.move(r + i + e, l, { overwrite: !0 }), (n[e] = l);
            }
          }
        },
        getAllUsedAssets: function () {
          var e = new Set();
          if (!File.isTextBundle()) return e;
          var t = document.querySelector("#write");
          return (
            t.querySelectorAll("[src]").forEach((t) => {
              var n = i.absolutePathFrom(t.src);
              s.shouldManageResource(n) && e.add(n);
            }),
            t.querySelectorAll("[data-src]").forEach((t) => {
              var n = i.absolutePathFrom(
                File.editor.imgEdit.getRealSrc(t.dataset.src)
              );
              /^assets[\/\\]/.exec(t.dataset.src)
                ? e.add(n)
                : s.shouldManageResource(n) && e.add(n);
            }),
            t.querySelectorAll("[href]").forEach((t) => {
              var n = t.getAttribute("href"),
                r = i.ensureAbsolutePath(
                  File.bundle.filePath || File.bundle.originalPath,
                  n,
                  !0
                );
              (r = i.absolutePathFrom(r)),
                /^assets[\/\\]/.exec(n)
                  ? e.add(r)
                  : s.shouldManageResource(r) && e.add(r);
            }),
            e
          );
        },
        findUnusedAssets: async function () {
          if (!File.isNode || !File.isTextBundle() || !File.bundle.filePath)
            return [];
          var e = s.getAllUsedAssets(),
            t = reqnode("fs").promises,
            n = new Set(),
            i = File.isWin ? "\\" : "/",
            r = File.bundle.filePath + i + "assets";
          try {
            (await t.readdir(r)).forEach((t) => {
              e.has(r + i + t) || n.add(t);
            });
          } catch (e) {}
          return n;
        },
        recordUnusedAssets: async function () {
          const e = await s.findUnusedAssets();
          File.bundle.unusedAssets = Array.from(e || []);
        },
        removeUnusedAssets: async function () {
          if (!File.isNode || !File.isTextBundle()) return;
          const e = await s.findUnusedAssets();
          await Promise.all(
            Array.from(e).map((e) => {
              if (-1 == (File.bundle.unusedAssets || []).indexOf(e))
                return s.saveAssetsBeforeDelete(e);
            })
          );
        },
        isEmptyFile: async function (e) {
          if (File.isNode) {
            try {
              var t = reqnode("fs-extra"),
                n = await t.stat(e);
              if (!/\.textbundle$/.exec(e)) return 0 == n.size;
              if (n.isDirectory())
                return (
                  0 ==
                  (n = await t.stat(e + (File.isWin ? "\\" : "/") + "text.md"))
                    .size
                );
            } catch (e) {
              console.warn(e);
            }
            return !1;
          }
        },
        shouldManageResource: function (e) {
          if (e && File.isTextBundle()) {
            var t = File.isWin ? "\\" : "/",
              n = File.bundle.filePath + t + "assets" + t;
            if (0 === e.indexOf(n)) {
              var i = e.substring(n.length);
              if (!/[\/\\]/.exec(i)) return i;
            }
          }
          return !1;
        },
        findTextFile: async function (e) {
          var t = reqnode("fs").promises,
            n = reqnode("path");
          try {
            let o = await t.readdir(e);
            for (var i of o)
              if (/^text\./.exec(i)) {
                var r = i.match(/(?:^|\.)([^.]+)$/);
                if (
                  ((r = (r[1] || "").toLowerCase()),
                  ~File.SupportedTextFiles.indexOf(r) &&
                    (await t.stat(n.join(e, i))).isFile())
                )
                  return i;
              }
            return null;
          } catch (e) {}
        },
        isTextBundle(e) {
          if (!e) return !1;
          return "textbundle" === r.getExtension(e).toLowerCase();
        },
        makeTextBundleSkeleton: async function (e) {
          const t = File.isWin ? "\\" : "/",
            n = reqnode("fs-extra");
          await n.ensureDir(e + t + "assets"),
            await n.writeFile(e + t + "info.json", JSON.stringify(a), "utf8");
        },
        async bundleAssetsIsEmpty(e) {
          const t = File.isWin ? "\\" : "/",
            n = reqnode("fs").promises;
          try {
            return 0 === (await n.readdir(e + t + "assets")).length;
          } catch (e) {}
          return !0;
        },
        loadFile: async function (e) {
          var t = reqnode("fs").promises,
            n = reqnode("path");
          let [i, r] = await Promise.all([
            (async function () {
              try {
                let i = n.join(e, "info.json");
                return JSON.parse(await t.readFile(i, "utf8"));
              } catch (e) {
                return {};
              }
            })(),
            s.findTextFile(e),
          ]);
          if (!r) throw new Error(s.NotMarkdownError);
          let o = await t.readFile(n.join(e, r), "utf8");
          return (
            (File.bundle = {
              fileEncode: "utf8",
              filePath: e,
              savedContent: o,
              modifiedDate: new Date(),
              type: File.FileType.TextBundle,
              textFile: r,
            }),
            o
          );
        },
      };
      n.exports = s;
    }),
    $__System.registerDynamic(
      "30",
      ["11", "13", "28", "32", "33", "16", "17", "29"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("13"),
          o = e("28"),
          a = e("32"),
          s = e("33"),
          l = e("16"),
          c = e("17"),
          d = e("29"),
          u = (r.Node, r.TYPE);
        (window.failImgCache = []), (window.loadedImgCache = []);
        var h = 0;
        window.removeLastModifyQuery = function (e) {
          return (e || "").replace(/\?lastModify=(.+)$/, "");
        };
        var p = function (e) {
            return i.escapeForPreWrap(e);
          },
          f = function (e, t) {
            if (/%[0-9a-f]{2}/i.exec(e))
              return e.replace(/'/g, "%27").replace(/"/g, "%22");
            var n = (e = (e || "").trim());
            try {
              n = decodeURI(e);
            } catch (t) {
              n = e;
            }
            try {
              /^file:/.exec(n) && (n = n.replace(/\\/g, "/")),
                (n = encodeURI(n).replace(/'/g, "%27").replace(/"/g, "%22"));
            } catch (t) {
              console.sendError("unable to process escapeURL " + e, "warning"),
                (n = (n || "")
                  .replace(/\\/g, "/")
                  .replace(/'/g, "%27")
                  .replace(/"/g, "%22"));
            }
            if (t) {
              var i = (/[#?][^\/\\\.]*$/.exec(n) || [""])[0];
              return n.substr(0, n.length - i.length).replace(/#/g, "%23") + i;
            }
            return n;
          };
        (window.onImageLoadedFunc = function (e) {
          var t = e.target;
          if (document.body.contains(t) && !t.dataset.realSrc) {
            var n = window.removeLastModifyQuery(t.getAttribute("src")) || "";
            n.trim() &&
              ((n = n.replace(/^wkfile:/i, "file:")),
              -1 == loadedImgCache.indexOf(n) &&
                n.trim().length &&
                loadedImgCache.push(n),
              setTimeout(function () {
                t.setAttribute("onload", "onLoadedFuncForQuickAction(event)");
              }, 10),
              $(t)
                .closest(".md-image")
                .addClass("md-img-loaded")
                .removeClass("md-img-error"),
              t.dataset.localRefresh ||
                (t.getAttribute("aftermove") &&
                  ((t.style.background = ""),
                  (t.style.width = ""),
                  (t.style.height = ""),
                  t.removeAttribute("aftermove")),
                imagePreLoadAfterMove[n]
                  ? setTimeout(function () {
                      delete imagePreLoadAfterMove[n];
                    }, 200)
                  : File.editor.imgEdit.afterUserInsertImage(t),
                File.editor.imgEdit.tryAddImageToBusyLoader(t),
                File.editor.tryEnterBusyModeWithDelay()));
          }
        }),
          (window.onImageErrorFunc = function (e) {
            var t = e.target;
            if (document.body.contains(t)) {
              var n = window.removeLastModifyQuery(t.getAttribute("src")) || "";
              n.trim() &&
                ((n = n.replace(/^wkfile:/i, "file:")),
                failImgCache.length > 5e3 && (failImgCache = []),
                -1 == failImgCache.indexOf(n) &&
                  n.trim().length &&
                  failImgCache.push(n),
                loadedImgCache.remove(n),
                $(t)
                  .closest(".md-image")
                  .addClass("md-img-error")
                  .removeClass("md-img-loaded"),
                File.editor.imgEdit.removeUploadingStyle($(t)),
                window.uploadImageQueue.delete(n),
                window.moveImageQueue.delete(n),
                t.setAttribute("onerror", null));
            }
          }),
          (window.onLoadedFuncForQuickAction = function (e) {
            var t = e.target;
            if (document.body.contains(t) && !t.dataset.realSrc) {
              var n = window.removeLastModifyQuery(t.getAttribute("src"));
              imagePreLoadAfterMove[n] &&
                setTimeout(function () {
                  delete imagePreLoadAfterMove[n];
                }, 200),
                $(t).closest(".md-image").addClass("md-img-loaded"),
                File.editor.imgEdit.afterUserInsertImage(t),
                File.editor.imgEdit.tryAddImageToBusyLoader(t);
            }
          });
        function m(e) {
          return (
            /^file:/.exec(e) &&
              !/\?.+/.exec(e) &&
              (e = e + "?lastModify=" + window._lastFocusTimeMark),
            e
          );
        }
        function g(e, t, n, r) {
          var o,
            a,
            s,
            d,
            h,
            m,
            g = e.type,
            y = File.editor,
            b = "",
            w = t.indexOf("\n") > -1 ? " md-image-multi-line " : "",
            x = !1;
          function C(e) {
            return !x || e.length < 100
              ? e
              : e.substr(0, 20) +
                  "<span class='ty-text-ellipsis' data-hidden-text='" +
                  e.substr(20, e.length - 80) +
                  "' ></span>" +
                  e.substr(e.length - 80);
          }
          if (
            ((h = (
              r
                ? ((m = 0 == r[1].trim().length),
                  "<span class='md-image-before-src ty-focusable'>" +
                    i.escape(r[0]) +
                    "</span><span class='md-image-src-span ty-focusable'>" +
                    (m
                      ? "<span class='md-image-btn ty-focusable-btn md-image-input-src-btn' content='" +
                        $.localize.getString("input image URL", "Front") +
                        "'></span><span class='md-image-btn ty-focusable-btn md-image-pick-file-btn' ty-hint='" +
                        $.localize.getString(
                          "Select image from local file",
                          "Front"
                        ) +
                        "'></span>"
                      : C(i.escape(r[1]))) +
                    "</span><span class='md-image-after-src'>" +
                    i.escape(r[2]) +
                    "</span>")
                : C(i.escape(t))
            ).replace(/\u00a0/g, " ")),
            g == u.refimg)
          ) {
            if (
              ((a = n),
              (o = y.nodeMap.link_list.getHrefByRef(a) || ""),
              (b = " data-ref='" + p(a) + "' "),
              !o)
            )
              return (
                "<span md-inline='refimg' class='md-image md-no-ref" +
                w +
                "' " +
                b +
                "><span class='md-meta md-before md-content' contenteditable='true' data-hint='" +
                $.localize
                  .getString(
                    "Please define image reference by \n[{0}]: http://example.png"
                  )
                  .format(p(a)) +
                "' >" +
                h +
                "</span></span>"
              );
          } else o = n;
          var F = null;
          g == u.imgtag
            ? "BODY" ==
                (F = l.sanitize(t, c.getDomPurifyConfig(c.INLINE_CONFIG)))
                  .tagName &&
              (F = F.children[0] || document.createElement("img"))
            : (F = document.createElement("img")),
            F.setAttribute("referrerPolicy", "no-referrer"),
            (o = (o || "").trim());
          var S = " data-src='" + i.escapeForPreWrap(o) + "' ",
            k = y.imgEdit.getRealSrc(o, void 0, !0, !0),
            E = i.absolutePathFrom(k),
            T = /^data:/.exec(k),
            _ = /^file:\/\//i.exec(k || ""),
            A = k,
            M = imagePreLoadAfterMove[k.replace(/\\/g, "/")];
          if (
            (e.title && F.setAttribute("title", e.title),
            e.alt && F.setAttribute("alt", e.alt),
            T
              ? (S = " data-is-data-src='true' ")
              : _ && (A = A.replace(/\\/g, "/")),
            (k = f(A, !0)),
            _ && (k += "?lastModify=" + imgLastModified),
            !T &&
              /\.svg([#?][^\/\\]*)*$/i.exec(o) &&
              F.classList.add("md-svg-img"),
            i.fromExternalPath(k) && (k = "wk" + k),
            T ||
              loadedImgCache.indexOf(A) > -1 ||
              loadedImgCache.indexOf(f(A, !0)) > -1)
          )
            F.setAttribute("src", k),
              F.setAttribute("onerror", "onImageErrorFunc(event)"),
              F.setAttribute("onload", "onLoadedFuncForQuickAction(event)"),
              (s =
                "<span md-inline='" +
                g +
                "'" +
                S +
                " contenteditable='false' class='md-image md-img-loaded" +
                w +
                "' " +
                b +
                "><span class='md-meta md-before md-content' contenteditable='true'>" +
                h +
                "</span>" +
                F.outerHTML +
                "</span>");
          else if (failImgCache.indexOf(A) > -1)
            F.setAttribute("src", ""),
              (s =
                "<span md-inline='" +
                g +
                "'" +
                S +
                " contenteditable='false' class='md-image md-img-error" +
                w +
                "' " +
                b +
                "><span class='md-meta md-content md-before' contenteditable='true'>" +
                h +
                "</span>" +
                F.outerHTML +
                "</span>");
          else {
            var L = "";
            !(F.getAttribute("style") || "").trim().length &&
              M &&
              (F.setAttribute(
                "style",
                F.getAttribute("style") +
                  ";" +
                  M.size +
                  ";background-image:url('" +
                  f(M.src, !0) +
                  "');"
              ),
              F.setAttribute("aftermove", "true"),
              (L = " md-img-loaded")),
              (L += w),
              F.setAttribute("src", k),
              F.setAttribute("onerror", "onImageErrorFunc(event)"),
              F.setAttribute("onload", "onImageLoadedFunc(event)"),
              (s =
                "<span md-inline='" +
                g +
                "'" +
                S +
                " contenteditable='false' class='md-image" +
                L +
                "' data-src='" +
                k +
                "' " +
                b +
                "><span class='md-meta md-before md-content' contenteditable='true'>" +
                h +
                "</span>" +
                F.outerHTML +
                "</span>");
          }
          return (
            g == u.image &&
              -1 == failImgCache.indexOf(i.wkfile2file(k)) &&
              (window.uploadImageQueue.has(E)
                ? (v((d = $(s)), E, !1), (s = d[0].outerHTML))
                : window.moveImageQueue.has(E) &&
                  (v((d = $(s)), E, !0), (s = d[0].outerHTML))),
            s
          );
        }
        function v(e, t, n, i) {
          function r() {
            var t = n
              ? "md-img-loaded md-on-moving"
              : "md-img-loaded md-on-uploading";
            e.addClass(t),
              e.append(
                $("#typora-uploading-image-templ")
                  .html()
                  .replace(/\s*\n\s*/g, "")
              );
          }
          i
            ? setTimeout(function () {
                (n ? moveImageQueue : uploadImageQueue).has(t) &&
                  document.body.contains(e[0]) &&
                  r();
              }, 1e3)
            : r(),
            e.attr("data-origin-path", t);
        }
        (window.addDateQuery = m),
          (t.applyUploadingStyle = v),
          (t.decorateAsExport = function (e, t, n) {
            var r, l, h, g, v;
            function y(e, n) {
              if (((e = (e || "").trim()), n && !i.isFullUrl(e)))
                return "http://" + e;
              if (t.forPrint) {
                if (e.match(/^#/)) {
                  var r = o.findAnchorElem(e, !0);
                  return (r || []).length
                    ? (File.isMac ? "at://" : "#header-") + r.attr("cid")
                    : e;
                }
                if (
                  !i.isFullUrl(e) &&
                  ((e = e.trim().replace(/([#?][^.]+)$/, "")), File.isNode)
                ) {
                  var l = reqnode("fs-plus"),
                    c = reqnode("path").resolve(
                      a.getCurrentFileFolderPath() + "/",
                      e
                    );
                  return s.isFileSync(c)
                    ? "file://" + c
                    : l.isFileSync(c + ".md")
                    ? "file://" + c + ".md"
                    : l.isFileSync(c + ".markdown")
                    ? "file://" + c + ".markdown"
                    : l.isFileSync(c + ".pdf")
                    ? "file://" + c + ".pdf"
                    : "http://" + e;
                }
              } else if (e.match(/^#/))
                return o.normalizeAnchor(e, t.anchorList, !t.noStyle);
              return e;
            }
            switch (e.type) {
              case u.strong:
                return "<strong>" + e.inner + "</strong>";
              case u.em:
                return "<em>" + e.inner + "</em>";
              case u.plain:
                return t.noStyle
                  ? i.escape(e.text)
                  : "<span>" + i.escape(e.text) + "</span>";
              case u.softbreak:
                return "\n";
              case u.code:
                return (
                  t.forPrint && File.isNode
                    ? (t.defaultFont ||
                        (t.defaultFont =
                          window.getComputedStyle(File.editor.writingArea)
                            .fontFamily || "initial"),
                      (r =
                        "<code>" +
                        e.text
                          .trim()
                          .split(/([\-;]+)/)
                          .map(function (e) {
                            return e ? i.escape(e, !1, !0) : "";
                          })
                          .join("") +
                        "</code>"))
                    : (r =
                        "<code>" + i.escape(e.text.trim(), !1, !0) + "</code>"),
                  r
                );
              case u.del:
                return "<del>" + e.inner + "</del>";
              case u.autolink:
              case u.url:
                return (
                  "<a href='" +
                  p(y(e.href, !0)) +
                  "' target='_blank' class='url'>" +
                  e.text +
                  "</a>"
                );
              case u.tag:
                if (/^<img/.test(e.text) && t.forPrint) {
                  if (
                    (l = (/src\s*=\s*(['"])((.|\n)*?)\1/.exec(e.text) || [])[2])
                  )
                    return (
                      (l = File.editor.imgEdit
                        .getRealSrc(l, void 0, !0, !0)
                        .replace(/^file:\/\/\/?/i, "file:///")
                        .replace(/\\/g, "/")),
                      e.text.replace(
                        /(\ssrc\s*=\s*)(['"])([^"']*)(\2)/,
                        "$1$2" + l + "$4"
                      )
                    );
                  if (
                    (l = (/src\s*=\s*([^\s'"]+)(\s|$)/.exec(e.text) || [])[1])
                  )
                    return (
                      (l = File.editor.imgEdit
                        .getRealSrc(l, void 0, !0, !0)
                        .replace(/^file:\/\/\/?/i, "file:///")
                        .replace(/\\/g, "/")),
                      e.text.replace(
                        /src\s*=\s*([^\s'"]+)(\s|$)/,
                        "src='" + l + "' "
                      )
                    );
                }
                return e.text;
              case u.br:
              case u.imgtag:
              case u.ruby:
                return c.buildHTMLForExport(e.text, File.editor, t.forPrint);
              case u.html_inline:
                return c.buildHTMLForExport(
                  e.before + e.after,
                  File.editor,
                  t.forPrint
                );
              case u.link:
                return (
                  "<a href='" +
                  p(y(e.href)) +
                  "'" +
                  (e.title ? " title='" + p(e.title) + "'" : "") +
                  ">" +
                  e.inner +
                  "</a>"
                );
              case u.image:
                if (
                  ((l = t.forPrint
                    ? File.editor.imgEdit.getRealSrc(e.href)
                    : e.href),
                  t.forPrint && failImgCache.indexOf(l) > -1)
                )
                  r = "";
                else {
                  l = t.forPrint ? m(f(l, !0)) : p(l);
                  var b = $(
                    "<img src='" + l + "' referrerPolicy='no-referrer' />"
                  )[0];
                  e.alt && b.setAttribute("alt", e.alt),
                    e.title && b.setAttribute("title", e.title),
                    (r = b.outerHTML);
                }
                return (
                  !t.noStyle &&
                    e.onlyChild &&
                    (r = "<span class='md-image'>" + r + "</span>"),
                  r
                );
              case u.footnote:
                if ((v = t.nodeMap.foot_list.getNodeByRef(e.text))) {
                  var w,
                    x = t.footnoteList.indexOf(e.text) + 1;
                  return (
                    0 == x &&
                      (t.footnoteList.push(e.text),
                      (x = t.footnoteList.length)),
                    (r =
                      "<sup class='md-footnote'><a href='#dfref-footnote-" +
                      (w = t.appendFootnote(v, x)) +
                      "' name='ref-footnote-" +
                      w +
                      "'>" +
                      x +
                      "</a></sup>")
                  );
                }
                return t.noStyle
                  ? i.escape(e.text)
                  : "<span>[^" + i.escape(e.text) + "]</span>";
              case u.escape:
                return t.noStyle
                  ? i.escape(e.text)
                  : "<span>" + i.escape(e.text) + "</span>";
              case u.refimg:
                return (
                  (g = (h = t.nodeMap.link_list.getNodeByRef(e.ref || e.text))
                    ? p(h.get("title"))
                    : void 0),
                  void 0 !== (l = h ? h.get("href") : void 0)
                    ? ((l = t.forPrint
                        ? m(f(File.editor.imgEdit.getRealSrc(l), !0))
                        : p(l)),
                      (r =
                        "<img alt='" +
                        e.text +
                        "' src='" +
                        l +
                        "'" +
                        (g ? " title='" + g + "'" : "") +
                        " referrerPolicy='no-referrer'></img>"),
                      t.noStyle ||
                        (r = "<span class='md-image'>" + r + "</span>"),
                      t.forPrint && failImgCache.indexOf(l) > -1 && (r = ""),
                      r)
                    : "![" + e.inner + "][" + i.escape(e.ref) + "]"
                );
              case u.reflink:
                return (
                  (l = (h = t.nodeMap.link_list.getNodeByRef(e.ref || e.text))
                    ? p(y(h.get("href")))
                    : void 0),
                  (g = h ? p(h.get("title")) : void 0),
                  void 0 !== l
                    ? "<a href='" +
                      l +
                      "' target='_blank'" +
                      (g ? " title='" + g + "'" : "") +
                      ">" +
                      e.inner +
                      "</a>"
                    : "[" + e.inner + "][" + i.escape(e.ref) + "]"
                );
              case u.attr:
                return "";
              case u.emoji:
                return File.option.monocolorEmoji
                  ? "<span class='md-emoji'>" + e.inner + "</span>"
                  : e.inner;
              case u.inline_math:
                return t.noStyle && "latex" == File.option.mathFormatOnCopy
                  ? (e.pattern || "$") + e.text + (e.pattern || "$")
                  : (function (e, t, n) {
                      e = e.replace(/\u200B/g, "");
                      var r = svgCache[e];
                      if (r)
                        n ||
                          (r = $("<span>" + r + "</span>")
                            .find("mjx-assistive-mml")
                            .remove()
                            .end()
                            .html());
                      else if (t && t.cid) {
                        var o = document.querySelectorAll(
                          "[cid='" +
                            t.cid +
                            "'] .md-inline-math.math-jax-postprocess"
                        );
                        o.forEach(function (t) {
                          if (!r) {
                            var i = (
                              (t.querySelector("script") || {}).innerText || ""
                            )
                              .replace(/\u200B/g, "")
                              .trim();
                            if (i == e) {
                              var o = t
                                  .querySelector(".md-inline-math-container")
                                  .cloneNode(!0),
                                a = o.querySelector("mjx-assistive-mml");
                              !n && a && a.remove(),
                                (svgCache[e] = d.processExportedSVG(
                                  o.innerHTML,
                                  !0
                                )),
                                (r = svgCache[e]);
                            }
                          }
                        });
                      }
                      return (
                        r ||
                        "<span class='math-in-toc'>$" +
                          i.escapeForPreWrap(e) +
                          "$</span>"
                      );
                    })(e.text, n, !t.noStyle && !t.forPrint && !t.forImage);
              case u.subscript:
                return "<sub>" + e.inner + "</sub>";
              case u.superscript:
                return "<sup>" + e.inner + "</sup>";
              case u.underline:
                return "<u>" + e.inner + "</u>";
              case u.tab:
                return t.noStyle ? e.inner : "<span>" + e.inner + "</span>";
              case u.linebreak:
                return "<br/>";
              case u.highlight:
                return "<mark>" + e.inner + "</mark>";
              default:
                return e.inner || e.text || "";
            }
          }),
          (t.decorate = function (e, t) {
            switch (e.type) {
              case "block":
                return "<span class='md-block-like'>" + e.inner + "</span>";
              case u.heading:
                return (
                  "<span class='md-block-like'><span class='md-blockmeta'>" +
                  e.meta_before +
                  "</span><span class='md-header-span'>" +
                  e.inner +
                  "</span>" +
                  (e.meta_after
                    ? "<span class='md-blockmeta'>" + e.meta_after + "</span>"
                    : "") +
                  "</span>"
                );
              case u.paragraph:
                return e.inner;
              case u.blockquote:
                return (
                  "<span class='md-block-like'><span class='md-blockmeta'>" +
                  e.pattern +
                  "</span>" +
                  e.inner +
                  "</span>"
                );
              case u.fences:
                return (
                  "<span class='md-block-like' mdlike='" +
                  e.type +
                  "'><span class='md-blockmeta'>" +
                  e.pattern +
                  "</span><span class='md-lang'>" +
                  i.escape(e.lang) +
                  "</span></span>"
                );
              case u.def_footnote:
                return (
                  "<span class='md-block-like' mdlike='" +
                  e.type +
                  "'><span class='md-blockmeta'>[^</span>" +
                  e.ref +
                  "<span class='md-blockmeta'>]:" +
                  e.pattern +
                  "</span><span class='md-def-content'>" +
                  e.inner +
                  "</span></span>"
                );
              case u.def_link:
                return (
                  "<span class='md-block-like' mdlike='" +
                  e.type +
                  "'><span class='md-blockmeta'>[</span>" +
                  e.ref +
                  "<span class='md-blockmeta'>]:" +
                  e.pattern +
                  "</span><span class='md-def-content'>" +
                  e.inner +
                  "</span></span>"
                );
              case u.strong:
                return (
                  "<span md-inline='strong' class='md-pair-s " +
                  (e.inner ? "" : "md-empty") +
                  "'><span class='md-meta md-before'>" +
                  e.pattern +
                  "</span><strong>" +
                  e.inner +
                  "</strong><span class='md-meta md-after'>" +
                  e.pattern +
                  "</span></span>"
                );
              case u.em:
                return (
                  "<span md-inline='em' class='md-pair-s " +
                  (e.inner ? "" : "md-empty") +
                  "'><span class='md-meta md-before'>" +
                  e.pattern +
                  "</span><em>" +
                  e.inner +
                  "</em><span class='md-meta md-after'>" +
                  e.pattern +
                  "</span></span>"
                );
              case u.highlight:
                return (
                  "<span md-inline='highlight' class='md-pair-s'><span class='md-meta md-before'>==</span><mark>" +
                  e.inner +
                  "</mark><span class='md-meta md-after'>==</span></span>"
                );
              case u.plain:
                return (
                  "<span md-inline='plain' class='md-plain'>" +
                  i.escape(e.text) +
                  "</span>"
                );
              case u.code:
                var n = (e.text.match(/^\s+/) || "")[0] || "",
                  r = (e.text.substr(n.length).match(/\s+$/) || "")[0] || "";
                return (
                  `<span md-inline='code' spellcheck='${
                    File.option.spellcheckForCodeAndLink || !1
                  }' class='md-pair-s'><span class='md-meta md-before'>` +
                  e.pattern +
                  n +
                  "</span><code>" +
                  i.escapeForPreWrap(e.text.trim(), !1, !0) +
                  "</code><span class='md-meta md-after'>" +
                  r +
                  e.pattern +
                  "</span></span>"
                );
              case u.del:
                return (
                  "<span md-inline='del' class='md-pair-s'><span class='md-meta md-before'>" +
                  e.pattern +
                  "</span><del>" +
                  e.inner +
                  "</del><span class='md-meta md-after'>" +
                  e.pattern +
                  "</span></span>"
                );
              case u.autolink:
                return `<span md-inline='autolink' class='md-link' spellcheck='${
                  File.option.spellcheckForCodeAndLink || !1
                }'><span class='md-meta md-before'>&lt;</span><a href='${f(
                  e.href
                )}' class="md-url">${i.escape(
                  e.text
                )}</a><span class='md-meta md-after'>&gt;</span></span>`;
              case u.url:
                return `<span md-inline='url' class='md-link md-pair-s' spellcheck='${
                  File.option.spellcheckForCodeAndLink || !1
                }'><a href='${f(e.href)}'>${i.escape(e.text)}</a></span>`;
              case u.br:
                return (
                  "<span md-inline='br' class='md-br md-tag' spellcheck='false'><span class='md-br-content md-raw-inline'>" +
                  i.escapeForPreWrap(e.text, !1, !0) +
                  "</span></span>"
                );
              case u.comment:
                return (
                  `<span md-inline='comment' class='md-comment' spellcheck='${
                    File.option.spellcheckForCodeAndLink || !1
                  }'>` +
                  i.escapeForPreWrap(e.text, !1, !0) +
                  "</span>"
                );
              case u.underline:
                return (
                  "<span md-inline='underline' class='md-pair-s'><span class='md-meta md-before md-raw-inline'>&lt;u&gt;</span><u>" +
                  e.inner +
                  "</u><span class='md-meta md-after md-raw-inline'>&lt;/u&gt;</span></span>"
                );
              case u.ruby:
                return (
                  "<span md-inline='ruby' class='md-ruby'><span contenteditable='false' class='md-ruby-container'>" +
                  l.sanitize(e.text, c.getDomPurifyConfig(c.INLINE_CONFIG))
                    .innerHTML +
                  "</span><span class='md-meta md-content md-raw-inline'>" +
                  i.escape(e.text) +
                  "</span></span>"
                );
              case u.html_inline:
                var o = [""];
                return (
                  e.isMeta ||
                    (o = (function (e) {
                      var t = l.sanitize(
                        e.before + "" + e.after,
                        c.getDomPurifyConfig(c.INLINE_CONFIG)
                      );
                      t.querySelectorAll("a").forEach(function (e) {
                        "#" == (e.getAttribute("href") || "")[0] &&
                          e.classList.add("md-inner-link");
                      });
                      var n = t.innerHTML.replace("", e.inner);
                      return (
                        (t.innerHTML = n),
                        "" !=
                          (void 0 === t.textContent
                            ? t.innerText
                            : t.textContent) ||
                        t.querySelector("img, svg, video, audio")
                          ? [n, n]
                          : [n, ""]
                      );
                    })(e)),
                  o[1]
                    ? `<span md-inline='html_inline' class='md-html-inline' spellcheck='${
                        File.option.spellcheckForCodeAndLink || !1
                      }'>` +
                      "<span class='md-meta md-before md-raw-inline'>" +
                      i.escapeForPreWrap(e.before, !1, !0) +
                      "</span>" +
                      o[0] +
                      "<span class='md-meta md-after md-raw-inline'>" +
                      i.escapeForPreWrap(e.after, !1, !0) +
                      "</span></span>"
                    : "<span md-inline='html_inline' class='md-html-inline md-raw-inline' spellcheck='false'>" +
                      (o[0] || "") +
                      "<span class='md-raw-inline'>" +
                      i.escapeForPreWrap(e.before, !1, !0) +
                      e.inner +
                      i.escapeForPreWrap(e.after, !1, !0) +
                      "</span></span>"
                );
              case u.tag:
                return (
                  "<span md-inline='tag' class='md-tag md-raw-inline' spellcheck='false'>" +
                  i.escapeForPreWrap(e.text, !1, !0) +
                  "</span>"
                );
              case u.atag:
                return (
                  "<span md-inline='atag' class='md-atag'><span class='md-meta md-before md-raw-inline'>" +
                  i.escapeForPreWrap(e.left, !1, !0) +
                  "</span><a href='" +
                  f(e.href) +
                  "' " +
                  ("#" == e.href[0] ? "class='md-inner-link'" : "") +
                  ">" +
                  e.inner +
                  "</a><span class='md-meta md-after md-raw-inline'>" +
                  i.escapeForPreWrap(e.right, !1, !0) +
                  "</span></span>"
                );
              case u.link:
                var a = e.meta.replace(
                  /^\((<?(?:\([^)]*\)|[^()])*?>?)(?:([ \t]+)((['"])((?:.|\n)*?)\4))?([ \t]*)\)/,
                  function (e, t, n, r, o, a, s) {
                    return (
                      `(</span><span class='md-content md-url' spellcheck='${
                        File.option.spellcheckForCodeAndLink || !1
                      }' >` +
                      i.escape(t) +
                      "</span><span class='md-meta'>" +
                      i.escape(n) +
                      "</span><span class='md-content md-link-title'>" +
                      i.escape(r) +
                      "</span><span class='md-meta md-after'>" +
                      i.escape(s) +
                      ")</span>"
                    );
                  }
                );
                return (
                  "<span md-inline='link' class='md-meta-i-c " +
                  (e.inner ? "" : "md-empty-link") +
                  " md-link'><span class='md-meta md-before md-meta-i'>[</span><a " +
                  ("#" == e.href[0] ? "class='md-inner-link'" : "") +
                  " href='" +
                  f(e.href) +
                  "' " +
                  (e.title
                    ? "title='" + i.escapeForPreWrap(e.title) + "' "
                    : "") +
                  ">" +
                  e.inner +
                  "</a><span class='md-meta md-before'>]" +
                  a +
                  "</span>"
                );
              case u.imgtag:
                return g(e, e.text, e.href);
              case u.refimg:
                return g(e, e.markdown, e.ref || e.text);
              case u.image:
                return g(e, e.markdown, e.href, e.components);
              case u.footnote:
                return (
                  "<sup md-inline='footnote' class='md-footnote' data-ref='" +
                  i.escape(e.text.trim()).toLowerCase() +
                  "'><span class='md-meta md-before '>[^</span><span class='md-text' spellcheck='false'>" +
                  e.inner +
                  "</span><span class='md-meta md-after'>]</span></sup>"
                );
              case u.escape:
                return (
                  "<span md-inline='escape'><span class='md-meta md-before'>\\</span>" +
                  i.escape(e.text) +
                  "</span>"
                );
              case u.reflink:
                return (
                  "<span md-inline='reflink' class='md-link md-meta-i-c'><span class='md-meta md-before md-meta-i'>[</span><a data-ref='" +
                  i.escapeForPreWrap(e.ref || e.text) +
                  "' href='#'>" +
                  e.inner +
                  "</a><span class='md-meta md-after'>]</span><span class='md-meta md-before'>[</span><span class='md-content' spellcheck='false'>" +
                  e.ref +
                  "</span><span class='md-meta md-after'>]</span></span>"
                );
              case u.attr:
                return (
                  "<span md-inline='attr' class='md-attr'>" +
                  i.escape(e.text) +
                  "</span>"
                );
              case u.emoji:
                return (
                  "<span md-inline='emoji' data-content='" +
                  e.text +
                  "' class='md-emoji' ><span class='md-emoji-control-ch'>​</span><span data-emoji='" +
                  e.inner +
                  "' class='md-emoji-span'></span><span class='md-meta'>:" +
                  e.text +
                  ":</span><span class='md-emoji-control-ch'>​</span></span>"
                );
              case u.inline_math:
                if (
                  (h++,
                  (e.text = e.text.replace(/\u200B+/g, "")),
                  !/^\$+$/.exec(e.text) && svgCache[e.text])
                )
                  return `<span class='md-inline-math math-jax-postprocess' md-inline='inline_math' id='ty-mjx-${h}'><span class='md-before md-meta'>${
                    e.pattern
                  }</span><span class='md-inline-math-container'>${
                    svgCache[e.text]
                  }</span><span class='md-after md-meta'>${
                    e.pattern
                  }</span><span class='md-math-after-sym'></span></span>`;
                var s = document.createElement("script");
                return (
                  (s.textContent = e.text),
                  s.setAttribute("type", "math/tex"),
                  `<span class='md-inline-math math-jax-preprocess' md-inline='inline_math' id='ty-mjx-${h}'><span class='md-before md-meta'>` +
                    e.pattern +
                    "</span><span class='md-math-tex md-inline-math-container'>" +
                    $(s.outerHTML)[0].outerHTML +
                    "</span><span class='md-after md-meta'>" +
                    e.pattern +
                    "</span><span class='md-math-after-sym'></span></span>"
                );
              case u.subscript:
                return (
                  "<sub md-inline='subscript' class='md-pair-s'><span class='md-meta md-before'>~</span>" +
                  e.inner +
                  "<span class='md-meta md-after'>~</span></sub>"
                );
              case u.superscript:
                return (
                  "<sup md-inline='superscript' class='md-pair-s'><span class='md-meta md-before'>^</span>" +
                  e.inner +
                  "<span class='md-meta md-after'>^</span></sup>"
                );
              case u.html_entity:
                return (
                  "<span md-inline='html_entity' data-content='" +
                  e.text +
                  "' class='md-entity'><span class='md-meta' spellcheck='false'>" +
                  i.escape(e.text) +
                  "</span></span>"
                );
              case u.pants:
                var d = "",
                  m = e.inner;
                return (
                  /^ /.exec(e.inner)
                    ? ((e.inner = e.inner.trim()),
                      (d = "md-pants-space-before"))
                    : / $/.exec(e.inner) &&
                      ((e.inner = " "), (d = "md-pants-space-after")),
                  "<span md-inline='pants' data-text='" +
                    p(e.text) +
                    "' data-content='" +
                    p(m) +
                    "' class='md-pants " +
                    d +
                    "' data-desc='" +
                    e.desc +
                    "'><span class='md-meta-none' contenteditable='false'>" +
                    (e.meta || "") +
                    "</span>" +
                    e.inner +
                    "</span>"
                );
              case u.tab:
                return (
                  "<span md-inline='tab' class='md-tab'>" + e.inner + "</span>"
                );
              case u.linebreak:
                return (
                  "<span md-inline='linebreak' class='md-linebreak'>  <span class='md-linebreak-mark'></span>\n" +
                  (e.isLast ? "<br/>" : "") +
                  "</span>"
                );
              case u.emptyline:
                return File.option.ignoreLineBreak
                  ? "<span md-inline='softbreak' class='md-softbreak md-softbreak-emptyline'><span contenteditable='false'></span>\n</span>"
                  : "&#10;<span md-inline='emptyline' class='md-emptyline'>&#10;</span>";
              case u.softbreak:
                return (
                  "<span md-inline='softbreak' class='md-softbreak'>" +
                  (File.option.ignoreLineBreak
                    ? "<span contenteditable='false'></span>"
                    : "") +
                  "\n</span>"
                );
              default:
                return console.sendError("unknow type " + e.type), e.text;
            }
          }),
          (t.decorateImage = g);
      }
    ),
    $__System.registerDynamic("49", ["e"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = e("e");
      class r {
        constructor(e) {
          (this.editor = e),
            setTimeout(function () {
              i.getScript("./appsrc/editor/EmojiSearchMap.js", function () {
                var e = window.EmojiSearchMap;
                for (var t in r.data) e[t] || (e[t] = [t]);
              });
            }, 1e3);
        }
        autoCompleteOption() {
          return {
            search: this.search,
            render: (e, t) =>
              "<li class='" +
              (t ? "active" : "") +
              "' data-content='" +
              e +
              "' ><span class='ty-emoji-icon'>" +
              r.data[e.replace(/:/g, "")] +
              "</span><span class='emoji-meta'>" +
              e +
              "</span></li>",
          };
        }
        search(e, t) {
          if (!e) return [];
          var n = Object.keys(r.data);
          n.sort();
          var i = n.filter((t) => 0 === t.indexOf(e));
          try {
            var o,
              a = new RegExp("(^" + e + ")|(_" + e + ")|(-" + e + ")", "i");
            i = i.concat(
              n.filter((t) => -1 == i.indexOf(t) && a.exec(t) && t !== e)
            );
          } catch (e) {}
          if (
            (r.data[e] && i.unshift(e), (o = (window.EmojiSearchMap || {})[e]))
          )
            for (var s = 0; s < o.length; s++)
              -1 == i.indexOf(o[s]) && i.push(o[s]);
          return i.map((e) => ":" + e + ":");
        }
      }
      (r.data = {
        100: "💯",
        1234: "🔢",
        grinning: "😀",
        smiley: "😃",
        smile: "😄",
        grin: "😁",
        laughing: "😆",
        satisfied: "😆",
        sweat_smile: "😅",
        joy: "😂",
        rofl: "🤣",
        relaxed: "☺️",
        blush: "😊",
        innocent: "😇",
        slightly_smiling_face: "🙂",
        upside_down_face: "🙃",
        wink: "😉",
        relieved: "😌",
        heart_eyes: "😍",
        kissing_heart: "😘",
        kissing: "😗",
        kissing_smiling_eyes: "😙",
        kissing_closed_eyes: "😚",
        yum: "😋",
        stuck_out_tongue_winking_eye: "😜",
        stuck_out_tongue_closed_eyes: "😝",
        stuck_out_tongue: "😛",
        money_mouth_face: "🤑",
        hugs: "🤗",
        nerd_face: "🤓",
        sunglasses: "😎",
        clown_face: "🤡",
        cowboy_hat_face: "🤠",
        smirk: "😏",
        unamused: "😒",
        disappointed: "😞",
        pensive: "😔",
        worried: "😟",
        confused: "😕",
        slightly_frowning_face: "🙁",
        frowning_face: "☹️",
        persevere: "😣",
        confounded: "😖",
        tired_face: "😫",
        weary: "😩",
        triumph: "😤",
        angry: "😠",
        rage: "😡",
        pout: "😡",
        no_mouth: "😶",
        neutral_face: "😐",
        expressionless: "😑",
        hushed: "😯",
        frowning: "😦",
        anguished: "😧",
        open_mouth: "😮",
        astonished: "😲",
        dizzy_face: "😵",
        flushed: "😳",
        scream: "😱",
        fearful: "😨",
        cold_sweat: "😰",
        cry: "😢",
        disappointed_relieved: "😥",
        drooling_face: "🤤",
        sob: "😭",
        sweat: "😓",
        sleepy: "😪",
        sleeping: "😴",
        roll_eyes: "🙄",
        thinking: "🤔",
        lying_face: "🤥",
        grimacing: "😬",
        zipper_mouth_face: "🤐",
        nauseated_face: "🤢",
        sneezing_face: "🤧",
        mask: "😷",
        face_with_thermometer: "🤒",
        face_with_head_bandage: "🤕",
        smiling_imp: "😈",
        imp: "👿",
        japanese_ogre: "👹",
        japanese_goblin: "👺",
        hankey: "💩",
        poop: "💩",
        shit: "💩",
        ghost: "👻",
        skull: "💀",
        skull_and_crossbones: "☠️",
        alien: "👽",
        space_invader: "👾",
        robot: "🤖",
        jack_o_lantern: "🎃",
        smiley_cat: "😺",
        smile_cat: "😸",
        joy_cat: "😹",
        heart_eyes_cat: "😻",
        smirk_cat: "😼",
        kissing_cat: "😽",
        scream_cat: "🙀",
        crying_cat_face: "😿",
        pouting_cat: "😾",
        open_hands: "👐",
        raised_hands: "🙌",
        clap: "👏",
        pray: "🙏",
        handshake: "🤝",
        "+1": "👍",
        thumbsup: "👍",
        "-1": "👎",
        thumbsdown: "👎",
        fist_oncoming: "👊",
        facepunch: "👊",
        punch: "👊",
        fist_raised: "✊",
        fist: "✊",
        fist_left: "🤛",
        fist_right: "🤜",
        crossed_fingers: "🤞",
        v: "✌️",
        metal: "🤘",
        ok_hand: "👌",
        point_left: "👈",
        point_right: "👉",
        point_up_2: "👆",
        point_down: "👇",
        point_up: "☝️",
        hand: "✋",
        raised_hand: "✋",
        raised_back_of_hand: "🤚",
        raised_hand_with_fingers_splayed: "🖐",
        vulcan_salute: "🖖",
        wave: "👋",
        call_me_hand: "🤙",
        muscle: "💪",
        middle_finger: "🖕",
        fu: "🖕",
        writing_hand: "✍️",
        selfie: "🤳",
        nail_care: "💅",
        ring: "💍",
        lipstick: "💄",
        kiss: "💋",
        lips: "👄",
        tongue: "👅",
        ear: "👂",
        nose: "👃",
        footprints: "👣",
        eye: "👁",
        eyes: "👀",
        speaking_head: "🗣",
        bust_in_silhouette: "👤",
        busts_in_silhouette: "👥",
        baby: "👶",
        boy: "👦",
        girl: "👧",
        man: "👨",
        woman: "👩",
        blonde_woman: "👱‍♀",
        blonde_man: "👱",
        person_with_blond_hair: "👱",
        older_man: "👴",
        older_woman: "👵",
        man_with_gua_pi_mao: "👲",
        woman_with_turban: "👳‍♀",
        man_with_turban: "👳",
        policewoman: "👮‍♀",
        policeman: "👮",
        cop: "👮",
        construction_worker_woman: "👷‍♀",
        construction_worker_man: "👷",
        construction_worker: "👷",
        guardswoman: "💂‍♀",
        guardsman: "💂",
        female_detective: "🕵️‍♀️",
        male_detective: "🕵",
        detective: "🕵",
        woman_health_worker: "👩‍⚕",
        man_health_worker: "👨‍⚕",
        woman_farmer: "👩‍🌾",
        man_farmer: "👨‍🌾",
        woman_cook: "👩‍🍳",
        man_cook: "👨‍🍳",
        woman_student: "👩‍🎓",
        man_student: "👨‍🎓",
        woman_singer: "👩‍🎤",
        man_singer: "👨‍🎤",
        woman_teacher: "👩‍🏫",
        man_teacher: "👨‍🏫",
        woman_factory_worker: "👩‍🏭",
        man_factory_worker: "👨‍🏭",
        woman_technologist: "👩‍💻",
        man_technologist: "👨‍💻",
        woman_office_worker: "👩‍💼",
        man_office_worker: "👨‍💼",
        woman_mechanic: "👩‍🔧",
        man_mechanic: "👨‍🔧",
        woman_scientist: "👩‍🔬",
        man_scientist: "👨‍🔬",
        woman_artist: "👩‍🎨",
        man_artist: "👨‍🎨",
        woman_firefighter: "👩‍🚒",
        man_firefighter: "👨‍🚒",
        woman_pilot: "👩‍✈",
        man_pilot: "👨‍✈",
        woman_astronaut: "👩‍🚀",
        man_astronaut: "👨‍🚀",
        woman_judge: "👩‍⚖",
        man_judge: "👨‍⚖",
        mrs_claus: "🤶",
        santa: "🎅",
        princess: "👸",
        prince: "🤴",
        bride_with_veil: "👰",
        man_in_tuxedo: "🤵",
        angel: "👼",
        pregnant_woman: "🤰",
        bowing_woman: "🙇‍♀",
        bowing_man: "🙇",
        bow: "🙇",
        tipping_hand_woman: "💁",
        information_desk_person: "💁",
        sassy_woman: "💁",
        tipping_hand_man: "💁‍♂",
        sassy_man: "💁‍♂",
        no_good_woman: "🙅",
        no_good: "🙅",
        ng_woman: "🙅",
        no_good_man: "🙅‍♂",
        ng_man: "🙅‍♂",
        ok_woman: "🙆",
        ok_man: "🙆‍♂",
        raising_hand_woman: "🙋",
        raising_hand: "🙋",
        raising_hand_man: "🙋‍♂",
        woman_facepalming: "🤦‍♀",
        man_facepalming: "🤦‍♂",
        woman_shrugging: "🤷‍♀",
        man_shrugging: "🤷‍♂",
        pouting_woman: "🙎",
        person_with_pouting_face: "🙎",
        pouting_man: "🙎‍♂",
        frowning_woman: "🙍",
        person_frowning: "🙍",
        frowning_man: "🙍‍♂",
        haircut_woman: "💇",
        haircut: "💇",
        haircut_man: "💇‍♂",
        massage_woman: "💆",
        massage: "💆",
        massage_man: "💆‍♂",
        business_suit_levitating: "🕴",
        dancer: "💃",
        man_dancing: "🕺",
        dancing_women: "👯",
        dancers: "👯",
        dancing_men: "👯‍♂",
        walking_woman: "🚶‍♀",
        walking_man: "🚶",
        walking: "🚶",
        running_woman: "🏃‍♀",
        running_man: "🏃",
        runner: "🏃",
        running: "🏃",
        couple: "👫",
        two_women_holding_hands: "👭",
        two_men_holding_hands: "👬",
        couple_with_heart_woman_man: "💑",
        couple_with_heart: "💑",
        couple_with_heart_woman_woman: "👩‍❤️‍👩",
        couple_with_heart_man_man: "👨‍❤️‍👨",
        couplekiss_man_woman: "💏",
        couplekiss_woman_woman: "👩‍❤️‍💋‍👩",
        couplekiss_man_man: "👨‍❤️‍💋‍👨",
        family_man_woman_boy: "👪",
        family: "👪",
        family_man_woman_girl: "👨‍👩‍👧",
        family_man_woman_girl_boy: "👨‍👩‍👧‍👦",
        family_man_woman_boy_boy: "👨‍👩‍👦‍👦",
        family_man_woman_girl_girl: "👨‍👩‍👧‍👧",
        family_woman_woman_boy: "👩‍👩‍👦",
        family_woman_woman_girl: "👩‍👩‍👧",
        family_woman_woman_girl_boy: "👩‍👩‍👧‍👦",
        family_woman_woman_boy_boy: "👩‍👩‍👦‍👦",
        family_woman_woman_girl_girl: "👩‍👩‍👧‍👧",
        family_man_man_boy: "👨‍👨‍👦",
        family_man_man_girl: "👨‍👨‍👧",
        family_man_man_girl_boy: "👨‍👨‍👧‍👦",
        family_man_man_boy_boy: "👨‍👨‍👦‍👦",
        family_man_man_girl_girl: "👨‍👨‍👧‍👧",
        family_woman_boy: "👩‍👦",
        family_woman_girl: "👩‍👧",
        family_woman_girl_boy: "👩‍👧‍👦",
        family_woman_boy_boy: "👩‍👦‍👦",
        family_woman_girl_girl: "👩‍👧‍👧",
        family_man_boy: "👨‍👦",
        family_man_girl: "👨‍👧",
        family_man_girl_boy: "👨‍👧‍👦",
        family_man_boy_boy: "👨‍👦‍👦",
        family_man_girl_girl: "👨‍👧‍👧",
        womans_clothes: "👚",
        shirt: "👕",
        tshirt: "👕",
        jeans: "👖",
        necktie: "👔",
        dress: "👗",
        bikini: "👙",
        kimono: "👘",
        high_heel: "👠",
        sandal: "👡",
        boot: "👢",
        mans_shoe: "👞",
        shoe: "👞",
        athletic_shoe: "👟",
        womans_hat: "👒",
        tophat: "🎩",
        mortar_board: "🎓",
        crown: "👑",
        rescue_worker_helmet: "⛑",
        school_satchel: "🎒",
        pouch: "👝",
        purse: "👛",
        handbag: "👜",
        briefcase: "💼",
        eyeglasses: "👓",
        dark_sunglasses: "🕶",
        closed_umbrella: "🌂",
        open_umbrella: "☂️",
        dog: "🐶",
        cat: "🐱",
        mouse: "🐭",
        hamster: "🐹",
        rabbit: "🐰",
        fox_face: "🦊",
        bear: "🐻",
        panda_face: "🐼",
        koala: "🐨",
        tiger: "🐯",
        lion: "🦁",
        cow: "🐮",
        pig: "🐷",
        pig_nose: "🐽",
        frog: "🐸",
        monkey_face: "🐵",
        see_no_evil: "🙈",
        hear_no_evil: "🙉",
        speak_no_evil: "🙊",
        monkey: "🐒",
        chicken: "🐔",
        penguin: "🐧",
        bird: "🐦",
        baby_chick: "🐤",
        hatching_chick: "🐣",
        hatched_chick: "🐥",
        duck: "🦆",
        eagle: "🦅",
        owl: "🦉",
        bat: "🦇",
        wolf: "🐺",
        boar: "🐗",
        horse: "🐴",
        unicorn: "🦄",
        bee: "🐝",
        honeybee: "🐝",
        bug: "🐛",
        butterfly: "🦋",
        snail: "🐌",
        shell: "🐚",
        beetle: "🐞",
        ant: "🐜",
        spider: "🕷",
        spider_web: "🕸",
        turtle: "🐢",
        snake: "🐍",
        lizard: "🦎",
        scorpion: "🦂",
        crab: "🦀",
        squid: "🦑",
        octopus: "🐙",
        shrimp: "🦐",
        tropical_fish: "🐠",
        fish: "🐟",
        blowfish: "🐡",
        dolphin: "🐬",
        flipper: "🐬",
        shark: "🦈",
        whale: "🐳",
        whale2: "🐋",
        crocodile: "🐊",
        leopard: "🐆",
        tiger2: "🐅",
        water_buffalo: "🐃",
        ox: "🐂",
        cow2: "🐄",
        deer: "🦌",
        dromedary_camel: "🐪",
        camel: "🐫",
        elephant: "🐘",
        rhinoceros: "🦏",
        gorilla: "🦍",
        racehorse: "🐎",
        pig2: "🐖",
        goat: "🐐",
        ram: "🐏",
        sheep: "🐑",
        dog2: "🐕",
        poodle: "🐩",
        cat2: "🐈",
        rooster: "🐓",
        turkey: "🦃",
        dove: "🕊",
        rabbit2: "🐇",
        mouse2: "🐁",
        rat: "🐀",
        chipmunk: "🐿",
        feet: "🐾",
        paw_prints: "🐾",
        dragon: "🐉",
        dragon_face: "🐲",
        cactus: "🌵",
        christmas_tree: "🎄",
        evergreen_tree: "🌲",
        deciduous_tree: "🌳",
        palm_tree: "🌴",
        seedling: "🌱",
        herb: "🌿",
        shamrock: "☘️",
        four_leaf_clover: "🍀",
        bamboo: "🎍",
        tanabata_tree: "🎋",
        leaves: "🍃",
        fallen_leaf: "🍂",
        maple_leaf: "🍁",
        mushroom: "🍄",
        ear_of_rice: "🌾",
        bouquet: "💐",
        tulip: "🌷",
        rose: "🌹",
        wilted_flower: "🥀",
        sunflower: "🌻",
        blossom: "🌼",
        cherry_blossom: "🌸",
        hibiscus: "🌺",
        earth_americas: "🌎",
        earth_africa: "🌍",
        earth_asia: "🌏",
        full_moon: "🌕",
        waning_gibbous_moon: "🌖",
        last_quarter_moon: "🌗",
        waning_crescent_moon: "🌘",
        new_moon: "🌑",
        waxing_crescent_moon: "🌒",
        first_quarter_moon: "🌓",
        moon: "🌔",
        waxing_gibbous_moon: "🌔",
        new_moon_with_face: "🌚",
        full_moon_with_face: "🌝",
        sun_with_face: "🌞",
        first_quarter_moon_with_face: "🌛",
        last_quarter_moon_with_face: "🌜",
        crescent_moon: "🌙",
        dizzy: "💫",
        star: "⭐️",
        star2: "🌟",
        sparkles: "✨",
        zap: "⚡️",
        fire: "🔥",
        boom: "💥",
        collision: "💥",
        comet: "☄",
        sunny: "☀️",
        sun_behind_small_cloud: "🌤",
        partly_sunny: "⛅️",
        sun_behind_large_cloud: "🌥",
        sun_behind_rain_cloud: "🌦",
        rainbow: "🌈",
        cloud: "☁️",
        cloud_with_rain: "🌧",
        cloud_with_lightning_and_rain: "⛈",
        cloud_with_lightning: "🌩",
        cloud_with_snow: "🌨",
        snowman_with_snow: "☃️",
        snowman: "⛄️",
        snowflake: "❄️",
        wind_face: "🌬",
        dash: "💨",
        tornado: "🌪",
        fog: "🌫",
        ocean: "🌊",
        droplet: "💧",
        sweat_drops: "💦",
        umbrella: "☔️",
        green_apple: "🍏",
        apple: "🍎",
        pear: "🍐",
        tangerine: "🍊",
        orange: "🍊",
        mandarin: "🍊",
        lemon: "🍋",
        banana: "🍌",
        watermelon: "🍉",
        grapes: "🍇",
        strawberry: "🍓",
        melon: "🍈",
        cherries: "🍒",
        peach: "🍑",
        pineapple: "🍍",
        kiwi_fruit: "🥝",
        avocado: "🥑",
        tomato: "🍅",
        eggplant: "🍆",
        cucumber: "🥒",
        carrot: "🥕",
        corn: "🌽",
        hot_pepper: "🌶",
        potato: "🥔",
        sweet_potato: "🍠",
        chestnut: "🌰",
        peanuts: "🥜",
        honey_pot: "🍯",
        croissant: "🥐",
        bread: "🍞",
        baguette_bread: "🥖",
        cheese: "🧀",
        egg: "🥚",
        fried_egg: "🍳",
        bacon: "🥓",
        pancakes: "🥞",
        fried_shrimp: "🍤",
        poultry_leg: "🍗",
        meat_on_bone: "🍖",
        pizza: "🍕",
        hotdog: "🌭",
        hamburger: "🍔",
        fries: "🍟",
        stuffed_flatbread: "🥙",
        taco: "🌮",
        burrito: "🌯",
        green_salad: "🥗",
        shallow_pan_of_food: "🥘",
        spaghetti: "🍝",
        ramen: "🍜",
        stew: "🍲",
        fish_cake: "🍥",
        sushi: "🍣",
        bento: "🍱",
        curry: "🍛",
        rice: "🍚",
        rice_ball: "🍙",
        rice_cracker: "🍘",
        oden: "🍢",
        dango: "🍡",
        shaved_ice: "🍧",
        ice_cream: "🍨",
        icecream: "🍦",
        cake: "🍰",
        birthday: "🎂",
        custard: "🍮",
        lollipop: "🍭",
        candy: "🍬",
        chocolate_bar: "🍫",
        popcorn: "🍿",
        doughnut: "🍩",
        cookie: "🍪",
        milk_glass: "🥛",
        baby_bottle: "🍼",
        coffee: "☕️",
        tea: "🍵",
        sake: "🍶",
        beer: "🍺",
        beers: "🍻",
        clinking_glasses: "🥂",
        wine_glass: "🍷",
        tumbler_glass: "🥃",
        cocktail: "🍸",
        tropical_drink: "🍹",
        champagne: "🍾",
        spoon: "🥄",
        fork_and_knife: "🍴",
        plate_with_cutlery: "🍽",
        soccer: "⚽️",
        basketball: "🏀",
        football: "🏈",
        baseball: "⚾️",
        tennis: "🎾",
        volleyball: "🏐",
        rugby_football: "🏉",
        "8ball": "🎱",
        ping_pong: "🏓",
        badminton: "🏸",
        goal_net: "🥅",
        ice_hockey: "🏒",
        field_hockey: "🏑",
        cricket: "🏏",
        golf: "⛳️",
        bow_and_arrow: "🏹",
        fishing_pole_and_fish: "🎣",
        boxing_glove: "🥊",
        martial_arts_uniform: "🥋",
        ice_skate: "⛸",
        ski: "🎿",
        skier: "⛷",
        snowboarder: "🏂",
        weight_lifting_woman: "🏋️‍♀️",
        weight_lifting_man: "🏋",
        person_fencing: "🤺",
        women_wrestling: "🤼‍♀",
        men_wrestling: "🤼‍♂",
        woman_cartwheeling: "🤸‍♀",
        man_cartwheeling: "🤸‍♂",
        basketball_woman: "⛹️‍♀️",
        basketball_man: "⛹",
        woman_playing_handball: "🤾‍♀",
        man_playing_handball: "🤾‍♂",
        golfing_woman: "🏌️‍♀️",
        golfing_man: "🏌",
        surfing_woman: "🏄‍♀",
        surfing_man: "🏄",
        surfer: "🏄",
        swimming_woman: "🏊‍♀",
        swimming_man: "🏊",
        swimmer: "🏊",
        woman_playing_water_polo: "🤽‍♀",
        man_playing_water_polo: "🤽‍♂",
        rowing_woman: "🚣‍♀",
        rowing_man: "🚣",
        rowboat: "🚣",
        horse_racing: "🏇",
        biking_woman: "🚴‍♀",
        biking_man: "🚴",
        bicyclist: "🚴",
        mountain_biking_woman: "🚵‍♀",
        mountain_biking_man: "🚵",
        mountain_bicyclist: "🚵",
        running_shirt_with_sash: "🎽",
        medal_sports: "🏅",
        medal_military: "🎖",
        "1st_place_medal": "🥇",
        "2nd_place_medal": "🥈",
        "3rd_place_medal": "🥉",
        trophy: "🏆",
        rosette: "🏵",
        reminder_ribbon: "🎗",
        ticket: "🎫",
        tickets: "🎟",
        circus_tent: "🎪",
        woman_juggling: "🤹‍♀",
        man_juggling: "🤹‍♂",
        performing_arts: "🎭",
        art: "🎨",
        clapper: "🎬",
        microphone: "🎤",
        headphones: "🎧",
        musical_score: "🎼",
        musical_keyboard: "🎹",
        drum: "🥁",
        saxophone: "🎷",
        trumpet: "🎺",
        guitar: "🎸",
        violin: "🎻",
        game_die: "🎲",
        dart: "🎯",
        bowling: "🎳",
        video_game: "🎮",
        slot_machine: "🎰",
        car: "🚗",
        red_car: "🚗",
        taxi: "🚕",
        blue_car: "🚙",
        bus: "🚌",
        trolleybus: "🚎",
        racing_car: "🏎",
        police_car: "🚓",
        ambulance: "🚑",
        fire_engine: "🚒",
        minibus: "🚐",
        truck: "🚚",
        articulated_lorry: "🚛",
        tractor: "🚜",
        kick_scooter: "🛴",
        bike: "🚲",
        motor_scooter: "🛵",
        motorcycle: "🏍",
        rotating_light: "🚨",
        oncoming_police_car: "🚔",
        oncoming_bus: "🚍",
        oncoming_automobile: "🚘",
        oncoming_taxi: "🚖",
        aerial_tramway: "🚡",
        mountain_cableway: "🚠",
        suspension_railway: "🚟",
        railway_car: "🚃",
        train: "🚋",
        mountain_railway: "🚞",
        monorail: "🚝",
        bullettrain_side: "🚄",
        bullettrain_front: "🚅",
        light_rail: "🚈",
        steam_locomotive: "🚂",
        train2: "🚆",
        metro: "🚇",
        tram: "🚊",
        station: "🚉",
        helicopter: "🚁",
        small_airplane: "🛩",
        airplane: "✈️",
        flight_departure: "🛫",
        flight_arrival: "🛬",
        rocket: "🚀",
        artificial_satellite: "🛰",
        seat: "💺",
        canoe: "🛶",
        boat: "⛵️",
        sailboat: "⛵️",
        motor_boat: "🛥",
        speedboat: "🚤",
        passenger_ship: "🛳",
        ferry: "⛴",
        ship: "🚢",
        anchor: "⚓️",
        construction: "🚧",
        fuelpump: "⛽️",
        busstop: "🚏",
        vertical_traffic_light: "🚦",
        traffic_light: "🚥",
        world_map: "🗺",
        moyai: "🗿",
        statue_of_liberty: "🗽",
        fountain: "⛲️",
        tokyo_tower: "🗼",
        european_castle: "🏰",
        japanese_castle: "🏯",
        stadium: "🏟",
        ferris_wheel: "🎡",
        roller_coaster: "🎢",
        carousel_horse: "🎠",
        parasol_on_ground: "⛱",
        beach_umbrella: "🏖",
        desert_island: "🏝",
        mountain: "⛰",
        mountain_snow: "🏔",
        mount_fuji: "🗻",
        volcano: "🌋",
        desert: "🏜",
        camping: "🏕",
        tent: "⛺️",
        railway_track: "🛤",
        motorway: "🛣",
        building_construction: "🏗",
        factory: "🏭",
        house: "🏠",
        house_with_garden: "🏡",
        houses: "🏘",
        derelict_house: "🏚",
        office: "🏢",
        department_store: "🏬",
        post_office: "🏣",
        european_post_office: "🏤",
        hospital: "🏥",
        bank: "🏦",
        hotel: "🏨",
        convenience_store: "🏪",
        school: "🏫",
        love_hotel: "🏩",
        wedding: "💒",
        classical_building: "🏛",
        church: "⛪️",
        mosque: "🕌",
        synagogue: "🕍",
        kaaba: "🕋",
        shinto_shrine: "⛩",
        japan: "🗾",
        rice_scene: "🎑",
        national_park: "🏞",
        sunrise: "🌅",
        sunrise_over_mountains: "🌄",
        stars: "🌠",
        sparkler: "🎇",
        fireworks: "🎆",
        city_sunrise: "🌇",
        city_sunset: "🌆",
        cityscape: "🏙",
        night_with_stars: "🌃",
        milky_way: "🌌",
        bridge_at_night: "🌉",
        foggy: "🌁",
        watch: "⌚️",
        iphone: "📱",
        calling: "📲",
        computer: "💻",
        keyboard: "⌨️",
        desktop_computer: "🖥",
        printer: "🖨",
        computer_mouse: "🖱",
        trackball: "🖲",
        joystick: "🕹",
        clamp: "🗜",
        minidisc: "💽",
        floppy_disk: "💾",
        cd: "💿",
        dvd: "📀",
        vhs: "📼",
        camera: "📷",
        camera_flash: "📸",
        video_camera: "📹",
        movie_camera: "🎥",
        film_projector: "📽",
        film_strip: "🎞",
        telephone_receiver: "📞",
        phone: "☎️",
        telephone: "☎️",
        pager: "📟",
        fax: "📠",
        tv: "📺",
        radio: "📻",
        studio_microphone: "🎙",
        level_slider: "🎚",
        control_knobs: "🎛",
        stopwatch: "⏱",
        timer_clock: "⏲",
        alarm_clock: "⏰",
        mantelpiece_clock: "🕰",
        hourglass: "⌛️",
        hourglass_flowing_sand: "⏳",
        satellite: "📡",
        battery: "🔋",
        electric_plug: "🔌",
        bulb: "💡",
        flashlight: "🔦",
        candle: "🕯",
        wastebasket: "🗑",
        oil_drum: "🛢",
        money_with_wings: "💸",
        dollar: "💵",
        yen: "💴",
        euro: "💶",
        pound: "💷",
        moneybag: "💰",
        credit_card: "💳",
        gem: "💎",
        balance_scale: "⚖️",
        wrench: "🔧",
        hammer: "🔨",
        hammer_and_pick: "⚒",
        hammer_and_wrench: "🛠",
        pick: "⛏",
        nut_and_bolt: "🔩",
        gear: "⚙️",
        chains: "⛓",
        gun: "🔫",
        bomb: "💣",
        hocho: "🔪",
        knife: "🔪",
        dagger: "🗡",
        crossed_swords: "⚔️",
        shield: "🛡",
        smoking: "🚬",
        coffin: "⚰️",
        funeral_urn: "⚱️",
        amphora: "🏺",
        crystal_ball: "🔮",
        prayer_beads: "📿",
        barber: "💈",
        alembic: "⚗️",
        telescope: "🔭",
        microscope: "🔬",
        hole: "🕳",
        pill: "💊",
        syringe: "💉",
        thermometer: "🌡",
        toilet: "🚽",
        potable_water: "🚰",
        shower: "🚿",
        bathtub: "🛁",
        bath: "🛀",
        bellhop_bell: "🛎",
        key: "🔑",
        old_key: "🗝",
        door: "🚪",
        couch_and_lamp: "🛋",
        bed: "🛏",
        sleeping_bed: "🛌",
        framed_picture: "🖼",
        shopping: "🛍",
        shopping_cart: "🛒",
        gift: "🎁",
        balloon: "🎈",
        flags: "🎏",
        ribbon: "🎀",
        confetti_ball: "🎊",
        tada: "🎉",
        dolls: "🎎",
        izakaya_lantern: "🏮",
        lantern: "🏮",
        wind_chime: "🎐",
        email: "✉️",
        envelope: "✉️",
        envelope_with_arrow: "📩",
        incoming_envelope: "📨",
        "e-mail": "📧",
        love_letter: "💌",
        inbox_tray: "📥",
        outbox_tray: "📤",
        package: "📦",
        label: "🏷",
        mailbox_closed: "📪",
        mailbox: "📫",
        mailbox_with_mail: "📬",
        mailbox_with_no_mail: "📭",
        postbox: "📮",
        postal_horn: "📯",
        scroll: "📜",
        page_with_curl: "📃",
        page_facing_up: "📄",
        bookmark_tabs: "📑",
        bar_chart: "📊",
        chart_with_upwards_trend: "📈",
        chart_with_downwards_trend: "📉",
        spiral_notepad: "🗒",
        spiral_calendar: "🗓",
        calendar: "📆",
        date: "📅",
        card_index: "📇",
        card_file_box: "🗃",
        ballot_box: "🗳",
        file_cabinet: "🗄",
        clipboard: "📋",
        file_folder: "📁",
        open_file_folder: "📂",
        card_index_dividers: "🗂",
        newspaper_roll: "🗞",
        newspaper: "📰",
        notebook: "📓",
        notebook_with_decorative_cover: "📔",
        ledger: "📒",
        closed_book: "📕",
        green_book: "📗",
        blue_book: "📘",
        orange_book: "📙",
        books: "📚",
        book: "📖",
        open_book: "📖",
        bookmark: "🔖",
        link: "🔗",
        paperclip: "📎",
        paperclips: "🖇",
        triangular_ruler: "📐",
        straight_ruler: "📏",
        pushpin: "📌",
        round_pushpin: "📍",
        scissors: "✂️",
        pen: "🖊",
        fountain_pen: "🖋",
        black_nib: "✒️",
        paintbrush: "🖌",
        crayon: "🖍",
        memo: "📝",
        pencil: "📝",
        pencil2: "✏️",
        mag: "🔍",
        mag_right: "🔎",
        lock_with_ink_pen: "🔏",
        closed_lock_with_key: "🔐",
        lock: "🔒",
        unlock: "🔓",
        heart: "❤️",
        yellow_heart: "💛",
        green_heart: "💚",
        blue_heart: "💙",
        purple_heart: "💜",
        black_heart: "🖤",
        broken_heart: "💔",
        heavy_heart_exclamation: "❣️",
        two_hearts: "💕",
        revolving_hearts: "💞",
        heartbeat: "💓",
        heartpulse: "💗",
        sparkling_heart: "💖",
        cupid: "💘",
        gift_heart: "💝",
        heart_decoration: "💟",
        peace_symbol: "☮️",
        latin_cross: "✝️",
        star_and_crescent: "☪️",
        om: "🕉",
        wheel_of_dharma: "☸️",
        star_of_david: "✡️",
        six_pointed_star: "🔯",
        menorah: "🕎",
        yin_yang: "☯️",
        orthodox_cross: "☦️",
        place_of_worship: "🛐",
        ophiuchus: "⛎",
        aries: "♈️",
        taurus: "♉️",
        gemini: "♊️",
        cancer: "♋️",
        leo: "♌️",
        virgo: "♍️",
        libra: "♎️",
        scorpius: "♏️",
        sagittarius: "♐️",
        capricorn: "♑️",
        aquarius: "♒️",
        pisces: "♓️",
        id: "🆔",
        atom_symbol: "⚛️",
        accept: "🉑",
        radioactive: "☢️",
        biohazard: "☣️",
        mobile_phone_off: "📴",
        vibration_mode: "📳",
        eight_pointed_black_star: "✴️",
        vs: "🆚",
        white_flower: "💮",
        ideograph_advantage: "🉐",
        secret: "㊙️",
        congratulations: "㊗️",
        u6e80: "🈵",
        a: "🅰️",
        b: "🅱️",
        ab: "🆎",
        cl: "🆑",
        o2: "🅾️",
        sos: "🆘",
        x: "❌",
        o: "⭕️",
        stop_sign: "🛑",
        no_entry: "⛔️",
        name_badge: "📛",
        no_entry_sign: "🚫",
        anger: "💢",
        hotsprings: "♨️",
        no_pedestrians: "🚷",
        do_not_litter: "🚯",
        no_bicycles: "🚳",
        "non-potable_water": "🚱",
        underage: "🔞",
        no_mobile_phones: "📵",
        no_smoking: "🚭",
        exclamation: "❗️",
        heavy_exclamation_mark: "❗️",
        grey_exclamation: "❕",
        question: "❓",
        grey_question: "❔",
        bangbang: "‼️",
        interrobang: "⁉️",
        low_brightness: "🔅",
        high_brightness: "🔆",
        part_alternation_mark: "〽️",
        warning: "⚠️",
        children_crossing: "🚸",
        trident: "🔱",
        fleur_de_lis: "⚜️",
        beginner: "🔰",
        recycle: "♻️",
        white_check_mark: "✅",
        chart: "💹",
        sparkle: "❇️",
        eight_spoked_asterisk: "✳️",
        negative_squared_cross_mark: "❎",
        globe_with_meridians: "🌐",
        diamond_shape_with_a_dot_inside: "💠",
        m: "Ⓜ️",
        cyclone: "🌀",
        zzz: "💤",
        atm: "🏧",
        wc: "🚾",
        wheelchair: "♿️",
        parking: "🅿️",
        sa: "🈂️",
        passport_control: "🛂",
        customs: "🛃",
        baggage_claim: "🛄",
        left_luggage: "🛅",
        mens: "🚹",
        womens: "🚺",
        baby_symbol: "🚼",
        restroom: "🚻",
        put_litter_in_its_place: "🚮",
        cinema: "🎦",
        signal_strength: "📶",
        koko: "🈁",
        symbols: "🔣",
        information_source: "ℹ️",
        abc: "🔤",
        abcd: "🔡",
        capital_abcd: "🔠",
        ng: "🆖",
        ok: "🆗",
        up: "🆙",
        cool: "🆒",
        new: "🆕",
        free: "🆓",
        zero: "0️⃣",
        one: "1️⃣",
        two: "2️⃣",
        three: "3️⃣",
        four: "4️⃣",
        five: "5️⃣",
        six: "6️⃣",
        seven: "7️⃣",
        eight: "8️⃣",
        nine: "9️⃣",
        keycap_ten: "🔟",
        hash: "#️⃣",
        asterisk: "*️⃣",
        arrow_forward: "▶️",
        pause_button: "⏸",
        play_or_pause_button: "⏯",
        stop_button: "⏹",
        record_button: "⏺",
        next_track_button: "⏭",
        previous_track_button: "⏮",
        fast_forward: "⏩",
        rewind: "⏪",
        arrow_double_up: "⏫",
        arrow_double_down: "⏬",
        arrow_backward: "◀️",
        arrow_up_small: "🔼",
        arrow_down_small: "🔽",
        arrow_right: "➡️",
        arrow_left: "⬅️",
        arrow_up: "⬆️",
        arrow_down: "⬇️",
        arrow_upper_right: "↗️",
        arrow_lower_right: "↘️",
        arrow_lower_left: "↙️",
        arrow_upper_left: "↖️",
        arrow_up_down: "↕️",
        left_right_arrow: "↔️",
        arrow_right_hook: "↪️",
        leftwards_arrow_with_hook: "↩️",
        arrow_heading_up: "⤴️",
        arrow_heading_down: "⤵️",
        twisted_rightwards_arrows: "🔀",
        repeat: "🔁",
        repeat_one: "🔂",
        arrows_counterclockwise: "🔄",
        arrows_clockwise: "🔃",
        musical_note: "🎵",
        notes: "🎶",
        heavy_plus_sign: "➕",
        heavy_minus_sign: "➖",
        heavy_division_sign: "➗",
        heavy_multiplication_x: "✖️",
        heavy_dollar_sign: "💲",
        currency_exchange: "💱",
        tm: "™️",
        copyright: "©️",
        registered: "®️",
        wavy_dash: "〰️",
        curly_loop: "➰",
        loop: "➿",
        end: "🔚",
        back: "🔙",
        on: "🔛",
        top: "🔝",
        soon: "🔜",
        heavy_check_mark: "✔️",
        ballot_box_with_check: "☑️",
        radio_button: "🔘",
        white_circle: "⚪️",
        black_circle: "⚫️",
        red_circle: "🔴",
        large_blue_circle: "🔵",
        small_red_triangle: "🔺",
        small_red_triangle_down: "🔻",
        small_orange_diamond: "🔸",
        small_blue_diamond: "🔹",
        large_orange_diamond: "🔶",
        large_blue_diamond: "🔷",
        white_square_button: "🔳",
        black_square_button: "🔲",
        black_small_square: "▪️",
        white_small_square: "▫️",
        black_medium_small_square: "◾️",
        white_medium_small_square: "◽️",
        black_medium_square: "◼️",
        white_medium_square: "◻️",
        black_large_square: "⬛️",
        white_large_square: "⬜️",
        speaker: "🔈",
        mute: "🔇",
        sound: "🔉",
        loud_sound: "🔊",
        bell: "🔔",
        no_bell: "🔕",
        mega: "📣",
        loudspeaker: "📢",
        eye_speech_bubble: "👁‍🗨",
        speech_balloon: "💬",
        thought_balloon: "💭",
        right_anger_bubble: "🗯",
        spades: "♠️",
        clubs: "♣️",
        hearts: "♥️",
        diamonds: "♦️",
        black_joker: "🃏",
        flower_playing_cards: "🎴",
        mahjong: "🀄️",
        clock1: "🕐",
        clock2: "🕑",
        clock3: "🕒",
        clock4: "🕓",
        clock5: "🕔",
        clock6: "🕕",
        clock7: "🕖",
        clock8: "🕗",
        clock9: "🕘",
        clock10: "🕙",
        clock11: "🕚",
        clock12: "🕛",
        clock130: "🕜",
        clock230: "🕝",
        clock330: "🕞",
        clock430: "🕟",
        clock530: "🕠",
        clock630: "🕡",
        clock730: "🕢",
        clock830: "🕣",
        clock930: "🕤",
        clock1030: "🕥",
        clock1130: "🕦",
        clock1230: "🕧",
        white_flag: "🏳️",
        black_flag: "🏴",
        checkered_flag: "🏁",
        triangular_flag_on_post: "🚩",
        rainbow_flag: "🏳️‍🌈",
        afghanistan: "🇦🇫",
        aland_islands: "🇦🇽",
        albania: "🇦🇱",
        algeria: "🇩🇿",
        american_samoa: "🇦🇸",
        andorra: "🇦🇩",
        angola: "🇦🇴",
        anguilla: "🇦🇮",
        antarctica: "🇦🇶",
        antigua_barbuda: "🇦🇬",
        argentina: "🇦🇷",
        armenia: "🇦🇲",
        aruba: "🇦🇼",
        australia: "🇦🇺",
        austria: "🇦🇹",
        azerbaijan: "🇦🇿",
        bahamas: "🇧🇸",
        bahrain: "🇧🇭",
        bangladesh: "🇧🇩",
        barbados: "🇧🇧",
        belarus: "🇧🇾",
        belgium: "🇧🇪",
        belize: "🇧🇿",
        benin: "🇧🇯",
        bermuda: "🇧🇲",
        bhutan: "🇧🇹",
        bolivia: "🇧🇴",
        caribbean_netherlands: "🇧🇶",
        bosnia_herzegovina: "🇧🇦",
        botswana: "🇧🇼",
        brazil: "🇧🇷",
        british_indian_ocean_territory: "🇮🇴",
        british_virgin_islands: "🇻🇬",
        brunei: "🇧🇳",
        bulgaria: "🇧🇬",
        burkina_faso: "🇧🇫",
        burundi: "🇧🇮",
        cape_verde: "🇨🇻",
        cambodia: "🇰🇭",
        cameroon: "🇨🇲",
        canada: "🇨🇦",
        canary_islands: "🇮🇨",
        cayman_islands: "🇰🇾",
        central_african_republic: "🇨🇫",
        chad: "🇹🇩",
        chile: "🇨🇱",
        cn: "🇨🇳",
        christmas_island: "🇨🇽",
        cocos_islands: "🇨🇨",
        colombia: "🇨🇴",
        comoros: "🇰🇲",
        congo_brazzaville: "🇨🇬",
        congo_kinshasa: "🇨🇩",
        cook_islands: "🇨🇰",
        costa_rica: "🇨🇷",
        cote_divoire: "🇨🇮",
        croatia: "🇭🇷",
        cuba: "🇨🇺",
        curacao: "🇨🇼",
        cyprus: "🇨🇾",
        czech_republic: "🇨🇿",
        denmark: "🇩🇰",
        djibouti: "🇩🇯",
        dominica: "🇩🇲",
        dominican_republic: "🇩🇴",
        ecuador: "🇪🇨",
        egypt: "🇪🇬",
        el_salvador: "🇸🇻",
        equatorial_guinea: "🇬🇶",
        eritrea: "🇪🇷",
        estonia: "🇪🇪",
        ethiopia: "🇪🇹",
        eu: "🇪🇺",
        european_union: "🇪🇺",
        falkland_islands: "🇫🇰",
        faroe_islands: "🇫🇴",
        fiji: "🇫🇯",
        finland: "🇫🇮",
        fr: "🇫🇷",
        french_guiana: "🇬🇫",
        french_polynesia: "🇵🇫",
        french_southern_territories: "🇹🇫",
        gabon: "🇬🇦",
        gambia: "🇬🇲",
        georgia: "🇬🇪",
        de: "🇩🇪",
        ghana: "🇬🇭",
        gibraltar: "🇬🇮",
        greece: "🇬🇷",
        greenland: "🇬🇱",
        grenada: "🇬🇩",
        guadeloupe: "🇬🇵",
        guam: "🇬🇺",
        guatemala: "🇬🇹",
        guernsey: "🇬🇬",
        guinea: "🇬🇳",
        guinea_bissau: "🇬🇼",
        guyana: "🇬🇾",
        haiti: "🇭🇹",
        honduras: "🇭🇳",
        hong_kong: "🇭🇰",
        hungary: "🇭🇺",
        iceland: "🇮🇸",
        india: "🇮🇳",
        indonesia: "🇮🇩",
        iran: "🇮🇷",
        iraq: "🇮🇶",
        ireland: "🇮🇪",
        isle_of_man: "🇮🇲",
        israel: "🇮🇱",
        it: "🇮🇹",
        jamaica: "🇯🇲",
        jp: "🇯🇵",
        crossed_flags: "🎌",
        jersey: "🇯🇪",
        jordan: "🇯🇴",
        kazakhstan: "🇰🇿",
        kenya: "🇰🇪",
        kiribati: "🇰🇮",
        kosovo: "🇽🇰",
        kuwait: "🇰🇼",
        kyrgyzstan: "🇰🇬",
        laos: "🇱🇦",
        latvia: "🇱🇻",
        lebanon: "🇱🇧",
        lesotho: "🇱🇸",
        liberia: "🇱🇷",
        libya: "🇱🇾",
        liechtenstein: "🇱🇮",
        lithuania: "🇱🇹",
        luxembourg: "🇱🇺",
        macau: "🇲🇴",
        macedonia: "🇲🇰",
        madagascar: "🇲🇬",
        malawi: "🇲🇼",
        malaysia: "🇲🇾",
        maldives: "🇲🇻",
        mali: "🇲🇱",
        malta: "🇲🇹",
        marshall_islands: "🇲🇭",
        martinique: "🇲🇶",
        mauritania: "🇲🇷",
        mauritius: "🇲🇺",
        mayotte: "🇾🇹",
        mexico: "🇲🇽",
        micronesia: "🇫🇲",
        moldova: "🇲🇩",
        monaco: "🇲🇨",
        mongolia: "🇲🇳",
        montenegro: "🇲🇪",
        montserrat: "🇲🇸",
        morocco: "🇲🇦",
        mozambique: "🇲🇿",
        myanmar: "🇲🇲",
        namibia: "🇳🇦",
        nauru: "🇳🇷",
        nepal: "🇳🇵",
        netherlands: "🇳🇱",
        new_caledonia: "🇳🇨",
        new_zealand: "🇳🇿",
        nicaragua: "🇳🇮",
        niger: "🇳🇪",
        nigeria: "🇳🇬",
        niue: "🇳🇺",
        norfolk_island: "🇳🇫",
        northern_mariana_islands: "🇲🇵",
        north_korea: "🇰🇵",
        norway: "🇳🇴",
        oman: "🇴🇲",
        pakistan: "🇵🇰",
        palau: "🇵🇼",
        palestinian_territories: "🇵🇸",
        panama: "🇵🇦",
        papua_new_guinea: "🇵🇬",
        paraguay: "🇵🇾",
        peru: "🇵🇪",
        philippines: "🇵🇭",
        pitcairn_islands: "🇵🇳",
        poland: "🇵🇱",
        portugal: "🇵🇹",
        puerto_rico: "🇵🇷",
        qatar: "🇶🇦",
        reunion: "🇷🇪",
        romania: "🇷🇴",
        ru: "🇷🇺",
        rwanda: "🇷🇼",
        st_barthelemy: "🇧🇱",
        st_helena: "🇸🇭",
        st_kitts_nevis: "🇰🇳",
        st_lucia: "🇱🇨",
        st_pierre_miquelon: "🇵🇲",
        st_vincent_grenadines: "🇻🇨",
        samoa: "🇼🇸",
        san_marino: "🇸🇲",
        sao_tome_principe: "🇸🇹",
        saudi_arabia: "🇸🇦",
        senegal: "🇸🇳",
        serbia: "🇷🇸",
        seychelles: "🇸🇨",
        sierra_leone: "🇸🇱",
        singapore: "🇸🇬",
        sint_maarten: "🇸🇽",
        slovakia: "🇸🇰",
        slovenia: "🇸🇮",
        solomon_islands: "🇸🇧",
        somalia: "🇸🇴",
        south_africa: "🇿🇦",
        south_georgia_south_sandwich_islands: "🇬🇸",
        kr: "🇰🇷",
        south_sudan: "🇸🇸",
        es: "🇪🇸",
        sri_lanka: "🇱🇰",
        sudan: "🇸🇩",
        suriname: "🇸🇷",
        swaziland: "🇸🇿",
        sweden: "🇸🇪",
        switzerland: "🇨🇭",
        syria: "🇸🇾",
        taiwan: "🇹🇼",
        tajikistan: "🇹🇯",
        tanzania: "🇹🇿",
        thailand: "🇹🇭",
        timor_leste: "🇹🇱",
        togo: "🇹🇬",
        tokelau: "🇹🇰",
        tonga: "🇹🇴",
        trinidad_tobago: "🇹🇹",
        tunisia: "🇹🇳",
        tr: "🇹🇷",
        turkmenistan: "🇹🇲",
        turks_caicos_islands: "🇹🇨",
        tuvalu: "🇹🇻",
        uganda: "🇺🇬",
        ukraine: "🇺🇦",
        united_arab_emirates: "🇦🇪",
        gb: "🇬🇧",
        uk: "🇬🇧",
        us: "🇺🇸",
        us_virgin_islands: "🇻🇮",
        uruguay: "🇺🇾",
        uzbekistan: "🇺🇿",
        vanuatu: "🇻🇺",
        vatican_city: "🇻🇦",
        venezuela: "🇻🇪",
        vietnam: "🇻🇳",
        wallis_futuna: "🇼🇫",
        western_sahara: "🇪🇭",
        yemen: "🇾🇪",
        zambia: "🇿🇲",
        zimbabwe: "🇿🇼",
      }),
        (r.data.happy = r.data.smile),
        (n.exports = r);
    }),
    (factory = function () {
      "use strict";
      var e =
          Object.freeze ||
          function (e) {
            return e;
          },
        t = e([
          "a",
          "abbr",
          "acronym",
          "address",
          "area",
          "article",
          "aside",
          "audio",
          "b",
          "bdi",
          "bdo",
          "big",
          "blink",
          "blockquote",
          "body",
          "br",
          "button",
          "canvas",
          "caption",
          "center",
          "cite",
          "code",
          "col",
          "colgroup",
          "content",
          "data",
          "datalist",
          "dd",
          "decorator",
          "del",
          "details",
          "dfn",
          "dir",
          "div",
          "dl",
          "dt",
          "element",
          "em",
          "fieldset",
          "figcaption",
          "figure",
          "font",
          "footer",
          "form",
          "h1",
          "h2",
          "h3",
          "h4",
          "h5",
          "h6",
          "head",
          "header",
          "hgroup",
          "hr",
          "html",
          "i",
          "img",
          "input",
          "ins",
          "kbd",
          "label",
          "legend",
          "li",
          "main",
          "map",
          "mark",
          "marquee",
          "menu",
          "menuitem",
          "meter",
          "nav",
          "nobr",
          "ol",
          "optgroup",
          "option",
          "output",
          "p",
          "pre",
          "progress",
          "q",
          "rp",
          "rt",
          "ruby",
          "s",
          "samp",
          "section",
          "select",
          "shadow",
          "small",
          "source",
          "spacer",
          "span",
          "strike",
          "strong",
          "style",
          "sub",
          "summary",
          "sup",
          "table",
          "tbody",
          "td",
          "template",
          "textarea",
          "tfoot",
          "th",
          "thead",
          "time",
          "tr",
          "track",
          "tt",
          "u",
          "ul",
          "var",
          "video",
          "wbr",
        ]),
        n = e([
          "svg",
          "a",
          "altglyph",
          "altglyphdef",
          "altglyphitem",
          "animatecolor",
          "animatemotion",
          "animatetransform",
          "audio",
          "canvas",
          "circle",
          "clippath",
          "defs",
          "desc",
          "ellipse",
          "filter",
          "font",
          "g",
          "glyph",
          "glyphref",
          "hkern",
          "image",
          "line",
          "lineargradient",
          "marker",
          "mask",
          "metadata",
          "mpath",
          "path",
          "pattern",
          "polygon",
          "polyline",
          "radialgradient",
          "rect",
          "stop",
          "style",
          "switch",
          "symbol",
          "text",
          "textpath",
          "title",
          "tref",
          "tspan",
          "video",
          "view",
          "vkern",
        ]),
        i = e([
          "feBlend",
          "feColorMatrix",
          "feComponentTransfer",
          "feComposite",
          "feConvolveMatrix",
          "feDiffuseLighting",
          "feDisplacementMap",
          "feDistantLight",
          "feFlood",
          "feFuncA",
          "feFuncB",
          "feFuncG",
          "feFuncR",
          "feGaussianBlur",
          "feMerge",
          "feMergeNode",
          "feMorphology",
          "feOffset",
          "fePointLight",
          "feSpecularLighting",
          "feSpotLight",
          "feTile",
          "feTurbulence",
        ]),
        r = e([
          "math",
          "menclose",
          "merror",
          "mfenced",
          "mfrac",
          "mglyph",
          "mi",
          "mlabeledtr",
          "mmultiscripts",
          "mn",
          "mo",
          "mover",
          "mpadded",
          "mphantom",
          "mroot",
          "mrow",
          "ms",
          "mspace",
          "msqrt",
          "mstyle",
          "msub",
          "msup",
          "msubsup",
          "mtable",
          "mtd",
          "mtext",
          "mtr",
          "munder",
          "munderover",
        ]),
        o = e(["#text"]),
        a =
          Object.freeze ||
          function (e) {
            return e;
          },
        s = a([
          "accept",
          "action",
          "align",
          "alt",
          "autocomplete",
          "background",
          "bgcolor",
          "border",
          "cellpadding",
          "cellspacing",
          "checked",
          "cite",
          "class",
          "clear",
          "color",
          "cols",
          "colspan",
          "controls",
          "coords",
          "crossorigin",
          "datetime",
          "default",
          "dir",
          "disabled",
          "download",
          "enctype",
          "face",
          "for",
          "headers",
          "height",
          "hidden",
          "high",
          "href",
          "hreflang",
          "id",
          "integrity",
          "ismap",
          "label",
          "lang",
          "list",
          "loop",
          "low",
          "max",
          "maxlength",
          "media",
          "method",
          "min",
          "minlength",
          "multiple",
          "name",
          "noshade",
          "novalidate",
          "nowrap",
          "open",
          "optimum",
          "pattern",
          "placeholder",
          "poster",
          "preload",
          "pubdate",
          "radiogroup",
          "readonly",
          "rel",
          "required",
          "rev",
          "reversed",
          "role",
          "rows",
          "rowspan",
          "spellcheck",
          "scope",
          "selected",
          "shape",
          "size",
          "sizes",
          "span",
          "srclang",
          "start",
          "src",
          "srcset",
          "step",
          "style",
          "summary",
          "tabindex",
          "title",
          "type",
          "usemap",
          "valign",
          "value",
          "width",
          "xmlns",
        ]),
        l = a([
          "accent-height",
          "accumulate",
          "additive",
          "alignment-baseline",
          "ascent",
          "attributename",
          "attributetype",
          "azimuth",
          "basefrequency",
          "baseline-shift",
          "begin",
          "bias",
          "by",
          "class",
          "clip",
          "clip-path",
          "clip-rule",
          "color",
          "color-interpolation",
          "color-interpolation-filters",
          "color-profile",
          "color-rendering",
          "cx",
          "cy",
          "d",
          "dx",
          "dy",
          "diffuseconstant",
          "direction",
          "display",
          "divisor",
          "dur",
          "edgemode",
          "elevation",
          "end",
          "fill",
          "fill-opacity",
          "fill-rule",
          "filter",
          "filterunits",
          "flood-color",
          "flood-opacity",
          "font-family",
          "font-size",
          "font-size-adjust",
          "font-stretch",
          "font-style",
          "font-variant",
          "font-weight",
          "fx",
          "fy",
          "g1",
          "g2",
          "glyph-name",
          "glyphref",
          "gradientunits",
          "gradienttransform",
          "height",
          "href",
          "id",
          "image-rendering",
          "in",
          "in2",
          "k",
          "k1",
          "k2",
          "k3",
          "k4",
          "kerning",
          "keypoints",
          "keysplines",
          "keytimes",
          "lang",
          "lengthadjust",
          "letter-spacing",
          "kernelmatrix",
          "kernelunitlength",
          "lighting-color",
          "local",
          "marker-end",
          "marker-mid",
          "marker-start",
          "markerheight",
          "markerunits",
          "markerwidth",
          "maskcontentunits",
          "maskunits",
          "max",
          "mask",
          "media",
          "method",
          "mode",
          "min",
          "name",
          "numoctaves",
          "offset",
          "operator",
          "opacity",
          "order",
          "orient",
          "orientation",
          "origin",
          "overflow",
          "paint-order",
          "path",
          "pathlength",
          "patterncontentunits",
          "patterntransform",
          "patternunits",
          "points",
          "preservealpha",
          "preserveaspectratio",
          "primitiveunits",
          "r",
          "rx",
          "ry",
          "radius",
          "refx",
          "refy",
          "repeatcount",
          "repeatdur",
          "restart",
          "result",
          "rotate",
          "scale",
          "seed",
          "shape-rendering",
          "specularconstant",
          "specularexponent",
          "spreadmethod",
          "stddeviation",
          "stitchtiles",
          "stop-color",
          "stop-opacity",
          "stroke-dasharray",
          "stroke-dashoffset",
          "stroke-linecap",
          "stroke-linejoin",
          "stroke-miterlimit",
          "stroke-opacity",
          "stroke",
          "stroke-width",
          "style",
          "surfacescale",
          "tabindex",
          "targetx",
          "targety",
          "transform",
          "text-anchor",
          "text-decoration",
          "text-rendering",
          "textlength",
          "type",
          "u1",
          "u2",
          "unicode",
          "values",
          "viewbox",
          "visibility",
          "version",
          "vert-adv-y",
          "vert-origin-x",
          "vert-origin-y",
          "width",
          "word-spacing",
          "wrap",
          "writing-mode",
          "xchannelselector",
          "ychannelselector",
          "x",
          "x1",
          "x2",
          "xmlns",
          "y",
          "y1",
          "y2",
          "z",
          "zoomandpan",
        ]),
        c = a([
          "accent",
          "accentunder",
          "align",
          "bevelled",
          "close",
          "columnsalign",
          "columnlines",
          "columnspan",
          "denomalign",
          "depth",
          "dir",
          "display",
          "displaystyle",
          "encoding",
          "fence",
          "frame",
          "height",
          "href",
          "id",
          "largeop",
          "length",
          "linethickness",
          "lspace",
          "lquote",
          "mathbackground",
          "mathcolor",
          "mathsize",
          "mathvariant",
          "maxsize",
          "minsize",
          "movablelimits",
          "notation",
          "numalign",
          "open",
          "rowalign",
          "rowlines",
          "rowspacing",
          "rowspan",
          "rspace",
          "rquote",
          "scriptlevel",
          "scriptminsize",
          "scriptsizemultiplier",
          "selection",
          "separator",
          "separators",
          "stretchy",
          "subscriptshift",
          "supscriptshift",
          "symmetric",
          "voffset",
          "width",
          "xmlns",
        ]),
        d = a([
          "xlink:href",
          "xml:id",
          "xlink:title",
          "xml:space",
          "xmlns:xlink",
        ]),
        u = Object.hasOwnProperty,
        h = Object.setPrototypeOf,
        p = ("undefined" != typeof Reflect && Reflect).apply;
      function f(e, t) {
        h && h(e, null);
        for (var n = t.length; n--; ) {
          var i = t[n];
          if ("string" == typeof i) {
            var r = i.toLowerCase();
            r !== i && (Object.isFrozen(t) || (t[n] = r), (i = r));
          }
          e[i] = !0;
        }
        return e;
      }
      function m(e) {
        var t = {},
          n = void 0;
        for (n in e) p(u, e, [n]) && (t[n] = e[n]);
        return t;
      }
      p ||
        (p = function (e, t, n) {
          return e.apply(t, n);
        });
      var g =
          Object.seal ||
          function (e) {
            return e;
          },
        v = g(/\{\{[\s\S]*|[\s\S]*\}\}/gm),
        y = g(/<%[\s\S]*|[\s\S]*%>/gm),
        b = g(/^data-[\-\w.\u00B7-\uFFFF]/),
        w = g(/^aria-[\-\w]+$/),
        x = g(
          /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i
        ),
        C = g(/^(?:\w+script|data):/i),
        F = g(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g),
        S =
          "function" == typeof Symbol && "symbol" == typeof Symbol.iterator
            ? function (e) {
                return typeof e;
              }
            : function (e) {
                return e &&
                  "function" == typeof Symbol &&
                  e.constructor === Symbol &&
                  e !== Symbol.prototype
                  ? "symbol"
                  : typeof e;
              };
      function k(e) {
        if (Array.isArray(e)) {
          for (var t = 0, n = Array(e.length); t < e.length; t++) n[t] = e[t];
          return n;
        }
        return Array.from(e);
      }
      var E = ("undefined" != typeof Reflect && Reflect).apply,
        T = Array.prototype.slice,
        _ = Object.freeze,
        A = function () {
          return "undefined" == typeof window ? null : window;
        };
      E ||
        (E = function (e, t, n) {
          return e.apply(t, n);
        });
      var M = function (e, t) {
        if (
          "object" !== (void 0 === e ? "undefined" : S(e)) ||
          "function" != typeof e.createPolicy
        )
          return null;
        var n = null;
        t.currentScript &&
          t.currentScript.hasAttribute("data-tt-policy-suffix") &&
          (n = t.currentScript.getAttribute("data-tt-policy-suffix"));
        var i = "dompurify" + (n ? "#" + n : "");
        try {
          return e.createPolicy(i, {
            createHTML: function (e) {
              return e;
            },
          });
        } catch (e) {
          return (
            console.warn("TrustedTypes policy " + i + " could not be created."),
            null
          );
        }
      };
      return (function e() {
        var a =
            arguments.length > 0 && void 0 !== arguments[0]
              ? arguments[0]
              : A(),
          u = function (t) {
            return e(t);
          };
        if (
          ((u.version = "2.0.7"),
          (u.removed = []),
          !a || !a.document || 9 !== a.document.nodeType)
        )
          return (u.isSupported = !1), u;
        var h = a.document,
          p = !1,
          g = !1,
          L = a.document,
          N = a.DocumentFragment,
          D = a.HTMLTemplateElement,
          B = a.Node,
          R = a.NodeFilter,
          P = a.NamedNodeMap,
          I = void 0 === P ? a.NamedNodeMap || a.MozNamedAttrMap : P,
          O = a.Text,
          $ = a.Comment,
          H = a.DOMParser,
          U = a.TrustedTypes;
        if ("function" == typeof D) {
          var j = L.createElement("template");
          j.content && j.content.ownerDocument && (L = j.content.ownerDocument);
        }
        var q = M(U, h),
          W = q ? q.createHTML("") : "",
          z = L,
          V = z.implementation,
          J = z.createNodeIterator,
          K = z.getElementsByTagName,
          Y = z.createDocumentFragment,
          G = h.importNode,
          Q = {};
        u.isSupported =
          V && void 0 !== V.createHTMLDocument && 9 !== L.documentMode;
        var X = v,
          Z = y,
          ee = b,
          te = w,
          ne = C,
          ie = F,
          re = x,
          oe = null,
          ae = f({}, [].concat(k(t), k(n), k(i), k(r), k(o))),
          se = null,
          le = f({}, [].concat(k(s), k(l), k(c), k(d))),
          ce = null,
          de = null,
          ue = !0,
          he = !0,
          pe = !1,
          fe = !1,
          me = !1,
          ge = !1,
          ve = !1,
          ye = !1,
          be = !1,
          we = !1,
          xe = !1,
          Ce = !1,
          Fe = !0,
          Se = !0,
          ke = !1,
          Ee = {},
          Te = f({}, [
            "annotation-xml",
            "audio",
            "colgroup",
            "desc",
            "foreignobject",
            "head",
            "iframe",
            "math",
            "mi",
            "mn",
            "mo",
            "ms",
            "mtext",
            "noembed",
            "noframes",
            "plaintext",
            "script",
            "style",
            "svg",
            "template",
            "thead",
            "title",
            "video",
            "xmp",
          ]),
          _e = f({}, ["audio", "video", "img", "source", "image", "iframe"]),
          Ae = null,
          Me = f({}, [
            "alt",
            "class",
            "for",
            "id",
            "label",
            "name",
            "pattern",
            "placeholder",
            "summary",
            "title",
            "value",
            "style",
            "xmlns",
          ]),
          Le = null,
          Ne = L.createElement("form"),
          De = function (e) {
            (Le && Le === e) ||
              ((e && "object" === (void 0 === e ? "undefined" : S(e))) ||
                (e = {}),
              (oe = "ALLOWED_TAGS" in e ? f({}, e.ALLOWED_TAGS) : ae),
              (se = "ALLOWED_ATTR" in e ? f({}, e.ALLOWED_ATTR) : le),
              (Ae =
                "ADD_URI_SAFE_ATTR" in e ? f(m(Me), e.ADD_URI_SAFE_ATTR) : Me),
              (ce = "FORBID_TAGS" in e ? f({}, e.FORBID_TAGS) : {}),
              (de = "FORBID_ATTR" in e ? f({}, e.FORBID_ATTR) : {}),
              (Ee = "USE_PROFILES" in e && e.USE_PROFILES),
              (ue = !1 !== e.ALLOW_ARIA_ATTR),
              (he = !1 !== e.ALLOW_DATA_ATTR),
              (pe = e.ALLOW_UNKNOWN_PROTOCOLS || !1),
              (fe = e.SAFE_FOR_JQUERY || !1),
              (me = e.SAFE_FOR_TEMPLATES || !1),
              (ge = e.WHOLE_DOCUMENT || !1),
              (be = e.RETURN_DOM || !1),
              (we = e.RETURN_DOM_FRAGMENT || !1),
              (xe = e.RETURN_DOM_IMPORT || !1),
              (Ce = e.RETURN_TRUSTED_TYPE || !1),
              (ye = e.FORCE_BODY || !1),
              (Fe = !1 !== e.SANITIZE_DOM),
              (Se = !1 !== e.KEEP_CONTENT),
              (ke = e.IN_PLACE || !1),
              (re = e.ALLOWED_URI_REGEXP || re),
              me && (he = !1),
              we && (be = !0),
              Ee &&
                ((oe = f({}, [].concat(k(o)))),
                (se = []),
                !0 === Ee.html && (f(oe, t), f(se, s)),
                !0 === Ee.svg && (f(oe, n), f(se, l), f(se, d)),
                !0 === Ee.svgFilters && (f(oe, i), f(se, l), f(se, d)),
                !0 === Ee.mathMl && (f(oe, r), f(se, c), f(se, d))),
              e.ADD_TAGS && (oe === ae && (oe = m(oe)), f(oe, e.ADD_TAGS)),
              e.ADD_ATTR && (se === le && (se = m(se)), f(se, e.ADD_ATTR)),
              e.ADD_URI_SAFE_ATTR && f(Ae, e.ADD_URI_SAFE_ATTR),
              Se && (oe["#text"] = !0),
              ge && f(oe, ["html", "head", "body"]),
              oe.table && (f(oe, ["tbody"]), delete ce.tbody),
              _ && _(e),
              (Le = e));
          },
          Be = function (e) {
            u.removed.push({ element: e });
            try {
              e.parentNode.removeChild(e);
            } catch (t) {
              e.outerHTML = W;
            }
          },
          Re = function (e, t) {
            try {
              u.removed.push({ attribute: t.getAttributeNode(e), from: t });
            } catch (e) {
              u.removed.push({ attribute: null, from: t });
            }
            t.removeAttribute(e);
          },
          Pe = function (e) {
            var t = void 0,
              n = void 0;
            if (ye) e = "<remove></remove>" + e;
            else {
              var i = e.match(/^[\s]+/);
              (n = i && i[0]) && (e = e.slice(n.length));
            }
            if (p)
              try {
                t = new H().parseFromString(e, "text/html");
              } catch (e) {}
            if ((g && f(ce, ["title"]), !t || !t.documentElement)) {
              var r = (t = V.createHTMLDocument("")).body;
              r.parentNode.removeChild(r.parentNode.firstElementChild),
                (r.outerHTML = q ? q.createHTML(e) : e);
            }
            return (
              e &&
                n &&
                t.body.insertBefore(
                  L.createTextNode(n),
                  t.body.childNodes[0] || null
                ),
              K.call(t, ge ? "html" : "body")[0]
            );
          };
        u.isSupported &&
          ((function () {
            try {
              Pe(
                '<svg><p><textarea><img src="</textarea><img src=x abc=1//">'
              ).querySelector("svg img") && (p = !0);
            } catch (e) {}
          })(),
          (function () {
            try {
              var e = Pe("<x/><title>&lt;/title&gt;&lt;img&gt;");
              /<\/title/.test(e.querySelector("title").innerHTML) && (g = !0);
            } catch (e) {}
          })());
        var Ie = function (e) {
            return J.call(
              e.ownerDocument || e,
              e,
              R.SHOW_ELEMENT | R.SHOW_COMMENT | R.SHOW_TEXT,
              function () {
                return R.FILTER_ACCEPT;
              },
              !1
            );
          },
          Oe = function (e) {
            return "object" === (void 0 === B ? "undefined" : S(B))
              ? e instanceof B
              : e &&
                  "object" === (void 0 === e ? "undefined" : S(e)) &&
                  "number" == typeof e.nodeType &&
                  "string" == typeof e.nodeName;
          },
          $e = function (e, t, n) {
            Q[e] &&
              Q[e].forEach(function (e) {
                e.call(u, t, n, Le);
              });
          },
          He = function (e) {
            var t,
              n = void 0;
            if (
              ($e("beforeSanitizeElements", e, null),
              !(
                (t = e) instanceof O ||
                t instanceof $ ||
                ("string" == typeof t.nodeName &&
                  "string" == typeof t.textContent &&
                  "function" == typeof t.removeChild &&
                  t.attributes instanceof I &&
                  "function" == typeof t.removeAttribute &&
                  "function" == typeof t.setAttribute &&
                  "string" == typeof t.namespaceURI)
              ))
            )
              return Be(e), !0;
            var i = e.nodeName.toLowerCase();
            if (
              ($e("uponSanitizeElement", e, { tagName: i, allowedTags: oe }),
              ("svg" === i || "math" === i) &&
                0 !== e.querySelectorAll("p, br").length)
            )
              return Be(e), !0;
            if (!oe[i] || ce[i]) {
              if (Se && !Te[i] && "function" == typeof e.insertAdjacentHTML)
                try {
                  var r = e.innerHTML;
                  e.insertAdjacentHTML("AfterEnd", q ? q.createHTML(r) : r);
                } catch (e) {}
              return Be(e), !0;
            }
            return "noscript" === i && /<\/noscript/i.test(e.innerHTML)
              ? (Be(e), !0)
              : "noembed" === i && /<\/noembed/i.test(e.innerHTML)
              ? (Be(e), !0)
              : (!fe ||
                  e.firstElementChild ||
                  (e.content && e.content.firstElementChild) ||
                  !/</g.test(e.textContent) ||
                  (u.removed.push({ element: e.cloneNode() }),
                  e.innerHTML
                    ? (e.innerHTML = e.innerHTML.replace(/</g, "&lt;"))
                    : (e.innerHTML = e.textContent.replace(/</g, "&lt;"))),
                me &&
                  3 === e.nodeType &&
                  ((n = (n = (n = e.textContent).replace(X, " ")).replace(
                    Z,
                    " "
                  )),
                  e.textContent !== n &&
                    (u.removed.push({ element: e.cloneNode() }),
                    (e.textContent = n))),
                $e("afterSanitizeElements", e, null),
                !1);
          },
          Ue = function (e, t, n) {
            if (Fe && ("id" === t || "name" === t) && (n in L || n in Ne))
              return !1;
            if (he && ee.test(t));
            else if (ue && te.test(t));
            else {
              if (!se[t] || de[t]) return !1;
              if (Ae[t]);
              else if (re.test(n.replace(ie, "")));
              else if (
                ("src" !== t && "xlink:href" !== t && "href" !== t) ||
                "script" === e ||
                0 !== n.indexOf("data:") ||
                !_e[e]
              )
                if (pe && !ne.test(n.replace(ie, "")));
                else if (n) return !1;
            }
            return !0;
          },
          je = function (e) {
            var t = void 0,
              n = void 0,
              i = void 0,
              r = void 0,
              o = void 0;
            $e("beforeSanitizeAttributes", e, null);
            var a = e.attributes;
            if (a) {
              var s = {
                attrName: "",
                attrValue: "",
                keepAttr: !0,
                allowedAttributes: se,
              };
              for (o = a.length; o--; ) {
                var l = (t = a[o]),
                  c = l.name,
                  d = l.namespaceURI;
                if (
                  ((n = t.value.trim()),
                  (i = c.toLowerCase()),
                  (s.attrName = i),
                  (s.attrValue = n),
                  (s.keepAttr = !0),
                  $e("uponSanitizeAttribute", e, s),
                  (n = s.attrValue),
                  "name" === i && "IMG" === e.nodeName && a.id)
                )
                  (r = a.id),
                    (a = E(T, a, [])),
                    Re("id", e),
                    Re(c, e),
                    a.indexOf(r) > o && e.setAttribute("id", r.value);
                else {
                  if (
                    "INPUT" === e.nodeName &&
                    "type" === i &&
                    "file" === n &&
                    s.keepAttr &&
                    (se[i] || !de[i])
                  )
                    continue;
                  "id" === c && e.setAttribute(c, ""), Re(c, e);
                }
                if (s.keepAttr)
                  if (
                    /svg|math/i.test(e.namespaceURI) &&
                    new RegExp(
                      "</(" + Object.keys(Te).join("|") + ")",
                      "i"
                    ).test(n)
                  )
                    Re(c, e);
                  else {
                    me && (n = (n = n.replace(X, " ")).replace(Z, " "));
                    var h = e.nodeName.toLowerCase();
                    if (Ue(h, i, n))
                      try {
                        d ? e.setAttributeNS(d, c, n) : e.setAttribute(c, n),
                          u.removed.pop();
                      } catch (e) {}
                  }
              }
              $e("afterSanitizeAttributes", e, null);
            }
          },
          qe = function e(t) {
            var n = void 0,
              i = Ie(t);
            for ($e("beforeSanitizeShadowDOM", t, null); (n = i.nextNode()); )
              $e("uponSanitizeShadowNode", n, null),
                He(n) || (n.content instanceof N && e(n.content), je(n));
            $e("afterSanitizeShadowDOM", t, null);
          };
        return (
          (u.sanitize = function (e, t) {
            var n = void 0,
              i = void 0,
              r = void 0,
              o = void 0,
              s = void 0;
            if ((e || (e = "\x3c!--\x3e"), "string" != typeof e && !Oe(e))) {
              if ("function" != typeof e.toString)
                throw new TypeError("toString is not a function");
              if ("string" != typeof (e = e.toString()))
                throw new TypeError("dirty is not a string, aborting");
            }
            if (!u.isSupported) {
              if (
                "object" === S(a.toStaticHTML) ||
                "function" == typeof a.toStaticHTML
              ) {
                if ("string" == typeof e) return a.toStaticHTML(e);
                if (Oe(e)) return a.toStaticHTML(e.outerHTML);
              }
              return e;
            }
            if ((ve || De(t), (u.removed = []), ke));
            else if (e instanceof B)
              1 ===
                (i = (n = Pe("\x3c!--\x3e")).ownerDocument.importNode(e, !0))
                  .nodeType && "BODY" === i.nodeName
                ? (n = i)
                : "HTML" === i.nodeName
                ? (n = i)
                : n.appendChild(i);
            else {
              if (!be && !me && !ge && Ce && -1 === e.indexOf("<"))
                return q ? q.createHTML(e) : e;
              if (!(n = Pe(e))) return be ? null : W;
            }
            n && ye && Be(n.firstChild);
            for (var l = Ie(ke ? e : n); (r = l.nextNode()); )
              (3 === r.nodeType && r === o) ||
                He(r) ||
                (r.content instanceof N && qe(r.content), je(r), (o = r));
            if (((o = null), ke)) return e;
            if (be) {
              if (we)
                for (s = Y.call(n.ownerDocument); n.firstChild; )
                  s.appendChild(n.firstChild);
              else s = n;
              return xe && (s = G.call(h, s, !0)), s;
            }
            var c = ge ? n.outerHTML : n.innerHTML;
            return (
              me && (c = (c = c.replace(X, " ")).replace(Z, " ")),
              q && Ce ? q.createHTML(c) : c
            );
          }),
          (u.setConfig = function (e) {
            De(e), (ve = !0);
          }),
          (u.clearConfig = function () {
            (Le = null), (ve = !1);
          }),
          (u.isValidAttribute = function (e, t, n) {
            Le || De({});
            var i = e.toLowerCase(),
              r = t.toLowerCase();
            return Ue(i, r, n);
          }),
          (u.addHook = function (e, t) {
            "function" == typeof t && ((Q[e] = Q[e] || []), Q[e].push(t));
          }),
          (u.removeHook = function (e) {
            Q[e] && Q[e].pop();
          }),
          (u.removeHooks = function (e) {
            Q[e] && (Q[e] = []);
          }),
          (u.removeAllHooks = function () {
            Q = {};
          }),
          u
        );
      })();
    }),
    "object" == typeof exports && void 0 !== module
      ? (module.exports = factory())
      : $__System.registerDynamic("16", [], !1, function (e, t, n) {
          return factory.call(this);
        }),
    $__System.registerDynamic("20", [], !0, function (e, t, n) {
      this || self;
      n.exports = (function () {
        "use strict";
        var e = navigator.userAgent,
          t = navigator.platform,
          n = /gecko\/\d/i.test(e),
          i = /MSIE \d/.test(e),
          r = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),
          o = /Edge\/(\d+)/.exec(e),
          a = i || r || o,
          s = a && (i ? document.documentMode || 6 : +(o || r)[1]),
          l = !o && /WebKit\//.test(e),
          c = l && /Qt\/\d+\.\d+/.test(e),
          d = !o && /Chrome\//.test(e),
          u = /Opera\//.test(e),
          h = /Apple Computer/.test(navigator.vendor),
          p = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),
          f = /PhantomJS/.test(e),
          m = !o && /AppleWebKit/.test(e) && /Mobile\/\w+/.test(e),
          g = /Android/.test(e),
          v =
            m ||
            g ||
            /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),
          y = m || /Mac/.test(t),
          b = /\bCrOS\b/.test(e),
          w = /win/i.test(t),
          x = u && e.match(/Version\/(\d*\.\d*)/);
        x && (x = Number(x[1])), x && x >= 15 && ((u = !1), (l = !0));
        var C = y && (c || (u && (null == x || x < 12.11))),
          F = n || (a && s >= 9);
        function S(e) {
          return new RegExp("(^|\\s)" + e + "(?:$|\\s)\\s*");
        }
        var k,
          E = function (e, t) {
            var n = e.className,
              i = S(t).exec(n);
            if (i) {
              var r = n.slice(i.index + i[0].length);
              e.className = n.slice(0, i.index) + (r ? i[1] + r : "");
            }
          };
        function T(e) {
          for (var t = e.childNodes.length; t > 0; --t)
            e.removeChild(e.firstChild);
          return e;
        }
        function _(e, t) {
          return T(e).appendChild(t);
        }
        function A(e, t, n, i) {
          var r = document.createElement(e);
          if (
            (n && (r.className = n),
            i && (r.style.cssText = i),
            "string" == typeof t)
          )
            r.appendChild(document.createTextNode(t));
          else if (t) for (var o = 0; o < t.length; ++o) r.appendChild(t[o]);
          return r;
        }
        function M(e, t, n, i) {
          var r = A(e, t, n, i);
          return r.setAttribute("role", "presentation"), r;
        }
        function L(e, t) {
          if ((3 == t.nodeType && (t = t.parentNode), e.contains))
            return e.contains(t);
          do {
            if ((11 == t.nodeType && (t = t.host), t == e)) return !0;
          } while ((t = t.parentNode));
        }
        function N() {
          var e;
          try {
            e = document.activeElement;
          } catch (t) {
            e = document.body || null;
          }
          for (; e && e.shadowRoot && e.shadowRoot.activeElement; )
            e = e.shadowRoot.activeElement;
          return e;
        }
        function D(e, t) {
          var n = e.className;
          S(t).test(n) || (e.className += (n ? " " : "") + t);
        }
        function B(e, t) {
          for (var n = e.split(" "), i = 0; i < n.length; i++)
            n[i] && !S(n[i]).test(t) && (t += " " + n[i]);
          return t;
        }
        k = document.createRange
          ? function (e, t, n, i) {
              var r = document.createRange();
              return r.setEnd(i || e, n), r.setStart(e, t), r;
            }
          : function (e, t, n) {
              var i = document.body.createTextRange();
              try {
                i.moveToElementText(e.parentNode);
              } catch (e) {
                return i;
              }
              return (
                i.collapse(!0),
                i.moveEnd("character", n),
                i.moveStart("character", t),
                i
              );
            };
        var R = function (e) {
          e.select();
        };
        function P(e) {
          var t = Array.prototype.slice.call(arguments, 1);
          return function () {
            return e.apply(null, t);
          };
        }
        function I(e, t, n) {
          for (var i in (t || (t = {}), e))
            !e.hasOwnProperty(i) ||
              (!1 === n && t.hasOwnProperty(i)) ||
              (t[i] = e[i]);
          return t;
        }
        function O(e, t, n, i, r) {
          null == t && -1 == (t = e.search(/[^\s\u00a0]/)) && (t = e.length);
          for (var o = i || 0, a = r || 0; ; ) {
            var s = e.indexOf("\t", o);
            if (s < 0 || s >= t) return a + (t - o);
            (a += s - o), (a += n - (a % n)), (o = s + 1);
          }
        }
        m
          ? (R = function (e) {
              (e.selectionStart = 0), (e.selectionEnd = e.value.length);
            })
          : a &&
            (R = function (e) {
              try {
                e.select();
              } catch (e) {}
            });
        var $ = function () {
          this.id = null;
        };
        function H(e, t) {
          for (var n = 0; n < e.length; ++n) if (e[n] == t) return n;
          return -1;
        }
        $.prototype.set = function (e, t) {
          clearTimeout(this.id), (this.id = setTimeout(t, e));
        };
        var U = 0,
          j = {
            toString: function () {
              return "CodeMirror.Pass";
            },
          },
          q = { scroll: !1 },
          W = { origin: "*mouse" },
          z = { origin: "+move" };
        function V(e, t, n) {
          for (var i = 0, r = 0; ; ) {
            var o = e.indexOf("\t", i);
            -1 == o && (o = e.length);
            var a = o - i;
            if (o == e.length || r + a >= t) return i + Math.min(a, t - r);
            if (((r += o - i), (i = o + 1), (r += n - (r % n)) >= t)) return i;
          }
        }
        var J = [""];
        function K(e) {
          for (; J.length <= e; ) J.push(Y(J) + " ");
          return J[e];
        }
        function Y(e) {
          return e[e.length - 1];
        }
        function G(e, t) {
          for (var n = [], i = 0; i < e.length; i++) n[i] = t(e[i], i);
          return n;
        }
        function Q() {}
        function X(e, t) {
          var n;
          return (
            Object.create
              ? (n = Object.create(e))
              : ((Q.prototype = e), (n = new Q())),
            t && I(t, n),
            n
          );
        }
        var Z =
          /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
        function ee(e) {
          return (
            /\w/.test(e) ||
            (e > "" && (e.toUpperCase() != e.toLowerCase() || Z.test(e)))
          );
        }
        function te(e, t) {
          return t
            ? !!(t.source.indexOf("\\w") > -1 && ee(e)) || t.test(e)
            : ee(e);
        }
        function ne(e) {
          for (var t in e) if (e.hasOwnProperty(t) && e[t]) return !1;
          return !0;
        }
        var ie =
          /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
        function re(e) {
          return e.charCodeAt(0) >= 768 && ie.test(e);
        }
        function oe(e, t, n) {
          for (; (n < 0 ? t > 0 : t < e.length) && re(e.charAt(t)); ) t += n;
          return t;
        }
        function ae(e, t, n) {
          for (;;) {
            if (Math.abs(t - n) <= 1) return e(t) ? t : n;
            var i = Math.floor((t + n) / 2);
            e(i) ? (n = i) : (t = i);
          }
        }
        function se(e, t) {
          if ((t -= e.first) < 0 || t >= e.size)
            throw new Error(
              "There is no line " + (t + e.first) + " in the document."
            );
          for (var n = e; !n.lines; )
            for (var i = 0; ; ++i) {
              var r = n.children[i],
                o = r.chunkSize();
              if (t < o) {
                n = r;
                break;
              }
              t -= o;
            }
          return n.lines[t];
        }
        function le(e, t, n) {
          var i = [],
            r = t.line;
          return (
            e.iter(t.line, n.line + 1, function (e) {
              var o = e.text;
              r == n.line && (o = o.slice(0, n.ch)),
                r == t.line && (o = o.slice(t.ch)),
                i.push(o),
                ++r;
            }),
            i
          );
        }
        function ce(e, t, n) {
          var i = [];
          return (
            e.iter(t, n, function (e) {
              i.push(e.text);
            }),
            i
          );
        }
        function de(e, t) {
          var n = t - e.height;
          if (n) for (var i = e; i; i = i.parent) i.height += n;
        }
        function ue(e) {
          if (null == e.parent) return null;
          for (
            var t = e.parent, n = H(t.lines, e), i = t.parent;
            i;
            t = i, i = i.parent
          )
            for (var r = 0; i.children[r] != t; ++r)
              n += i.children[r].chunkSize();
          return n + t.first;
        }
        function he(e, t) {
          var n = e.first;
          e: do {
            for (var i = 0; i < e.children.length; ++i) {
              var r = e.children[i],
                o = r.height;
              if (t < o) {
                e = r;
                continue e;
              }
              (t -= o), (n += r.chunkSize());
            }
            return n;
          } while (!e.lines);
          for (var a = 0; a < e.lines.length; ++a) {
            var s = e.lines[a].height;
            if (t < s) break;
            t -= s;
          }
          return n + a;
        }
        function pe(e, t) {
          return t >= e.first && t < e.first + e.size;
        }
        function fe(e, t) {
          return String(e.lineNumberFormatter(t + e.firstLineNumber));
        }
        function me(e, t, n) {
          if ((void 0 === n && (n = null), !(this instanceof me)))
            return new me(e, t, n);
          (this.line = e), (this.ch = t), (this.sticky = n);
        }
        function ge(e, t) {
          return e.line - t.line || e.ch - t.ch;
        }
        function ve(e, t) {
          return e.sticky == t.sticky && 0 == ge(e, t);
        }
        function ye(e) {
          return me(e.line, e.ch);
        }
        function be(e, t) {
          return ge(e, t) < 0 ? t : e;
        }
        function we(e, t) {
          return ge(e, t) < 0 ? e : t;
        }
        function xe(e, t) {
          return Math.max(e.first, Math.min(t, e.first + e.size - 1));
        }
        function Ce(e, t) {
          if (t.line < e.first) return me(e.first, 0);
          var n = e.first + e.size - 1;
          return t.line > n
            ? me(n, se(e, n).text.length)
            : (function (e, t) {
                var n = e.ch;
                return null == n || n > t
                  ? me(e.line, t)
                  : n < 0
                  ? me(e.line, 0)
                  : e;
              })(t, se(e, t.line).text.length);
        }
        function Fe(e, t) {
          for (var n = [], i = 0; i < t.length; i++) n[i] = Ce(e, t[i]);
          return n;
        }
        var Se = !1,
          ke = !1;
        function Ee(e, t, n) {
          (this.marker = e), (this.from = t), (this.to = n);
        }
        function Te(e, t) {
          if (e)
            for (var n = 0; n < e.length; ++n) {
              var i = e[n];
              if (i.marker == t) return i;
            }
        }
        function _e(e, t) {
          for (var n, i = 0; i < e.length; ++i)
            e[i] != t && (n || (n = [])).push(e[i]);
          return n;
        }
        function Ae(e, t) {
          if (t.full) return null;
          var n = pe(e, t.from.line) && se(e, t.from.line).markedSpans,
            i = pe(e, t.to.line) && se(e, t.to.line).markedSpans;
          if (!n && !i) return null;
          var r = t.from.ch,
            o = t.to.ch,
            a = 0 == ge(t.from, t.to),
            s = (function (e, t, n) {
              var i;
              if (e)
                for (var r = 0; r < e.length; ++r) {
                  var o = e[r],
                    a = o.marker;
                  if (
                    null == o.from ||
                    (a.inclusiveLeft ? o.from <= t : o.from < t) ||
                    (o.from == t &&
                      "bookmark" == a.type &&
                      (!n || !o.marker.insertLeft))
                  ) {
                    var s =
                      null == o.to || (a.inclusiveRight ? o.to >= t : o.to > t);
                    (i || (i = [])).push(new Ee(a, o.from, s ? null : o.to));
                  }
                }
              return i;
            })(n, r, a),
            l = (function (e, t, n) {
              var i;
              if (e)
                for (var r = 0; r < e.length; ++r) {
                  var o = e[r],
                    a = o.marker;
                  if (
                    null == o.to ||
                    (a.inclusiveRight ? o.to >= t : o.to > t) ||
                    (o.from == t &&
                      "bookmark" == a.type &&
                      (!n || o.marker.insertLeft))
                  ) {
                    var s =
                      null == o.from ||
                      (a.inclusiveLeft ? o.from <= t : o.from < t);
                    (i || (i = [])).push(
                      new Ee(
                        a,
                        s ? null : o.from - t,
                        null == o.to ? null : o.to - t
                      )
                    );
                  }
                }
              return i;
            })(i, o, a),
            c = 1 == t.text.length,
            d = Y(t.text).length + (c ? r : 0);
          if (s)
            for (var u = 0; u < s.length; ++u) {
              var h = s[u];
              if (null == h.to) {
                var p = Te(l, h.marker);
                p ? c && (h.to = null == p.to ? null : p.to + d) : (h.to = r);
              }
            }
          if (l)
            for (var f = 0; f < l.length; ++f) {
              var m = l[f];
              if ((null != m.to && (m.to += d), null == m.from))
                Te(s, m.marker) || ((m.from = d), c && (s || (s = [])).push(m));
              else (m.from += d), c && (s || (s = [])).push(m);
            }
          s && (s = Me(s)), l && l != s && (l = Me(l));
          var g = [s];
          if (!c) {
            var v,
              y = t.text.length - 2;
            if (y > 0 && s)
              for (var b = 0; b < s.length; ++b)
                null == s[b].to &&
                  (v || (v = [])).push(new Ee(s[b].marker, null, null));
            for (var w = 0; w < y; ++w) g.push(v);
            g.push(l);
          }
          return g;
        }
        function Me(e) {
          for (var t = 0; t < e.length; ++t) {
            var n = e[t];
            null != n.from &&
              n.from == n.to &&
              !1 !== n.marker.clearWhenEmpty &&
              e.splice(t--, 1);
          }
          return e.length ? e : null;
        }
        function Le(e) {
          var t = e.markedSpans;
          if (t) {
            for (var n = 0; n < t.length; ++n) t[n].marker.detachLine(e);
            e.markedSpans = null;
          }
        }
        function Ne(e, t) {
          if (t) {
            for (var n = 0; n < t.length; ++n) t[n].marker.attachLine(e);
            e.markedSpans = t;
          }
        }
        function De(e) {
          return e.inclusiveLeft ? -1 : 0;
        }
        function Be(e) {
          return e.inclusiveRight ? 1 : 0;
        }
        function Re(e, t) {
          var n = e.lines.length - t.lines.length;
          if (0 != n) return n;
          var i = e.find(),
            r = t.find(),
            o = ge(i.from, r.from) || De(e) - De(t);
          if (o) return -o;
          var a = ge(i.to, r.to) || Be(e) - Be(t);
          return a || t.id - e.id;
        }
        function Pe(e, t) {
          var n,
            i = ke && e.markedSpans;
          if (i)
            for (var r = void 0, o = 0; o < i.length; ++o)
              (r = i[o]).marker.collapsed &&
                null == (t ? r.from : r.to) &&
                (!n || Re(n, r.marker) < 0) &&
                (n = r.marker);
          return n;
        }
        function Ie(e) {
          return Pe(e, !0);
        }
        function Oe(e) {
          return Pe(e, !1);
        }
        function $e(e, t, n, i, r) {
          var o = se(e, t),
            a = ke && o.markedSpans;
          if (a)
            for (var s = 0; s < a.length; ++s) {
              var l = a[s];
              if (l.marker.collapsed) {
                var c = l.marker.find(0),
                  d = ge(c.from, n) || De(l.marker) - De(r),
                  u = ge(c.to, i) || Be(l.marker) - Be(r);
                if (
                  !((d >= 0 && u <= 0) || (d <= 0 && u >= 0)) &&
                  ((d <= 0 &&
                    (l.marker.inclusiveRight && r.inclusiveLeft
                      ? ge(c.to, n) >= 0
                      : ge(c.to, n) > 0)) ||
                    (d >= 0 &&
                      (l.marker.inclusiveRight && r.inclusiveLeft
                        ? ge(c.from, i) <= 0
                        : ge(c.from, i) < 0)))
                )
                  return !0;
              }
            }
        }
        function He(e) {
          for (var t; (t = Ie(e)); ) e = t.find(-1, !0).line;
          return e;
        }
        function Ue(e, t) {
          var n = se(e, t),
            i = He(n);
          return n == i ? t : ue(i);
        }
        function je(e, t) {
          if (t > e.lastLine()) return t;
          var n,
            i = se(e, t);
          if (!qe(e, i)) return t;
          for (; (n = Oe(i)); ) i = n.find(1, !0).line;
          return ue(i) + 1;
        }
        function qe(e, t) {
          var n = ke && t.markedSpans;
          if (n)
            for (var i = void 0, r = 0; r < n.length; ++r)
              if ((i = n[r]).marker.collapsed) {
                if (null == i.from) return !0;
                if (
                  !i.marker.widgetNode &&
                  0 == i.from &&
                  i.marker.inclusiveLeft &&
                  We(e, t, i)
                )
                  return !0;
              }
        }
        function We(e, t, n) {
          if (null == n.to) {
            var i = n.marker.find(1, !0);
            return We(e, i.line, Te(i.line.markedSpans, n.marker));
          }
          if (n.marker.inclusiveRight && n.to == t.text.length) return !0;
          for (var r = void 0, o = 0; o < t.markedSpans.length; ++o)
            if (
              (r = t.markedSpans[o]).marker.collapsed &&
              !r.marker.widgetNode &&
              r.from == n.to &&
              (null == r.to || r.to != n.from) &&
              (r.marker.inclusiveLeft || n.marker.inclusiveRight) &&
              We(e, t, r)
            )
              return !0;
        }
        function ze(e) {
          for (
            var t = 0, n = (e = He(e)).parent, i = 0;
            i < n.lines.length;
            ++i
          ) {
            var r = n.lines[i];
            if (r == e) break;
            t += r.height;
          }
          for (var o = n.parent; o; o = (n = o).parent)
            for (var a = 0; a < o.children.length; ++a) {
              var s = o.children[a];
              if (s == n) break;
              t += s.height;
            }
          return t;
        }
        function Ve(e) {
          if (0 == e.height) return 0;
          for (var t, n = e.text.length, i = e; (t = Ie(i)); ) {
            var r = t.find(0, !0);
            (i = r.from.line), (n += r.from.ch - r.to.ch);
          }
          for (i = e; (t = Oe(i)); ) {
            var o = t.find(0, !0);
            (n -= i.text.length - o.from.ch),
              (n += (i = o.to.line).text.length - o.to.ch);
          }
          return n;
        }
        function Je(e) {
          var t = e.display,
            n = e.doc;
          (t.maxLine = se(n, n.first)),
            (t.maxLineLength = Ve(t.maxLine)),
            (t.maxLineChanged = !0),
            n.iter(function (e) {
              var n = Ve(e);
              n > t.maxLineLength && ((t.maxLineLength = n), (t.maxLine = e));
            });
        }
        var Ke = null;
        function Ye(e, t, n) {
          var i;
          Ke = null;
          for (var r = 0; r < e.length; ++r) {
            var o = e[r];
            if (o.from < t && o.to > t) return r;
            o.to == t && (o.from != o.to && "before" == n ? (i = r) : (Ke = r)),
              o.from == t &&
                (o.from != o.to && "before" != n ? (i = r) : (Ke = r));
          }
          return null != i ? i : Ke;
        }
        var Ge = (function () {
          var e =
              "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",
            t =
              "nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";
          var n = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,
            i = /[stwN]/,
            r = /[LRr]/,
            o = /[Lb1n]/,
            a = /[1n]/;
          function s(e, t, n) {
            (this.level = e), (this.from = t), (this.to = n);
          }
          return function (l, c) {
            var d = "ltr" == c ? "L" : "R";
            if (0 == l.length || ("ltr" == c && !n.test(l))) return !1;
            for (var u, h = l.length, p = [], f = 0; f < h; ++f)
              p.push(
                (u = l.charCodeAt(f)) <= 247
                  ? e.charAt(u)
                  : 1424 <= u && u <= 1524
                  ? "R"
                  : 1536 <= u && u <= 1785
                  ? t.charAt(u - 1536)
                  : 1774 <= u && u <= 2220
                  ? "r"
                  : 8192 <= u && u <= 8203
                  ? "w"
                  : 8204 == u
                  ? "b"
                  : "L"
              );
            for (var m = 0, g = d; m < h; ++m) {
              var v = p[m];
              "m" == v ? (p[m] = g) : (g = v);
            }
            for (var y = 0, b = d; y < h; ++y) {
              var w = p[y];
              "1" == w && "r" == b
                ? (p[y] = "n")
                : r.test(w) && ((b = w), "r" == w && (p[y] = "R"));
            }
            for (var x = 1, C = p[0]; x < h - 1; ++x) {
              var F = p[x];
              "+" == F && "1" == C && "1" == p[x + 1]
                ? (p[x] = "1")
                : "," != F ||
                  C != p[x + 1] ||
                  ("1" != C && "n" != C) ||
                  (p[x] = C),
                (C = F);
            }
            for (var S = 0; S < h; ++S) {
              var k = p[S];
              if ("," == k) p[S] = "N";
              else if ("%" == k) {
                var E = void 0;
                for (E = S + 1; E < h && "%" == p[E]; ++E);
                for (
                  var T =
                      (S && "!" == p[S - 1]) || (E < h && "1" == p[E])
                        ? "1"
                        : "N",
                    _ = S;
                  _ < E;
                  ++_
                )
                  p[_] = T;
                S = E - 1;
              }
            }
            for (var A = 0, M = d; A < h; ++A) {
              var L = p[A];
              "L" == M && "1" == L ? (p[A] = "L") : r.test(L) && (M = L);
            }
            for (var N = 0; N < h; ++N)
              if (i.test(p[N])) {
                var D = void 0;
                for (D = N + 1; D < h && i.test(p[D]); ++D);
                for (
                  var B = "L" == (N ? p[N - 1] : d),
                    R = B == ("L" == (D < h ? p[D] : d)) ? (B ? "L" : "R") : d,
                    P = N;
                  P < D;
                  ++P
                )
                  p[P] = R;
                N = D - 1;
              }
            for (var I, O = [], $ = 0; $ < h; )
              if (o.test(p[$])) {
                var H = $;
                for (++$; $ < h && o.test(p[$]); ++$);
                O.push(new s(0, H, $));
              } else {
                var U = $,
                  j = O.length;
                for (++$; $ < h && "L" != p[$]; ++$);
                for (var q = U; q < $; )
                  if (a.test(p[q])) {
                    U < q && O.splice(j, 0, new s(1, U, q));
                    var W = q;
                    for (++q; q < $ && a.test(p[q]); ++q);
                    O.splice(j, 0, new s(2, W, q)), (U = q);
                  } else ++q;
                U < $ && O.splice(j, 0, new s(1, U, $));
              }
            return (
              1 == O[0].level &&
                (I = l.match(/^\s+/)) &&
                ((O[0].from = I[0].length),
                O.unshift(new s(0, 0, I[0].length))),
              1 == Y(O).level &&
                (I = l.match(/\s+$/)) &&
                ((Y(O).to -= I[0].length),
                O.push(new s(0, h - I[0].length, h))),
              "rtl" == c ? O.reverse() : O
            );
          };
        })();
        function Qe(e, t) {
          var n = e.order;
          return null == n && (n = e.order = Ge(e.text, t)), n;
        }
        function Xe(e, t, n) {
          var i = oe(e.text, t + n, n);
          return i < 0 || i > e.text.length ? null : i;
        }
        function Ze(e, t, n) {
          var i = Xe(e, t.ch, n);
          return null == i
            ? null
            : new me(t.line, i, n < 0 ? "after" : "before");
        }
        function et(e, t, n, i, r) {
          if (e) {
            var o = Qe(n, t.doc.direction);
            if (o) {
              var a,
                s = r < 0 ? Y(o) : o[0],
                l = r < 0 == (1 == s.level) ? "after" : "before";
              if (s.level > 0) {
                var c = Nn(t, n);
                a = r < 0 ? n.text.length - 1 : 0;
                var d = Dn(t, c, a).top;
                (a = ae(
                  function (e) {
                    return Dn(t, c, e).top == d;
                  },
                  r < 0 == (1 == s.level) ? s.from : s.to - 1,
                  a
                )),
                  "before" == l && (a = Xe(n, a, 1));
              } else a = r < 0 ? s.to : s.from;
              return new me(i, a, l);
            }
          }
          return new me(
            i,
            r < 0 ? n.text.length : 0,
            r < 0 ? "before" : "after"
          );
        }
        function tt(e, t, n, i) {
          var r = Qe(t, e.doc.direction);
          if (!r) return Ze(t, n, i);
          n.ch >= t.text.length
            ? ((n.ch = t.text.length), (n.sticky = "before"))
            : n.ch <= 0 && ((n.ch = 0), (n.sticky = "after"));
          var o = Ye(r, n.ch, n.sticky),
            a = r[o];
          if (
            "ltr" == e.doc.direction &&
            a.level % 2 == 0 &&
            (i > 0 ? a.to > n.ch : a.from < n.ch)
          )
            return Ze(t, n, i);
          var s,
            l = function (e, n) {
              return Xe(t, e instanceof me ? e.ch : e, n);
            },
            c = function (n) {
              return e.options.lineWrapping
                ? ((s = s || Nn(e, t)), Qn(e, t, s, n))
                : { begin: 0, end: t.text.length };
            },
            d = c("before" == n.sticky ? l(n, -1) : n.ch);
          if ("rtl" == e.doc.direction || 1 == a.level) {
            var u = (1 == a.level) == i < 0,
              h = l(n, u ? 1 : -1);
            if (
              null != h &&
              (u ? h <= a.to && h <= d.end : h >= a.from && h >= d.begin)
            ) {
              var p = u ? "before" : "after";
              return new me(n.line, h, p);
            }
          }
          var f = function (e, t, i) {
              for (
                var o = function (e, t) {
                  return t
                    ? new me(n.line, l(e, 1), "before")
                    : new me(n.line, e, "after");
                };
                e >= 0 && e < r.length;
                e += t
              ) {
                var a = r[e],
                  s = t > 0 == (1 != a.level),
                  c = s ? i.begin : l(i.end, -1);
                if (a.from <= c && c < a.to) return o(c, s);
                if (((c = s ? a.from : l(a.to, -1)), i.begin <= c && c < i.end))
                  return o(c, s);
              }
            },
            m = f(o + i, i, d);
          if (m) return m;
          var g = i > 0 ? d.end : l(d.begin, -1);
          return null == g ||
            (i > 0 && g == t.text.length) ||
            !(m = f(i > 0 ? 0 : r.length - 1, i, c(g)))
            ? null
            : m;
        }
        var nt = [],
          it = function (e, t, n) {
            if (e.addEventListener) {
              var i =
                File.option.passiveEvents &&
                ("scroll" == t || "mousewheel" == t || "DOMMouseScroll" == t);
              e.addEventListener(t, n, !!i && { passive: !0, capture: !1 });
            } else if (e.attachEvent) e.attachEvent("on" + t, n);
            else {
              var r = e._handlers || (e._handlers = {});
              r[t] = (r[t] || nt).concat(n);
            }
          };
        function rt(e, t) {
          return (e._handlers && e._handlers[t]) || nt;
        }
        function ot(e, t, n) {
          if (e.removeEventListener) e.removeEventListener(t, n, !1);
          else if (e.detachEvent) e.detachEvent("on" + t, n);
          else {
            var i = e._handlers,
              r = i && i[t];
            if (r) {
              var o = H(r, n);
              o > -1 && (i[t] = r.slice(0, o).concat(r.slice(o + 1)));
            }
          }
        }
        function at(e, t) {
          var n = rt(e, t);
          if (n.length)
            for (
              var i = Array.prototype.slice.call(arguments, 2), r = 0;
              r < n.length;
              ++r
            )
              n[r].apply(null, i);
        }
        function st(e, t, n) {
          return (
            "string" == typeof t &&
              (t = {
                type: t,
                preventDefault: function () {
                  this.defaultPrevented = !0;
                },
              }),
            at(e, n || t.type, e, t),
            pt(t) || t.codemirrorIgnore
          );
        }
        function lt(e) {
          var t = e._handlers && e._handlers.cursorActivity;
          if (t)
            for (
              var n =
                  e.curOp.cursorActivityHandlers ||
                  (e.curOp.cursorActivityHandlers = []),
                i = 0;
              i < t.length;
              ++i
            )
              -1 == H(n, t[i]) && n.push(t[i]);
        }
        function ct(e, t) {
          return rt(e, t).length > 0;
        }
        function dt(e) {
          (e.prototype.on = function (e, t) {
            it(this, e, t);
          }),
            (e.prototype.off = function (e, t) {
              ot(this, e, t);
            });
        }
        function ut(e) {
          e.preventDefault ? e.preventDefault() : (e.returnValue = !1);
        }
        function ht(e) {
          e.stopPropagation ? e.stopPropagation() : (e.cancelBubble = !0);
        }
        function pt(e) {
          return null != e.defaultPrevented
            ? e.defaultPrevented
            : 0 == e.returnValue;
        }
        function ft(e) {
          ut(e), ht(e);
        }
        function mt(e) {
          return e.target || e.srcElement;
        }
        function gt(e) {
          var t = e.which;
          return (
            null == t &&
              (1 & e.button
                ? (t = 1)
                : 2 & e.button
                ? (t = 3)
                : 4 & e.button && (t = 2)),
            y && e.ctrlKey && 1 == t && (t = 3),
            t
          );
        }
        var vt,
          yt,
          bt = (function () {
            if (a && s < 9) return !1;
            var e = A("div");
            return "draggable" in e || "dragDrop" in e;
          })();
        function wt(e) {
          if (null == vt) {
            var t = A("span", "​");
            _(e, A("span", [t, document.createTextNode("x")])),
              0 != e.firstChild.offsetHeight &&
                (vt =
                  t.offsetWidth <= 1 && t.offsetHeight > 2 && !(a && s < 8));
          }
          var n = vt
            ? A("span", "​")
            : A(
                "span",
                " ",
                null,
                "display: inline-block; width: 1px; margin-right: -1px"
              );
          return (
            n.setAttribute("cm-text", ""), n.setAttribute("cm-zwsp", ""), n
          );
        }
        function xt(e) {
          if (null != yt) return yt;
          var t = _(e, document.createTextNode("AخA")),
            n = k(t, 0, 1).getBoundingClientRect(),
            i = k(t, 1, 2).getBoundingClientRect();
          return (
            T(e), !(!n || n.left == n.right) && (yt = i.right - n.right < 3)
          );
        }
        var Ct,
          Ft =
            3 != "\n\nb".split(/\n/).length
              ? function (e) {
                  for (var t = 0, n = [], i = e.length; t <= i; ) {
                    var r = e.indexOf("\n", t);
                    -1 == r && (r = e.length);
                    var o = e.slice(t, "\r" == e.charAt(r - 1) ? r - 1 : r),
                      a = o.indexOf("\r");
                    -1 != a
                      ? (n.push(o.slice(0, a)), (t += a + 1))
                      : (n.push(o), (t = r + 1));
                  }
                  return n;
                }
              : function (e) {
                  return (e || "").split(/\r\n?|\n/);
                },
          St = window.getSelection
            ? function (e) {
                try {
                  return e.selectionStart != e.selectionEnd;
                } catch (e) {
                  return !1;
                }
              }
            : function (e) {
                var t;
                try {
                  t = e.ownerDocument.selection.createRange();
                } catch (e) {}
                return (
                  !(!t || t.parentElement() != e) &&
                  0 != t.compareEndPoints("StartToEnd", t)
                );
              },
          kt =
            "oncopy" in (Ct = A("div")) ||
            (Ct.setAttribute("oncopy", "return;"),
            "function" == typeof Ct.oncopy),
          Et = null;
        var Tt = {},
          _t = {};
        function At(e) {
          if ("string" == typeof e && _t.hasOwnProperty(e)) e = _t[e];
          else if (
            e &&
            "string" == typeof e.name &&
            _t.hasOwnProperty(e.name)
          ) {
            var t = _t[e.name];
            "string" == typeof t && (t = { name: t }),
              ((e = X(t, e)).name = t.name);
          } else {
            if ("string" == typeof e && /^[\w\-]+\/[\w\-]+\+xml$/.test(e))
              return At("application/xml");
            if ("string" == typeof e && /^[\w\-]+\/[\w\-]+\+json$/.test(e))
              return At("application/json");
          }
          return "string" == typeof e ? { name: e } : e || { name: "null" };
        }
        function Mt(e, t) {
          t = At(t);
          var n = Tt[t.name];
          if (!n) return Mt(e, "text/plain");
          var i = n(e, t);
          if (Lt.hasOwnProperty(t.name)) {
            var r = Lt[t.name];
            for (var o in r)
              r.hasOwnProperty(o) &&
                (i.hasOwnProperty(o) && (i["_" + o] = i[o]), (i[o] = r[o]));
          }
          if (
            ((i.name = t.name),
            t.helperType && (i.helperType = t.helperType),
            t.modeProps)
          )
            for (var a in t.modeProps) i[a] = t.modeProps[a];
          return i;
        }
        var Lt = {};
        function Nt(e, t) {
          I(t, Lt.hasOwnProperty(e) ? Lt[e] : (Lt[e] = {}));
        }
        function Dt(e, t) {
          if (!0 === t) return t;
          if (e.copyState) return e.copyState(t);
          var n = {};
          for (var i in t) {
            var r = t[i];
            r instanceof Array && (r = r.concat([])), (n[i] = r);
          }
          return n;
        }
        function Bt(e, t) {
          for (
            var n;
            e.innerMode && (n = e.innerMode(t)) && n.mode && n.mode != e;

          )
            (t = n.state), (e = n.mode);
          return n && !n.mode && (n = void 0), n || { mode: e, state: t };
        }
        function Rt(e, t, n) {
          return !e.startState || e.startState(t, n);
        }
        var Pt = function (e, t) {
          (this.pos = this.start = 0),
            (this.string = e),
            (this.tabSize = t || 8),
            (this.lastColumnPos = this.lastColumnValue = 0),
            (this.lineStart = 0);
        };
        function It(e, t, n, i) {
          var r = [e.state.modeGen],
            o = {},
            a = ue(t);
          "object" == typeof n &&
            ((n.lineBefore = e.getLine(a - 1)),
            (n.lineAfter = e.getLine(a + 1))),
            zt(
              e,
              t.text,
              e.doc.mode,
              n,
              function (e, t) {
                return r.push(e, t);
              },
              o,
              i
            );
          for (
            var s = function (i) {
                var a = e.state.overlays[i],
                  s = 1,
                  l = 0;
                zt(
                  e,
                  t.text,
                  a.mode,
                  "visiblespace" !== a.mode.name || n,
                  function (e, t) {
                    for (var n = s; l < e; ) {
                      var i = r[s];
                      i > e && r.splice(s, 1, e, r[s + 1], i),
                        (s += 2),
                        (l = Math.min(e, i));
                    }
                    if (t)
                      if (a.opaque)
                        r.splice(n, s - n, e, "overlay " + t), (s = n + 2);
                      else
                        for (; n < s; n += 2) {
                          var o = r[n + 1];
                          r[n + 1] = (o ? o + " " : "") + "overlay " + t;
                        }
                  },
                  o
                );
              },
              l = 0;
            l < e.state.overlays.length;
            ++l
          )
            s(l);
          return { styles: r, classes: o.bgClass || o.textClass ? o : null };
        }
        function Ot(e, t, n) {
          if (!t.styles || t.styles[0] != e.state.modeGen) {
            var i = $t(e, ue(t)),
              r = It(
                e,
                t,
                t.text.length > e.options.maxHighlightLength
                  ? Dt(e.doc.mode, i)
                  : i
              );
            (t.stateAfter = i),
              (t.styles = r.styles),
              r.classes
                ? (t.styleClasses = r.classes)
                : t.styleClasses && (t.styleClasses = null),
              n === e.doc.frontier && e.doc.frontier++;
          }
          return t.styles;
        }
        function $t(e, t, n) {
          var i = e.doc,
            r = e.display;
          if (!i.mode.startState) return !0;
          var o = (function (e, t, n) {
              for (
                var i,
                  r,
                  o = e.doc,
                  a = n ? -1 : t - (e.doc.mode.innerMode ? 1e3 : 100),
                  s = t;
                s > a;
                --s
              ) {
                if (s <= o.first) return o.first;
                var l = se(o, s - 1);
                if (l.stateAfter && (!n || s <= o.frontier)) return s;
                var c = O(l.text, null, e.options.tabSize);
                (null == r || i > c) && ((r = s - 1), (i = c));
              }
              return r;
            })(e, t, n),
            a = o > i.first && se(i, o - 1).stateAfter;
          return (
            (a = a ? Dt(i.mode, a) : Rt(i.mode)),
            i.iter(o, t, function (n) {
              "object" == typeof a &&
                ((a.lineBefore = e.getLine(t - 1)),
                (a.lineAfter = e.getLine(t + 1))),
                Ht(e, n.text, a);
              var s =
                o == t - 1 || o % 5 == 0 || (o >= r.viewFrom && o < r.viewTo);
              (n.stateAfter = s ? Dt(i.mode, a) : null), ++o;
            }),
            n && (i.frontier = o),
            a
          );
        }
        function Ht(e, t, n, i) {
          var r = e.doc.mode,
            o = new Pt(t, e.options.tabSize);
          for (
            o.start = o.pos = i || 0,
              n.lineBefore = n.lineBefore || "",
              n.lineAfter = n.lineAfter || "",
              "" == t && Ut(r, n);
            !o.eol();

          )
            jt(r, o, n), (o.start = o.pos);
        }
        function Ut(e, t) {
          if (e.blankLine) return e.blankLine(t);
          if (e.innerMode) {
            var n = Bt(e, t);
            return n.mode.blankLine ? n.mode.blankLine(n.state) : void 0;
          }
        }
        function jt(e, t, n, i) {
          for (var r = 0; r < 10; r++) {
            i && (i[0] = Bt(e, n).mode);
            var o = e.token(t, n);
            if (t.pos > t.start) return o;
          }
          if ("gfm" == e.name) return (t.pos = t.start + 1), null;
          throw new Error("Mode " + e.name + " failed to advance stream.");
        }
        function qt(e, t, n, i) {
          var r,
            o = function (e) {
              return {
                start: u.start,
                end: u.pos,
                string: u.current(),
                type: r || null,
                state: e ? Dt(a.mode, d) : d,
              };
            },
            a = e.doc,
            s = a.mode;
          t = Ce(a, t);
          var l,
            c = se(a, t.line),
            d = $t(e, t.line, n),
            u = new Pt(c.text, e.options.tabSize);
          for (i && (l = []); (i || u.pos < t.ch) && !u.eol(); )
            (u.start = u.pos), (r = jt(s, u, d)), i && l.push(o(!0));
          return i ? l : o();
        }
        function Wt(e, t) {
          if (e)
            for (;;) {
              var n = e.match(/(?:^|\s+)line-(background-)?(\S+)/);
              if (!n) break;
              e = e.slice(0, n.index) + e.slice(n.index + n[0].length);
              var i = n[1] ? "bgClass" : "textClass";
              null == t[i]
                ? (t[i] = n[2])
                : new RegExp("(?:^|s)" + n[2] + "(?:$|s)").test(t[i]) ||
                  (t[i] += " " + n[2]);
            }
          return e;
        }
        function zt(e, t, n, i, r, o, a) {
          var s = n.flattenSpans;
          null == s && (s = e.options.flattenSpans);
          var l,
            c = 0,
            d = null,
            u = new Pt(t, e.options.tabSize),
            h = e.options.addModeClass && [null];
          for ("" == t && Wt(Ut(n, i), o); !u.eol(); ) {
            if (
              (u.pos > e.options.maxHighlightLength
                ? ((s = !1),
                  a && Ht(e, t, i, u.pos),
                  (u.pos = t.length),
                  (l = null))
                : (l = Wt(jt(n, u, i, h), o)),
              h)
            ) {
              var p = h[0].name;
              p && (l = "m-" + (l ? p + " " + l : p));
            }
            if (!s || d != l) {
              for (; c < u.start; ) r((c = Math.min(u.start, c + 5e3)), d);
              d = l;
            }
            u.start = u.pos;
          }
          for (; c < u.pos; ) {
            var f = Math.min(u.pos, c + 5e3);
            r(f, d), (c = f);
          }
        }
        (Pt.prototype.eol = function () {
          return this.pos >= this.string.length;
        }),
          (Pt.prototype.sol = function () {
            return this.pos == this.lineStart;
          }),
          (Pt.prototype.peek = function () {
            return this.string.charAt(this.pos) || void 0;
          }),
          (Pt.prototype.next = function () {
            if (this.pos < this.string.length)
              return this.string.charAt(this.pos++);
          }),
          (Pt.prototype.eat = function (e) {
            var t = this.string.charAt(this.pos);
            if (
              "string" == typeof e ? t == e : t && (e.test ? e.test(t) : e(t))
            )
              return ++this.pos, t;
          }),
          (Pt.prototype.eatWhile = function (e) {
            for (var t = this.pos; this.eat(e); );
            return this.pos > t;
          }),
          (Pt.prototype.eatSpace = function () {
            for (
              var e = this.pos;
              /[\s\u00a0]/.test(this.string.charAt(this.pos));

            )
              ++this.pos;
            return this.pos > e;
          }),
          (Pt.prototype.skipToEnd = function () {
            this.pos = this.string.length;
          }),
          (Pt.prototype.skipTo = function (e) {
            var t = this.string.indexOf(e, this.pos);
            if (t > -1) return (this.pos = t), !0;
          }),
          (Pt.prototype.backUp = function (e) {
            this.pos -= e;
          }),
          (Pt.prototype.column = function () {
            return (
              this.lastColumnPos < this.start &&
                ((this.lastColumnValue = O(
                  this.string,
                  this.start,
                  this.tabSize,
                  this.lastColumnPos,
                  this.lastColumnValue
                )),
                (this.lastColumnPos = this.start)),
              this.lastColumnValue -
                (this.lineStart
                  ? O(this.string, this.lineStart, this.tabSize)
                  : 0)
            );
          }),
          (Pt.prototype.indentation = function () {
            return (
              O(this.string, null, this.tabSize) -
              (this.lineStart
                ? O(this.string, this.lineStart, this.tabSize)
                : 0)
            );
          }),
          (Pt.prototype.match = function (e, t, n) {
            if ("string" != typeof e) {
              var i = this.string.slice(this.pos).match(e);
              return i && i.index > 0
                ? null
                : (i && !1 !== t && (this.pos += i[0].length), i);
            }
            var r = function (e) {
              return n ? e.toLowerCase() : e;
            };
            if (r(this.string.substr(this.pos, e.length)) == r(e))
              return !1 !== t && (this.pos += e.length), !0;
          }),
          (Pt.prototype.current = function () {
            return this.string.slice(this.start, this.pos);
          }),
          (Pt.prototype.hideFirstChars = function (e, t) {
            this.lineStart += e;
            try {
              return t();
            } finally {
              this.lineStart -= e;
            }
          });
        var Vt = function (e, t, n) {
          (this.text = e), Ne(this, t), (this.height = n ? n(this) : 1);
        };
        function Jt(e) {
          (e.parent = null), Le(e);
        }
        (Vt.prototype.lineNo = function () {
          return ue(this);
        }),
          dt(Vt);
        var Kt = {},
          Yt = {};
        function Gt(e, t) {
          if (!e || /^\s*$/.test(e)) return null;
          var n = t.addModeClass ? Yt : Kt;
          return n[e] || (n[e] = e.replace(/\S+/g, "cm-$&"));
        }
        function Qt(e, t) {
          var n = M("span", null, null, l ? "padding-right: .1px" : null),
            i = {
              pre: M("pre", [n], "CodeMirror-line"),
              content: n,
              col: 0,
              pos: 0,
              cm: e,
              trailingSpace: !1,
              splitSpaces: (a || l) && e.getOption("lineWrapping"),
            };
          t.measure = {};
          for (var r = 0; r <= (t.rest ? t.rest.length : 0); r++) {
            var o = r ? t.rest[r - 1] : t.line,
              s = void 0;
            (i.pos = 0),
              (i.addToken = Zt),
              xt(e.display.measure) &&
                (s = Qe(o, e.doc.direction)) &&
                (i.addToken = en(i.addToken, s)),
              (i.map = []),
              nn(o, i, Ot(e, o, t != e.display.externalMeasured && ue(o))),
              o.styleClasses &&
                (o.styleClasses.bgClass &&
                  (i.bgClass = B(o.styleClasses.bgClass, i.bgClass || "")),
                o.styleClasses.textClass &&
                  (i.textClass = B(
                    o.styleClasses.textClass,
                    i.textClass || ""
                  ))),
              0 == i.map.length &&
                i.map.push(0, 0, i.content.appendChild(wt(e.display.measure))),
              0 == r
                ? ((t.measure.map = i.map), (t.measure.cache = {}))
                : ((t.measure.maps || (t.measure.maps = [])).push(i.map),
                  (t.measure.caches || (t.measure.caches = [])).push({}));
          }
          if (l) {
            var c = i.content.lastChild;
            (/\bcm-tab\b/.test(c.className) ||
              (c.querySelector && c.querySelector(".cm-tab"))) &&
              (i.content.className = "cm-tab-wrap-hack");
          }
          return (
            at(e, "renderLine", e, t.line, i.pre),
            i.pre.className &&
              (i.textClass = B(i.pre.className, i.textClass || "")),
            i
          );
        }
        function Xt(e) {
          var t = A("span", "•", "cm-invalidchar");
          return (
            (t.title = "\\u" + e.charCodeAt(0).toString(16)),
            t.setAttribute("aria-label", t.title),
            t
          );
        }
        function Zt(e, t, n, i, r, o, l) {
          if (t) {
            var c,
              d = e.splitSpaces
                ? (function (e, t) {
                    if (e.length > 1 && !/  /.test(e)) return e;
                    for (var n = t, i = "", r = 0; r < e.length; r++) {
                      var o = e.charAt(r);
                      " " != o ||
                        !n ||
                        (r != e.length - 1 && 32 != e.charCodeAt(r + 1)) ||
                        (o = " "),
                        (i += o),
                        (n = " " == o);
                    }
                    return i;
                  })(t, e.trailingSpace)
                : t,
              u = e.cm.state.specialChars,
              h = !1;
            if (u.test(t)) {
              c = document.createDocumentFragment();
              for (var p = 0; ; ) {
                u.lastIndex = p;
                var f = u.exec(t),
                  m = f ? f.index - p : t.length - p;
                if (m) {
                  var g = document.createTextNode(d.slice(p, p + m));
                  a && s < 9 ? c.appendChild(A("span", [g])) : c.appendChild(g),
                    e.map.push(e.pos, e.pos + m, g),
                    (e.col += m),
                    (e.pos += m);
                }
                if (!f) break;
                p += m + 1;
                var v = void 0;
                if ("\t" == f[0]) {
                  var y = e.cm.options.tabSize,
                    b = y - (e.col % y);
                  (v = c.appendChild(A("span", K(b), "cm-tab"))).setAttribute(
                    "role",
                    "presentation"
                  ),
                    v.setAttribute("cm-text", "\t"),
                    (e.col += b);
                } else
                  "\r" == f[0] || "\n" == f[0]
                    ? ((v = c.appendChild(
                        A("span", "\r" == f[0] ? "␍" : "␤", "cm-invalidchar")
                      )).setAttribute("cm-text", f[0]),
                      (e.col += 1))
                    : ((v = e.cm.options.specialCharPlaceholder(
                        f[0]
                      )).setAttribute("cm-text", f[0]),
                      a && s < 9
                        ? c.appendChild(A("span", [v]))
                        : c.appendChild(v),
                      (e.col += 1));
                e.map.push(e.pos, e.pos + 1, v), e.pos++;
              }
            } else
              (e.col += t.length),
                (c = document.createTextNode(d)),
                e.map.push(e.pos, e.pos + t.length, c),
                a && s < 9 && (h = !0),
                (e.pos += t.length);
            if (
              ((e.trailingSpace = 32 == d.charCodeAt(t.length - 1)),
              n || i || r || h || l)
            ) {
              var w = n || "";
              i && (w += i), r && (w += r);
              var x = A("span", [c], w, l);
              return o && (x.title = o), e.content.appendChild(x);
            }
            e.content.appendChild(c);
          }
        }
        function en(e, t) {
          return function (n, i, r, o, a, s, l) {
            r = r ? r + " cm-force-border" : "cm-force-border";
            for (var c = n.pos, d = c + i.length; ; ) {
              for (
                var u = void 0, h = 0;
                h < t.length && !((u = t[h]).to > c && u.from <= c);
                h++
              );
              if (u.to >= d) return e(n, i, r, o, a, s, l);
              e(n, i.slice(0, u.to - c), r, o, null, s, l),
                (o = null),
                (i = i.slice(u.to - c)),
                (c = u.to);
            }
          };
        }
        function tn(e, t, n, i) {
          var r = !i && n.widgetNode;
          r && e.map.push(e.pos, e.pos + t, r),
            !i &&
              e.cm.display.input.needsContentAttribute &&
              (r || (r = e.content.appendChild(document.createElement("span"))),
              r.setAttribute("cm-marker", n.id)),
            r &&
              (e.cm.display.input.setUneditable(r), e.content.appendChild(r)),
            (e.pos += t),
            (e.trailingSpace = !1);
        }
        function nn(e, t, n) {
          var i = e.markedSpans,
            r = e.text,
            o = 0;
          if (i)
            for (
              var a,
                s,
                l,
                c,
                d,
                u,
                h,
                p = r.length,
                f = 0,
                m = 1,
                g = "",
                v = 0;
              ;

            ) {
              if (v == f) {
                (l = c = d = u = s = ""), (h = null), (v = 1 / 0);
                for (var y = [], b = void 0, w = 0; w < i.length; ++w) {
                  var x = i[w],
                    C = x.marker;
                  "bookmark" == C.type && x.from == f && C.widgetNode
                    ? y.push(C)
                    : x.from <= f &&
                      (null == x.to ||
                        x.to > f ||
                        (C.collapsed && x.to == f && x.from == f))
                    ? (null != x.to &&
                        x.to != f &&
                        v > x.to &&
                        ((v = x.to), (c = "")),
                      C.className && (l += " " + C.className),
                      C.css && (s = (s ? s + ";" : "") + C.css),
                      C.startStyle && x.from == f && (d += " " + C.startStyle),
                      C.endStyle &&
                        x.to == v &&
                        (b || (b = [])).push(C.endStyle, x.to),
                      C.title && !u && (u = C.title),
                      C.collapsed && (!h || Re(h.marker, C) < 0) && (h = x))
                    : x.from > f && v > x.from && (v = x.from);
                }
                if (b)
                  for (var F = 0; F < b.length; F += 2)
                    b[F + 1] == v && (c += " " + b[F]);
                if (!h || h.from == f)
                  for (var S = 0; S < y.length; ++S) tn(t, 0, y[S]);
                if (h && (h.from || 0) == f) {
                  if (
                    (tn(
                      t,
                      (null == h.to ? p + 1 : h.to) - f,
                      h.marker,
                      null == h.from
                    ),
                    null == h.to)
                  )
                    return;
                  h.to == f && (h = !1);
                }
              }
              if (f >= p) break;
              for (var k = Math.min(p, v); ; ) {
                if (g) {
                  var E = f + g.length;
                  if (!h) {
                    var T = E > k ? g.slice(0, k - f) : g;
                    t.addToken(
                      t,
                      T,
                      a ? a + l : l,
                      d,
                      f + T.length == v ? c : "",
                      u,
                      s
                    );
                  }
                  if (E >= k) {
                    (g = g.slice(k - f)), (f = k);
                    break;
                  }
                  (f = E), (d = "");
                }
                (g = r.slice(o, (o = n[m++]))), (a = Gt(n[m++], t.cm.options));
              }
            }
          else
            for (var _ = 1; _ < n.length; _ += 2)
              t.addToken(t, r.slice(o, (o = n[_])), Gt(n[_ + 1], t.cm.options));
        }
        function rn(e, t, n) {
          (this.line = t),
            (this.rest = (function (e) {
              for (var t, n; (t = Oe(e)); )
                (e = t.find(1, !0).line), (n || (n = [])).push(e);
              return n;
            })(t)),
            (this.size = this.rest ? ue(Y(this.rest)) - n + 1 : 1),
            (this.node = this.text = null),
            (this.hidden = qe(e, t));
        }
        function on(e, t, n) {
          for (var i, r = [], o = t; o < n; o = i) {
            var a = new rn(e.doc, se(e.doc, o), o);
            (i = o + a.size), r.push(a);
          }
          return r;
        }
        var an = null;
        var sn = null;
        function ln(e, t) {
          var n = rt(e, t);
          if (n.length) {
            var i,
              r = Array.prototype.slice.call(arguments, 2);
            an
              ? (i = an.delayedCallbacks)
              : sn
              ? (i = sn)
              : ((i = sn = []), setTimeout(cn, 0));
            for (
              var o = function (e) {
                  i.push(function () {
                    return n[e].apply(null, r);
                  });
                },
                a = 0;
              a < n.length;
              ++a
            )
              o(a);
          }
        }
        function cn() {
          var e = sn;
          sn = null;
          for (var t = 0; t < e.length; ++t) e[t]();
        }
        function dn(e, t, n, i) {
          for (var r = 0; r < t.changes.length; r++) {
            var o = t.changes[r];
            "text" == o
              ? pn(e, t)
              : "gutter" == o
              ? mn(e, t, n, i)
              : "class" == o
              ? fn(e, t)
              : "widget" == o && gn(e, t, i);
          }
          t.changes = null;
        }
        function un(e) {
          return (
            e.node == e.text &&
              ((e.node = A("div", null, null, "position: relative")),
              e.text.parentNode &&
                e.text.parentNode.replaceChild(e.node, e.text),
              e.node.appendChild(e.text),
              a && s < 8 && (e.node.style.zIndex = 2)),
            e.node
          );
        }
        function hn(e, t) {
          var n = e.display.externalMeasured;
          return n && n.line == t.line
            ? ((e.display.externalMeasured = null),
              (t.measure = n.measure),
              n.built)
            : Qt(e, t);
        }
        function pn(e, t) {
          var n = t.text.className,
            i = hn(e, t);
          t.text == t.node && (t.node = i.pre),
            t.text.parentNode.replaceChild(i.pre, t.text),
            (t.text = i.pre),
            i.bgClass != t.bgClass || i.textClass != t.textClass
              ? ((t.bgClass = i.bgClass), (t.textClass = i.textClass), fn(e, t))
              : n && (t.text.className = n);
        }
        function fn(e, t) {
          !(function (e, t) {
            var n = t.bgClass
              ? t.bgClass + " " + (t.line.bgClass || "")
              : t.line.bgClass;
            if ((n && (n += " CodeMirror-linebackground"), t.background))
              n
                ? (t.background.className = n)
                : (t.background.parentNode.removeChild(t.background),
                  (t.background = null));
            else if (n) {
              var i = un(t);
              (t.background = i.insertBefore(A("div", null, n), i.firstChild)),
                e.display.input.setUneditable(t.background);
            }
          })(e, t),
            t.line.wrapClass
              ? (un(t).className = t.line.wrapClass)
              : t.node != t.text && (t.node.className = "");
          var n = t.textClass
            ? t.textClass + " " + (t.line.textClass || "")
            : t.line.textClass;
          t.text.className = n || "";
        }
        function mn(e, t, n, i) {
          if (
            (t.gutter && (t.node.removeChild(t.gutter), (t.gutter = null)),
            t.gutterBackground &&
              (t.node.removeChild(t.gutterBackground),
              (t.gutterBackground = null)),
            t.line.gutterClass)
          ) {
            var r = un(t);
            (t.gutterBackground = A(
              "div",
              null,
              "CodeMirror-gutter-background " + t.line.gutterClass,
              "left: " +
                (e.options.fixedGutter ? i.fixedPos : -i.gutterTotalWidth) +
                "px; width: " +
                i.gutterTotalWidth +
                "px"
            )),
              e.display.input.setUneditable(t.gutterBackground),
              r.insertBefore(t.gutterBackground, t.text);
          }
          var o = t.line.gutterMarkers;
          if (e.options.lineNumbers || o) {
            var a =
                0 === n || n === e.lineCount() - 1 || (n + 1) % 10 == 0
                  ? " CodeMirror-linenumber-show"
                  : "",
              s = un(t),
              l = (t.gutter = A(
                "div",
                null,
                "CodeMirror-gutter-wrapper",
                "left: " +
                  (e.options.fixedGutter ? i.fixedPos : -i.gutterTotalWidth) +
                  "px"
              ));
            if (
              (e.display.input.setUneditable(l),
              s.insertBefore(l, t.text),
              t.line.gutterClass && (l.className += " " + t.line.gutterClass),
              !e.options.lineNumbers ||
                (o && o["CodeMirror-linenumbers"]) ||
                (t.lineNumber = l.appendChild(
                  A(
                    "div",
                    fe(e.options, n),
                    "CodeMirror-linenumber CodeMirror-gutter-elt" + a,
                    "left: " +
                      i.gutterLeft["CodeMirror-linenumbers"] +
                      "px; width: " +
                      e.display.lineNumInnerWidth +
                      "px"
                  )
                )),
              o)
            )
              for (var c = 0; c < e.options.gutters.length; ++c) {
                var d = e.options.gutters[c],
                  u = o.hasOwnProperty(d) && o[d];
                u &&
                  l.appendChild(
                    A(
                      "div",
                      [u],
                      "CodeMirror-gutter-elt",
                      "left: " +
                        i.gutterLeft[d] +
                        "px; width: " +
                        i.gutterWidth[d] +
                        "px"
                    )
                  );
              }
          }
        }
        function gn(e, t, n) {
          t.alignable && (t.alignable = null);
          for (var i = t.node.firstChild, r = void 0; i; i = r)
            (r = i.nextSibling),
              "CodeMirror-linewidget" == i.className && t.node.removeChild(i);
          yn(e, t, n);
        }
        function vn(e, t, n, i) {
          var r = hn(e, t);
          return (
            (t.text = t.node = r.pre),
            r.bgClass && (t.bgClass = r.bgClass),
            r.textClass && (t.textClass = r.textClass),
            fn(e, t),
            mn(e, t, n, i),
            yn(e, t, i),
            t.node
          );
        }
        function yn(e, t, n) {
          if ((bn(e, t.line, t, n, !0), t.rest))
            for (var i = 0; i < t.rest.length; i++) bn(e, t.rest[i], t, n, !1);
        }
        function bn(e, t, n, i, r) {
          if (t.widgets)
            for (var o = un(n), a = 0, s = t.widgets; a < s.length; ++a) {
              var l = s[a],
                c = A("div", [l.node], "CodeMirror-linewidget");
              l.handleMouseEvents || c.setAttribute("cm-ignore-events", "true"),
                wn(l, c, n, i),
                e.display.input.setUneditable(c),
                r && l.above
                  ? o.insertBefore(c, n.gutter || n.text)
                  : o.appendChild(c),
                ln(l, "redraw");
            }
        }
        function wn(e, t, n, i) {
          if (e.noHScroll) {
            (n.alignable || (n.alignable = [])).push(t);
            var r = i.wrapperWidth;
            (t.style.left = i.fixedPos + "px"),
              e.coverGutter ||
                ((r -= i.gutterTotalWidth),
                (t.style.paddingLeft = i.gutterTotalWidth + "px")),
              (t.style.width = r + "px");
          }
          e.coverGutter &&
            ((t.style.zIndex = 5),
            (t.style.position = "relative"),
            e.noHScroll || (t.style.marginLeft = -i.gutterTotalWidth + "px"));
        }
        function xn(e) {
          if (null != e.height) return e.height;
          var t = e.doc.cm;
          if (!t) return 0;
          if (!L(document.body, e.node)) {
            var n = "position: relative;";
            e.coverGutter &&
              (n += "margin-left: -" + t.display.gutters.offsetWidth + "px;"),
              e.noHScroll &&
                (n += "width: " + t.display.wrapper.clientWidth + "px;"),
              _(t.display.measure, A("div", [e.node], null, n));
          }
          return (e.height = e.node.parentNode.offsetHeight);
        }
        function Cn(e, t, n) {
          for (var i = mt(t); i != e.wrapper; i = i.parentNode) {
            if (
              n &&
              i == t.target &&
              i == e.scroller &&
              e.scroller.scrollWidth > e.scroller.clientWidth &&
              e.scroller.getBoundingClientRect().bottom < t.clientY + 20
            )
              return !0;
            if (
              !i ||
              (1 == i.nodeType &&
                "true" == i.getAttribute("cm-ignore-events")) ||
              (i.parentNode == e.sizer && i != e.mover)
            )
              return !0;
          }
        }
        function Fn(e) {
          return e.lineSpace.offsetTop;
        }
        function Sn(e) {
          return e.mover.offsetHeight - e.lineSpace.offsetHeight;
        }
        function kn(e) {
          if (e.cachedPaddingH) return e.cachedPaddingH;
          var t = _(e.measure, A("pre", "x")),
            n = window.getComputedStyle
              ? window.getComputedStyle(t)
              : t.currentStyle,
            i = {
              left: parseInt(n.paddingLeft),
              right: parseInt(n.paddingRight),
            };
          return isNaN(i.left) || isNaN(i.right) || (e.cachedPaddingH = i), i;
        }
        function En(e) {
          return U - e.display.nativeBarWidth;
        }
        function Tn(e) {
          return e.display.scroller.clientWidth - En(e) - e.display.barWidth;
        }
        function _n(e) {
          return e.display.scroller.clientHeight - En(e) - e.display.barHeight;
        }
        function An(e, t, n) {
          if (e.line == t)
            return { map: e.measure.map, cache: e.measure.cache };
          for (var i = 0; i < e.rest.length; i++)
            if (e.rest[i] == t)
              return { map: e.measure.maps[i], cache: e.measure.caches[i] };
          for (var r = 0; r < e.rest.length; r++)
            if (ue(e.rest[r]) > n)
              return {
                map: e.measure.maps[r],
                cache: e.measure.caches[r],
                before: !0,
              };
        }
        function Mn(e, t, n, i) {
          return Dn(e, Nn(e, t), n, i);
        }
        function Ln(e, t) {
          if (t >= e.display.viewFrom && t < e.display.viewTo)
            return e.display.view[ai(e, t)];
          var n = e.display.externalMeasured;
          return n && t >= n.lineN && t < n.lineN + n.size ? n : void 0;
        }
        function Nn(e, t) {
          var n = ue(t),
            i = Ln(e, n);
          i && !i.text
            ? (i = null)
            : i &&
              i.changes &&
              (dn(e, i, n, ti(e)), (e.curOp.forceUpdate = !0)),
            i ||
              (i = (function (e, t) {
                var n = ue((t = He(t))),
                  i = (e.display.externalMeasured = new rn(e.doc, t, n));
                i.lineN = n;
                var r = (i.built = Qt(e, i));
                return (i.text = r.pre), _(e.display.lineMeasure, r.pre), i;
              })(e, t));
          var r = An(i, t, n);
          return {
            line: t,
            view: i,
            rect: null,
            map: r.map,
            cache: r.cache,
            before: r.before,
            hasHeights: !1,
          };
        }
        function Dn(e, t, n, i, r) {
          t.before && (n = -1);
          var o,
            l = n + (i || "");
          return (
            t.cache.hasOwnProperty(l)
              ? (o = t.cache[l])
              : (t.rect || (t.rect = t.view.text.getBoundingClientRect()),
                t.hasHeights ||
                  (!(function (e, t, n) {
                    var i = e.options.lineWrapping,
                      r = i && Tn(e);
                    if (!t.measure.heights || (i && t.measure.width != r)) {
                      var o = (t.measure.heights = []);
                      if (i) {
                        t.measure.width = r;
                        for (
                          var a = t.text.firstChild.getClientRects(), s = 0;
                          s < a.length - 1;
                          s++
                        ) {
                          var l = a[s],
                            c = a[s + 1];
                          Math.abs(l.bottom - c.bottom) > 2 &&
                            o.push((l.bottom + c.top) / 2 - n.top);
                        }
                      }
                      o.push(n.bottom - n.top);
                    }
                  })(e, t.view, t.rect),
                  (t.hasHeights = !0)),
                (o = (function (e, t, n, i) {
                  var r,
                    o = Pn(t.map, n, i),
                    l = o.node,
                    c = o.start,
                    d = o.end,
                    u = o.collapse;
                  if (3 == l.nodeType) {
                    for (var h = 0; h < 4; h++) {
                      for (; c && re(t.line.text.charAt(o.coverStart + c)); )
                        --c;
                      for (
                        ;
                        o.coverStart + d < o.coverEnd &&
                        re(t.line.text.charAt(o.coverStart + d));

                      )
                        ++d;
                      if (
                        (r =
                          a && s < 9 && 0 == c && d == o.coverEnd - o.coverStart
                            ? l.parentNode.getBoundingClientRect()
                            : In(k(l, c, d).getClientRects(), i)).left ||
                        r.right ||
                        0 == c
                      )
                        break;
                      (d = c), (c -= 1), (u = "right");
                    }
                    a &&
                      s < 11 &&
                      (r = (function (e, t) {
                        if (
                          !window.screen ||
                          null == screen.logicalXDPI ||
                          screen.logicalXDPI == screen.deviceXDPI ||
                          !(function (e) {
                            if (null != Et) return Et;
                            var t = _(e, A("span", "x")),
                              n = t.getBoundingClientRect(),
                              i = k(t, 0, 1).getBoundingClientRect();
                            return (Et = Math.abs(n.left - i.left) > 1);
                          })(e)
                        )
                          return t;
                        var n = screen.logicalXDPI / screen.deviceXDPI,
                          i = screen.logicalYDPI / screen.deviceYDPI;
                        return {
                          left: t.left * n,
                          right: t.right * n,
                          top: t.top * i,
                          bottom: t.bottom * i,
                        };
                      })(e.display.measure, r));
                  } else {
                    var p;
                    c > 0 && (u = i = "right"),
                      (r =
                        e.options.lineWrapping &&
                        (p = l.getClientRects()).length > 1
                          ? p["right" == i ? p.length - 1 : 0]
                          : l.getBoundingClientRect());
                  }
                  if (a && s < 9 && !c && (!r || (!r.left && !r.right))) {
                    var f = l.parentNode.getClientRects()[0];
                    r = f
                      ? {
                          left: f.left,
                          right: f.left + ei(e.display),
                          top: f.top,
                          bottom: f.bottom,
                        }
                      : Rn;
                  }
                  for (
                    var m = r.top - t.rect.top,
                      g = r.bottom - t.rect.top,
                      v = (m + g) / 2,
                      y = t.view.measure.heights,
                      b = 0;
                    b < y.length - 1 && !(v < y[b]);
                    b++
                  );
                  var w = b ? y[b - 1] : 0,
                    x = y[b],
                    C = {
                      left: ("right" == u ? r.right : r.left) - t.rect.left,
                      right: ("left" == u ? r.left : r.right) - t.rect.left,
                      top: w,
                      bottom: x,
                    };
                  r.left || r.right || (C.bogus = !0);
                  e.options.singleCursorHeightPerLine ||
                    ((C.rtop = m), (C.rbottom = g));
                  return C;
                })(e, t, n, i)).bogus || (t.cache[l] = o)),
            {
              left: o.left,
              right: o.right,
              top: r ? o.rtop : o.top,
              bottom: r ? o.rbottom : o.bottom,
            }
          );
        }
        var Bn,
          Rn = { left: 0, right: 0, top: 0, bottom: 0 };
        function Pn(e, t, n) {
          for (var i, r, o, a, s, l, c = 0; c < e.length; c += 3)
            if (
              ((s = e[c]),
              (l = e[c + 1]),
              t < s
                ? ((r = 0), (o = 1), (a = "left"))
                : t < l
                ? (o = (r = t - s) + 1)
                : (c == e.length - 3 || (t == l && e[c + 3] > t)) &&
                  ((r = (o = l - s) - 1), t >= l && (a = "right")),
              null != r)
            ) {
              if (
                ((i = e[c + 2]),
                s == l && n == (i.insertLeft ? "left" : "right") && (a = n),
                "left" == n && 0 == r)
              )
                for (; c && e[c - 2] == e[c - 3] && e[c - 1].insertLeft; )
                  (i = e[2 + (c -= 3)]), (a = "left");
              if ("right" == n && r == l - s)
                for (
                  ;
                  c < e.length - 3 &&
                  e[c + 3] == e[c + 4] &&
                  !e[c + 5].insertLeft;

                )
                  (i = e[(c += 3) + 2]), (a = "right");
              break;
            }
          return {
            node: i,
            start: r,
            end: o,
            collapse: a,
            coverStart: s,
            coverEnd: l,
          };
        }
        function In(e, t) {
          var n = Rn;
          if ("left" == t)
            for (var i = 0; i < e.length && (n = e[i]).left == n.right; i++);
          else
            for (
              var r = e.length - 1;
              r >= 0 && (n = e[r]).left == n.right;
              r--
            );
          return n;
        }
        function On(e) {
          if (
            e.measure &&
            ((e.measure.cache = {}), (e.measure.heights = null), e.rest)
          )
            for (var t = 0; t < e.rest.length; t++) e.measure.caches[t] = {};
        }
        function $n(e) {
          (e.display.externalMeasure = null), T(e.display.lineMeasure);
          for (var t = 0; t < e.display.view.length; t++) On(e.display.view[t]);
        }
        function Hn(e) {
          $n(e),
            (e.display.cachedCharWidth =
              e.display.cachedTextHeight =
              e.display.cachedPaddingH =
                null),
            e.options.lineWrapping || (e.display.maxLineChanged = !0),
            (e.display.lineNumChars = null);
        }
        function Un() {
          return d && g
            ? -(
                document.body.getBoundingClientRect().left -
                parseInt(getComputedStyle(document.body).marginLeft)
              )
            : window.pageXOffset ||
                (document.documentElement || document.body).scrollLeft;
        }
        function jn() {
          return d && g
            ? -(
                document.body.getBoundingClientRect().top -
                parseInt(getComputedStyle(document.body).marginTop)
              )
            : window.pageYOffset ||
                (document.documentElement || document.body).scrollTop;
        }
        function qn(e, t, n, i, r) {
          if (!r && t.widgets)
            for (var o = 0; o < t.widgets.length; ++o)
              if (t.widgets[o].above) {
                var a = xn(t.widgets[o]);
                (n.top += a), (n.bottom += a);
              }
          if ("line" == i) return n;
          i || (i = "local");
          var s = ze(t);
          if (
            ("local" == i ? (s += Fn(e.display)) : (s -= e.display.viewOffset),
            "page" == i || "window" == i)
          ) {
            var l = e.display.lineSpace.getBoundingClientRect();
            s += l.top + ("window" == i ? 0 : jn());
            var c = l.left + ("window" == i ? 0 : Un());
            (n.left += c), (n.right += c);
          }
          return (n.top += s), (n.bottom += s), n;
        }
        function Wn(e, t, n) {
          if ("div" == n) return t;
          var i = t.left,
            r = t.top;
          if ("page" == n) (i -= Un()), (r -= jn());
          else if ("local" == n || !n) {
            var o = e.display.sizer.getBoundingClientRect();
            (i += o.left), (r += o.top);
          }
          var a = e.display.lineSpace.getBoundingClientRect();
          return { left: i - a.left, top: r - a.top };
        }
        function zn(e, t, n, i, r) {
          return i || (i = se(e.doc, t.line)), qn(e, i, Mn(e, i, t.ch, r), n);
        }
        function Vn(e, t, n, i, r, o) {
          function a(t, a) {
            var s = Dn(e, r, t, a ? "right" : "left", o);
            return a ? (s.left = s.right) : (s.right = s.left), qn(e, i, s, n);
          }
          (i = i || se(e.doc, t.line)), r || (r = Nn(e, i));
          var s = Qe(i, e.doc.direction),
            l = t.ch,
            c = t.sticky;
          if (
            (l >= i.text.length
              ? ((l = i.text.length), (c = "before"))
              : l <= 0 && ((l = 0), (c = "after")),
            !s)
          )
            return a("before" == c ? l - 1 : l, "before" == c);
          function d(e, t, n) {
            var i = s[t].level % 2 != 0;
            return a(n ? e - 1 : e, i != n);
          }
          var u = Ye(s, l, c),
            h = Ke,
            p = d(l, u, "before" == c);
          return null != h && (p.other = d(l, h, "before" != c)), p;
        }
        function Jn(e, t) {
          var n = 0;
          (t = Ce(e.doc, t)),
            e.options.lineWrapping || (n = ei(e.display) * t.ch);
          var i = se(e.doc, t.line),
            r = ze(i) + Fn(e.display);
          return { left: n, right: n, top: r, bottom: r + i.height };
        }
        function Kn(e, t, n, i, r) {
          var o = me(e, t, n);
          return (o.xRel = r), i && (o.outside = !0), o;
        }
        function Yn(e, t, n) {
          var i = e.doc;
          if ((n += e.display.viewOffset) < 0)
            return Kn(i.first, 0, null, !0, -1);
          var r = he(i, n),
            o = i.first + i.size - 1;
          if (r > o)
            return Kn(i.first + i.size - 1, se(i, o).text.length, null, !0, 1);
          t < 0 && (t = 0);
          for (var a = se(i, r); ; ) {
            var s = Xn(e, a, r, t, n),
              l = Oe(a),
              c = l && l.find(0, !0);
            if (!l || !(s.ch > c.from.ch || (s.ch == c.from.ch && s.xRel > 0)))
              return s;
            r = ue((a = c.to.line));
          }
        }
        function Gn(e, t, n, i) {
          var r = function (i) {
              return qn(e, t, Dn(e, n, i), "line");
            },
            o = t.text.length,
            a = ae(
              function (e) {
                return r(e - 1).bottom <= i;
              },
              o,
              0
            );
          return {
            begin: a,
            end: (o = ae(
              function (e) {
                return r(e).top > i;
              },
              a,
              o
            )),
          };
        }
        function Qn(e, t, n, i) {
          return Gn(e, t, n, qn(e, t, Dn(e, n, i), "line").top);
        }
        function Xn(e, t, n, i, r) {
          r -= ze(t);
          var o,
            a = 0,
            s = t.text.length,
            l = Nn(e, t);
          if (Qe(t, e.doc.direction)) {
            var c;
            if (e.options.lineWrapping)
              (a = (c = Gn(e, t, l, r)).begin), (s = c.end);
            o = new me(n, a);
            var d,
              u,
              h = Vn(e, o, "line", t, l).left,
              p = h < i ? 1 : -1,
              f = h - i;
            do {
              if (
                ((d = f),
                (u = o),
                null == (o = tt(e, t, o, p)) ||
                  o.ch < a ||
                  s <= ("before" == o.sticky ? o.ch - 1 : o.ch))
              ) {
                o = u;
                break;
              }
              f = Vn(e, o, "line", t, l).left - i;
            } while (p < 0 != f < 0 && Math.abs(f) <= Math.abs(d));
            if (Math.abs(f) > Math.abs(d)) {
              if (f < 0 == d < 0)
                throw new Error(
                  "Broke out of infinite loop in coordsCharInner"
                );
              o = u;
            }
          } else {
            var m = ae(
              function (n) {
                var o = qn(e, t, Dn(e, l, n), "line");
                return o.top > r
                  ? ((s = Math.min(n, s)), !0)
                  : !(o.bottom <= r) &&
                      (o.left > i ||
                        (!(o.right < i) && i - o.left < o.right - i));
              },
              a,
              s
            );
            o = new me(n, (m = oe(t.text, m, 1)), m == s ? "before" : "after");
          }
          var g = Vn(e, o, "line", t, l);
          return (
            (r < g.top || g.bottom < r) && (o.outside = !0),
            (o.xRel = i < g.left ? -1 : i > g.right ? 1 : 0),
            o
          );
        }
        function Zn(e) {
          if (null != e.cachedTextHeight) return e.cachedTextHeight;
          if (null == Bn) {
            Bn = A("pre");
            for (var t = 0; t < 49; ++t)
              Bn.appendChild(document.createTextNode("x")),
                Bn.appendChild(A("br"));
            Bn.appendChild(document.createTextNode("x"));
          }
          _(e.measure, Bn);
          var n = Bn.offsetHeight / 50;
          return n > 3 && (e.cachedTextHeight = n), T(e.measure), n || 1;
        }
        function ei(e) {
          if (null != e.cachedCharWidth) return e.cachedCharWidth;
          var t = A("span", "xxxxxxxxxx"),
            n = A("pre", [t]);
          _(e.measure, n);
          var i = t.getBoundingClientRect(),
            r = (i.right - i.left) / 10;
          return r > 2 && (e.cachedCharWidth = r), r || 10;
        }
        function ti(e) {
          for (
            var t = e.display,
              n = {},
              i = {},
              r = t.gutters.clientLeft,
              o = t.gutters.firstChild,
              a = 0;
            o;
            o = o.nextSibling, ++a
          )
            (n[e.options.gutters[a]] = o.offsetLeft + o.clientLeft + r),
              (i[e.options.gutters[a]] = o.clientWidth);
          return {
            fixedPos: ni(t),
            gutterTotalWidth: t.gutters.offsetWidth,
            gutterLeft: n,
            gutterWidth: i,
            wrapperWidth: t.wrapper.clientWidth,
          };
        }
        function ni(e) {
          return (
            e.scroller.getBoundingClientRect().left -
            e.sizer.getBoundingClientRect().left
          );
        }
        function ii(e) {
          var t = Zn(e.display),
            n = e.options.lineWrapping,
            i =
              n &&
              Math.max(5, e.display.scroller.clientWidth / ei(e.display) - 3);
          return function (r) {
            if (qe(e.doc, r)) return 0;
            var o = 0;
            if (r.widgets)
              for (var a = 0; a < r.widgets.length; a++)
                r.widgets[a].height && (o += r.widgets[a].height);
            return n ? o + (Math.ceil(r.text.length / i) || 1) * t : o + t;
          };
        }
        function ri(e) {
          var t = e.doc,
            n = ii(e);
          t.iter(function (e) {
            var t = n(e);
            t != e.height && de(e, t);
          });
        }
        function oi(e, t, n, i) {
          var r = e.display;
          if (!n && "true" == mt(t).getAttribute("cm-not-content")) return null;
          var o,
            a,
            s = r.lineSpace.getBoundingClientRect();
          try {
            (o = t.clientX - s.left), (a = t.clientY - s.top);
          } catch (t) {
            return null;
          }
          var l,
            c = Yn(e, o, a);
          if (i && 1 == c.xRel && (l = se(e.doc, c.line).text).length == c.ch) {
            var d = O(l, l.length, e.options.tabSize) - l.length;
            c = me(
              c.line,
              Math.max(
                0,
                Math.round((o - kn(e.display).left) / ei(e.display)) - d
              )
            );
          }
          return c;
        }
        function ai(e, t) {
          if (t >= e.display.viewTo) return null;
          if ((t -= e.display.viewFrom) < 0) return null;
          for (var n = e.display.view, i = 0; i < n.length; i++)
            if ((t -= n[i].size) < 0) return i;
        }
        function si(e) {
          e.display.input.showSelection(e.display.input.prepareSelection());
        }
        function li(e, t) {
          for (
            var n = e.doc,
              i = {},
              r = (i.cursors = document.createDocumentFragment()),
              o = (i.selection = document.createDocumentFragment()),
              a = 0;
            a < n.sel.ranges.length;
            a++
          )
            if (!1 !== t || a != n.sel.primIndex) {
              var s = n.sel.ranges[a];
              if (
                !(
                  s.from().line >= e.display.viewTo ||
                  s.to().line < e.display.viewFrom
                )
              ) {
                var l = s.empty();
                (l || e.options.showCursorWhenSelecting) && ci(e, s.head, r),
                  l || di(e, s, o);
              }
            }
          return i;
        }
        function ci(e, t, n) {
          var i = Vn(
              e,
              t,
              "div",
              null,
              null,
              !e.options.singleCursorHeightPerLine
            ),
            r = n.appendChild(A("div", " ", "CodeMirror-cursor"));
          if (
            ((r.style.left = i.left + "px"),
            (r.style.top = i.top + "px"),
            (r.style.height =
              Math.max(0, i.bottom - i.top) * e.options.cursorHeight + "px"),
            i.other)
          ) {
            var o = n.appendChild(
              A("div", " ", "CodeMirror-cursor CodeMirror-secondarycursor")
            );
            (o.style.display = ""),
              (o.style.left = i.other.left + "px"),
              (o.style.top = i.other.top + "px"),
              (o.style.height = 0.85 * (i.other.bottom - i.other.top) + "px");
          }
        }
        function di(e, t, n) {
          var i = e.display,
            r = e.doc,
            o = document.createDocumentFragment(),
            a = kn(e.display),
            s = a.left,
            l =
              Math.max(
                i.sizerWidth,
                e.display.lineDiv.clientWidth - i.sizer.offsetLeft
              ) - a.right;
          function c(e, t, n, i) {
            t < 0 && (t = 0),
              (t = Math.round(t)),
              (i = Math.round(i)),
              o.appendChild(
                A(
                  "div",
                  null,
                  "CodeMirror-selected",
                  "position: absolute; left: " +
                    e +
                    "px;\n                             top: " +
                    t +
                    "px; width: " +
                    (null == n ? l - e : n) +
                    "px;\n                             height: " +
                    (i - t) +
                    "px"
                )
              );
          }
          function d(t, n, i) {
            var o,
              a,
              d = se(r, t),
              u = d.text.length;
            function h(n, i) {
              return zn(e, me(t, n), "div", d, i);
            }
            return (
              (function (e, t, n, i) {
                if (!e) return i(t, n, "ltr");
                for (var r = !1, o = 0; o < e.length; ++o) {
                  var a = e[o];
                  ((a.from < n && a.to > t) || (t == n && a.to == t)) &&
                    (i(
                      Math.max(a.from, t),
                      Math.min(a.to, n),
                      1 == a.level ? "rtl" : "ltr"
                    ),
                    (r = !0));
                }
                r || i(t, n, "ltr");
              })(
                Qe(d, r.direction),
                n || 0,
                null == i ? u : i,
                function (e, t, r) {
                  var d,
                    p,
                    f,
                    m = h(e, "left");
                  if (e == t) (d = m), (p = f = m.left);
                  else {
                    if (((d = h(t - 1, "right")), "rtl" == r)) {
                      var g = m;
                      (m = d), (d = g);
                    }
                    (p = m.left), (f = d.right);
                  }
                  null == n && 0 == e && (p = s),
                    d.top - m.top > 3 &&
                      (c(p, m.top, null, m.bottom),
                      (p = s),
                      m.bottom < d.top && c(p, m.bottom, null, d.top)),
                    null == i && t == u && (f = l),
                    (!o ||
                      m.top < o.top ||
                      (m.top == o.top && m.left < o.left)) &&
                      (o = m),
                    (!a ||
                      d.bottom > a.bottom ||
                      (d.bottom == a.bottom && d.right > a.right)) &&
                      (a = d),
                    p < s + 1 && (p = s),
                    c(p, d.top, f - p, d.bottom);
                }
              ),
              { start: o, end: a }
            );
          }
          var u = t.from(),
            h = t.to();
          if (u.line == h.line) d(u.line, u.ch, h.ch);
          else {
            var p = se(r, u.line),
              f = se(r, h.line),
              m = He(p) == He(f),
              g = d(u.line, u.ch, m ? p.text.length + 1 : null).end,
              v = d(h.line, m ? 0 : null, h.ch).start;
            m &&
              (g.top < v.top - 2
                ? (c(g.right, g.top, null, g.bottom),
                  c(s, v.top, v.left, v.bottom))
                : c(g.right, g.top, v.left - g.right, g.bottom)),
              g.bottom < v.top && c(s, g.bottom, null, v.top);
          }
          n.appendChild(o);
        }
        function ui(e) {
          if (e.state.focused) {
            var t = e.display;
            clearInterval(t.blinker);
            var n = !0;
            (t.cursorDiv.style.visibility = ""),
              e.options.cursorBlinkRate > 0
                ? (t.blinker = setInterval(function () {
                    return (t.cursorDiv.style.visibility = (n = !n)
                      ? ""
                      : "hidden");
                  }, e.options.cursorBlinkRate))
                : e.options.cursorBlinkRate < 0 &&
                  (t.cursorDiv.style.visibility = "hidden");
          }
        }
        function hi(e) {
          e.state.focused || (e.display.input.focus(), fi(e));
        }
        function pi(e) {
          (e.state.delayingBlurEvent = !0),
            setTimeout(function () {
              e.state.delayingBlurEvent &&
                ((e.state.delayingBlurEvent = !1), mi(e));
            }, 100);
        }
        function fi(e, t) {
          e.state.delayingBlurEvent && (e.state.delayingBlurEvent = !1),
            "nocursor" != e.options.readOnly &&
              (e.state.focused ||
                (at(e, "focus", e, t),
                (e.state.focused = !0),
                D(e.display.wrapper, "CodeMirror-focused"),
                e.curOp ||
                  e.display.selForContextMenu == e.doc.sel ||
                  (e.display.input.reset(),
                  l &&
                    setTimeout(function () {
                      return e.display.input.reset(!0);
                    }, 20)),
                e.display.input.receivedFocus()),
              ui(e));
        }
        function mi(e, t) {
          e.state.delayingBlurEvent ||
            (e.state.focused &&
              (at(e, "blur", e, t),
              (e.state.focused = !1),
              E(e.display.wrapper, "CodeMirror-focused")),
            clearInterval(e.display.blinker),
            setTimeout(function () {
              e.state.focused || (e.display.shift = !1);
            }, 150));
        }
        function gi(e) {
          for (
            var t = e.display, n = t.lineDiv.offsetTop, i = 0;
            i < t.view.length;
            i++
          ) {
            var r = t.view[i],
              o = void 0;
            if (!r.hidden) {
              if (a && s < 8) {
                var l = r.node.offsetTop + r.node.offsetHeight;
                (o = l - n), (n = l);
              } else {
                var c = r.node.getBoundingClientRect();
                o = c.bottom - c.top;
              }
              var d = r.line.height - o;
              if (
                (o < 2 && (o = Zn(t)),
                (d > 0.001 || d < -0.001) &&
                  (de(r.line, o), vi(r.line), r.rest))
              )
                for (var u = 0; u < r.rest.length; u++) vi(r.rest[u]);
            }
          }
        }
        function vi(e) {
          if (e.widgets)
            for (var t = 0; t < e.widgets.length; ++t)
              e.widgets[t].height = e.widgets[t].node.parentNode.offsetHeight;
        }
        function yi(e, t, n) {
          var i =
            n && null != n.top ? Math.max(0, n.top) : e.scroller.scrollTop;
          i = Math.floor(i - Fn(e));
          var r = n && null != n.bottom ? n.bottom : i + e.wrapper.clientHeight,
            o = he(t, i),
            a = he(t, r);
          if (n && n.ensure) {
            var s = n.ensure.from.line,
              l = n.ensure.to.line;
            s < o
              ? ((o = s), (a = he(t, ze(se(t, s)) + e.wrapper.clientHeight)))
              : Math.min(l, t.lastLine()) >= a &&
                ((o = he(t, ze(se(t, l)) - e.wrapper.clientHeight)), (a = l));
          }
          return { from: o, to: Math.max(a, o + 1) };
        }
        function bi(e) {
          var t = e.display,
            n = t.view;
          if (
            t.alignWidgets ||
            (t.gutters.firstChild && e.options.fixedGutter)
          ) {
            for (
              var i = ni(t) - t.scroller.scrollLeft + e.doc.scrollLeft,
                r = t.gutters.offsetWidth,
                o = i + "px",
                a = 0;
              a < n.length;
              a++
            )
              if (!n[a].hidden) {
                e.options.fixedGutter &&
                  (n[a].gutter && (n[a].gutter.style.left = o),
                  n[a].gutterBackground &&
                    (n[a].gutterBackground.style.left = o));
                var s = n[a].alignable;
                if (s) for (var l = 0; l < s.length; l++) s[l].style.left = o;
              }
            e.options.fixedGutter &&
              (t.gutters.style.left = Math.max(0, i + r) + "px");
          }
        }
        function wi(e) {
          if (!e.options.lineNumbers) return !1;
          var t = e.doc,
            n = fe(e.options, t.first + t.size - 1),
            i = e.display;
          if (n.length != i.lineNumChars) {
            var r = i.measure.appendChild(
                A(
                  "div",
                  [A("div", n)],
                  "CodeMirror-linenumber CodeMirror-gutter-elt"
                )
              ),
              o = r.firstChild.offsetWidth,
              a = r.offsetWidth - o;
            return (
              (i.lineGutter.style.width = ""),
              (i.lineNumInnerWidth =
                Math.max(o, i.lineGutter.offsetWidth - a) + a + 2),
              (i.lineNumWidth = i.lineNumInnerWidth + a),
              (i.lineNumChars = i.lineNumInnerWidth ? n.length : -1),
              (i.lineGutter.style.width = i.lineNumWidth + "px"),
              or(e),
              !0
            );
          }
          return !1;
        }
        function xi(e, t) {
          var n = e.display,
            i = Zn(e.display);
          t.top < 0 && (t.top = 0);
          var r =
              e.curOp && null != e.curOp.scrollTop
                ? e.curOp.scrollTop
                : n.scroller.scrollTop,
            o = _n(e),
            a = {};
          t.bottom - t.top > o && (t.bottom = t.top + o);
          var s = e.doc.height + Sn(n),
            l = t.top < i,
            c = t.bottom > s - i;
          if (t.top < r) a.scrollTop = l ? 0 : t.top;
          else if (t.bottom > r + o) {
            var d = Math.min(t.top, (c ? s : t.bottom) - o);
            d != r && (a.scrollTop = d);
          }
          var u =
              e.curOp && null != e.curOp.scrollLeft
                ? e.curOp.scrollLeft
                : n.scroller.scrollLeft,
            h = Tn(e) - (e.options.fixedGutter ? n.gutters.offsetWidth : 0),
            p = t.right - t.left > h;
          return (
            p && (t.right = t.left + h),
            t.left < 10
              ? (a.scrollLeft = 0)
              : t.left < u
              ? (a.scrollLeft = Math.max(0, t.left - (p ? 0 : 10)))
              : t.right > h + u - 3 &&
                (a.scrollLeft = t.right + (p ? 0 : 10) - h),
            a
          );
        }
        function Ci(e, t) {
          null != t &&
            (ki(e),
            (e.curOp.scrollTop =
              (null == e.curOp.scrollTop
                ? e.doc.scrollTop
                : e.curOp.scrollTop) + t));
        }
        function Fi(e) {
          ki(e);
          var t = e.getCursor(),
            n = t,
            i = t;
          e.options.lineWrapping ||
            ((n = t.ch ? me(t.line, t.ch - 1) : t), (i = me(t.line, t.ch + 1))),
            (e.curOp.scrollToPos = {
              from: n,
              to: i,
              margin: e.options.cursorScrollMargin,
            });
        }
        function Si(e, t, n) {
          (null == t && null == n) || ki(e),
            null != t && (e.curOp.scrollLeft = t),
            null != n && (e.curOp.scrollTop = n);
        }
        function ki(e) {
          var t = e.curOp.scrollToPos;
          t &&
            ((e.curOp.scrollToPos = null),
            Ei(e, Jn(e, t.from), Jn(e, t.to), t.margin));
        }
        function Ei(e, t, n, i) {
          var r = xi(e, {
            left: Math.min(t.left, n.left),
            top: Math.min(t.top, n.top) - i,
            right: Math.max(t.right, n.right),
            bottom: Math.max(t.bottom, n.bottom) + i,
          });
          Si(e, r.scrollLeft, r.scrollTop);
        }
        function Ti(e, t) {
          Math.abs(e.doc.scrollTop - t) < 2 ||
            (n || rr(e, { top: t }), _i(e, t, !0), n && rr(e), Zi(e, 100));
        }
        function _i(e, t, n) {
          (t = Math.min(
            e.display.scroller.scrollHeight - e.display.scroller.clientHeight,
            t
          )),
            (e.display.scroller.scrollTop != t || n) &&
              ((e.doc.scrollTop = t),
              e.display.scrollbars.setScrollTop(t),
              e.display.scroller.scrollTop != t &&
                (e.display.scroller.scrollTop = t));
        }
        function Ai(e, t, n, i) {
          (t = Math.min(
            t,
            e.display.scroller.scrollWidth - e.display.scroller.clientWidth
          )),
            ((n ? t == e.doc.scrollLeft : Math.abs(e.doc.scrollLeft - t) < 2) &&
              !i) ||
              ((e.doc.scrollLeft = t),
              bi(e),
              e.display.scroller.scrollLeft != t &&
                (e.display.scroller.scrollLeft = t),
              e.display.scrollbars.setScrollLeft(t));
        }
        function Mi(e) {
          var t = e.display,
            n = t.gutters.offsetWidth,
            i = Math.round(e.doc.height + Sn(e.display));
          return {
            clientHeight: t.scroller.clientHeight,
            viewHeight: t.wrapper.clientHeight,
            scrollWidth: t.scroller.scrollWidth,
            clientWidth: t.scroller.clientWidth,
            viewWidth: t.wrapper.clientWidth,
            barLeft: e.options.fixedGutter ? n : 0,
            docHeight: i,
            scrollHeight: i + En(e) + t.barHeight,
            nativeBarWidth: t.nativeBarWidth,
            gutterWidth: n,
          };
        }
        ma.posFromMouse = oi;
        var Li = function (e, t, n) {
          this.cm = n;
          var i = (this.vert = A(
              "div",
              [A("div", null, null, "min-width: 1px")],
              "CodeMirror-vscrollbar"
            )),
            r = (this.horiz = A(
              "div",
              [A("div", null, null, "height: 100%; min-height: 1px")],
              "CodeMirror-hscrollbar"
            ));
          e(i),
            e(r),
            it(i, "scroll", function () {
              i.clientHeight && t(i.scrollTop, "vertical");
            }),
            it(r, "scroll", function () {
              r.clientWidth && t(r.scrollLeft, "horizontal");
            }),
            (this.checkedZeroWidth = !1),
            a &&
              s < 8 &&
              (this.horiz.style.minHeight = this.vert.style.minWidth = "18px");
        };
        (Li.prototype.update = function (e) {
          var t = e.scrollWidth > e.clientWidth + 1,
            n = e.scrollHeight > e.clientHeight + 1,
            i = e.nativeBarWidth;
          if (
            ((this.vert.style.display = ""),
            (this.vert.firstChild.style.height = "0"),
            t)
          ) {
            (this.horiz.style.display = "block"),
              (this.horiz.style.right = n ? i + "px" : "0"),
              (this.horiz.style.left = e.barLeft + "px");
            var r = e.viewWidth - e.barLeft - (n ? i : 0);
            this.horiz.firstChild.style.width =
              Math.max(0, e.scrollWidth - e.clientWidth + r) + "px";
          } else
            (this.horiz.style.display = ""),
              (this.horiz.firstChild.style.width = "0");
          return (
            !this.checkedZeroWidth &&
              e.clientHeight > 0 &&
              (0 == i && this.zeroWidthHack(), (this.checkedZeroWidth = !0)),
            { right: n ? i : 0, bottom: t ? i : 0 }
          );
        }),
          (Li.prototype.setScrollLeft = function (e) {
            this.horiz.scrollLeft != e && (this.horiz.scrollLeft = e),
              this.disableHoriz &&
                this.enableZeroWidthBar(this.horiz, this.disableHoriz, "horiz");
          }),
          (Li.prototype.setScrollTop = function (e) {
            this.vert.scrollTop != e && (this.vert.scrollTop = e),
              this.disableVert &&
                this.enableZeroWidthBar(this.vert, this.disableVert, "vert");
          }),
          (Li.prototype.zeroWidthHack = function () {
            var e = y && !p ? "12px" : "18px";
            (this.horiz.style.height = this.vert.style.width = e),
              (this.horiz.style.pointerEvents = this.vert.style.pointerEvents =
                "none"),
              (this.disableHoriz = new $()),
              (this.disableVert = new $());
          }),
          (Li.prototype.enableZeroWidthBar = function (e, t, n) {
            (e.style.pointerEvents = "auto"),
              t.set(1e3, function i() {
                var r = e.getBoundingClientRect();
                ("vert" == n
                  ? document.elementFromPoint(
                      r.right - 1,
                      (r.top + r.bottom) / 2
                    )
                  : document.elementFromPoint(
                      (r.right + r.left) / 2,
                      r.bottom - 1
                    )) != e
                  ? (e.style.pointerEvents = "none")
                  : t.set(1e3, i);
              });
          }),
          (Li.prototype.clear = function () {
            var e = this.horiz.parentNode;
            e.removeChild(this.horiz), e.removeChild(this.vert);
          });
        var Ni = function () {};
        function Di(e, t) {
          t || (t = Mi(e));
          var n = e.display.barWidth,
            i = e.display.barHeight;
          Bi(e, t);
          for (
            var r = 0;
            (r < 4 && n != e.display.barWidth) || i != e.display.barHeight;
            r++
          )
            n != e.display.barWidth && e.options.lineWrapping && gi(e),
              Bi(e, Mi(e)),
              (n = e.display.barWidth),
              (i = e.display.barHeight);
        }
        function Bi(e, t) {
          var n = e.display,
            i = n.scrollbars.update(t);
          (n.sizer.style.paddingRight = (n.barWidth = i.right) + "px"),
            (n.sizer.style.paddingBottom = (n.barHeight = i.bottom) + "px"),
            (n.heightForcer.style.borderBottom =
              i.bottom + "px solid transparent"),
            i.right && i.bottom
              ? ((n.scrollbarFiller.style.display = "block"),
                (n.scrollbarFiller.style.height = i.bottom + "px"),
                (n.scrollbarFiller.style.width = i.right + "px"))
              : (n.scrollbarFiller.style.display = ""),
            i.bottom &&
            e.options.coverGutterNextToScrollbar &&
            e.options.fixedGutter
              ? ((n.gutterFiller.style.display = "block"),
                (n.gutterFiller.style.height = i.bottom + "px"),
                (n.gutterFiller.style.width = t.gutterWidth + "px"))
              : (n.gutterFiller.style.display = "");
        }
        (Ni.prototype.update = function () {
          return { bottom: 0, right: 0 };
        }),
          (Ni.prototype.setScrollLeft = function () {}),
          (Ni.prototype.setScrollTop = function () {}),
          (Ni.prototype.clear = function () {});
        var Ri = { native: Li, null: Ni };
        function Pi(e) {
          e.display.scrollbars &&
            (e.display.scrollbars.clear(),
            e.display.scrollbars.addClass &&
              E(e.display.wrapper, e.display.scrollbars.addClass)),
            (e.display.scrollbars = new Ri[e.options.scrollbarStyle](
              function (t) {
                e.display.wrapper.insertBefore(t, e.display.scrollbarFiller),
                  it(t, "mousedown", function () {
                    e.state.focused &&
                      setTimeout(function () {
                        return e.display.input.focus();
                      }, 0);
                  }),
                  t.setAttribute("cm-not-content", "true");
              },
              function (t, n) {
                "horizontal" == n ? Ai(e, t) : Ti(e, t);
              },
              e
            )),
            e.display.scrollbars.addClass &&
              D(e.display.wrapper, e.display.scrollbars.addClass);
        }
        var Ii = 0;
        function Oi(e) {
          var t;
          (e.curOp = {
            cm: e,
            viewChanged: !1,
            startHeight: e.doc.height,
            forceUpdate: !1,
            updateInput: null,
            typing: !1,
            changeObjs: null,
            cursorActivityHandlers: null,
            cursorActivityCalled: 0,
            selectionChanged: !1,
            updateMaxLine: !1,
            scrollLeft: null,
            scrollTop: null,
            scrollToPos: null,
            focus: !1,
            id: ++Ii,
          }),
            (t = e.curOp),
            an
              ? an.ops.push(t)
              : (t.ownsGroup = an = { ops: [t], delayedCallbacks: [] });
        }
        function $i(e) {
          !(function (e, t) {
            var n = e.ownsGroup;
            if (n)
              try {
                !(function (e) {
                  var t = e.delayedCallbacks,
                    n = 0;
                  do {
                    for (; n < t.length; n++) t[n].call(null);
                    for (var i = 0; i < e.ops.length; i++) {
                      var r = e.ops[i];
                      if (r.cursorActivityHandlers)
                        for (
                          ;
                          r.cursorActivityCalled <
                          r.cursorActivityHandlers.length;

                        )
                          r.cursorActivityHandlers[
                            r.cursorActivityCalled++
                          ].call(null, r.cm);
                    }
                  } while (n < t.length);
                })(n);
              } finally {
                (an = null), t(n);
              }
          })(e.curOp, function (e) {
            for (var t = 0; t < e.ops.length; t++) e.ops[t].cm.curOp = null;
            !(function (e) {
              for (var t = e.ops, n = 0; n < t.length; n++) Hi(t[n]);
              for (var i = 0; i < t.length; i++)
                (r = t[i]).updatedDisplay = r.mustUpdate && nr(r.cm, r.update);
              var r;
              for (var o = 0; o < t.length; o++) Ui(t[o]);
              for (var a = 0; a < t.length; a++) ji(t[a]);
              for (var s = 0; s < t.length; s++) qi(t[s]);
            })(e);
          });
        }
        function Hi(e) {
          var t = e.cm,
            n = t.display;
          !(function (e) {
            var t = e.display;
            !t.scrollbarsClipped &&
              t.scroller.offsetWidth &&
              ((t.nativeBarWidth =
                t.scroller.offsetWidth - t.scroller.clientWidth),
              (t.heightForcer.style.height = En(e) + "px"),
              (t.sizer.style.marginBottom = -t.nativeBarWidth + "px"),
              (t.sizer.style.borderRightWidth = En(e) + "px"),
              (t.scrollbarsClipped = !0));
          })(t),
            e.updateMaxLine && Je(t),
            (e.mustUpdate =
              e.viewChanged ||
              e.forceUpdate ||
              null != e.scrollTop ||
              (e.scrollToPos &&
                (e.scrollToPos.from.line < n.viewFrom ||
                  e.scrollToPos.to.line >= n.viewTo)) ||
              (n.maxLineChanged && t.options.lineWrapping)),
            (e.update =
              e.mustUpdate &&
              new tr(
                t,
                e.mustUpdate && { top: e.scrollTop, ensure: e.scrollToPos },
                e.forceUpdate
              ));
        }
        function Ui(e) {
          var t = e.cm,
            n = t.display;
          e.updatedDisplay && gi(t),
            (e.barMeasure = Mi(t)),
            n.maxLineChanged &&
              !t.options.lineWrapping &&
              ((e.adjustWidthTo =
                Mn(t, n.maxLine, n.maxLine.text.length).left + 3),
              (t.display.sizerWidth = e.adjustWidthTo),
              (e.barMeasure.scrollWidth = Math.max(
                n.scroller.clientWidth,
                n.sizer.offsetLeft +
                  e.adjustWidthTo +
                  En(t) +
                  t.display.barWidth
              )),
              (e.maxScrollLeft = Math.max(
                0,
                n.sizer.offsetLeft + e.adjustWidthTo - Tn(t)
              ))),
            (e.updatedDisplay || e.selectionChanged) &&
              (e.preparedSelection = n.input.prepareSelection(e.focus));
        }
        function ji(e) {
          var t = e.cm;
          null != e.adjustWidthTo &&
            ((t.display.sizer.style.minWidth = e.adjustWidthTo + "px"),
            e.maxScrollLeft < t.doc.scrollLeft &&
              Ai(
                t,
                Math.min(t.display.scroller.scrollLeft, e.maxScrollLeft),
                !0
              ),
            (t.display.maxLineChanged = !1));
          var n =
            e.focus &&
            e.focus == N() &&
            (!document.hasFocus || document.hasFocus());
          e.preparedSelection &&
            t.display.input.showSelection(e.preparedSelection, n),
            (e.updatedDisplay || e.startHeight != t.doc.height) &&
              Di(t, e.barMeasure),
            e.updatedDisplay && ar(t, e.barMeasure),
            e.selectionChanged && ui(t),
            t.state.focused && e.updateInput && t.display.input.reset(e.typing),
            n && hi(e.cm);
        }
        function qi(e) {
          var t = e.cm,
            n = t.display,
            i = t.doc;
          (e.updatedDisplay && ir(t, e.update),
          null == n.wheelStartX ||
            (null == e.scrollTop && null == e.scrollLeft && !e.scrollToPos) ||
            (n.wheelStartX = n.wheelStartY = null),
          null != e.scrollTop && _i(t, e.scrollTop, e.forceScroll),
          null != e.scrollLeft && Ai(t, e.scrollLeft, !0, !0),
          e.scrollToPos) &&
            (function (e, t) {
              if (!st(e, "scrollCursorIntoView")) {
                var n = e.display,
                  i = n.sizer.getBoundingClientRect(),
                  r = null,
                  o =
                    File.editor.sourceView &&
                    File.editor.sourceView.inSourceMode
                      ? 0
                      : 16;
                if (t.top + i.top < 0) r = !0;
                else if (
                  t.bottom + i.top >
                  (window.innerHeight ||
                    document.documentElement.clientHeight) -
                    o
                )
                  r = !1;
                else {
                  var a = n.sizer.closest(".md-diagram, .md-math-block");
                  a &&
                    a.getBoundingClientRect().bottom >
                      (window.innerHeight ||
                        document.documentElement.clientHeight) -
                        o &&
                    (r = !1);
                }
                if (null != r && !f) {
                  var s = A(
                    "div",
                    "​",
                    null,
                    "position: absolute;\n                         top: " +
                      (t.top - n.viewOffset - Fn(e.display)) +
                      "px;\n                         height: " +
                      (t.bottom - t.top + En(e) + n.barHeight) +
                      "px;\n                         left: " +
                      t.left +
                      "px; width: " +
                      Math.max(2, t.right - t.left) +
                      "px;"
                  );
                  e.display.lineSpace.appendChild(s),
                    File.editor.sourceView &&
                    File.editor.sourceView.inSourceMode
                      ? s.scrollIntoView(r)
                      : File.editor.fences && !File.editor.fences.isMousePressed
                      ? File.editor.selection.scrollAdjust(s)
                      : s.scrollIntoViewIfNeeded
                      ? s.scrollIntoViewIfNeeded(!1)
                      : s.scrollIntoView(r),
                    e.display.lineSpace.removeChild(s);
                }
              }
            })(
              t,
              (function (e, t, n, i) {
                var r;
                null == i && (i = 0);
                for (var o = 0; o < 5; o++) {
                  var a = !1,
                    s = Vn(e, t),
                    l = n && n != t ? Vn(e, n) : s,
                    c = xi(
                      e,
                      (r = {
                        left: Math.min(s.left, l.left),
                        top: Math.min(s.top, l.top) - i,
                        right: Math.max(s.left, l.left),
                        bottom: Math.max(s.bottom, l.bottom) + i,
                      })
                    ),
                    d = e.doc.scrollTop,
                    u = e.doc.scrollLeft;
                  if (
                    (null != c.scrollTop &&
                      (Ti(e, c.scrollTop),
                      Math.abs(e.doc.scrollTop - d) > 1 && (a = !0)),
                    null != c.scrollLeft &&
                      (Ai(e, c.scrollLeft),
                      Math.abs(e.doc.scrollLeft - u) > 1 && (a = !0)),
                    !a)
                  )
                    break;
                }
                return r;
              })(
                t,
                Ce(i, e.scrollToPos.from),
                Ce(i, e.scrollToPos.to),
                e.scrollToPos.margin
              )
            );
          var r = e.maybeHiddenMarkers,
            o = e.maybeUnhiddenMarkers;
          if (r)
            for (var a = 0; a < r.length; ++a)
              r[a].lines.length || at(r[a], "hide");
          if (o)
            for (var s = 0; s < o.length; ++s)
              o[s].lines.length && at(o[s], "unhide");
          n.wrapper.offsetHeight &&
            (i.scrollTop = t.display.scroller.scrollTop),
            e.changeObjs && at(t, "changes", t, e.changeObjs),
            e.update && e.update.finish();
        }
        function Wi(e, t) {
          if (e.curOp) return t();
          Oi(e);
          try {
            return t();
          } finally {
            $i(e);
          }
        }
        function zi(e, t) {
          return function () {
            if (e.curOp) return t.apply(e, arguments);
            Oi(e);
            try {
              return t.apply(e, arguments);
            } finally {
              $i(e);
            }
          };
        }
        function Vi(e) {
          return function () {
            if (this.curOp) return e.apply(this, arguments);
            Oi(this);
            try {
              return e.apply(this, arguments);
            } finally {
              $i(this);
            }
          };
        }
        function Ji(e) {
          return function () {
            var t = this.cm;
            if (!t || t.curOp) return e.apply(this, arguments);
            Oi(t);
            try {
              return e.apply(this, arguments);
            } finally {
              $i(t);
            }
          };
        }
        function Ki(e, t, n, i) {
          null == t && (t = e.doc.first),
            null == n && (n = e.doc.first + e.doc.size),
            i || (i = 0);
          var r = e.display;
          if (
            (i &&
              n < r.viewTo &&
              (null == r.updateLineNumbers || r.updateLineNumbers > t) &&
              (r.updateLineNumbers = t),
            (e.curOp.viewChanged = !0),
            t >= r.viewTo)
          )
            ke && Ue(e.doc, t) < r.viewTo && Gi(e);
          else if (n <= r.viewFrom)
            ke && je(e.doc, n + i) > r.viewFrom
              ? Gi(e)
              : ((r.viewFrom += i), (r.viewTo += i));
          else if (t <= r.viewFrom && n >= r.viewTo) Gi(e);
          else if (t <= r.viewFrom) {
            var o = Qi(e, n, n + i, 1);
            o
              ? ((r.view = r.view.slice(o.index)),
                (r.viewFrom = o.lineN),
                (r.viewTo += i))
              : Gi(e);
          } else if (n >= r.viewTo) {
            var a = Qi(e, t, t, -1);
            a
              ? ((r.view = r.view.slice(0, a.index)), (r.viewTo = a.lineN))
              : Gi(e);
          } else {
            var s = Qi(e, t, t, -1),
              l = Qi(e, n, n + i, 1);
            s && l
              ? ((r.view = r.view
                  .slice(0, s.index)
                  .concat(on(e, s.lineN, l.lineN))
                  .concat(r.view.slice(l.index))),
                (r.viewTo += i))
              : Gi(e);
          }
          var c = r.externalMeasured;
          c &&
            (n < c.lineN
              ? (c.lineN += i)
              : t < c.lineN + c.size && (r.externalMeasured = null));
        }
        function Yi(e, t, n) {
          e.curOp.viewChanged = !0;
          var i = e.display,
            r = e.display.externalMeasured;
          if (
            (r &&
              t >= r.lineN &&
              t < r.lineN + r.size &&
              (i.externalMeasured = null),
            !(t < i.viewFrom || t >= i.viewTo))
          ) {
            var o = i.view[ai(e, t)];
            if (null != o.node) {
              var a = o.changes || (o.changes = []);
              -1 == H(a, n) && a.push(n);
            }
          }
        }
        function Gi(e) {
          (e.display.viewFrom = e.display.viewTo = e.doc.first),
            (e.display.view = []),
            (e.display.viewOffset = 0);
        }
        function Qi(e, t, n, i) {
          var r,
            o = ai(e, t),
            a = e.display.view;
          if (!ke || n == e.doc.first + e.doc.size)
            return { index: o, lineN: n };
          for (var s = e.display.viewFrom, l = 0; l < o; l++) s += a[l].size;
          if (s != t) {
            if (i > 0) {
              if (o == a.length - 1) return null;
              (r = s + a[o].size - t), o++;
            } else r = s - t;
            (t += r), (n += r);
          }
          for (; Ue(e.doc, n) != n; ) {
            if (o == (i < 0 ? 0 : a.length - 1)) return null;
            (n += i * a[o - (i < 0 ? 1 : 0)].size), (o += i);
          }
          return { index: o, lineN: n };
        }
        function Xi(e) {
          for (var t = e.display.view, n = 0, i = 0; i < t.length; i++) {
            var r = t[i];
            r.hidden || (r.node && !r.changes) || ++n;
          }
          return n;
        }
        function Zi(e, t) {
          e.doc.mode.startState &&
            e.doc.frontier < e.display.viewTo &&
            e.state.highlight.set(t, P(er, e));
        }
        function er(e) {
          var t = e.doc;
          if (
            (t.frontier < t.first && (t.frontier = t.first),
            !(t.frontier >= e.display.viewTo))
          ) {
            var n = +new Date() + e.options.workTime,
              i = Dt(t.mode, $t(e, t.frontier)),
              r = [];
            t.iter(
              t.frontier,
              Math.min(t.first + t.size, e.display.viewTo + 500),
              function (o) {
                if (t.frontier >= e.display.viewFrom) {
                  var a = o.styles,
                    s = o.text.length > e.options.maxHighlightLength,
                    l = It(e, o, s ? Dt(t.mode, i) : i, !0);
                  o.styles = l.styles;
                  var c = o.styleClasses,
                    d = l.classes;
                  d ? (o.styleClasses = d) : c && (o.styleClasses = null);
                  for (
                    var u =
                        !a ||
                        a.length != o.styles.length ||
                        (c != d &&
                          (!c ||
                            !d ||
                            c.bgClass != d.bgClass ||
                            c.textClass != d.textClass)),
                      h = 0;
                    !u && h < a.length;
                    ++h
                  )
                    u = a[h] != o.styles[h];
                  u && r.push(t.frontier),
                    (o.stateAfter = s ? i : Dt(t.mode, i));
                } else
                  o.text.length <= e.options.maxHighlightLength &&
                    Ht(e, o.text, i),
                    (o.stateAfter = t.frontier % 5 == 0 ? Dt(t.mode, i) : null);
                if ((++t.frontier, +new Date() > n))
                  return Zi(e, e.options.workDelay), !0;
              }
            ),
              r.length &&
                Wi(e, function () {
                  for (var t = 0; t < r.length; t++) Yi(e, r[t], "text");
                });
          }
        }
        var tr = function (e, t, n) {
          var i = e.display;
          (this.viewport = t),
            (this.visible = yi(i, e.doc, t)),
            (this.editorIsHidden = !i.wrapper.offsetWidth),
            (this.wrapperHeight = i.wrapper.clientHeight),
            (this.wrapperWidth = i.wrapper.clientWidth),
            (this.oldDisplayWidth = Tn(e)),
            (this.force = n),
            (this.dims = ti(e)),
            (this.events = []);
        };
        function nr(e, t) {
          var n = e.display,
            i = e.doc;
          if (t.editorIsHidden) return Gi(e), !1;
          if (
            !t.force &&
            t.visible.from >= n.viewFrom &&
            t.visible.to <= n.viewTo &&
            (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo) &&
            n.renderedView == n.view &&
            0 == Xi(e)
          )
            return !1;
          wi(e) && (Gi(e), (t.dims = ti(e)));
          var r = i.first + i.size,
            o = Math.max(t.visible.from - e.options.viewportMargin, i.first),
            a = Math.min(r, t.visible.to + e.options.viewportMargin);
          n.viewFrom < o &&
            o - n.viewFrom < 20 &&
            (o = Math.max(i.first, n.viewFrom)),
            n.viewTo > a && n.viewTo - a < 20 && (a = Math.min(r, n.viewTo)),
            ke && ((o = Ue(e.doc, o)), (a = je(e.doc, a)));
          var s =
            o != n.viewFrom ||
            a != n.viewTo ||
            n.lastWrapHeight != t.wrapperHeight ||
            n.lastWrapWidth != t.wrapperWidth;
          !(function (e, t, n) {
            var i = e.display;
            0 == i.view.length || t >= i.viewTo || n <= i.viewFrom
              ? ((i.view = on(e, t, n)), (i.viewFrom = t))
              : (i.viewFrom > t
                  ? (i.view = on(e, t, i.viewFrom).concat(i.view))
                  : i.viewFrom < t && (i.view = i.view.slice(ai(e, t))),
                (i.viewFrom = t),
                i.viewTo < n
                  ? (i.view = i.view.concat(on(e, i.viewTo, n)))
                  : i.viewTo > n && (i.view = i.view.slice(0, ai(e, n)))),
              (i.viewTo = n);
          })(e, o, a),
            (n.viewOffset = ze(se(e.doc, n.viewFrom))),
            (e.display.mover.style.top = n.viewOffset + "px");
          var c = Xi(e);
          if (
            !s &&
            0 == c &&
            !t.force &&
            n.renderedView == n.view &&
            (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo)
          )
            return !1;
          var d = (function (e) {
            if (e.hasFocus()) return null;
            var t = N();
            if (!t || !L(e.display.lineDiv, t)) return null;
            var n = { activeElt: t };
            if (window.getSelection) {
              var i = window.getSelection();
              i.anchorNode &&
                i.extend &&
                L(e.display.lineDiv, i.anchorNode) &&
                ((n.anchorNode = i.anchorNode),
                (n.anchorOffset = i.anchorOffset),
                (n.focusNode = i.focusNode),
                (n.focusOffset = i.focusOffset));
            }
            return n;
          })(e);
          return (
            c > 4 && (n.lineDiv.style.display = "none"),
            (function (e, t, n) {
              var i = e.display,
                r = e.options.lineNumbers,
                o = i.lineDiv,
                a = o.firstChild;
              function s(t) {
                var n = t.nextSibling;
                return (
                  l && y && e.display.currentWheelTarget == t
                    ? (t.style.display = "none")
                    : t.parentNode.removeChild(t),
                  n
                );
              }
              for (var c = i.view, d = i.viewFrom, u = 0; u < c.length; u++) {
                var h = c[u];
                if (h.hidden);
                else if (h.node && h.node.parentNode == o) {
                  for (; a != h.node; ) a = s(a);
                  var p = r && null != t && t <= d && h.lineNumber;
                  h.changes &&
                    (H(h.changes, "gutter") > -1 && (p = !1), dn(e, h, d, n)),
                    p &&
                      (T(h.lineNumber),
                      h.lineNumber.appendChild(
                        document.createTextNode(fe(e.options, d))
                      )),
                    (a = h.node.nextSibling);
                } else {
                  var f = vn(e, h, d, n);
                  o.insertBefore(f, a);
                }
                d += h.size;
              }
              for (; a; ) a = s(a);
            })(e, n.updateLineNumbers, t.dims),
            c > 4 && (n.lineDiv.style.display = ""),
            (n.renderedView = n.view),
            (function (e) {
              if (
                e &&
                e.activeElt &&
                e.activeElt != N() &&
                (e.activeElt.focus(),
                e.anchorNode &&
                  L(document.body, e.anchorNode) &&
                  L(document.body, e.focusNode))
              ) {
                var t = window.getSelection(),
                  n = document.createRange();
                n.setEnd(e.anchorNode, e.anchorOffset),
                  n.collapse(!1),
                  t.removeAllRanges(),
                  t.addRange(n),
                  t.extend(e.focusNode, e.focusOffset);
              }
            })(d),
            T(n.cursorDiv),
            T(n.selectionDiv),
            (n.gutters.style.height = n.sizer.style.minHeight = 0),
            s &&
              ((n.lastWrapHeight = t.wrapperHeight),
              (n.lastWrapWidth = t.wrapperWidth),
              Zi(e, 400)),
            (n.updateLineNumbers = null),
            !0
          );
        }
        function ir(e, t) {
          for (
            var n = t.viewport, i = !0;
            ((i && e.options.lineWrapping && t.oldDisplayWidth != Tn(e)) ||
              (n &&
                null != n.top &&
                (n = {
                  top: Math.min(e.doc.height + Sn(e.display) - _n(e), n.top),
                }),
              (t.visible = yi(e.display, e.doc, n)),
              !(
                t.visible.from >= e.display.viewFrom &&
                t.visible.to <= e.display.viewTo
              ))) &&
            nr(e, t);
            i = !1
          ) {
            gi(e);
            var r = Mi(e);
            si(e), Di(e, r), ar(e, r);
          }
          t.signal(e, "update", e),
            (e.display.viewFrom == e.display.reportedViewFrom &&
              e.display.viewTo == e.display.reportedViewTo) ||
              (t.signal(
                e,
                "viewportChange",
                e,
                e.display.viewFrom,
                e.display.viewTo
              ),
              (e.display.reportedViewFrom = e.display.viewFrom),
              (e.display.reportedViewTo = e.display.viewTo));
        }
        function rr(e, t) {
          var n = new tr(e, t);
          if (nr(e, n)) {
            gi(e), ir(e, n);
            var i = Mi(e);
            si(e), Di(e, i), ar(e, i), n.finish();
          }
        }
        function or(e) {
          var t = e.display.gutters.offsetWidth;
          e.display.sizer.style.marginLeft = t + "px";
        }
        function ar(e, t) {
          (e.display.sizer.style.minHeight = t.docHeight + "px"),
            (e.display.heightForcer.style.top = t.docHeight + "px"),
            (e.display.gutters.style.height =
              t.docHeight + e.display.barHeight + En(e) + "px");
        }
        function sr(e) {
          var t = e.display.gutters,
            n = e.options.gutters;
          T(t);
          for (var i = 0; i < n.length; ++i) {
            var r = n[i],
              o = t.appendChild(A("div", null, "CodeMirror-gutter " + r));
            "CodeMirror-linenumbers" == r &&
              ((e.display.lineGutter = o),
              (o.style.width = (e.display.lineNumWidth || 1) + "px"));
          }
          (t.style.display = i ? "" : "none"), or(e);
        }
        function lr(e) {
          var t = H(e.gutters, "CodeMirror-linenumbers");
          -1 == t && e.lineNumbers
            ? (e.gutters = e.gutters.concat(["CodeMirror-linenumbers"]))
            : t > -1 &&
              !e.lineNumbers &&
              ((e.gutters = e.gutters.slice(0)), e.gutters.splice(t, 1));
        }
        (tr.prototype.signal = function (e, t) {
          ct(e, t) && this.events.push(arguments);
        }),
          (tr.prototype.finish = function () {
            for (var e = 0; e < this.events.length; e++)
              at.apply(null, this.events[e]);
          });
        var cr = 0,
          dr = null;
        function ur(e) {
          var t = e.wheelDeltaX,
            n = e.wheelDeltaY;
          return (
            null == t &&
              e.detail &&
              e.axis == e.HORIZONTAL_AXIS &&
              (t = e.detail),
            null == n && e.detail && e.axis == e.VERTICAL_AXIS
              ? (n = e.detail)
              : null == n && (n = e.wheelDelta),
            { x: t, y: n }
          );
        }
        function hr(e) {
          var t = ur(e);
          return (t.x *= dr), (t.y *= dr), t;
        }
        function pr(e, t) {
          var i = ur(t),
            r = i.x,
            o = i.y,
            a = e.display,
            s = a.scroller,
            c = s.scrollWidth > s.clientWidth;
          if (r && c) {
            if (o && y && l)
              e: for (var d = t.target, h = a.view; d != s; d = d.parentNode)
                for (var p = 0; p < h.length; p++)
                  if (h[p].node == d) {
                    e.display.currentWheelTarget = d;
                    break e;
                  }
            if (r && !n && !u && null != dr)
              return (
                r && Ai(e, Math.max(0, s.scrollLeft + r * dr)),
                void (a.wheelStartX = null)
              );
            if (o && null != dr) {
              var f = o * dr,
                m = e.doc.scrollTop,
                g = m + a.wrapper.clientHeight;
              f < 0
                ? (m = Math.max(0, m + f - 50))
                : (g = Math.min(e.doc.height, g + f + 50)),
                rr(e, { top: m, bottom: g });
            }
            cr < 20 &&
              (null == a.wheelStartX
                ? ((a.wheelStartX = s.scrollLeft),
                  (a.wheelStartY = s.scrollTop),
                  (a.wheelDX = r),
                  (a.wheelDY = o),
                  setTimeout(function () {
                    if (null != a.wheelStartX) {
                      var e = s.scrollLeft - a.wheelStartX,
                        t = s.scrollTop - a.wheelStartY,
                        n =
                          (t && a.wheelDY && t / a.wheelDY) ||
                          (e && a.wheelDX && e / a.wheelDX);
                      (a.wheelStartX = a.wheelStartY = null),
                        n && ((dr = (dr * cr + n) / (cr + 1)), ++cr);
                    }
                  }, 200))
                : ((a.wheelDX += r), (a.wheelDY += o)));
          }
        }
        a ? (dr = -0.53) : n ? (dr = 15) : d ? (dr = -0.7) : h && (dr = -1 / 3);
        var fr = function (e, t) {
          (this.ranges = e), (this.primIndex = t);
        };
        (fr.prototype.primary = function () {
          return this.ranges[this.primIndex];
        }),
          (fr.prototype.equals = function (e) {
            if (e == this) return !0;
            if (
              e.primIndex != this.primIndex ||
              e.ranges.length != this.ranges.length
            )
              return !1;
            for (var t = 0; t < this.ranges.length; t++) {
              var n = this.ranges[t],
                i = e.ranges[t];
              if (!ve(n.anchor, i.anchor) || !ve(n.head, i.head)) return !1;
            }
            return !0;
          }),
          (fr.prototype.deepCopy = function () {
            for (var e = [], t = 0; t < this.ranges.length; t++)
              e[t] = new mr(ye(this.ranges[t].anchor), ye(this.ranges[t].head));
            return new fr(e, this.primIndex);
          }),
          (fr.prototype.somethingSelected = function () {
            for (var e = 0; e < this.ranges.length; e++)
              if (!this.ranges[e].empty()) return !0;
            return !1;
          }),
          (fr.prototype.contains = function (e, t) {
            t || (t = e);
            for (var n = 0; n < this.ranges.length; n++) {
              var i = this.ranges[n];
              if (ge(t, i.from()) >= 0 && ge(e, i.to()) <= 0) return n;
            }
            return -1;
          });
        var mr = function (e, t) {
          (this.anchor = e), (this.head = t);
        };
        function gr(e, t) {
          var n = e[t];
          e.sort(function (e, t) {
            return ge(e.from(), t.from());
          }),
            (t = H(e, n));
          for (var i = 1; i < e.length; i++) {
            var r = e[i],
              o = e[i - 1];
            if (ge(o.to(), r.from()) >= 0) {
              var a = we(o.from(), r.from()),
                s = be(o.to(), r.to()),
                l = o.empty() ? r.from() == r.head : o.from() == o.head;
              i <= t && --t, e.splice(--i, 2, new mr(l ? s : a, l ? a : s));
            }
          }
          return new fr(e, t);
        }
        function vr(e, t) {
          return new fr([new mr(e, t || e)], 0);
        }
        function yr(e) {
          return e.text
            ? me(
                e.from.line + e.text.length - 1,
                Y(e.text).length + (1 == e.text.length ? e.from.ch : 0)
              )
            : e.to;
        }
        function br(e, t) {
          if (ge(e, t.from) < 0) return e;
          if (ge(e, t.to) <= 0) return yr(t);
          var n = e.line + t.text.length - (t.to.line - t.from.line) - 1,
            i = e.ch;
          return e.line == t.to.line && (i += yr(t).ch - t.to.ch), me(n, i);
        }
        function wr(e, t) {
          for (var n = [], i = 0; i < e.sel.ranges.length; i++) {
            var r = e.sel.ranges[i],
              o = new mr(br(r.anchor, t), br(r.head, t));
            t.redoSel &&
              ((o.anchor = t.from),
              "select" == t.redoSel &&
                ((o.head.line = t.from.line),
                (o.head.ch = t.from.ch + (t.text[0] || "").length))),
              n.push(o);
          }
          return gr(n, e.sel.primIndex);
        }
        function xr(e, t, n) {
          return e.line == t.line
            ? me(n.line, e.ch - t.ch + n.ch)
            : me(n.line + (e.line - t.line), e.ch);
        }
        function Cr(e) {
          (e.doc.mode = Mt(e.options, e.doc.modeOption)), Fr(e);
        }
        function Fr(e) {
          e.doc.iter(function (e) {
            e.stateAfter && (e.stateAfter = null),
              e.styles && (e.styles = null);
          }),
            (e.doc.frontier = e.doc.first),
            Zi(e, 100),
            e.state.modeGen++,
            e.curOp && Ki(e);
        }
        function Sr(e, t) {
          return (
            0 == t.from.ch &&
            0 == t.to.ch &&
            "" == Y(t.text) &&
            (!e.cm || e.cm.options.wholeLineUpdateBefore)
          );
        }
        function kr(e, t, n, i) {
          function r(e) {
            return n ? n[e] : null;
          }
          function o(e, n, r) {
            !(function (e, t, n, i) {
              (e.text = t),
                e.stateAfter && (e.stateAfter = null),
                e.styles && (e.styles = null),
                null != e.order && (e.order = null),
                Le(e),
                Ne(e, n);
              var r = i ? i(e) : 1;
              r != e.height && de(e, r);
            })(e, n, r, i),
              ln(e, "change", e, t);
          }
          function a(e, t) {
            for (var n = [], o = e; o < t; ++o) n.push(new Vt(c[o], r(o), i));
            return n;
          }
          var s = t.from,
            l = t.to,
            c = t.text,
            d = se(e, s.line),
            u = se(e, l.line),
            h = Y(c),
            p = r(c.length - 1),
            f = l.line - s.line;
          if (t.full)
            e.insert(0, a(0, c.length)), e.remove(c.length, e.size - c.length);
          else if (Sr(e, t)) {
            var m = a(0, c.length - 1);
            o(u, u.text, p),
              f && e.remove(s.line, f),
              m.length && e.insert(s.line, m);
          } else if (d == u)
            if (1 == c.length)
              o(d, d.text.slice(0, s.ch) + h + d.text.slice(l.ch), p);
            else {
              var g = a(1, c.length - 1);
              g.push(new Vt(h + d.text.slice(l.ch), p, i)),
                o(d, d.text.slice(0, s.ch) + c[0], r(0)),
                e.insert(s.line + 1, g);
            }
          else if (1 == c.length)
            o(d, d.text.slice(0, s.ch) + c[0] + u.text.slice(l.ch), r(0)),
              e.remove(s.line + 1, f);
          else {
            o(d, d.text.slice(0, s.ch) + c[0], r(0)),
              o(u, h + u.text.slice(l.ch), p);
            var v = a(1, c.length - 1);
            f > 1 && e.remove(s.line + 1, f - 1), e.insert(s.line + 1, v);
          }
          ln(e, "change", e, t);
        }
        function Er(e, t, n) {
          !(function e(i, r, o) {
            if (i.linked)
              for (var a = 0; a < i.linked.length; ++a) {
                var s = i.linked[a];
                if (s.doc != r) {
                  var l = o && s.sharedHist;
                  (n && !l) || (t(s.doc, l), e(s.doc, i, l));
                }
              }
          })(e, null, !0);
        }
        function Tr(e, t) {
          if (t.cm) throw new Error("This document is already in use.");
          (e.doc = t),
            (t.cm = e),
            ri(e),
            Cr(e),
            _r(e),
            e.options.lineWrapping || Je(e),
            (e.options.mode = t.modeOption),
            Ki(e);
        }
        function _r(e) {
          ("rtl" == e.doc.direction ? D : E)(
            e.display.lineDiv,
            "CodeMirror-rtl"
          );
        }
        function Ar(e) {
          (this.done = []),
            (this.undone = []),
            (this.undoDepth = 1 / 0),
            (this.lastModTime = this.lastSelTime = 0),
            (this.lastOp = this.lastSelOp = null),
            (this.lastOrigin = this.lastSelOrigin = null),
            (this.generation = this.maxGeneration = e || 1);
        }
        function Mr(e, t) {
          var n = { from: ye(t.from), to: yr(t), text: le(e, t.from, t.to) };
          return (
            Ir(e, n, t.from.line, t.to.line + 1),
            Er(
              e,
              function (e) {
                return Ir(e, n, t.from.line, t.to.line + 1);
              },
              !0
            ),
            n
          );
        }
        function Lr(e) {
          for (; e.length; ) {
            if (!Y(e).ranges) break;
            e.pop();
          }
        }
        function Nr(e, t) {
          return t
            ? {
                from: t.from,
                to: t.to,
                text: t.text,
                redoSel: !!t["spans_" + e.id],
                origin: t.origin,
              }
            : null;
        }
        function Dr(e, t) {
          var n = Nr(e, t),
            i = Nr(e, Mr(e, t));
          return (
            (n.origin = "undo"),
            (i.origin = "undo"),
            "+findReplace" == t.origin &&
              ((n.redoSel = "select"), (i.redoSel = "select")),
            {
              undo: [{ type: "fences", change: i, id: e.cm.cid }],
              redo: [{ type: "fences", change: n, id: e.cm.cid }],
            }
          );
        }
        function Br(e, t, n, i) {
          if (t && "undo" == t.origin) e.clearHistory();
          else {
            var r = e.history;
            r.undone.length = 0;
            var o,
              a,
              s = +new Date(),
              l = (t.text || []).length > 1;
            t.origin = t.origin || "";
            var c =
              !l &&
              (r.lastOp == i ||
                (r.lastOrigin == t.origin &&
                  t.origin &&
                  (("+" == t.origin.charAt(0) &&
                    e.cm &&
                    r.lastModTime > s - e.cm.options.historyEventDelay) ||
                    "*" == t.origin.charAt(0))));
            if (e.cm.editor.sourceView.inSourceMode || !e.cm.cid)
              if (
                (c =
                  c &&
                  (o = (function (e, t) {
                    return t
                      ? (Lr(e.done), Y(e.done))
                      : e.done.length && !Y(e.done).ranges
                      ? Y(e.done)
                      : e.done.length > 1 && !e.done[e.done.length - 2].ranges
                      ? (e.done.pop(), Y(e.done))
                      : void 0;
                  })(r, r.lastOp == i)))
              )
                (a = Y(o.changes)),
                  0 == ge(t.from, t.to) && 0 == ge(t.from, a.to)
                    ? (a.to = yr(t))
                    : o.changes.push(Mr(e, t));
              else {
                var d = Y(r.done);
                for (
                  (d && d.ranges) || Pr(e.sel, r.done),
                    o = { changes: [Mr(e, t)], generation: r.generation },
                    r.done.push(o);
                  r.done.length > r.undoDepth;

                )
                  r.done.shift(), r.done[0].ranges || r.done.shift();
              }
            else {
              if (c) {
                var u = e.cm.editor.undo.lastRegisteredOperationCommand();
                (a = u && (u.undo.last() || {}).change),
                  File.isNode &&
                    File.changeCounter.withdrawAutoSaved() &&
                    (c = !1);
                var h = u && (u.redo.last() || {}).change;
                if (a && h)
                  if (
                    0 == ge(t.from, t.to) &&
                    0 == ge(t.from, a.to) &&
                    1 == a.text.length
                  ) {
                    a.to = yr(t);
                    var p = t.text[0];
                    (h.text[h.text.length - 1] =
                      h.text[h.text.length - 1] + (p || "")),
                      (h.text = h.text.concat(t.text.slice(1)));
                  } else if (
                    r.lastOp == i ||
                    (1 == a.text.length && u.undo.length < 8)
                  ) {
                    var f = Dr(e, t);
                    u.undo.push(f.undo[0]), u.redo.push(f.redo[0]);
                  } else c = !1;
                else c = !1;
              }
              if (!c && "setValue" != t.origin && e.cm.cid) {
                var m = Dr(e, t);
                if ("cut-line" == t.origin) {
                  let t = e.cm.editor.undo.lastRegisteredOperationCommand();
                  if (t && "fences-pos" == (t.undo[0] || {}).type)
                    return (
                      (t.undo = t.undo.concat(m.undo)), void (t.redo = m.redo)
                    );
                }
                e.cm.editor.undo.register(m);
              }
            }
            r.done.push(n),
              (r.generation = ++r.maxGeneration),
              (r.lastModTime = r.lastSelTime = s),
              (r.lastOp = r.lastSelOp = i),
              (r.lastOrigin = r.lastSelOrigin = t.origin),
              a || at(e, "historyAdded");
          }
        }
        function Rr(e, t, n, i) {
          var r = e.history,
            o = i && i.origin;
          n == r.lastSelOp ||
          (o &&
            r.lastSelOrigin == o &&
            ((r.lastModTime == r.lastSelTime && r.lastOrigin == o) ||
              (function (e, t, n, i) {
                var r = t.charAt(0);
                return (
                  "*" == r ||
                  ("+" == r &&
                    n.ranges.length == i.ranges.length &&
                    n.somethingSelected() == i.somethingSelected() &&
                    new Date() - e.history.lastSelTime <=
                      (e.cm ? e.cm.options.historyEventDelay : 500))
                );
              })(e, o, Y(r.done), t)))
            ? (r.done[r.done.length - 1] = t)
            : Pr(t, r.done),
            (r.lastSelTime = +new Date()),
            (r.lastSelOrigin = o),
            (r.lastSelOp = n),
            i && !1 !== i.clearRedo && Lr(r.undone);
        }
        function Pr(e, t) {
          var n = Y(t);
          (n && n.ranges && n.equals(e)) || t.push(e);
        }
        function Ir(e, t, n, i) {
          var r = t["spans_" + e.id],
            o = 0;
          e.iter(
            Math.max(e.first, n),
            Math.min(e.first + e.size, i),
            function (n) {
              n.markedSpans &&
                ((r || (r = t["spans_" + e.id] = {}))[o] = n.markedSpans),
                ++o;
            }
          );
        }
        function Or(e) {
          if (!e) return null;
          for (var t, n = 0; n < e.length; ++n)
            e[n].marker.explicitlyCleared
              ? t || (t = e.slice(0, n))
              : t && t.push(e[n]);
          return t ? (t.length ? t : null) : e;
        }
        function $r(e, t) {
          var n = (function (e, t) {
              var n = t["spans_" + e.id];
              if (!n) return null;
              for (var i = [], r = 0; r < t.text.length; ++r) i.push(Or(n[r]));
              return i;
            })(e, t),
            i = Ae(e, t);
          if (!n) return i;
          if (!i) return n;
          for (var r = 0; r < n.length; ++r) {
            var o = n[r],
              a = i[r];
            if (o && a)
              e: for (var s = 0; s < a.length; ++s) {
                for (var l = a[s], c = 0; c < o.length; ++c)
                  if (o[c].marker == l.marker) continue e;
                o.push(l);
              }
            else a && (n[r] = a);
          }
          return n;
        }
        function Hr(e, t, n) {
          for (var i = [], r = 0; r < e.length; ++r) {
            var o = e[r];
            if (o.ranges) i.push(n ? fr.prototype.deepCopy.call(o) : o);
            else {
              var a = o.changes,
                s = [];
              i.push({ changes: s });
              for (var l = 0; l < a.length; ++l) {
                var c = a[l],
                  d = void 0;
                if ((s.push({ from: c.from, to: c.to, text: c.text }), t))
                  for (var u in c)
                    (d = u.match(/^spans_(\d+)$/)) &&
                      H(t, Number(d[1])) > -1 &&
                      ((Y(s)[u] = c[u]), delete c[u]);
              }
            }
          }
          return i;
        }
        function Ur(e, t, n, i) {
          if ((e.cm && e.cm.display.shift) || e.extend) {
            var r = t.anchor;
            if (i) {
              var o = ge(n, r) < 0;
              o != ge(i, r) < 0
                ? ((r = n), (n = i))
                : o != ge(n, i) < 0 && (n = i);
            }
            return new mr(r, n);
          }
          return new mr(i || n, n);
        }
        function jr(e, t, n, i) {
          Jr(e, new fr([Ur(e, e.sel.primary(), t, n)], 0), i);
        }
        function qr(e, t, n) {
          for (var i = [], r = 0; r < e.sel.ranges.length; r++)
            i[r] = Ur(e, e.sel.ranges[r], t[r], null);
          Jr(e, gr(i, e.sel.primIndex), n);
        }
        function Wr(e, t, n, i) {
          var r = e.sel.ranges.slice(0);
          (r[t] = n), Jr(e, gr(r, e.sel.primIndex), i);
        }
        function zr(e, t, n, i) {
          Jr(e, vr(t, n), i);
        }
        function Vr(e, t, n) {
          var i = e.history.done,
            r = Y(i);
          r && r.ranges ? ((i[i.length - 1] = t), Kr(e, t, n)) : Jr(e, t, n);
        }
        function Jr(e, t, n) {
          Kr(e, t, n), Rr(e, e.sel, e.cm ? e.cm.curOp.id : NaN, n);
        }
        function Kr(e, t, n) {
          (ct(e, "beforeSelectionChange") ||
            (e.cm && ct(e.cm, "beforeSelectionChange"))) &&
            (t = (function (e, t, n) {
              var i = {
                ranges: t.ranges,
                update: function (t) {
                  this.ranges = [];
                  for (var n = 0; n < t.length; n++)
                    this.ranges[n] = new mr(
                      Ce(e, t[n].anchor),
                      Ce(e, t[n].head)
                    );
                },
                origin: n && n.origin,
              };
              return (
                at(e, "beforeSelectionChange", e, i),
                e.cm && at(e.cm, "beforeSelectionChange", e.cm, i),
                i.ranges != t.ranges ? gr(i.ranges, i.ranges.length - 1) : t
              );
            })(e, t, n)),
            Yr(
              e,
              Qr(
                e,
                t,
                (n && n.bias) ||
                  (ge(t.primary().head, e.sel.primary().head) < 0 ? -1 : 1),
                !0
              )
            ),
            (n && !1 === n.scroll) || !e.cm || Fi(e.cm);
        }
        function Yr(e, t) {
          t.equals(e.sel) ||
            ((e.sel = t),
            e.cm &&
              ((e.cm.curOp.updateInput = e.cm.curOp.selectionChanged = !0),
              lt(e.cm)),
            ln(e, "cursorActivity", e));
        }
        function Gr(e) {
          Yr(e, Qr(e, e.sel, null, !1));
        }
        function Qr(e, t, n, i) {
          for (var r, o = 0; o < t.ranges.length; o++) {
            var a = t.ranges[o],
              s = t.ranges.length == e.sel.ranges.length && e.sel.ranges[o],
              l = Zr(e, a.anchor, s && s.anchor, n, i),
              c = Zr(e, a.head, s && s.head, n, i);
            (r || l != a.anchor || c != a.head) &&
              (r || (r = t.ranges.slice(0, o)), (r[o] = new mr(l, c)));
          }
          return r ? gr(r, t.primIndex) : t;
        }
        function Xr(e, t, n, i, r) {
          var o = se(e, t.line);
          if (o.markedSpans)
            for (var a = 0; a < o.markedSpans.length; ++a) {
              var s = o.markedSpans[a],
                l = s.marker;
              if (
                (null == s.from ||
                  (l.inclusiveLeft ? s.from <= t.ch : s.from < t.ch)) &&
                (null == s.to ||
                  (l.inclusiveRight ? s.to >= t.ch : s.to > t.ch))
              ) {
                if (r && (at(l, "beforeCursorEnter"), l.explicitlyCleared)) {
                  if (o.markedSpans) {
                    --a;
                    continue;
                  }
                  break;
                }
                if (!l.atomic) continue;
                if (n) {
                  var c = l.find(i < 0 ? 1 : -1),
                    d = void 0;
                  if (
                    ((i < 0 ? l.inclusiveRight : l.inclusiveLeft) &&
                      (c = eo(e, c, -i, c && c.line == t.line ? o : null)),
                    c &&
                      c.line == t.line &&
                      (d = ge(c, n)) &&
                      (i < 0 ? d < 0 : d > 0))
                  )
                    return Xr(e, c, t, i, r);
                }
                var u = l.find(i < 0 ? -1 : 1);
                return (
                  (i < 0 ? l.inclusiveLeft : l.inclusiveRight) &&
                    (u = eo(e, u, i, u.line == t.line ? o : null)),
                  u ? Xr(e, u, t, i, r) : null
                );
              }
            }
          return t;
        }
        function Zr(e, t, n, i, r) {
          var o = i || 1,
            a =
              Xr(e, t, n, o, r) ||
              (!r && Xr(e, t, n, o, !0)) ||
              Xr(e, t, n, -o, r) ||
              (!r && Xr(e, t, n, -o, !0));
          return a || ((e.cantEdit = !0), me(e.first, 0));
        }
        function eo(e, t, n, i) {
          return n < 0 && 0 == t.ch
            ? t.line > e.first
              ? Ce(e, me(t.line - 1))
              : null
            : n > 0 && t.ch == (i || se(e, t.line)).text.length
            ? t.line < e.first + e.size - 1
              ? me(t.line + 1, 0)
              : null
            : new me(t.line, t.ch + n);
        }
        function to(e) {
          e.setSelection(me(e.firstLine(), 0), me(e.lastLine()), q);
        }
        function no(e, t, n) {
          var i = {
            canceled: !1,
            from: t.from,
            to: t.to,
            text: t.text,
            origin: t.origin,
            cancel: function () {
              return (i.canceled = !0);
            },
          };
          return (
            n &&
              (i.update = function (t, n, r, o) {
                t && (i.from = Ce(e, t)),
                  n && (i.to = Ce(e, n)),
                  r && (i.text = r),
                  void 0 !== o && (i.origin = o);
              }),
            at(e, "beforeChange", e, i),
            e.cm && at(e.cm, "beforeChange", e.cm, i),
            i.canceled
              ? null
              : { from: i.from, to: i.to, text: i.text, origin: i.origin }
          );
        }
        function io(e, t, n) {
          if (e.cm) {
            if (!e.cm.curOp) return zi(e.cm, io)(e, t, n);
            if (e.cm.state.suppressEdits) return;
          }
          if (
            !(ct(e, "beforeChange") || (e.cm && ct(e.cm, "beforeChange"))) ||
            (t = no(e, t, !0))
          ) {
            var i =
              Se &&
              !n &&
              (function (e, t, n) {
                var i = null;
                if (
                  (e.iter(t.line, n.line + 1, function (e) {
                    if (e.markedSpans)
                      for (var t = 0; t < e.markedSpans.length; ++t) {
                        var n = e.markedSpans[t].marker;
                        !n.readOnly ||
                          (i && -1 != H(i, n)) ||
                          (i || (i = [])).push(n);
                      }
                  }),
                  !i)
                )
                  return null;
                for (var r = [{ from: t, to: n }], o = 0; o < i.length; ++o)
                  for (var a = i[o], s = a.find(0), l = 0; l < r.length; ++l) {
                    var c = r[l];
                    if (!(ge(c.to, s.from) < 0 || ge(c.from, s.to) > 0)) {
                      var d = [l, 1],
                        u = ge(c.from, s.from),
                        h = ge(c.to, s.to);
                      (u < 0 || (!a.inclusiveLeft && !u)) &&
                        d.push({ from: c.from, to: s.from }),
                        (h > 0 || (!a.inclusiveRight && !h)) &&
                          d.push({ from: s.to, to: c.to }),
                        r.splice.apply(r, d),
                        (l += d.length - 3);
                    }
                  }
                return r;
              })(e, t.from, t.to);
            if (i)
              for (var r = i.length - 1; r >= 0; --r)
                ro(e, {
                  from: i[r].from,
                  to: i[r].to,
                  text: r ? [""] : t.text,
                });
            else ro(e, t);
          }
        }
        function ro(e, t) {
          if (1 != t.text.length || "" != t.text[0] || 0 != ge(t.from, t.to)) {
            var n = wr(e, t);
            Br(e, t, n, e.cm ? e.cm.curOp.id : NaN), so(e, t, n, Ae(e, t));
            var i = [];
            Er(e, function (e, n) {
              n ||
                -1 != H(i, e.history) ||
                (ho(e.history, t), i.push(e.history)),
                so(e, t, null, Ae(e, t));
            });
          }
        }
        function oo(e, t, n) {
          if (!e.cm || !e.cm.state.suppressEdits || n) {
            for (
              var i,
                r = e.history,
                o = e.sel,
                a = "undo" == t ? r.done : r.undone,
                s = "undo" == t ? r.undone : r.done,
                l = 0;
              l < a.length &&
              ((i = a[l]), n ? !i.ranges || i.equals(e.sel) : i.ranges);
              l++
            );
            if (l != a.length) {
              for (
                r.lastOrigin = r.lastSelOrigin = null;
                (i = a.pop()).ranges;

              ) {
                if ((Pr(i, s), n && !i.equals(e.sel)))
                  return void Jr(e, i, { clearRedo: !1 });
                o = i;
              }
              var c = [];
              Pr(o, s),
                s.push({ changes: c, generation: r.generation }),
                (r.generation = i.generation || ++r.maxGeneration);
              for (
                var d =
                    ct(e, "beforeChange") || (e.cm && ct(e.cm, "beforeChange")),
                  u = function (n) {
                    var r = i.changes[n];
                    if (((r.origin = t), d && !no(e, r, !1)))
                      return (a.length = 0), {};
                    c.push(Mr(e, r));
                    var o = n ? wr(e, r) : Y(a);
                    so(e, r, o, $r(e, r)),
                      !n &&
                        e.cm &&
                        e.cm.scrollIntoView({ from: r.from, to: yr(r) });
                    var s = [];
                    Er(e, function (e, t) {
                      t ||
                        -1 != H(s, e.history) ||
                        (ho(e.history, r), s.push(e.history)),
                        so(e, r, null, $r(e, r));
                    });
                  },
                  h = i.changes.length - 1;
                h >= 0;
                --h
              ) {
                var p = u(h);
                if (p) return p.v;
              }
            }
          }
        }
        function ao(e, t) {
          if (
            0 != t &&
            ((e.first += t),
            (e.sel = new fr(
              G(e.sel.ranges, function (e) {
                return new mr(
                  me(e.anchor.line + t, e.anchor.ch),
                  me(e.head.line + t, e.head.ch)
                );
              }),
              e.sel.primIndex
            )),
            e.cm)
          ) {
            Ki(e.cm, e.first, e.first - t, t);
            for (var n = e.cm.display, i = n.viewFrom; i < n.viewTo; i++)
              Yi(e.cm, i, "gutter");
          }
        }
        function so(e, t, n, i) {
          if (e.cm && !e.cm.curOp) return zi(e.cm, so)(e, t, n, i);
          if (t.to.line < e.first)
            ao(e, t.text.length - 1 - (t.to.line - t.from.line));
          else if (!(t.from.line > e.lastLine())) {
            if (t.from.line < e.first) {
              var r = t.text.length - 1 - (e.first - t.from.line);
              ao(e, r),
                (t = {
                  from: me(e.first, 0),
                  to: me(t.to.line + r, t.to.ch),
                  text: [Y(t.text)],
                  origin: t.origin,
                });
            }
            var o = e.lastLine();
            t.to.line > o &&
              (t = {
                from: t.from,
                to: me(o, se(e, o).text.length),
                text: [t.text[0]],
                origin: t.origin,
              }),
              (t.removed = le(e, t.from, t.to)),
              n || (n = wr(e, t)),
              e.cm
                ? (function (e, t, n) {
                    var i = e.doc,
                      r = e.display,
                      o = t.from,
                      a = t.to,
                      s = !1,
                      l = o.line;
                    e.options.lineWrapping ||
                      ((l = ue(He(se(i, o.line)))),
                      i.iter(l, a.line + 1, function (e) {
                        if (e == r.maxLine) return (s = !0), !0;
                      }));
                    i.sel.contains(t.from, t.to) > -1 && lt(e);
                    kr(i, t, n, ii(e)),
                      e.options.lineWrapping ||
                        (i.iter(l, o.line + t.text.length, function (e) {
                          var t = Ve(e);
                          t > r.maxLineLength &&
                            ((r.maxLine = e),
                            (r.maxLineLength = t),
                            (r.maxLineChanged = !0),
                            (s = !1));
                        }),
                        s && (e.curOp.updateMaxLine = !0));
                    (i.frontier = Math.min(i.frontier, o.line - 1)), Zi(e, 400);
                    var c = t.text.length - (a.line - o.line) - 1;
                    t.full
                      ? Ki(e)
                      : o.line != a.line || 1 != t.text.length || Sr(e.doc, t)
                      ? Ki(e, o.line, a.line + 1, c)
                      : Yi(e, o.line, "text");
                    var d = ct(e, "changes"),
                      u = ct(e, "change");
                    if (u || d) {
                      var h = {
                        from: o,
                        to: a,
                        text: t.text,
                        removed: t.removed,
                        origin: t.origin,
                      };
                      u && ln(e, "change", e, h),
                        d &&
                          (
                            e.curOp.changeObjs || (e.curOp.changeObjs = [])
                          ).push(h);
                    }
                    e.display.selForContextMenu = null;
                  })(e.cm, t, i)
                : kr(e, t, i),
              Kr(e, n, q);
          }
        }
        function lo(e, t, n, i, r) {
          if ((i || (i = n), ge(i, n) < 0)) {
            var o = i;
            (i = n), (n = o);
          }
          "string" == typeof t && (t = e.splitLines(t)),
            io(e, { from: n, to: i, text: t, origin: r });
        }
        function co(e, t, n, i) {
          n < e.line ? (e.line += i) : t < e.line && ((e.line = t), (e.ch = 0));
        }
        function uo(e, t, n, i) {
          for (var r = 0; r < e.length; ++r) {
            var o = e[r],
              a = !0;
            if (o.ranges) {
              o.copied || ((o = e[r] = o.deepCopy()).copied = !0);
              for (var s = 0; s < o.ranges.length; s++)
                co(o.ranges[s].anchor, t, n, i), co(o.ranges[s].head, t, n, i);
            } else {
              for (var l = 0; l < o.changes.length; ++l) {
                var c = o.changes[l];
                if (n < c.from.line)
                  (c.from = me(c.from.line + i, c.from.ch)),
                    (c.to = me(c.to.line + i, c.to.ch));
                else if (t <= c.to.line) {
                  a = !1;
                  break;
                }
              }
              a || (e.splice(0, r + 1), (r = 0));
            }
          }
        }
        function ho(e, t) {
          var n = t.from.line,
            i = t.to.line,
            r = t.text.length - (i - n) - 1;
          uo(e.done, n, i, r), uo(e.undone, n, i, r);
        }
        function po(e, t, n, i) {
          var r = t,
            o = t;
          return (
            "number" == typeof t ? (o = se(e, xe(e, t))) : (r = ue(t)),
            null == r ? null : (i(o, r) && e.cm && Yi(e.cm, r, n), o)
          );
        }
        (mr.prototype.from = function () {
          return we(this.anchor, this.head);
        }),
          (mr.prototype.to = function () {
            return be(this.anchor, this.head);
          }),
          (mr.prototype.empty = function () {
            return (
              this.head.line == this.anchor.line &&
              this.head.ch == this.anchor.ch
            );
          });
        var fo = function (e) {
          (this.lines = e), (this.parent = null);
          for (var t = 0, n = 0; n < e.length; ++n)
            (e[n].parent = this), (t += e[n].height);
          this.height = t;
        };
        (fo.prototype.chunkSize = function () {
          return this.lines.length;
        }),
          (fo.prototype.removeInner = function (e, t) {
            for (var n = e, i = e + t; n < i; ++n) {
              var r = this.lines[n];
              (this.height -= r.height), Jt(r), ln(r, "delete");
            }
            this.lines.splice(e, t);
          }),
          (fo.prototype.collapse = function (e) {
            e.push.apply(e, this.lines);
          }),
          (fo.prototype.insertInner = function (e, t, n) {
            (this.height += n),
              (this.lines = this.lines
                .slice(0, e)
                .concat(t)
                .concat(this.lines.slice(e)));
            for (var i = 0; i < t.length; ++i) t[i].parent = this;
          }),
          (fo.prototype.iterN = function (e, t, n) {
            for (var i = e + t; e < i; ++e) if (n(this.lines[e])) return !0;
          });
        var mo = function (e) {
          this.children = e;
          for (var t = 0, n = 0, i = 0; i < e.length; ++i) {
            var r = e[i];
            (t += r.chunkSize()), (n += r.height), (r.parent = this);
          }
          (this.size = t), (this.height = n), (this.parent = null);
        };
        (mo.prototype.chunkSize = function () {
          return this.size;
        }),
          (mo.prototype.removeInner = function (e, t) {
            this.size -= t;
            for (var n = 0; n < this.children.length; ++n) {
              var i = this.children[n],
                r = i.chunkSize();
              if (e < r) {
                var o = Math.min(t, r - e),
                  a = i.height;
                if (
                  (i.removeInner(e, o),
                  (this.height -= a - i.height),
                  r == o && (this.children.splice(n--, 1), (i.parent = null)),
                  0 == (t -= o))
                )
                  break;
                e = 0;
              } else e -= r;
            }
            if (
              this.size - t < 25 &&
              (this.children.length > 1 || !(this.children[0] instanceof fo))
            ) {
              var s = [];
              this.collapse(s),
                (this.children = [new fo(s)]),
                (this.children[0].parent = this);
            }
          }),
          (mo.prototype.collapse = function (e) {
            for (var t = 0; t < this.children.length; ++t)
              this.children[t].collapse(e);
          }),
          (mo.prototype.insertInner = function (e, t, n) {
            (this.size += t.length), (this.height += n);
            for (var i = 0; i < this.children.length; ++i) {
              var r = this.children[i],
                o = r.chunkSize();
              if (e <= o) {
                if ((r.insertInner(e, t, n), r.lines && r.lines.length > 50)) {
                  for (
                    var a = (r.lines.length % 25) + 25, s = a;
                    s < r.lines.length;

                  ) {
                    var l = new fo(r.lines.slice(s, (s += 25)));
                    (r.height -= l.height),
                      this.children.splice(++i, 0, l),
                      (l.parent = this);
                  }
                  (r.lines = r.lines.slice(0, a)), this.maybeSpill();
                }
                break;
              }
              e -= o;
            }
          }),
          (mo.prototype.maybeSpill = function () {
            if (!(this.children.length <= 10)) {
              var e = this;
              do {
                var t = e.children.splice(e.children.length - 5, 5),
                  n = new mo(t);
                if (e.parent) {
                  (e.size -= n.size), (e.height -= n.height);
                  var i = H(e.parent.children, e);
                  e.parent.children.splice(i + 1, 0, n);
                } else {
                  var r = new mo(e.children);
                  (r.parent = e), (e.children = [r, n]), (e = r);
                }
                n.parent = e.parent;
              } while (e.children.length > 10);
              e.parent.maybeSpill();
            }
          }),
          (mo.prototype.iterN = function (e, t, n) {
            for (var i = 0; i < this.children.length; ++i) {
              var r = this.children[i],
                o = r.chunkSize();
              if (e < o) {
                var a = Math.min(t, o - e);
                if (r.iterN(e, a, n)) return !0;
                if (0 == (t -= a)) break;
                e = 0;
              } else e -= o;
            }
          });
        var go = function (e, t, n) {
          if (n) for (var i in n) n.hasOwnProperty(i) && (this[i] = n[i]);
          (this.doc = e), (this.node = t);
        };
        function vo(e, t, n) {
          ze(t) < ((e.curOp && e.curOp.scrollTop) || e.doc.scrollTop) &&
            Ci(e, n);
        }
        (go.prototype.clear = function () {
          var e = this.doc.cm,
            t = this.line.widgets,
            n = this.line,
            i = ue(n);
          if (null != i && t) {
            for (var r = 0; r < t.length; ++r) t[r] == this && t.splice(r--, 1);
            t.length || (n.widgets = null);
            var o = xn(this);
            de(n, Math.max(0, n.height - o)),
              e &&
                (Wi(e, function () {
                  vo(e, n, -o), Yi(e, i, "widget");
                }),
                ln(e, "lineWidgetCleared", e, this, i));
          }
        }),
          (go.prototype.changed = function () {
            var e = this,
              t = this.height,
              n = this.doc.cm,
              i = this.line;
            this.height = null;
            var r = xn(this) - t;
            r &&
              (de(i, i.height + r),
              n &&
                Wi(n, function () {
                  (n.curOp.forceUpdate = !0),
                    vo(n, i, r),
                    ln(n, "lineWidgetChanged", n, e, ue(i));
                }));
          }),
          dt(go);
        var yo = 0,
          bo = function (e, t) {
            (this.lines = []),
              (this.type = t),
              (this.doc = e),
              (this.id = ++yo);
          };
        function wo(e, t, n, i, r) {
          if (i && i.shared)
            return (function (e, t, n, i, r) {
              (i = I(i)).shared = !1;
              var o = [wo(e, t, n, i, r)],
                a = o[0],
                s = i.widgetNode;
              return (
                Er(e, function (e) {
                  s && (i.widgetNode = s.cloneNode(!0)),
                    o.push(wo(e, Ce(e, t), Ce(e, n), i, r));
                  for (var l = 0; l < e.linked.length; ++l)
                    if (e.linked[l].isParent) return;
                  a = Y(o);
                }),
                new xo(o, a)
              );
            })(e, t, n, i, r);
          if (e.cm && !e.cm.curOp) return zi(e.cm, wo)(e, t, n, i, r);
          var o = new bo(e, r),
            a = ge(t, n);
          if ((i && I(i, o, !1), a > 0 || (0 == a && !1 !== o.clearWhenEmpty)))
            return o;
          if (
            (o.replacedWith &&
              ((o.collapsed = !0),
              (o.widgetNode = M("span", [o.replacedWith], "CodeMirror-widget")),
              i.handleMouseEvents ||
                o.widgetNode.setAttribute("cm-ignore-events", "true"),
              i.insertLeft && (o.widgetNode.insertLeft = !0)),
            o.collapsed)
          ) {
            if (
              $e(e, t.line, t, n, o) ||
              (t.line != n.line && $e(e, n.line, t, n, o))
            )
              throw new Error(
                "Inserting collapsed marker partially overlapping an existing one"
              );
            ke = !0;
          }
          o.addToHistory &&
            Br(e, { from: t, to: n, origin: "markText" }, e.sel, NaN);
          var s,
            l = t.line,
            c = e.cm;
          if (
            (e.iter(l, n.line + 1, function (e) {
              c &&
                o.collapsed &&
                !c.options.lineWrapping &&
                He(e) == c.display.maxLine &&
                (s = !0),
                o.collapsed && l != t.line && de(e, 0),
                (function (e, t) {
                  (e.markedSpans = e.markedSpans
                    ? e.markedSpans.concat([t])
                    : [t]),
                    t.marker.attachLine(e);
                })(
                  e,
                  new Ee(
                    o,
                    l == t.line ? t.ch : null,
                    l == n.line ? n.ch : null
                  )
                ),
                ++l;
            }),
            o.collapsed &&
              e.iter(t.line, n.line + 1, function (t) {
                qe(e, t) && de(t, 0);
              }),
            o.clearOnEnter &&
              it(o, "beforeCursorEnter", function () {
                return o.clear();
              }),
            o.readOnly &&
              ((Se = !0),
              (e.history.done.length || e.history.undone.length) &&
                e.clearHistory()),
            o.collapsed && ((o.id = ++yo), (o.atomic = !0)),
            c)
          ) {
            if ((s && (c.curOp.updateMaxLine = !0), o.collapsed))
              Ki(c, t.line, n.line + 1);
            else if (
              o.className ||
              o.title ||
              o.startStyle ||
              o.endStyle ||
              o.css
            )
              for (var d = t.line; d <= n.line; d++) Yi(c, d, "text");
            o.atomic && Gr(c.doc), ln(c, "markerAdded", c, o);
          }
          return o;
        }
        (bo.prototype.clear = function () {
          if (!this.explicitlyCleared) {
            var e = this.doc.cm,
              t = e && !e.curOp;
            if ((t && Oi(e), ct(this, "clear"))) {
              var n = this.find();
              n && ln(this, "clear", n.from, n.to);
            }
            for (var i = null, r = null, o = 0; o < this.lines.length; ++o) {
              var a = this.lines[o],
                s = Te(a.markedSpans, this);
              e && !this.collapsed
                ? Yi(e, ue(a), "text")
                : e &&
                  (null != s.to && (r = ue(a)), null != s.from && (i = ue(a))),
                (a.markedSpans = _e(a.markedSpans, s)),
                null == s.from &&
                  this.collapsed &&
                  !qe(this.doc, a) &&
                  e &&
                  de(a, Zn(e.display));
            }
            if (e && this.collapsed && !e.options.lineWrapping)
              for (var l = 0; l < this.lines.length; ++l) {
                var c = He(this.lines[l]),
                  d = Ve(c);
                d > e.display.maxLineLength &&
                  ((e.display.maxLine = c),
                  (e.display.maxLineLength = d),
                  (e.display.maxLineChanged = !0));
              }
            null != i && e && this.collapsed && Ki(e, i, r + 1),
              (this.lines.length = 0),
              (this.explicitlyCleared = !0),
              this.atomic &&
                this.doc.cantEdit &&
                ((this.doc.cantEdit = !1), e && Gr(e.doc)),
              e && ln(e, "markerCleared", e, this, i, r),
              t && $i(e),
              this.parent && this.parent.clear();
          }
        }),
          (bo.prototype.find = function (e, t) {
            var n, i;
            null == e && "bookmark" == this.type && (e = 1);
            for (var r = 0; r < this.lines.length; ++r) {
              var o = this.lines[r],
                a = Te(o.markedSpans, this);
              if (null != a.from && ((n = me(t ? o : ue(o), a.from)), -1 == e))
                return n;
              if (null != a.to && ((i = me(t ? o : ue(o), a.to)), 1 == e))
                return i;
            }
            return n && { from: n, to: i };
          }),
          (bo.prototype.changed = function () {
            var e = this,
              t = this.find(-1, !0),
              n = this,
              i = this.doc.cm;
            t &&
              i &&
              Wi(i, function () {
                var r = t.line,
                  o = ue(t.line),
                  a = Ln(i, o);
                if (
                  (a &&
                    (On(a),
                    (i.curOp.selectionChanged = i.curOp.forceUpdate = !0)),
                  (i.curOp.updateMaxLine = !0),
                  !qe(n.doc, r) && null != n.height)
                ) {
                  var s = n.height;
                  n.height = null;
                  var l = xn(n) - s;
                  l && de(r, r.height + l);
                }
                ln(i, "markerChanged", i, e);
              });
          }),
          (bo.prototype.attachLine = function (e) {
            if (!this.lines.length && this.doc.cm) {
              var t = this.doc.cm.curOp;
              (t.maybeHiddenMarkers && -1 != H(t.maybeHiddenMarkers, this)) ||
                (t.maybeUnhiddenMarkers || (t.maybeUnhiddenMarkers = [])).push(
                  this
                );
            }
            this.lines.push(e);
          }),
          (bo.prototype.detachLine = function (e) {
            if (
              (this.lines.splice(H(this.lines, e), 1),
              !this.lines.length && this.doc.cm)
            ) {
              var t = this.doc.cm.curOp;
              (t.maybeHiddenMarkers || (t.maybeHiddenMarkers = [])).push(this);
            }
          }),
          dt(bo);
        var xo = function (e, t) {
          (this.markers = e), (this.primary = t);
          for (var n = 0; n < e.length; ++n) e[n].parent = this;
        };
        function Co(e) {
          return e.findMarks(
            me(e.first, 0),
            e.clipPos(me(e.lastLine())),
            function (e) {
              return e.parent;
            }
          );
        }
        function Fo(e) {
          for (
            var t = function (t) {
                var n = e[t],
                  i = [n.primary.doc];
                Er(n.primary.doc, function (e) {
                  return i.push(e);
                });
                for (var r = 0; r < n.markers.length; r++) {
                  var o = n.markers[r];
                  -1 == H(i, o.doc) &&
                    ((o.parent = null), n.markers.splice(r--, 1));
                }
              },
              n = 0;
            n < e.length;
            n++
          )
            t(n);
        }
        (xo.prototype.clear = function () {
          if (!this.explicitlyCleared) {
            this.explicitlyCleared = !0;
            for (var e = 0; e < this.markers.length; ++e)
              this.markers[e].clear();
            ln(this, "clear");
          }
        }),
          (xo.prototype.find = function (e, t) {
            return this.primary.find(e, t);
          }),
          dt(xo);
        var So = 0,
          ko = function (e, t, n, i, r) {
            if (!(this instanceof ko)) return new ko(e, t, n, i, r);
            null == n && (n = 0),
              mo.call(this, [new fo([new Vt("", null)])]),
              (this.first = n),
              (this.scrollTop = this.scrollLeft = 0),
              (this.cantEdit = !1),
              (this.cleanGeneration = 1),
              (this.frontier = n);
            var o = me(n, 0);
            (this.sel = vr(o)),
              (this.history = new Ar(null)),
              (this.id = ++So),
              (this.modeOption = t),
              (this.lineSep = i),
              (this.direction = "rtl" == r ? "rtl" : "ltr"),
              (this.extend = !1),
              "string" == typeof e && (e = this.splitLines(e)),
              kr(this, { from: o, to: o, text: e }),
              Jr(this, vr(o), q);
          };
        (ko.prototype = X(mo.prototype, {
          constructor: ko,
          iter: function (e, t, n) {
            n
              ? this.iterN(e - this.first, t - e, n)
              : this.iterN(this.first, this.first + this.size, e);
          },
          insert: function (e, t) {
            for (var n = 0, i = 0; i < t.length; ++i) n += t[i].height;
            this.insertInner(e - this.first, t, n);
          },
          remove: function (e, t) {
            this.removeInner(e - this.first, t);
          },
          getValue: function (e) {
            var t = ce(this, this.first, this.first + this.size);
            return !1 === e ? t : t.join(e || this.lineSeparator());
          },
          setValue: Ji(function (e, t) {
            var n = me(this.first, 0),
              i = this.first + this.size - 1;
            io(
              this,
              {
                from: n,
                to: me(i, se(this, i).text.length),
                text: this.splitLines(e),
                origin: t || "setValue",
                full: !0,
              },
              !0
            ),
              this.cm && Si(this.cm, 0, 0),
              Jr(this, vr(n), q);
          }),
          replaceRange: function (e, t, n, i) {
            lo(this, e, (t = Ce(this, t)), (n = n ? Ce(this, n) : t), i);
          },
          getRange: function (e, t, n) {
            var i = le(this, Ce(this, e), Ce(this, t));
            return !1 === n ? i : i.join(n || this.lineSeparator());
          },
          getLine: function (e) {
            var t = this.getLineHandle(e);
            return t && t.text;
          },
          getLineHandle: function (e) {
            if (pe(this, e)) return se(this, e);
          },
          getLineNumber: function (e) {
            return ue(e);
          },
          getLineHandleVisualStart: function (e) {
            return "number" == typeof e && (e = se(this, e)), He(e);
          },
          lineCount: function () {
            return this.size;
          },
          firstLine: function () {
            return this.first;
          },
          lastLine: function () {
            return this.first + this.size - 1;
          },
          clipPos: function (e) {
            return Ce(this, e);
          },
          getCursor: function (e) {
            var t = this.sel.primary();
            return null == e || "head" == e
              ? t.head
              : "anchor" == e
              ? t.anchor
              : "end" == e || "to" == e || !1 === e
              ? t.to()
              : t.from();
          },
          listSelections: function () {
            return this.sel.ranges;
          },
          somethingSelected: function () {
            return this.sel.somethingSelected();
          },
          setCursor: Ji(function (e, t, n) {
            zr(
              this,
              Ce(this, "number" == typeof e ? me(e, t || 0) : e),
              null,
              n
            );
          }),
          setSelection: Ji(function (e, t, n) {
            zr(this, Ce(this, e), Ce(this, t || e), n);
          }),
          extendSelection: Ji(function (e, t, n) {
            jr(this, Ce(this, e), t && Ce(this, t), n);
          }),
          extendSelections: Ji(function (e, t) {
            qr(this, Fe(this, e), t);
          }),
          extendSelectionsBy: Ji(function (e, t) {
            qr(this, Fe(this, G(this.sel.ranges, e)), t);
          }),
          setSelections: Ji(function (e, t, n) {
            if (e.length) {
              for (var i = [], r = 0; r < e.length; r++)
                i[r] = new mr(Ce(this, e[r].anchor), Ce(this, e[r].head));
              null == t && (t = Math.min(e.length - 1, this.sel.primIndex)),
                Jr(this, gr(i, t), n);
            }
          }),
          addSelection: Ji(function (e, t, n) {
            var i = this.sel.ranges.slice(0);
            i.push(new mr(Ce(this, e), Ce(this, t || e))),
              Jr(this, gr(i, i.length - 1), n);
          }),
          getSelection: function (e) {
            for (var t, n = this.sel.ranges, i = 0; i < n.length; i++) {
              var r = le(this, n[i].from(), n[i].to());
              t = t ? t.concat(r) : r;
            }
            return !1 === e ? t : t.join(e || this.lineSeparator());
          },
          getSelections: function (e) {
            for (var t = [], n = this.sel.ranges, i = 0; i < n.length; i++) {
              var r = le(this, n[i].from(), n[i].to());
              !1 !== e && (r = r.join(e || this.lineSeparator())), (t[i] = r);
            }
            return t;
          },
          replaceSelection: function (e, t, n) {
            for (var i = [], r = 0; r < this.sel.ranges.length; r++) i[r] = e;
            this.replaceSelections(i, t, n || "+input");
          },
          replaceSelections: Ji(function (e, t, n) {
            for (var i = [], r = this.sel, o = 0; o < r.ranges.length; o++) {
              var a = r.ranges[o];
              i[o] = {
                from: a.from(),
                to: a.to(),
                text: this.splitLines(e[o]),
                origin: n,
              };
            }
            for (
              var s =
                  t &&
                  "end" != t &&
                  (function (e, t, n) {
                    for (
                      var i = [], r = me(e.first, 0), o = r, a = 0;
                      a < t.length;
                      a++
                    ) {
                      var s = t[a],
                        l = xr(s.from, r, o),
                        c = xr(yr(s), r, o);
                      if (((r = s.to), (o = c), "around" == n)) {
                        var d = e.sel.ranges[a],
                          u = ge(d.head, d.anchor) < 0;
                        i[a] = new mr(u ? c : l, u ? l : c);
                      } else i[a] = new mr(l, l);
                    }
                    return new fr(i, e.sel.primIndex);
                  })(this, i, t),
                l = i.length - 1;
              l >= 0;
              l--
            )
              io(this, i[l]);
            s ? Vr(this, s) : this.cm && Fi(this.cm);
          }),
          makeChange: Ji(function (e) {
            io(this, e);
          }),
          undo: Ji(function () {
            oo(this, "undo");
          }),
          redo: Ji(function () {
            oo(this, "redo");
          }),
          undoSelection: Ji(function () {
            oo(this, "undo", !0);
          }),
          redoSelection: Ji(function () {
            oo(this, "redo", !0);
          }),
          setExtending: function (e) {
            this.extend = e;
          },
          getExtending: function () {
            return this.extend;
          },
          historySize: function () {
            for (
              var e = this.history, t = 0, n = 0, i = 0;
              i < e.done.length;
              i++
            )
              e.done[i].ranges || ++t;
            for (var r = 0; r < e.undone.length; r++) e.undone[r].ranges || ++n;
            return { undo: t, redo: n };
          },
          clearHistory: function () {
            this.history = new Ar(this.history.maxGeneration);
          },
          markClean: function () {
            this.cleanGeneration = this.changeGeneration(!0);
          },
          changeGeneration: function (e) {
            return (
              e &&
                (this.history.lastOp =
                  this.history.lastSelOp =
                  this.history.lastOrigin =
                    null),
              this.history.generation
            );
          },
          isClean: function (e) {
            return this.history.generation == (e || this.cleanGeneration);
          },
          getHistory: function () {
            return {
              done: Hr(this.history.done),
              undone: Hr(this.history.undone),
            };
          },
          setHistory: function (e) {
            var t = (this.history = new Ar(this.history.maxGeneration));
            (t.done = Hr(e.done.slice(0), null, !0)),
              (t.undone = Hr(e.undone.slice(0), null, !0));
          },
          setGutterMarker: Ji(function (e, t, n) {
            return po(this, e, "gutter", function (e) {
              var i = e.gutterMarkers || (e.gutterMarkers = {});
              return (i[t] = n), !n && ne(i) && (e.gutterMarkers = null), !0;
            });
          }),
          clearGutter: Ji(function (e) {
            var t = this;
            this.iter(function (n) {
              n.gutterMarkers &&
                n.gutterMarkers[e] &&
                po(t, n, "gutter", function () {
                  return (
                    (n.gutterMarkers[e] = null),
                    ne(n.gutterMarkers) && (n.gutterMarkers = null),
                    !0
                  );
                });
            });
          }),
          lineInfo: function (e) {
            var t;
            if ("number" == typeof e) {
              if (!pe(this, e)) return null;
              if (((t = e), !(e = se(this, e)))) return null;
            } else if (null == (t = ue(e))) return null;
            return {
              line: t,
              handle: e,
              text: e.text,
              gutterMarkers: e.gutterMarkers,
              textClass: e.textClass,
              bgClass: e.bgClass,
              wrapClass: e.wrapClass,
              widgets: e.widgets,
            };
          },
          addLineClass: Ji(function (e, t, n) {
            return po(
              this,
              e,
              "gutter" == t ? "gutter" : "class",
              function (e) {
                var i =
                  "text" == t
                    ? "textClass"
                    : "background" == t
                    ? "bgClass"
                    : "gutter" == t
                    ? "gutterClass"
                    : "wrapClass";
                if (e[i]) {
                  if (S(n).test(e[i])) return !1;
                  e[i] += " " + n;
                } else e[i] = n;
                return !0;
              }
            );
          }),
          removeLineClass: Ji(function (e, t, n) {
            return po(
              this,
              e,
              "gutter" == t ? "gutter" : "class",
              function (e) {
                var i =
                    "text" == t
                      ? "textClass"
                      : "background" == t
                      ? "bgClass"
                      : "gutter" == t
                      ? "gutterClass"
                      : "wrapClass",
                  r = e[i];
                if (!r) return !1;
                if (null == n) e[i] = null;
                else {
                  var o = r.match(S(n));
                  if (!o) return !1;
                  var a = o.index + o[0].length;
                  e[i] =
                    r.slice(0, o.index) +
                      (o.index && a != r.length ? " " : "") +
                      r.slice(a) || null;
                }
                return !0;
              }
            );
          }),
          addLineWidget: Ji(function (e, t, n) {
            return (function (e, t, n, i) {
              var r = new go(e, n, i),
                o = e.cm;
              return (
                o && r.noHScroll && (o.display.alignWidgets = !0),
                po(e, t, "widget", function (t) {
                  var n = t.widgets || (t.widgets = []);
                  if (
                    (null == r.insertAt
                      ? n.push(r)
                      : n.splice(
                          Math.min(n.length - 1, Math.max(0, r.insertAt)),
                          0,
                          r
                        ),
                    (r.line = t),
                    o && !qe(e, t))
                  ) {
                    var i = ze(t) < e.scrollTop;
                    de(t, t.height + xn(r)),
                      i && Ci(o, r.height),
                      (o.curOp.forceUpdate = !0);
                  }
                  return !0;
                }),
                ln(
                  o,
                  "lineWidgetAdded",
                  o,
                  r,
                  "number" == typeof t ? t : ue(t)
                ),
                r
              );
            })(this, e, t, n);
          }),
          removeLineWidget: function (e) {
            e.clear();
          },
          markText: function (e, t, n) {
            return wo(
              this,
              Ce(this, e),
              Ce(this, t),
              n,
              (n && n.type) || "range"
            );
          },
          setBookmark: function (e, t) {
            var n = {
              replacedWith: t && (null == t.nodeType ? t.widget : t),
              insertLeft: t && t.insertLeft,
              clearWhenEmpty: !1,
              shared: t && t.shared,
              handleMouseEvents: t && t.handleMouseEvents,
            };
            return wo(this, (e = Ce(this, e)), e, n, "bookmark");
          },
          findMarksAt: function (e) {
            var t = [],
              n = se(this, (e = Ce(this, e)).line).markedSpans;
            if (n)
              for (var i = 0; i < n.length; ++i) {
                var r = n[i];
                (null == r.from || r.from <= e.ch) &&
                  (null == r.to || r.to >= e.ch) &&
                  t.push(r.marker.parent || r.marker);
              }
            return t;
          },
          findMarks: function (e, t, n) {
            (e = Ce(this, e)), (t = Ce(this, t));
            var i = [],
              r = e.line;
            return (
              this.iter(e.line, t.line + 1, function (o) {
                var a = o.markedSpans;
                if (a)
                  for (var s = 0; s < a.length; s++) {
                    var l = a[s];
                    (null != l.to && r == e.line && e.ch >= l.to) ||
                      (null == l.from && r != e.line) ||
                      (null != l.from && r == t.line && l.from >= t.ch) ||
                      (n && !n(l.marker)) ||
                      i.push(l.marker.parent || l.marker);
                  }
                ++r;
              }),
              i
            );
          },
          getAllMarks: function () {
            var e = [];
            return (
              this.iter(function (t) {
                var n = t.markedSpans;
                if (n)
                  for (var i = 0; i < n.length; ++i)
                    null != n[i].from && e.push(n[i].marker);
              }),
              e
            );
          },
          posFromIndex: function (e) {
            var t,
              n = this.first,
              i = this.lineSeparator().length;
            return (
              this.iter(function (r) {
                var o = r.text.length + i;
                if (o > e) return (t = e), !0;
                (e -= o), ++n;
              }),
              Ce(this, me(n, t))
            );
          },
          indexFromPos: function (e) {
            var t = (e = Ce(this, e)).ch;
            if (e.line < this.first || e.ch < 0) return 0;
            var n = this.lineSeparator().length;
            return (
              this.iter(this.first, e.line, function (e) {
                t += e.text.length + n;
              }),
              t
            );
          },
          copy: function (e) {
            var t = new ko(
              ce(this, this.first, this.first + this.size),
              this.modeOption,
              this.first,
              this.lineSep,
              this.direction
            );
            return (
              (t.scrollTop = this.scrollTop),
              (t.scrollLeft = this.scrollLeft),
              (t.sel = this.sel),
              (t.extend = !1),
              e &&
                ((t.history.undoDepth = this.history.undoDepth),
                t.setHistory(this.getHistory())),
              t
            );
          },
          linkedDoc: function (e) {
            e || (e = {});
            var t = this.first,
              n = this.first + this.size;
            null != e.from && e.from > t && (t = e.from),
              null != e.to && e.to < n && (n = e.to);
            var i = new ko(
              ce(this, t, n),
              e.mode || this.modeOption,
              t,
              this.lineSep,
              this.direction
            );
            return (
              e.sharedHist && (i.history = this.history),
              (this.linked || (this.linked = [])).push({
                doc: i,
                sharedHist: e.sharedHist,
              }),
              (i.linked = [
                { doc: this, isParent: !0, sharedHist: e.sharedHist },
              ]),
              (function (e, t) {
                for (var n = 0; n < t.length; n++) {
                  var i = t[n],
                    r = i.find(),
                    o = e.clipPos(r.from),
                    a = e.clipPos(r.to);
                  if (ge(o, a)) {
                    var s = wo(e, o, a, i.primary, i.primary.type);
                    i.markers.push(s), (s.parent = i);
                  }
                }
              })(i, Co(this)),
              i
            );
          },
          unlinkDoc: function (e) {
            if ((e instanceof ma && (e = e.doc), this.linked))
              for (var t = 0; t < this.linked.length; ++t) {
                if (this.linked[t].doc == e) {
                  this.linked.splice(t, 1), e.unlinkDoc(this), Fo(Co(this));
                  break;
                }
              }
            if (e.history == this.history) {
              var n = [e.id];
              Er(
                e,
                function (e) {
                  return n.push(e.id);
                },
                !0
              ),
                (e.history = new Ar(null)),
                (e.history.done = Hr(this.history.done, n)),
                (e.history.undone = Hr(this.history.undone, n));
            }
          },
          iterLinkedDocs: function (e) {
            Er(this, e);
          },
          getMode: function () {
            return this.mode;
          },
          getEditor: function () {
            return this.cm;
          },
          splitLines: function (e) {
            return this.lineSep ? e.split(this.lineSep) : Ft(e);
          },
          lineSeparator: function () {
            return File.useCRLF ? "\r\n" : "\n";
          },
          setDirection: Ji(function (e) {
            var t;
            ("rtl" != e && (e = "ltr"), e != this.direction) &&
              ((this.direction = e),
              this.iter(function (e) {
                return (e.order = null);
              }),
              this.cm &&
                Wi((t = this.cm), function () {
                  _r(t), Ki(t);
                }));
          }),
        })),
          (ko.prototype.eachLine = ko.prototype.iter);
        var Eo = 0;
        function To(e) {
          var t = this;
          if ((_o(t), !st(t, e) && !Cn(t.display, e))) {
            ut(e), a && (Eo = +new Date());
            var n = oi(t, e, !0),
              i = e.dataTransfer.files;
            if (n && !t.isReadOnly())
              if (i && i.length && window.FileReader && window.File)
                for (
                  var r = i.length,
                    o = Array(r),
                    s = 0,
                    l = function (e, i) {
                      if (
                        !t.options.allowDropFileTypes ||
                        -1 != H(t.options.allowDropFileTypes, e.type)
                      ) {
                        var a = new FileReader();
                        (a.onload = zi(t, function () {
                          var e = a.result;
                          if (
                            (/[\x00-\x08\x0e-\x1f]{2}/.test(e) && (e = ""),
                            (o[i] = e),
                            ++s == r)
                          ) {
                            var l = {
                              from: (n = Ce(t.doc, n)),
                              to: n,
                              text: t.doc.splitLines(
                                o.join(t.doc.lineSeparator())
                              ),
                              origin: "paste",
                            };
                            io(t.doc, l), Vr(t.doc, vr(n, yr(l)));
                          }
                        })),
                          a.readAsText(e);
                      }
                    },
                    c = 0;
                  c < r;
                  ++c
                )
                  l(i[c], c);
              else {
                if (t.state.draggingText && t.doc.sel.contains(n) > -1)
                  return (
                    t.state.draggingText(e),
                    void setTimeout(function () {
                      return t.display.input.focus();
                    }, 20)
                  );
                try {
                  var d = e.dataTransfer.getData("Text");
                  if (d) {
                    var u;
                    if (
                      (t.state.draggingText &&
                        !t.state.draggingText.copy &&
                        (u = t.listSelections()),
                      Kr(t.doc, vr(n, n)),
                      u)
                    )
                      for (var h = 0; h < u.length; ++h)
                        lo(t.doc, "", u[h].anchor, u[h].head, "drag");
                    t.replaceSelection(d, "around", "paste"),
                      t.display.input.focus();
                  }
                } catch (e) {}
              }
          }
        }
        function _o(e) {
          e.display.dragCursor &&
            (e.display.lineSpace.removeChild(e.display.dragCursor),
            (e.display.dragCursor = null));
        }
        function Ao(e) {
          if (document.body.getElementsByClassName)
            for (
              var t = document.body.getElementsByClassName("CodeMirror"), n = 0;
              n < t.length;
              n++
            ) {
              var i = t[n].CodeMirror;
              i && e(i);
            }
        }
        var Mo = !1;
        function Lo() {
          var e;
          Mo ||
            (it(window, "resize", function () {
              null == e &&
                (e = setTimeout(function () {
                  (e = null), Ao(No);
                }, 500));
            }),
            it(window, "blur", function () {
              return Ao(mi);
            }),
            (Mo = !0));
        }
        function No(e) {
          var t = e.display;
          (t.lastWrapHeight == t.wrapper.clientHeight &&
            t.lastWrapWidth == t.wrapper.clientWidth) ||
            ((t.cachedCharWidth = t.cachedTextHeight = t.cachedPaddingH = null),
            (t.scrollbarsClipped = !1),
            e.setSize());
        }
        for (
          var Do = {
              3: "Enter",
              8: "Backspace",
              9: "Tab",
              13: "Enter",
              16: "Shift",
              17: "Ctrl",
              18: "Alt",
              19: "Pause",
              20: "CapsLock",
              27: "Esc",
              32: "Space",
              33: "PageUp",
              34: "PageDown",
              35: "End",
              36: "Home",
              37: "Left",
              38: "Up",
              39: "Right",
              40: "Down",
              44: "PrintScrn",
              45: "Insert",
              46: "Delete",
              59: ";",
              61: "=",
              91: "Mod",
              92: "Mod",
              93: "Mod",
              106: "*",
              107: "=",
              109: "-",
              110: ".",
              111: "/",
              127: "Delete",
              173: "-",
              186: ";",
              187: "=",
              188: ",",
              189: "-",
              190: ".",
              191: "/",
              192: "`",
              219: "[",
              220: "\\",
              221: "]",
              222: "'",
              63232: "Up",
              63233: "Down",
              63234: "Left",
              63235: "Right",
              63272: "Delete",
              63273: "Home",
              63275: "End",
              63276: "PageUp",
              63277: "PageDown",
              63302: "Insert",
            },
            Bo = 0;
          Bo < 10;
          Bo++
        )
          Do[Bo + 48] = Do[Bo + 96] = String(Bo);
        for (var Ro = 65; Ro <= 90; Ro++) Do[Ro] = String.fromCharCode(Ro);
        for (var Po = 1; Po <= 12; Po++)
          Do[Po + 111] = Do[Po + 63235] = "F" + Po;
        var Io = {};
        function Oo(e) {
          var t,
            n,
            i,
            r,
            o = e.split(/-(?!$)/);
          e = o[o.length - 1];
          for (var a = 0; a < o.length - 1; a++) {
            var s = o[a];
            if (/^(cmd|meta|m)$/i.test(s)) r = !0;
            else if (/^a(lt)?$/i.test(s)) t = !0;
            else if (/^(c|ctrl|control)$/i.test(s)) n = !0;
            else {
              if (!/^s(hift)?$/i.test(s))
                throw new Error("Unrecognized modifier name: " + s);
              i = !0;
            }
          }
          return (
            t && (e = "Alt-" + e),
            n && (e = "Ctrl-" + e),
            r && (e = "Cmd-" + e),
            i && (e = "Shift-" + e),
            e
          );
        }
        function $o(e) {
          var t = {};
          for (var n in e)
            if (e.hasOwnProperty(n)) {
              var i = e[n];
              if (/^(name|fallthrough|(de|at)tach)$/.test(n)) continue;
              if ("..." == i) {
                delete e[n];
                continue;
              }
              for (var r = G(n.split(" "), Oo), o = 0; o < r.length; o++) {
                var a = void 0,
                  s = void 0;
                o == r.length - 1
                  ? ((s = r.join(" ")), (a = i))
                  : ((s = r.slice(0, o + 1).join(" ")), (a = "..."));
                var l = t[s];
                if (l) {
                  if (l != a) throw new Error("Inconsistent bindings for " + s);
                } else t[s] = a;
              }
              delete e[n];
            }
          for (var c in t) e[c] = t[c];
          return e;
        }
        function Ho(e, t, n, i) {
          var r = (t = qo(t)).call ? t.call(e, i) : t[e];
          if (!1 === r) return "nothing";
          if ("..." === r) return "multi";
          if (null != r && n(r)) return "handled";
          if (t.fallthrough) {
            if (
              "[object Array]" != Object.prototype.toString.call(t.fallthrough)
            )
              return Ho(e, t.fallthrough, n, i);
            for (var o = 0; o < t.fallthrough.length; o++) {
              var a = Ho(e, t.fallthrough[o], n, i);
              if (a) return a;
            }
          }
        }
        function Uo(e) {
          var t = "string" == typeof e ? e : Do[e.keyCode];
          return "Ctrl" == t || "Alt" == t || "Shift" == t || "Mod" == t;
        }
        function jo(e, t) {
          if (u && 34 == e.keyCode && e.char) return !1;
          var n = Do[e.keyCode],
            i = n;
          return (
            null != i &&
            !e.altGraphKey &&
            (e.altKey && "Alt" != n && (i = "Alt-" + i),
            (C ? e.metaKey : e.ctrlKey) && "Ctrl" != n && (i = "Ctrl-" + i),
            (C ? e.ctrlKey : e.metaKey) && "Cmd" != n && (i = "Cmd-" + i),
            !t && e.shiftKey && "Shift" != n && (i = "Shift-" + i),
            i)
          );
        }
        function qo(e) {
          return "string" == typeof e ? Io[e] : e;
        }
        function Wo(e, t) {
          for (var n = e.doc.sel.ranges, i = [], r = 0; r < n.length; r++) {
            for (var o = t(n[r]); i.length && ge(o.from, Y(i).to) <= 0; ) {
              var a = i.pop();
              if (ge(a.from, o.from) < 0) {
                o.from = a.from;
                break;
              }
            }
            i.push(o);
          }
          Wi(e, function () {
            for (var t = i.length - 1; t >= 0; t--)
              lo(e.doc, "", i[t].from, i[t].to, "+delete");
            Fi(e);
          });
        }
        (Io.basic = {
          Left: "goCharLeft",
          Right: "goCharRight",
          Up: "goLineUp",
          Down: "goLineDown",
          End: "goLineEnd",
          Home: "goLineStartSmart",
          PageUp: "goPageUp",
          PageDown: "goPageDown",
          Delete: "delCharAfter",
          Backspace: "delCharBefore",
          "Shift-Backspace": "delCharBefore",
          Tab: "defaultTab",
          "Shift-Tab": "indentAuto",
          Enter: "newlineAndIndent",
          Insert: "toggleOverwrite",
          Esc: "singleSelection",
        }),
          (Io.pcDefault = {
            "Ctrl-A": "selectAll",
            "Ctrl-Up": "goDocStart",
            "Ctrl-Down": "goDocEnd",
            "Ctrl-Left": "goGroupLeft",
            "Ctrl-Right": "goGroupRight",
            "Alt-Left": "goLineStart",
            "Alt-Right": "goLineEnd",
            "Ctrl-Backspace": "delGroupBefore",
            "Ctrl-Delete": "delGroupAfter",
            "Ctrl-[": "indentLess",
            "Ctrl-]": "indentMore",
            "Ctrl-U": "undoSelection",
            "Shift-Ctrl-U": "redoSelection",
            "Alt-U": "redoSelection",
            fallthrough: "basic",
          }),
          (Io.emacsy = {
            "Ctrl-F": "goCharRight",
            "Ctrl-B": "goCharLeft",
            "Ctrl-P": "goLineUp",
            "Ctrl-N": "goLineDown",
            "Alt-F": "goWordRight",
            "Alt-B": "goWordLeft",
            "Ctrl-A": "goLineStart",
            "Ctrl-E": "goLineEnd",
            "Ctrl-V": "goPageDown",
            "Shift-Ctrl-V": "goPageUp",
            "Ctrl-D": "delCharAfter",
            "Ctrl-H": "delCharBefore",
            "Alt-D": "delWordAfter",
            "Alt-Backspace": "delWordBefore",
            "Ctrl-K": "killLine",
            "Ctrl-T": "transposeChars",
            "Ctrl-O": "openLine",
          }),
          (Io.macDefault = {
            "Cmd-A": "selectAll",
            "Cmd-Up": "goDocStart",
            "Cmd-Down": "goDocEnd",
            "Alt-Left": "goGroupLeft",
            "Alt-Right": "goGroupRight",
            "Cmd-Left": "goLineLeft",
            "Cmd-Right": "goLineRight",
            "Alt-Backspace": "delGroupBefore",
            "Ctrl-Alt-Backspace": "delGroupAfter",
            "Alt-Delete": "delGroupAfter",
            "Cmd-[": "indentLess",
            "Cmd-]": "indentMore",
            "Cmd-Backspace": "delWrappedLineLeft",
            "Cmd-Delete": "delWrappedLineRight",
            "Cmd-U": "undoSelection",
            "Shift-Cmd-U": "redoSelection",
            "Ctrl-Up": "goDocStart",
            "Ctrl-Down": "goDocEnd",
            fallthrough: ["basic", "emacsy"],
          }),
          (Io.default = y ? Io.macDefault : Io.pcDefault);
        var zo = {
          selectAll: to,
          singleSelection: function (e) {
            return e.setSelection(
              e.getCursor("anchor"),
              e.getCursor("head"),
              q
            );
          },
          killLine: function (e) {
            return Wo(e, function (t) {
              if (t.empty()) {
                var n = se(e.doc, t.head.line).text.length;
                return t.head.ch == n && t.head.line < e.lastLine()
                  ? { from: t.head, to: me(t.head.line + 1, 0) }
                  : { from: t.head, to: me(t.head.line, n) };
              }
              return { from: t.from(), to: t.to() };
            });
          },
          deleteLine: function (e) {
            return Wo(e, function (t) {
              return {
                from: me(t.from().line, 0),
                to: Ce(e.doc, me(t.to().line + 1, 0)),
              };
            });
          },
          delLineLeft: function (e) {
            return Wo(e, function (e) {
              return { from: me(e.from().line, 0), to: e.from() };
            });
          },
          delWrappedLineLeft: function (e) {
            return Wo(e, function (t) {
              var n = e.charCoords(t.head, "div").top + 5;
              return {
                from: e.coordsChar({ left: 0, top: n }, "div"),
                to: t.from(),
              };
            });
          },
          delWrappedLineRight: function (e) {
            return Wo(e, function (t) {
              var n = e.charCoords(t.head, "div").top + 5,
                i = e.coordsChar(
                  { left: e.display.lineDiv.offsetWidth + 100, top: n },
                  "div"
                );
              return { from: t.from(), to: i };
            });
          },
          undo: function (e) {
            return e.undo();
          },
          redo: function (e) {
            return e.redo();
          },
          undoSelection: function (e) {
            return e.undoSelection();
          },
          redoSelection: function (e) {
            return e.redoSelection();
          },
          goDocStart: function (e) {
            return e.extendSelection(me(e.firstLine(), 0));
          },
          goDocEnd: function (e) {
            return e.extendSelection(me(e.lastLine()));
          },
          goLineStart: function (e) {
            return e.extendSelectionsBy(
              function (t) {
                return Vo(e, t.head.line);
              },
              { origin: "+move", bias: 1 }
            );
          },
          goLineStartSmart: function (e) {
            return e.extendSelectionsBy(
              function (t) {
                return Jo(e, t.head);
              },
              { origin: "+move", bias: 1 }
            );
          },
          goLineEnd: function (e) {
            return e.extendSelectionsBy(
              function (t) {
                return (function (e, t) {
                  var n = se(e.doc, t),
                    i = (function (e) {
                      for (var t; (t = Oe(e)); ) e = t.find(1, !0).line;
                      return e;
                    })(n);
                  i != n && (t = ue(i));
                  return et(!0, e, n, t, -1);
                })(e, t.head.line);
              },
              { origin: "+move", bias: -1 }
            );
          },
          goLineRight: function (e) {
            return e.extendSelectionsBy(function (t) {
              var n = e.charCoords(t.head, "div").top + 5;
              return e.coordsChar(
                { left: e.display.lineDiv.offsetWidth + 100, top: n },
                "div"
              );
            }, z);
          },
          goLineLeft: function (e) {
            return e.extendSelectionsBy(function (t) {
              var n = e.charCoords(t.head, "div").top + 5;
              return e.coordsChar({ left: 0, top: n }, "div");
            }, z);
          },
          goLineLeftSmart: function (e) {
            return e.extendSelectionsBy(function (t) {
              var n = e.charCoords(t.head, "div").top + 5,
                i = e.coordsChar({ left: 0, top: n }, "div");
              return i.ch < e.getLine(i.line).search(/\S/) ? Jo(e, t.head) : i;
            }, z);
          },
          goLineUp: function (e) {
            return e.moveV(-1, "line");
          },
          goLineDown: function (e) {
            return e.moveV(1, "line");
          },
          goPageUp: function (e) {
            return e.moveV(-1, "page");
          },
          goPageDown: function (e) {
            return e.moveV(1, "page");
          },
          goCharLeft: function (e) {
            return e.moveH(-1, "char");
          },
          goCharRight: function (e) {
            return e.moveH(1, "char");
          },
          goColumnLeft: function (e) {
            return e.moveH(-1, "column");
          },
          goColumnRight: function (e) {
            return e.moveH(1, "column");
          },
          goWordLeft: function (e) {
            return e.moveH(-1, "word");
          },
          goGroupRight: function (e) {
            return e.moveH(1, "group");
          },
          goGroupLeft: function (e) {
            return e.moveH(-1, "group");
          },
          goWordRight: function (e) {
            return e.moveH(1, "word");
          },
          delCharBefore: function (e) {
            return e.deleteH(-1, "char");
          },
          delCharAfter: function (e) {
            return e.deleteH(1, "char");
          },
          delWordBefore: function (e) {
            return e.deleteH(-1, "word");
          },
          delWordAfter: function (e) {
            return e.deleteH(1, "word");
          },
          delGroupBefore: function (e) {
            return e.deleteH(-1, "group");
          },
          delGroupAfter: function (e) {
            return e.deleteH(1, "group");
          },
          indentAuto: function (e) {
            return e.indentSelection("smart");
          },
          indentMore: function (e) {
            return e.indentSelection("add");
          },
          indentLess: function (e) {
            return e.indentSelection("subtract");
          },
          insertTab: function (e) {
            return e.replaceSelection("\t");
          },
          insertSoftTab: function (e) {
            for (
              var t = [], n = e.listSelections(), i = e.options.tabSize, r = 0;
              r < n.length;
              r++
            ) {
              var o = n[r].from(),
                a = O(e.getLine(o.line), o.ch, i);
              t.push(K(i - (a % i)));
            }
            e.replaceSelections(t);
          },
          defaultTab: function (e) {
            e.somethingSelected()
              ? e.indentSelection("add")
              : e.execCommand("insertTab");
          },
          transposeChars: function (e) {
            return Wi(e, function () {
              for (var t = e.listSelections(), n = [], i = 0; i < t.length; i++)
                if (t[i].empty()) {
                  var r = t[i].head,
                    o = se(e.doc, r.line).text;
                  if (o)
                    if (
                      (r.ch == o.length && (r = new me(r.line, r.ch - 1)),
                      r.ch > 0)
                    )
                      (r = new me(r.line, r.ch + 1)),
                        e.replaceRange(
                          o.charAt(r.ch - 1) + o.charAt(r.ch - 2),
                          me(r.line, r.ch - 2),
                          r,
                          "+transpose"
                        );
                    else if (r.line > e.doc.first) {
                      var a = se(e.doc, r.line - 1).text;
                      a &&
                        ((r = new me(r.line, 1)),
                        e.replaceRange(
                          o.charAt(0) +
                            e.doc.lineSeparator() +
                            a.charAt(a.length - 1),
                          me(r.line - 1, a.length - 1),
                          r,
                          "+transpose"
                        ));
                    }
                  n.push(new mr(r, r));
                }
              e.setSelections(n);
            });
          },
          newlineAndIndent: function (e) {
            return Wi(e, function () {
              for (var t = e.listSelections(), n = t.length - 1; n >= 0; n--)
                e.replaceRange(
                  e.doc.lineSeparator(),
                  t[n].anchor,
                  t[n].head,
                  "+input"
                );
              t = e.listSelections();
              for (var i = 0; i < t.length; i++)
                e.indentLine(t[i].from().line, null, !0);
              Fi(e);
            });
          },
          openLine: function (e) {
            return e.replaceSelection("\n", "start");
          },
          toggleOverwrite: function (e) {
            return e.toggleOverwrite();
          },
        };
        function Vo(e, t) {
          var n = se(e.doc, t),
            i = He(n);
          return i != n && (t = ue(i)), et(!0, e, i, t, 1);
        }
        function Jo(e, t) {
          var n = Vo(e, t.line),
            i = se(e.doc, n.line),
            r = Qe(i, e.doc.direction);
          if (!r || 0 == r[0].level) {
            var o = Math.max(0, i.text.search(/\S/)),
              a = t.line == n.line && t.ch <= o && t.ch;
            return me(n.line, a ? 0 : o, n.sticky);
          }
          return n;
        }
        function Ko(e, t, n) {
          if ("string" == typeof t && !(t = zo[t])) return !1;
          e.display.input.ensurePolled();
          var i = e.display.shift,
            r = !1;
          try {
            e.isReadOnly() && (e.state.suppressEdits = !0),
              n && (e.display.shift = !1),
              (r = t(e) != j);
          } finally {
            (e.display.shift = i), (e.state.suppressEdits = !1);
          }
          return r;
        }
        var Yo = new $();
        function Go(e, t, n, i) {
          var r = e.state.keySeq;
          if (r) {
            if (Uo(t)) return "handled";
            Yo.set(50, function () {
              e.state.keySeq == r &&
                ((e.state.keySeq = null), e.display.input.reset());
            }),
              (t = r + " " + t);
          }
          var o = (function (e, t, n) {
            for (var i = 0; i < e.state.keyMaps.length; i++) {
              var r = Ho(t, e.state.keyMaps[i], n, e);
              if (r) return r;
            }
            return (
              (e.options.extraKeys && Ho(t, e.options.extraKeys, n, e)) ||
              Ho(t, e.options.keyMap, n, e)
            );
          })(e, t, i);
          return (
            "multi" == o && (e.state.keySeq = t),
            "handled" == o && ln(e, "keyHandled", e, t, n),
            ("handled" != o && "multi" != o) || (ut(n), ui(e)),
            r && !o && /\'$/.test(t) ? (ut(n), !0) : !!o
          );
        }
        function Qo(e, t) {
          var n = jo(t, !0);
          return (
            !!n &&
            (t.shiftKey && !e.state.keySeq
              ? Go(e, "Shift-" + n, t, function (t) {
                  return Ko(e, t, !0);
                }) ||
                Go(e, n, t, function (t) {
                  if ("string" == typeof t ? /^go[A-Z]/.test(t) : t.motion)
                    return Ko(e, t);
                })
              : Go(e, n, t, function (t) {
                  return Ko(e, t);
                }))
          );
        }
        var Xo,
          Zo,
          ea = null;
        function ta(e) {
          var t = this;
          if (
            ((t.curOp.focus = N()), 37 == e.keyCode && e.shiftKey, !st(t, e))
          ) {
            a && s < 11 && 27 == e.keyCode && (e.returnValue = !1);
            var n = e.keyCode;
            t.display.shift = 16 == n || e.shiftKey;
            var i = Qo(t, e);
            u &&
              ((ea = i ? n : null),
              !i &&
                88 == n &&
                !kt &&
                (y ? e.metaKey : e.ctrlKey) &&
                t.replaceSelection("", null, "cut")),
              18 != n ||
                /\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className) ||
                (function (e) {
                  var t = e.display.lineDiv;
                  function n(e) {
                    (18 != e.keyCode && e.altKey) ||
                      (E(t, "CodeMirror-crosshair"),
                      ot(document, "keyup", n),
                      ot(document, "mouseover", n));
                  }
                  D(t, "CodeMirror-crosshair"),
                    it(document, "keyup", n),
                    it(document, "mouseover", n);
                })(t);
          }
        }
        function na(e) {
          16 == e.keyCode && (this.doc.sel.shift = !1), st(this, e);
        }
        function ia(e) {
          var t = this;
          if (
            !(
              Cn(t.display, e) ||
              st(t, e) ||
              (e.ctrlKey && !e.altKey) ||
              (y && e.metaKey)
            )
          ) {
            var n = e.keyCode,
              i = e.charCode;
            if (u && n == ea) return (ea = null), void ut(e);
            if (!u || (e.which && !(e.which < 10)) || !Qo(t, e)) {
              var r = String.fromCharCode(null == i ? n : i);
              "\b" != r &&
                ((function (e, t, n) {
                  return Go(e, "'" + n + "'", t, function (t) {
                    return Ko(e, t, !0);
                  });
                })(t, e, r) ||
                  t.display.input.onKeyPress(e));
            }
          }
        }
        function ra(e) {
          var t = this,
            n = t.display;
          if (!(st(t, e) || (n.activeTouch && n.input.supportsTouch())))
            if (
              (n.input.ensurePolled(),
              (n.shift = e.shiftKey),
              Cn(n, e, 0 == t.options.lineWrapping))
            )
              l ||
                ((n.scroller.draggable = !1),
                setTimeout(function () {
                  return (n.scroller.draggable = !0);
                }, 100));
            else if (!aa(t, e)) {
              var i = oi(t, e);
              switch ((window.focus(), gt(e))) {
                case 1:
                  t.state.selectingText
                    ? t.state.selectingText(e)
                    : i
                    ? (function (e, t, n) {
                        a ? setTimeout(P(hi, e), 0) : (e.curOp.focus = N());
                        var i,
                          r = +new Date();
                        Zo && Zo.time > r - 400 && 0 == ge(Zo.pos, n)
                          ? (i = "triple")
                          : Xo && Xo.time > r - 400 && 0 == ge(Xo.pos, n)
                          ? ((i = "double"), (Zo = { time: r, pos: n }))
                          : ((i = "single"), (Xo = { time: r, pos: n }));
                        var o,
                          c = e.doc.sel,
                          d = y ? t.metaKey : t.ctrlKey;
                        e.options.dragDrop &&
                        bt &&
                        !e.isReadOnly() &&
                        "single" == i &&
                        (o = c.contains(n)) > -1 &&
                        (ge((o = c.ranges[o]).from(), n) < 0 || n.xRel > 0) &&
                        (ge(o.to(), n) > 0 || n.xRel < 0)
                          ? (function (e, t, n, i) {
                              var r = e.display,
                                o = !1,
                                c = zi(e, function (t) {
                                  l && (r.scroller.draggable = !1),
                                    (e.state.draggingText = !1),
                                    ot(document, "mouseup", c),
                                    ot(document, "mousemove", d),
                                    ot(r.scroller, "dragstart", u),
                                    ot(r.scroller, "drop", c),
                                    o ||
                                      (ut(t),
                                      i || jr(e.doc, n),
                                      l || (a && 9 == s)
                                        ? setTimeout(function () {
                                            document.body.focus(),
                                              r.input.focus();
                                          }, 20)
                                        : r.input.focus());
                                }),
                                d = function (e) {
                                  o =
                                    o ||
                                    Math.abs(t.clientX - e.clientX) +
                                      Math.abs(t.clientY - e.clientY) >=
                                      10;
                                },
                                u = function () {
                                  return (o = !0);
                                };
                              l && (r.scroller.draggable = !0);
                              (e.state.draggingText = c),
                                (c.copy = y ? t.altKey : t.ctrlKey),
                                r.scroller.dragDrop && r.scroller.dragDrop();
                              it(document, "mouseup", c),
                                it(document, "mousemove", d),
                                it(r.scroller, "dragstart", u),
                                it(r.scroller, "drop", c),
                                pi(e),
                                setTimeout(function () {
                                  return r.input.focus();
                                }, 20);
                            })(e, t, n, d)
                          : (function (e, t, n, i, r) {
                              var o = e.display,
                                a = e.doc;
                              ut(t);
                              var s,
                                l,
                                c = a.sel,
                                d = c.ranges;
                              r && !t.shiftKey
                                ? ((l = a.sel.contains(n)),
                                  (s = l > -1 ? d[l] : new mr(n, n)))
                                : ((s = a.sel.primary()),
                                  (l = a.sel.primIndex));
                              if (b ? t.shiftKey && t.metaKey : t.altKey)
                                (i = "rect"),
                                  r || (s = new mr(n, n)),
                                  (n = oi(e, t, !0, !0)),
                                  (l = -1);
                              else if ("double" == i) {
                                var u = e.findWordAt(n);
                                s =
                                  e.display.shift || a.extend
                                    ? Ur(a, s, u.anchor, u.head)
                                    : u;
                              } else if ("triple" == i) {
                                var h = new mr(
                                  me(n.line, 0),
                                  Ce(a, me(n.line + 1, 0))
                                );
                                s =
                                  e.display.shift || a.extend
                                    ? Ur(a, s, h.anchor, h.head)
                                    : h;
                              } else s = Ur(a, s, n);
                              r
                                ? -1 == l
                                  ? ((l = d.length),
                                    Jr(a, gr(d.concat([s]), l), {
                                      scroll: !1,
                                      origin: "*mouse",
                                    }))
                                  : d.length > 1 &&
                                    d[l].empty() &&
                                    "single" == i &&
                                    !t.shiftKey
                                  ? (Jr(
                                      a,
                                      gr(
                                        d.slice(0, l).concat(d.slice(l + 1)),
                                        0
                                      ),
                                      { scroll: !1, origin: "*mouse" }
                                    ),
                                    (c = a.sel))
                                  : Wr(a, l, s, W)
                                : ((l = 0),
                                  Jr(a, new fr([s], 0), W),
                                  (c = a.sel));
                              var p = n;
                              var f = o.wrapper.getBoundingClientRect(),
                                m = 0;
                              function g(t) {
                                var r = ++m,
                                  d = oi(e, t, !0, "rect" == i);
                                if (d)
                                  if (0 != ge(d, p)) {
                                    (e.curOp.focus = N()),
                                      (function (t) {
                                        if (0 == ge(p, t)) return;
                                        if (((p = t), "rect" == i)) {
                                          for (
                                            var r = [],
                                              o = e.options.tabSize,
                                              d = O(
                                                se(a, n.line).text,
                                                n.ch,
                                                o
                                              ),
                                              u = O(
                                                se(a, t.line).text,
                                                t.ch,
                                                o
                                              ),
                                              h = Math.min(d, u),
                                              f = Math.max(d, u),
                                              m = Math.min(n.line, t.line),
                                              g = Math.min(
                                                e.lastLine(),
                                                Math.max(n.line, t.line)
                                              );
                                            m <= g;
                                            m++
                                          ) {
                                            var v = se(a, m).text,
                                              y = V(v, h, o);
                                            h == f
                                              ? r.push(
                                                  new mr(me(m, y), me(m, y))
                                                )
                                              : v.length > y &&
                                                r.push(
                                                  new mr(
                                                    me(m, y),
                                                    me(m, V(v, f, o))
                                                  )
                                                );
                                          }
                                          r.length || r.push(new mr(n, n)),
                                            Jr(
                                              a,
                                              gr(
                                                c.ranges.slice(0, l).concat(r),
                                                l
                                              ),
                                              { origin: "*mouse", scroll: !1 }
                                            ),
                                            e.scrollIntoView(t);
                                        } else {
                                          var b,
                                            w = s,
                                            x = w.anchor,
                                            C = t;
                                          if ("single" != i)
                                            ge(
                                              (b =
                                                "double" == i
                                                  ? e.findWordAt(t)
                                                  : new mr(
                                                      me(t.line, 0),
                                                      Ce(a, me(t.line + 1, 0))
                                                    )).anchor,
                                              x
                                            ) > 0
                                              ? ((C = b.head),
                                                (x = we(w.from(), b.anchor)))
                                              : ((C = b.anchor),
                                                (x = be(w.to(), b.head)));
                                          var F = c.ranges.slice(0);
                                          (F[l] = new mr(Ce(a, x), C)),
                                            Jr(a, gr(F, l), W);
                                        }
                                      })(d);
                                    var u = yi(o, a);
                                    (d.line >= u.to || d.line < u.from) &&
                                      setTimeout(
                                        zi(e, function () {
                                          m == r && g(t);
                                        }),
                                        150
                                      );
                                  } else {
                                    var h =
                                      t.clientY < f.top
                                        ? -20
                                        : t.clientY > f.bottom
                                        ? 20
                                        : 0;
                                    h &&
                                      setTimeout(
                                        zi(e, function () {
                                          m == r &&
                                            ((o.scroller.scrollTop += h), g(t));
                                        }),
                                        50
                                      );
                                  }
                              }
                              function v(t) {
                                (e.state.selectingText = !1),
                                  (m = 1 / 0),
                                  ut(t),
                                  o.input.focus(),
                                  ot(document, "mousemove", y),
                                  ot(document, "mouseup", w),
                                  a.history
                                    ? (a.history.lastSelOrigin = null)
                                    : ((a.history = new Ar(null)),
                                      (a.history.lastSelOrigin = null));
                              }
                              var y = zi(e, function (e) {
                                  gt(e) ? g(e) : v(e);
                                }),
                                w = zi(e, v);
                              (e.state.selectingText = w),
                                it(document, "mousemove", y),
                                it(document, "mouseup", w);
                            })(e, t, n, i, d);
                      })(t, e, i)
                    : mt(e) == n.scroller && ut(e);
                  break;
                case 2:
                  l && (t.state.lastMiddleDown = +new Date()),
                    i && jr(t.doc, i),
                    setTimeout(function () {
                      return n.input.focus();
                    }, 20),
                    ut(e);
                  break;
                case 3:
                  F ? sa(t, e) : pi(t);
              }
            }
        }
        function oa(e, t, n, i) {
          var r, o;
          try {
            (r = t.clientX), (o = t.clientY);
          } catch (t) {
            return !1;
          }
          if (r >= Math.floor(e.display.gutters.getBoundingClientRect().right))
            return !1;
          i && ut(t);
          var a = e.display,
            s = a.lineDiv.getBoundingClientRect();
          if (o > s.bottom || !ct(e, n)) return pt(t);
          o -= s.top - a.viewOffset;
          for (var l = 0; l < e.options.gutters.length; ++l) {
            var c = a.gutters.childNodes[l];
            if (c && c.getBoundingClientRect().right >= r)
              return at(e, n, e, he(e.doc, o), e.options.gutters[l], t), pt(t);
          }
        }
        function aa(e, t) {
          return oa(e, t, "gutterClick", !0);
        }
        function sa(e, t) {
          Cn(e.display, t) ||
            (function (e, t) {
              if (!ct(e, "gutterContextMenu")) return !1;
              return oa(e, t, "gutterContextMenu", !1);
            })(e, t) ||
            st(e, t, "contextmenu") ||
            e.display.input.onContextMenu(t);
        }
        function la(e) {
          (e.display.wrapper.className =
            e.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") +
            e.options.theme.replace(/(^|\s)\s*/g, " cm-s-")),
            Hn(e);
        }
        var ca = {
            toString: function () {
              return "CodeMirror.Init";
            },
          },
          da = {},
          ua = {};
        function ha(e) {
          sr(e), Ki(e), bi(e);
        }
        function pa(e, t, n) {
          if (!t != !(n && n != ca)) {
            var i = e.display.dragFunctions,
              r = t ? it : ot;
            r(e.display.scroller, "dragstart", i.start),
              r(e.display.scroller, "dragenter", i.enter),
              r(e.display.scroller, "dragover", i.over),
              r(e.display.scroller, "dragleave", i.leave),
              r(e.display.scroller, "drop", i.drop);
          }
        }
        function fa(e) {
          e.options.lineWrapping
            ? (D(e.display.wrapper, "CodeMirror-wrap"),
              (e.display.sizer.style.minWidth = ""),
              (e.display.sizerWidth = null))
            : (E(e.display.wrapper, "CodeMirror-wrap"), Je(e)),
            ri(e),
            Ki(e),
            Hn(e),
            setTimeout(function () {
              return Di(e);
            }, 100);
        }
        function ma(e, t, i, r) {
          var o = this;
          if (!(this instanceof ma)) return new ma(e, t, i, r);
          (this.options = t = t ? I(t) : {}), I(da, t, !1), lr(t);
          var c = t.value;
          "string" == typeof c &&
            (c = new ko(c, t.mode, null, t.lineSeparator, t.direction)),
            (this.doc = c);
          var d = new ma.inputStyles[t.inputStyle](this),
            p = (this.display = new (function (e, t, i) {
              var r = this;
              (this.input = i),
                (r.scrollbarFiller = A(
                  "div",
                  null,
                  "CodeMirror-scrollbar-filler"
                )),
                r.scrollbarFiller.setAttribute("cm-not-content", "true"),
                (r.gutterFiller = A("div", null, "CodeMirror-gutter-filler")),
                r.gutterFiller.setAttribute("cm-not-content", "true"),
                (r.lineDiv = M("div", null, "CodeMirror-code")),
                (r.selectionDiv = A(
                  "div",
                  null,
                  null,
                  "position: relative; z-index: 1"
                )),
                (r.cursorDiv = A("div", null, "CodeMirror-cursors")),
                (r.measure = A("div", null, "CodeMirror-measure")),
                (r.lineMeasure = A("div", null, "CodeMirror-measure")),
                (r.lineSpace = M(
                  "div",
                  [
                    r.measure,
                    r.lineMeasure,
                    r.selectionDiv,
                    r.cursorDiv,
                    r.lineDiv,
                  ],
                  null,
                  "position: relative; outline: none"
                ));
              var o = M("div", [r.lineSpace], "CodeMirror-lines");
              (r.mover = A("div", [o], null, "position: relative")),
                (r.sizer = A("div", [r.mover], "CodeMirror-sizer")),
                (r.sizerWidth = null),
                (r.heightForcer = A(
                  "div",
                  null,
                  null,
                  "position: absolute; height: " + U + "px; width: 1px;"
                )),
                (r.gutters = A("div", null, "CodeMirror-gutters")),
                (r.lineGutter = null),
                (r.scroller = A(
                  "div",
                  [r.sizer, r.heightForcer, r.gutters],
                  "CodeMirror-scroll"
                )),
                r.scroller.setAttribute("tabIndex", "-1"),
                (r.wrapper = A(
                  "div",
                  [r.scrollbarFiller, r.gutterFiller, r.scroller],
                  "CodeMirror"
                )),
                a &&
                  s < 8 &&
                  ((r.gutters.style.zIndex = -1),
                  (r.scroller.style.paddingRight = 0)),
                l || (n && v) || (r.scroller.draggable = !0),
                e && (e.appendChild ? e.appendChild(r.wrapper) : e(r.wrapper)),
                (r.viewFrom = r.viewTo = t.first),
                (r.reportedViewFrom = r.reportedViewTo = t.first),
                (r.view = []),
                (r.renderedView = null),
                (r.externalMeasured = null),
                (r.viewOffset = 0),
                (r.lastWrapHeight = r.lastWrapWidth = 0),
                (r.updateLineNumbers = null),
                (r.nativeBarWidth = r.barHeight = r.barWidth = 0),
                (r.scrollbarsClipped = !1),
                (r.lineNumWidth = r.lineNumInnerWidth = r.lineNumChars = null),
                (r.alignWidgets = !1),
                (r.cachedCharWidth =
                  r.cachedTextHeight =
                  r.cachedPaddingH =
                    null),
                (r.maxLine = null),
                (r.maxLineLength = 0),
                (r.maxLineChanged = !1),
                (r.wheelDX = r.wheelDY = r.wheelStartX = r.wheelStartY = null),
                (r.shift = !1),
                (r.selForContextMenu = null),
                (r.activeTouch = null),
                i.init(r);
            })(e, c, d));
          for (var f in ((p.wrapper.CodeMirror = this),
          sr(this),
          la(this),
          t.lineWrapping &&
            (this.display.wrapper.className += " CodeMirror-wrap"),
          Pi(this),
          (this.state = {
            keyMaps: [],
            overlays: [],
            modeGen: 0,
            overwrite: !1,
            delayingBlurEvent: !1,
            focused: !1,
            suppressEdits: !1,
            pasteIncoming: !1,
            cutIncoming: !1,
            selectingText: !1,
            draggingText: !1,
            highlight: new $(),
            keySeq: null,
            specialChars: null,
          }),
          t.autofocus && !v && p.input.focus(),
          a &&
            s < 11 &&
            setTimeout(function () {
              return o.display.input.reset(!0);
            }, 20),
          (function (e) {
            var t = e.display;
            it(t.scroller, "mousedown", zi(e, ra)),
              it(
                t.scroller,
                "dblclick",
                a && s < 11
                  ? zi(e, function (t) {
                      if (!st(e, t)) {
                        var n = oi(e, t);
                        if (n && !aa(e, t) && !Cn(e.display, t)) {
                          ut(t);
                          var i = e.findWordAt(n);
                          jr(e.doc, i.anchor, i.head);
                        }
                      }
                    })
                  : function (t) {
                      return st(e, t) || ut(t);
                    }
              );
            F ||
              it(t.scroller, "contextmenu", function (t) {
                return sa(e, t);
              });
            var n,
              i = { end: 0 };
            function r() {
              t.activeTouch &&
                ((n = setTimeout(function () {
                  return (t.activeTouch = null);
                }, 1e3)),
                ((i = t.activeTouch).end = +new Date()));
            }
            function o(e, t) {
              if (null == t.left) return !0;
              var n = t.left - e.left,
                i = t.top - e.top;
              return n * n + i * i > 400;
            }
            it(t.scroller, "touchstart", function (r) {
              if (
                !st(e, r) &&
                !(function (e) {
                  if (1 != e.touches.length) return !1;
                  var t = e.touches[0];
                  return t.radiusX <= 1 && t.radiusY <= 1;
                })(r)
              ) {
                t.input.ensurePolled(), clearTimeout(n);
                var o = +new Date();
                (t.activeTouch = {
                  start: o,
                  moved: !1,
                  prev: o - i.end <= 300 ? i : null,
                }),
                  1 == r.touches.length &&
                    ((t.activeTouch.left = r.touches[0].pageX),
                    (t.activeTouch.top = r.touches[0].pageY));
              }
            }),
              it(t.scroller, "touchmove", function () {
                t.activeTouch && (t.activeTouch.moved = !0);
              }),
              it(t.scroller, "touchend", function (n) {
                var i = t.activeTouch;
                if (
                  i &&
                  !Cn(t, n) &&
                  null != i.left &&
                  !i.moved &&
                  new Date() - i.start < 300
                ) {
                  var a,
                    s = e.coordsChar(t.activeTouch, "page");
                  (a =
                    !i.prev || o(i, i.prev)
                      ? new mr(s, s)
                      : !i.prev.prev || o(i, i.prev.prev)
                      ? e.findWordAt(s)
                      : new mr(me(s.line, 0), Ce(e.doc, me(s.line + 1, 0)))),
                    e.setSelection(a.anchor, a.head),
                    e.focus(),
                    ut(n);
                }
                r();
              }),
              it(t.scroller, "touchcancel", r),
              it(t.scroller, "scroll", function () {
                t.scroller.clientHeight &&
                  (Ti(e, t.scroller.scrollTop),
                  Ai(e, t.scroller.scrollLeft, !0),
                  at(e, "scroll", e));
              }),
              it(t.scroller, "mousewheel", function (t) {
                return pr(e, t);
              }),
              it(t.scroller, "DOMMouseScroll", function (t) {
                return pr(e, t);
              }),
              it(t.wrapper, "scroll", function () {
                return (t.wrapper.scrollTop = t.wrapper.scrollLeft = 0);
              }),
              (t.dragFunctions = {
                enter: function (t) {
                  st(e, t) || ft(t);
                },
                over: function (t) {
                  st(e, t) ||
                    (!(function (e, t) {
                      var n = oi(e, t);
                      if (n) {
                        var i = document.createDocumentFragment();
                        ci(e, n, i),
                          e.display.dragCursor ||
                            ((e.display.dragCursor = A(
                              "div",
                              null,
                              "CodeMirror-cursors CodeMirror-dragcursors"
                            )),
                            e.display.lineSpace.insertBefore(
                              e.display.dragCursor,
                              e.display.cursorDiv
                            )),
                          _(e.display.dragCursor, i);
                      }
                    })(e, t),
                    ft(t));
                },
                start: function (t) {
                  return (function (e, t) {
                    if (a && (!e.state.draggingText || +new Date() - Eo < 100))
                      ft(t);
                    else if (
                      !st(e, t) &&
                      !Cn(e.display, t) &&
                      (t.dataTransfer.setData("Text", e.getSelection()),
                      (t.dataTransfer.effectAllowed = "copyMove"),
                      t.dataTransfer.setDragImage && !h)
                    ) {
                      var n = A(
                        "img",
                        null,
                        null,
                        "position: fixed; left: 0; top: 0;"
                      );
                      (n.src =
                        "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),
                        u &&
                          ((n.width = n.height = 1),
                          e.display.wrapper.appendChild(n),
                          (n._top = n.offsetTop)),
                        t.dataTransfer.setDragImage(n, 0, 0),
                        u && n.parentNode.removeChild(n);
                    }
                  })(e, t);
                },
                drop: zi(e, To),
                leave: function (t) {
                  st(e, t) || _o(e);
                },
              });
            var l = t.input.getField();
            it(l, "keyup", function (t) {
              return na.call(e, t);
            }),
              it(l, "keydown", zi(e, ta)),
              it(l, "keypress", zi(e, ia)),
              it(l, "focus", function (t) {
                return fi(e, t);
              }),
              it(l, "blur", function (t) {
                return mi(e, t);
              });
          })(this),
          Lo(),
          Oi(this),
          (this.curOp.forceUpdate = !0),
          Tr(this, c),
          (t.autofocus && !v) || this.hasFocus()
            ? setTimeout(P(fi, this), 20)
            : mi(this),
          ua))
            ua.hasOwnProperty(f) && ua[f](o, t[f], ca);
          wi(this), t.finishInit && t.finishInit(this);
          for (var m = 0; m < ga.length; ++m) ga[m](o);
          $i(this),
            l &&
              t.lineWrapping &&
              "optimizelegibility" ==
                getComputedStyle(p.lineDiv).textRendering &&
              (p.lineDiv.style.textRendering = "auto"),
            (this.editor = i),
            (this.cid = r);
        }
        (ma.defaults = da), (ma.optionHandlers = ua);
        var ga = [];
        function va(e, t, n, i) {
          var r,
            o = e.doc;
          null == n && (n = "add"),
            "smart" == n && (o.mode.indent ? (r = $t(e, t)) : (n = "prev"));
          var a = e.options.tabSize,
            s = se(o, t),
            l = O(s.text, null, a);
          s.stateAfter && (s.stateAfter = null);
          var c,
            d = s.text.match(/^\s*/)[0];
          if (i || /\S/.test(s.text)) {
            if (
              "smart" == n &&
              ((c = o.mode.indent(r, s.text.slice(d.length), s.text)) == j ||
                c > 150)
            ) {
              if (!i) return;
              n = "prev";
            }
          } else (c = 0), (n = "not");
          var u = "",
            h = 0;
          if (
            ("prev" == n
              ? t > o.first
                ? ((c = O((u = se(o, t - 1).text), null, a)),
                  (u = d ? "" : u.match(/^\s*/)[0]))
                : (c = 0)
              : "add" == n
              ? (c = l + e.options.indentUnit)
              : "subtract" == n
              ? (c = l - e.options.indentUnit)
              : "number" == typeof n && (c = l + n),
            (c = Math.max(0, c)),
            u && !d)
          );
          else {
            if (((u = ""), e.options.indentWithTabs))
              for (var p = Math.floor(c / a); p; --p) (h += a), (u += "\t");
            h < c && (u += K(c - h));
          }
          if (u != d)
            return (
              lo(o, u, me(t, 0), me(t, d.length), "+input"),
              (s.stateAfter = null),
              !0
            );
          for (var f = 0; f < o.sel.ranges.length; f++) {
            var m = o.sel.ranges[f];
            if (m.head.line == t && m.head.ch < d.length) {
              var g = me(t, d.length);
              Wr(o, f, new mr(g, g));
              break;
            }
          }
        }
        ma.defineInitHook = function (e) {
          return ga.push(e);
        };
        var ya = null;
        function ba(e) {
          ya = e;
        }
        function wa(e, t, n, i, r) {
          var o = e.doc;
          (e.display.shift = !1), i || (i = o.sel);
          var a,
            s = e.state.pasteIncoming || "paste" == r,
            l = Ft(t),
            c = null;
          if (s && i.ranges.length > 1)
            if (ya && ya.text.join("\n") == t) {
              if (i.ranges.length % ya.text.length == 0) {
                c = [];
                for (var d = 0; d < ya.text.length; d++)
                  c.push(o.splitLines(ya.text[d]));
              }
            } else
              l.length == i.ranges.length &&
                (c = G(l, function (e) {
                  return [e];
                }));
          for (var u = i.ranges.length - 1; u >= 0; u--) {
            var h = i.ranges[u],
              p = h.from(),
              f = h.to();
            h.empty() &&
              (n && n > 0
                ? (p = me(p.line, p.ch - n))
                : e.state.overwrite && !s
                ? (f = me(
                    f.line,
                    Math.min(se(o, f.line).text.length, f.ch + Y(l).length)
                  ))
                : ya &&
                  ya.lineWise &&
                  ya.text.join("\n") == t &&
                  (p = f = me(p.line, 0))),
              (a = e.curOp.updateInput);
            var m = {
              from: p,
              to: f,
              text: c ? c[u % c.length] : l,
              origin:
                r || (s ? "paste" : e.state.cutIncoming ? "cut" : "+input"),
            };
            io(e.doc, m), ln(e, "inputRead", e, m);
          }
          t && !s && Ca(e, t),
            Fi(e),
            (e.curOp.updateInput = a),
            (e.curOp.typing = !0),
            (e.state.pasteIncoming = e.state.cutIncoming = !1);
        }
        function xa(e, t) {
          var n = e.clipboardData && e.clipboardData.getData("Text");
          if (n)
            return (
              e.preventDefault(),
              t.isReadOnly() ||
                t.options.disableInput ||
                Wi(t, function () {
                  return wa(t, n, 0, null, "paste");
                }),
              !0
            );
        }
        function Ca(e, t) {
          if (e.options.electricChars && e.options.smartIndent)
            for (var n = e.doc.sel, i = n.ranges.length - 1; i >= 0; i--) {
              var r = n.ranges[i];
              if (
                !(
                  r.head.ch > 100 ||
                  (i && n.ranges[i - 1].head.line == r.head.line)
                )
              ) {
                var o = e.getModeAt(r.head),
                  a = !1;
                if (o.electricChars) {
                  for (var s = 0; s < o.electricChars.length; s++)
                    if (t.indexOf(o.electricChars.charAt(s)) > -1) {
                      a = va(e, r.head.line, "smart");
                      break;
                    }
                } else
                  o.electricInput &&
                    o.electricInput.test(
                      se(e.doc, r.head.line).text.slice(0, r.head.ch)
                    ) &&
                    (a = va(e, r.head.line, "smart"));
                a && ln(e, "electricInput", e, r.head.line);
              }
            }
        }
        function Fa(e) {
          for (var t = [], n = [], i = 0; i < e.doc.sel.ranges.length; i++) {
            var r = e.doc.sel.ranges[i].head.line,
              o = { anchor: me(r, 0), head: me(r + 1, 0) };
            n.push(o), t.push(e.getRange(o.anchor, o.head));
          }
          return { text: t, ranges: n };
        }
        function Sa(e, t) {
          e.setAttribute("autocorrect", "off"),
            e.setAttribute("autocapitalize", "off"),
            e.setAttribute("spellcheck", !!t);
        }
        function ka() {
          var e = A(
              "textarea",
              null,
              null,
              "position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"
            ),
            t = A(
              "div",
              [e],
              null,
              "overflow: hidden; position: relative; width: 3px; height: 0px;"
            );
          return (
            l ? (e.style.width = "1000px") : e.setAttribute("wrap", "off"),
            m && (e.style.border = "1px solid black"),
            Sa(e),
            t
          );
        }
        function Ea(e, t, n, i, r) {
          var o = t,
            a = n,
            s = se(e, t.line);
          function l(i) {
            var o, a;
            if (null == (o = r ? tt(e.cm, s, t, n) : Ze(s, t, n))) {
              if (
                i ||
                (a = t.line + n) < e.first ||
                a >= e.first + e.size ||
                ((t = new me(a, t.ch, t.sticky)), !(s = se(e, a)))
              )
                return !1;
              t = et(r, e.cm, s, t.line, n);
            } else t = o;
            return !0;
          }
          if ("char" == i) l();
          else if ("column" == i) l(!0);
          else if ("word" == i || "group" == i)
            for (
              var c = null,
                d = "group" == i,
                u = e.cm && e.cm.getHelper(t, "wordChars"),
                h = !0;
              !(n < 0) || l(!h);
              h = !1
            ) {
              var p = s.text.charAt(t.ch) || "\n",
                f = te(p, u)
                  ? "w"
                  : d && "\n" == p
                  ? "n"
                  : !d || /\s/.test(p)
                  ? null
                  : "p";
              if ((!d || h || f || (f = "s"), c && c != f)) {
                n < 0 && ((n = 1), l(), (t.sticky = "after"));
                break;
              }
              if ((f && (c = f), n > 0 && !l(!h))) break;
            }
          var m = Zr(e, t, o, a, !0);
          return ve(o, m) && (m.hitSide = !0), m;
        }
        function Ta(e, t, n, i) {
          var r,
            o,
            a = e.doc,
            s = t.left;
          if ("page" == i) {
            var l = Math.min(
                e.display.wrapper.clientHeight,
                window.innerHeight || document.documentElement.clientHeight
              ),
              c = Math.max(l - 0.5 * Zn(e.display), 3);
            r = (n > 0 ? t.bottom : t.top) + n * c;
          } else "line" == i && (r = n > 0 ? t.bottom + 3 : t.top - 3);
          for (; (o = Yn(e, s, r)).outside; ) {
            if (n < 0 ? r <= 0 : r >= a.height) {
              o.hitSide = !0;
              break;
            }
            r += 5 * n;
          }
          return o;
        }
        var _a = function (e) {
          (this.cm = e),
            (this.lastAnchorNode =
              this.lastAnchorOffset =
              this.lastFocusNode =
              this.lastFocusOffset =
                null),
            (this.polling = new $()),
            (this.composing = null),
            (this.gracePeriod = !1),
            (this.readDOMTimeout = null);
        };
        function Aa(e, t) {
          var n = Ln(e, t.line);
          if (!n || n.hidden) return null;
          var i = se(e.doc, t.line),
            r = An(n, i, t.line),
            o = Qe(i, e.doc.direction),
            a = "left";
          o && (a = Ye(o, t.ch) % 2 ? "right" : "left");
          var s = Pn(r.map, t.ch, a);
          return (s.offset = "right" == s.collapse ? s.end : s.start), s;
        }
        function Ma(e, t) {
          return t && (e.bad = !0), e;
        }
        function La(e, t, n) {
          var i;
          if (t == e.display.lineDiv) {
            if (!(i = e.display.lineDiv.childNodes[n]))
              return Ma(e.clipPos(me(e.display.viewTo - 1)), !0);
            (t = null), (n = 0);
          } else
            for (i = t; ; i = i.parentNode) {
              if (!i || i == e.display.lineDiv) return null;
              if (i.parentNode && i.parentNode == e.display.lineDiv) break;
            }
          for (var r = 0; r < e.display.view.length; r++) {
            var o = e.display.view[r];
            if (o.node == i) return Na(o, t, n);
          }
        }
        function Na(e, t, n) {
          var i = e.text.firstChild,
            r = !1;
          if (!t || !L(i, t)) return Ma(me(ue(e.line), 0), !0);
          if (t == i && ((r = !0), (t = i.childNodes[n]), (n = 0), !t)) {
            var o = e.rest ? Y(e.rest) : e.line;
            return Ma(me(ue(o), o.text.length), r);
          }
          var a = 3 == t.nodeType ? t : null,
            s = t;
          for (
            a ||
            1 != t.childNodes.length ||
            3 != t.firstChild.nodeType ||
            ((a = t.firstChild), n && (n = a.nodeValue.length));
            s.parentNode != i;

          )
            s = s.parentNode;
          var l = e.measure,
            c = l.maps;
          function d(t, n, i) {
            for (var r = -1; r < (c ? c.length : 0); r++)
              for (var o = r < 0 ? l.map : c[r], a = 0; a < o.length; a += 3) {
                var s = o[a + 2];
                if (s == t || s == n) {
                  var d = ue(r < 0 ? e.line : e.rest[r]),
                    u = o[a] + i;
                  return (
                    (i < 0 || s != t) && (u = o[a + (i ? 1 : 0)]), me(d, u)
                  );
                }
              }
          }
          var u = d(a, s, n);
          if (u) return Ma(u, r);
          for (
            var h = s.nextSibling, p = a ? a.nodeValue.length - n : 0;
            h;
            h = h.nextSibling
          ) {
            if ((u = d(h, h.firstChild, 0))) return Ma(me(u.line, u.ch - p), r);
            p += h.textContent.length;
          }
          for (var f = s.previousSibling, m = n; f; f = f.previousSibling) {
            if ((u = d(f, f.firstChild, -1)))
              return Ma(me(u.line, u.ch + m), r);
            m += f.textContent.length;
          }
        }
        (_a.prototype.init = function (e) {
          var t = this,
            n = this,
            i = n.cm,
            r = (n.div = e.lineDiv);
          function o(e) {
            if (!st(i, e)) {
              if (i.somethingSelected())
                ba({ lineWise: !1, text: i.getSelections() }),
                  "cut" == e.type && i.replaceSelection("", null, "cut");
              else {
                if (!i.options.lineWiseCopyCut) return;
                var t = Fa(i);
                ba({ lineWise: !0, text: t.text }),
                  "cut" == e.type &&
                    i.operation(function () {
                      i.setSelections(t.ranges, 0, q),
                        i.replaceSelection("", null, "cut");
                    });
              }
              if (e.clipboardData) {
                e.clipboardData.clearData();
                var o = ya.text.join("\n");
                if (
                  (e.clipboardData.setData("Text", o),
                  e.clipboardData.getData("Text") == o)
                )
                  return void e.preventDefault();
              }
              var a = ka(),
                s = a.firstChild;
              i.display.lineSpace.insertBefore(
                a,
                i.display.lineSpace.firstChild
              ),
                (s.value = ya.text.join("\n"));
              var l = document.activeElement;
              R(s),
                setTimeout(function () {
                  i.display.lineSpace.removeChild(a),
                    l.focus(),
                    l == r && n.showPrimarySelection();
                }, 50);
            }
          }
          Sa(r, i.options.spellcheck),
            it(r, "paste", function (e) {
              st(i, e) ||
                xa(e, i) ||
                (s <= 11 &&
                  setTimeout(
                    zi(i, function () {
                      return t.updateFromDOM();
                    }),
                    20
                  ));
            }),
            it(r, "compositionstart", function (e) {
              t.composing = { data: e.data, done: !1 };
            }),
            it(r, "compositionupdate", function (e) {
              t.composing || (t.composing = { data: e.data, done: !1 });
            }),
            it(r, "compositionend", function (e) {
              t.composing &&
                (e.data != t.composing.data && t.readFromDOMSoon(),
                (t.composing.done = !0));
            }),
            it(r, "touchstart", function () {
              return n.forceCompositionEnd();
            }),
            it(r, "input", function () {
              t.composing || t.readFromDOMSoon();
            }),
            it(r, "copy", o),
            it(r, "cut", o);
        }),
          (_a.prototype.prepareSelection = function () {
            var e = li(this.cm, !1);
            return (e.focus = this.cm.state.focused), e;
          }),
          (_a.prototype.showSelection = function (e, t) {
            e &&
              this.cm.display.view.length &&
              ((e.focus || t) && this.showPrimarySelection(),
              this.showMultipleSelections(e));
          }),
          (_a.prototype.showPrimarySelection = function () {
            var e = window.getSelection(),
              t = this.cm,
              i = t.doc.sel.primary(),
              r = i.from(),
              o = i.to();
            if (
              t.display.viewTo == t.display.viewFrom ||
              r.line >= t.display.viewTo ||
              o.line < t.display.viewFrom
            )
              e.removeAllRanges();
            else {
              var a = La(t, e.anchorNode, e.anchorOffset),
                s = La(t, e.focusNode, e.focusOffset);
              if (
                !a ||
                a.bad ||
                !s ||
                s.bad ||
                0 != ge(we(a, s), r) ||
                0 != ge(be(a, s), o)
              ) {
                var l = t.display.view,
                  c = (r.line >= t.display.viewFrom && Aa(t, r)) || {
                    node: l[0].measure.map[2],
                    offset: 0,
                  },
                  d = o.line < t.display.viewTo && Aa(t, o);
                if (!d) {
                  var u = l[l.length - 1].measure,
                    h = u.maps ? u.maps[u.maps.length - 1] : u.map;
                  d = {
                    node: h[h.length - 1],
                    offset: h[h.length - 2] - h[h.length - 3],
                  };
                }
                if (c && d) {
                  var p,
                    f = e.rangeCount && e.getRangeAt(0);
                  try {
                    p = k(c.node, c.offset, d.offset, d.node);
                  } catch (e) {}
                  p &&
                    (!n && t.state.focused
                      ? (e.collapse(c.node, c.offset),
                        p.collapsed || (e.removeAllRanges(), e.addRange(p)))
                      : (e.removeAllRanges(), e.addRange(p)),
                    f && null == e.anchorNode
                      ? e.addRange(f)
                      : n && this.startGracePeriod()),
                    this.rememberSelection();
                } else e.removeAllRanges();
              }
            }
          }),
          (_a.prototype.startGracePeriod = function () {
            var e = this;
            clearTimeout(this.gracePeriod),
              (this.gracePeriod = setTimeout(function () {
                (e.gracePeriod = !1),
                  e.selectionChanged() &&
                    e.cm.operation(function () {
                      return (e.cm.curOp.selectionChanged = !0);
                    });
              }, 20));
          }),
          (_a.prototype.showMultipleSelections = function (e) {
            _(this.cm.display.cursorDiv, e.cursors),
              _(this.cm.display.selectionDiv, e.selection);
          }),
          (_a.prototype.rememberSelection = function () {
            var e = window.getSelection();
            (this.lastAnchorNode = e.anchorNode),
              (this.lastAnchorOffset = e.anchorOffset),
              (this.lastFocusNode = e.focusNode),
              (this.lastFocusOffset = e.focusOffset);
          }),
          (_a.prototype.selectionInEditor = function () {
            var e = window.getSelection();
            if (!e.rangeCount) return !1;
            var t = e.getRangeAt(0).commonAncestorContainer;
            return L(this.div, t);
          }),
          (_a.prototype.focus = function () {
            "nocursor" != this.cm.options.readOnly &&
              (this.selectionInEditor() ||
                this.showSelection(this.prepareSelection(), !0),
              this.div.focus());
          }),
          (_a.prototype.blur = function () {
            this.div.blur();
          }),
          (_a.prototype.getField = function () {
            return this.div;
          }),
          (_a.prototype.supportsTouch = function () {
            return !0;
          }),
          (_a.prototype.receivedFocus = function () {
            var e = this;
            this.selectionInEditor()
              ? this.pollSelection()
              : Wi(this.cm, function () {
                  return (e.cm.curOp.selectionChanged = !0);
                }),
              this.polling.set(this.cm.options.pollInterval, function t() {
                e.cm.state.focused &&
                  (e.pollSelection(),
                  e.polling.set(e.cm.options.pollInterval, t));
              });
          }),
          (_a.prototype.selectionChanged = function () {
            var e = window.getSelection();
            return (
              e.anchorNode != this.lastAnchorNode ||
              e.anchorOffset != this.lastAnchorOffset ||
              e.focusNode != this.lastFocusNode ||
              e.focusOffset != this.lastFocusOffset
            );
          }),
          (_a.prototype.pollSelection = function () {
            if (
              null == this.readDOMTimeout &&
              !this.gracePeriod &&
              this.selectionChanged()
            ) {
              var e = window.getSelection(),
                t = this.cm;
              if (
                g &&
                d &&
                this.cm.options.gutters.length &&
                (function (e) {
                  for (var t = e; t; t = t.parentNode)
                    if (/CodeMirror-gutter-wrapper/.test(t.className))
                      return !0;
                  return !1;
                })(e.anchorNode)
              )
                return (
                  this.cm.triggerOnKeyDown({
                    type: "keydown",
                    keyCode: 8,
                    preventDefault: Math.abs,
                  }),
                  this.blur(),
                  void this.focus()
                );
              if (!this.composing) {
                this.rememberSelection();
                var n = La(t, e.anchorNode, e.anchorOffset),
                  i = La(t, e.focusNode, e.focusOffset);
                n &&
                  i &&
                  Wi(t, function () {
                    Jr(t.doc, vr(n, i), q),
                      (n.bad || i.bad) && (t.curOp.selectionChanged = !0);
                  });
              }
            }
          }),
          (_a.prototype.pollContent = function () {
            null != this.readDOMTimeout &&
              (clearTimeout(this.readDOMTimeout), (this.readDOMTimeout = null));
            var e,
              t,
              n,
              i = this.cm,
              r = i.display,
              o = i.doc.sel.primary(),
              a = o.from(),
              s = o.to();
            if (
              (0 == a.ch &&
                a.line > i.firstLine() &&
                (a = me(a.line - 1, se(i.doc, a.line - 1).length)),
              s.ch == se(i.doc, s.line).text.length &&
                s.line < i.lastLine() &&
                (s = me(s.line + 1, 0)),
              a.line < r.viewFrom || s.line > r.viewTo - 1)
            )
              return !1;
            a.line == r.viewFrom || 0 == (e = ai(i, a.line))
              ? ((t = ue(r.view[0].line)), (n = r.view[0].node))
              : ((t = ue(r.view[e].line)),
                (n = r.view[e - 1].node.nextSibling));
            var l,
              c,
              d = ai(i, s.line);
            if (
              (d == r.view.length - 1
                ? ((l = r.viewTo - 1), (c = r.lineDiv.lastChild))
                : ((l = ue(r.view[d + 1].line) - 1),
                  (c = r.view[d + 1].node.previousSibling)),
              !n)
            )
              return !1;
            for (
              var u = i.doc.splitLines(
                  (function (e, t, n, i, r) {
                    var o = "",
                      a = !1,
                      s = e.doc.lineSeparator();
                    function l() {
                      a && ((o += s), (a = !1));
                    }
                    function c(e) {
                      e && (l(), (o += e));
                    }
                    function d(t) {
                      if (1 == t.nodeType) {
                        var n = t.getAttribute("cm-text");
                        if (null != n)
                          return void c(
                            n || t.textContent.replace(/\u200b/g, "")
                          );
                        var o,
                          u = t.getAttribute("cm-marker");
                        if (u) {
                          var h = e.findMarks(
                            me(i, 0),
                            me(r + 1, 0),
                            ((m = +u),
                            function (e) {
                              return e.id == m;
                            })
                          );
                          return void (
                            h.length &&
                            (o = h[0].find()) &&
                            c(le(e.doc, o.from, o.to).join(s))
                          );
                        }
                        if ("false" == t.getAttribute("contenteditable"))
                          return;
                        var p = /^(pre|div|p)$/i.test(t.nodeName);
                        p && l();
                        for (var f = 0; f < t.childNodes.length; f++)
                          d(t.childNodes[f]);
                        p && (a = !0);
                      } else 3 == t.nodeType && c(t.nodeValue);
                      var m;
                    }
                    for (; d(t), t != n; ) t = t.nextSibling;
                    return o;
                  })(i, n, c, t, l)
                ),
                h = le(i.doc, me(t, 0), me(l, se(i.doc, l).text.length));
              u.length > 1 && h.length > 1;

            )
              if (Y(u) == Y(h)) u.pop(), h.pop(), l--;
              else {
                if (u[0] != h[0]) break;
                u.shift(), h.shift(), t++;
              }
            for (
              var p = 0,
                f = 0,
                m = u[0],
                g = h[0],
                v = Math.min(m.length, g.length);
              p < v && m.charCodeAt(p) == g.charCodeAt(p);

            )
              ++p;
            for (
              var y = Y(u),
                b = Y(h),
                w = Math.min(
                  y.length - (1 == u.length ? p : 0),
                  b.length - (1 == h.length ? p : 0)
                );
              f < w &&
              y.charCodeAt(y.length - f - 1) == b.charCodeAt(b.length - f - 1);

            )
              ++f;
            if (1 == u.length && 1 == h.length && t == a.line)
              for (
                ;
                p &&
                p > a.ch &&
                y.charCodeAt(y.length - f - 1) ==
                  b.charCodeAt(b.length - f - 1);

              )
                p--, f++;
            (u[u.length - 1] = y
              .slice(0, y.length - f)
              .replace(/^\u200b+/, "")),
              (u[0] = u[0].slice(p).replace(/\u200b+$/, ""));
            var x = me(t, p),
              C = me(l, h.length ? Y(h).length - f : 0);
            return u.length > 1 || u[0] || ge(x, C)
              ? (lo(i.doc, u, x, C, "+input"), !0)
              : void 0;
          }),
          (_a.prototype.ensurePolled = function () {
            this.forceCompositionEnd();
          }),
          (_a.prototype.reset = function () {
            this.forceCompositionEnd();
          }),
          (_a.prototype.forceCompositionEnd = function () {
            this.composing &&
              (clearTimeout(this.readDOMTimeout),
              (this.composing = null),
              this.updateFromDOM(),
              this.div.blur(),
              this.div.focus());
          }),
          (_a.prototype.readFromDOMSoon = function () {
            var e = this;
            null == this.readDOMTimeout &&
              (this.readDOMTimeout = setTimeout(function () {
                if (((e.readDOMTimeout = null), e.composing)) {
                  if (!e.composing.done) return;
                  e.composing = null;
                }
                e.updateFromDOM();
              }, 80));
          }),
          (_a.prototype.updateFromDOM = function () {
            var e = this;
            (!this.cm.isReadOnly() && this.pollContent()) ||
              Wi(this.cm, function () {
                return Ki(e.cm);
              });
          }),
          (_a.prototype.setUneditable = function (e) {
            e.contentEditable = "false";
          }),
          (_a.prototype.onKeyPress = function (e) {
            0 != e.charCode &&
              (e.preventDefault(),
              this.cm.isReadOnly() ||
                zi(this.cm, wa)(
                  this.cm,
                  String.fromCharCode(
                    null == e.charCode ? e.keyCode : e.charCode
                  ),
                  0
                ));
          }),
          (_a.prototype.readOnlyChanged = function (e) {
            this.div.contentEditable = String("nocursor" != e);
          }),
          (_a.prototype.onContextMenu = function () {}),
          (_a.prototype.resetPosition = function () {}),
          (_a.prototype.needsContentAttribute = !0);
        var Da = function (e) {
          (this.cm = e),
            (this.prevInput = ""),
            (this.pollingFast = !1),
            (this.polling = new $()),
            (this.inaccurateSelection = !1),
            (this.hasSelection = !1),
            (this.composing = null);
        };
        (Da.prototype.init = function (e) {
          var t = this,
            n = this,
            i = this.cm,
            r = (this.wrapper = ka()),
            o = (this.textarea = r.firstChild);
          function l(e) {
            if (!st(i, e)) {
              if (i.somethingSelected())
                ba({ lineWise: !1, text: i.getSelections() }),
                  n.inaccurateSelection &&
                    ((n.prevInput = ""),
                    (n.inaccurateSelection = !1),
                    (o.value = ya.text.join("\n")),
                    R(o));
              else {
                if (!i.options.lineWiseCopyCut) return;
                var t = i.getCursor(),
                  r = Fa(i);
                if ((ba({ lineWise: !0, text: r.text }), "cut" == e.type)) {
                  if (e.clipboardData) {
                    e.clipboardData.clearData();
                    var a = ya.text.join("\n");
                    if (
                      (e.clipboardData.setData("Text", a),
                      e.clipboardData.getData("Text") == a)
                    )
                      return (
                        e.preventDefault(),
                        i.cid &&
                          i.editor.undo.register({
                            undo: [{ type: "fences-pos", id: i.cid, pos: t }],
                            redo: [],
                          }),
                        void i.replaceRange(
                          "",
                          r.ranges[0].anchor,
                          r.ranges[0].head,
                          "cut-line"
                        )
                      );
                  }
                  i.setSelections(r.ranges, null, q);
                } else (n.prevInput = ""), (o.value = r.text.join("\n")), R(o);
              }
              "cut" == e.type && (i.state.cutIncoming = !0);
            }
          }
          e.wrapper.insertBefore(r, e.wrapper.firstChild),
            m && (o.style.width = "0px"),
            it(o, "input", function () {
              a && s >= 9 && t.hasSelection && (t.hasSelection = null),
                n.poll();
            }),
            it(o, "paste", function (e) {
              st(i, e) ||
                xa(e, i) ||
                ((i.state.pasteIncoming = !0), n.fastPoll());
            }),
            it(o, "cut", l),
            it(o, "copy", l),
            it(e.scroller, "paste", function (t) {
              Cn(e, t) || st(i, t) || ((i.state.pasteIncoming = !0), n.focus());
            }),
            it(e.lineSpace, "selectstart", function (t) {
              Cn(e, t) || ut(t);
            }),
            it(o, "compositionstart", function () {
              if (!(i.getSelections().length > 1)) {
                var e = i.getCursor("from");
                n.composing && n.composing.range.clear(),
                  (n.composing = {
                    start: e,
                    range: i.markText(e, i.getCursor("to"), {
                      className: "CodeMirror-composing",
                    }),
                  });
              }
            }),
            it(o, "compositionend", function () {
              n.composing &&
                (n.poll(), n.composing.range.clear(), (n.composing = null));
            });
        }),
          (Da.prototype.prepareSelection = function () {
            var e = this.cm,
              t = e.display,
              n = e.doc,
              i = li(e);
            if (e.options.moveInputWithCursor) {
              var r = Vn(e, n.sel.primary().head, "div"),
                o = t.wrapper.getBoundingClientRect(),
                a = t.lineDiv.getBoundingClientRect();
              (i.teTop = Math.max(
                0,
                Math.min(
                  t.wrapper.clientHeight - 10,
                  (r.bottom + r.top) / 2 - 2 + a.top - o.top
                )
              )),
                (i.teLeft = Math.max(
                  0,
                  Math.min(t.wrapper.clientWidth - 10, r.left + a.left - o.left)
                ));
            }
            return i;
          }),
          (Da.prototype.showSelection = function (e) {
            var t = this.cm.display;
            _(t.cursorDiv, e.cursors),
              _(t.selectionDiv, e.selection),
              null != e.teTop &&
                ((this.wrapper.style.top = e.teTop + "px"),
                (this.wrapper.style.left = e.teLeft + "px"));
          }),
          (Da.prototype.reset = function (e) {
            if (!this.contextMenuPending && !this.composing) {
              var t,
                n,
                i = this.cm,
                r = i.doc;
              if (i.somethingSelected()) {
                this.prevInput = "";
                var o = r.sel.primary(),
                  l = (t =
                    kt &&
                    (o.to().line - o.from().line > 100 ||
                      (n = i.getSelection()).length > 1e3))
                    ? "-"
                    : n || i.getSelection();
                (this.textarea.value = l),
                  i.state.focused && R(this.textarea),
                  a && s >= 9 && (this.hasSelection = l);
              } else
                e ||
                  ((this.prevInput = this.textarea.value = ""),
                  a && s >= 9 && (this.hasSelection = null));
              this.inaccurateSelection = t;
            }
          }),
          (Da.prototype.getField = function () {
            return this.textarea;
          }),
          (Da.prototype.supportsTouch = function () {
            return !1;
          }),
          (Da.prototype.focus = function () {
            if (
              "nocursor" != this.cm.options.readOnly &&
              (!v || N() != this.textarea)
            )
              try {
                this.textarea.focus();
              } catch (e) {}
          }),
          (Da.prototype.blur = function () {
            this.textarea.blur();
          }),
          (Da.prototype.resetPosition = function () {
            this.wrapper.style.top = this.wrapper.style.left = 0;
          }),
          (Da.prototype.receivedFocus = function () {
            this.slowPoll();
          }),
          (Da.prototype.slowPoll = function () {
            var e = this;
            this.pollingFast ||
              this.polling.set(this.cm.options.pollInterval, function () {
                e.poll(), e.cm.state.focused && e.slowPoll();
              });
          }),
          (Da.prototype.fastPoll = function () {
            var e = !1,
              t = this;
            (t.pollingFast = !0),
              t.polling.set(20, function n() {
                t.poll() || e
                  ? ((t.pollingFast = !1), t.slowPoll())
                  : ((e = !0), t.polling.set(60, n));
              });
          }),
          (Da.prototype.poll = function () {
            var e = this,
              t = this.cm,
              n = this.textarea,
              i = this.prevInput;
            if (
              this.contextMenuPending ||
              !t.state.focused ||
              (St(n) && !i && !this.composing) ||
              t.isReadOnly() ||
              t.options.disableInput ||
              t.state.keySeq
            )
              return !1;
            var r = n.value;
            if (r == i && !t.somethingSelected()) return !1;
            if (
              (a && s >= 9 && this.hasSelection === r) ||
              (y && /[\uf700-\uf7ff]/.test(r))
            )
              return t.display.input.reset(), !1;
            if (t.doc.sel == t.display.selForContextMenu) {
              var o = r.charCodeAt(0);
              if ((8203 != o || i || (i = "​"), 8666 == o))
                return this.reset(), this.cm.execCommand("undo");
            }
            for (
              var l = 0, c = Math.min(i.length, r.length);
              l < c && i.charCodeAt(l) == r.charCodeAt(l);

            )
              ++l;
            return (
              Wi(t, function () {
                wa(
                  t,
                  r.slice(l),
                  i.length - l,
                  null,
                  e.composing ? "*compose" : null
                ),
                  r.length > 1e3 || r.indexOf("\n") > -1
                    ? (n.value = e.prevInput = "")
                    : (e.prevInput = r),
                  e.composing &&
                    (e.composing.range.clear(),
                    (e.composing.range = t.markText(
                      e.composing.start,
                      t.getCursor("to"),
                      { className: "CodeMirror-composing" }
                    )));
              }),
              !0
            );
          }),
          (Da.prototype.ensurePolled = function () {
            this.pollingFast && this.poll() && (this.pollingFast = !1);
          }),
          (Da.prototype.onKeyPress = function () {
            a && s >= 9 && (this.hasSelection = null), this.fastPoll();
          }),
          (Da.prototype.onContextMenu = function (e) {
            var t = this,
              n = t.cm,
              i = n.display,
              r = t.textarea,
              o = oi(n, e),
              c = i.scroller.scrollTop;
            if (o && !u) {
              var d,
                h = document.querySelector("content");
              if (
                (l && (d = h ? h.scrollTop : window.scrollY),
                n.options.resetSelectionOnContextMenu &&
                  -1 == n.doc.sel.contains(o))
              )
                if (File.isMac) {
                  var p = n.findWordAt(o);
                  zi(n, Jr)(n.doc, vr(p.anchor, p.head), q);
                } else zi(n, Jr)(n.doc, vr(o), q);
              var f = r.style.cssText,
                m = t.wrapper.style.cssText;
              t.wrapper.style.cssText = "position: absolute";
              var g = t.wrapper.getBoundingClientRect();
              if (
                ((r.style.cssText =
                  "position: absolute; width: 30px; height: 30px;\n      top: " +
                  (e.clientY - g.top - 5) +
                  "px; left: " +
                  (e.clientX - g.left - 5) +
                  "px;\n      z-index: 1000; background: " +
                  (a ? "rgba(255, 255, 255, .05)" : "transparent") +
                  ";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);"),
                i.input.focus(),
                l &&
                  setTimeout(() => {
                    (h || window).scrollTop = d;
                  }, 0),
                i.input.reset(),
                n.somethingSelected() || (r.value = t.prevInput = " "),
                (t.contextMenuPending = !0),
                (i.selForContextMenu = n.doc.sel),
                clearTimeout(i.detectingSelectAll),
                a && s >= 9 && y(),
                F)
              ) {
                ft(e);
                var v = function () {
                  ot(window, "mouseup", v), setTimeout(b, 20);
                };
                it(window, "mouseup", v);
              } else setTimeout(b, 50);
            }
            function y() {
              if (null != r.selectionStart) {
                var e = n.somethingSelected(),
                  o = "​" + (e ? r.value : "");
                (r.value = "⇚"),
                  (r.value = o),
                  (t.prevInput = e ? "" : "​"),
                  (r.selectionStart = 1),
                  (r.selectionEnd = o.length),
                  (i.selForContextMenu = n.doc.sel);
              }
            }
            function b() {
              if (
                ((t.contextMenuPending = !1),
                (t.wrapper.style.cssText = m),
                (r.style.cssText = f),
                a &&
                  s < 9 &&
                  i.scrollbars.setScrollTop((i.scroller.scrollTop = c)),
                null != r.selectionStart)
              ) {
                (!a || (a && s < 9)) && y();
                var e = 0,
                  o = function () {
                    i.selForContextMenu == n.doc.sel &&
                    0 == r.selectionStart &&
                    r.selectionEnd > 0 &&
                    "​" == t.prevInput
                      ? zi(n, to)(n)
                      : e++ < 10
                      ? (i.detectingSelectAll = setTimeout(o, 500))
                      : ((i.selForContextMenu = null), i.input.reset());
                  };
                i.detectingSelectAll = setTimeout(o, 200);
              }
            }
          }),
          (Da.prototype.readOnlyChanged = function (e) {
            e || this.reset();
          }),
          (Da.prototype.setUneditable = function () {}),
          (Da.prototype.needsContentAttribute = !1),
          (function (e) {
            var t = e.optionHandlers;
            function n(n, i, r, o) {
              (e.defaults[n] = i),
                r &&
                  (t[n] = o
                    ? function (e, t, n) {
                        n != ca && r(e, t, n);
                      }
                    : r);
            }
            (e.defineOption = n),
              (e.Init = ca),
              n(
                "value",
                "",
                function (e, t) {
                  return e.setValue(t);
                },
                !0
              ),
              n(
                "mode",
                null,
                function (e, t) {
                  (e.doc.modeOption = t), Cr(e);
                },
                !0
              ),
              n("indentUnit", 2, Cr, !0),
              n("indentWithTabs", !1),
              n("smartIndent", !0),
              n(
                "tabSize",
                4,
                function (e) {
                  Fr(e), Hn(e), Ki(e);
                },
                !0
              ),
              n("lineSeparator", null, function (e, t) {
                if (((e.doc.lineSep = t), t)) {
                  var n = [],
                    i = e.doc.first;
                  e.doc.iter(function (e) {
                    for (var r = 0; ; ) {
                      var o = e.text.indexOf(t, r);
                      if (-1 == o) break;
                      (r = o + t.length), n.push(me(i, o));
                    }
                    i++;
                  });
                  for (var r = n.length - 1; r >= 0; r--)
                    lo(e.doc, t, n[r], me(n[r].line, n[r].ch + t.length));
                }
              }),
              n(
                "specialChars",
                /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,
                function (e, t, n) {
                  (e.state.specialChars = new RegExp(
                    t.source + (t.test("\t") ? "" : "|\t"),
                    "g"
                  )),
                    n != ca && e.refresh();
                }
              ),
              n(
                "specialCharPlaceholder",
                Xt,
                function (e) {
                  return e.refresh();
                },
                !0
              ),
              n("electricChars", !0),
              n(
                "inputStyle",
                v ? "contenteditable" : "textarea",
                function () {
                  throw new Error(
                    "inputStyle can not (yet) be changed in a running editor"
                  );
                },
                !0
              ),
              n(
                "spellcheck",
                !1,
                function (e, t) {
                  return (e.getInputField().spellcheck = t);
                },
                !0
              ),
              n("rtlMoveVisually", !w),
              n("wholeLineUpdateBefore", !0),
              n(
                "theme",
                "default",
                function (e) {
                  la(e), ha(e);
                },
                !0
              ),
              n("keyMap", "default", function (e, t, n) {
                var i = qo(t),
                  r = n != ca && qo(n);
                r && r.detach && r.detach(e, i),
                  i.attach && i.attach(e, r || null);
              }),
              n("extraKeys", null),
              n("lineWrapping", !1, fa, !0),
              n(
                "gutters",
                [],
                function (e) {
                  lr(e.options), ha(e);
                },
                !0
              ),
              n(
                "fixedGutter",
                !0,
                function (e, t) {
                  (e.display.gutters.style.left = t
                    ? ni(e.display) + "px"
                    : "0"),
                    e.refresh();
                },
                !0
              ),
              n(
                "coverGutterNextToScrollbar",
                !1,
                function (e) {
                  return Di(e);
                },
                !0
              ),
              n(
                "scrollbarStyle",
                "native",
                function (e) {
                  Pi(e),
                    Di(e),
                    e.display.scrollbars.setScrollTop(e.doc.scrollTop),
                    e.display.scrollbars.setScrollLeft(e.doc.scrollLeft);
                },
                !0
              ),
              n(
                "lineNumbers",
                !1,
                function (e) {
                  lr(e.options), ha(e);
                },
                !0
              ),
              n("firstLineNumber", 1, ha, !0),
              n(
                "lineNumberFormatter",
                function (e) {
                  return e;
                },
                ha,
                !0
              ),
              n("showCursorWhenSelecting", !1, si, !0),
              n("resetSelectionOnContextMenu", !0),
              n("lineWiseCopyCut", !0),
              n("readOnly", !1, function (e, t) {
                "nocursor" == t
                  ? (mi(e), e.display.input.blur(), (e.display.disabled = !0))
                  : (e.display.disabled = !1),
                  e.display.input.readOnlyChanged(t);
              }),
              n(
                "disableInput",
                !1,
                function (e, t) {
                  t || e.display.input.reset();
                },
                !0
              ),
              n("dragDrop", !0, pa),
              n("allowDropFileTypes", null),
              n("cursorBlinkRate", 530),
              n("cursorScrollMargin", 0),
              n("cursorHeight", 1, si, !0),
              n("singleCursorHeightPerLine", !0, si, !0),
              n("workTime", 100),
              n("workDelay", 100),
              n("flattenSpans", !0, Fr, !0),
              n("addModeClass", !1, Fr, !0),
              n("pollInterval", 100),
              n("undoDepth", 200, function (e, t) {
                return (e.doc.history.undoDepth = t);
              }),
              n("historyEventDelay", 1250),
              n(
                "viewportMargin",
                10,
                function (e) {
                  return e.refresh();
                },
                !0
              ),
              n("maxHighlightLength", 1e4, Fr, !0),
              n("moveInputWithCursor", !0, function (e, t) {
                t || e.display.input.resetPosition();
              }),
              n("tabindex", null, function (e, t) {
                return (e.display.input.getField().tabIndex = t || "");
              }),
              n("autofocus", null),
              n(
                "direction",
                "ltr",
                function (e, t) {
                  return e.doc.setDirection(t);
                },
                !0
              );
          })(ma),
          (function (e) {
            var t = e.optionHandlers,
              n = (e.helpers = {});
            (e.prototype = {
              constructor: e,
              focus: function () {
                window.focus(), this.display.input.focus();
              },
              setOption: function (e, n) {
                var i = this.options,
                  r = i[e];
                (i[e] == n && "mode" != e) ||
                  ((i[e] = n),
                  t.hasOwnProperty(e) && zi(this, t[e])(this, n, r),
                  at(this, "optionChange", this, e));
              },
              getOption: function (e) {
                return this.options[e];
              },
              getDoc: function () {
                return this.doc;
              },
              addKeyMap: function (e, t) {
                this.state.keyMaps[t ? "push" : "unshift"](qo(e));
              },
              removeKeyMap: function (e) {
                for (var t = this.state.keyMaps, n = 0; n < t.length; ++n)
                  if (t[n] == e || t[n].name == e) return t.splice(n, 1), !0;
              },
              addOverlay: Vi(function (t, n) {
                var i = t.token ? t : e.getMode(this.options, t);
                if (i.startState)
                  throw new Error("Overlays may not be stateful.");
                !(function (e, t, n) {
                  for (var i = 0, r = n(t); i < e.length && n(e[i]) <= r; ) i++;
                  e.splice(i, 0, t);
                })(
                  this.state.overlays,
                  {
                    mode: i,
                    modeSpec: t,
                    opaque: n && n.opaque,
                    priority: (n && n.priority) || 0,
                  },
                  function (e) {
                    return e.priority;
                  }
                ),
                  this.state.modeGen++,
                  Ki(this);
              }),
              removeOverlay: Vi(function (e) {
                for (var t = this.state.overlays, n = 0; n < t.length; ++n) {
                  var i = t[n].modeSpec;
                  if (i == e || ("string" == typeof e && i.name == e))
                    return t.splice(n, 1), this.state.modeGen++, void Ki(this);
                }
              }),
              indentLine: Vi(function (e, t, n) {
                "string" != typeof t &&
                  "number" != typeof t &&
                  (t =
                    null == t
                      ? this.options.smartIndent
                        ? "smart"
                        : "prev"
                      : t
                      ? "add"
                      : "subtract"),
                  pe(this.doc, e) && va(this, e, t, n);
              }),
              indentSelection: Vi(function (e) {
                for (
                  var t = this.doc.sel.ranges, n = -1, i = 0;
                  i < t.length;
                  i++
                ) {
                  var r = t[i];
                  if (r.empty())
                    r.head.line > n &&
                      (va(this, r.head.line, e, !0),
                      (n = r.head.line),
                      i == this.doc.sel.primIndex && Fi(this));
                  else {
                    var o = r.from(),
                      a = r.to(),
                      s = Math.max(n, o.line);
                    n = Math.min(this.lastLine(), a.line - (a.ch ? 0 : 1)) + 1;
                    for (var l = s; l < n; ++l) va(this, l, e);
                    var c = this.doc.sel.ranges;
                    0 == o.ch &&
                      t.length == c.length &&
                      c[i].from().ch > 0 &&
                      Wr(this.doc, i, new mr(o, c[i].to()), q);
                  }
                }
              }),
              getTokenAt: function (e, t) {
                return qt(this, e, t);
              },
              getLineTokens: function (e, t) {
                return qt(this, me(e), t, !0);
              },
              getTokenTypeAt: function (e) {
                e = Ce(this.doc, e);
                var t,
                  n = Ot(this, se(this.doc, e.line)),
                  i = 0,
                  r = (n.length - 1) / 2,
                  o = e.ch;
                if (0 == o) t = n[2];
                else
                  for (;;) {
                    var a = (i + r) >> 1;
                    if ((a ? n[2 * a - 1] : 0) >= o) r = a;
                    else {
                      if (!(n[2 * a + 1] < o)) {
                        t = n[2 * a + 2];
                        break;
                      }
                      i = a + 1;
                    }
                  }
                var s = t ? t.indexOf("overlay ") : -1;
                return s < 0 ? t : 0 == s ? null : t.slice(0, s - 1);
              },
              getModeAt: function (t) {
                var n = this.doc.mode;
                return n.innerMode
                  ? e.innerMode(n, this.getTokenAt(t).state).mode
                  : n;
              },
              getHelper: function (e, t) {
                return this.getHelpers(e, t)[0];
              },
              getHelpers: function (e, t) {
                var i = [];
                if (!n.hasOwnProperty(t)) return i;
                var r = n[t],
                  o = this.getModeAt(e);
                if ("string" == typeof o[t]) r[o[t]] && i.push(r[o[t]]);
                else if (o[t])
                  for (var a = 0; a < o[t].length; a++) {
                    var s = r[o[t][a]];
                    s && i.push(s);
                  }
                else
                  o.helperType && r[o.helperType]
                    ? i.push(r[o.helperType])
                    : r[o.name] && i.push(r[o.name]);
                for (var l = 0; l < r._global.length; l++) {
                  var c = r._global[l];
                  c.pred(o, this) && -1 == H(i, c.val) && i.push(c.val);
                }
                return i;
              },
              getStateAfter: function (e, t) {
                var n = this.doc;
                return $t(
                  this,
                  (e = xe(n, null == e ? n.first + n.size - 1 : e)) + 1,
                  t
                );
              },
              cursorCoords: function (e, t) {
                var n = this.doc.sel.primary();
                return Vn(
                  this,
                  null == e
                    ? n.head
                    : "object" == typeof e
                    ? Ce(this.doc, e)
                    : e
                    ? n.from()
                    : n.to(),
                  t || "page"
                );
              },
              charCoords: function (e, t) {
                return zn(this, Ce(this.doc, e), t || "page");
              },
              coordsChar: function (e, t) {
                return Yn(this, (e = Wn(this, e, t || "page")).left, e.top);
              },
              lineAtHeight: function (e, t) {
                return (
                  (e = Wn(this, { top: e, left: 0 }, t || "page").top),
                  he(this.doc, e + this.display.viewOffset)
                );
              },
              heightAtLine: function (e, t, n) {
                var i,
                  r = !1;
                if ("number" == typeof e) {
                  var o = this.doc.first + this.doc.size - 1;
                  e < this.doc.first
                    ? (e = this.doc.first)
                    : e > o && ((e = o), (r = !0)),
                    (i = se(this.doc, e));
                } else i = e;
                return (
                  qn(this, i, { top: 0, left: 0 }, t || "page", n || r).top +
                  (r ? this.doc.height - ze(i) : 0)
                );
              },
              defaultTextHeight: function () {
                return Zn(this.display);
              },
              defaultCharWidth: function () {
                return ei(this.display);
              },
              getViewport: function () {
                return { from: this.display.viewFrom, to: this.display.viewTo };
              },
              addWidget: function (e, t, n, i, r) {
                var o,
                  a,
                  s,
                  l = this.display,
                  c = (e = Vn(this, Ce(this.doc, e))).bottom,
                  d = e.left;
                if (
                  ((t.style.position = "absolute"),
                  t.setAttribute("cm-ignore-events", "true"),
                  this.display.input.setUneditable(t),
                  l.sizer.appendChild(t),
                  "over" == i)
                )
                  c = e.top;
                else if ("above" == i || "near" == i) {
                  var u = Math.max(l.wrapper.clientHeight, this.doc.height),
                    h = Math.max(l.sizer.clientWidth, l.lineSpace.clientWidth);
                  ("above" == i || e.bottom + t.offsetHeight > u) &&
                  e.top > t.offsetHeight
                    ? (c = e.top - t.offsetHeight)
                    : e.bottom + t.offsetHeight <= u && (c = e.bottom),
                    d + t.offsetWidth > h && (d = h - t.offsetWidth);
                }
                (t.style.top = c + "px"),
                  (t.style.left = t.style.right = ""),
                  "right" == r
                    ? ((d = l.sizer.clientWidth - t.offsetWidth),
                      (t.style.right = "0px"))
                    : ("left" == r
                        ? (d = 0)
                        : "middle" == r &&
                          (d = (l.sizer.clientWidth - t.offsetWidth) / 2),
                      (t.style.left = d + "px")),
                  n &&
                    ((o = this),
                    (a = {
                      left: d,
                      top: c,
                      right: d + t.offsetWidth,
                      bottom: c + t.offsetHeight,
                    }),
                    null != (s = xi(o, a)).scrollTop && Ti(o, s.scrollTop),
                    null != s.scrollLeft && Ai(o, s.scrollLeft));
              },
              triggerOnKeyDown: Vi(ta),
              triggerOnKeyPress: Vi(ia),
              triggerOnKeyUp: na,
              execCommand: function (e) {
                if (zo.hasOwnProperty(e)) return zo[e].call(null, this);
              },
              triggerElectric: Vi(function (e) {
                Ca(this, e);
              }),
              findPosH: function (e, t, n, i) {
                var r = 1;
                t < 0 && ((r = -1), (t = -t));
                for (
                  var o = Ce(this.doc, e), a = 0;
                  a < t && !(o = Ea(this.doc, o, r, n, i)).hitSide;
                  ++a
                );
                return o;
              },
              moveH: Vi(function (e, t) {
                var n = this;
                this.extendSelectionsBy(function (i) {
                  return n.display.shift || n.doc.extend || i.empty()
                    ? Ea(n.doc, i.head, e, t, n.options.rtlMoveVisually)
                    : e < 0
                    ? i.from()
                    : i.to();
                }, z);
              }),
              deleteH: Vi(function (e, t) {
                var n = this.doc.sel,
                  i = this.doc;
                n.somethingSelected()
                  ? i.replaceSelection("", null, "+delete")
                  : Wo(this, function (n) {
                      var r = Ea(i, n.head, e, t, !1);
                      return e < 0
                        ? { from: r, to: n.head }
                        : { from: n.head, to: r };
                    });
              }),
              findPosV: function (e, t, n, i) {
                var r = 1,
                  o = i;
                t < 0 && ((r = -1), (t = -t));
                for (var a = Ce(this.doc, e), s = 0; s < t; ++s) {
                  var l = Vn(this, a, "div");
                  if (
                    (null == o ? (o = l.left) : (l.left = o),
                    (a = Ta(this, l, r, n)).hitSide)
                  )
                    break;
                }
                return a;
              },
              moveV: Vi(function (e, t) {
                var n = this,
                  i = this.doc,
                  r = [],
                  o =
                    !this.display.shift &&
                    !i.extend &&
                    i.sel.somethingSelected();
                if (
                  (i.extendSelectionsBy(function (a) {
                    if (o) return e < 0 ? a.from() : a.to();
                    var s = Vn(n, a.head, "div");
                    null != a.goalColumn && (s.left = a.goalColumn),
                      r.push(s.left);
                    var l = Ta(n, s, e, t);
                    return (
                      "page" == t &&
                        a == i.sel.primary() &&
                        Ci(n, zn(n, l, "div").top - s.top),
                      l
                    );
                  }, z),
                  r.length)
                )
                  for (var a = 0; a < i.sel.ranges.length; a++)
                    i.sel.ranges[a].goalColumn = r[a];
              }),
              findWordAt: function (e) {
                var t = se(this.doc, e.line).text,
                  n = e.ch,
                  i = e.ch;
                if (t) {
                  var r = this.getHelper(e, "wordChars");
                  ("before" != e.sticky && i != t.length) || !n ? ++i : --n;
                  for (
                    var o = t.charAt(n),
                      a = te(o, r)
                        ? function (e) {
                            return te(e, r);
                          }
                        : /\s/.test(o)
                        ? function (e) {
                            return /\s/.test(e);
                          }
                        : function (e) {
                            return !/\s/.test(e) && !te(e);
                          };
                    n > 0 && a(t.charAt(n - 1));

                  )
                    --n;
                  for (; i < t.length && a(t.charAt(i)); ) ++i;
                }
                return new mr(me(e.line, n), me(e.line, i));
              },
              toggleOverwrite: function (e) {
                (null != e && e == this.state.overwrite) ||
                  ((this.state.overwrite = !this.state.overwrite)
                    ? D(this.display.cursorDiv, "CodeMirror-overwrite")
                    : E(this.display.cursorDiv, "CodeMirror-overwrite"),
                  at(this, "overwriteToggle", this, this.state.overwrite));
              },
              hasFocus: function () {
                return this.display.input.getField() == N();
              },
              isReadOnly: function () {
                return !(!this.options.readOnly && !this.doc.cantEdit);
              },
              scrollTo: Vi(function (e, t) {
                Si(this, e, t);
              }),
              getScrollInfo: function () {
                var e = this.display.scroller;
                return {
                  left: e.scrollLeft,
                  top: e.scrollTop,
                  height: e.scrollHeight - En(this) - this.display.barHeight,
                  width: e.scrollWidth - En(this) - this.display.barWidth,
                  clientHeight: _n(this),
                  clientWidth: Tn(this),
                };
              },
              scrollIntoView: Vi(function (e, t) {
                null == e
                  ? ((e = { from: this.doc.sel.primary().head, to: null }),
                    null == t && (t = this.options.cursorScrollMargin))
                  : "number" == typeof e
                  ? (e = { from: me(e, 0), to: null })
                  : null == e.from && (e = { from: e, to: null }),
                  e.to || (e.to = e.from),
                  (e.margin = t || 0),
                  null != e.from.line
                    ? (function (e, t) {
                        ki(e), (e.curOp.scrollToPos = t);
                      })(this, e)
                    : Ei(this, e.from, e.to, e.margin);
              }),
              setSize: Vi(function (e, t) {
                var n = this,
                  i = function (e) {
                    return "number" == typeof e || /^\d+$/.test(String(e))
                      ? e + "px"
                      : e;
                  };
                null != e && (this.display.wrapper.style.width = i(e)),
                  null != t && (this.display.wrapper.style.height = i(t)),
                  this.options.lineWrapping && $n(this);
                var r = this.display.viewFrom;
                this.doc.iter(r, this.display.viewTo, function (e) {
                  if (e.widgets)
                    for (var t = 0; t < e.widgets.length; t++)
                      if (e.widgets[t].noHScroll) {
                        Yi(n, r, "widget");
                        break;
                      }
                  ++r;
                }),
                  (this.curOp.forceUpdate = !0),
                  at(this, "refresh", this);
              }),
              operation: function (e) {
                return Wi(this, e);
              },
              refresh: Vi(function () {
                var e = this.display.cachedTextHeight;
                Ki(this),
                  (this.curOp.forceUpdate = !0),
                  Hn(this),
                  Si(this, this.doc.scrollLeft, this.doc.scrollTop),
                  or(this),
                  (null == e || Math.abs(e - Zn(this.display)) > 0.5) &&
                    ri(this),
                  at(this, "refresh", this);
              }),
              swapDoc: Vi(function (e) {
                var t = this.doc;
                return (
                  (t.cm = null),
                  Tr(this, e),
                  Hn(this),
                  this.display.input.reset(),
                  Si(this, e.scrollLeft, e.scrollTop),
                  (this.curOp.forceScroll = !0),
                  ln(this, "swapDoc", this, t),
                  t
                );
              }),
              getInputField: function () {
                return this.display.input.getField();
              },
              getWrapperElement: function () {
                return this.display.wrapper;
              },
              getScrollerElement: function () {
                return this.display.scroller;
              },
              getGutterElement: function () {
                return this.display.gutters;
              },
            }),
              dt(e),
              (e.registerHelper = function (t, i, r) {
                n.hasOwnProperty(t) || (n[t] = e[t] = { _global: [] }),
                  (n[t][i] = r);
              }),
              (e.registerGlobalHelper = function (t, i, r, o) {
                e.registerHelper(t, i, o),
                  n[t]._global.push({ pred: r, val: o });
              });
          })(ma);
        var Ba,
          Ra = "iter insert remove copy getEditor constructor".split(" ");
        for (var Pa in ko.prototype)
          ko.prototype.hasOwnProperty(Pa) &&
            H(Ra, Pa) < 0 &&
            (ma.prototype[Pa] = (function (e) {
              return function () {
                return e.apply(this.doc, arguments);
              };
            })(ko.prototype[Pa]));
        return (
          dt(ko),
          (ma.inputStyles = { textarea: Da, contenteditable: _a }),
          (ma.defineMode = function (e) {
            ma.defaults.mode || "null" == e || (ma.defaults.mode = e),
              function (e, t) {
                arguments.length > 2 &&
                  (t.dependencies = Array.prototype.slice.call(arguments, 2)),
                  (Tt[e] = t);
              }.apply(this, arguments);
          }),
          (ma.defineMIME = function (e, t) {
            _t[e] = t;
          }),
          ma.defineMode("null", function () {
            return {
              token: function (e) {
                return e.skipToEnd();
              },
            };
          }),
          ma.defineMIME("text/plain", "null"),
          (ma.defineExtension = function (e, t) {
            ma.prototype[e] = t;
          }),
          (ma.defineDocExtension = function (e, t) {
            ko.prototype[e] = t;
          }),
          (ma.fromTextArea = function (e, t, n, i) {
            if (
              (((t = t ? I(t) : {}).value = e.value),
              !t.tabindex && e.tabIndex && (t.tabindex = e.tabIndex),
              !t.placeholder &&
                e.placeholder &&
                (t.placeholder = e.placeholder),
              null == t.autofocus)
            ) {
              var r = N();
              t.autofocus =
                r == e ||
                (null != e.getAttribute("autofocus") && r == document.body);
            }
            function o() {
              e.value = c.getValue();
            }
            var a;
            if (
              e.form &&
              (it(e.form, "submit", o), !t.leaveSubmitMethodAlone)
            ) {
              var s = e.form;
              a = s.submit;
              try {
                var l = (s.submit = function () {
                  o(), (s.submit = a), s.submit(), (s.submit = l);
                });
              } catch (e) {}
            }
            (t.finishInit = function (t) {
              (t.save = o),
                (t.getTextArea = function () {
                  return e;
                }),
                (t.toTextArea = function () {
                  (t.toTextArea = isNaN),
                    o(),
                    e.parentNode.removeChild(t.getWrapperElement()),
                    (e.style.display = ""),
                    e.form &&
                      (ot(e.form, "submit", o),
                      "function" == typeof e.form.submit &&
                        (e.form.submit = a));
                });
            }),
              (e.style.display = "none");
            var c = ma(
              function (t) {
                return e.parentNode.insertBefore(t, e.nextSibling);
              },
              t,
              n,
              i
            );
            return c;
          }),
          ((Ba = ma).off = ot),
          (Ba.on = it),
          (Ba.wheelEventPixels = hr),
          (Ba.Doc = ko),
          (Ba.splitLines = Ft),
          (Ba.countColumn = O),
          (Ba.findColumn = V),
          (Ba.isWordChar = ee),
          (Ba.Pass = j),
          (Ba.signal = at),
          (Ba.Line = Vt),
          (Ba.changeEnd = yr),
          (Ba.scrollbarModel = Ri),
          (Ba.Pos = me),
          (Ba.cmpPos = ge),
          (Ba.modes = Tt),
          (Ba.mimeModes = _t),
          (Ba.resolveMode = At),
          (Ba.getMode = Mt),
          (Ba.modeExtensions = Lt),
          (Ba.extendMode = Nt),
          (Ba.copyState = Dt),
          (Ba.startState = Rt),
          (Ba.innerMode = Bt),
          (Ba.commands = zo),
          (Ba.keyMap = Io),
          (Ba.keyName = jo),
          (Ba.isModifierKey = Uo),
          (Ba.lookupKey = Ho),
          (Ba.normalizeKeyMap = $o),
          (Ba.StringStream = Pt),
          (Ba.SharedTextMarker = xo),
          (Ba.TextMarker = bo),
          (Ba.LineWidget = go),
          (Ba.e_preventDefault = ut),
          (Ba.e_stopPropagation = ht),
          (Ba.e_stop = ft),
          (Ba.addClass = D),
          (Ba.contains = L),
          (Ba.rmClass = E),
          (Ba.keyNames = Do),
          (ma.version = "5.26.0"),
          ma
        );
      })();
    }),
    $__System.registerDynamic(
      "15",
      ["20", "11", "e", "13", "26"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r,
          o,
          a = e("20"),
          s = (e("11"), e("e")),
          l = e("13"),
          c = (e("26").map, l.TYPE, l.Node),
          d = {},
          u = {},
          h = 0;
        function p(e) {
          return [e, 0];
        }
        var f = function (e) {
          var t = function (e, t) {
              return (
                (t =
                  t || window.getComputedStyle(document.body)).getPropertyValue(
                  e
                ) || ""
              )
                .replace(/(^[\s\'\"]+)|([\s\'\"]+$)/g, "")
                .toLowerCase();
            },
            n = e ? void 0 : window.getComputedStyle(document.body);
          (e = e || t("--mermaid-theme")), (o = e);
          var i = "on" == t("--mermaid-sequence-numbers"),
            r = t("--mermaid-flowchart-curve");
          -1 == ["linear", "basis", "step", "natural"].indexOf(r) &&
            (r = void 0);
          var a = t("--mermaid--gantt-left-padding") || 75;
          try {
            (a = parseFloat(a)), isNaN(a) && (a = 75);
          } catch (e) {
            a = 75;
          }
          var s = {};
          return (
            "night" == e
              ? ((s = (function (e) {
                  var t = e
                    ? e.getPropertyValue("--text-color").trim()
                    : "#b8bfc6";
                  return {
                    darkMode: !1,
                    fontFamily:
                      (e
                        ? e.getPropertyValue("--mermaid-font-family").trim()
                        : void 0) ||
                      '"trebuchet ms", verdana, arial, sans-serif',
                    noteTextColor: "#333",
                    primaryColor: "#BDD5EA",
                    background: "#fff",
                    noteBkgColor: "#6D6D65",
                    textColor: "#333",
                    lineColor: "#9370DB",
                    errorTextColor: "#f1908e",
                    actorLineColor: t,
                    arrowheadColor: t,
                    titleColor: t,
                    loopTextColor: t,
                    signalTextColor: t,
                    signalColor: t,
                    taskTextDarkColor: "white",
                    altBackground: "#efefef",
                    secondaryColor: "#f4f4f4",
                    sectionBkgColor: "rgba(255, 255, 255, 0.3)",
                    sectionBkgColor2: "white",
                    taskTextClickableColor: "#003163",
                    taskTextOutsideColor: "lightgrey",
                    noteBkgColor: "#fff5ad",
                    tertiaryColor: "#e8e8e8",
                    tickTextColor: "#b8bfc6",
                    activeTaskBkgColor: "#428bca",
                    doneTaskBkgColor: "#555",
                  };
                })(n)),
                (e = "base"))
              : ["base", "default", "dark", "forest", "neutral"].indexOf(e) >
                  -1 ||
                (n
                  ? (s = (function (e) {
                      var t = e.getPropertyValue("--node-fill").trim(),
                        n = File.colorBrightness < 0.5;
                      t &&
                        /#/.exec(t) &&
                        (n =
                          (299 * parseInt(t.substr(1, 2), 16) +
                            587 * parseInt(t.substr(3, 2), 16) +
                            114 * parseInt(t.substr(4, 2), 16)) /
                            1e3 <
                          40);
                      var i = {
                        darkMode: n,
                        fontFamily:
                          e.getPropertyValue("--mermaid-font-family").trim() ||
                          '"trebuchet ms", verdana, arial, sans-serif',
                        noteTextColor: e
                          .getPropertyValue("--text-color")
                          .trim(),
                        primaryColor: t,
                        background:
                          e.getPropertyValue("--mermaid-background").trim() ||
                          e.getPropertyValue("--bg-color").trim(),
                        noteBkgColor: e
                          .getPropertyValue("--cluster-fill")
                          .trim(),
                        textColor:
                          e.getPropertyValue("--node-text-color").trim() ||
                          e.getPropertyValue("--text-color").trim(),
                      };
                      return (
                        "#ECECFF" !== t ||
                          i.darkMode ||
                          (i.secondaryColor = "#f4f4f4"),
                        i
                      );
                    })(n))
                  : (o = e = "default")),
            {
              securityLevel: "loose",
              theme: e || "base",
              themeVariables: s,
              altFontFamily: "sans-serif",
              fontFamily: "sans-serif",
              startOnLoad: !1,
              flowchart: { htmlLabels: !0, useMaxWidth: !0, curve: r },
              sequence: {
                showSequenceNumbers: i,
                useMaxWidth: !1,
                diagramMarginX: 8,
                diagramMarginY: 8,
                boxMargin: 8,
              },
              gantt: { leftPadding: a, rightPadding: 20 },
            }
          );
        };
        class m {
          constructor(e) {
            this.editor = e;
            var t = this;
            s(e.sessionStr).on("refocus", ".md-diagram", function () {
              var e = this.getAttribute("cid");
              t.startPreview(e);
              var n = (this.querySelector(".CodeMirror") || {}).CodeMirror;
              n || (n = t.editor.fences.getCm(e)), !n.hasFocus() && n.refresh();
            });
          }
          cancelDiagram(e) {
            var t = this.editor.fences.getCm(e);
            (this.editor
              .findElemById(e)
              .find(".md-diagram-panel")
              .remove()
              .end()[0].style.marginBottom = ""),
              d[e] && clearTimeout(d[e]),
              (d[e] = void 0),
              (u[e] = void 0),
              t.state.lint && a.clearMarks(t),
              t.getWrapperElement().offsetHeight || t.refresh();
          }
          refreshDiagram(e, t) {
            var n = this;
            t || (t = document.querySelector("#write")),
              t
                .querySelectorAll(".md-fences-advanced.md-diagram")
                .forEach(function (t) {
                  (!e && t.querySelector("svg")) ||
                    (n.editor.fences.getCm(t.getAttribute("cid")),
                    n.updateDiagram(t.getAttribute("cid"), !0));
                });
          }
          loadMermaidTheme() {
            if (File.option.enableDiagram && window.mermaidAPI) {
              r = f();
              try {
                window.mermaidAPI.initialize(r);
              } catch (e) {
                window.Reporter.captureException(e, {
                  level: "warning",
                  currentMermaidOptions: JSON.stringify(r),
                }),
                  (r = f("default"));
                try {
                  window.mermaidAPI.initialize(r);
                } catch (e) {
                  window.Reporter.captureException(e);
                }
              }
            }
          }
          getCurrentMermaidOptions() {
            return r;
          }
          lazyload() {
            if (File.option.enableDiagram) {
              var e = this,
                t = this.editor;
              window.debugMode
                ? Promise.all([
                    System.import("diagram/lodash.core.js"),
                    System.import("diagram/mermaid.js"),
                    System.import("diagram/raphael.js"),
                  ]).then(function () {
                    Promise.all([
                      System.import("diagram/mermaid-mindmap.js"),
                      System.import("diagram/sequence-diagram.js"),
                      System.import("diagram/flowchart.js"),
                    ]).then(function () {
                      n(),
                        window.mermaid.registerExternalDiagrams([
                          window["mermaid-mindmap"],
                        ]);
                    });
                  })
                : s.getScript(
                    (File.isNode ? "./lib.asar" : "./lib") +
                      "/diagram/diagram.min.js",
                    function () {
                      s.getScript(
                        (File.isNode ? "./lib.asar" : "./lib") +
                          "/diagram/mermaid-mindmap.js",
                        function () {
                          window.mermaid.registerExternalDiagrams([
                            window["mermaid-mindmap"],
                          ]),
                            n();
                        }
                      );
                    }
                  );
            }
            function n() {
              (e.modeLoaded = !0),
                (window.mermaidAPI = mermaid.mermaidAPI),
                e.loadMermaidTheme(),
                s(t.sessionStr)
                  .on("click", ".md-diagram-panel", function (e) {
                    var n = s(e.target).closest("a");
                    if (n.length) return t.tryOpenLink(n), !1;
                    var i = s(this).prevAll(".CodeMirror");
                    if (i.length && !i.hasClass("CodeMirror-focused")) {
                      var r = i[0].CodeMirror;
                      r && (r.refresh(), r.focus());
                    }
                  })
                  .addClass("enable-diagrams"),
                e.refreshDiagram();
            }
          }
          async startPreview(e) {
            var t = this.editor.getNode(e).get("lang"),
              n = this.editor.fences.getCm(e);
            if (m.isDiagramType(t)) {
              var i = this.editor.findElemById(e),
                r = i.find(".md-diagram-panel");
              r.length ||
                ((r = s("#componenet .md-diagram-panel").clone()),
                i.append(r),
                await this.updateDiagram(e),
                n.setOption("lint", {
                  getAnnotations: function () {
                    return [];
                  },
                  lintOnChange: !1,
                })),
                (i[0].style.marginBottom = i[0].classList.contains("md-focus")
                  ? r.height() + 50 + "px"
                  : "");
            }
          }
          async updateDiagram(e, t, n) {
            var r,
              o = this.editor,
              l = this.editor.findElemById(e),
              f = this.editor.fences.getCm(e),
              m = l.find(".md-diagram-panel");
            if ((l[0].removeAttribute("mermaid-type"), !m.length))
              return o.diagrams.startPreview(e);
            function g(e) {
              (m.find(".md-diagram-panel-error")[0].innerHTML = ""),
                f.state.lint && a.clearMarks(f),
                e && (u[f.cid] = null);
            }
            function v(n, i) {
              try {
                n.message = "ERROR: [" + i + "] " + n.message;
              } catch (n) {}
              ((
                document.querySelector(
                  "[cid='" + e + "'] .md-diagram-panel-error"
                ) || {}
              ).textContent = n.message),
                n.loc &&
                  ((u[e] = n),
                  t ||
                    (f.doc.lineCount() > 1 &&
                    n.loc.first_line - 1 == (f.getCursor() || {}).line
                      ? g()
                      : o.diagrams.attachError(f, n)));
            }
            var y = "#fff";
            async function b() {
              if (m.length) {
                var t = m[0].getBoundingClientRect();
                if (c.isType(f.options.mode, "sequence"))
                  !(function () {
                    try {
                      (r = Diagram.parse(
                        f.getValue() || "title: Empty Diagram"
                      )),
                        (u[e] = null);
                    } catch (e) {
                      return void v(e, "Sequence");
                    }
                    g(!0),
                      (m.find(".md-diagram-panel-preview")[0].innerHTML = "");
                    var t = (
                      window
                        .getComputedStyle(document.body)
                        .getPropertyValue("--sequence-theme") || ""
                    )
                      .replace(/(^[\s\'\"]+)|([\s\'\"]+$)/g, "")
                      .toLowerCase();
                    r.drawSVG(m.find(".md-diagram-panel-preview")[0], {
                      theme: "hand" === t ? "hand" : "simple",
                    });
                    var n = m.find("svg")[0],
                      i =
                        m.width() /
                        (n.getAttribute("width").replace("px", "") - 0);
                    i < 1 && (n.style.zoom = i);
                  })();
                else if (c.isType(f.options.mode, "flow"))
                  !(function () {
                    try {
                      g(!0),
                        (r = flowchart.parse(
                          f.getValue().replace(/\r/g, "") ||
                            "st=>start: Empty Diagram\ne=>end\nst->e"
                        )),
                        (m.find(".md-diagram-panel-preview")[0].innerHTML = ""),
                        r.drawSVG(m.find(".md-diagram-panel-preview")[0], {
                          y: 0,
                          "font-color": "currentColor",
                          "line-color": "currentColor",
                          "element-color": "currentColor",
                          fill: y,
                        });
                    } catch (e) {
                      return void v(e, "Flowchart");
                    }
                  })();
                else {
                  if (!c.isType(f.options.mode, "mermaid")) return;
                  await (async function () {
                    g(!0);
                    var e = p(f.getValue()),
                      t = e[1],
                      n = m.find(".md-diagram-panel-preview")[0],
                      r = e[0],
                      o = (r.match(/\s*([^\s]+)/) || ["", ""])[1];
                    l[0].setAttribute("mermaid-type", o);
                    var a = function (e) {
                      n.innerHTML = e;
                    };
                    try {
                      if (
                        ((i = null),
                        a(""),
                        0 == r.trim().length
                          ? a(
                              "<text>" +
                                s.localize.getString("Empty Diagram") +
                                "</text>"
                            )
                          : window.mermaidAPI &&
                            (await mermaidAPI.renderAsync(
                              "mermaidChart" + h++,
                              r,
                              a,
                              n
                            )),
                        i)
                      )
                        throw i;
                    } catch (e) {
                      return e.hash
                        ? ((e.loc = e.hash.loc),
                          (e.line = e.hash.line),
                          e.loc
                            ? ((e.loc.first_line += t),
                              (e.loc.last_line += t),
                              (e.message = e.message.replace(
                                /^[^\n]*(\d)/,
                                function (e, n) {
                                  return "Parse error on line " + (n - 0 + t);
                                }
                              )))
                            : (e.loc = {
                                first_line: e.line + 1,
                                last_line: e.line + 1,
                              }),
                          void v(e, "Mermaid"))
                        : void v(e, "Mermaid");
                    }
                    g(!0);
                  })();
                }
                var n = m.height(),
                  o = m.closest("[cid]")[0];
                if (
                  ((o.style.marginBottom = o.classList.contains("md-focus")
                    ? n + 40 + "px"
                    : ""),
                  (d[e] = null),
                  t.top < 0)
                ) {
                  var a = n - t.height,
                    b = s("content");
                  b.scrollTop(b.scrollTop() + a);
                }
              }
            }
            window.CSS &&
              window.CSS.supports &&
              window.CSS.supports("(--foo: red)") &&
              (y = "var(--bg-color)"),
              d[e] && clearTimeout(d[e]),
              n ? await b() : (d[e] = setTimeout(b, 200));
          }
          attachError(e, t) {
            try {
              if (
                ((t = t || u[e.cid]),
                e.state.lint && a.clearMarks(e),
                !t || !t.loc)
              )
                return;
              var n = {
                from: a.Pos(t.loc.first_line - 1, t.loc.first_column),
                to: a.Pos(
                  t.loc.last_line - 1,
                  t.loc.last_column || e.doc.getLine(t.loc.last_line - 1).length
                ),
                message: t.message,
              };
              ((
                document.querySelector(
                  "[cid='" + e.cid + "'] .md-diagram-panel-error"
                ) || {}
              ).textContent = t.message),
                a.updateLinting(e, [n]);
            } catch (t) {}
          }
          async mermaidSvgForExportTheme(e) {
            var t = r,
              n = o,
              i = this.editor,
              a = this;
            var s = (function (e) {
              var t = e.lastIndexOf("--mermaid-theme");
              return -1 == t
                ? "default"
                : ((e = e.substr(t)),
                  (
                    (/--mermaid-theme\s*:\s*([^\s;]+)/.exec(e) || [])[1] ||
                    "default"
                  ).replace(/['"]/g, ""));
            })(e);
            if (s == o) return null;
            var l = f(s);
            return await (async function (e) {
              window.mermaidAPI.initialize(e);
              var s = document.querySelectorAll(".md-diagram[lang='mermaid']"),
                l = document.querySelector("#mermaid-canvas");
              l.innerHTML = "";
              var c,
                d,
                u,
                h,
                f = {};
              return (
                await Promise.all(
                  Array.from(s).map(
                    (e) => (
                      (c = e),
                      (d = i.getNode(c.getAttribute("cid"))),
                      (u = p(d.get("text"))[0]),
                      (h = document.createElement("div")),
                      h.setAttribute("id", "export-mermaid-" + d.cid),
                      l.appendChild(h),
                      new Promise((e) => {
                        try {
                          mermaidAPI.render(
                            "export-mermaid-" + d.cid,
                            u,
                            function (t) {
                              (f[d.cid] = t), e(t);
                            }
                          );
                        } catch (t) {
                          console.error(t), (f[d.cid] = ""), e("");
                        }
                      })
                    )
                  )
                ),
                (r = t),
                (o = n),
                (l.innerHTML = ""),
                a.loadMermaidTheme(),
                f
              );
            })(l);
          }
        }
        (m.isDiagramType = function (e) {
          return (
            File.option.enableDiagram &&
            "string" == typeof e &&
            c.isType((e || "").toLowerCase(), "sequence", "flow", "mermaid")
          );
        }),
          (m.MODES = ["sequence", "flow", "mermaid"]),
          (m.getMermaidOptions = f),
          (n.exports = m);
      }
    ),
    $__System.registerDynamic(
      "17",
      ["20", "11", "e", "16", "13", "26", "15", "1b"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i,
          r,
          o = e("20"),
          a = e("11"),
          s = e("e"),
          l = e("16"),
          c = e("13"),
          d = e("26"),
          u = (e("15"), e("1b")),
          h = u.SnapFlag,
          p = (d.map, c.Node),
          f =
            (c.TYPE,
            [
              "em",
              "strong",
              "small",
              "big",
              "s",
              "strike",
              "cite",
              "q",
              "dfn",
              "abbr",
              "data",
              "time",
              "code",
              "var",
              "samp",
              "kbd",
              "sub",
              "sup",
              "i",
              "b",
              "mark",
              "ruby",
              "span",
              "ins",
              "del",
              "button",
              "font",
              "acronym",
              "tt",
              "progress",
              "meter",
              "svg",
              "a",
            ]),
          m = [
            "script",
            "style",
            "meta",
            "noscript",
            "input",
            "template",
            "head",
            "canvas",
            "link",
          ],
          g = f.concat(["img", "a", "br", "wbr"]),
          v = [
            "div",
            "p",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "table",
            "figure",
            "details",
            "left",
            "right",
            "center",
            "footer",
            "header",
            "nav",
            "ol",
            "ul",
            "article",
            "address",
            "dl",
            "applet",
            "map",
            "aside",
            "audio",
            "bdo",
            "blockquote",
            "form",
            "select",
            "dialog",
            "picture",
            "embed",
            "object",
            "iframe",
            "main",
            "pre",
            "section",
            "svg",
            "textarea",
            "video",
            "template",
            "head",
            "canvas",
            "hr",
          ],
          y = g.concat(v).concat(m),
          b =
            /^\s*<(\!DOCTYPE|div|p|h[1-6]|table|figure|details|left|right|center|footer|header|nav|ol|ul|article|address|dl|applet|map|aside|audio|bdo|blockquote|form|select|dialog|picture|embed|object|iframe|main|pre|section|svg|textarea|video|template|head|canvas|base|datalist|meta|script|style|noscript|title|menu|hr)(?:(\/)|>|\s|$)/i,
          w = ["br", "hr", "embed"],
          x = {},
          C = function (e) {
            return (
              x[e] ||
                (x[e] = new RegExp(
                  "(?:<" +
                    e +
                    "(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\\0-\\ ]+|'[^']*'|\"[^\"]*\"))?)*\\s*(\\/?)>?|<(\\/)" +
                    e +
                    "\\s*[>])",
                  "i"
                )),
              x[e]
            );
          },
          F = !1,
          S = function (e) {
            for (var t, n, i = 0; e; ) {
              if (!t) {
                if (
                  !(t = ((n = b.exec(e)) || [])[1]) ||
                  w.indexOf(t.toLowerCase()) > -1
                )
                  break;
                i = 0;
              }
              if (!(n = C(t).exec(e))) break;
              (e = e.substring(n[0].length)), n[2] ? i-- : n[1] || i++;
            }
            return i <= 0;
          },
          k = function (e) {
            var t = e.doc.getCursor();
            return !t || e.doc.indexFromPos(t) >= e.doc.getValue().length;
          };
        class E {
          constructor(e) {
            (this.editor = e),
              this.bindEvent_(),
              this.listenMessage(),
              (this.currentCm = null);
          }
          bindEvent_(e) {
            var t,
              n,
              i = this,
              r = this.editor;
            s("#write")
              .on("mousedown", ".md-htmlblock-container", function (e) {
                (n = r.selection.getRangy()),
                  (t = n && n.collapsed ? [e.offsetX, e.offsetY] : null);
              })
              .on("click", ".md-htmlblock-container", function (e) {
                var o = (e.originalEvent.path || [])[0] || e.target;
                if (
                  (r.undo.prepCursorSnap(n),
                  s(o).closest("a[href]").length || (!e.ctrlKey && !e.metaKey))
                ) {
                  if (
                    s(o).closest(
                      "a, summary, audio, video[controls]:not(.md-video-load-failed), area[href]"
                    ).length
                  )
                    return;
                  t &&
                    Math.pow(t[0] - e.offsetX, 2) +
                      Math.pow(t[1] - e.offsetY, 2) <
                      16 &&
                    i.startEditing(s(this).parent(), "auto");
                } else i.startEditing(s(this).parent(), "auto");
                r.undo.endSnap();
              })
              .on("startedit", ".md-htmlblock-container", function (e) {
                i.startEditing(s(this).parent(), "auto");
              })
              .on("losefocus", ".md-htmlblock", function (e) {
                if (
                  (i.stopEditing(this.getAttribute("cid")),
                  document.activeElement != r.writingArea)
                ) {
                  if (
                    document.activeElement &&
                    document.activeElement.closest &&
                    document.activeElement.closest(".md-htmlblock")
                  )
                    return;
                  r.selection.scrollAdjust();
                }
              })
              .on("endfocus", ".md-htmlblock", function (e) {
                i.dropEditing();
              })
              .on("mouseenter", "video", function (e) {
                var t = this;
                t.error &&
                  t.error.message &&
                  t.error.message.indexOf("ERR_CACHE_OPERATION_NOT_SUPPORTED") >
                    -1 &&
                  (t.previousElementSibling &&
                    t.parentElement.removeChild(t.previousElementSibling),
                  t.classList.remove("md-video-load-failed"),
                  t.load()),
                  t.error || t.setAttribute("controls", "controls");
              })
              .on("mouseleave", "video", function (e) {
                this.error || this.removeAttribute("controls");
              })
              .on("click", ".md-rawblock-tooltip-edit-btn", function (e) {
                s(e.target)
                  .closest(".md-rawblock")
                  .find(".md-rawblock-container")
                  .trigger("startedit"),
                  s(".ty-tooltip").removeClass("shown");
              })
              .on("mouseenter", ".md-htmlblock-container", function (e) {
                if (File.isWK) {
                  var t = r.contextMenu.getMenuItemsForMac(e.target, !0);
                  window.bridge.callHandler("contextMenu.setItems", t);
                }
              })
              .on("mouseleave", ".md-htmlblock-container", function (e) {
                File.isWK &&
                  window.bridge.callHandler("contextMenu.setItems", []);
              })
              .on(
                "click",
                ".md-rawblock-tooltip-ok-btn",
                r.finishRawBlockEdit.bind(r)
              ),
              File.isMac &&
                s("#write")
                  .on("mouseenter", ".md-rawblock-tooltip", function () {
                    s(this).closest(".md-rawblock").addClass("ty-hover");
                  })
                  .on("mouseleave", ".md-rawblock-tooltip", function () {
                    var e = s(this).closest(".md-rawblock");
                    setTimeout(function () {
                      e.removeClass("ty-hover");
                    }, 100);
                  });
          }
          resetVideoDom(e) {
            e.classList.remove("md-video-load-failed"),
              s(e).prev(".md-htmlblock-panel-placeholder").remove();
          }
          getCidAndElem(e) {
            var t = e,
              n = e;
            return (
              "string" == typeof e
                ? (n = this.editor.findElemById(t))
                : (t = n.attr("cid")),
              [t, n]
            );
          }
          beforeDeleteFences(e) {
            this.syncToNode(e), this.dropEditing(), (this.currentCm = void 0);
          }
          syncToNode(e) {
            var t = "string" == typeof e ? this.editor.getNode(e) : e;
            return (
              (this.currentCm || {}).cid === t.cid &&
                t.set("text", this.currentCm.getValue()),
              t
            );
          }
          dropEditing() {
            if (this.currentCm) {
              var e = this.editor.findElemById(this.currentCm.cid),
                t = this.editor.getNode(this.currentCm.cid);
              e.find(".md-htmlblock-panel").html("").hide(),
                e.replaceWith(t.toHTML()),
                (this.currentCm = void 0);
            }
          }
          stopEditing(e, t) {
            if (
              this.currentCm &&
              ((e = e || this.currentCm.cid), this.currentCm.cid === e)
            ) {
              var n = this.editor.getNode(this.currentCm.cid);
              if (n) {
                var i = this.editor.findElemById(n.cid),
                  r = this.editor,
                  o = this.currentCm;
                if ((i.removeClass("md-rawblock-on-edit"), !F))
                  return (
                    (this.currentCm = null),
                    this.syncToNode(n),
                    i.find(".md-htmlblock-panel").hide().html(""),
                    i.find(".md-rawblock-container").show(),
                    void this.refreshUnder(i[0])
                  );
                var a = u.makeEmptyCommand();
                a.undo.push({
                  type: "fences-pos",
                  pos: o.getCursor(),
                  id: o.cid,
                }),
                  a.undo.push(u.buildReplaceUndo(n)),
                  this.syncToNode(n);
                var s = n.parseFrom({
                    noTop: !n.get("attachTo"),
                    skips: { old_code: !1, pass_format: !0 },
                  }),
                  l = s[1];
                a.redo.push(u.buildReplaceUndo(n)),
                  l.length > 1 &&
                    ((l = l.slice(1)), u.addUndoForInsertArray(a, l, n)),
                  (this.currentCm = null),
                  i.replaceWith(s[0]),
                  this.refreshUnder(n.cid),
                  t && r.selection.jumpToNextBlock(n, a),
                  r.undo.register(a),
                  setTimeout(function () {
                    a.redo.push(r.selection.buildUndo());
                  }, 100);
              } else this.currentCm = void 0;
            }
          }
          refreshUnder(e) {
            var t;
            e
              ? (t = (
                  "string" == typeof e ? this.editor.findElemById(e)[0] : e
                ).querySelectorAll("iframe.md-html-iframe"))
              : (t = document.querySelectorAll("iframe.md-html-iframe"));
            t.length &&
              t.forEach(function (e) {
                e.contentWindow.postMessage("syncHeight", "*");
              });
          }
          startEditing(e, t) {
            if (!File.isLocked) {
              var n,
                r = this.getCidAndElem(e),
                a = r[0],
                l = r[1],
                c = this.editor,
                d = this.editor.getNode(a),
                u = function (e) {
                  var t = c.getNode(e.cid),
                    n = c.undo.UndoManager,
                    i = n.makeEmptyCommand();
                  c.htmlBlock.beforeDeleteFences(e.cid),
                    i.undo.push({
                      type: "fences-pos",
                      pos: e.getCursor(),
                      id: e.cid,
                    }),
                    n.append(i, c.UserOp.backToParagraph(c, t, !1)),
                    c.undo.register(i);
                };
              if (a) {
                if (this.currentCm && this.currentCm.cid === a) {
                  if (
                    c.writingArea.contains(this.currentCm.getWrapperElement())
                  )
                    return this.currentCm.focus(), this.currentCm;
                  this.currentCm = null;
                }
                return (
                  this.currentCm &&
                    (this.stopEditing(this.currentCm.cid),
                    window.getSelection().removeAllRanges()),
                  l
                    .find(".md-htmlblock-panel")
                    .show()
                    .html(
                      '<div class="md-rawblock-input md-rawblock-control" contenteditable="false"></div>'
                    ),
                  l.find(".md-rawblock-container").hide(),
                  l.addClass("md-rawblock-on-edit"),
                  (this.currentCm = (function (e) {
                    (F = !1), (i = d.get("text"));
                    var t = o(
                      l.find(".md-rawblock-input")[0],
                      {
                        styleSelectedText: !0,
                        styleActiveLine: !0,
                        lineWrapping: !File.option.noLineWrapping,
                        maxHighlightLength: 1 / 0,
                        viewportMargin: 1 / 0,
                        mode: "htmlmixed",
                        placeholder: s.localize.getString("Input HTML here"),
                        theme: " inner null-scroll",
                        autoCloseBrackets: !0,
                        autoCloseTags: !0,
                        value: i,
                        lineNumbers: !1,
                        resetSelectionOnContextMenu: !0,
                        dragDrop: !1,
                        indentUnit: File.option.codeIndentSize,
                        tabSize: File.option.codeIndentSize,
                        lineWiseCopyCut: File.option.lineWiseCopyCut,
                      },
                      e,
                      a
                    );
                    return (
                      t.on("blur", function (e) {
                        setTimeout(function () {
                          document.body.contains(e.getWrapperElement()) &&
                            d.set("text", e.getValue());
                        }, 0);
                      }),
                      t.on("focus", function (n) {
                        e.refocus(t.cid);
                      }),
                      t.on("changes", function (n, i) {
                        e.fences.handleUserReplacement(n, i),
                          e.wordCount.quickUpdate(t.cid),
                          e.selection.clearGlobalColumn(),
                          (F = !0),
                          File.isTypeWriterMode &&
                            !File.option.scrollWithCursor &&
                            e.selection.typeWriterScroll(
                              t.cursorCoords(t.getCursor())
                            );
                      }),
                      t.on("cursorActivity", function () {
                        e.fences.handleCursorActivity(t);
                      }),
                      t.on("keydown", function (t, n) {
                        e.fences.onKeyDown(t, n, e, u, h);
                      }),
                      t
                    );
                  })(this.editor)),
                  (n = this.currentCm).focus(),
                  n.execCommand("goDocEnd"),
                  c.selection.scrollAdjust(),
                  t &&
                    ("start" == t
                      ? this.currentCm.execCommand("goDocStart")
                      : "end" == t
                      ? this.currentCm.execCommand("goDocEnd")
                      : "auto" == t && this.findPos(this.currentCm),
                    this.editor.refocus(d.id)),
                  this.currentCm
                );
              }
            }
            function h(e, t) {
              if (
                k(e) &&
                (t.ctrlKey || t.metaKey || (!t.shiftKey && S(e.getValue())))
              )
                return (
                  setTimeout(function () {
                    c.UserOp.insertParagraph();
                  }, 20),
                  t.preventDefault(),
                  t.stopPropagation(),
                  !0
                );
            }
          }
          findPos(e) {
            var t = e.lineCount();
            t >= 3
              ? e.setCursor(t - 2, e.getLine(t - 2).length)
              : 2 == t
              ? e.setCursor(t - 1, 0)
              : e.setCursor(t - 1, e.getLine(t - 1).length);
          }
          listenMessage() {
            var e = this.editor;
            window.addEventListener(
              "message",
              function (t) {
                var n = t.data,
                  i = e.findElemById(n.cid).find("iframe")[0];
                "changeHeight" == n.msg && (i.height = n.height),
                  "startEditing" == n.msg &&
                    s(i).closest(".md-rawblock-container").trigger("startedit"),
                  "contextmenu" == n.msg && File.isNode && _(i, n.event),
                  "mousedown" == n.msg &&
                    File.isNode &&
                    File.editor.contextMenu.hide();
              },
              !1
            );
          }
        }
        E.allowWhiteList = function () {
          if (void 0 === r) {
            var e = document.createElement("iframe");
            (r = void 0 !== e.srcdoc), e.remove();
          }
          return r;
        };
        var T = {
          FORBID_ATTR: [],
          ADD_ATTR: [
            "async",
            "srcdoc",
            "class",
            "alt",
            "for",
            "title",
            "charset",
          ],
          FORBID_TAGS: [],
          ADD_TAGS: [
            "iframe",
            "dialog",
            "embed",
            "footer",
            "style",
            "template",
            "svg",
          ],
          ALLOW_DATA_ATTR: !0,
          ALLOW_UNKNOWN_PROTOCOLS: !0,
          forHTMLBlock: !0,
          forPrint: !0,
        };
        window.reqnode &&
          (T.ADD_TAGS.remove("iframe"), T.FORBID_TAGS.push("iframe")),
          (E.INLINE_CONFIG = {
            ADD_TAGS: [],
            FORBID_TAGS: ["iframe", "dialog", "embed", "footer", "object"],
            ALLOW_UNKNOWN_PROTOCOLS: !0,
            ADD_ATTR: ["controls", "allowfullscreen", "ty-id", "ty-class"],
          }),
          (E.getDomPurifyConfig = function (e) {
            return Object.assign(
              {
                FORBID_ATTR: [
                  "class",
                  "contenteditable",
                  "cid",
                  "id",
                  "loop",
                  "autoplay",
                  "preload",
                ],
                ADD_ATTR: [
                  "allowfullscreen",
                  "async",
                  "charset",
                  "srcdoc",
                  "controls",
                ],
                ADD_TAGS: ["iframe", "dialog", "embed", "footer"],
                FORBID_TAGS: ["head", "style"],
                ALLOW_DATA_ATTR: !1,
                RETURN_DOM: !0,
                ALLOW_UNKNOWN_PROTOCOLS: !0,
                USE_PROFILES: { html: !0, svg: !0, svgFilters: !0, mathMl: !0 },
              },
              e
            );
          });
        var _ = function (e, t) {
            var n = s(e),
              i = n.offset(),
              r = new s.Event("contextmenu", {
                target: e,
                currentTarget: e,
                clientY: i.top + t.clientY,
                clientX: i.left + t.clientX,
              });
            n.trigger(r);
          },
          A = function (e) {
            return e.src && /\.pdf/i.exec(new URL(e.src).pathname);
          };
        (window.loadedWebview = function (e) {
          function t() {
            e.previousElementSibling &&
              e.previousElementSibling.classList.contains(
                "md-htmlblock-panel-placeholder"
              ) &&
              e.parentElement.removeChild(e.previousElementSibling);
          }
          e._eventBind ||
            (t(),
            e.addEventListener("did-start-loading", function () {
              t();
              var n = document.createElement("div");
              n.setAttribute("class", "md-htmlblock-panel-placeholder"),
                (n.innerHTML =
                  '<div class="ty-lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>'),
                e.parentElement.insertBefore(n, e);
            }),
            e.addEventListener("did-stop-loading", t),
            e.addEventListener("console-message", function (e) {
              3 === e.level && console.error(e.sourceId + e.line, e.message);
            }),
            e.addEventListener("did-fail-load", function (t) {
              e.previousElementSibling.textContent =
                t.errorDescription + "  " + t.validatedURL;
            }),
            e.addEventListener("context-menu", function (t) {
              var n = s(e),
                i = new s.Event("contextmenu", {
                  target: e,
                  currentTarget: e,
                  clientY: t.params.y,
                  clientX: t.params.x,
                });
              n.trigger(i);
            }),
            (e._eventBind = !0));
        }),
          (window.remoteOnLoad = function (e) {
            function t(e) {
              var t = A(e);
              if (
                H(e) &&
                ((e.contentDocument.documentElement.oncontextmenu = function (
                  t
                ) {
                  _(e, t);
                }),
                e.contentDocument.documentElement.addEventListener(
                  "mousedown",
                  function (e) {
                    File.editor.contextMenu.hide();
                  }
                ),
                "" == e.height && e.contentDocument && e.contentDocument.body)
              ) {
                var n = e.contentWindow.innerHeight,
                  i = e.contentDocument.body.scrollHeight;
                i != n || (t && e.contentDocument.body.childElementCount > 4)
                  ? (e.height = Math.min(i, 600))
                  : ((e.height = 24),
                    (e.height = e.contentDocument.body.scrollHeight)),
                  (e.dataset.userHeight = e.height);
              }
            }
            e.classList.contains("md-html-iframe") ||
              (e.previousElementSibling &&
                (e.previousElementSibling.classList.contains(
                  "md-htmlblock-panel-placeholder"
                ) && e.parentElement.removeChild(e.previousElementSibling),
                File.isNode && e.contentDocument
                  ? e.contentDocument.body
                    ? t(e)
                    : e.contentDocument.addEventListener(
                        "DOMContentLoaded",
                        function (n) {
                          t(e);
                        }
                      )
                  : e.removeAttribute("guest-id"),
                U(e)));
          });
        var M = document.querySelector(
            "#md-htmlblock-panel-novideo-templ"
          ).text,
          L = document.querySelector("#md-htmlblock-panel-nohtml-templ").text;
        function N(e, t, n) {
          var i = e.previousElementSibling;
          (t =
            t
              .replace("http://typora-app", "Typora.app")
              .replace(/^typora:.+/, "") || "blank"),
            i ||
              ((i = document.createElement("div")).classList.add(
                "md-htmlblock-panel-placeholder"
              ),
              e.parentElement.insertBefore(i, e)),
            (i.innerHTML = L),
            (i.querySelector(".md-resouce-error-message").textContent = t),
            (e.height = Math.max((e.height || 0) - 0, 48));
        }
        window.videoOnError = function (e) {
          var t = document.createElement("div");
          t.setAttribute("class", "md-htmlblock-panel-placeholder"),
            (t.innerHTML = M),
            (t.querySelector(".md-resouce-error-message").textContent =
              e.src
                .replace("http://typora-app", "Typora.app")
                .replace(/^wkfile:/, "file:")
                .replace(/^typora:.+/, "") || "blank"),
            e.parentElement.insertBefore(t, e),
            e.classList.add("md-video-load-failed");
        };
        var D = function (e) {
          if (!E.allowWhiteList()) return !1;
          var t = e.querySelectorAll("script");
          return (
            1 == t.length &&
            t[0].parentElement == e &&
            P(t[0].getAttribute("src"))
          );
        };
        E.checkIsWhiteList = function (e) {
          if (!E.allowWhiteList()) return !1;
          if ("script" == e.get("style")) {
            var t = (function (e) {
              var t = document.createElement("template");
              return (t.innerHTML = e), t.content;
            })(e.get("text"));
            if (1 == t.childElementCount) {
              var n = t.firstElementChild;
              return "SCRIPT" == n.tagName && P(n.getAttribute("src"));
            }
          }
        };
        var B = {
            gist: /^https:\/\/gist\.github\.com\/.*\.js/,
            jsfiddle:
              /^https:\/\/jsfiddle\.net\/([^\/]+\/)?[^\/]+\/embed(\?|\/|$)/,
          },
          R = [
            "https://platform.twitter.com/widgets.js",
            "https://static.codepen.io/assets/embed/ei.js",
            "https://cssdeck.com/assets/js/embed.js",
            "https://www.instagram.com/embed.js",
            "https://s.imgur.com/min/embed.js",
            "https://speakerdeck.com/assets/embed.js",
          ];
        function P(e) {
          e = /^\/\//.exec((e = e || ""))
            ? "https:" + e
            : e.replace(/^http:/, "https:");
          try {
            e = new URL(e).href;
          } catch (e) {}
          return R.indexOf(e) > -1 || !!B.gist.exec(e) || !!B.jsfiddle.exec(e);
        }
        var I = new DOMParser();
        function O(e, t, n) {
          var i = (
            I.parseFromString("<body>" + e + "</body>", "text/html") || {}
          ).body;
          return (
            i || ((i = document.createElement("body")).innerHTML = e),
            t && D(i)
              ? ((t.whitelistMode = !0),
                t.ADD_TAGS
                  ? t.ADD_TAGS.push("script")
                  : (t.ADD_TAGS = ["script"]),
                (t.FORBID_ATTR = ["contenteditable"]),
                (t.ALLOW_DATA_ATTR = !0),
                i.classList.add("md-preview-body"),
                i)
              : n
              ? i
              : (i.querySelectorAll("[role='wrapper']").forEach(function (e) {
                  e.removeAttribute("role");
                }),
                i.querySelectorAll("iframe, video").forEach(function (e) {
                  var t = document.createElement("div");
                  t.setAttribute("role", "wrapper"),
                    e.parentElement.replaceChild(t, e),
                    t.appendChild(e);
                }),
                i)
          );
        }
        var $ = 2;
        l.addHook("beforeSanitizeElements", function (e) {
          return e.id && e.setAttribute("ty-id", e.id), e;
        }),
          l.addHook("afterSanitizeAttributes", function (e, t, n) {
            var i = e && e.nodeType == e.ELEMENT_NODE && e.style;
            if (i) {
              var r = e.getAttribute("src");
              /^\/\//.exec(r || "") && e.setAttribute("src", "https:" + r);
              var o = e.getAttribute("href");
              /^\/\//.exec(o || "") && e.setAttribute("href", "https:" + o);
            }
            if (
              !n.whitelistMode &&
              (i &&
                (n.forHTMLBlock
                  ? e.parentElement &&
                    "BODY" == e.parentElement.tagName &&
                    "none" == e.style.display &&
                    (e.style.display = "")
                  : p.isType(e.style.display, "inline", "inline-block") ||
                    (e.style.display = ""),
                (n.forHTMLBlock &&
                  !p.isType(e.style.position, "fixed", "sticky", "absolute")) ||
                  (e.style.position = "")),
              n.forHTMLBlock)
            ) {
              if (i) {
                if (p.isType(e.tagName.toLowerCase(), "iframe")) {
                  if (
                    (n.forPrint || e.setAttribute("guest-id", ++$),
                    (r = e.getAttribute("src")) &&
                      e.setAttribute("src", r.replace(/^\/\//, "https://")),
                    "iframe" == e.tagName.toLowerCase())
                  ) {
                    if (
                      (e.setAttribute("allow-top-navigation", "false"),
                      e.setAttribute("allow-forms", "false"),
                      e.setAttribute("allowfullscreen", "true"),
                      e.setAttribute("allow-popups", "false"),
                      e.srcdoc)
                    )
                      return void e.setAttribute("sandbox", "");
                    /^data:/.exec(r) && File.isMac
                      ? e.setAttribute(
                          "sandbox",
                          "allow-scripts allow-same-origin"
                        )
                      : /^(https?)?:[\\\/]/.exec(r)
                      ? File.isMac || /^https?:/.exec(r)
                        ? e.setAttribute(
                            "sandbox",
                            "allow-scripts allow-same-origin allow-popups"
                          )
                        : e.setAttribute("sandbox", "allow-scripts")
                      : e.setAttribute("sandbox", "allow-same-origin"),
                      /^typora/.exec(r) && ((r = "about:blank"), (e.src = r)),
                      n.forPrint ||
                        e.setAttribute(
                          "onLoad",
                          "window.remoteOnLoad && window.remoteOnLoad(this)"
                        ),
                      (r = e.getAttribute("src")),
                      File.editor.imgEdit &&
                        !/[a-z]+:/.exec(r) &&
                        (e.src = File.editor.imgEdit.getAbsolutePath(r, !0));
                  }
                  if (
                    !n.forPrint &&
                    "wrapper" == e.parentElement.getAttribute("role")
                  ) {
                    var s = document.createElement("div");
                    s.setAttribute("class", "md-htmlblock-panel-placeholder"),
                      (s.innerHTML =
                        '<div class="ty-lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>'),
                      e.parentElement.insertBefore(s, e);
                  }
                }
                if (
                  p.isType(
                    e.tagName.toLowerCase(),
                    "video",
                    "audio",
                    "img",
                    "source"
                  )
                )
                  (r = e.getAttribute("src")) &&
                    (function (e) {
                      var t = e.getAttribute("src");
                      if (((e.dataset.src = t), File.editor.imgEdit)) {
                        var n = File.editor.imgEdit.getAbsolutePath(t, !0);
                        a.fromExternalPath(n) && (n = a.file2wkfile(n)),
                          (e.src = n);
                      }
                    })(e);
                p.isType(e.tagName.toLowerCase(), "video") &&
                  (n.forPrint ||
                    (e.setAttribute("controlsList", "nodownload"),
                    e.setAttribute("onError", "window.videoOnError(this)")),
                  e.getAttribute("poster") &&
                    e.setAttribute(
                      "poster",
                      editor.imgEdit.getAbsolutePath(
                        e.getAttribute("poster"),
                        !0
                      )
                    )),
                  !n.forPrint &&
                    p.isType(e.tagName.toLowerCase(), "audio") &&
                    (e.setAttribute("controlsList", "nodownload"),
                    e.setAttribute("controls", ""));
              }
              return e;
            }
          });
        document.querySelector("#ty-resize-temp");
        function H(e) {
          if (File.isNode) return e.contentDocument;
          try {
            return e.contentDocument;
          } catch (e) {}
          return null;
        }
        function U(e, t) {
          e &&
            !e.srcdoc &&
            e &&
            (H(e) || {}).body &&
            (0 !== e.src.indexOf(e.contentWindow.location.protocol) &&
              ("about:blank" == e.contentWindow.location.href && N(e, e.src),
              e.contentDocument.body.childNodes.length +
                e.contentDocument.head.childNodes.length ==
                0 && N(e, e.src)),
            e.removeAttribute("guest-id"));
        }
        (window.turnOnIframeRefreshTimer = function (e, t) {
          setTimeout(function () {
            U(document.querySelector("iframe[guest-id='" + e + "']"));
          }, 2e3);
        }),
          (E.UNSFAE_TAGS = [
            "script",
            "video",
            "audio",
            "iframe",
            "img",
            "source",
            "form",
            "object",
            "embed",
            "applet",
            "body",
            "frameset",
            "input",
            "link",
          ]),
          (E.convertToXHTML = function (e) {
            try {
              var t = new DOMParser().parseFromString(e, "text/html");
              return new XMLSerializer().serializeToString(t);
            } catch (e) {}
            return e;
          }),
          (E.buildHTMLForExport = function (e, t, n, i) {
            var r;
            if (!n) return e;
            if (/^(<\/?(div|p)[^>]*>\s*)+$/.exec(e)) return e;
            var o = E.getDomPurifyConfig(T);
            return (r = O(e, o, !0)).firstChild
              ? ((r = l.sanitize(r, o))
                  .querySelectorAll("iframe, video, audio, img")
                  .forEach(function (e) {
                    var r = e.getAttribute("src");
                    if (
                      (/^\/\//.exec(r)
                        ? (e.src = "https:" + r)
                        : n &&
                          r &&
                          ((e.src = window.addDateQuery(
                            t.imgEdit.getAbsolutePath(r, !0)
                          )),
                          "iframe" != e.tagName.toLowerCase() &&
                            e.setAttribute(
                              "onError",
                              "this.style.display = 'none';"
                            )),
                      n &&
                        "iframe" == e.tagName.toLowerCase() &&
                        (e.setAttribute("sandbox", ""),
                        e.setAttribute("allow-popups", "false"),
                        /^https?:/.exec(e.src) &&
                          e.setAttribute("sandbox", "allow-scripts")),
                      "video" == e.tagName.toLowerCase())
                    )
                      if (!0 === n && i) {
                        var o = t.findElemById(i.cid).find("video");
                        if (1 !== o.length || !o[0].videoHeight) return;
                        var a =
                          t.imgEdit.getAbsolutePath(
                            o[0].getAttribute("poster"),
                            !0
                          ) || E.getVideoScreenshot(o[0]);
                        if (a.length > 9e4) return;
                        var s = e.attributes,
                          l = e.parentElement,
                          c = Array.prototype.indexOf.call(l.childNodes, e);
                        (e.outerHTML = "<img />"), (e = l.children[c]);
                        for (var d = s.length - 1; d >= 0; d--)
                          e.setAttribute(s[d].name, s[d].value);
                        e.src = a;
                      } else
                        "epub" === n &&
                          (e.removeAttribute("controls"),
                          e.removeAttribute("controllist"));
                  }),
                r.innerHTML)
              : "";
          }),
          (E.buildHTML = function (e) {
            var t = E.getDomPurifyConfig({ forHTMLBlock: !0 }),
              n = O(e.get("text"), t);
            return n.firstChild
              ? (n = l.sanitize(n, t)).classList.contains("md-preview-body")
                ? (function (e, t, n) {
                    e.classList.add("md-html-iframe"),
                      (e.sandbox =
                        "allow-same-origin allow-scripts allow-popups"),
                      e.setAttribute("seamless", "seamless"),
                      e.setAttribute("allow-top-navigation", "false"),
                      e.setAttribute("allow-forms", "false"),
                      e.setAttribute("allowfullscreen", "true"),
                      (e.height = 20),
                      (e.srcdoc =
                        "<html><head><script>window.reqnode = undefined;window.require = undefined;</script><style type='text/css'>iframe {margin: auto;}</style></head><body>" +
                        t +
                        "<script>" +
                        j.replace(/\s*\n\s*/g, "") +
                        "\niframePreloadScript('" +
                        n +
                        "');</script></body></html>");
                    var i = e.outerHTML;
                    return e.remove(), i;
                  })(document.createElement("iframe"), n.innerHTML, e.cid)
                : (n.querySelectorAll("iframe").forEach(function (t) {
                    var n = t.getAttribute("guest-id") - 0;
                    if (File.isNode) {
                      var i = document.createElement("webview");
                      for (var r in (t.replaceWith(i),
                      (i.src = t.src),
                      t.attributes)) {
                        let e = t.attributes.item(r);
                        i.setAttribute(e.name, e.value);
                      }
                      let e = document.createElement("script");
                      return (
                        (e.innerHTML = `var w = document.querySelector("[guest-id='${n}']");loadedWebview(w);`),
                        i.parentElement.appendChild(e),
                        t.height && (i.style.height = t.height + "px"),
                        i.setAttribute(
                          "webpreferences",
                          "webViewGuestId=" + n + ", webviewTag=no"
                        ),
                        i.setAttribute("autosize", "autosize"),
                        void i.setAttribute("nodeintegration", !1)
                      );
                    }
                    if ((n = t.getAttribute("guest-id") - 0) && !isNaN(n)) {
                      var o = document.createElement("SCRIPT");
                      o.setAttribute("data-run", "true"),
                        (o.type = "text/javascript"),
                        (o.text =
                          "turnOnIframeRefreshTimer(" +
                          n +
                          ", '" +
                          e.cid +
                          "')"),
                        t.parentElement.appendChild(o);
                    }
                  }),
                  n.innerHTML)
              : "";
          }),
          (E.getVideoScreenshot = function (e) {
            var t = document.querySelector("#video-canvas"),
              n = t.getContext("2d");
            (t.width = e.videoWidth), (t.height = e.videoHeight);
            try {
              return (
                n.drawImage(e, 0, 0, e.videoWidth, e.videoHeight), t.toDataURL()
              );
            } catch (e) {
              console.warn(e);
            }
            return "";
          });
        var j = document.querySelector(
          "#md-html-iframe-preload-temp"
        ).innerHTML;
        (E.autoCloseTagWhenInput = function (e, t, n, i, r, o) {
          if (
            0 !=
            ("/" === t &&
              o.startContainer.nodeType === document.TEXT_NODE &&
              "<" ===
                o.startContainer.nodeValue.substring(
                  o.startOffset - 1,
                  o.startOffset
                ) &&
              void 0)
          ) {
            var a = (function () {
              var e = s(o.startContainer.parentElement)
                .prev("[md-inline='tag']")
                .text();
              if (e && !/\/>/.exec(e)) {
                var t = (/<([A-Za-z1-9]+)/.exec(e) || [])[1];
                return y.indexOf(t) > -1 ? t : void 0;
              }
            })();
            return a
              ? (function (t) {
                  r && e.undo.register(r);
                  var a,
                    s,
                    l = document.createTextNode("/" + t + ">");
                  return (
                    o.insertNode(l),
                    l.parentElement.normalize(),
                    (a = t.length + 2),
                    (s = e.selection.rangy.createRange()),
                    (i.end += a),
                    (i.start += a),
                    s.moveToBookmark(i),
                    s.select(s.isBackward),
                    r && r.redo.push(e.selection.buildUndo()),
                    e.undo.addSnap(n.cid, h.REPLACE),
                    !0
                  );
                })(a)
              : void 0;
          }
        }),
          (E.prototype.autoCloseTagWhenInput = E.autoCloseTagWhenInput),
          (E.BLOCK_OPEN_REG = b),
          (E.INLINE_TYPE = f),
          (E.ALL_INLINE_TYPE = g),
          (E.HIDDEN_TYPE = m),
          (E.NO_TEXT_BLOCK_TYPE = [
            "html",
            "body",
            "script",
            "style",
            "meta",
            "noscript",
            "template",
            "head",
            "canvas",
            "link",
          ]),
          (E.BLOCK_TYPE = v),
          (E.autoCloseTag = function (e) {
            var t = e.get("text"),
              n = (/^[ \t]+/.exec(t) || [""])[0],
              i = e.get("style"),
              r = e.get("depth");
            if (!(w.indexOf(i) > -1)) {
              for (
                r && (t += "\n" + n + " ".repeat(File.option.codeIndentSize));
                r;

              )
                r--, (t += "\n" + n + "</" + i + ">");
              e.set("text", t), e.set("depth", 0);
            }
          }),
          (E.getHTMLTagReg = C),
          (window.DOMPurify = l),
          (n.exports = E);
      }
    ),
    $__System.registerDynamic(
      "19",
      ["11", "13", "30", "1b", "49", "17", "1e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("13"),
          o = r.Node,
          a = r.TYPE,
          s = e("30"),
          l = e("1b"),
          c = e("49"),
          d = e("17"),
          u = e("1e"),
          h = {
            ul: /^(\s*)(([-+*])\s+)/,
            ol: /^(\s*)\d+((\.|\)))\s+/,
            tasklist: /^(\s*)(([-+*])\s*)\[((x|X)| )\]\s+/,
          },
          p = /^(\s*)([-+*>\[]|\d+(\.|\)))\s+/,
          f = /^(\s*)[^\s]/,
          m = null,
          g = {
            ul: /^(\s*)([-+*])\s+/,
            ol: /^(\s*)(\d+(\.|\)))\s+/,
            tasklist: /^(\s*)([-+*]\s*\[((x|X)| )\])\s+/,
          },
          v = {
            ul: /^(\s{0,3})([-+*])\s+/,
            ol: /^(\s{0,3})(\d+(\.|\)))\s+/,
            tasklist: /^(\s{0,3})([-+*]\s*\[((x|X)| )\])\s+/,
          },
          y = /\r\n|\r|\n|\u2424/,
          b = /^[ \u00A0]{0,3}$/,
          w = /^[\s\u00A0]*$/,
          x = /(^[ \u00A0]{0,3}>\s*)(.*)$/,
          C = /(^\s*(#{1,6})\s*)([^\n]+?)(\s+#+\s*)*$/,
          F = /(^\s*(#{1,6})\s+)([^\n]+?)(\s+#+\s*)*$/,
          S = /^ *(=|-){2,}[\s\u00A0]*$/,
          k = /^\s*[-+*_<\[\{|#0-9`~=>$]/,
          E = /^( *(`{3,}|~{3,})[ \t\u00A0]*)([^\n`]+)? *$/,
          T = /^\s*(`{3,}|~{3,})\s*$/,
          _ = /^\s*\${2}\s*(?:\{(.+)\})?$/,
          A = /^( {4}|(?: {0,3}\t))(\s*\S.*)$/,
          M = /^( {4}|(?: {0,3}\t))/,
          L = /^\s*([-+_*])\s*\1\s*\1(\s|\1)*$/,
          N = /^\s*\[toc\]\s*$/i,
          D = /^\s*\{:toc\}\s*$/i,
          B = /^\s*\[\[_TOC_\]\]\s*$/,
          R = /^\s?\{:\s*toc(\s*|(\s+.*))\}/,
          P =
            /^\s*\[([^\]]+)\]:(\s*<?)([^\s>]+)(>?)((\s+)(["'(])([^\n]*)(["')]))?\s*$/,
          I = /^\s*\[\^([^\]\n]+)\]:(\s*)([^\n]*)$/,
          O = /^-{3}$/,
          $ = /^ *\|([^\|]+\|.+)\|\s*$/,
          H = /^\s*\|(\s*[-:]+\s*\|[-|\s:]*)$/,
          U = /^\s*([-:]+\s*\|[-|\s:]*)$/,
          j = /\|/,
          q = d.BLOCK_OPEN_REG,
          W = /^\s*[-\u2013\u2014+*_<\u3010\[\{|#0-9`~=>$]/,
          z = /^\s*([-\u2013\u2014])/,
          V = /^\s*[\[\u3010]toc[\]\u3011]\s*$/i,
          J = /^(-{3}|\u2013[-\u2013\u2014]+|\u2014[-\u2013\u2014]*)$/,
          K = [
            /^\s*([-+*]|(\d+[\.\)]))\s/,
            /^\s*(>|```|---)/,
            /^\s*#{1,6}/,
            A,
            q,
          ],
          Y = [
            /^\s*([-+*]|(\d+[\.\)]))\s/,
            /^\s*(>|```|---)/,
            /^\s*#{1,6}\s+/,
            A,
            q,
          ],
          G = {},
          Q = {},
          X = {},
          Z = {},
          ee = "  ",
          te = function (e) {
            if (e.get("style") == o.ListType.ol) {
              for (
                var t = (function (e) {
                    if (e.get("style") == o.ListType.ol) {
                      for (
                        var t = e.getFirstChild(), n = !1, i = t.get("after");
                        i && i._numText;

                      ) {
                        if (t._numText.trim() != i._numText.trim()) return !1;
                        (n = !0), (i = (t = i).get("after"));
                      }
                      return n;
                    }
                  })(e),
                  n = e.getFirstChild(),
                  i = n._numText;
                n;

              )
                (n._numText = void 0), (n = n.get("after"));
              t && e.set("pattern", i), e.set("isFixed", t);
            }
          },
          ne = function (e) {
            return (e || "").replace(/\t/g, ee).length;
          },
          ie = {
            NOT_CLOSE: 0,
            CLOSE_EXCLUDE: 1,
            CLOSE_INCLUDE: 2,
            UNKNOWN: -1,
          },
          re = d.getHTMLTagReg,
          oe = {
            paragraph: {
              shouldClose: function (e) {
                return e.match(b)
                  ? (this.cur.set("tail", 1), ie.CLOSE_INCLUDE)
                  : ie.UNKNOWN;
              },
              onClose: function (e) {
                this.cur._lines.length > 1 &&
                  this.cur._lines[0].match(w) &&
                  (this.cur.set("ahead", 1), this.cur._lines.shift()),
                  !this.cur._lines.length && this.cur._lines.push(""),
                  this.cur.set("text", this.cur._lines.join("\n")),
                  void 0 == this.cur.get("tail") &&
                    !e &&
                    this.cur._lines.last().trim() &&
                    this.cur.set("tail", 0),
                  (this.cur._lines = void 0);
              },
              onContinue: function (e) {
                this.cur._lines.push(e);
              },
            },
            html_block: {
              shouldClose: function (e) {
                var t,
                  n = this.cur.get("depth") || 0,
                  i = re(this.cur.get("style")),
                  r = e;
                if (!e.trim()) return ie.CLOSE_EXCLUDE;
                for (; (t = i.exec(r)); )
                  (r = r.substring(t.index + t[0].length)),
                    t[2] ? n-- : t[1] || n++;
                return n <= 0
                  ? (this.cur.set("depth", 0),
                    this.cur._lines.push(e),
                    ie.CLOSE_INCLUDE)
                  : (this.cur.set("depth", n), ie.NOT_CLOSE);
              },
              onClose: function () {
                var e = this.cur.get("depth");
                this.cur.set("text", this.cur._lines.join("\n")),
                  e &&
                    this.skips.enableStartMatch &&
                    (1 != this.cur._lines.length || />/.exec(this.cur._lines[0])
                      ? d.autoCloseTag(this.cur)
                      : (this.cur.set("type", a.paragraph),
                        this.cur.unset("style"))),
                  (this.cur._lines = void 0);
              },
              onContinue: function (e) {
                this.cur._lines.push(e);
              },
            },
            blockquote: {
              shouldClose: function (e) {
                return e.trim().length
                  ? e.match(x)
                    ? ie.NOT_CLOSE
                    : e.match(/\t|( {2,})/)
                    ? ie.NOT_CLOSE
                    : ie.UNKNOWN
                  : (this.cur.set("tail", 1), ie.CLOSE_INCLUDE);
              },
              onClose: function () {
                new se(this.cur._lines, this.cur, null, null, this.skips),
                  (this.cur._lines = void 0),
                  this.cur.unset("text"),
                  (this.skips || {}).pass_format ||
                    this.cur.set("userIndent", this.cur._lineIndents),
                  (this.cur._lineIndents = void 0);
              },
              onContinue: function (e) {
                var t = this.cur._indent;
                G[t] ||
                  (G[t] = new RegExp(
                    "^((( {0," +
                      (t + 4) +
                      "}|\\t)> {0," +
                      (t || 1) +
                      "})|(\\t| {2})|>(\\t| {0," +
                      (t || 1) +
                      "}))"
                  ));
                var n = G[t].exec(e) || [""],
                  i = n[0];
                (!n[2] &&
                  (n[4] || "").length > 0 &&
                  ((n[2] = "> ".substr(0, i.length)),
                  (e = n[2] + e.substring(i.length))),
                (this.cur._indentSensitive =
                  this.cur._indentSensitive ||
                  /^\s*([-+*>]|\d+(\.|\)))\s/.exec(e.substring(i.length))),
                n[2] && t < 4 && !this.cur._indentSensitive) &&
                  (Q[t] || (Q[t] = new RegExp("^( {1," + (4 - t) + "}|\\t)>")),
                  Q[t].exec(e.substring(i.length)) ||
                    (i += (new RegExp("^ {1," + (4 - t) + "}").exec(
                      e.substring(i.length)
                    ) || [""])[0]));
                /^\s*>*\s*$/.exec(e)
                  ? (this.cur._lineIndents.push(e), this.cur._lines.push(""))
                  : (this.cur._lineIndents.push(i),
                    this.cur._lines.push(e.substring(i.length)));
              },
            },
            list: {
              shouldClose: function (e) {
                var t,
                  n = this.cur.getLastChild();
                return (
                  X[n._indent] ||
                    (X[n._indent] = new RegExp("^( {" + n._indent + ",}|\\t)")),
                  e.match(X[n._indent])
                    ? (this.cur.unset("tail"), ie.NOT_CLOSE)
                    : e.match(w)
                    ? (this.cur.set("tail", (this.cur.get("tail") || 0) + 1),
                      this.cur.get("tail") > 1
                        ? (this.cur.set("tail", 1), ie.CLOSE_EXCLUDE)
                        : ie.NOT_CLOSE)
                    : e.match(L)
                    ? ie.CLOSE_EXCLUDE
                    : n._minIndent < n._indent &&
                      (X[n._minIndent] ||
                        (X[n._minIndent] = new RegExp(
                          "^( {" + n._minIndent + ",})"
                        )),
                      e.match(X[n._minIndent]))
                    ? (this.cur.unset("tail"),
                      (n._indent = /^\s+/.exec(e)[0].length),
                      (n._indentDecided = !1),
                      ie.NOT_CLOSE)
                    : (t = h[this.cur.get("style")].exec(e))
                    ? t[3] == this.cur._mark
                      ? 0
                      : 1
                    : this.lines[this.ln - 1].match(w)
                    ? ie.CLOSE_EXCLUDE
                    : ie.UNKNOWN
                );
              },
              onClose: function () {
                for (
                  var e = this.cur.getLastChild(),
                    t = this.cur.get("tail") || 0;
                  t > 0 && !e._lines.last().trim().length;

                )
                  e._lines.pop(), e._lineIndents.pop(), t--;
                new se(e._lines, e, null, null, this.skips),
                  e.unset("text"),
                  (this.skips || {}).pass_format ||
                    e.set("userIndent", e._lineIndents),
                  (e._lines = void 0),
                  (e._indent = void 0),
                  (e._minIndent = void 0),
                  (e._indentDecided = void 0),
                  (e._lineIndents = void 0),
                  (this.cur._mark = void 0),
                  this.cur.unset("text"),
                  (this.skips || {}).pass_format ||
                    (te(this.cur),
                    !this.cur.get("tail") &&
                      this.lines[this.ln] &&
                      this.cur.set("tail", 0));
              },
              onContinue: function (e, t, n) {
                var i,
                  r = this.cur.getLastChild(),
                  s = ne(t),
                  l = File.option.strictMarkdown ? s - n : 2,
                  c = this.cur.get("style"),
                  d = 0;
                const u = /^\s*(\d+)(\.|\))\s+/,
                  g = /^\s*(\d+(\.|\))\s+)/;
                function v(e, t, n) {
                  n && (e._lines = []),
                    e._lines.push(t),
                    e.set("userIndent", e._lineIndents);
                }
                var y, b;
                if (
                  ((n = n || (r ? r.get("prespace") : 0) || 0),
                  e.match(w) || this.cur.unset("tail"),
                  !r)
                )
                  return (
                    c == o.ListType.ol && (d = u.exec(e)[1].length - 1),
                    (r = new o({
                      type: a.list_item,
                      prespace: n,
                      markindent: s - d - n,
                    })),
                    this.cur.appendChild(r),
                    (r._indent = l + n),
                    (r._minIndent = d + (c == o.ListType.ol ? 3 : 2) + n),
                    c == o.ListType.ol &&
                      ((r._numText = (g.exec(e) || [])[1]), (r._numLength = d)),
                    (b = h[o.ListType.task].exec(e))
                      ? (r.set("checked", !!b[5]),
                        r.set("style", o.ListType.task),
                        (y = b[0]))
                      : (y = h[c].exec(e)[0]),
                    (r._lineIndents = [y]),
                    void v(r, e.substring(y.length), !0)
                  );
                (r._numLength = r._numLength || 0),
                  X[r._indent] ||
                    (X[r._indent] = new RegExp("^( {" + r._indent + ",}|\\t)"));
                var x,
                  C,
                  F = e.match(X[r._indent]);
                if (
                  (Z[r._indent] ||
                    (r._indent < 2 && (Z[r._indent] = new RegExp("^\\t")),
                    (Z[r._indent] = new RegExp(
                      "^( {2," + r._indent + "}|\\t)"
                    ))),
                  (x = (e.match(Z[r._indent]) || [""])[0].length),
                  (y = (Z[r._indent].exec(e) || [""])[0]),
                  (e = F ? e.substring(y.length) : e),
                  r.get("style") == o.ListType.task &&
                    !File.option.strictMarkdown &&
                    F &&
                    ((y += (e.match(/^ {4}/) || [""])[0]),
                    (e = e.replace(/^ {4}/, ""))),
                  !F && (i = m[c].exec(e)))
                )
                  return (
                    (n = (i[1] || "").length),
                    (t = i[0]),
                    (s = ne(t)),
                    (l = File.option.strictMarkdown ? s - n : 2),
                    r._lines.length > 1 && r._lines.last().match(w)
                      ? (r._lines.pop(), r.set("tail", 1))
                      : r.set("tail", 0),
                    this.cur.unset("tail"),
                    new se(r._lines, r, null, null, this.skips),
                    (this.skips || {}).pass_format ||
                      r.set("userIndent", r._lineIndents),
                    r.unset("text"),
                    (r._lines = void 0),
                    (r._lineIndents = void 0),
                    (r._indent = void 0),
                    c == o.ListType.ol && (d = u.exec(e)[1].length - 1),
                    ((r = new o({
                      type: a.list_item,
                      prespace: n,
                      markindent: s - d - n,
                    }))._numLength = d),
                    (r._numText = (g.exec(e) || [])[1]),
                    (r._minIndent = d + (c == o.ListType.ol ? 3 : 2) + n),
                    (y = i[0]),
                    (b = h[o.ListType.task].exec(e)) &&
                      (r.set("checked", !!b[5]),
                      r.set("style", o.ListType.task),
                      (y = b[0])),
                    this.cur.appendChild(r),
                    (r._indent = l + n),
                    (r._lineIndents = [y]),
                    void v(r, e.substring(y.length), !0)
                  );
                if (!r._indentDecided) {
                  if ((i = f.exec(e)) && r._indent && r._indent - n < 4)
                    if (i[1].length) {
                      var S = i[1].replace(/\t/, "    ").length,
                        k = S + r._indent;
                      k > n + r.get("markindent") &&
                      ((C = r._lines),
                      p.exec(
                        (function (e) {
                          if (!e || 0 == e.length) return "";
                          for (var t = e.length - 1; t >= 0; t--)
                            if (e[t].trim().length > 0) return e[t];
                          return "";
                        })(C)
                      ))
                        ? (S = r.get("markindent") - r._indent)
                        : k >= n + r.get("markindent") + 4 &&
                          (S = S + r._indent - 4 - r.get("markindent")),
                        (r._indent += S),
                        this.cur.set("subindent", r._indent - r._numLength),
                        r.set("subindent", r._indent - r._numLength),
                        (y += e.substring(0, S)),
                        (e = e.substring(S));
                    } else r.set("subindent", Math.max(2, x - r._numLength));
                  r._indentDecided = !!i;
                }
                return r._lineIndents.push(y), void v(r, e, !1);
              },
            },
            fences: {
              shouldClose: function (e) {
                var t;
                if ((t = T.exec(e))) {
                  var n =
                    t[1][0] == this.cur._mark[0] &&
                    t[1].length >= this.cur._mark.length
                      ? ie.CLOSE_INCLUDE
                      : ie.NOT_CLOSE;
                  return (
                    n == ie.CLOSE_INCLUDE &&
                      this.cur._mark != t[1] &&
                      this.cur.set("patternEnd", t[0]),
                    n
                  );
                }
                return ie.NOT_CLOSE;
              },
              onContinue: function (e) {
                this.cur._lines.push(e);
              },
              onClose: function (e) {
                let t = this.cur.get("pattern"),
                  n = (/^\s+/.exec(t) || [""])[0];
                if (n) {
                  let e = !0;
                  for (let t of this.cur._lines)
                    if (0 != t.indexOf(n)) {
                      e = !1;
                      break;
                    }
                  e &&
                    ((this.cur._lines = this.cur._lines.map((e) =>
                      e.substr(n.length)
                    )),
                    this.cur.set("userIndent", n));
                }
                this.cur.set("text", this.cur._lines.join("\n")),
                  this.cur.set("empty", !this.cur._lines.length),
                  e && this.cur.set("noCloseTag", !0),
                  (this.cur._mark = void 0),
                  (this.cur._lines = void 0);
                var i = this.lines[this.ln + 1];
                void 0 !== i &&
                  i.match(w) &&
                  (this.cur.set("tail", 1), this.ln++);
              },
            },
            code: {
              shouldClose: function (e) {
                return e.match(A)
                  ? ie.NOT_CLOSE
                  : e.trim().length
                  ? ie.CLOSE_EXCLUDE
                  : this.cur._lines.length > 1 &&
                    !this.cur._lines.last().trim().length
                  ? ie.CLOSE_EXCLUDE
                  : ie.NOT_CLOSE;
              },
              onClose: function () {
                var e = this.lines[this.ln];
                e && !e.trim().length && this.cur._lines.push(e.replace(M, "")),
                  this.cur._lines.length > 1 &&
                    (this.cur._lines.last().match(w)
                      ? (this.cur.set("tail", 1),
                        this.cur._lines.pop(),
                        this.cur._lines.length > 1 &&
                          this.cur._lines.last().match(w) &&
                          (this.cur._lines.pop(), this.ln--))
                      : this.cur.set("tail", 0)),
                  this.cur.set("text", this.cur._lines.join("\n")),
                  (this.cur.attributes.type = a.fences),
                  (this.cur._lines = void 0);
              },
              onContinue: function (e) {
                this.cur._lines.push(e.replace(M, ""));
              },
            },
          };
        function ae(e, t, n) {
          function i(e) {
            return (
              (e[0] || "").trim().length || (e = e.subarray(1)),
              (e.last() || "").trim().length ||
                (e = e.subarray(0, e.length - 1)),
              e
            );
          }
          var r,
            o = "",
            a = "",
            s = "",
            l = "",
            c = [],
            d = [],
            u = 0,
            h = File.option.strictMarkdown ? Y : K;
          for (var p of h) if (p.exec(e)) return null;
          if (-1 == e.indexOf("|"))
            for (var p of [L, N, D, B, R]) if (p.exec(e)) return null;
          if (
            ((e = e.replace(
              /(^|[^\\])((`+)([\s\S]*?[^`])\3(?!`))/g,
              function (e, t, n) {
                return c.push(n), [t, o, ++u - 1, a].join("");
              }
            )),
            File.option.enableInlineMath &&
              ((u = 0),
              (e = e
                .replace(/\\\$/g, "")
                .replace(
                  /(^|[^\\])((\$+)([\s\S]*?[^$])\3(?!\$))/g,
                  function (e, t, n) {
                    return (
                      d.push(n.replace(/\uE07D/g, "\\$")),
                      u++,
                      [t.replace(/\uE07D/g, "\\$"), s, u - 1, l].join("")
                    );
                  }
                ))),
            (r = (e = e
              .replace(/\\\\/g, he.ESCAPE_ESCAPE)
              .replace(/\\\|/g, he.ESCAPE_VLINE)
              .replace(/\\\ /g, he.ESCAPE_SPACE)).split(j) || [e]),
            "|" == e.trim() || !e.trim())
          )
            return null;
          if (
            ((r = i(r)),
            File.option.enableInlineMath &&
              ((e = e.replace(/\uE071(\d+)\uE072/g, function (e, t) {
                return d[t - 0];
              })),
              r.length < n))
          ) {
            var f = i(e.split(j));
            f.length == n && (r = f);
          }
          for (u = r.length; u < n; u++) r.push("");
          return r.map(function (e) {
            return (t = e
              .replace(/\uE022/g, "\\ ")
              .replace(new RegExp("", "g"), "\\$")
              .replace(/\uE071(\d+)\uE072/g, function (e, t) {
                return d[t - 0];
              })
              .replace(/\uE07A(\d+)\uE07B/g, function (e, t) {
                return c[t - 0];
              }))
              ? t
                  .replace(new RegExp(he.ESCAPE_ESCAPE, "g"), "\\\\")
                  .replace(new RegExp(he.ESCAPE_VLINE, "g"), "\\|")
              : t;
            var t;
          });
        }
        var se = function (e, t, n, i, r) {
          m = File.option.strictMarkdown ? v : g;
          var o = e;
          (this.remap =
            File.shouldRemapPunctuation() &&
            (r.enableRemap || (i && i.cid == File.editor.focusCid))),
            "string" == typeof e &&
              ((o = e.split(y)),
              "\n" === e.charCodeAt(e.length - 1) && (a -= 1));
          var a = o.length;
          for (
            this.lines = o,
              (function (e, t, n, i, r) {
                (e.parent = t),
                  (e.cur = null),
                  (e.skips = r),
                  (e.ln = 0),
                  (e.blocks = []),
                  (e.oldNode = i),
                  (e.nodeMap = t || i),
                  (e.nodeMap = (e.nodeMap ? e.nodeMap.get("in") : n) || n),
                  (ee = " ".repeat(File.option.indentSize));
              })(this, t, n, i, r),
              this.skips.enableMetaBlock = this.skips.enableMetaBlock && !t;
            this.ln <= a;
            this.ln++
          )
            le.call(this, o[this.ln], a);
          for (var s = this.blocks.last(); s; )
            (t && 0 != s.get("tail")) || s.unset("tail"),
              (s = s.getLastChild());
          return this;
        };
        function le(e, t) {
          var n,
            r,
            s,
            l = this.ln >= t;
          function c(e) {
            if (
              o.isType(this.cur, a.paragraph) &&
              this.cur._lines &&
              1 == this.cur._lines.length &&
              this.cur._lines[0].match(w)
            )
              return (
                function (e) {
                  this.blocks.remove(e), e.remove();
                }.call(this, this.cur),
                (this.cur = null),
                e.set("ahead", 1),
                !0
              );
          }
          function u(e) {
            var t = this.lines[this.ln + 1];
            if (void 0 !== t && t.match(w))
              return this.ln++, e.set("tail", 1), !0;
            void 0 !== t && e.set("tail", 0);
          }
          function p(e, t) {
            var n,
              i = (e = e || this.cur);
            this.oldNode && !this.blocks.length
              ? (this.oldNode !== e &&
                  ((n = e.get("userIndent")),
                  this.oldNode.appendChildrenTillEnd(e.getFirstChild()),
                  this.oldNode.copyContentFrom(e),
                  this.oldNode.set("userIndent", n),
                  e._lines && (this.oldNode._lines = e._lines),
                  e.remove()),
                this.blocks.push(this.oldNode),
                (i = this.oldNode))
              : (this.parent
                  ? this.parent.appendChild(e)
                  : this.blocks.length
                  ? this.blocks.last().addAfter(e)
                  : (console.sendError("parse error", "error", e.getText()),
                    e.set("parent", this.parent),
                    e.set("in", this.nodeMap),
                    e.set("attachTo", this.nodeMap)),
                this.blocks.push(e)),
              (this.cur = t ? i : null);
          }
          function f(e, n) {
            this.cur &&
              (!o.isType(this.cur, a.paragraph) ||
              (this.cur._lines || []).length
                ? (s.onClose && s.onClose.call(this, n),
                  (n || this.ln < t - 1) &&
                    void 0 == this.cur.get("tail") &&
                    this.cur.set("tail", 0),
                  p.call(this, this.cur, e))
                : (this.cur = null));
          }
          function m(e, t, n) {
            var i = new o({
              type: a.list,
              style: e,
              in: this.nodeMap,
              pattern: t,
            });
            e == o.ListType.ol
              ? (i.set("start", n), (i._mark = (/[\.\)]/.exec(t) || [])[0]))
              : (i._mark = n),
              c.call(this, i),
              f.call(this, void 0, !0),
              (this.cur = i);
          }
          function g(t) {
            var n = t ? U : H;
            if ((i = ae(e))) {
              var i,
                r,
                o,
                a = this.ln + 1,
                s = this.lines.length,
                l = this.lines[a],
                c = null,
                d = [e, l];
              if (a < s && this.lines[a].match(n))
                for (
                  c = [], a++;
                  a < s &&
                  ((r = null), (r = ae((o = this.lines[a]), 0, i.length)));
                  a++
                )
                  d.push(o), c.push(r);
              if (c)
                return (
                  (l = l.replace(/^ *\||\| *$/g, "").split(j)).length ==
                    i.length && (y.call(this, i, l, c, a - 1, t, d), !0)
                );
            }
            return !1;
          }
          function v(e) {
            (r = new o({ type: a.toc, in: this.nodeMap, pattern: e })),
              c.call(this, r),
              u.call(this, r),
              f.call(this, !0),
              p.call(this, r);
          }
          function y(e, t, n, r, s, l) {
            var d,
              h = (this.skips || {}).pass_format,
              m = new o({
                type: a.table,
                in: this.nodeMap,
                style: !h && t && s ? "npTable" : void 0,
              }),
              g = e.length,
              v =
                h ||
                (function (e, t, n) {
                  if (!t || !n) return !0;
                  for (var r = 0; r < e.length; r++) {
                    var o = (e[r] || "").length;
                    if (!(o > 40)) {
                      var a = i.wcswidth(e[r]);
                      if (o != (t[r] || "").length && a != i.wcswidth(t[r]))
                        return !1;
                      for (var s = 0; s < n.length; s++) {
                        var l = (n[s] || [])[r] || "";
                        if (
                          !(l.length > 40) &&
                          o !== l.length &&
                          a != i.wcswidth(l)
                        )
                          return !1;
                      }
                    }
                  }
                  return !0;
                })(e, t, n);
            function y(e, t) {
              var n,
                i = new o({
                  type: a.table_row,
                  parent: e,
                  in: e.get("in"),
                  header: !d,
                  before: d,
                });
              for (b = 0; b < g; b++) {
                var r = (t[b] || "").match(/^\s*/)[0];
                t[b] = (t[b] || "").substring(r.length);
                var s = (t[b] || "").match(/\s*$/)[0];
                n = new o({
                  type: a.table_cell,
                  parent: i,
                  in: i.get("in"),
                  before: n,
                  text: (t[b] || "").trim(),
                  marginLeft: v ? void 0 : r,
                  marginRight: v ? void 0 : s,
                });
              }
              return i;
            }
            m.set("alignText", v ? void 0 : t.slice(0)),
              !h && t && n && m.set("userText", l),
              (t = t || Array(e.length).fill()),
              (n = n || [[]]);
            for (var b = 0; b < g; b++)
              (t[b] = t[b] || ""),
                t[b].match(/^ *-+: *$/)
                  ? (t[b] = "right")
                  : t[b].match(/^ *:-+: *$/)
                  ? (t[b] = "center")
                  : t[b].match(/^ *:-+ *$/)
                  ? (t[b] = "left")
                  : (t[b] = null);
            m.set("align", t),
              (d = y.call(this, m, e)),
              n.forEach(function (e) {
                d = y.call(this, m, e);
              }, this),
              c.call(this, m),
              f.call(this),
              r && (this.ln = r),
              u.call(this, m),
              p.call(this, m),
              (this.cur = null);
          }
          if (this.cur) {
            s = oe[this.cur.get("type")];
            var b = !l && s.shouldClose.call(this, e);
            if (b > 0 || l) {
              if ((f.call(this, !1, l), 2 == b)) return;
            } else if (!b)
              return void (s.onContinue && s.onContinue.call(this, e));
          }
          if (!l) {
            if (!this.skips.old_code && (n = A.exec(e)))
              return this.skips.fromP
                ? (this.cur ||
                    ((this.cur = new o({
                      type: a.paragraph,
                      in: this.nodeMap,
                    })),
                    (this.cur._lines = [])),
                  void this.cur._lines.push(e))
                : void (o.isType(this.cur, a.code) && s
                    ? s.onContinue && s.onContinue.call(this, e)
                    : o.isType(this.cur, a.paragraph) &&
                      (this.cur._lines.last() || "").trim().length
                    ? this.cur._lines.push(e)
                    : ((r = new o({
                        type: a.code,
                        pattern: n[1],
                        in: this.nodeMap,
                      })),
                      c.call(this, r),
                      (r._lines = [n[2]]),
                      f.call(this),
                      (this.cur = r)));
            if (
              (n = S.exec(e)) &&
              o.isType(this.cur, a.paragraph) &&
              !i.isNullOrBlank(this.cur._lines.last())
            )
              return (
                (r = new o({
                  type: a.heading,
                  depth: "=" == n[1] ? 1 : 2,
                  text: this.cur._lines.pop(),
                  pattern: "{0}\n" + e,
                  in: this.nodeMap,
                })),
                c.call(this, r),
                f.call(this),
                u.call(this, r),
                void p.call(this, r)
              );
            var T = !0;
            if (e.match(this.remap ? W : k)) {
              if ((n = (File.option.strictMarkdown ? F : C).exec(e)))
                return (
                  (r = new o({
                    type: a.heading,
                    depth: n[2].length,
                    text: n[3],
                    pattern:
                      (this.skips.enableStartMatch
                        ? n[1].replace(/#$/, "# ")
                        : n[1]) +
                      "{0}" +
                      (n[4] || ""),
                    in: this.nodeMap,
                  })),
                  c.call(this, r),
                  u.call(this, r),
                  f.call(this),
                  void p.call(this, r)
                );
              if ((n = I.exec(e)))
                return (
                  (r = new o({
                    type: a.def_footnote,
                    ref: n[1],
                    pattern: n[2],
                    text: n[3],
                    in: this.nodeMap,
                  })),
                  c.call(this, r),
                  u.call(this, r),
                  f.call(this, !0),
                  void p.call(this, r)
                );
              if ((n = P.exec(e)))
                return (
                  (r = new o({
                    type: a.def_link,
                    ref: n[1],
                    href: n[3],
                    title: n[8],
                    in: this.nodeMap,
                    pattern:
                      "[;]:" +
                      n[2] +
                      ";" +
                      n[4] +
                      (n[5] ? ";" + n[6] + ";" + n[7] + ";" + n[9] : ""),
                  })),
                  c.call(this, r),
                  u.call(this, r),
                  f.call(this, !0),
                  void p.call(this, r)
                );
              if (this.skips.fromP)
                return (
                  this.cur ||
                    ((this.cur = new o({
                      type: a.paragraph,
                      in: this.nodeMap,
                    })),
                    (this.cur._lines = [])),
                  void this.cur._lines.push(e)
                );
              if (this.skips.enableStartMatch && (n = $.exec(e))) {
                var M = ae(e);
                if (M && M.length > 1) return void y.call(this, M);
              }
              if ((n = x.exec(e))) {
                if (!/^(\s*>){10,}/.exec(e))
                  return (
                    (r = new o({
                      type: a.blockquote,
                      in: this.nodeMap,
                      pattern: n[1],
                    })),
                    c.call(this, r),
                    (r._indent = n[1].replace(/^[ \u00A0]*>/, "").length),
                    (r._lines = []),
                    (r._lineIndents = []),
                    f.call(this),
                    (this.cur = r),
                    void oe.blockquote.onContinue.call(this, e)
                  );
                console.warn("too deep > level, ignore");
              }
              var K = this.remap ? J : O,
                Y = /^\.\.\.$/;
              if (this.skips.enableMetaBlock && 0 == this.ln && e.match(K)) {
                var G = this.ln + 1,
                  Q = this.lines.length,
                  X = void 0;
                if (!(re = this.skips.enableStartMatch || !1))
                  for (; G < Q; G++)
                    if (this.lines[G].match(K) || this.lines[G].match(Y)) {
                      X = (re = G > this.ln + 1) ? this.lines[G] : void 0;
                      break;
                    }
                if (re)
                  return (
                    (r = new o({
                      type: a.meta_block,
                      in: this.nodeMap,
                      text: this.lines.slice(this.ln + 1, G).join("\n"),
                      patternEnd: X,
                    })),
                    c.call(this, r),
                    (this.ln = G),
                    u.call(this, r),
                    f.call(this, !0),
                    void p.call(this, r)
                  );
              }
              if (this.remap && e.match(z)) {
                var Z = e.replace(/\u2013/g, "--").replace(/\u2014/g, "---");
                if ((n = L.exec(Z)))
                  return (
                    (r = new o({
                      type: a.hr,
                      pattern: Z.trim(),
                      in: this.nodeMap,
                    })),
                    c.call(this, r),
                    u.call(this, r),
                    f.call(this, !0),
                    void p.call(this, r)
                  );
              }
              if ((n = L.exec(e)))
                return (
                  (r = new o({
                    type: a.hr,
                    pattern: e.trim(),
                    in: this.nodeMap,
                  })),
                  c.call(this, r),
                  u.call(this, r),
                  f.call(this, !0),
                  void p.call(this, r)
                );
              if ((n = h.ul.exec(e)))
                return R.exec(this.lines[this.ln + 1] || "")
                  ? (v.call(this, e + "\n" + this.lines[this.ln + 1]),
                    void this.ln++)
                  : (m.call(this, o.ListType.ul, n[2], n[3]),
                    void (s = oe[a.list]).onContinue.call(
                      this,
                      e,
                      n[0],
                      n[1].length
                    ));
              if ((n = h.ol.exec(e))) {
                var ee = n[0].match(/\d+/)[0].replace(/^1$/, "");
                if (
                  !File.option.strictNumberStartOnNewLine ||
                  !ee ||
                  ee.trim() - 0 == 1
                )
                  return (
                    m.call(this, o.ListType.ol, n[0].replace(/\d+/, "{0}"), ee),
                    void (s = oe[a.list]).onContinue.call(
                      this,
                      e,
                      n[0],
                      n[1].length
                    )
                  );
              }
              if ((n = e.match(_)) && ((T = !1), !this.skips.math_block)) {
                (G = this.ln + 1), (Q = this.lines.length);
                var te,
                  ne,
                  re = this.skips.enableStartMatch || !1;
                if (((te = n[1]), !re))
                  for (; G < Q; G++)
                    if ((n = this.lines[G].match(_))) {
                      (ne = n[1]), (re = !0);
                      break;
                    }
                if (re)
                  return (
                    (r = new o({
                      type: a.math_block,
                      in: this.nodeMap,
                      tagBefore: te,
                      tagAfter: ne,
                      text: this.lines.slice(this.ln + 1, G).join("\n"),
                    })),
                    c.call(this, r),
                    (this.ln = G),
                    u.call(this, r),
                    f.call(this, !0),
                    void p.call(this, r)
                  );
              }
              if ((n = E.exec(e)))
                return (
                  ((r = new o({
                    type: a.fences,
                    lang: n[3],
                    pattern: n[1] + "{0}",
                    in: this.nodeMap,
                  }))._mark = n[2]),
                  (r._lines = []),
                  c.call(this, r),
                  f.call(this),
                  void (this.cur = r)
                );
              var se = this.remap ? V : N;
              if (e.match(se))
                return void v.call(
                  this,
                  e.replace(/[\[\u3010]/, "[").replace(/[\]\u3011]/, "]")
                );
              if (e.match(D)) return void v.call(this, e);
              if (e.match(B)) return void v.call(this, e);
              if (g.call(this, !1)) return;
              if (File.option.blockHTML && (n = q.exec(e))) {
                (r = new o({
                  type: a.html_block,
                  in: this.nodeMap,
                  style: (n[1] || "").toLowerCase(),
                  depth: 0,
                })),
                  c.call(this, r),
                  f.call(this, !0);
                var le = this.cur || (this.blocks || []).last();
                if (
                  le &&
                  o.isType(le, a.html_block) &&
                  0 === le.get("tail") &&
                  !r.get("ahead")
                ) {
                  le !== this.oldNode && le.detach(),
                    this.blocks.pop(),
                    (this.cur = le),
                    (le._lines = le.get("text").split(/\n/));
                  var ce = le.get("displayStyle") || le.get("style");
                  d.HIDDEN_TYPE.indexOf(ce) > -1 && (ce = n[1]),
                    le.set("displayStyle", ce),
                    le.unset("tail"),
                    le.set("style", n[1]),
                    le.set("depth", 0),
                    r.remove(),
                    (r = le);
                } else c.call(this, r), (this.cur = r), (this.cur._lines = []);
                return (
                  (s = oe[a.html_block]),
                  void (oe.html_block.shouldClose.call(this, e) ==
                  ie.CLOSE_INCLUDE
                    ? (f.call(this, !0),
                      u.call(this, this.cur),
                      (this.cur = null))
                    : ((this.cur._lines = this.cur._lines || []),
                      this.cur._lines.push(e)))
                );
              }
            }
            (T && !this.skips.fromP && g.call(this, !0)) ||
              (this.cur ||
                ((this.cur = new o({ type: a.paragraph, in: this.nodeMap })),
                (this.cur._lines = [])),
              o.isType(this.cur, a.paragraph)
                ? this.cur._lines.push(e)
                : s && s.onContinue && s.onContinue.call(this, e));
          }
        }
        (o.parseFrom = function (e, t, n, i) {
          return (
            (n = n || {}),
            new o({
              type: a.raw_edit,
              in: t,
              attachTo: n.noTop ? null : t,
              text: e,
            }).parseFrom(n, void 0, i)
          );
        }),
          (o.prototype.parseFrom = function (e, t, n) {
            if (((e = e || {}), o.isType(this.get("parent"), a.table_row)))
              return (
                this.set("type", a.table_cell),
                this.set(
                  "text",
                  this.safeGetStrAttr("text")
                    .replace(/\n|\r/gi, "")
                    .replace(/([^\\])\|/gi, "$1|")
                ),
                [!n && this.toHTML(), [this]]
              );
            if (
              !o.isType(
                this,
                a.paragraph,
                a.raw_edit,
                a.html_block,
                a.list_item
              )
            )
              return [!n && this.toHTML(), [this]];
            var i,
              s =
                ((i = this),
                (o.isType(i, a.list_item) && !i.get("children").length
                  ? new o({
                      type: a.paragraph,
                      text: "",
                      parent: i,
                      in: i.get("in"),
                    })
                  : null) || this),
              l = e.skips || {};
            if (
              ((t = t || s.get("text")),
              File.option.ignoreLineBreak && (t = t.replace(/\u00a0/g, " ")),
              (l.enableMetaBlock = this.get("attachTo") && !this.get("before")),
              (l.old_code = !1 !== l.old_code),
              this.isBlock(!0))
            ) {
              var c = this.get("before"),
                d = this.get("after"),
                u = new se(t, null, s.get("in"), s, l).blocks;
              return u.length <= 1
                ? [!n && this.toHTML(), [this]]
                : (u[0].set("before", c),
                  u.last().set("after", d),
                  [!n && r.NodeCollectionUtils.toHTML(u), u]);
            }
          });
        var ce = function (e) {
            var t = e.last();
            if (t) return t.text || "";
          },
          de = {
            escape: /^\\([\\`*{}\[\]()#+\-.!_>$|<~"'&])/,
            escape2: /^[\uE013\uE014\uE018\uE020]/,
            autolink:
              /^<\uE016?((([^ >]+(@|:)[^ >]+))|(\s*www\.[^ >]+))\uE017?\uE019?>/,
            url: /^\uE016([^\uE017\uE019]+)(\uE017|(\uE019[-@+.,!\/~?%&=:#\uE006\w;()]*))/i,
            comment: /^<!--[\s\S]*?-->/,
            br: /^<w?br[\s/]*>(\s*<\/w?br>)*/i,
            tag: /^(?:<([A-Za-z][A-Za-z0-9-]*)(?:\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\s*=\s*(?:[^"'=<>`\x00-\x20]+|'[^']*'|"[^"]*"))?)*\s*(\/?)>|<(\/)([A-Za-z][A-Za-z0-9-]*)\s*[>]|[<][?].*?[?][>]|<![A-Z]+\s+[^>]*>|<!\[CDATA\[[\s\S]*?\]\]>)/,
            underline: /^<u>([^\r]*?\S)<\/u>/i,
            atag: /^(<a\s.+?>)(.*?)(<\/\s*a>)/i,
            imgtag: /^<img(\s+[^<]+)(\/?\s*>([^<]*(<\/img>))?)/i,
            link: /^\[((?:\[[^\]]*\]|[^\[\]])*)\]\(<?((?:\([^)]*\)|[^()])*?)>?(?:[ \t]+((['"])((?:.|\n)*?)\4[ \t]*))?\)/,
            image:
              /(^\!\[((?:\[[^\]]*\]|[^\[\]])*)\]\()(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])((?:.|\n)*?)\6[ \t]*)?)(\)(?:\s*{([^{}\(\)]*)})?)/,
            reflink: /^(!?)\[(inside)\]\[([^\]]*)\]/,
            strong: /^(\*\*|__)(?=\S)([^\r]*?\S?[*_]?)\1/,
            strong_esp: /^\uE031([^\uE031]+)\uE031/,
            em1: /^(\_)(?=\S)([^\r]*?[^\s_])\1(?!\1)/,
            em2: /^(\*)(?=\S)([^\r]*?[^\s*])(\1{1}|\1{3})(?!\1)/,
            highlight: /^(\=\=)(?=\S)([^\r]*?\S)\1/,
            code: /^(`+)([\s\S]*?[^`])\1(?!`)/,
            code2: /^\uE023(\d+)\uE023/,
            del: /^~~(?=\S)([\s\S]*?\S)~~/,
            tab: /^[\t]+/,
            text: /^(\s|\S)+?[^\n\t\u200B\uE010-\uE020\uE006\uE023\uE031\\<!\[._*`&{\$\:~\^\="'\-]*/,
            footnote: /^\[\^([^\]\n]+)\]/,
            attr: /^{( *([#.][-\w_\uE006]+ *|[-\w_\uE006]+=[-\w_"'\uE006]+ *)+)}/,
            entity: /^&#?[a-z0-9]+;/i,
            emoji: /^(\u200B?):([+\-\w\uE006]+):(\u200B?)/,
            inline_math: /^\$(.|\n)*(?:[^\\])\$/,
            gitlab_inline_math: /^\$`(.|\n)*(?:[^\\])`\$/,
            subscript: /^~(([^\s\n]|(\\\s))+?)~/,
            superscript: /^\^(([^\s\n]|(\\\s))+?)\^/,
            linebreak: /[ \u00A0]{2}$/,
            emptyline: /^(\n)(?:\n|$)/,
          };
        function ue(e, t, n) {
          (this.options = e || ke({}, Re.defaults)),
            (this.options.decorate = t || s.decorate),
            (this.options.context = n || this),
            (this.rules = de.normal),
            this.options.gfm
              ? this.options.breaks
                ? (this.rules = de.breaks)
                : (this.rules = de.gfm)
              : this.options.pedantic && (this.rules = de.pedantic),
            File.option.enableHighlight &&
              (this.rules.escape2 = /^[\uE013\uE014\uE015\uE018\uE020]/),
            File.option.enableSuperscript
              ? File.option.enableHighlight
                ? (this.rules.escape = /^\\([\\`*{}\[\]()#+\-.!_>$|<~"'&^=])/)
                : (this.rules.escape = /^\\([\\`*{}\[\]()#+\-.!_>$|<~"'&^])/)
              : File.option.enableHighlight &&
                (this.rules.escape = /^\\([\\`*{}\[\]()#+\-.!_>$|<~"'&=])/);
        }
        (de.comment_ext = /^<!(--|\u2013|\u2014)[\s\S]*?(--|\u2013|\u2014)>/),
          (de.link_ext =
            /^[\[\u3010]((?:[\[\u3010][^\]\u3011]*[\u3011\]]|[^\[\]\u3010\u3011])*)[\]\u3011]\(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((["'])(?:(.|\n)*?)["'][ \t]*)?\)/),
          (de.image_ext =
            /(^\![\[\u3010]((?:[\[\u3010][^\]\u3011]*[\]\u3011]|[^\[\]\u3010\u3011])*)[\]\u3011][\(\uff08])((.|\n)*)([\)\uff09](?:\s*{([^{}\(\)\uff08\uff09]*)})?)/),
          (de.attr_ext =
            /^{( *([#.][-\w_\uE006]+ *|[-\w_\uE006]+=[-\w_"'«»‘’‚‛„‟‹›\uE006]+ *)+)}/),
          (de._inside = /(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/),
          (de._inside_ext =
            /(?:[\[\u3010][^\]\u3011]*[\]\u3011]|[^\[\]\u3010\u3011]|[\]\u3011](?=[^\[\u3010]*[\]\u3011]))*/),
          (de.tag_ext =
            /^(?:<([A-Za-z][A-Za-z0-9-]*)(?:\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\s*=\s*(?:[^"'=<>`\x00-\x20]+|[’‚‛'‹›][^'’‚‛]*['’‚‛‹›]|["“«»„‟][^"“«»„‟]*["“«»„‟]))?)*\s*(\/?)>|<(\/)([A-Za-z][A-Za-z0-9-]*)\s*[>]|[<][?].*?[?][>]|<![A-Z]+\s+[^>]*>|<!\[CDATA\[[\s\S]*?\]\]>)/),
          (de.reflink = Fe(de.reflink)("inside", de._inside)()),
          (de.normal = ke({}, de)),
          (de.pedantic = ke({}, de.normal, {
            strong:
              /^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,
            em: /^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/,
          })),
          (de.gfm = de.normal),
          (de.breaks = ke({}, de.gfm, {
            text: Fe(de.gfm.text)("{2,}", "*")(),
          })),
          (ue.rules = de);
        var he = {
            UNDER_CHAR: "",
            MATH_CHAR: "",
            DEF_FOOT_PERFIX_CHAR: "",
            ESCAPE_SATR: "",
            ESCAPE_UNDERLINE: "",
            ESCAPE_EQUAL: "",
            URL_START: "",
            URL_END: "",
            ESCAPE_END_SQUARE_BRACKET: "",
            URL_MAY_END: "",
            ESCAPE_ESCAPE: "",
            ESCAPE_VLINE: "",
            ESCAPE_SPACE: "",
            CODE: "",
          },
          pe = { "": "[^", "": "*", "": "_", "": "=", "": "]", "": "\\" },
          fe = { "": "_", "": "", "": "", "": "" },
          me = {
            "\\\\": he.ESCAPE_ESCAPE,
            "\\*": he.ESCAPE_SATR,
            "\\=": he.ESCAPE_EQUAL,
            "\\_": he.ESCAPE_UNDERLINE,
            "\\]": he.ESCAPE_END_SQUARE_BRACKET,
          },
          ge =
            /(?:(https?:\/\/(?:[a-z0-9]|\/|\.\.\/|(?:[-@+.,!\/~?%&=:#\uE006_](?![\s.~*-,_]|$)))+)|((?:mailto:\/{0,2})?[a-z0-9][a-z0-9\-_+\.\uE006]*@[a-z0-9](?:[a-z0-9\-_\uE006]{0,15}\.?){0,2}\.(?:com|co|net|org|edu|io|tv|fm|me|info|cc|ca|de|cn|ru|us|jp|au)(?:\.[a-z]+)*)|(www\.[a-z0-9][a-z0-9\-_\uE006]*(?:\.[a-z0-9\-_\uE006]+)+\/?(?:\/|\.\.\/|[a-z0-9]|(?:[-@+.,!\/~?%&=:#\uE006_](?![\s.~*-,_]|$)))*))/gi,
          ve = 0,
          ye = new Map();
        function be(e) {
          return e.replace(/(`+)([\s\S]*?[^`])\1(?!`)/g, function (e) {
            return ve++, ye.set(ve + "", e), he.CODE + ve + he.CODE;
          });
        }
        function we(e, t) {
          return e.replace(/\uE023(\d+)\uE023/g, function (e, n) {
            var i = ye.get(n) || "";
            return !t && ye.delete(n), i;
          });
        }
        function xe(e, t) {
          return we(
            e.replace(/[\uE006-\uE020]/g, function (e) {
              return pe[e] ? "\\" + pe[e] : fe[e] || "";
            }),
            t
          ).replace(/\uE031/g, "*");
        }
        ue.skipLink = { autolink: 1, url: 1, link: 1, reflink: 1 };
        var Ce = function (e) {
          for (var t = e.length - 1; t >= 0; t--)
            if (e[t].type == a.pants) {
              if ("open_double" == e[t].desc) return !0;
              if ("close_double" == e[t].desc) return !1;
            }
          return !1;
        };
        function Fe(e, t) {
          return (
            (e = e.source),
            (t = t || ""),
            function n(i, r) {
              return i
                ? ((r = (r = r.source || r).replace(/(^|[^\[])\^/g, "$1")),
                  (e = e.replace(i, r)),
                  n)
                : new RegExp(e, t);
            }
          );
        }
        function Se() {}
        function ke(e) {
          for (var t, n, i = 1; i < arguments.length; i++)
            for (n in (t = arguments[i]))
              Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
          return e;
        }
        (ue.prototype.output = function (e, t, n, r, o) {
          (t = t || this.options.decorate),
            (e = e || ""),
            ((r = ke(r || {}, this.options.skipOp)).attr = !1 !== r.attr),
            (r.markLinebreak = !0),
            File.option.enableInlineMath || (r.inline_math = !0),
            File.option.enableSubscript || (r.subscript = !0),
            File.option.enableSuperscript || (r.superscript = !0),
            File.option.enableHighlight || (r.highlight = !0);
          var l,
            h,
            p,
            f,
            m,
            g =
              (o = o || { cursorDiff: [], openQuote: null, hasContent: !1 })
                .isCur || File.shouldRemapPunctuation(),
            v = o.cursorDiff || [],
            y = function (e, t) {
              v[e] = (v[e] || 0) + t;
            },
            b = 0,
            w = [],
            x = this.options,
            C = t == s.decorate,
            F = x.forPrint;
          function S(e, t) {
            var n = e.last();
            n && n.type === a.plain
              ? (n.text += t)
              : e.push({ type: a.plain, text: t });
          }
          function k(e, t, n) {
            for (var i = 1, r = t; r < e.length; r++)
              if (
                e[r].name == n &&
                (e[r].pos < 0 && i--, e[r].pos > 0 && i++, !i)
              )
                return r;
            return 0;
          }
          function E(e) {
            for (var n = "", i = 0; i < e.length; i++) {
              var r = e[i];
              if (r.type == a.tag) {
                r.name = r.name || "";
                var s = d.INLINE_TYPE.indexOf(r.name.toLowerCase()) > -1,
                  l = d.HIDDEN_TYPE.indexOf(r.name.toLowerCase()) > -1,
                  c = F && d.UNSFAE_TAGS.indexOf(r.name.toLowerCase()) > -1;
                if ((r.pos > 0 && C && (s || l)) || c) {
                  var u = r.name || "",
                    h = k(e, i + 1, u);
                  if (h > 0) {
                    (n += t(
                      {
                        type: a.html_inline,
                        inner: E(e.subarray(i + 1, h)),
                        name: u.toLowerCase(),
                        before: r.text,
                        after: e[h].text,
                        isMeta: !s,
                      },
                      x,
                      o
                    )),
                      (i = h);
                    continue;
                  }
                  if (F) {
                    n += t(
                      {
                        type: a.html_inline,
                        inner: "",
                        name: u.toLowerCase(),
                        before: r.text,
                        after: "",
                        isMeta: !s,
                      },
                      x,
                      o
                    );
                    continue;
                  }
                }
              }
              n += t(r, x, o);
            }
            return n;
          }
          for (
            e.length > 1e5 && ((n = !0), S(w, e), (e = "")),
              n ||
                (e = (function (e, t) {
                  for (var n, i = /([a-z0-9])_([a-z0-9])/gi; (n = i.exec(e)); )
                    (e =
                      e.substring(0, n.index + 1) +
                      he.UNDER_CHAR +
                      e.substring(n.index + 2)),
                      i.lastIndex && i.lastIndex--;
                  return (
                    (e = e
                      .replace(/\\[\*_=\]\\]/gi, function (e) {
                        return me[e] || e;
                      })
                      .replace(
                        /([^\\`]|^)(`+)([\s\S]*?[^`])\2(?!`)/g,
                        function (e, t) {
                          return (
                            ve++,
                            ye.set(ve + "", e.substr(t.length)),
                            t + he.CODE + ve + he.CODE
                          );
                        }
                      )),
                    t &&
                      e.length < 2e4 &&
                      ((ge.lastIndex = 0),
                      (e = e.replace(ge, function (e, t, n, i) {
                        return ("" + t + i).indexOf("/") > -1
                          ? he.URL_START + e + he.URL_MAY_END
                          : he.URL_START + e + he.URL_END;
                      }))),
                    e
                  );
                })(e, !r.url));
            e;

          )
            if (r.markLinebreak && (p = /^\r?\n/.exec(e)))
              (b += p[0].length),
                (e = e.substring(p[0].length)),
                w.push({
                  type: e || r.emptyline ? a.softbreak : a.emptyline,
                  text: "\n",
                  inner: "\n",
                });
            else if ((p = this.rules.escape2.exec(e)))
              (b += p[0].length),
                (e = e.substring(p[0].length)),
                w.push({ type: a.escape, text: pe[p[0]] }),
                (o.hasContent = !0);
            else if ((p = this.rules.escape.exec(e)))
              (b += p[0].length),
                (e = e.substring(p[0].length)),
                w.push({ type: a.escape, text: p[1] }),
                (o.hasContent = !0);
            else if (r.autolink || !(p = this.rules.autolink.exec(e)))
              if (r.url || !(p = this.rules.url.exec(e)))
                if (
                  (p = (g ? this.rules.comment_ext : this.rules.comment).exec(
                    e
                  ))
                )
                  (b += f = (l = we(p[0])).length),
                    (e = e.substring(p[0].length)),
                    g &&
                      ((l = l.replace(/[\u2013\u2014]/g, "--")),
                      (v[b] = l.length - f)),
                    w.push({ type: r.comment ? a.tag : a.comment, text: l });
                else if ((p = this.rules.br.exec(e)))
                  (b += p[0].length),
                    (e = e.substring(p[0].length)),
                    w.push({ type: a.br, text: p[0] });
                else if (
                  (p = (
                    File.shouldRemapPunctuation()
                      ? this.rules.tag_ext
                      : this.rules.tag
                  ).exec(e))
                ) {
                  var T;
                  if (!r.underline && (T = this.rules.underline.exec(e))) {
                    (b += (l = we(T[0])).length),
                      (e = e.substring(T[0].length)),
                      w.push({
                        type: a.underline,
                        inner: this.output(
                          l == T[0] ? T[1] : this.rules.underline.exec(l)[1],
                          t,
                          !0,
                          r
                        ),
                        text: l,
                      }),
                      (o.hasContent = !0);
                    continue;
                  }
                  if (!r.imgtag && (T = this.rules.imgtag.exec(e))) {
                    var _ = (l = we(T[0]));
                    g &&
                      (_ = _.replace(/(\w=)[«»“”„‟〝〟]/g, '$1"')
                        .replace(/(\w=)[‚‘’‛‹›]/g, "$1'")
                        .replace(/[»«”“〞]([\s\/>]|$)/g, '"$1')
                        .replace(/[’‛‘›‹＇]([\s\/>]|$)/g, "'$1"));
                    var A = (/src\s*=\s*(['"])((.|\n)*?)\1/.exec(_) || [])[2];
                    if (
                      (A ||
                        (A = (/src\s*=\s*([^\s'"]+)(\s|$)/.exec(_) || [])[1]),
                      A)
                    ) {
                      (b += l.length), (e = e.substring(T[0].length));
                      var M =
                          (/\sstyle\s*=\s*(['"])(.+?)\1/.exec(_) || [])[2] ||
                          "",
                        L = (/(^|[^\w-])width\s*:\s*(.+?)(\s*;|$)/.exec(M) ||
                          [])[2],
                        N = (/(^|[^\w-])height*:\s*(.+?)(\s*;|$)/.exec(M) ||
                          [])[2],
                        D = (/(^|[^\w-])zoom*:\s*(.+?)(\s*;|$)/.exec(M) ||
                          [])[2],
                        B = (/\salign\s*=\s*(['"])(.+?)\1/.exec(_) ||
                          /\salign\s*=\s*((.+?))[\s/>]/.exec(_) ||
                          [])[2];
                      L ||
                        ((L = (/\swidth\s*=\s*(['"])(.+?)\1/.exec(_) ||
                          /\swidth\s*=\s*((.+?))[\s/>]/.exec(_) ||
                          [])[2]),
                        /\d\s*$/.exec(L || "") && (L += "px;")),
                        N ||
                          ((N = (/\sheight\s*=\s*(['"])(.+?)\1/.exec(_) ||
                            /\sheight\s*=\s*((.+?))[\s/>]/.exec(_) ||
                            [])[2]),
                          /\d\s*$/.exec(N || "") && (N += "px;")),
                        w.push({
                          type: a.imgtag,
                          text: _,
                          href: i.unescape(xe(A)),
                          width: L,
                          height: N,
                          zoom: D,
                          align: B,
                        });
                    } else
                      (b += (l = we(p[0])).length),
                        (e = e.substring(p[0].length)),
                        (l = l
                          .replace(/(\w=)[«»“”„‟〝〟]/g, '$1"')
                          .replace(/(\w=)[‚‘’‛‹›]/g, "$1'")
                          .replace(/[»«”“〞]([\s\/>]|$)/g, '"$1')
                          .replace(/[’‛‘›‹＇]([\s\/>]|$)/g, "'$1")),
                        w.push({ type: a.tag, text: xe(l) });
                    o.hasContent = !0;
                    continue;
                  }
                  if (
                    ((b += (l = we(p[0])).length),
                    (e = e.substring(p[0].length)),
                    (l = l
                      .replace(/(\w=)[«»“”„‟〝〟]/g, '$1"')
                      .replace(/(\w=)[‚‘’‛‹›]/g, "$1'")
                      .replace(/[»«”“〞]([\s\/>]|$)/g, '"$1')
                      .replace(/[’‛‘›‹＇]([\s\/>]|$)/g, "'$1")),
                    "ruby" ==
                      (m = {
                        type: a.tag,
                        pos: p[1] || p[4] ? (p[3] ? -1 : p[2] ? 0 : 1) : 0,
                        name: (p[1] || p[4] || "").toLowerCase(),
                      }).name &&
                      m.pos > 0 &&
                      C &&
                      (p = /<\/ruby>/.exec(e)))
                  ) {
                    var R = p.index + p[0].length;
                    (b += R),
                      (l += e.substring(0, R)),
                      (e = e.substring(R)),
                      (m = { type: a.ruby, text: xe(l) });
                  } else m.text = xe(l);
                  w.push(m),
                    (o.hasContent =
                      o.hasContent ||
                      -1 == d.NO_TEXT_BLOCK_TYPE.indexOf(m.name));
                } else {
                  if (
                    ((o.hasContent = !0),
                    !r.link &&
                      (p = (g ? this.rules.link_ext : this.rules.link).exec(e)))
                  ) {
                    var P = p[0];
                    if (
                      ((e = e.substring(p[0].length)),
                      g &&
                        ((P = we(
                          (P = "[" + p[1] + "]" + P.substring(p[1].length + 2))
                        )),
                        (p = this.rules.link.exec(P))),
                      p)
                    ) {
                      (b += p[0].length),
                        (e = P.substr(p[0].length) + e),
                        w.push({
                          type: "link",
                          href: xe(p[2], !0),
                          title: p[5],
                          markdown: p[0],
                          text: p[1] || "",
                          inner: p[1]
                            ? this.output(p[1], t, !0, ue.skipLink, o)
                            : "",
                          meta: xe(p[0].substring(p[1].length + 2)),
                        });
                      continue;
                    }
                    e = be(P) + e;
                  }
                  if (!r.image) {
                    if (!g && (p = this.rules.image.exec(e))) {
                      (b += (l = we(p[0])).length),
                        (e = e.substring(p[0].length)),
                        (p = this.rules.image.exec(l)),
                        w.push({
                          type: "image",
                          href: xe(p[4]),
                          title: p[7],
                          markdown: p[0],
                          components: [p[1], p[3], p[8]],
                          alt: p[2],
                          onlychild: !e && !w.length,
                        });
                      continue;
                    }
                    if (g && (p = this.rules.image_ext.exec(e))) {
                      (f = p[0].length), (e = e.substring(p[0].length));
                      var I =
                        p[1]
                          .replace(/^!\u3010/g, "![")
                          .replace(/[\u3011\]][\uff08\)]$/g, "](") +
                        p[3] +
                        p[5].replace(/^\uff09/g, ")");
                      if (((I = we(I)), (p = this.rules.image.exec(I)))) {
                        (b += p[0].length),
                          (e = I.substr(p[0].length) + e),
                          w.push({
                            type: "image",
                            href: xe(p[4]),
                            title: p[7],
                            markdown: I.substr(0, p[0].length),
                            components: [p[1], p[3], p[8]],
                            alt: p[2],
                            onlychild: !e && !w.length,
                          });
                        continue;
                      }
                      e = be(I) + e;
                    }
                  }
                  if (!r.footnote && b && (p = this.rules.footnote.exec(e))) {
                    if (
                      ((l = we(p[0])),
                      (e = e.substring(p[0].length)),
                      l != p[0] && (p = this.rules.footnote.exec(l)),
                      p)
                    ) {
                      (b += p[0].length), (e = l.substr(p[0].length) + e);
                      var O = (p[2] || p[1]).replace(/\s+/g, " ");
                      w.push({
                        type: a.footnote,
                        inner: this.output(p[1], t, !0, ue.skipLink),
                        text: xe(p[1]),
                      });
                      continue;
                    }
                    e = be(l) + e;
                  }
                  if ((p = this.rules.reflink.exec(e)))
                    if (r.reflink && !p[1]);
                    else {
                      if (
                        ((l = we(p[0])),
                        (e = e.substring(p[0].length)),
                        l != p[0] && (p = this.rules.reflink.exec(l)),
                        p)
                      ) {
                        (b += p[0].length), (e = l.substr(p[0].length) + e);
                        O = (p[3] || "").replace(/\s+/g, " ");
                        w.push({
                          type: p[1] ? "refimg" : "reflink",
                          ref: xe(O),
                          inner: this.output(p[2], t, !0, ue.skipLink),
                          text: xe(p[2]),
                          markdown: l,
                          onlychild: !e && !w.length,
                        });
                        continue;
                      }
                      e = be(l) + e;
                    }
                  if (
                    r.attr ||
                    !(p = (g ? this.rules.attr_ext : this.rules.attr).exec(e))
                  )
                    if ((p = /^\uE031\uE031([^\uE031]+)\uE031\uE031/.exec(e)))
                      (b += (l = we(p[0], !0)).length),
                        (e = e.substring(p[0].length)),
                        w.push({
                          type: a.strong,
                          pattern: "**",
                          inner: this.output(p[1], t, !0, r, o),
                          text: l,
                        });
                    else if ((p = this.rules.strong.exec(e))) {
                      var $ = /^\*\*\*([^\*]*[^\s*\s])\*\*/;
                      if (((e = e.substring(p[0].length)), $.exec(p[0]))) {
                        e = p[0].replace($, "*$1") + e;
                        continue;
                      }
                      (b += (l = we(p[0], !0)).length),
                        w.push({
                          type: a.strong,
                          pattern: p[1],
                          inner: this.output(p[2], t, !0, r, o),
                          text: l,
                        });
                    } else if ((p = this.rules.em1.exec(e)))
                      (b += (l = we(p[0], !0)).length),
                        (e = e.substring(p[0].length)),
                        w.push({
                          type: a.em,
                          pattern: p[1],
                          inner: this.output(p[2], t, !0),
                          text: l,
                        });
                    else if ((p = this.rules.em2.exec(e))) {
                      var H = (p[2] + p[3].substring(1, 3)).match(/\s\*(?!\*)/);
                      if (H) {
                        (l = p[0].substr(0, H.index + 1)),
                          (b += (p = /^\*+/.exec(l))[0].length),
                          (e = e.substring(p[0].length)),
                          S(w, p[0]);
                        continue;
                      }
                      (b += (l = we(p[0], !0)).length),
                        (e = e.substring(p[0].length)),
                        w.push({
                          type: a.em,
                          pattern: p[1],
                          inner: this.output(
                            p[2] + p[3].substring(1, 3),
                            t,
                            !0
                          ),
                          text: l,
                        });
                    } else if (
                      ((p = this.rules.code2.exec(e)) &&
                        (e = e.replace(this.rules.code2, function (e, t) {
                          var n = ye.get(t) || "";
                          return ye.delete(t), n;
                        })),
                      (p = this.rules.code.exec(e)))
                    )
                      (b += p[0].length),
                        (e = e.substring(p[0].length)),
                        w.push({ type: a.code, pattern: p[1], text: p[2] });
                    else if ((p = this.rules.del.exec(e)))
                      (b += (l = we(p[0], !0)).length),
                        (e = e.substring(p[0].length)),
                        w.push({
                          type: a.del,
                          pattern: "~~",
                          inner: this.output(p[1], t, !0),
                          text: l,
                        });
                    else if (
                      (p = this.rules.emoji.exec(e)) &&
                      c.data[(p[2] = p[2].replace(/\uE006/g, "_"))]
                    )
                      (e = e.substring(p[0].length)),
                        w.push({
                          type: a.emoji,
                          text: p[2],
                          inner: c.data[p[2]],
                        }),
                        !p[1].length && y(b, 1),
                        (b += p[0].length),
                        !p[3].length && y(b, 1);
                    else {
                      if (!r.subscript && (p = this.rules.subscript.exec(e))) {
                        if (
                          ((l = we(p[0])),
                          (e = e.substring(p[0].length)),
                          l != p[0] && (p = this.rules.subscript.exec(l)),
                          p)
                        ) {
                          (b += p[0].length), (e = l.substr(p[0].length) + e);
                          var U = [];
                          (p = p[1].split(/\\\s/g))[0] &&
                            U.push({ type: a.plain, text: p[0] });
                          for (var j = 1; j < p.length; j++)
                            U.push({ type: a.escape, text: " " }),
                              p[j] && U.push({ type: a.plain, text: p[j] });
                          w.push({
                            type: a.subscript,
                            inner: E(U),
                            text: p[0],
                          });
                          continue;
                        }
                        e = be(l) + e;
                      }
                      if (
                        !r.superscript &&
                        (p = this.rules.superscript.exec(e))
                      ) {
                        if (
                          ((l = we(p[0])),
                          (e = e.substring(p[0].length)),
                          l != p[0] && (p = this.rules.superscript.exec(l)),
                          p)
                        ) {
                          (b += p[0].length), (e = l.substr(p[0].length) + e);
                          U = [];
                          (p = p[1].split(/\\\s/g))[0] &&
                            U.push({ type: a.plain, text: p[0] });
                          for (j = 1; j < p.length; j++)
                            U.push({ type: a.escape, text: " " }),
                              p[j] && U.push({ type: a.plain, text: p[j] });
                          w.push({
                            type: a.superscript,
                            inner: E(U),
                            text: p[0],
                          });
                          continue;
                        }
                        e = be(l) + e;
                      }
                      if (
                        r.inline_math ||
                        !(p = this.rules.inline_math.exec(e))
                      )
                        if (r.highlight || !(p = this.rules.highlight.exec(e)))
                          if ((p = this.rules.entity.exec(e)))
                            (b += p[0].length),
                              (e = e.substring(p[0].length)),
                              i.decodeHtmlEntity(p[0])
                                ? w.push({
                                    type: a.html_entity,
                                    inner: p[0],
                                    text: p[0],
                                  })
                                : S(w, p[0] || "");
                          else {
                            if (
                              File.option.convertSmartOnRender &&
                              File.option.smartDash
                            ) {
                              if ((p = /^(---)($|[^-])/.exec(e))) {
                                (b += p[1].length),
                                  (e = e.substring(p[1].length)),
                                  w.push({
                                    type: a.pants,
                                    inner: "—",
                                    desc: "em_dash",
                                    meta: "--",
                                    text: "---",
                                  });
                                continue;
                              }
                              if ((p = /^--/.exec(e))) {
                                (e = e.substring(p[0].length)),
                                  (b += p[0].length),
                                  w.push({
                                    type: a.pants,
                                    inner: File.option.twoHyphensToEm
                                      ? "—"
                                      : "–",
                                    desc: File.option.twoHyphensToEm
                                      ? "em_dash"
                                      : "en_dash",
                                    meta: "-",
                                    text: "--",
                                  });
                                continue;
                              }
                              if ((p = /^\.{3}/.exec(e))) {
                                (b += p[0].length),
                                  "." !== (e = e.substring(p[0].length))[4]
                                    ? w.push({
                                        type: a.pants,
                                        inner: "…",
                                        desc: "ellipsis",
                                        meta: "..",
                                        text: "...",
                                      })
                                    : S(w, p[0]);
                                continue;
                              }
                            }
                            if (
                              File.option.convertSmartOnRender &&
                              File.option.smartQuote
                            ) {
                              var q, W;
                              if ('"' == e[0]) {
                                if (
                                  ((W = (q = ce(w) || "")[q.length - 1] || ""),
                                  /([\(\{\[\s\-/\u2018])$/.exec(q) ||
                                    W == u.userQuote(2))
                                ) {
                                  b++,
                                    (e = e.substring(1)),
                                    w.push({
                                      type: a.pants,
                                      inner: u.userQuote(0, void 0, !0),
                                      desc: "open_double",
                                      text: '"',
                                    });
                                  continue;
                                }
                                if ((p = /^"($|[\)\s/.,;:?!\u2019])/.exec(e))) {
                                  b++,
                                    (e = e.substring(1)),
                                    w.push({
                                      type: a.pants,
                                      inner: u.userQuote(1, void 0, !0),
                                      desc: "close_double",
                                      text: '"',
                                    });
                                  continue;
                                }
                                if (Ce(w)) {
                                  b++,
                                    (e = e.substring(1)),
                                    w.push({
                                      type: a.pants,
                                      inner: u.userQuote(1, void 0, !0),
                                      desc: "close_double",
                                      text: '"',
                                    });
                                  continue;
                                }
                                b++,
                                  (e = e.substring(1)),
                                  w.push({
                                    type: a.pants,
                                    inner: u.userQuote(0, void 0, !0),
                                    desc: "open_double",
                                    text: '"',
                                  });
                                continue;
                              }
                              if ("'" == e[0]) {
                                if (
                                  o.openQuote &&
                                  (p = /^'($|[\)\s".,;:?!-])/.exec(e))
                                ) {
                                  b++,
                                    (e = e.substring(1)),
                                    w.push({
                                      type: a.pants,
                                      inner: u.userQuote(3),
                                      desc: "close_single",
                                      text: "'",
                                    }),
                                    (o.openQuote.inner = u.userQuote(2)),
                                    (o.openQuote.desc = "open_single"),
                                    (o.openQuote = null);
                                  continue;
                                }
                                if (
                                  ((q = ce(w) || ""),
                                  e.length <= 1 && /((^|[\s])$)/.exec(q))
                                ) {
                                  (b += e.length), S(w, e), (e = "");
                                  continue;
                                }
                                b++,
                                  (e = e.substring(1)),
                                  w.push({
                                    type: a.pants,
                                    inner: "’" == u.userQuote(3) ? "’" : "'",
                                    desc: "close_single",
                                    text: "'",
                                  }),
                                  /(^|[\(\s"-])$/.exec(q) &&
                                    (o.openQuote = w.last());
                                continue;
                              }
                            }
                            if ((p = this.rules.tab.exec(e)))
                              (b += p[0].length),
                                (e = e.substring(p[0].length)),
                                w.push({
                                  type: a.tab,
                                  inner: p[0],
                                  text: p[0],
                                });
                            else if ((p = this.rules.text.exec(e)))
                              (b += p[0].length),
                                "\n" == (e = e.substring(p[0].length))[0] &&
                                this.rules.linebreak.exec(p[0] || "")
                                  ? (b++,
                                    (e = e.substring(1)),
                                    S(
                                      w,
                                      p[0].replace(this.rules.linebreak, "")
                                    ),
                                    w.push({
                                      type: a.linebreak,
                                      text: "  \n",
                                      isLast: !e,
                                    }))
                                  : S(w, p[0] || "");
                            else if (e)
                              throw new Error(
                                "Infinite loop on byte: " + e.charCodeAt(0)
                              );
                          }
                        else
                          (b += (l = we(p[0], !0)).length),
                            (e = e.substring(p[0].length)),
                            w.push({
                              type: a.highlight,
                              inner: this.output(p[2], t, !0),
                              text: xe(p[2], !0),
                            });
                      else {
                        var z = null,
                          V = 0,
                          J = "",
                          K = null,
                          Y = /\$/,
                          G = "$";
                        for (
                          /^\$\$/.exec(p[0])
                            ? ((z = /{|}|\$\$/g), (G = "$$"))
                            : ((z = /{|}|\$/g), (G = "$")),
                            z.exec(p[0]);
                          (K = z.exec(p[0]));

                        ) {
                          if (
                            Y.exec(K[0]) &&
                            V <= 0 &&
                            "\\" != p[0].substring(K.index - 1, K.index)
                          ) {
                            J = p[0].substring(0, K.index + K[0].length);
                            break;
                          }
                          "{" === K[0]
                            ? ("\\" === K.input[K.index - 1] &&
                                "\\" !== !K.input[K.index - 2]) ||
                              V++
                            : "}" === K[0] &&
                              (("\\" === K.input[K.index - 1] &&
                                "\\" !== !K.input[K.index - 2]) ||
                                V--);
                        }
                        var Q = G.length;
                        if (J.length - 2 * Q > 0 && /[^\s$]/.exec(J)) {
                          e = e.substring(J.length);
                          var X = (J = we(J)).indexOf("​");
                          X > -1 && (v[b + X + 1] = -1),
                            (b += J.length),
                            w.push({
                              type: "inline_math",
                              text: xe(J.substring(Q, J.length - Q)),
                              pattern: G,
                            });
                          continue;
                        }
                        (b += (l = we(p[0])).length),
                          (e = e.substring(p[0].length)),
                          S(w, l || "");
                      }
                    }
                  else
                    (b += (l = we(p[0])).length),
                      (e = e.substring(p[0].length)),
                      w.push({ type: a.attr, text: l });
                }
              else {
                if (
                  ((e = e.substring(p[0].length)),
                  (l = p[0].replace(/[\uE016\uE017\uE019]/g, "")),
                  (p = /(&#?[a-z0-9]+;)([?!.,:**_~;]*)$/i.exec(l)))
                )
                  (l = l.substr(0, p.index + p[1].length)),
                    (e = (p[2] || "") + e);
                else if (
                  ((p = /[?!.,:**_~;]+$/.exec(l)) &&
                    ((l = l.substr(0, p.index)), (e = p[0] + e)),
                  (p = /\)+$/.exec(l)))
                ) {
                  var Z =
                    (l.match(/\)/g) || []).length -
                    (l.match(/\(/g) || []).length;
                  Z > 0 &&
                    (p = new RegExp("\\){" + Z + "}$").exec(l)) &&
                    ((l = l.substr(0, p.index)), (e = p[0] + e));
                }
                (b += l.length),
                  (h = l),
                  null === /^\w+:\/\//.exec(l) &&
                    /@/.exec(l) &&
                    (h = "mailto:" + h),
                  w.push({ type: a.url, href: xe(h), text: l }),
                  (o.hasContent = !0);
              }
            else
              (b += p[0].length),
                (e = e.substring(p[0].length)),
                "",
                (l = p[1]),
                (h =
                  "@" === p[4]
                    ? ":" === p[1].charAt(6)
                      ? l
                      : "mailto:" + p[1]
                    : l),
                w.push({ type: a.autolink, href: xe(h), text: l }),
                (o.hasContent = !0);
          var ee = E(w);
          return n || (ee = xe(ee, {})), ee;
        }),
          (Se.exec = Se);
        var Ee = /^( *)[*+-][ \t\u00A0]+(\[(x|X)\]|\[ \]) +/,
          Te = /^( *)[*+-][ \t\u00A0]+/,
          _e = /^( *)\d+(\.|\))[ \t\u00A0]+/,
          Ae = /^( *)1(\.|\))[ \t\u00A0]+/,
          Me = function () {
            return File.shouldRemapPunctuation()
              ? /^ *[>〉》][^\n]+/
              : /^ *>[^\n]+/;
          };
        var Le = /^( *#{1,6}\s*)([^\n]+?)(\s+#+ *)*$/m,
          Ne = /^( *#{1,6}\s+)([^\n]+?)(\s+#+ *)*$/m;
        function De(e, t, n, i, r, s) {
          var l = [],
            c = "",
            d = d || { cursorDiff: r };
          function u(e, n, r) {
            var s = [];
            return (
              (s[0] = e.substr(0, n.index)),
              (s[1] = e.substr(n.index, n[0].length)),
              (s[2] = e.substr(n.index + n[0].length)),
              s
                .map(function (e, n) {
                  return 1 == n
                    ? t.options.decorate(r)
                    : e
                    ? t.options.decorate({
                        type: a.paragraph,
                        inner: t.output(
                          e,
                          null,
                          null,
                          { attr: !o.isType(i, a.heading), emptyline: 2 != n },
                          d
                        ),
                      })
                    : "";
                })
                .join("")
            );
          }
          for (i && i.cid == File.editor.focusCid && (d.isCur = !0); e; ) {
            if (!n && /^\s*[-+*_<\[\{|#0-9`~=>$]/m.exec(e)) {
              if ((l = /^ *>[^\n]+/m.exec(e))) {
                c = u(e, l, {
                  type: a.blockquote,
                  pattern: l[0].match(/^( *> ?)+/gm)[0],
                  inner: De(l[0].replace(/^( *> ?)+/gm, ""), t, !0, i, r),
                });
                break;
              }
              if ((l = (File.option.strictMarkdown ? Ne : Le).exec(e))) {
                var h = "h" + l[0].match(/#/g).length;
                s.push(h),
                  (c = u(e, l, {
                    type: a.heading,
                    meta_before: l[0].substring(0, l[1].length),
                    meta_after: l[3] || "",
                    mdlike: h,
                    inner: t.output(l[2], null, null, { attr: !1 }, d),
                  }));
                break;
              }
              if (
                (l = /^( *(`{3,}|~{3,}|·{3,})[ \t\u00A0]*)([^\n`]+)? *$/m.exec(
                  e
                ))
              ) {
                c = u(e, l, { type: a.fences, lang: l[3], pattern: l[1] });
                break;
              }
              if ((l = /^\s*\[\^([^\]\n]+)\]:(\s*)([^\n]*)$/m.exec(e))) {
                c = u(e, l, {
                  type: a.def_footnote,
                  ref: l[1],
                  pattern: l[2],
                  inner: t.output(l[3] || "", null, null, null, d),
                });
                break;
              }
              if ((l = /^\s*\[([^\]\n]+)\]:(\s*)([^\n]*)/m.exec(e))) {
                c = u(e, l, {
                  type: a.def_link,
                  ref: l[1],
                  pattern: l[2],
                  inner: t.output(l[3] || "", null, null, null, d),
                });
                break;
              }
              if ((l = /^(\s*)(([-+*]|\d+(\.|\)))[ \t]+)/m.exec(e))) {
                c = u(e, l, {
                  type: "block",
                  inner: t.output(l[0] || "", null, null, null, d),
                });
                break;
              }
              if ((l = /^\s*(\$\$|\[toc\])\s*$/im.exec(e))) {
                c = u(e, l, {
                  type: "block",
                  inner: t.output(l[0] || "", null, null, null, d),
                });
                break;
              }
              if ((l = /^\s*([-+_*])\s*\1\s*\1(\s|\1)*$/m.exec(e))) {
                c = u(e, l, {
                  type: "block",
                  inner: t.output(l[0] || "", null, null, null, d),
                });
                break;
              }
              if ((l = /^ *\|([^\|]+\|.+)\|\s*$/m.exec(e))) {
                c = u(e, l, {
                  type: "block",
                  inner: t.output(l[0] || "", null, null, null, d),
                });
                break;
              }
            }
            c = t.options.decorate({
              type: a.paragraph,
              inner: t.output(
                e,
                null,
                null,
                { attr: !o.isType(i, a.heading) },
                d
              ),
            });
            break;
          }
          return c;
        }
        var Be,
          Re = {};
        (Re.options = Re.setOptions =
          function (e) {
            return ke(Re.defaults, e), Re;
          }),
          (Re.defaults = {
            gfm: !0,
            tables: !0,
            breaks: !1,
            pedantic: !1,
            sanitize: !1,
            smartLists: !1,
            silent: !1,
            highlight: null,
            langPrefix: "lang-",
            smartypants: !1,
            headerPrefix: "",
          }),
          (Re.parseInline = function (e, t, n) {
            return (
              Be || (Be = new ue()),
              Be.output(e, null, null, t, { cursorDiff: n })
            );
          }),
          (Re.parsePandocAttr = function (e) {
            var t = {};
            return e && "{" == e[0] && "}" == e[e.length - 1]
              ? ((
                  (e = e.replace(/(^{)|(}$)/g, "")).split(/\s+/) || [e]
                ).forEach(function (e) {
                  var n;
                  (n = /^#(.+)/.exec(e))
                    ? (t.id = i.escapeInQuote(n[1]))
                    : (n = /^\.(.+)/.exec(e))
                    ? (t.class = (t.class || "") + " " + i.escapeInQuote(n[1]))
                    : (n = /^(.+)=(['"])([^'"]+)\2/.exec(e)) &&
                      ((t.attr = (t.attr || "") + " " + e),
                      (t.nativeAttr = t.nativeAttr || {}),
                      (t.nativeAttr[n[1]] = n[3]));
                }),
                t)
              : t;
          }),
          (Re.attrToString = function (e) {
            var t = "";
            return (
              e.id && (t += " id='" + e.id + "'"),
              e.class && (t += " class='" + e.class.trim() + "'"),
              e.attr && (t += e.attr),
              t
            );
          }),
          (Re.InlineLexer = ue),
          (Re.quickParse = function e(t, n, r, s, c, d) {
            var u,
              h = 0,
              p = r,
              f = [];
            function m(e, t, n) {
              return new o({
                type: n || a.paragraph,
                text: e,
                parent: t,
                in: t.get("in"),
              });
            }
            function g(e, i, r, s) {
              n.editor.undo.endSnap(!0),
                r.cid == n.editor.focusCid && n.editor.store(),
                i.undo.push(l.buildReplaceUndo(r));
              var c = null;
              return (
                s && s.start
                  ? ((h = h - s.start + e.length),
                    (c = new o({
                      type: a.paragraph,
                      text: t.substring(0, s.start - 1),
                    })),
                    r.addBefore(c),
                    l.addUndoForInsert(i, c))
                  : (h += e.length),
                (t = t.substring((s ? s.start : 0) + e.length)),
                c
              );
            }
            function v(i, r, o, a, s) {
              return (
                (a = a || e(t, n, i, !1, r, d)),
                r.redo.push(l.buildReplaceUndo(o)),
                {
                  html: (s ? s.toHTML() : "") + o.toHTML(a.html),
                  offset: h + a.offset,
                  focus: a.focus,
                  blockChanged: !0,
                  command: r,
                }
              );
            }
            function y(i, s, l, c) {
              var d,
                u,
                h = File.option.indentSize,
                f = g((i = i.replace("【", "[").replace("】", "]")), s, r, c);
              if (
                (r.set("type", a.list),
                r.set("text", ""),
                r.set("style", l),
                (d = m("", r, a.list_item)).set(
                  "checked",
                  null != /x|X/g.exec(c.line)
                ),
                i.indexOf("[") > -1 && d.set("style", o.ListType.task),
                l == o.ListType.ul &&
                  (File.option.prettyIndent
                    ? r.set(
                        "pattern",
                        i.replace(/\[[xX\s]\]\s+/, "").trim() +
                          " ".repeat(h - 1)
                      )
                    : r.set(
                        "pattern",
                        i.replace(/\[[xX\s]\]\s+/, "").trim() + " "
                      )),
                l == o.ListType.ol)
              ) {
                var y = i.match(/\d+/)[0].replace(/^1$/, "");
                "" != y ? r.set("start", y) : r.unset("start"),
                  File.option.prettyIndent
                    ? r.set(
                        "pattern",
                        i.replace(/\d+/, "{0}").trim() + " ".repeat(h - 1)
                      )
                    : r.set("pattern", i.replace(/\d+/, "{0}").trim() + " ");
              }
              return (
                i &&
                  File.option.autoPairExtendSymbol &&
                  /\*\s$/.exec(i) &&
                  (t = t.replace(/^\*/, "")),
                (p = m(t, d, a.paragraph)),
                ((u = e(t, n, p, !1)).html = d.toHTML(u.html)),
                v(null, s, r, u, f)
              );
            }
            if (
              ((c = c || (!s && l.makeEmptyCommand())),
              File.option.strictMarkdown &&
                ((Ee = File.shouldRemapPunctuation()
                  ? /^( {0,3})[*+-][ \t\u00A0]+([\[【](x|X)[\]】]|[\[【] [\]】]) +/
                  : /^( {0,3})[*+-][ \t\u00A0]+(\[(x|X)\]|\[ \]) +/),
                (Te = /^( {0,3})[*+-][ \t\u00A0]+/),
                (_e = /^( {0,3})\d+(\.|\))[ \t\u00A0]+/),
                (Ae = /^( {0,3})1(\.|\))[ \t\u00A0]+/)),
              d && void 0 === d.endId && (d.endId = d.id),
              d && void 0 === d.startId && (d.startId = d.id),
              !(s = s || !d || d.endId != r.cid))
            ) {
              var b = i.findLine(t, d.end);
              if (Me().exec(b.line)) {
                if (!/^(\s*>){10,}/.exec(b.line))
                  return (function (e, n) {
                    var i = g(n.line.match(/^ *[>〉》][ \u00A0]?/)[0], e, r, n);
                    return (
                      r.set("type", a.blockquote),
                      r.set("text", ""),
                      (p = m(t, r)),
                      e.redo.push(l.buildReplaceUndo(r)),
                      v(p, e, r, void 0, i)
                    );
                  })(c, b);
              } else {
                if ((u = Ee.exec(b.line))) return y(u[0], c, o.ListType.ul, b);
                if ((u = Te.exec(b.line))) return y(u[0], c, o.ListType.ul, b);
                if (
                  (u = (
                    File.option.strictNumberStartOnNewLine && b.start ? Ae : _e
                  ).exec(b.line))
                )
                  return y(u[0], c, o.ListType.ol, b);
                if (
                  (u = (function (e, t) {
                    var n = e.get("parent");
                    return (
                      o.isType(e, a.paragraph) &&
                      !e.get("before") &&
                      o.isType(n, a.list_item) &&
                      n.get("style") !== o.ListType.task &&
                      n.get("parent").get("style") == o.ListType.ul &&
                      (File.shouldRemapPunctuation()
                        ? /(^ *[\[【](x|X)[\]】]( |\t)+)|((^ *[\[【] [\]】]) +)/g
                        : /(^ *\[(x|X)\]( |\t)+)|((^ *\[ \]) +)/g
                      ).exec(t)
                    );
                  })(r, t))
                )
                  return (function (i, a) {
                    var s,
                      l,
                      c = r.get("parent");
                    return (
                      g(i, a, c),
                      c.set("style", o.ListType.task),
                      c.set("checked", null != /x|X/g.exec(i)),
                      r.set("text", t),
                      ((l = e(t, n, (p = r), !0, a)).html = void 0),
                      ((s = v(null, a, c, l)).replaceCid = c.cid),
                      s
                    );
                  })(u[0], c);
              }
            }
            var w = [],
              x = {
                innerHtml: De(
                  t,
                  n.inline,
                  s || o.isType(r, a.heading),
                  r,
                  f,
                  w
                ),
                offset: 0,
                focus: r.cid,
                blockChanged: !1,
                command: c,
                cursorDiff: f,
                mdlike: w[0],
              };
            return (x.html = r && r.toHTML(x.innerHtml, w[0])), x;
          }),
          (Re.reDefLink = P),
          (Re.reDefFootnote = I),
          (Re.reOL = h[o.ListType.ol]),
          (Re.renderHtmlWithBlockMeta = function e(t, n) {
            if (o.isType(t, a.paragraph)) {
              var i = [],
                r = De(t.safeGetStrAttr("text"), n.inline, !1, t, [], i);
              return t.toHTML(r, i[0]);
            }
            if (t.get("children").length) {
              for (var s = t.getFirstChild(), l = []; s; )
                l.push(e(s, n)), (s = s.get("after"));
              return t.toHTML(l.join(""));
            }
            return t.toHTML(void 0, void 0, { mathCount: 0 });
          }),
          (Re.splitTableCell = ae),
          (Re.recoverEscape = xe),
          (n.exports = Re);
      }
    ),
    $__System.registerDynamic("5a", [], !1, function (e, t, n) {
      var i = $__System.registry
        .get("@@global-helpers")
        .prepareGlobal(n.id, null, null);
      return (
        (function (e, t) {
          "use strict";
          if (
            "IntersectionObserver" in e &&
            "IntersectionObserverEntry" in e &&
            "intersectionRatio" in e.IntersectionObserverEntry.prototype
          )
            "isIntersecting" in e.IntersectionObserverEntry.prototype ||
              Object.defineProperty(
                e.IntersectionObserverEntry.prototype,
                "isIntersecting",
                {
                  get: function () {
                    return this.intersectionRatio > 0;
                  },
                }
              );
          else {
            var n = [];
            (r.prototype.THROTTLE_TIMEOUT = 100),
              (r.prototype.POLL_INTERVAL = null),
              (r.prototype.USE_MUTATION_OBSERVER = !0),
              (r.prototype.observe = function (e) {
                if (
                  !this._observationTargets.some(function (t) {
                    return t.element == e;
                  })
                ) {
                  if (!e || 1 != e.nodeType)
                    throw new Error("target must be an Element");
                  this._registerInstance(),
                    this._observationTargets.push({ element: e, entry: null }),
                    this._monitorIntersections(),
                    this._checkForIntersections();
                }
              }),
              (r.prototype.unobserve = function (e) {
                (this._observationTargets = this._observationTargets.filter(
                  function (t) {
                    return t.element != e;
                  }
                )),
                  this._observationTargets.length ||
                    (this._unmonitorIntersections(),
                    this._unregisterInstance());
              }),
              (r.prototype.disconnect = function () {
                (this._observationTargets = []),
                  this._unmonitorIntersections(),
                  this._unregisterInstance();
              }),
              (r.prototype.takeRecords = function () {
                var e = this._queuedEntries.slice();
                return (this._queuedEntries = []), e;
              }),
              (r.prototype._initThresholds = function (e) {
                var t = e || [0];
                return (
                  Array.isArray(t) || (t = [t]),
                  t.sort().filter(function (e, t, n) {
                    if ("number" != typeof e || isNaN(e) || e < 0 || e > 1)
                      throw new Error(
                        "threshold must be a number between 0 and 1 inclusively"
                      );
                    return e !== n[t - 1];
                  })
                );
              }),
              (r.prototype._parseRootMargin = function (e) {
                var t = (e || "0px").split(/\s+/).map(function (e) {
                  var t = /^(-?\d*\.?\d+)(px|%)$/.exec(e);
                  if (!t)
                    throw new Error(
                      "rootMargin must be specified in pixels or percent"
                    );
                  return { value: parseFloat(t[1]), unit: t[2] };
                });
                return (
                  (t[1] = t[1] || t[0]),
                  (t[2] = t[2] || t[0]),
                  (t[3] = t[3] || t[1]),
                  t
                );
              }),
              (r.prototype._monitorIntersections = function () {
                this._monitoringIntersections ||
                  ((this._monitoringIntersections = !0),
                  this.POLL_INTERVAL
                    ? (this._monitoringInterval = setInterval(
                        this._checkForIntersections,
                        this.POLL_INTERVAL
                      ))
                    : (o(e, "resize", this._checkForIntersections, !0),
                      o(t, "scroll", this._checkForIntersections, !0),
                      this.USE_MUTATION_OBSERVER &&
                        "MutationObserver" in e &&
                        ((this._domObserver = new MutationObserver(
                          this._checkForIntersections
                        )),
                        this._domObserver.observe(t, {
                          attributes: !0,
                          childList: !0,
                          characterData: !0,
                          subtree: !0,
                        }))));
              }),
              (r.prototype._unmonitorIntersections = function () {
                this._monitoringIntersections &&
                  ((this._monitoringIntersections = !1),
                  clearInterval(this._monitoringInterval),
                  (this._monitoringInterval = null),
                  a(e, "resize", this._checkForIntersections, !0),
                  a(t, "scroll", this._checkForIntersections, !0),
                  this._domObserver &&
                    (this._domObserver.disconnect(),
                    (this._domObserver = null)));
              }),
              (r.prototype._checkForIntersections = function () {
                var t = this._rootIsInDom(),
                  n = t
                    ? this._getRootRect()
                    : {
                        top: 0,
                        bottom: 0,
                        left: 0,
                        right: 0,
                        width: 0,
                        height: 0,
                      };
                this._observationTargets.forEach(function (r) {
                  var o = r.element,
                    a = s(o),
                    l = this._rootContainsTarget(o),
                    c = r.entry,
                    d = t && l && this._computeTargetAndRootIntersection(o, n),
                    u = (r.entry = new i({
                      time:
                        e.performance && performance.now && performance.now(),
                      target: o,
                      boundingClientRect: a,
                      rootBounds: n,
                      intersectionRect: d,
                    }));
                  c
                    ? t && l
                      ? this._hasCrossedThreshold(c, u) &&
                        this._queuedEntries.push(u)
                      : c && c.isIntersecting && this._queuedEntries.push(u)
                    : this._queuedEntries.push(u);
                }, this),
                  this._queuedEntries.length &&
                    this._callback(this.takeRecords(), this);
              }),
              (r.prototype._computeTargetAndRootIntersection = function (n, i) {
                if ("none" != e.getComputedStyle(n).display) {
                  for (
                    var r, o, a, l, d, u, h, p, f = s(n), m = c(n), g = !1;
                    !g;

                  ) {
                    var v = null,
                      y = 1 == m.nodeType ? e.getComputedStyle(m) : {};
                    if ("none" == y.display) return;
                    if (
                      (m == this.root || m == t
                        ? ((g = !0), (v = i))
                        : m != t.body &&
                          m != t.documentElement &&
                          "visible" != y.overflow &&
                          (v = s(m)),
                      v &&
                        ((r = v),
                        (o = f),
                        (a = Math.max(r.top, o.top)),
                        (l = Math.min(r.bottom, o.bottom)),
                        (d = Math.max(r.left, o.left)),
                        (u = Math.min(r.right, o.right)),
                        (p = l - a),
                        !(f = (h = u - d) >= 0 &&
                          p >= 0 && {
                            top: a,
                            bottom: l,
                            left: d,
                            right: u,
                            width: h,
                            height: p,
                          })))
                    )
                      break;
                    m = c(m);
                  }
                  return f;
                }
              }),
              (r.prototype._getRootRect = function () {
                var e;
                if (this.root) e = s(this.root);
                else {
                  var n = t.documentElement,
                    i = t.body;
                  e = {
                    top: 0,
                    left: 0,
                    right: n.clientWidth || i.clientWidth,
                    width: n.clientWidth || i.clientWidth,
                    bottom: n.clientHeight || i.clientHeight,
                    height: n.clientHeight || i.clientHeight,
                  };
                }
                return this._expandRectByRootMargin(e);
              }),
              (r.prototype._expandRectByRootMargin = function (e) {
                var t = this._rootMarginValues.map(function (t, n) {
                    return "px" == t.unit
                      ? t.value
                      : (t.value * (n % 2 ? e.width : e.height)) / 100;
                  }),
                  n = {
                    top: e.top - t[0],
                    right: e.right + t[1],
                    bottom: e.bottom + t[2],
                    left: e.left - t[3],
                  };
                return (
                  (n.width = n.right - n.left), (n.height = n.bottom - n.top), n
                );
              }),
              (r.prototype._hasCrossedThreshold = function (e, t) {
                var n = e && e.isIntersecting ? e.intersectionRatio || 0 : -1,
                  i = t.isIntersecting ? t.intersectionRatio || 0 : -1;
                if (n !== i)
                  for (var r = 0; r < this.thresholds.length; r++) {
                    var o = this.thresholds[r];
                    if (o == n || o == i || o < n != o < i) return !0;
                  }
              }),
              (r.prototype._rootIsInDom = function () {
                return !this.root || l(t, this.root);
              }),
              (r.prototype._rootContainsTarget = function (e) {
                return l(this.root || t, e);
              }),
              (r.prototype._registerInstance = function () {
                n.indexOf(this) < 0 && n.push(this);
              }),
              (r.prototype._unregisterInstance = function () {
                var e = n.indexOf(this);
                -1 != e && n.splice(e, 1);
              }),
              (e.IntersectionObserver = r),
              (e.IntersectionObserverEntry = i);
          }
          function i(e) {
            (this.time = e.time),
              (this.target = e.target),
              (this.rootBounds = e.rootBounds),
              (this.boundingClientRect = e.boundingClientRect),
              (this.intersectionRect = e.intersectionRect || {
                top: 0,
                bottom: 0,
                left: 0,
                right: 0,
                width: 0,
                height: 0,
              }),
              (this.isIntersecting = !!e.intersectionRect);
            var t = this.boundingClientRect,
              n = t.width * t.height,
              i = this.intersectionRect,
              r = i.width * i.height;
            this.intersectionRatio = n
              ? Number((r / n).toFixed(4))
              : this.isIntersecting
              ? 1
              : 0;
          }
          function r(e, t) {
            var n,
              i,
              r,
              o = t || {};
            if ("function" != typeof e)
              throw new Error("callback must be a function");
            if (o.root && 1 != o.root.nodeType)
              throw new Error("root must be an Element");
            (this._checkForIntersections =
              ((n = this._checkForIntersections.bind(this)),
              (i = this.THROTTLE_TIMEOUT),
              (r = null),
              function () {
                r ||
                  (r = setTimeout(function () {
                    n(), (r = null);
                  }, i));
              })),
              (this._callback = e),
              (this._observationTargets = []),
              (this._queuedEntries = []),
              (this._rootMarginValues = this._parseRootMargin(o.rootMargin)),
              (this.thresholds = this._initThresholds(o.threshold)),
              (this.root = o.root || null),
              (this.rootMargin = this._rootMarginValues
                .map(function (e) {
                  return e.value + e.unit;
                })
                .join(" "));
          }
          function o(e, t, n, i) {
            "function" == typeof e.addEventListener
              ? e.addEventListener(t, n, i || !1)
              : "function" == typeof e.attachEvent &&
                e.attachEvent("on" + t, n);
          }
          function a(e, t, n, i) {
            "function" == typeof e.removeEventListener
              ? e.removeEventListener(t, n, i || !1)
              : "function" == typeof e.detatchEvent &&
                e.detatchEvent("on" + t, n);
          }
          function s(e) {
            var t;
            try {
              t = e.getBoundingClientRect();
            } catch (e) {}
            return t
              ? ((t.width && t.height) ||
                  (t = {
                    top: t.top,
                    right: t.right,
                    bottom: t.bottom,
                    left: t.left,
                    width: t.right - t.left,
                    height: t.bottom - t.top,
                  }),
                t)
              : { top: 0, bottom: 0, left: 0, right: 0, width: 0, height: 0 };
          }
          function l(e, t) {
            for (var n = t; n; ) {
              if (n == e) return !0;
              n = c(n);
            }
            return !1;
          }
          function c(e) {
            var t = e.parentNode;
            return t && 11 == t.nodeType && t.host
              ? t.host
              : t && t.assignedSlot
              ? t.assignedSlot.parentNode
              : t;
          }
        })(window, document),
        i()
      );
    }),
    $__System.registerDynamic("2b", ["e", "5a"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = e("e");
      if (
        (e("5a"),
        (window.app || window.isWk) &&
          (window.open = function (e) {
            bridge.callHandler("window.open", e);
          }),
        window.reqnode &&
          (window.open = function () {
            console.error("window.open not implemeted");
          }),
        "performance" in window == 0 &&
          (window.performance = window.performance || {
            offset: Date.now(),
            now: function () {
              return Date.now() - this.offset;
            },
          }),
        (Element.prototype.insertChildAtIndex = function (e, t) {
          t || (t = 0),
            t >= this.children.length
              ? this.appendChild(e)
              : this.insertBefore(e, this.children[t]);
        }),
        (DocumentFragment.prototype.insertChildAtIndex = function (e, t) {
          t || (t = 0),
            t >= this.children.length
              ? this.appendChild(e)
              : this.insertBefore(e, this.children[t]);
        }),
        Number.isNaN || (Number.isNaN = window.isNaN),
        Number.parseInt || (Number.parseInt = window.parseInt),
        !window.Set)
      ) {
        var r = function () {
          this.set = [];
        };
        (r.prototype.add = function (e) {
          -1 == !this.has(e) && this.set.push(e);
        }),
          (r.prototype.delete = function (e) {
            this.has(e) && this.set.splice(this.set.indexOf(e));
          }),
          (r.prototype.has = function (e) {
            return this.set.indexOf(e) > -1;
          }),
          (window.Set = r);
      }
      if (!window.Map) {
        var o = function () {
          this.map = {};
        };
        (o.prototype.get = function (e) {
          return this.map[e];
        }),
          (o.prototype.delete = function (e) {
            delete this.map[e];
          }),
          (o.prototype.set = function (e, t) {
            this.map[e] = t;
          }),
          (window.Map = o);
      }
      [].fill ||
        Object.defineProperty(Array.prototype, "fill", {
          value: function (e) {
            for (
              var t = Object(this),
                n = parseInt(t.length),
                i = arguments[1],
                r = parseInt(i) || 0,
                o = r < 0 ? Math.max(n + r, 0) : Math.min(r, n),
                a = arguments[2],
                s = void 0 === a ? n : parseInt(a) || 0,
                l = s < 0 ? Math.max(n + s, 0) : Math.min(s, n);
              o < l;
              o++
            )
              t[o] = e;
            return t;
          },
        }),
        [].find ||
          Object.defineProperty(Array.prototype, "find", {
            value: function (e) {
              if (null == this)
                throw new TypeError('"this" is null or not defined');
              var t = Object(this),
                n = t.length >>> 0;
              if ("function" != typeof e)
                throw new TypeError("predicate must be a function");
              for (var i = arguments[1], r = 0; r < n; ) {
                var o = t[r];
                if (e.call(i, o, r, t)) return o;
                r++;
              }
            },
            writable: !0,
          }),
        Object.defineProperty(Array.prototype, "remove", {
          value: function (e) {
            var t = this.indexOf(e);
            if (~t) return this.splice(t, 1);
          },
          writable: !0,
        }),
        Object.defineProperty(Array.prototype, "removeFirstIf", {
          value: function (e) {
            for (var t = this.length; t--; )
              if (e(this[t], t)) return void this.splice(t, 1);
          },
        }),
        Object.defineProperty(Array.prototype, "removeIf", {
          value: function (e) {
            for (var t = this.length; t--; ) e(this[t], t) && this.splice(t, 1);
          },
        }),
        Object.defineProperty(Array.prototype, "repeat", {
          value: function (e, t) {
            for (; t; ) this[--t] = e;
            return this;
          },
        }),
        Object.defineProperty(Array.prototype, "last", {
          value: function () {
            return this.length ? this[this.length - 1] : void 0;
          },
          writable: !0,
        }),
        Object.defineProperty(Array.prototype, "lastDef", {
          value: function () {
            for (var e = this.length - 1; e >= 0; e--)
              if (void 0 != this[e]) return this[e];
          },
        }),
        Object.defineProperty(Array.prototype, "clone", {
          value: function () {
            return this.slice(0);
          },
          writable: !0,
        }),
        Object.defineProperty(Array.prototype, "subarray", {
          value: function (e, t) {
            return this.slice(e, t);
          },
        }),
        (Object.clone = function (e) {
          return e ? Object.assign({}, e) : null;
        }),
        "function" != typeof Object.assign &&
          Object.defineProperty(Object, "assign", {
            value: function (e, t) {
              if (null == e)
                throw new TypeError(
                  "Cannot convert undefined or null to object"
                );
              for (var n = Object(e), i = 1; i < arguments.length; i++) {
                var r = arguments[i];
                if (null != r)
                  for (var o in r)
                    Object.prototype.hasOwnProperty.call(r, o) && (n[o] = r[o]);
              }
              return n;
            },
            writable: !0,
            configurable: !0,
          }),
        window.NodeList &&
          !NodeList.prototype.forEach &&
          (NodeList.prototype.forEach = function (e, t) {
            t = t || window;
            for (var n = 0; n < this.length; n++) e.call(t, this[n], n, this);
          }),
        window.NodeList &&
          !NodeList.prototype.last &&
          (NodeList.prototype.last = function () {
            return this.length > 0 ? this[this.length - 1] : null;
          }),
        (NodeList.prototype.remove = function () {
          Array.prototype.slice.call(this).forEach(function (e) {
            e.remove();
          });
        }),
        (Node.prototype.rawText = function (e) {
          if (window.File) {
            var t =
                File.option.convertSmartOnRender &&
                (File.option.smartDash || File.option.smartQuote),
              n = this.cloneNode(!0);
            return (
              n.querySelectorAll(".md-emptyline").forEach(function (e) {
                e.textContent = e.textContent.replace(/\n/, "");
              }),
              File.option.ignoreLineBreak &&
                n.querySelectorAll(".md-softbreak").forEach(function (e) {
                  e.textContent = e.textContent.replace(/^\u00a0/, "\n");
                }),
              n.querySelectorAll(".md-linebreak").forEach(function (e) {
                e.textContent = e.textContent.replace(/\n\n/, "\n");
              }),
              n.querySelectorAll(".md-ruby ruby").forEach(function (e) {
                e.textContent = "";
              }),
              File.option.enableInlineMath &&
                n.querySelectorAll("mjx-container").forEach(function (e) {
                  e.textContent = "";
                }),
              t &&
                n.querySelectorAll(".md-pants").forEach(function (e) {
                  e.textContent.indexOf(e.dataset.content) > -1 &&
                    e.firstElementChild &&
                    e.firstElementChild.remove(),
                    e.classList.contains("md-pants-space-after")
                      ? (e.textContent = e.textContent.replace(/^ /, '"'))
                      : e.classList.contains("md-pants-space-before")
                      ? (e.textContent = e.textContent.replace(/»/, '"'))
                      : (e.textContent = e.textContent.replace(
                          e.dataset.content || e.dataset.text,
                          e.dataset.text
                        ));
                }),
              e &&
                n
                  .querySelectorAll(".md-math-after-sym, .md-emoji-control-ch")
                  .forEach(function (e) {
                    e.textContent = e.textContent.replace(/\u200b/g, "");
                  }),
              void 0 === n.textContent ? n.innerText : n.textContent
            );
          }
        }),
        (i.fn.visibleText = function () {
          if (0 === this.length) return "";
          if (
            1 === this.length &&
            (3 === this[0].nodeType || 0 === this[0].childElementCount)
          )
            return this.text();
          var e = "";
          return (
            i.each(this.contents(), function (t, n) {
              3 === n.nodeType
                ? (e += n.textContent)
                : 1 === n.nodeType && n.tagName == "mjx-container".toUpperCase()
                ? (e += (n.nextElementSibling || {}).offsetWidth
                    ? n.textContent
                    : 1)
                : 1 === n.nodeType &&
                  (n.offsetHeight || n.offsetWidth) &&
                  (e += i(n).visibleText());
            }),
            e
          );
        }),
        window.console &&
          (function () {
            var e;
            (console.stack = function (e) {
              File.isNodeHtml ? new Error().stack : console.trace;
            }),
              console.warn ||
                (console.warn = function (e) {
                  console.log(e);
                }),
              File.isNode && (e = reqnode("electron").ipcRenderer);
            var t = console.error;
            console.sendError = function (e, n, i) {
              var r = i,
                o = i;
              "string" == typeof i ? (o = { detail: r }) : (r = void 0);
              var a = e;
              e.stack ? (a = e.stack) : e.message && (a = e.message);
              var s = !1 === n || "warn" === n || "warning" === n,
                l = `${a}${r ? " {" + r + "}" : ""}`;
              s ? console.warn(l) : t(l),
                JSBridge.invoke(s ? "logger.warn" : "logger.error", l),
                window.Reporter &&
                  ((!1 === n && !0 === n && "skip" === n) ||
                    window.Reporter.error(e, Object.assign({ level: n }, o)));
            };
            var n = console.log;
            if (
              ((console.sendLog = function (t, i) {
                n(t),
                  !i && Reporter.record(t),
                  File.isMac
                    ? bridge.callHandler("logger.info", t)
                    : File.isNode &&
                      (e || (e = reqnode("electron").ipcRenderer),
                      e && e.send("sendLog", t));
              }),
              (console.sendLogForDebug = function (e) {
                window.debugMode && console.sendLog(e);
              }),
              window.debugMode && File.isMac)
            ) {
              var i = console.debug;
              console.debug = function (e) {
                i(e), File.isMac && bridge.callHandler("logger.debug", e);
              };
            }
          })(),
        void 0 === NodeList.prototype.forEach &&
          (NodeList.prototype.forEach = Array.prototype.forEach),
        void 0 === HTMLCollection.prototype.forEach &&
          (HTMLCollection.prototype.forEach = Array.prototype.forEach),
        window.Promise ||
          (function (e) {
            var t = setTimeout;
            function n() {}
            function i(e) {
              if ("object" != typeof this)
                throw new TypeError("Promises must be constructed via new");
              if ("function" != typeof e) throw new TypeError("not a function");
              (this._state = 0),
                (this._handled = !1),
                (this._value = void 0),
                (this._deferreds = []),
                l(e, this);
            }
            function r(e, t) {
              for (; 3 === e._state; ) e = e._value;
              0 !== e._state
                ? ((e._handled = !0),
                  i._immediateFn(function () {
                    var n = 1 === e._state ? t.onFulfilled : t.onRejected;
                    if (null !== n) {
                      var i;
                      try {
                        i = n(e._value);
                      } catch (e) {
                        return void a(t.promise, e);
                      }
                      o(t.promise, i);
                    } else (1 === e._state ? o : a)(t.promise, e._value);
                  }))
                : e._deferreds.push(t);
            }
            function o(e, t) {
              try {
                if (t === e)
                  throw new TypeError(
                    "A promise cannot be resolved with itself."
                  );
                if (t && ("object" == typeof t || "function" == typeof t)) {
                  var n = t.then;
                  if (t instanceof i)
                    return (e._state = 3), (e._value = t), void s(e);
                  if ("function" == typeof n)
                    return void l(
                      ((r = n),
                      (o = t),
                      function () {
                        r.apply(o, arguments);
                      }),
                      e
                    );
                }
                (e._state = 1), (e._value = t), s(e);
              } catch (t) {
                a(e, t);
              }
              var r, o;
            }
            function a(e, t) {
              (e._state = 2), (e._value = t), s(e);
            }
            function s(e) {
              2 === e._state &&
                0 === e._deferreds.length &&
                i._immediateFn(function () {
                  e._handled || i._unhandledRejectionFn(e._value);
                });
              for (var t = 0, n = e._deferreds.length; t < n; t++)
                r(e, e._deferreds[t]);
              e._deferreds = null;
            }
            function l(e, t) {
              var n = !1;
              try {
                e(
                  function (e) {
                    n || ((n = !0), o(t, e));
                  },
                  function (e) {
                    n || ((n = !0), a(t, e));
                  }
                );
              } catch (e) {
                if (n) return;
                (n = !0), a(t, e);
              }
            }
            (i.prototype.catch = function (e) {
              return this.then(null, e);
            }),
              (i.prototype.then = function (e, t) {
                var i = new this.constructor(n);
                return (
                  r(
                    this,
                    new (function (e, t, n) {
                      (this.onFulfilled = "function" == typeof e ? e : null),
                        (this.onRejected = "function" == typeof t ? t : null),
                        (this.promise = n);
                    })(e, t, i)
                  ),
                  i
                );
              }),
              (i.all = function (e) {
                var t = Array.prototype.slice.call(e);
                return new i(function (e, n) {
                  if (0 === t.length) return e([]);
                  var i = t.length;
                  function r(o, a) {
                    try {
                      if (
                        a &&
                        ("object" == typeof a || "function" == typeof a)
                      ) {
                        var s = a.then;
                        if ("function" == typeof s)
                          return void s.call(
                            a,
                            function (e) {
                              r(o, e);
                            },
                            n
                          );
                      }
                      (t[o] = a), 0 == --i && e(t);
                    } catch (e) {
                      n(e);
                    }
                  }
                  for (var o = 0; o < t.length; o++) r(o, t[o]);
                });
              }),
              (i.resolve = function (e) {
                return e && "object" == typeof e && e.constructor === i
                  ? e
                  : new i(function (t) {
                      t(e);
                    });
              }),
              (i.reject = function (e) {
                return new i(function (t, n) {
                  n(e);
                });
              }),
              (i.race = function (e) {
                return new i(function (t, n) {
                  for (var i = 0, r = e.length; i < r; i++) e[i].then(t, n);
                });
              }),
              (i._immediateFn =
                ("function" == typeof setImmediate &&
                  function (e) {
                    setImmediate(e);
                  }) ||
                function (e) {
                  t(e, 0);
                }),
              (i._unhandledRejectionFn = function (e) {
                "undefined" != typeof console &&
                  console &&
                  console.warn("Possible Unhandled Promise Rejection:", e);
              }),
              (i._setImmediateFn = function (e) {
                i._immediateFn = e;
              }),
              (i._setUnhandledRejectionFn = function (e) {
                i._unhandledRejectionFn = e;
              }),
              (window.Promise = i);
          })(window),
        window.reqnode &&
          (window.alert = function (e) {
            JSBridge.invoke("dialog.showMessageBox", {
              type: "error",
              message: i.localize.getString("Error"),
              detail: e,
              buttons: [i.localize.getString("OK")],
            });
          }),
        window.debugMode &&
          (Object.observe ||
            (Object.observe = function (e, t) {
              return (
                (t = t || (() => {})),
                new Proxy(e, {
                  set(e, n, i, r) {
                    var o = e[n];
                    if (o === i) return;
                    let a = void 0 === o ? "add" : "update";
                    var s = { name: n, type: a, object: e };
                    "update" === a && (s.oldValue = o), (e[n] = i), t([s]);
                  },
                  deleteProperty(e, n, i) {
                    if (n in e) {
                      var r = {
                        name: n,
                        type: "delete",
                        object: e,
                        oldValue: e[n],
                      };
                      delete e[n], t([r]);
                    }
                  },
                })
              );
            })),
        window.requestIdleCallback ||
          ((window.requestIdleCallback = function (e, t) {
            return window.setTimeout(e, (t || {}).timeout || 100);
          }),
          (window.cancelIdleCallback = window.clearTimeout)),
        (window.requestSmartSchedule = function (e, t, n) {
          var i = null;
          return [
            setTimeout(() => {
              i = requestIdleCallback(e, { timeout: n - t });
            }, t),
            i,
          ];
        }),
        (window.cancelSmartSchedule = function (e) {
          e[0] && clearTimeout(e[0]), e[1] && cancelIdleCallback(e[1]);
        }),
        (t.safePromise = async (e) => {
          try {
            return await e();
          } catch (e) {
            return console.warn(e), null;
          }
        }),
        String.prototype.replaceAll ||
          (String.prototype.replaceAll = function (e, t) {
            return "[object regexp]" ===
              Object.prototype.toString.call(e).toLowerCase()
              ? this.replace(e, t)
              : this.replace(new RegExp(e, "g"), t);
          });
    }),
    $__System.registerDynamic("50", ["1b", "13", "2b"], !0, function (e, t, n) {
      "use strict";
      this || self, e("1b");
      var i,
        r = e("13"),
        o = r.Node,
        a = r.TYPE,
        s = (e("2b"), null);
      function l(e, t, n) {
        e && (e[t] = $.extend(e[t], n));
      }
      function c(e) {
        var t = File.editor.styleBookmark.style;
        [
          "Copy as Plain Text",
          "Copy as Markdown",
          "Copy as HTML Code",
          "Copy without Theme Styling",
        ].map((n) => {
          e["Edit→" + n] = {
            enabled: (!t || t.textSelected) && !File.isLocked,
          };
        });
      }
      function d(e, t) {
        if (((i = File.editor.styleBookmark.style), !e)) return;
        (e["Format→Inline Math"] = { hidden: !File.option.enableInlineMath }),
          (e["Format→Highlight"] = { hidden: !File.option.enableHighlight }),
          (e["Format→Subscript"] = { hidden: !File.option.enableSubscript }),
          (e["Format→Superscript"] = { hidden: !File.option.enableSubscript });
        var n = File.editor.stylize.CONST;
        !t &&
          File.editor.stylize.putBookmark(
            null,
            File.editor.stylize.buildBookmark()
          );
        var r = File.editor.styleBookmark.style,
          o = r.cannotContainInline;
        c(e),
          r.block[0] == a.def_footnote &&
            (o = o || File.editor.stylize.isAtFootnoteDefSpan()),
          (o = o || r.inline.indexOf(a.inline_math) > -1),
          [
            "Strong",
            "Emphasis",
            "Underline",
            "Code",
            "Strike",
            "Hyperlink",
            "Clear Format",
            "Inline Math",
            "Highlight",
            "Subscript",
            "Superscript",
            "Comment",
          ].map(function (t) {
            e["Format→" + t] = Object.assign(
              { enabled: !File.isLocked && !o, state: !1 },
              e["Format→" + t]
            );
          });
        var s = ["image", "strong", "em", "link"],
          l = {},
          d = File.editor.styleBookmark.style.inline;
        (d || []).map(function (t) {
          "image" !== t && (e["Format→" + n.StyleToNameMap[t]] = { state: !0 }),
            s.remove(t),
            (l[n.StyleToNameMap[t]] = !0);
        }),
          d.indexOf("link") > -1 ||
          d.indexOf("autolink") > -1 ||
          d.indexOf("url") > -1 ||
          d.indexOf("reflink") > -1 ||
          r.block.indexOf("def_link") > -1
            ? (e["Format→Hyperlink Actions"] = { enabled: !0 })
            : (e["Format→Hyperlink Actions"] = { enabled: !1 });
        const u =
          d.indexOf("image") > -1 ||
          d.indexOf("imgtag") > -1 ||
          d.indexOf("refimg") > -1;
        [
          "Open Image Location…",
          "Upload Image",
          "Copy Image to…",
          "Rename or Move Image to…",
          "Copy Image Content",
          "Zoom Image",
          "Delete Image File",
          "Switch Image Syntax",
        ].forEach((t) => {
          e[`Format→Image→${t}`] = { enabled: u };
        }),
          (e["Edit→Copy Image Content"] = {
            hidden: !1,
            visible: u,
            enabled: u,
          }),
          d.indexOf("refimg") > -1 &&
            (e["Format→Image→Switch Image Syntax"] = {
              hidden: !0,
              visible: !1,
            }),
          (e["Format→Image→Switch Image Syntax→Markdown Style"] = {
            state: d.indexOf("image") > -1,
          }),
          (e["Format→Image→Switch Image Syntax→HTML Style"] = {
            state: d.indexOf("imgtag") > -1,
          }),
          File.isMac &&
            (o ||
              s.map(function (e) {
                l[n.StyleToNameMap[e]] = !1;
              }),
            bridge.callHandler("touchBar.setInlineEnabled", !o),
            bridge.callHandler("touchBar.setInlineStates", l));
      }
      function u(e, t, n) {
        if (!e) return !1;
        if (
          (n && (e.length || (e = n), t.length || (t = n)),
          e.length == t.length)
        ) {
          for (var i = 0; i < e.length; i++) if (e[i] != t[i]) return !1;
          return !0;
        }
        return !1;
      }
      var h = function (e, t) {
        s && clearTimeout(s);
        var n = 60;
        i && i.inline.indexOf(a.inline_math) > -1 && (n = 50),
          File.isMacWK && (n = 30),
          t && (i = null),
          (s = setTimeout(function () {
            var t = (
                e ||
                File.editor.stylize.putBookmark(
                  null,
                  File.editor.stylize.buildBookmark()
                )
              ).style,
              n = {};
            i && u(t.block, i.block)
              ? u(t.inline, i.inline, [a.plain])
                ? t.textSelected != i.textSelected &&
                  ((i = File.editor.styleBookmark.style), c(n))
                : d(n, !0)
              : (p(n, !0), d(n, !0)),
              Object.keys(n).length > 0 && JSBridge.menu.update(n);
          }, n));
      };
      function p(e, t) {
        e || (e = {}),
          !t &&
            File.editor.stylize.putBookmark(
              null,
              File.editor.stylize.buildBookmark()
            );
        var n = File.editor.styleBookmark.style,
          i = File.editor.stylize.CONST.NormalBlockMap[n.block[0]];
        [
          "Heading 1",
          "Heading 2",
          "Heading 3",
          "Heading 4",
          "Heading 5",
          "Heading 6",
          "Paragraph",
          "Decrease Heading Level",
          "Increase Heading Level",
          "Table",
          "Code Fences",
          "Math Block",
          "Quote",
          "Ordered List",
          "Unordered List",
          "Task List",
          "Link Reference",
          "Footnotes",
          "YAML Front Matter",
          "Horizontal Line",
          "Table of Contents",
        ].map(function (t) {
          l(e, "Paragraph→" + t, {
            enabled: !File.isLocked && n.block.length > 0 && void 0 != i,
            state: !1,
          });
        }),
          !(function () {
            try {
              return (
                File.editor
                  .getMarkElem(
                    window.getSelection().getRangeAt(0).startContainer
                  )
                  .attr("mdtype") == r.TYPE.meta_block
              );
            } catch (e) {}
            return !1;
          })()
            ? [
                "Quote",
                "Ordered List",
                "Unordered List",
                "Task List",
                "Code Fences",
                "Math Block",
                "Insert Paragraph Before",
                "Insert Paragraph After",
              ].map(function (t) {
                l(e, "Paragraph→" + t, { enabled: !0 });
              })
            : l(e, "Paragraph→Paragraph", { enabled: !0 }),
          (File.editor.styleBookmark.style.block || []).indexOf(a.meta_block) >
          -1
            ? l(e, "Paragraph→Insert Paragraph Before", { enabled: !1 })
            : l(e, "Paragraph→Insert Paragraph Before", { enabled: !0 }),
          o.isType(n.block[0], a.fences, a.math_block, a.html_block)
            ? (l(e, "Paragraph→Code Tools→Copy Code Content", { enabled: !0 }),
              l(e, "Paragraph→Code Tools→Auto Indent Whole Code", {
                enabled: !0,
              }))
            : (l(e, "Paragraph→Code Tools→Copy Code Content", { enabled: !1 }),
              l(e, "Paragraph→Code Tools→Auto Indent Whole Code", {
                enabled: !1,
              }));
        var s,
          c = null,
          d = !1;
        (File.editor.styleBookmark.style.block || []).map(function (t) {
          !c && o.isType(t, "ol", "ul", "tasklist") && (c = t),
            t == a.blockquote && (d = !0);
          var n = File.editor.stylize.CONST.StyleToNameMap[t];
          if ((l(e, "Paragraph→" + n, { state: !0 }), "tasklist" == t)) {
            l(e, "Paragraph→Task Status", { enabled: !0 });
            var i = "checked" == File.editor.styleBookmark.style.state;
            l(e, "Paragraph→Task Status→Mark as Complete", { state: i }),
              l(e, "Paragraph→Task Status→Mark as Incomplete", { state: !i });
          } else l(e, "Paragraph→Task Status", { enabled: !1 });
        }),
          File.isMac &&
            ($("#md-searchpanel").is(":visible")
              ? bridge.callHandler("touchBar.showFindReplaceTouchBar")
              : document.body.classList.contains("modal-open")
              ? $("#table-insert-dialog:visible").length
                ? bridge.callHandler("touchBar.showInsertTableTouchBar")
                : bridge.callHandler("touchBar.showDialogTouchBar")
              : bridge.callHandler("touchBar.setBlockStyle", {
                  blockStyle:
                    File.editor.stylize.CONST.StyleToNameMap[
                      ((s = n.block), s[0] == a.table_cell ? a.table : s[0])
                    ] || "",
                  listType: c,
                  underQuote: d,
                  fallbackOnly: !i,
                }));
      }
      function f(e) {
        var t = !1;
        e || ((e = {}), (t = !0));
        var n =
          File.editor &&
          File.editor.sourceView &&
          File.editor.sourceView.inSourceMode;
        if (
          ((e["View→Source Code Mode"] = { state: n, enabled: !File.isLocked }),
          JSBridge.invoke("window.updateMenuForIsAlwaysOnTop"),
          (e["View→Focus Mode"] = { state: File.isFocusMode, enabled: !0 }),
          (e["View→Typewriter Mode"] = {
            state: File.isTypeWriterMode,
            enabled: !0,
          }),
          File.editor && File.editor.library)
        ) {
          var i = File.editor.library.isSidebarShown(),
            r = File.editor.library.getActiveTab();
          (e["View→Outline"] = { state: i && "outline" == r, enabled: !n }),
            (e["View→Articles"] = {
              state: i && "file-list" == r,
              enabled: !n,
            }),
            (e["View→File Tree"] = {
              state: i && "file-tree" == r,
              enabled: !n,
            }),
            (e["View→Search"] = {
              state: !(!i || !document.querySelector(".ty-on-search")),
              enabled: !n,
            }),
            (e["View→Toggle Sidebar"] = { enabled: !n });
        }
        t && JSBridge.menu.update(e);
      }
      var m = {
          doRefreshImageCopyStatus: function (e, t) {
            if (File.editor && File.editor.imgEdit) {
              var n = File.editor.imgEdit.getTargetImageStorageFolder(),
                i = !1;
              t || ((t = {}), (i = !0)),
                l(t, "Format→Image→Use Image Root Path", {
                  state: !!File.editor.docMenu.getLocalRootUrl(),
                }),
                l(
                  t,
                  "Format→Image→When Insert Local Image→Copy Image File to Folder…",
                  {
                    state:
                      !!n &&
                      "ipic" !== n.toLowerCase() &&
                      "upload" !== n.toLowerCase(),
                  }
                ),
                l(t, "Format→Image→When Insert Local Image→Upload Image", {
                  state:
                    n &&
                    ("ipic" == n.toLowerCase() || "upload" == n.toLowerCase()),
                }),
                void 0 !== e &&
                  (l(t, "Format→Image→Use Image Root Path", { enabled: !e }),
                  l(
                    t,
                    "Format→Image→When Insert Local Image→Copy Image File to Folder…",
                    { enabled: !e }
                  ),
                  l(t, "Format→Image→When Insert Local Image→Upload Image", {
                    enabled: !e,
                  })),
                i && JSBridge.menu.update(t);
            }
          },
          refreshViewMenu: f,
          refreshBlockMenu: p,
          bindMenu: function () {
            m.freshMenu(!0),
              $(File.editor.sessionStr).on("cursorChange", function (e, t) {
                h(t);
              }),
              h();
          },
          freshMenu: function (e) {
            var t =
              File.editor &&
              File.editor.sourceView &&
              File.editor.sourceView.inSourceMode;
            function n() {
              var n = {};
              if (
                (!File.isNode && f(n),
                (File.isMacWK || File.isMacLegacy) &&
                  (n["Format→Image→Upload Local Images via iPic"] = {
                    enabled: !File.isLocked && !t,
                  }),
                (n["Format→Image→Insert Local Images…"] = {
                  enabled: !File.isLocked,
                }),
                (n["Edit→Delete"] = { enabled: !File.isLocked }),
                (n["Edit→Delete Range"] = { enabled: !File.isLocked }),
                (n["Edit→Cut"] = { enabled: !File.isLocked }),
                (n["Edit→Paste"] = { enabled: !File.isLocked }),
                c(n),
                (n["Edit→Line Endings"] = { enabled: !File.isLocked }),
                (n["Edit→Whitespace and Line Breaks"] = { enabled: !t }),
                (n.Paragraph = { enabled: !File.isLocked && !t }),
                (n.Format = { enabled: !File.isLocked && !t }),
                File.setLineEnding(File.useCRLF, !1, !0),
                m.doRefreshImageCopyStatus(File.isLocked || t, n),
                t)
              ) {
                var i = File.editor.sourceView.cm.doc.historySize();
                (n["Edit→Undo"] = { enabled: !File.isLocked && i.undo > 0 }),
                  (n["Edit→Redo"] = { enabled: !File.isLocked && i.redo > 0 }),
                  File.isNode && window.ClientCommand.refreshViewMenu();
              } else
                (n["Edit→Undo"] = {
                  enabled:
                    !File.isLocked &&
                    File.editor &&
                    File.editor.undo &&
                    File.editor.undo.hasUndo(),
                }),
                  (n["Edit→Redo"] = {
                    enabled:
                      !File.isLocked &&
                      File.editor &&
                      File.editor.undo &&
                      File.editor.undo.hasRedo(),
                  }),
                  File.isNode
                    ? window.ClientCommand.refreshViewMenu()
                    : (n["View→Always on Top"] = { enabled: !0 }),
                  !File.isLocked && h(void 0, !0);
              e &&
                File.isNode &&
                ((n["File→Open File Location"] = {
                  enabled: !!File.bundle.filePath,
                }),
                (n["File→Reveal in Sidebar"] = {
                  enabled: !!File.bundle.filePath,
                }),
                File.isWin &&
                  (n["File→Properties"] = { enabled: !!File.bundle.filePath }),
                !File.isMacNode &&
                  (n["File→Reopen with Encoding"] = {
                    hidden: !File.bundle.filePath,
                  }),
                (n["File→Delete…"] = { enabled: !!File.bundle.filePath })),
                e &&
                  ((n[
                    "Edit→Whitespace and Line Breaks→Indent first line of paragraphs"
                  ] = { state: File.option.indentFirstLine, enabled: !t }),
                  (n["Edit→Whitespace and Line Breaks→Visible <br/>"] = {
                    state: !File.option.hideBrAndLineBreak,
                    enabled: !t,
                  }),
                  (n["Edit→Preserve single line break"] = {
                    state: File.option.ignoreLineBreak,
                    enabled: !t,
                  })),
                (n["Edit→Line Endings→Insert Final New Line On Save"] = {
                  state: File.finalNewline,
                }),
                JSBridge.menu.update(n);
            }
            if (File.isNode) {
              try {
                n();
              } catch (e) {
                console.sendError(e, "warning");
              }
              e && JSBridge.invoke("window.checkAsFocus");
            } else (File.isMac || File.isMacWK) && n();
          },
        },
        g = null;
      (m.freshMenuWithDelay = function () {
        g && (clearTimeout(g), (g = null)),
          (g = setTimeout(File.freshMenu, 500));
      }),
        (m.forceRefreshMenu = function () {
          File.isLinux && JSBridge.sendIPC("forceRefreshMenu");
        }),
        (n.exports = m);
    }),
    $__System.registerDynamic(
      "2c",
      ["2b", "11", "13", "1b", "1d", "19", "50"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self, e("2b");
        var i = e("11"),
          r = e("13"),
          o = e("1b"),
          a = o.SnapFlag,
          s = r.Node,
          l = r.TYPE,
          c = r.NodeCollectionUtils,
          d = e("1d"),
          u = e("19"),
          h = e("50");
        function p(e) {
          if (e.get("style") == s.ListType.ol) return s.ListType.ol;
          var t = !1;
          return (
            e.get("children").map(function (e) {
              t = t || e.get("style") !== s.ListType.task;
            }),
            t ? s.ListType.ul : s.ListType.task
          );
        }
        var f = function (e, t, n, i, r) {
            var o = d.createRange();
            function a(e) {
              var i;
              (i =
                e.attr("md-inline") == t
                  ? e.children(".md-meta:not(.md-content)")
                  : e
                      .find('[md-inline="' + t + '"]')
                      .children(".md-meta:not(.md-content)")),
                n && (n.end -= i.text().length),
                i.remove(),
                e
                  .children(".md-meta")
                  .filter(function () {
                    return 0 == (this.textContent || "").length;
                  })
                  .remove(),
                e.attr("md-inline") == t &&
                  n &&
                  (n.end = n.start + e.text().length);
            }
            if (
              (e[0].hasAttribute("mdtype") &&
                (e.wrapInner("<span></span>"), (e = $(e[0].firstChild))),
              n
                ? ((n.containerNode = e[0]), o.moveToBookmark(n))
                : o.selectNode(e[0]),
              o.commonAncestorContainer.nodeType == document.ELEMENT_NODE &&
                o.commonAncestorContainer.getAttribute("md-inline") == t)
            )
              a($(o.commonAncestorContainer));
            else {
              for (
                var s = document.createElement("SPAN"),
                  l = o.extractContents(),
                  c = 0;
                c < l.childNodes.length;
                c++
              )
                s.appendChild(l.childNodes[c].cloneNode(!0));
              a($(s)),
                s.childNodes.length != s.childElementCount ||
                  1 != s.childNodes.length ||
                  s.childNodes[0].getAttribute("md-inline") ||
                  (s = s.childNodes[0]),
                o.insertNode(s),
                o.setStart(s, 0),
                o.setEnd(s, s.childNodes.length);
            }
            return (
              r || g.call(this, o, t, e[0], i ? n : null),
              this.editor.brush.addToQueue(e.attr("cid")),
              o
            );
          },
          m = function (e, t) {
            return t.collapsed && e[2] === e[1] && s.isType(e[1], l.line)
              ? [e[0], e[1].getFirstBrother(), e[1].getLastBrother()]
              : e;
          },
          g = function (e, t, n, i) {
            if (s.isType(t, l.link, l.image)) v.call(this, e, t, n, i);
            else if (
              e.commonAncestorContainer == e.startContainer &&
              e.startContainer == e.endContainer
            ) {
              var r = (function (e) {
                  var t,
                    n = [],
                    i = 0,
                    r = e.commonAncestorContainer;
                  if (!r.childElementCount) return [e];
                  function o() {
                    if (t != i && 0 != t) {
                      var e = d.createRange();
                      e.setStart(r.children[i], 0),
                        e.setEndAfter(r.children[t - 1]),
                        n.push(e);
                    }
                  }
                  for (t = 0; t < r.childElementCount; t++) {
                    var a = r.children[t];
                    a.classList &&
                      a.classList.contains("md-softbreak") &&
                      (o(), (i = t + 1));
                  }
                  return i < t && (i > 0 ? o() : n.push(e)), n;
                })(e),
                o = r.length > 1,
                a = this;
              r.forEach(function (e, s) {
                var l = v.call(a, e, t, n, s == r.length - 1 ? i : void 0, o);
                i && l && (i instanceof Object ? (i.end += l) : (i += l));
              });
            } else v.call(this, e, t, n, i);
          },
          v = function (e, t, n, r, o) {
            var a,
              c,
              d,
              u,
              h,
              p,
              f = F.SyntaxMap[t];
            if (r) {
              var m,
                g = this.editor.getJQueryElem(e.startContainer),
                v = this.editor.getJQueryElem(e.endContainer);
              if (
                (g.closest("md-before").length || g.closest("md-content").length
                  ? (e.setStartBefore(g.closest("[md-inline]")[0]), (m = !0))
                  : g.closest("md-meta").length &&
                    (e.setStartAfter(g.closest("[md-inline]")[0]), (m = !0)),
                v.closest("md-after").length || g.closest("md-content").length
                  ? (e.setEndAfter(g.closest("[md-inline]")[0]), (m = !0))
                  : v.closest("md-meta").length &&
                    (e.setEndBefore(g.closest("[md-inline]")[0]), (m = !0)),
                (a = e.toString()),
                e.collapsed || 0 === a.trim())
              )
                return;
              c = m
                ? c ||
                  e.getBookmark(
                    n && document.body.contains(n)
                      ? n
                      : e.commonAncestorContainer
                  )
                : r instanceof Object
                ? r
                : { start: r, end: r };
            } else a = e.toString();
            return (
              (d = /^\s+/g.exec(a)),
              (u = /\s+$/g.exec(a)),
              (d = d ? d[0].length : 0),
              (u = u ? u[0].length : 0),
              (d || u) &&
                (((c =
                  c ||
                  e.getBookmark(
                    n && document.body.contains(n)
                      ? n
                      : e.commonAncestorContainer || e.commonAncestorContainer
                  )).start += d),
                (c.end -= u),
                e.moveToBookmark(c)),
              (h = f[1]),
              (p = JSBridge.clipboard.readText()) && p.length > 5e3 && (p = ""),
              s.isType(t, l.link)
                ? i.isURL(a)
                  ? (h = "](" + a + ")")
                  : i.isURL(p) && (h = "](" + p.trim() + ")")
                : s.isType(t, l.image) &&
                  (i.isImg(a)
                    ? (h = "](" + a + ")")
                    : i.isImg(p) && (h = "](" + p + ")")),
              e.insertNodeAtEnd(document.createTextNode(h)),
              e.insertNode(document.createTextNode(f[0])),
              r &&
                (s.isType(t, l.link)
                  ? e.moveToBookmark({
                      containerNode: n,
                      start: c.start + 1,
                      end: 1 + c.end,
                    })
                  : e.moveToBookmark({
                      containerNode: n,
                      start: c.start + (o ? 0 : f[0].length),
                      end: c.end + f[0].length + (o ? f[1].length : 0),
                    }),
                editor.selection.setRange(e, !0)),
              (f[0] || "").length + (f[1] || "").length
            );
          },
          y = function (e, t, n) {
            var i = this.editor;
            function r(e) {
              var o = e.get("children");
              if (o.length) o.toArray().map(r);
              else if (i.stylize.canContainInline(e.get("type"))) {
                i.findElemById(e.id).text().length &&
                  (i.stylize.putStyleInBlock(
                    i.findElemById(e.id),
                    t,
                    void 0,
                    void 0,
                    !0,
                    n
                  ),
                  i.store(e),
                  i.brush.addToQueue(e.id));
              }
              return e;
            }
            i.undo.endSnap(!0);
            var a = i.selection.getDetailPos(e.startContainer, e.startOffset),
              l = i.selection.getDetailPos(e.endContainer, e.endOffset),
              c = i.getMarkElem(a[0]),
              d = i.getMarkElem(l[0]),
              u = i.findNodeByElem(c),
              h = i.findNodeByElem(d);
            if (u && h) {
              var p = s.getTreePosition(u, h),
                f = p[1],
                m = p[2],
                g = o.makeEmptyCommand(i.selection.buildUndo()),
                v = e.cloneRange(),
                y = e.cloneRange(),
                b = f;
              for (
                g.undo.push(o.buildReplaceUndo(f)),
                  y.setEndAfter(c[0]),
                  this.canContainInline(u) &&
                    y.toString().length &&
                    (this.putStyleInBlock(
                      c,
                      t,
                      y.getBookmark(c[0]),
                      void 0,
                      !0,
                      n
                    ),
                    i.store(u, !0)),
                  i.UserOp.decorateOneSide(u, f, "after", r),
                  g.redo.push(o.buildReplaceUndo(f)),
                  i.brush.addToQueue(c.attr("cid")),
                  b = f.get("after");
                b && b !== m;

              )
                g.undo.push(o.buildReplaceUndo(b)),
                  r(b),
                  g.redo.push(o.buildReplaceUndo(b)),
                  (b = b.get("after"));
              h &&
                h != f &&
                (v.setStartBefore(d[0]),
                v.toString().length &&
                  (g.undo.push(o.buildReplaceUndo(m)),
                  this.canContainInline(h) &&
                    (this.putStyleInBlock(
                      d,
                      t,
                      v.getBookmark(d[0]),
                      void 0,
                      !0,
                      n
                    ),
                    i.store(h, !0)),
                  i.UserOp.decorateOneSide(h, m, "before", r),
                  g.redo.push(o.buildReplaceUndo(m)),
                  i.brush.addToQueue(d.attr("cid")))),
                g.redo.push(i.selection.buildUndo()),
                i.undo.register(g),
                $(".md-expand").removeClass("md-expand"),
                i.brush.resume(!0);
            } else i.brush.resume(!0);
          };
        function b(e, t, n, i) {
          var r,
            o = t.closest('[md-inline="' + i + '"]');
          o.length ||
            "link" != i ||
            (o = t.closest('[md-inline="reflink"], [md-inline="autolink"]')),
            "image" == i &&
              (o.length
                ? (r = /!\[([^\]]*)\]/.exec(o.text())[1])
                : r ||
                  ((o = t.closest('[md-inline="refimg"]')).length
                    ? (r = /!\[((?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*)\]/.exec(
                        o.text()
                      )[1])
                    : (o = t.closest(".md-url").closest("[md-inline]"))
                        .length && (r = "!" + o.text()))),
            i == l.comment && (r = o.text().replace(/(^<\!--)|(-->)$/g, ""));
          var s = e.findNodeByElem(n);
          r
            ? (o.text(r), e.selection.selectAllElem(o))
            : (o.children(".md-meta, .md-content").remove(),
              e.brush.addToQueue(o.closest("[cid]").attr("cid"), !0)),
            s && e.undo.addSnap(s.id, a.REPLACE);
        }
        class w {
          constructor(e) {
            (this.editor = e),
              (this.CONST = F),
              this.putBookmark(null, { block: [] });
          }
          removeStyle(e, t, n) {
            e.children(".md-meta").remove();
          }
          canContainInline(e) {
            return (
              e.jquery && (e = e.attr("mdtype")),
              s.isType(e, l.paragraph, l.def_footnote, l.heading, l.table_cell)
            );
          }
          putStyle(e, t, n) {
            this.editor.selection.deRange(e), this.editor.undo.endSnap(!0);
            var i,
              r = this.editor.getMarkElem(e.commonAncestorContainer),
              a = F.InsertInline.indexOf(t) > -1;
            if (
              (a && (r = this.editor.getMarkElem(e.startContainer)),
              r.length &&
                0 === r.find("[mdtype]").length &&
                this.canContainInline(r))
            ) {
              var s = o.makeEmptyCommand(this.editor.selection.buildUndo()),
                l = this.editor.store(r.attr("cid"));
              s.undo.push(o.buildReplaceUndo(l)),
                (i = n && this.hasStyleInRange(t, e, !0)),
                (e = this.putStyleForRange(r, t, e, !0, i)).select(),
                this.editor.store(r.attr("cid")),
                s.redo.push(o.buildReplaceUndo(l)),
                s.redo.push(this.editor.selection.buildUndo()),
                this.editor.undo.register(s),
                this.editor.brush.addToQueue(l.id, !0);
            } else if (!a)
              return (
                (i = n && this.hasStyleInRange(t, e, !1)), y.call(this, e, t, i)
              );
          }
          putStyleInBlock(e, t, n, i, r, o) {
            if (!r || 0 != e.text().length) {
              e[0].hasAttribute("mdtype") && e.addClass("md-expand");
              try {
                return f.call(this, e, t, n, i, o);
              } catch (e) {
                console.error(e);
              }
            }
          }
          putStyleForRange(e, t, n, i, r) {
            var o = n.getBookmark(e[0]);
            return (
              e[0].hasAttribute("mdtype") &&
                n.commonAncestorContainer.nodeType != document.TEXT_NODE &&
                e.addClass("md-expand"),
              f.call(this, e, t, o, i, r)
            );
          }
          addStyle(e, t) {
            var n,
              r = F.SyntaxMap[t],
              o = document.createElement("SPAN");
            (o.className = "md-meta md-expand"),
              o.setAttribute("md-inline", t),
              ("link" != t && "image" != t) ||
                ((n = (n = JSBridge.clipboard.readText() || "").trim()),
                "link" == t &&
                  (i.isURL(n) ||
                  (!/[^.a-z0-9\\\/% _#@]/i.exec(n) &&
                    n.length < 256 &&
                    ((/[\\\/]/.exec(n) && !/[\\\/.][\s]/.exec(n)) ||
                      /\.[a-z]+$/.exec(n)))
                    ? (r[1] = "](" + n + ")")
                    : (r[1] = "]()")),
                "image" == t &&
                  (i.isImg(n) ? (r[1] = "](" + n + ")") : (r[1] = "]()"))),
              o.appendChild(document.createTextNode(r[0] + r[1])),
              e.insertNode(o),
              e.moveToBookmark({
                containerNode: o,
                start: r[0].length,
                end: r[0].length,
              }),
              this.editor.selection.rangy.getSelection().setSingleRange(e);
          }
          detach(e, t) {
            return (
              !(
                !e.collapsed ||
                !$.parseHTML("<div>" + e.toHtml() + "</div>")[0].querySelector(
                  '[md-inline="' + t + '"]'
                )
              ) ||
              $(e.commonAncestorContainer).closest('[md-inline="' + t + '"]')
                .length
            );
          }
          canToggleStyle(e, t, n, i) {
            i = i || this.CONST.NoInline;
            var r = (function (e) {
              for (var t = 0; t < i.length; t++)
                if (e.hasStyle(i[t])) return !0;
            })(this);
            return (
              !!this.hasStyle(e) ||
              (!(
                r ||
                (/(md-meta|md-content)(\s+|$)/g.exec(t[0].className) && !n) ||
                /md-blockmeta/g.exec(t[0].className)
              ) &&
                !r)
            );
          }
          clearStyle() {
            if (
              window.getSelection().rangeCount &&
              !isInputComponent(document.activeElement) &&
              !File.isLocked
            ) {
              this.editor.brush.clearAndPause();
              var e = this.editor.selection.getRangy();
              if ((this.editor.undo.endSnap(!0), e)) {
                for (
                  var t,
                    n = o.makeEmptyCommand(editor.selection.buildUndo()),
                    i = editor.selection.getDetailPos(
                      e.startContainer,
                      e.startOffset
                    ),
                    r = editor.selection.getDetailPos(
                      e.endContainer,
                      e.endOffset
                    ),
                    a = editor.getMarkElem(i[0]),
                    l = editor.getMarkElem(r[0]),
                    c = editor.findNodeByElem(a),
                    d = editor.findNodeByElem(l),
                    u = s.getTreePosition(c, d),
                    h = u[1],
                    p = u[2],
                    f = h,
                    m = [];
                  f && f != p.get("after");

                )
                  (t = f),
                    (f = f.get("after")),
                    this.editor
                      .findElemById(t.id)
                      .find(".md-meta, .md-content")
                      .each(function () {
                        var e = this.closest("[cid]").getAttribute("cid");
                        -1 == m.indexOf(e) && m.push(e);
                      })
                      .remove();
                m.forEach((e) => {
                  var t = editor.getNode(e);
                  n.undo.push(o.buildReplaceUndo(t)),
                    this.editor.store(e),
                    this.editor.brush.addToQueue(e),
                    n.redo.push(o.buildReplaceUndo(t));
                }),
                  this.editor.undo.register(n);
              }
              this.editor.brush.resume(), this.editor.brush.expand();
            }
          }
          toggleStyle(e) {
            if (
              !File.isLocked &&
              window.getSelection().rangeCount &&
              "INPUT" != document.activeElement.tagName &&
              "TEXTAREA" != document.activeElement.tagName &&
              !File.isLocked
            ) {
              var t,
                n,
                i = this.editor.selection.getRangy(),
                r = this.hasStyle(e),
                o = this.editor.getJQueryElem(i.commonAncestorContainer),
                s = this.editor.getMarkElem(i.commonAncestorContainer);
              if (!r) {
                var c = this.editor.getJQueryElem(i.startContainer);
                "link" == e &&
                  (r = c.closest(
                    '[md-inline="reflink"], [md-inline="autolink"]'
                  ).length),
                  "image" == e &&
                    (r = c.closest('[md-inline="refimg"], .md-url').length);
              }
              this.editor.brush.pause();
              do {
                if (
                  !this.canToggleStyle(
                    e,
                    o,
                    i.collapsed,
                    this.CONST.NoInlineBlock
                  )
                )
                  break;
                if (
                  !this.canToggleStyle(
                    e,
                    o,
                    i.collapsed,
                    this.CONST.NoInlineInline
                  ) &&
                  !1 === f(i, o.closest("[md-inline]")[0])
                )
                  break;
                if (r) b(this.editor, o, s, e);
                else {
                  if (!i.collapsed) {
                    this.putStyle(i, e, !0);
                    break;
                  }
                  if (!(n = this.editor.findNodeByElem(s))) return;
                  this.editor.undo.addSnap(n.id, a.NONE),
                    (t = i.getBookmark(s[0]).start);
                  var d = s.text().substring(t - 1, t + 1),
                    u =
                      "**" == d &&
                      $(i.startContainer).closest("[md-inline='plain']").length;
                  e == l.em && u
                    ? (i.moveToBookmark({
                        containerNode: s[0],
                        start: t - 1,
                        end: t + 1,
                      }),
                      i.extractContents())
                    : p(i, d)
                    ? this.addStyle(i, e)
                    : (s.addClass("md-expand"),
                      u ||
                        e == l.image ||
                        this.editor.selection.selectWord(!0, !1, i),
                      (i = this.editor.selection.getRangy()).collapsed
                        ? this.addStyle(i, e)
                        : g.call(this, i, e, s[0], t)),
                    this.editor.undo.addSnap(n.id, a.REPLACE);
                }
                if (
                  (this.editor.brush.addToQueue(s.attr("cid")),
                  e == l.inline_math && !r)
                ) {
                  var h = this.editor;
                  setTimeout(function () {
                    h.brush.triggerAutoComplete(!0);
                  }, 100);
                }
              } while (0);
              this.editor.brush.resume(!0), window.Reporter.fullValidate();
            }
            function p(e, t) {
              return (
                !t ||
                (e.collapsed &&
                  /^[\(\)\[\]\^&_\-+*#@!~`\\\/\{\}'":;<>,.?%\s]+$/.exec(t))
              );
            }
            function f(e, t) {
              if (t && e) {
                if (0 !== e.startOffset) return !1;
                for (var n = e.startContainer; t.contains(n); ) {
                  if (n.previousElementSibling) return !1;
                  n = n.parent;
                }
                if (e.endOffset !== e.endContainer.length) return !1;
                for (var i = e.endContainer; t.contains(i); ) {
                  if (i.nextElementSibling) return !1;
                  i = i.parent;
                }
                return !0;
              }
            }
          }
          putBookmark(e, t) {
            return (this.editor.styleBookmark = { cursor: e, style: t });
          }
          isAtFootnoteDefSpan() {
            var e = this.editor.selection.getRangy();
            return (
              e &&
              this.editor
                .getJQueryElem(e.startContainer)
                .closest(".md-def-name").length
            );
          }
          buildBookmark(e) {
            if (File.ignoreStyleChange) return File.editor.styleBookmark.style;
            var t,
              n = { inline: [], block: [], state: "" },
              i = this.editor.selection.getRangy(),
              r = (e =
                e ||
                this.editor.getJQueryElem(
                  (i && i.commonAncestorContainer) || document.activeElement
                ) ||
                $()).closest("[md-inline]"),
              o = e;
            if (0 == e.length) {
              if (
                !(e = this.editor.getMarkElem()).length ||
                !s.isType(e.attr("mdtype"), s.TYPE.hr, s.TYPE.toc)
              )
                return n;
              o = e;
            }
            for (; r.length; )
              (t = r.attr("md-inline")),
                this.CONST.LinkList.indexOf(t) > -1 && (t = "link"),
                n.inline.push(t),
                (o = r),
                (r = r.parent().closest("[md-inline]"));
            for (r = o.closest("[mdtype], [mdlike]"); r.length; ) {
              if ((t = r.attr("mdlike") || r.attr("mdtype")) === l.heading)
                n.block.push("header" + r[0].tagName.substring(1));
              else if (t === l.list) {
                var a = this.editor.findNodeByElem(r);
                a && n.block.push(p(a));
              } else
                t === l.list_item
                  ? r.hasClass("md-task-list-item") &&
                    !n.state &&
                    (n.state = r.hasClass("task-list-done")
                      ? "checked"
                      : "unchecked")
                  : ((t = t.replace(/^h([1-6])$/, "header$1")),
                    n.block.push(t));
              r = r.parent().closest("[mdtype]");
            }
            return (
              (n.canContainInline = F.NoInline.indexOf(n.block[0]) > -1),
              (n.textSelected =
                F.Selectable.indexOf(n.block[0]) > -1 || (i && !i.collapsed)),
              (n.rangeSelected = i && !i.collapsed),
              n
            );
          }
          hasStyleInRange(e, t, n) {
            var i = t.toHtml();
            return (
              n && (i = "<div>" + i + "</div>"),
              0 ==
                $(i)
                  .find("[md-inline='" + e + "']")
                  .remove()
                  .end()
                  .text()
                  .trim().length
            );
          }
          hasStyle(e) {
            var t = this.editor.styleBookmark.style;
            if (t)
              return (
                (t.inline || []).indexOf(e) > -1 ||
                (t.block || []).indexOf(e) > -1
              );
          }
          changeStyleFromMenu(e) {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              var t = F.NameMapToStyle[e.toLowerCase()];
              s.isType(
                t,
                "header1",
                "header2",
                "header3",
                "header4",
                "header5",
                "header6",
                l.paragraph
              )
                ? this.changeBlock(t)
                : s.isType(
                    t,
                    l.def_footnote,
                    l.def_link,
                    l.hr,
                    l.fences,
                    l.math_block,
                    l.toc
                  )
                ? this.insertBlock(t)
                : s.isType(t, l.table)
                ? File.editor.tableEdit.insertTable()
                : s.isType(t, l.meta_block)
                ? this.insertMetaBlock()
                : s.isType(t, l.blockquote) && this.toggleIndent(l.blockquote);
            }
          }
          changeBetweenCodeMirror(e, t) {
            if (s.isType(t, l.math_block, l.fences)) {
              var n = this.editor,
                i = o.makeEmptyCommand(n.selection.buildUndo());
              n.undo.endSnap(!0),
                s.isType(t, l.fences)
                  ? (n.fences.syncToNode(t.cid), n.fences.beforeDeleteFences(t))
                  : (n.mathBlock.syncToNode(t.cid),
                    n.mathBlock.beforeDeleteFences(t)),
                i.undo.push(o.buildReplaceUndo(t)),
                t.set("type", e),
                e === l.fences &&
                  t.set(
                    "lang",
                    n.localSettingBridge.getSetting("default-code-lang") || ""
                  ),
                i.redo.push(o.buildReplaceUndo(t)),
                n.findElemById(t.id).replaceWith(t.toHTML()),
                e == l.fences
                  ? n.fences.getCm(t.id)
                  : e == l.math_block && n.mathBlock.startEditing(t.id),
                n.selection.jumpIntoElemBegin(n.findElemById(t.id)),
                i.redo.push(n.selection.buildUndo()),
                n.undo.register(i),
                n.refocus(),
                h.refreshBlockMenu();
            }
          }
          toggleFences() {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              var e = this.editor.getNode(null, !0, !0);
              s.isType(e, l.fences)
                ? this.changeBlock(l.paragraph, e)
                : s.isType(e, l.math_block)
                ? this.changeBetweenCodeMirror(l.fences, e)
                : this.insertBlock(l.fences);
            }
          }
          toggleMathBlock() {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              var e = this.editor.getNode(null, !0, !0);
              s.isType(e, l.math_block)
                ? this.changeBlock(l.paragraph, e)
                : s.isType(e, l.fences)
                ? this.changeBetweenCodeMirror(l.math_block, e)
                : this.insertBlock(l.math_block);
            }
          }
          changeBlock(e, t, n) {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open") &&
              (t = t || this.editor.getNode(null, !0, !0))
            ) {
              var r,
                a,
                c,
                h,
                p = F.getMenuBlockType(t),
                f = this.editor,
                m = t.cid;
              if (
                (f.undo.endSnap(!0),
                s.isType(p, l.math_block, l.html_block, l.table))
              )
                f.UserOp.insertParagraph();
              else if (
                !s.isType(
                  t,
                  l.table_row,
                  l.table_cell,
                  l.blockquote,
                  l.list,
                  l.list_item
                ) &&
                (File.option.expandSimpleBlock &&
                  s.isType(p, l.paragraph) &&
                  t.get("depth") > 0 &&
                  (p = "header" + t.get("depth")),
                (f.lastCursor = f.selection.buildUndo()),
                p == e && n && s.isType(t, l.heading) && (e = l.paragraph),
                (p != l.paragraph && !~p.indexOf("head")) ||
                  (e != l.paragraph && !~e.indexOf("head")) ||
                  (h = f.selection.buildUndo()),
                p != e && p)
              ) {
                if (
                  (s.isType(p, l.fences) &&
                    (f.fences.syncToNode(t.cid),
                    f.fences.beforeDeleteFences(t)),
                  (r = o.makeEmptyCommand(f.lastCursor)).undo.push(
                    o.buildReplaceUndo(t)
                  ),
                  s.isType(p, l.def_link) &&
                    t.set(
                      "text",
                      (t.get("href") || "") +
                        (t.get("tittle") ? ' "' + t.get("tittle") + '"' : "")
                    ),
                  0 == e.indexOf("header"))
                )
                  (c = e.substr(6) - 0),
                    (a = t.get("pattern")) && /-|=/.exec(a)
                      ? (a =
                          c <= 2
                            ? a.replace(/-|=/g, 1 == c ? "=" : "-")
                            : void 0)
                      : a && (a = a.replace(/#+/g, "#".repeat(c))),
                    (t = s.isType(t, l.paragraph)
                      ? File.option.expandSimpleBlock &&
                        t.get("depth") &&
                        /^#/.exec(t.get("text"))
                        ? (function (e, n, i) {
                            ((h = Object.clone(r.undo[0])).start +=
                              e - t.get("depth")),
                              (h.end += e - t.get("depth")),
                              t.set("depth", e);
                            var a = t.get("text");
                            if (
                              ((a = a
                                .replace(/^#+/, "#".repeat(e))
                                .replace(/#+$/, "#".repeat(e))),
                              t.set("text", a),
                              !i)
                            ) {
                              var s = u.renderHtmlWithBlockMeta(
                                t,
                                File.editor.brush
                              );
                              f.findElemById(t.id).replaceWith(s);
                            }
                            return r.redo.push(o.buildReplaceUndo(t)), t;
                          })(c)
                        : (function (e, n) {
                            var a = (function () {
                              var e,
                                n,
                                a = t.get("text") || "",
                                c = a.split(/\n/) || [];
                              if ((t.set("text", a), !c.length))
                                return [e, t, n];
                              var d = i.findLine(a, f.lastCursor.start);
                              return (
                                t.set("text", d.line),
                                d.start > 0 &&
                                  ((e = t.addBefore(
                                    new s({
                                      type: l.paragraph,
                                      text: a.substring(0, d.start - 1),
                                    })
                                  )),
                                  o.addUndoForInsert(r, e)),
                                d.start + d.line.length < a.length &&
                                  ((n = t.addAfter(
                                    new s({
                                      type: l.paragraph,
                                      text: a.substring(
                                        d.start + d.line.length + 1
                                      ),
                                    })
                                  )),
                                  o.addUndoForInsert(r, n)),
                                ((h = Object.clone(r.undo[0])).start -=
                                  d.start),
                                (h.end -= d.start),
                                [e, t, n]
                              );
                            })();
                            x(e, n, !0);
                            var c =
                              (a[0] ? a[0].toHTML() : "") +
                              a[1].toHTML() +
                              (a[2] ? a[2].toHTML() : "");
                            return f.findElemById(t.id).replaceWith(c), a[1];
                          })(c, a)
                      : x(c, a));
                else {
                  var g;
                  s.isType(t, l.paragraph) &&
                    p !== l.paragraph &&
                    t.set("text", t.get("text").replace(/^#+\s*/, "")),
                    t.set("type", e),
                    t.set("pattern", void 0),
                    s.isType(t, l.paragraph) ||
                      p != l.paragraph ||
                      t.set("text", t.get("text").replace(/\r?\n/g, " ")),
                    s.isType(p, l.meta_block, l.fences) &&
                      s.isType(t, l.paragraph) &&
                      (t.set("type", l.raw_edit),
                      (g = f.simpleParse(t)) || t.set("type", l.paragraph));
                  var v = d.createRange();
                  if (g) {
                    var y = $(g[1]),
                      b = y[0].getAttribute("cid"),
                      w = y.last()[0].getAttribute("cid");
                    f.findElemById(g[2]).replaceWith(g[1]),
                      g && o.append(r, g[0]),
                      v.setStartBefore(f.findElemById(b)[0]),
                      v.setEndAfter(f.findElemById(w)[0]);
                  } else
                    s.normalizeNode(t),
                      r.redo.push(o.buildReplaceUndo(t)),
                      f.findElemById(t.id).replaceWith(t.toHTML()),
                      f.lastCursor && f.lastCursor.pos
                        ? v.moveToBookmark({
                            containerNode: f.findElemById(t.id)[0],
                            start: f.lastCursor.pos.ch,
                            end: f.lastCursor.pos.ch,
                          })
                        : (v.setStartBefore(f.findElemById(t.id)[0]),
                          v.setEndAfter(f.findElemById(t.id)[0]));
                  (v = f.selection.deRange(v, !0)),
                    (h = h || f.selection.buildUndo(v));
                }
                h ||
                  ((h = Object.clone(r.undo[0])).startId === m &&
                    (h.startId = t.cid),
                  h.endId === m && (h.endId = t.cid),
                  h.id === m && (h.id = t.cid)),
                  f.undo.exeCommand(h),
                  r.redo.push(h),
                  f.undo.register(r),
                  f.refocus();
              }
            }
            function x(e, n, i) {
              return (
                t.set("type", l.heading),
                t.set("depth", e),
                t.set("pattern", n),
                i || f.findElemById(t.id).replaceWith(t.toHTML()),
                r.redo.push(o.buildReplaceUndo(t)),
                t
              );
            }
          }
          increaseHeaderLevel() {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              var e = this.editor.getMarkElem(),
                t = e.attr("mdtype");
              (t != l.heading && t != l.paragraph) ||
                this.editor.stylize.changeHeadingLevel(
                  this.editor.findNodeByElem(e),
                  !0,
                  e.attr("mdlike")
                );
            }
          }
          decreaseHeaderLevel() {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              var e = this.editor.getMarkElem(),
                t = e.attr("mdtype");
              (t != l.heading && t != l.paragraph) ||
                this.editor.stylize.changeHeadingLevel(
                  this.editor.findNodeByElem(e),
                  !1,
                  e.attr("mdlike")
                );
            }
          }
          insertMetaBlock(e, t) {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              (t = t || ""), this.editor.undo.endSnap(!0);
              var n = this.editor.nodeMap.getFirst();
              if (!s.isType(n, l.meta_block)) {
                this.editor.lastCursor = this.editor.selection.buildUndo();
                var i = o.makeEmptyCommand(
                    this.editor.lastCursor || this.editor.selection.buildUndo()
                  ),
                  r = new s({
                    type: l.meta_block,
                    in: this.editor.nodeMap,
                    attachTo: this.editor.nodeMap,
                    after: n,
                    text: t,
                  });
                return (
                  o.addUndoForInsert(i, r),
                  e
                    ? { command: i, node: r }
                    : (this.editor.findElemById(n.cid).before(r.toHTML()),
                      this.editor.selection.restoreSelection(
                        this.editor.findElemById(r.cid),
                        0
                      ),
                      i.redo.push(this.editor.selection.buildUndo()),
                      this.editor.undo.register(i),
                      this.editor.selection.scrollAdjust(),
                      this.editor.refocus(r.cid),
                      r)
                );
              }
            }
          }
          insertBlock(e, t) {
            if (
              !(
                File.isLocked ||
                ("table" != e && document.body.classList.contains("modal-open"))
              )
            ) {
              var n = this.editor,
                i = n.selection.getRangy(),
                r = "",
                a = null,
                c = "";
              if ((n.undo.endSnap(!0), !i || i.collapsed || t))
                a = o.makeEmptyCommand();
              else {
                if (
                  ((r = n.UserOp.prepMarkHtml(i.toHtml(), n).html()),
                  (c = i.toString()),
                  (a = n.UserOp.backspaceHandler(n, null, "delSelection", !0)),
                  !(i = n.selection.getRangy()))
                )
                  return;
                n.selection.deRange(i, !0), n.refocus(null, !1, !0, !1, !0);
              }
              var d = n.getNode(null, !0, !0);
              if (d) {
                var u = F.getMenuBlockType(d),
                  h = n.findElemById(d.id);
                n.lastCursor = n.selection.buildUndo(i);
                var p = t || new s({ type: e, text: "" });
                if (
                  (t ||
                    e != l.fences ||
                    p.set(
                      "lang",
                      n.localSettingBridge.getSetting("default-code-lang") || ""
                    ),
                  u != e && u && s.isType(d, l.paragraph, l.heading))
                ) {
                  a.undo.push(this.editor.lastCursor),
                    a.undo.push(o.buildReplaceUndo(d));
                  var f = s.splitAt(
                    d,
                    (this.editor.lastCursor || { start: 0 }).start,
                    n,
                    !0
                  );
                  if (!f) return;
                  var m,
                    g,
                    v = f.prev,
                    y = f.next,
                    b = e == l.hr ? y.id : p.id;
                  s.isType(e, l.math_block, l.fences)
                    ? p.set("text", r ? n.UserOp.getMarkdownSourceFrom(r) : "")
                    : e == l.def_link &&
                      ((c = (c.trim().split(/\n/) || [])[0] || ""),
                      /[\/\\]/.exec(c)
                        ? p.set("href", c.substr(0, 160))
                        : p.set("ref", (c.split(/\s/)[0] || c).substr(0, 20))),
                    a.redo.push(n.undo.buildReplaceUndo(d)),
                    o.addUndoForInsertArray(a, f.insertArray),
                    v.addAfter(p),
                    o.addUndoForInsert(a, p),
                    f.insertArray.indexOf(y) > -1 &&
                      f.insertArray.splice(f.insertArray.indexOf(y), 0, p),
                    t && w(t, d.get("in")),
                    y &&
                      s.isEmptyBlock(y) &&
                      s.isType(y.get("after"), l.paragraph) &&
                      (o.addUndoForRemove(a, y), y.remove(), (y = null)),
                    s.isEmptyBlock(v) &&
                      (o.addUndoForRemove(a, v), v.remove(), (v = null)),
                    (m =
                      (d.isDeleted() ? "" : d.toHTML()) +
                      f.insertArray
                        .map(function (e) {
                          return e.isDeleted() ? "" : e.toHTML();
                        })
                        .join("")),
                    h.replaceWith(m),
                    (g = this.editor.findElemById(b)),
                    this.editor.selection.jumpIntoElemBegin(g);
                } else
                  (d = d.getClosetBlock(!1)).addAfter(p),
                    t && w(t, d.get("in")),
                    o.addUndoForInsert(a, p),
                    this.editor.findElemById(d.cid).after(p.toHTML()),
                    this.editor.selection.jumpIntoElemBegin(
                      this.editor.findElemById(p.cid)
                    );
                return (
                  (this.editor.lastCursor = this.editor.selection.buildUndo()),
                  a.redo.push(this.editor.lastCursor),
                  this.editor.undo.register(a),
                  this.editor.refocus(),
                  this.editor.selection.scrollAdjust(),
                  p
                );
              }
            }
            function w(e, t) {
              e.set("in", t),
                e
                  .get("children")
                  .toArray()
                  .map(function (e) {
                    w(e, t);
                  });
            }
          }
          toggleTaskStatus(e) {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              var t = this.editor.selection.getRangy(),
                n = this.editor
                  .getMarkElem(t && t.startContainer)
                  .closest(".md-task-list-item"),
                i = n.hasClass("task-list-done");
              if ((void 0 === e && (e = !i), n.length && e !== i)) {
                var r = this.editor;
                if ((r.undo.endSnap(!0), t.collapsed))
                  r.getNode(n.attr("cid")).attr("checked", e, r, !1);
                else {
                  var a = o.makeEmptyCommand(),
                    s = $.parseHTML(t.toHtml());
                  $(s)
                    .find(e ? ".task-list-not-done" : ".task-list-done")
                    .addBack(e ? ".task-list-not-done" : ".task-list-done")
                    .each(function () {
                      var t = r
                        .getNode(this.getAttribute("cid"))
                        .attr("checked", e, r, !0);
                      o.append(a, t);
                    }),
                    a.undo.length
                      ? r.undo.register(a)
                      : r.getNode(n.attr("cid")).attr("checked", e, r, !1);
                }
                JSBridge.menu.update({
                  "Paragraph→Task Status→Mark as Complete": { state: e },
                  "Paragraph→Task Status→Mark as Incomplete": { state: !e },
                });
              }
            }
          }
          toggleIndent(e, t) {
            if (
              !File.isLocked &&
              !document.body.classList.contains("modal-open")
            ) {
              var n = this.editor,
                i = o.makeEmptyCommand(n.selection.buildUndo()),
                r = this.editor.selection.getRangy();
              if (r) {
                n.undo.endSnap(!0);
                var a,
                  d,
                  u = r.collapsed;
                if (
                  !(
                    (isInputComponent(document.activeElement) &&
                      !this.editor.fences.getFocused()) ||
                    File.isLocked
                  )
                ) {
                  this.editor.store();
                  var h = this.editor.selection.buildUndo();
                  if (
                    ((this.editor.lastCursor = h),
                    (function (e) {
                      if (e && !e.collapsed) {
                        var t = !1;
                        !(function e(n) {
                          var r,
                            o = i(n.endContainer);
                          o.text().length ||
                            o.parent()[0] != n.commonAncestorContainer ||
                            ((r = o.prev()[0]) &&
                              ((t = !0), n.setEndAfter(r), e(n)));
                        })(e),
                          (function e(n) {
                            var r,
                              o = i(n.startContainer);
                            o.text().length ||
                              o.parent()[0] != n.commonAncestorContainer ||
                              ((r = o.after()[0]) &&
                                ((t = !0), n.setStartBefore(r), e(n)));
                          })(e),
                          t && n.selection.deRange(e);
                      }
                      function i(e) {
                        return $(e).closest("p");
                      }
                    })(r),
                    r)
                  ) {
                    var f = n.selection.getDetailPos(
                        r.startContainer,
                        r.startOffset
                      ),
                      g = n.selection.getDetailPos(r.endContainer, r.endOffset),
                      v = n.getMarkElem(f[0]),
                      y = n.getMarkElem(g[0]),
                      b = n.findNodeByElem(v),
                      w = n.findNodeByElem(y),
                      x = s.getTreePosition(b, w),
                      C = m(x, r);
                    (a = C[1]), (d = C[1] === C[2] ? null : C[2]);
                  } else
                    a = this.editor.findNodeByElem(this.editor.getMarkElem());
                  a &&
                    (this.editor.brush.pause(!0),
                    e == l.blockquote
                      ? (function (t, i, a) {
                          (t = t.getClosetBlock()),
                            (i = i && i.getClosetBlock());
                          var c = t.get("parent");
                          if (
                            (function (e, t, n) {
                              return (
                                (t = t || e),
                                !(!n || n.get("type") != l.blockquote) &&
                                  (r.collapsed ||
                                    (!e.get("before") && !t.get("after")))
                              );
                            })(t, i, c)
                          )
                            o.addUndoForUnwrap(a, c), c.unwrap(n);
                          else {
                            u &&
                              (t = i =
                                (function e(t) {
                                  var n = t.get("parent");
                                  return !n || t.get("before") || t.get("after")
                                    ? s.isType(t, l.list_item)
                                      ? t.getFirstChild()
                                      : t.isVirtualBlock()
                                      ? k(t)
                                      : t
                                    : e(n);
                                })(t));
                            var d = new s({ type: e });
                            s.wrap(d, t, i || t, n), o.addUndoForWrap(a, d);
                          }
                        })(a, d, i)
                      : (function (i, a, c, d, u) {
                          var h = (function (e, t) {
                              t = t || e;
                              var n = e.get("parent");
                              if (r.collapsed) {
                                if (
                                  !e.get("before") &&
                                  n &&
                                  s.isType(n.get("parent"), l.list)
                                )
                                  return n.get("parent");
                              } else if (
                                n &&
                                s.isType(n.getClosetBlock(), l.list)
                              )
                                return n.getClosetBlock();
                            })(i, a),
                            f = h ? p(h) : void 0;
                          if (t)
                            if ("none" == d) {
                              if (!h) return;
                              d = f;
                            } else if (h && d == f) return;
                          if (h)
                            f == d
                              ? (h.get("children").map(function (e) {
                                  o.addUndoForUnwrap(c, e),
                                    e.toMark(),
                                    e.unwrap();
                                }),
                                o.addUndoForUnwrap(c, h),
                                h.unwrap(n))
                              : (c.undo.push(o.buildReplaceUndo(h)),
                                h.set("pattern", void 0),
                                F(h, d),
                                n.findElemById(h.id).replaceWith(h.toHTML()),
                                c.redo.push(o.buildReplaceUndo(h)));
                          else {
                            a = k(a || i);
                            for (
                              var m, g = (i = k(i)), v = [], y = a.get("after");
                              g && g != y;

                            ) {
                              var b;
                              (m = g),
                                File.option.ignoreLineBreak ||
                                  ((b = S(g, c, u)) &&
                                    b[0] &&
                                    (m = g = i = b[0]),
                                  b && b[1] && (y = b[1]));
                              var w = new s({ type: l.list_item });
                              (g = g.get("after")),
                                s.wrap(w, m, m, n),
                                v.push(w),
                                o.addUndoForWrap(c, w);
                            }
                            F(
                              (h = new s({ type: l.list, in: i.get("in") })),
                              d
                            );
                            var x = v[0],
                              C = v.last();
                            if (e == s.ListType.task)
                              for (var E = x; E != C.get("after"); )
                                E.set("style", s.ListType.task),
                                  (E = E.get("after"));
                            s.wrap(h, x, C, n), o.addUndoForWrap(c, h);
                          }
                        })(a, d, i, e, h),
                    this.editor.quickRefresh(),
                    i.redo.push(h),
                    this.editor.undo.exeCommand(h),
                    this.editor.undo.register(i),
                    this.editor.brush.resume(),
                    this.editor.refocus(),
                    this.editor.selection.scrollAdjust());
                }
              }
            }
            function F(e, t) {
              (t != s.ListType.ol && t != s.ListType.ul) ||
                (e.set("style", t),
                e.get("children").map(function (e) {
                  e.unset("style"), e.unset("checked");
                })),
                t == s.ListType.task &&
                  (e.set("style", s.ListType.ul),
                  e.get("children").map(function (e) {
                    e.set("style", s.ListType.task);
                  }));
            }
            function S(e, t, i) {
              if (!s.isType(e, l.paragraph)) return e;
              var r = e.get("text").split(/\n/g) || [];
              if (r.length < 2) return e;
              void 0 === i.startId && (i.startId = i.id),
                void 0 === i.endId && (i.endId = i.id),
                delete i.id;
              var a = i.startId == e.cid,
                d = i.endId == e.cid,
                u = i.start == i.end;
              if (a && d) {
                t.undo.push(o.buildReplaceUndo(e));
                var h,
                  p = [],
                  f = e;
                e.set("text", r[0]);
                for (var m, g = e, v = 1; v < r.length; v++) {
                  var y = r[v];
                  if (i.start > r[v - 1].length + r[v].length && !u)
                    (r[v] = e.get("text") + "\n" + y), e.set("text", r[v]);
                  else if (
                    ((f = h =
                      f.addAfter(new s({ type: l.paragraph, text: y }))),
                    p.push(h),
                    a && i.start > r[v - 1].length
                      ? ((i.startId = h.cid),
                        (i.start -= r[v - 1].length + 1),
                        (g = h))
                      : (a = !1),
                    d && i.end > r[v - 1].length)
                  ) {
                    if (
                      ((i.endId = h.cid),
                      (i.end -= r[v - 1].length + 1),
                      !u && v < r.length - 1 && i.end <= r[v].length)
                    ) {
                      (m = new s({
                        type: l.paragraph,
                        text: r.slice(v + 1).join("\n"),
                      })),
                        f.addAfter(m),
                        p.push(m);
                      break;
                    }
                  } else d = !1;
                }
                var b = [e].concat(p);
                return (
                  n.findElemById(e.cid).replaceWith(c.toHTML(b)),
                  t.redo.push(o.buildReplaceUndo(e)),
                  o.addUndoForInsertArray(t, p),
                  [g, m]
                );
              }
            }
            function k(e) {
              for (; e && e.isVirtualBlock(); ) e = e.get("parent");
              return e;
            }
          }
          changeHeadingLevel(e, t, n) {
            var i,
              r,
              o = null;
            e.get("type") == l.paragraph
              ? n && (i = /h(\d)/.exec(n))
                ? (r = i[1] - 0)
                : t && (o = "header6")
              : e.get("type") == l.heading && (r = e.get("depth") - 0),
              void 0 !== r &&
                (7 == (r -= t ? 1 : -1)
                  ? (o = "paragraph")
                  : r > 0 && (o = "header" + r)),
              o && this.changeBlock(o);
          }
        }
        var x = [
            "hr",
            "fences",
            "def_link",
            "meta_block",
            "raw_edit",
            "math_block",
            "toc",
            "html_block",
          ],
          C = ["code", "comment", "atag", "imgtag"],
          F = {
            SyntaxMap: {
              strong: ["**", "**"],
              em: ["*", "*"],
              code: ["`", "`"],
              del: ["~~", "~~"],
              underline: ["<u>", "</u>"],
              footnote: ["[^", " ]"],
              link: ["[", "]()"],
              image: ["![", "]()"],
              highlight: ["==", "=="],
              superscript: ["^", "^"],
              subscript: ["~", "~"],
              inline_math: ["$", "$"],
              comment: ["\x3c!--", "--\x3e"],
            },
            NormalBlockMap: {
              line: "Paragraph",
              paragraph: "Paragraph",
              header1: "Header 1",
              header2: "Header 2",
              header3: "Header 3",
              header4: "Header 4",
              header5: "Header 5",
              header6: "Header 6",
              def_link: "Link Reference",
              def_footnote: "Footnotes",
            },
            InsertInline: ["link", "image", "footnote", "inline_math"],
            LinkList: ["autolink", "reflink", "link"],
            NoInlineBlock: x,
            NoInlineInline: C,
            NoInline: x.concat(C),
            Selectable: ["hr", "math_block", "toc", "html_block", "fences"],
            InsertBlock: ["table", "fences", "hr"],
            StyleToNameMap: {
              paragraph: "Paragraph",
              header1: "Heading 1",
              header2: "Heading 2",
              header3: "Heading 3",
              header4: "Heading 4",
              header5: "Heading 5",
              header6: "Heading 6",
              def_link: "Link Reference",
              def_footnote: "Footnotes",
              table: "Table",
              fences: "Code Fences",
              blockquote: "Quote",
              toc: "Table of Contents",
              hr: "Horizontal Line",
              meta_block: "YAML Front Matter",
              ol: "Ordered List",
              ul: "Unordered List",
              tasklist: "Task List",
              html_block: "HTML Block",
              strong: "Strong",
              em: "Emphasis",
              code: "Code",
              del: "Strike",
              highlight: "Highlight",
              inline_math: "Inline Math",
              math_block: "Math Block",
              superscript: "Superscript",
              subscript: "subscript",
              image: "Image",
              footnote: "Superscript",
              autolink: "Hyperlink",
              reflink: "Hyperlink",
              link: "Hyperlink",
              url: "Hyperlink",
              underline: "Underline",
              comment: "Comment",
            },
            NameMapToStyle: {},
          };
        for (var S in F.StyleToNameMap)
          F.NameMapToStyle[F.StyleToNameMap[S].toLowerCase()] = S;
        (F.InsertQuery =
          '[md-inline="' + F.InsertInline.join('"],[md-inline="') + '"]'),
          (F.getMenuBlockType = function (e) {
            var t = e.get("type");
            switch (t) {
              case l.heading:
                return "header" + e.get("depth");
              case l.list:
                return e.get("style");
            }
            return t;
          }),
          (w.CONST = F),
          (n.exports = w);
      }
    ),
    $__System.registerDynamic(
      "5b",
      ["11", "13", "1b", "1d"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self, e("11");
        var i = e("13"),
          r = e("1b"),
          o = i.Node,
          a = i.TYPE,
          s = i.NodeCollectionUtils,
          l =
            (e("1d"),
            function (e, t) {
              if (!e) return null;
              if (t(e)) return e;
              var n = e.get("parent");
              return n ? l(n, t) : null;
            });
        function c(e, t) {
          return e
            ? e.get("after")
              ? t(e.get("after").getVeryFirst())
              : c(e.get("parent"), t)
            : null;
        }
        function d(e) {
          File.editor.mathBlock.cacheUnder(e), e.remove();
        }
        function u(e) {
          File.editor.mathBlock.cacheUnder(File.editor.findElemById(e)[0]);
        }
        function h(e, t, n) {
          var i, r;
          if (!e) return e;
          if (!n && !e.get("parent")) return null;
          if (o.isType(e.get("before"), a.list)) return e;
          if (
            !(i = l(e, function (e) {
              return o.isType(e.get("parent"), a.list_item);
            })) &&
            t
          )
            for (r = t; r; ) {
              if (r == e || r.contains(e)) return r;
              r = r.get("after");
            }
          return i;
        }
        function p(e) {
          return e
            ? l(e, function (e) {
                return o.isType(e.get("parent"), a.list_item);
              })
            : e;
        }
        function f(e) {
          return l(e, function (e) {
            return o.isType(e.get("parent"), a.blockquote);
          });
        }
        function m(e, t, n) {
          return (
            o.isType(e, a.list) &&
            o.isType(t, a.list) &&
            (n || e.get("style") == e.get("style"))
          );
        }
        function g(e, t, ...n) {
          for (var i = e; i; ) {
            var o = i.get("after");
            for (var a of n)
              t && t.undo.push(r.buildAttrUndo(i, a)),
                i.unset(a),
                t && t.redo.push(r.buildAttrUndo(i, a));
            i = o;
          }
        }
        var v = function (e, t, n) {
          var i = [];
          function l(e) {
            return document.querySelector(`[cid="${e.cid}"]`);
          }
          function p(e, t) {
            var c;
            if (!e.isDeleted())
              if (o.isType(e.get("before"), a.list)) {
                (c = e.get("before")), r.addUndoForRemove(n, e);
                let t = e.get("before").getLastChild();
                if (
                  (l(t).append(l(e)),
                  t.appendChild(e),
                  r.addUndoForInsert(n, e),
                  o.isType(c.get("after"), a.list))
                ) {
                  var h = c.get("after");
                  r.addUndoForRemove(n, h);
                  var p = o.genArrFrom(h.getFirstChild());
                  c.appendChildrenTillEnd(p[0]),
                    d(l(h)),
                    h.remove(),
                    r.addUndoForInsertArray(n, p),
                    $(l(p[0].get("before"))).after(s.toHTML(p)),
                    File.editor.mathBlock.clearCache();
                }
              } else {
                var f = e.get("parent"),
                  v = f.get("before");
                if (o.isType(f, a.list_item)) {
                  if (v) {
                    r.addUndoForRemove(n, f),
                      d(l(f)),
                      (c = f.get("parent").clone()).unset("start"),
                      f.unset("prespace"),
                      f.unset("userIndent"),
                      c.appendChild(f);
                    var y = e.get("after");
                    if (o.isType(y, a.list)) {
                      var b = o.genArrFrom(y.getFirstChild());
                      if (
                        (c.appendChildrenTillEnd(b[0]),
                        f.copyContentFrom(b[0], [
                          "pattern",
                          "subindent",
                          "prespace",
                          "markindent",
                          "ahead",
                          "tail",
                        ]),
                        e.copyContentFrom(b[0].getLastChild(), ["tail"]),
                        g(f, null, "userIndent"),
                        c.addAfterTillEnd(y.get("after")),
                        w(y))
                      ) {
                        y.remove();
                        var x = i.indexOf(y);
                        (y = null),
                          x > t &&
                            i.splice.apply(
                              i,
                              [x, 1].concat(b.map((e) => e.getFirstChild()))
                            );
                      }
                    }
                    v.appendChildrenTillEnd(c),
                      y && !o.isType(y, a.list) && v.appendChildrenTillEnd(y);
                    var C = o.genArrFrom(c);
                    if (
                      (r.addUndoForInsertArray(n, C), m(c.get("before"), c, !0))
                    ) {
                      r.addUndoForRemove(n, c),
                        (C = o.genArrFrom(c.getFirstChild()));
                      let e = c.get("before");
                      e.appendChildrenTillEnd(c.getFirstChild()),
                        c.remove(),
                        g(
                          e.getFirstChild(),
                          null,
                          "userIndent",
                          "prespace",
                          "markindent"
                        ),
                        r.addUndoForInsertArray(n, C);
                    }
                    return (
                      g(v.get("after"), n, "userIndent"),
                      u(v.cid),
                      $(l(v)).replaceWith(v.toHTML()),
                      void File.editor.mathBlock.clearCache()
                    );
                  }
                  var F = f.get("parent"),
                    S = F && F.get("before");
                  if (o.isType(S, a.list)) {
                    (v = S.getLastChild()), r.addUndoForRemove(n, f), d(l(f));
                    var k = F.clone();
                    k.appendChild(f),
                      v.appendChild(k),
                      r.addUndoForInsert(n, k),
                      u(v.cid),
                      $(l(v)).replaceWith(v.toHTML()),
                      File.editor.mathBlock.clearCache(),
                      w(F) &&
                        (r.addUndoForRemove(n, F), F.remove(), l(F).remove());
                  }
                }
              }
          }
          i = (function (e, t) {
            for (var n, i, r = e, s = []; r && r.get("parent"); ) {
              i = null;
              var l = n && r.get("before") == n;
              if (
                (o.isType(r, a.list) &&
                  r.contains(t) &&
                  ((r = r.getFirstChild().getFirstChild()), (l = !0)),
                o.isType(r.get("before"), a.list) || l)
              )
                s.push(r),
                  (n = r),
                  (i = r.get("after") || c(r.get("parent"), h));
              else if (o.isType(r.get("parent"), a.list_item))
                if (((n = null), r.get("parent").get("before")))
                  r.get("before") ||
                    (s.push(r),
                    o.isType(r.get("after"), a.list)
                      ? ((i = r.get("after")), (n = r))
                      : (i = c(r.get("parent"), h)));
                else {
                  if (!o.isType(r.closest(a.list).get("before"), a.list) && !l)
                    break;
                  s.push(r), (i = c(r.get("parent"), h));
                }
              if (r == t || r.contains(t)) break;
              r = i;
            }
            return s;
          })(e, t);
          for (var f = 0; f < i.length; f++) p(i[f], f);
          return n;
        };
        function y(e, t) {
          for (t = t || 1; t > 0 && e; )
            e.unset("tail"), (e = e.getLastChild()), t--;
        }
        function b(e) {
          var t = e.get("parent"),
            n = t.clone();
          y(n, 2);
          var i = e.get("after");
          return (
            i &&
              (!(function (e) {
                if (e) {
                  var t = o.genArrFrom(e),
                    n = t[0].get("userIndent");
                  n &&
                    !/^\s*1\./.exec(n) &&
                    t.forEach(function (e) {
                      e.unset("userIndent");
                    });
                }
              })(i),
              n.appendChildrenTillEnd(i)),
            t.addAfter(e),
            y(e, 2),
            e.addAfter(n),
            [t, n]
          );
        }
        function w(e) {
          return 0 == e.get("children").length;
        }
        o.upStream = function (e, t) {
          t = t || r.makeEmptyCommand();
          var n,
            i = e.get("parent");
          if (o.isType(i, a.list_item))
            if (e.get("before")) {
              if (
                !e.get("after") &&
                o.isType(e, a.paragraph, a.heading) &&
                o.isEmptyBlock(e)
              ) {
                r.addUndoForRemove(t, e);
                var l = i.clone();
                l.appendChildrenTillEnd(e),
                  i.addAfter(l),
                  r.addUndoForInsert(t, l);
                var c = i.get("parent");
                u(c.cid),
                  (n = { oldCid: c.cid, html: c.toHTML() }),
                  File.editor.mathBlock.clearCache();
              }
            } else {
              var d = [];
              r.addUndoForRemoveArray(t, o.genArrFrom(i));
              var [h, p] = b(i);
              (n = { oldCid: h.cid }),
                u(h.cid),
                (d = i.unwrap()),
                w(p) ? p.remove() : d.push(p),
                r.addUndoForInsertArray(t, d),
                w(h)
                  ? (r.addUndoForRemove(t, h), h.remove())
                  : (h.getLastChild().unset("tail"), d.unshift(h)),
                (n.html = s.toHTML(d, { mathCount: 0 })),
                File.editor.mathBlock.clearCache();
            }
          if ((o.isType(i, a.blockquote) && (n = (x(e, e, t) || [])[0]), n))
            return { oldCid: n.oldCid, newHtml: n.html, command: t };
        };
        var x = function (e, t, n, i) {
            return (
              (i = i || []),
              (function (e, t) {
                for (
                  var n = e, i = [];
                  n &&
                  o.isType(n.get("parent"), a.blockquote) &&
                  (i.push(n), n != t);

                )
                  n = c(n, f);
                return i;
              })(e, t).forEach(function (e) {
                if (e.isDeleted()) return;
                var t = {};
                r.addUndoForRemoveArray(n, o.genArrFrom(e));
                const [a, l] = b(e);
                var c = [];
                (t.oldCid = a.cid),
                  u(t.oldCid),
                  c.push(e),
                  a.addAfter(e),
                  e.addAfter(l),
                  w(l) ? l.remove() : c.push(l),
                  r.addUndoForInsertArray(n, c),
                  w(a) ? (r.addUndoForRemove(n, a), a.remove()) : c.unshift(a),
                  (t.html = s.toHTML(c, { mathCount: 0 })),
                  i.push(t),
                  File.editor.mathBlock.clearCache();
              }),
              i
            );
          },
          C = function (e, t, n, i) {
            function l(e) {
              return b(e);
            }
            return (
              (i = i || []),
              (function (e, t) {
                for (
                  var n = e, i = [];
                  n &&
                  o.isType(n.get("parent"), a.list_item) &&
                  (i.push(n), !n.get("parent").contains(t));

                )
                  n = c(n.get("parent"), h);
                return i;
              })(e, t).forEach(function (e) {
                if (!e.isDeleted()) {
                  var t,
                    c = {},
                    d = e.get("parent"),
                    h = d.get("parent"),
                    p = [];
                  if (e.get("before")) {
                    n.undo.push(r.buildReplaceUndo(d)),
                      d.get("after") &&
                        ((t = r.addUndoForInsertArray(
                          { undo: [], redo: [] },
                          o.genArrFrom(d.get("after"))
                        )),
                        n.undo.push(t.redo[0]),
                        n.redo.push(t.undo[0]));
                    var f = d.clone();
                    f.appendChildrenTillEnd(e),
                      d.addAfter(f),
                      (c.oldCid = h.cid);
                    let [i, a] = l(f);
                    (p = f.unwrap()),
                      (t = r.addUndoForInsertArray({ undo: [], redo: [] }, p)),
                      n.redo.push(t.undo[0]),
                      w(a)
                        ? a.remove()
                        : m(a, p.last())
                        ? (p.last().appendChildrenTillEnd(a.getFirstChild()),
                          a.remove())
                        : p.push(a),
                      (t = r.addUndoForInsertArray({ undo: [], redo: [] }, p)),
                      n.redo.push(t.redo[0]),
                      n.undo.push(t.undo[0]),
                      p.unshift(i);
                  } else if (o.isType(h.get("parent"), a.list_item)) {
                    n.undo.push(r.buildReplaceUndo(h.get("parent"))),
                      h.get("after") &&
                        !d.get("after") &&
                        (n.redo.push({
                          type: "remove",
                          idArray: o
                            .genArrFrom(h.get("after"))
                            .map((e) => e.cid),
                        }),
                        h.getLastChild().appendChildrenTillEnd(h.get("after")));
                    let [e, i] = l(d);
                    w(i) ? i.remove() : d.appendChildrenTillEnd(i);
                    var v = d.get("parent");
                    v.addAfter(d),
                      (t = r.addUndoForInsert({ undo: [], redo: [] }, d)),
                      n.redo.push(t.undo[0]),
                      n.redo.push(t.redo[0]),
                      n.undo.push(t.undo[0]),
                      (c.oldCid = v.cid),
                      w(e) && (r.addUndoForRemove(n, e), e.remove()),
                      w(v) ? (r.addUndoForRemove(n, v), v.remove()) : p.push(v),
                      g(
                        d.getFirstBrother(),
                        n,
                        "userIndent",
                        "prespace",
                        "markindent"
                      ),
                      p.push(d);
                  } else {
                    n.undo.push(r.buildReplaceUndo(h)),
                      (t = r.addUndoForInsertArray(
                        { undo: [], redo: [] },
                        o.genArrFrom(d)
                      )),
                      n.redo.push(t.undo[0]),
                      (c.oldCid = h.cid);
                    let [e, i] = l(d);
                    (p = d.unwrap()),
                      w(i) ? i.remove() : p.push(i),
                      (t = r.addUndoForInsertArray({ undo: [], redo: [] }, p)),
                      n.redo.push(t.redo[0]),
                      n.undo.push(t.undo[0]),
                      w(e)
                        ? (r.addUndoForRemove(n, e), e.remove())
                        : p.unshift(e);
                  }
                  u(c.oldCid),
                    (c.html = s.toHTML(p, { mathCount: 0 })),
                    i.push(c),
                    File.editor.mathBlock.clearCache();
                }
              }),
              i
            );
          };
        (t.moreIndent = function (e) {
          var t = e.selection.getRangy();
          if (!t || File.isLocked) return !0;
          if (o.isType(isInputComponent(document.activeElement))) {
            var n = $(document.activeElement).closest(".CodeMirror")[0];
            return n && n.CodeMirror.execCommand("indentMore"), !0;
          }
          var i = e.getMarkElem(t.startContainer),
            s = h(e.findNodeByElem(i)),
            l = e.getMarkElem(t.endContainer),
            c = h(e.findNodeByElem(l), s);
          if (
            (e.undo.endSnap(!0),
            e.brush.pause(),
            s && !c && (c = s.closest(a.list).getLastChild().getFirstChild()),
            s && c)
          ) {
            var d = e.selection.buildUndo(),
              u = r.makeEmptyCommand(d);
            return (
              (s != c || !o.isType(s, a.table)) &&
              (v(s, c, u),
              u.redo.length &&
                (u.redo.push(d),
                e.undo.exeCommand(d),
                e.undo.register(u),
                e.refresh(),
                e.selection.scrollAdjust()),
              window.Reporter.fullValidate(),
              e.brush.resume(),
              u.redo.length)
            );
          }
          return e.brush.resume(), !1;
        }),
          (t.lessIndent = function (e) {
            var t = e.selection.getRangy();
            if (!t || File.isLocked) return !0;
            if (isInputComponent(document.activeElement)) {
              var n = $(t.startContainer).closest(".CodeMirror")[0];
              return n && n.CodeMirror.execCommand("indentLess"), !0;
            }
            function i() {
              e.brush.pause(),
                e.undo.endSnap(!0),
                (s = e.selection.buildUndo(t)),
                (l = r.makeEmptyCommand(s));
            }
            t = e.selection.deRange(t);
            var s,
              l,
              c = e.getMarkElem(t.startContainer),
              d = p(e.findNodeByElem(c)),
              u = e.getMarkElem(t.endContainer),
              h = p(e.findNodeByElem(u));
            d && !h && (h = d.closest(a.list).getLastChild().getFirstChild());
            var m = !1;
            if (d && h) {
              if (d == h && o.isType(d, a.table)) return !1;
              i(), (m = C(d, h, l));
            }
            return (
              m ||
                ((d = f(e.findNodeByElem(c))),
                (h = f(e.findNodeByElem(u))),
                o.isType(
                  d,
                  a.paragraph,
                  a.def_footnote,
                  a.def_link,
                  a.heading
                ) && (i(), (m = x(d, h, l)))),
              (function (t) {
                if (t) {
                  for (var n = 0; n < t.length; n++) {
                    e.findElemById(t[n].oldCid).replaceWith(t[n].html);
                    var i = e.findElemById(t[n].oldCid)[0];
                    i && e.refreshUnder(i, !1, !1);
                  }
                  e.undo.exeCommand(s),
                    l.redo.push(s),
                    e.undo.register(l),
                    window.Reporter.fullValidate();
                }
                return e.brush.resume(), e.mathBlock.clearCache(), t && d != h;
              })(m)
            );
          }),
          (t.tryConvertListItemToUpperParagraph = function (e, t) {
            if (
              o.isType(t.get("parent"), a.list_item) &&
              t.get("parent").get("before") &&
              !t.get("before")
            ) {
              var n = r.makeEmptyCommand(e.selection.buildUndo()),
                i = t.get("parent"),
                l = i.get("before"),
                c = l.getLastChild(),
                d = o.genArrFrom(t);
              r.addUndoForRemove(n, i),
                l.appendChildrenTillEnd(t),
                r.addUndoForInsertArray(n, d),
                i.remove(),
                e.findElemById(i.id).remove(),
                e.findElemById(c.id).after(s.toHTML(d, { mathCount: 0 })),
                e.selection.jumpIntoElemBegin(e.findElemById(t.id));
              for (var u = t.closest(a.list); u; )
                g(u.getFirstChild(), n, "tail"),
                  (u = u.get("parent")) && (u = u.closest(a.list));
              return n.redo.push(e.selection.buildUndo()), n;
            }
          });
      }
    ),
    $__System.registerDynamic(
      "5c",
      ["11", "13", "1b", "1d", "1e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self, e("11");
        var i = e("13"),
          r = e("1b").SnapFlag,
          o = (i.Node, i.TYPE, e("1d"), e("1e")),
          a = {
            "(": ")",
            "[": "]",
            "{": "}",
            '"': '"',
            "'": "'",
            "~": "~",
            "^": "^",
            "=": "=",
            "*": "*",
            "`": "`",
            $: "$",
            _: "_",
          },
          s = null;
        var l = null;
        var c = null;
        (t.handlePair = function (e, t, n, i, s, l) {
          if (!File.option.noPairingMatch) {
            var d, u, h, p, f, m, g;
            if (/^[\]\)\}'"]$/.exec(t)) {
              if (
                (e.undo.endSnap(),
                e.undo.addSnap(n.cid, 0),
                (d = e.findElemById(n.cid).rawText()),
                t === d.substring(i.start, i.start + 1))
              )
                return S(), s || !0;
              if ("'" == t || '"' == t) {
                if ("" == d)
                  return (
                    ("'" != t ||
                      !~(File.option.keyboardLayout || "").indexOf(
                        "Ukrainian"
                      )) &&
                    k()
                  );
                u = (p = d.substring(0, i.start)).slice(-1);
                var v = "'" == t;
                if (
                  o.shouldTriggerReplaceQuote(!0) &&
                  -1 == "\"'".indexOf(o.userQuote(v ? 2 : 0)) &&
                  o.shouldTriggerReplace(e, l)
                ) {
                  var y = o.userQuote(v ? 3 : 1, void 0, !0);
                  if (y == (h = d.substring(i.start, i.start + y.length)))
                    return S(y.length), s || !0;
                  if (o.userQuote(v ? 2 : 0) == u)
                    return (
                      (f = y),
                      (m = e.selection.getRangy()),
                      (g = document.createTextNode(f)),
                      m.insertNode(g),
                      g.parentElement.normalize(),
                      S(),
                      s && e.undo.register(s),
                      e.undo.addSnap(n.cid, r.REPLACE),
                      !0
                    );
                }
                if (
                  t != u &&
                  "\\" != u &&
                  !/[\w\u0430-\u044fàâäèéêëîïôœùûüÿçÀÂÄÈÉÊËÎÏÔŒÙÛÜŸÇĀ-ɏ]|(^[.?,!:~\)\]])/i.exec(
                    d.substring(Math.max(0, i.start - 1), i.start + 1)
                  ) &&
                  !(function (e, t) {
                    var n = File.option.userQuotesArray || ["“", "”", "‘", "’"];
                    function i(e, t) {
                      return (t && n[0] == e) || n[1] == e
                        ? '"'
                        : (t && n[2] == e) || n[3] == e
                        ? "'"
                        : e;
                    }
                    for (var r, o, a = e.length, s = 0; s < a; s++) {
                      var l = i(e[s], !0),
                        c = i(e[s], !1),
                        d = l || c;
                      (("'" != d ||
                        (!r &&
                          /[\w\u0430-\u044fàâäèéêëîïôœùûüÿçÀÂÄÈÉÊËÎÏÔŒÙÛÜŸÇĀ-ɏ]/i.exec(
                            e[s - 1] || ""
                          ))) &&
                        '"' != d) ||
                        (r
                          ? r == d
                            ? ((r = null), (o = null))
                            : (o = o ? null : d)
                          : (r = d));
                    }
                    return (t = i(t, !1)) == r || t == o;
                  })(p, t)
                )
                  return k();
              }
            } else if (/^[\[\(\{]$/.exec(t)) {
              if (
                (e.undo.endSnap(),
                (h = (d = e.findElemById(n.cid).rawText()).substring(
                  i.start,
                  i.start + 1
                )),
                !/[^\[\]{}()"'\s`>$]/.exec(h))
              )
                return k();
            } else if (
              File.option.autoPairExtendSymbol &&
              (function () {
                if (!c) {
                  var e = "*`_";
                  File.option.enableInlineMath && (e += "$"),
                    (c = new RegExp("^[" + e + "]$"));
                }
                return c;
              })().exec(t)
            ) {
              if (
                (e.undo.endSnap(),
                l &&
                  l.commonAncestorContainer &&
                  l.commonAncestorContainer.parentElement &&
                  (("CODE" == l.commonAncestorContainer.parentElement.tagName &&
                    "`" != t) ||
                    ("SCRIPT" ==
                      l.commonAncestorContainer.parentElement.tagName &&
                      "$" != t)))
              )
                return;
              if (
                ((d = e.findElemById(n.cid).rawText()),
                File.option.enableInlineMath &&
                  "$" == d.substring(i.start - 1, i.start) &&
                  /[*`^_~=]/.exec(t))
              )
                return;
              var b = (p = p || d.substring(0, i.start))[p.length - 1] || "";
              if ("\\" == b) return !1;
              h = d.substring(i.start, i.start + 1);
              var w = d.substring(i.start + 1, i.start + 2),
                x = /[*_]/.exec(t);
              if (h == t) {
                if (x) {
                  if (x && w) return S() || !0;
                  var C = $(e.selection.getRangy().commonAncestorContainer);
                  return C.closest(".md-after").length &&
                    C.parent().parent("[md-inline='strong'], [md-inline='em']")
                      .length
                    ? S() || !0
                    : ((p = d.substring(0, i.start)),
                      /[*_]$/.exec(p) ? k() : S() || !0);
                }
                return S() || !0;
              }
              var F = 0 == b.trim().length;
              if (
                F ||
                !(function (e, t) {
                  if ("`" == t && /``$/.exec(e)) return !0;
                  e.replace(/\\[*`_$]/g, ""),
                    "_" == t && (e = e.replace(/([a-z])_([a-z])/gi, ""));
                  for (var n = e.length, i = !1, r = 0; r < n; r++)
                    e[r] == t && (i = !i);
                  return i;
                })(p, t)
              ) {
                if (F && !/^[^\s\>\)\]}'";:.,?!~*\/&#=_+-]/.exec(h)) return k();
                if ((b + "a").trim().split(/\b/).length > 1) return k();
              }
            }
            return !1;
          }
          function S(t) {
            t = t || 1;
            var n = e.selection.rangy.createRange();
            (i.end += t),
              (i.start += t),
              n.moveToBookmark(i),
              n.select(n.isBackward),
              s && s.redo.push(e.selection.buildUndo());
          }
          function k() {
            if (!s) {
              var i = e.selection.getRangy(),
                c = document.createTextNode(t + a[t]);
              i.insertNode(c),
                i.setStart(c, t.length),
                i.setEnd(c, t.length),
                i.select(),
                e.undo.addSnap(n.cid, r.REPLACE),
                o.shouldTriggerReplaceQuote(!0) &&
                  /['"]/.exec(t) &&
                  o.shouldTriggerReplace(e, l) &&
                  o.replaceQuote(c);
              var d = c.textContent.toString().length > 2;
              return (
                c.parentElement.normalize(),
                S(),
                d && S(),
                e.undo.addSnap(n.cid, r.REPLACE),
                !0
              );
            }
          }
        }),
          (t.surroundPair = function (e, t, n) {
            if ((e.undo.endSnap(), !File.option.noPairingMatch)) {
              var i,
                l,
                c = $(n.commonAncestorContainer).closest("[cid]"),
                d = $(n.commonAncestorContainer).closest(
                  ".md-def-content:not(.md-def-url)"
                );
              if (
                ((c.length && !c.find("[cid], .md-def-name").length) ||
                  d.length) &&
                (function () {
                  if (!s) {
                    var e = "\\{\\(\\[\"'";
                    File.option.autoPairExtendSymbol &&
                      ((e += "*`~_"),
                      File.option.enableInlineMath && (e += "$"),
                      File.option.enableSuperscript && (e += "^"),
                      File.option.enableHighlight && (e += "=")),
                      (s = new RegExp("^[" + e + "]$"));
                  }
                  return s;
                })().exec(t)
              ) {
                (l = e.findNodeByElem(c)),
                  e.undo.addSnap(l.cid, 0),
                  (c = d.length ? d : c),
                  (i = n.getBookmark(c[0])),
                  (n = e.selection.rangy.createRange()).moveToBookmark(i),
                  e.selection.deRange(n);
                var u = document.createTextNode(t),
                  h = document.createTextNode(a[t]);
                n.insertNode(u),
                  i.end++,
                  n.moveToBookmark(i),
                  e.selection.deRange(n),
                  n.insertNodeAtEnd(h),
                  i.start++,
                  n.moveToBookmark(i),
                  n.select(n.isBackward),
                  e.undo.addSnap(l.cid, r.REPLACE);
                var p = o.userQuote('"' == t ? 0 : 2, !1, !0);
                return (
                  o.shouldTriggerReplaceQuote(!0) &&
                    /['"]/.exec(t) &&
                    !/['"]/.exec(p) &&
                    o.shouldTriggerReplace(e, n) &&
                    (o.replaceQuote(u, h),
                    2 == p.length && ((i.start += 1), (i.end += 2)),
                    n.moveToBookmark(i),
                    n.select(n.isBackward)),
                  e.undo.addSnap(l.cid, r.REPLACE),
                  !0
                );
              }
            }
          }),
          (t.tryRemovePairStart = function (e, t) {
            var n = t.toString();
            if (
              !File.option.noPairingMatch &&
              (1 != t.endOffset ||
                !$(t.endContainer).closest(".md-after, .md-before").length) &&
              ((function () {
                if (!l) {
                  var e = "\\{\\(\\[\"'";
                  File.option.autoPairExtendSymbol &&
                    ((e += "*`~_"),
                    File.option.enableInlineMath && (e += "$"),
                    File.option.enableSuperscript && (e += "^")),
                    (l = new RegExp("[" + e + "]"));
                }
                return l;
              })().exec(n) ||
                o.userQuote(0, !0) == n ||
                o.userQuote(2, !0) == n)
            ) {
              var i = $(t.commonAncestorContainer).closest("[cid]"),
                r = i.rawText(),
                s = t.getBookmark(i[0]),
                c = r.substring(s.end, s.end + 1);
              if (
                a[n] == c ||
                (o.userQuote(0, !0) == n && o.userQuote(1, !0) == c) ||
                (o.userQuote(2, !0) == n && o.userQuote(3, !0) == c)
              )
                return s.end++, t.moveToBookmark(s), t;
            }
          });
      }
    ),
    $__System.registerDynamic(
      "5d",
      ["11", "13", "1b", "46", "2c", "5b", "5c"],
      !0,
      function (e, t, n) {
        this || self, e("11");
        var i = e("13"),
          r = e("1b"),
          o = r.SnapFlag,
          a = i.Node,
          s = i.TYPE,
          l = (i.NodeCollectionUtils, e("46")),
          c = e("2c"),
          d = e("5b"),
          u = e("5c"),
          h = "skipCommand",
          p = $("content"),
          f = function (e, t) {
            var n = t.get("parent"),
              i = n && n.get("parent");
            if (
              i &&
              i.get("style") == a.ListType.task &&
              !n.get("before") &&
              a.isType(n, s.paragraph)
            ) {
              var o = r.makeEmptyCommand(e.selection.buildUndo());
              return (
                o.undo.push(r.buildReplaceUndo(i)),
                i.unset("style"),
                i.unset("checked"),
                e.findElemById(i.cid).replaceWith(i.toHTML()),
                o.redo.push(r.buildReplaceUndo(i)),
                e.undo.exeCommand(o.undo[0]),
                o.redo.push(e.selection.buildUndo()),
                o
              );
            }
          },
          m = function (e, t, n) {
            e.undo.endSnap(!0);
            var i =
                a.isType(t.get("parent"), s.blockquote) &&
                (n || !t.get("before")),
              o =
                a.isType(t.get("parent"), s.list_item) &&
                (n || (!t.get("parent").get("before") && !t.get("before")));
            if (i || o) {
              var l = r.makeEmptyCommand(e.selection.buildUndo()),
                c = a.upStream(t, l);
              return (
                e.findElemById(c.oldCid).replaceWith(c.newHtml),
                e.undo.exeCommand(l.undo[0]),
                l.redo.push(e.selection.buildUndo()),
                l
              );
            }
          },
          g = function (e, t, n, i) {
            e.undo.endSnap(!0);
            var o = r.makeEmptyCommand(e.selection.buildUndo());
            return (
              o.undo.push(r.buildReplaceUndo(t)),
              t.set("type", s.paragraph),
              t.clearChildren(),
              n
                ? t.set("text", "")
                : t.set("text", t.get("text").replace(/\u200B|(\r?\n)/g, "")),
              o.redo.push(r.buildReplaceUndo(t)),
              e.findElemById(t.id).replaceWith(t.toHTML()),
              e.selection.jumpIntoElemBegin(e.findElemById(t.id)),
              o.redo.push(e.selection.buildUndo()),
              !i && $(e.sessionStr).trigger("cursorChange"),
              o
            );
          },
          v = function (e, t, n, i) {
            if ((e.undo.endSnap(!0), t && t.length)) {
              n && n.preventDefault();
              var o = e.findNodeByElem(t),
                a = r.makeEmptyCommand(e.selection.buildUndo());
              return (
                o
                  ? (o.set("text", ""), (a = r.append(a, g(e, o))))
                  : ((o = e.findNodeByElem(t.closest("[mdtype]"))),
                    a.undo.push(r.buildReplaceUndo(o)),
                    e.selection.moveLeftOrRight(!0, n),
                    t.remove(),
                    e.store(o.id),
                    a.redo.push(r.buildReplaceUndo(o)),
                    a.redo.push(e.selection.buildUndo())),
                !i && e.undo.register(a),
                a
              );
            }
          },
          y = function (e, t, n, i, y) {
            e.needRemoveMathAfterSym &&
              ((e.needRemoveMathAfterSym = !1),
              $(".math-jax-postprocess>.md-math-after-sym").text(""));
            var b,
              w,
              C,
              F,
              S = e.selection.includeTrailMeta(e.selection.getRangy()),
              k = S && e.selection.deRange(S.cloneRange()),
              E = document.activeElement,
              T = !1,
              _ = S;
            function A(e, t, n) {
              var i,
                r = e;
              if (e == t) return null;
              for (i = e.get(n); i; )
                $("[cid='" + i.id + "']").remove(), i.remove(), (i = e.get(n));
              return A(e.get("parent"), t, n), r;
            }
            function M(e, t, n, i, o) {
              var s,
                l,
                d,
                u = t.cloneRange(),
                h = e.findElemById(n.id);
              return h.length
                ? (u.setEndAfter(h[0]),
                  e.selection.deRange(u),
                  (l = e.findNodeByElem(e.getMarkElem(u.startContainer))),
                  !o && $(u.startContainer).closest("table").length
                    ? (r.append(i, I(e, u, !0)),
                      (l = e.findNodeByElem(
                        $(u.startContainer).closest("[mdtype='table']")
                      )),
                      n.contains(l) &&
                      (A(l, n, "after"), 0 === l.getText().length)
                        ? (r.append(i, g(e, l)), "abortAndSkipCursor")
                        : "abort")
                    : (i.undo.push(r.buildReplaceUndo(n)),
                      (s = $(u.extractContents())),
                      a.isType.apply(null, [n].concat(c.CONST.Selectable)) &&
                        r.append(i, g(e, n, !0, !0)),
                      e.store(l, !0),
                      e.findElemById(l.cid).replaceWith(l.toHTML()),
                      (d = A(l, n, "after")),
                      !!(s.text().length || s.find("img").length || d) &&
                        (i.redo.push(r.buildReplaceUndo(n)), l)))
                : "abort";
            }
            function L(e, t, n, i, o) {
              var a,
                s,
                l,
                c = t.cloneRange(),
                d = e.findElemById(n.id);
              if (
                (c.setStartBefore(d[0]),
                e.selection.deRange(c),
                !o && $(c.endContainer).closest("table").length)
              )
                return (
                  r.append(i, I(e, c, !0)),
                  (s = e.findNodeByElem(
                    $(c.endContainer).closest("[mdtype='table']")
                  )),
                  "abort"
                );
              i.undo.push(r.buildReplaceUndo(n)),
                (s = e.findNodeByElem(
                  e.getMarkElem(e.selection.getEndNode(c))
                )),
                (a = $(c.extractContents())),
                e.store(s, !0);
              var u = e.findElemById(s.cid);
              if (
                ((l = A(s, n, "before")),
                a.text().length || a.find("img").length || l)
              ) {
                for (
                  i.redo.push(r.buildReplaceUndo(n));
                  u.parent().closest(".md-task-list-item").length;

                )
                  u = u.parent().closest(".md-task-list-item");
                return (
                  u.hasClass("md-task-list-item")
                    ? u.replaceWith(e.findNodeByElem(u).toHTML())
                    : u.replaceWith(s.toHTML()),
                  s
                );
              }
              return u.replaceWith(s.toHTML()), !1;
            }
            function N(e, t, n, i, o, l, c) {
              var d, u, h, p;
              function f(e, t) {
                return e == t || e.get("before") || e.get("after")
                  ? e
                  : f(e.get("parent"), t);
              }
              var m,
                g = a.isEmptyBlock(i);
              if (!g || i == o || (a.isEmptyBlock(o) && !c))
                if (g && i == o && o.isBlock())
                  o.set("type", s.paragraph),
                    o.set("text", ""),
                    o.clearChildren(),
                    e.findElemById(o.id).replaceWith(o.toHTML()),
                    e.selection.jumpIntoElemBegin(e.findElemById(o.id)),
                    l.redo.push(e.selection.buildUndo());
                else {
                  if (
                    (console.assert(t != n, "Error on spliceStartAndEnd"),
                    t != n)
                  ) {
                    if (
                      ((d = n.safeGetStrAttr("text")),
                      (p = f(n, o)),
                      r.addUndoForRemove(l, p),
                      e.findElemById(p.id).remove(),
                      p.remove(),
                      (m = t),
                      (u = a.isType(m, s.math_block, s.fences, s.html_block)
                        ? m.get("text").length
                        : $(m.toHTML()).rawText().length),
                      l.undo.push(r.buildReplaceUndo(i)),
                      a.isType(t, s.def_link))
                    )
                      if (t.safeGetStrAttr("title").length)
                        t.set("title", t.get("title") + d);
                      else {
                        var v = /["']([^"]*)["']\s*$/g.exec(d);
                        (d = d.replace(/"([^"])*"\s*$/, "")),
                          v && t.set("title", v[1]),
                          t.set("href", t.get("href") + d);
                      }
                    else t.set("text", t.safeGetStrAttr("text") + d);
                    if (
                      p != o &&
                      o !== n &&
                      o.get("before") == i &&
                      a.isType(i, s.list_item)
                    ) {
                      var y = o.getFirstChild();
                      r.addUndoForRemove(l, o),
                        i.appendChildrenTillEnd(y),
                        e.findElemById(o.id).remove(),
                        o.remove();
                    }
                    l.redo.push(r.buildReplaceUndo(i)),
                      e.findElemById(i.id).replaceWith(i.toHTML()),
                      (h = e.findElemById(t.id));
                  }
                  ((h = e.findElemById(t.id)).hasClass("md-def-link") ||
                    h.hasClass("md-def-footnote")) &&
                    h.attr("contenteditable", "true"),
                    e.undo.exeCommand({
                      type: "cursor",
                      id: t.id,
                      start: u,
                      end: u,
                    }),
                    l.redo.push(e.selection.buildUndo());
                }
              else {
                e.findElemById(i.id).remove(),
                  r.addUndoForRemove(l, i),
                  i.remove();
                var b = f(n, o);
                e.findElemById(b.id).replaceWith(b.toHTML()),
                  e.selection.jumpIntoElemBegin(e.findElemById(b.id));
              }
            }
            function D(e, t) {
              var n = t.get("before");
              function i(t) {
                var n = r.makeEmptyCommand(e.selection.buildUndo());
                return (
                  r.addUndoForRemove(n, t),
                  e.findElemById(t.id).remove(),
                  t.remove(),
                  n.redo.push(e.selection.buildUndo()),
                  n
                );
              }
              return a.isType(n, s.hr)
                ? i(n)
                : n && !a.isEmptyBlock(t) && a.isEmptyBlock(n)
                ? i(n)
                : !n &&
                  a.isType(t.get("parent"), s.list_item) &&
                  (n = t.get("parent").get("before")) &&
                  1 == n.get("children").length &&
                  a.isEmptyBlock(n.get("children").at(0))
                ? i(n)
                : void 0;
            }
            function B(e, i) {
              if (a.isType(i, s.table_cell)) {
                var o = i.get("parent").get("parent");
                if (
                  t &&
                  !n &&
                  !i.get("before") &&
                  !i.get("parent").get("before") &&
                  e.tableEdit.isTableEmpty(o)
                )
                  return e.tableEdit.deleteTable(e.findElemById(o.cid), !0);
                var c = l.getSibling(i, "before");
                return (
                  c &&
                    ((C = r.makeEmptyCommand(e.selection.buildUndo())),
                    e.selection.jumpIntoElemEnd(e.findElemById(c.id)),
                    C.redo.push(e.selection.buildUndo())),
                  C
                );
              }
            }
            function R(e, t) {
              if (a.isType(t, a.backToParagraphBeforeDelete))
                return e.stylize.changeBlock(s.paragraph, t), h;
            }
            function P(e, t, n, i, o) {
              for (
                var l = [B, D, f, m, d.tryConvertListItemToUpperParagraph, R],
                  c = null,
                  u = 0;
                u < l.length;
                u++
              )
                if ((c = l[u](e, t))) return c;
              if (
                ((n = n || t),
                (o = o || n.get("before")),
                (i = i || (o && o.getVeryFirst(!0))),
                !c &&
                  i &&
                  N(
                    e,
                    i,
                    t,
                    o,
                    n,
                    (c = r.makeEmptyCommand(e.selection.buildUndo()))
                  ),
                !c &&
                  !i &&
                  a.isType(t, s.paragraph) &&
                  a.isEmptyBlock(t) &&
                  t.get("after"))
              ) {
                c = r.makeEmptyCommand(e.selection.buildUndo());
                var h = t.get("after").cid;
                r.addUndoForRemove(c, t),
                  t.remove(),
                  e.findElemById(t.cid).remove(),
                  e.selection.jumpIntoElemBegin(e.findElemById(h)),
                  c.redo.push(e.selection.buildUndo());
              }
              return c;
            }
            function I(e, t, n) {
              var i,
                o = e.selection.getDetailPos(t.startContainer, t.startOffset),
                l = e.selection.getDetailPos(t.endContainer, t.endOffset),
                c = r.makeEmptyCommand(),
                d = e.getMarkElem(o[0]),
                u = e.getMarkElem(l[0]),
                h = u.closest('[mdtype="table"]'),
                p = e.findNodeByElem(h),
                f = e.findNodeByElem(d),
                m = e.findNodeByElem(u);
              if (
                (n ||
                  ((i = t.cloneRange()).collapse(!0),
                  (i = e.selection.buildUndo(i))),
                t.setStart(o[0], o[1]),
                t.setEnd(l[0], l[1]),
                f == m)
              )
                return (
                  t.collapsed ||
                    !a.isType(f, s.table_cell) ||
                    (d[0] != t.commonAncestorContainer &&
                      !d[0].contains(t.commonAncestorContainer)) ||
                    (c.undo.push(r.buildReplaceUndo(f)),
                    t.extractContents(),
                    e.store(f, !0),
                    c.redo.push(r.buildReplaceUndo(f)),
                    c.redo.push(e.selection.buildUndo(t))),
                  c
                );
              c.undo.push(r.buildReplaceUndo(p));
              var g,
                v,
                y = M(e, t, f, c, !0),
                b = L(e, t, m, c, !0);
              for (
                y && (y.unset("marginLeft"), y.unset("marginRight")),
                  b && (b.unset("marginLeft"), b.unset("marginRight")),
                  g = p.contains(f)
                    ? e.tableEdit.getSibling(f, "after")
                    : p.getVeryFirst();
                g && g != m;

              )
                g.set("text", ""),
                  g.unset("marginLeft"),
                  g.unset("marginRight"),
                  (v = !0),
                  (g = e.tableEdit.getSibling(g, "after"));
              return (
                y || b || v
                  ? (e.findElemById(p.id).replaceWith(p.toHTML()),
                    c.redo.push(r.buildReplaceUndo(p)))
                  : c.undo.pop(),
                n || (c.redo.push(i), e.undo.exeCommand(i)),
                c
              );
            }
            function O(t) {
              return (
                e.selection.deRange(t),
                (b = e.getMarkElem(t.commonAncestorContainer)),
                (w = e.nodeMap.allNodes.get(b.attr("cid"))),
                (F = t.getBookmark(b[0])),
                b.length && w && !w.get("children").length && 0 == F.start && !n
              );
            }
            function H() {
              var n = null;
              if (
                (a.isType(w.get("before"), a.TYPE.hr, a.TYPE.toc) &&
                  (n = w.get("before")),
                t && t.preventDefault(),
                $(".md-tooltip-remove").remove(),
                b.prev("[cid]").addClass("md-expand"),
                (C = P(e, w)) === h)
              );
              else if (!i)
                return (
                  n &&
                    (e.selection.selectNode(n),
                    C.redo.push(e.selection.buildUndo())),
                  e.undo.register(C),
                  e.refresh(),
                  n || e.findElemById(w.cid).trigger("refocus"),
                  e.refocus(),
                  e.selection.scrollAdjust(),
                  C
                );
            }
            var U = $(document.activeElement).closest(".CodeMirror");
            if (U.length) {
              var j = U[0].CodeMirror;
              return j.getValue()
                ? void j.execCommand("delCharBefore")
                : x(e, i);
            }
            if (a.isType(E.getAttribute("mdtype"), a.TYPE.hr, a.TYPE.toc)) {
              var q = $(E).closest("[mdtype]");
              return v(e, q, t, i);
            }
            if (E.getAttribute("mdtype") == s.math_block)
              return (
                t && t.preventDefault(),
                e.mathBlock.remove(E.getAttribute("cid")),
                C
              );
            if (
              (n && "Backspace" != n ? !0 === n && (n = "Delete") : (n = !1), k)
            ) {
              if (
                $(k.commonAncestorContainer).closest("[mdtype='table_row']")
                  .length &&
                t &&
                t.shiftKey &&
                (File.isMac ? t.metaKey : t.ctrlKey)
              )
                return t.preventDefault(), e.tableEdit.deleteRow(), h;
              if (k.collapsed) {
                if (n) {
                  if (
                    "Delete" == n &&
                    (function (t) {
                      if (
                        (e.selection.deRange(t),
                        (b = e.getMarkElem(t.commonAncestorContainer)),
                        (w = e.nodeMap.allNodes.get(b.attr("cid"))),
                        (F = t.getBookmark(b[0])),
                        "Delete" == n && !w.get("children").length)
                      ) {
                        if (a.isType(b.attr("mdtype"), s.paragraph, s.heading))
                          return 0 == b.text().length;
                        if (
                          a.isType(b.attr("mdtype"), s.def_footnote, s.def_link)
                        )
                          return (
                            0 == b.text().replace(/[\u200b\u00a0]/g, "").length
                          );
                      }
                    })(k) &&
                    (C = (function () {
                      return w.get("after")
                        ? ((t = w),
                          (n = w.get("after").getVeryFirst().cid),
                          (i = r.makeEmptyCommand(e.selection.buildUndo())),
                          e.findElemById(t.cid).remove(),
                          r.addUndoForRemove(i, t),
                          t.remove(),
                          e.selection.jumpIntoElemBegin(e.findElemById(n)),
                          i.redo.push(e.selection.buildUndo()),
                          i)
                        : a.isType(w, s.paragraph)
                        ? null
                        : g(e, w, !0, !0);
                      var t, n, i;
                    })())
                  )
                    return (
                      i || (e.undo.register(C), e.refocus()),
                      t && t.preventDefault(),
                      C
                    );
                } else if (O(k)) return H();
                if (
                  ((W = t && (File.isNodeHtml ? t.ctrlKey : t.altKey)),
                  (z = !1),
                  !0 ===
                    (k =
                      "delSelection" == n
                        ? e.selection.getRangy()
                        : (W || (z = e.selection.extendCharFromCollapse(k, !n)),
                          z ||
                            ((T = !0),
                            File.inBusyMode &&
                              setAttributeOnlyNeeded(
                                e.writingArea,
                                "contenteditable",
                                "true"
                              ),
                            n
                              ? (window
                                  .getSelection()
                                  .modify(
                                    "extend",
                                    "forward",
                                    W ? "word" : "character"
                                  ),
                                (k = e.selection.getRangy()))
                              : (window
                                  .getSelection()
                                  .modify(
                                    "extend",
                                    "backward",
                                    W ? "word" : "character"
                                  ),
                                (k = (function (t) {
                                  return t
                                    ? (/\n/.exec(
                                        window.getSelection().toString()
                                      )
                                        ? (k.setStart(k.startContainer, 0),
                                          k.select(k.isBackward))
                                        : (k = e.selection.getRangy()),
                                      k)
                                    : e.selection.getRangy();
                                })(W)))),
                          !n && /^\u200b|\007F$/g.exec(k.toString())
                            ? (e.selection.extendCharFromCollapse(k, !0),
                              O(k) || k)
                            : k)))
                )
                  return H();
                if (
                  (!n && u.tryRemovePairStart(e, k) && (y = !1),
                  "delSelection" == n && k && k.collapsed)
                )
                  return t && t.preventDefault(), r.makeEmptyCommand();
              } else
                !(function (t) {
                  if (e.selection.selectWordTime && File.isMac)
                    if (n)
                      "Delete" == n &&
                        t.endContainer.nodeType === document.TEXT_NODE &&
                        ((i = t.endContainer.textContent.charAt(t.endOffset)),
                        /\s/.exec(i) && (t.endOffset++, (_ = t.cloneRange())));
                    else if (
                      t.startOffset > 0 &&
                      t.startContainer.nodeType === document.TEXT_NODE
                    ) {
                      var i = t.startContainer.textContent.charAt(
                        t.startOffset - 1
                      );
                      /\s/.exec(i) && (t.startOffset--, (_ = t.cloneRange()));
                    }
                })(k);
              var W, z;
              if (
                ((function (e) {
                  e.startContainer.parentElement &&
                    e.startContainer.parentElement.classList.contains(
                      "md-pants"
                    ) &&
                    0 == e.startOffset &&
                    e.setStart(e.startContainer.parentElement, 0);
                })(k),
                y &&
                  (function () {
                    if (
                      !(
                        k.commonAncestorContainer.nodeType !=
                          document.TEXT_NODE ||
                        (0 == n && k.startOffset <= 1) ||
                        ("Delete" == n &&
                          k.endOffset >=
                            k.commonAncestorContainer.textContent.length - 1)
                      )
                    ) {
                      if (File.isNodeHtml && t && t.ctrlKey && !t.shiftKey)
                        return !1;
                      if (e.selection.getRangy().endContainer == k.endContainer)
                        return !0;
                    }
                  })())
              )
                return null;
              if (
                ((e.selection.selectWordTime = null),
                e.selection.deRange(k),
                (b = e.getMarkElem(k.commonAncestorContainer)),
                (w = e.nodeMap.allNodes.get(b.attr("cid"))),
                T &&
                  (window.getSelection().removeAllRanges(),
                  window.getSelection().addRange(S.nativeRange)),
                !b.length || w)
              ) {
                if (b.length && !w.get("children").length) {
                  if (b.get("type") !== s.fences)
                    return (function (e, t, i, l, c) {
                      var d,
                        u = 3 !== i.commonAncestorContainer.nodeType,
                        h = e.getNode(l.attr("cid"));
                      c ||
                        (e.undo.addSnap(h.cid, o.NONE),
                        e.brush.clearAndPause());
                      var f = e.selection.buildUndo(_);
                      if (
                        ((C = r.makeEmptyCommand(f)).undo.push(
                          r.buildReplaceUndo(h)
                        ),
                        !u && f && f.startId == f.endId && a.isType(h, s.line))
                      ) {
                        var m = (
                            l
                              .text()
                              .substring(0, f.start)
                              .match(/\u200b/g) || []
                          ).length,
                          g = (
                            l
                              .text()
                              .substring(0, f.end)
                              .match(/\u200b/g) || []
                          ).length;
                        e.undo.lastSnap &&
                        e.undo.lastSnap.selection.end == f.end &&
                        e.undo.lastSnap.selection.start == f.start
                          ? ((e.undo.lastSnap.selection.start -= m),
                            (e.undo.lastSnap.selection.end -= g))
                          : ((f.start -= m), (f.end -= g));
                      }
                      var v = p.scrollTop(),
                        y = i.commonAncestorContainer;
                      if (!y.contains(document.querySelector("#write"))) {
                        if (y.parentElement.getAttribute("md-inline")) {
                          var b = y.parentElement;
                          1 == l.children().length &&
                            l.children()[0] == b &&
                            (b.textContent.length != i.toString().length ||
                              b.style.display ||
                              (b.style.display = "inline-block"));
                        }
                        if (
                          ((d = i.extractContents()),
                          v != p.scrollTop() && e.undo.clearEventTimer(),
                          e.store(h.cid),
                          C.redo.push(r.buildReplaceUndo(h)),
                          a.isType(h, s.def_link, s.def_footnote)
                            ? e.selection.deRange(i, !0)
                            : h.getText().length ||
                              (e.findElemById(h.cid).html($(h.toHTML()).html()),
                              (i = e.selection.getRangy()),
                              e.selection.deRange(i, !0)),
                          C.redo.push(e.selection.buildUndo()),
                          d.querySelector("img"),
                          i.collapse(!1),
                          u)
                        ) {
                          var w = l.attr("cid");
                          (u = e.selection.saveSelection(l, i)),
                            i.setStart(l[0], 0);
                          var x = (
                            i.toString().match(/(:\u200b)|(\u200b:)/g) || []
                          ).length;
                          e.store(w, !0),
                            l.replaceWith(e.nodeMap.allNodes.get(w).toHTML()),
                            (l = e.findElemById(w)),
                            x &&
                              c &&
                              "delSelection" == n &&
                              ((u.start -= x),
                              (u.end -= x),
                              l.find(".md-emoji-control-ch").text("")),
                            e.selection.restoreSelection(l, u),
                            (e.focusCid = null),
                            e.refocus();
                        }
                        return (
                          e.brush.addToQueue(l.attr("cid")),
                          !c && e.brush.resume(!0),
                          t &&
                            (t.preventDefault(), $("#write").trigger("input")),
                          c || null != t || e.undo.register(C),
                          C
                        );
                      }
                    })(e, t, k, b, i);
                  C = v(e, b, t, i);
                } else
                  t && t.preventDefault(),
                    $(".md-tooltip-remove").remove(),
                    (C = (function (e, t, n) {
                      if (
                        !document.contains(t.startContainer) &&
                        !(t = e.selection.getRangy())
                      )
                        return r.makeEmptyCommand();
                      var i = e.selection.getDetailPos(
                          t.startContainer,
                          t.startOffset
                        ),
                        o = e.selection.getDetailPos(
                          t.endContainer,
                          t.endOffset
                        ),
                        l = e.getMarkElem(i[0]),
                        c = e.getMarkElem(o[0]),
                        d = e.findNodeByElem(l),
                        u = e.findNodeByElem(c);
                      if (!d || !u) return r.makeEmptyCommand();
                      var p = a.getTreePosition(d, u),
                        f = p[1],
                        m = p[2],
                        g = r.makeEmptyCommand(e.selection.buildUndo()),
                        v = t.cloneRange();
                      if (l[0] == c[0]) return g;
                      if (
                        (v.collapse(!0),
                        (v = e.selection.buildUndo(v)),
                        t.setStart(i[0], i[1]),
                        t.setEnd(o[0], o[1]),
                        $(t.commonAncestorContainer).closest('[mdtype="table"]')
                          .length)
                      )
                        return r.append(g, I(e, t));
                      var y = M(e, t, f, g),
                        b = L(e, t, m, g),
                        w = f.get("after"),
                        x = [];
                      for (
                        t = e.selection.getRangy(), e.selection.deRange(t, !0);
                        w && w != m;

                      )
                        x.push(w), (w = w.get("after"));
                      if (
                        (r.addUndoForRemoveArray(g, x, f, m),
                        x.map(function (t) {
                          var n = e.findElemById(t.id);
                          n.attr("mdtype") == s.math_block
                            ? e.mathBlock.beforeDeleteFences(
                                n[0].getAttribute("cid")
                              )
                            : n.find("[mdtype='math_block']").each(function () {
                                e.mathBlock.beforeDeleteFences(
                                  this.getAttribute("cid")
                                );
                              }),
                            n.remove(),
                            t.remove();
                        }),
                        "abort" == y ||
                          "abort" == b ||
                          "abortAndSkipCursor" == y)
                      )
                        "abortAndSkipCursor" != y &&
                          (t.collapse(!0),
                          g.redo.push(v),
                          e.undo.exeCommand(v)),
                          !1 === b &&
                            0 == u.getText().length &&
                            (r.addUndoForRemove(g, u),
                            e.findElemById(u.id).remove(),
                            u.remove());
                      else if (y || b || x.length || n)
                        N(e, y || d, b || u, f, m, g, y);
                      else if ((g = P(e, u, m, d, f)) == h)
                        return r.makeEmptyCommand();
                      return g.redo.push(e.selection.buildUndo()), g;
                    })(e, k, n)),
                    i ||
                      r.isEmptyCommand(C) ||
                      (e.undo.register(C), e.refocus(), e.refresh()),
                    e.selection.scrollAdjust();
                return C;
              }
              window.Reporter.reportLogicError(
                "node to delete not exists in nodemap",
                window.Reporter.processDom(b)
              );
            }
          },
          b = {
            "[mdtype='hr']": y,
            "tr[mdtype='table_row']": l.deleteRow,
            ".md-toc": v,
          },
          w = function (e, t) {
            if (!a.isType(e, s.list_item)) return [];
            var n,
              i = !1;
            if (
              (e.get("before") || e.get("after") || (e = e.get("parent")),
              !(n =
                n ||
                e
                  .getClosetBlock(!0)
                  .getVeryFirstBrotherIncludeTopBlock(!1, !0)))
            ) {
              if (!e.get("before"))
                return r.append(t, g(File.editor, e, !0, !0)), [e];
              (n = e.get("before").getVeryFirst(!0)), (i = !0);
            }
            return (
              editor.findElemById(e.cid).remove(),
              r.addUndoForRemove(t, e),
              e.remove(),
              [n, i]
            );
          },
          x = function (e, t, n) {
            e || File.editor, e.undo.endSnap(!0);
            var i = e.getNode(e.focusCid);
            if (i) {
              var o, l;
              if (
                ((n = n || r.makeEmptyCommand(e.selection.buildUndo())),
                (i = i.getClosetBlock(!1)),
                a.isType(i, s.paragraph) &&
                  !i.get("before") &&
                  !i.get("after") &&
                  i.get("parent") &&
                  (i.get("parent").isVirtualBlock()
                    ? a.isType(i.get("parent"), s.list_item) &&
                      !t &&
                      ((i = i.get("parent")), ([o, l] = w(i, n)))
                    : (i = i.get("parent"))),
                !a.isType(i, s.math_block))
              ) {
                if (
                  (a.isType(i, s.fences)
                    ? File.editor.fences.beforeDeleteFences(i.cid)
                    : a.isType(i, s.math_block) &&
                      File.editor.htmlBlock.beforeDeleteFences(i.cid),
                  !o)
                ) {
                  if (
                    ((o = i
                      .getClosetBlock(!0)
                      .getVeryFirstBrotherIncludeTopBlock(!1)) ||
                      ((o = i
                        .getClosetBlock(!0)
                        .getVeryFirstBrotherIncludeTopBlock(!0)),
                      (l = !0)),
                    !o)
                  )
                    return (
                      r.append(n, g(e, i, !0, !0)), !t && e.undo.register(n), n
                    );
                  e.findElemById(i.cid).remove(),
                    r.addUndoForRemove(n, i),
                    i.remove();
                }
                return (
                  l
                    ? e.selection.jumpIntoElemEnd(e.findElemById(o.cid))
                    : e.selection.jumpIntoElemBegin(e.findElemById(o.cid)),
                  n.redo.push(e.selection.buildUndo()),
                  e.refocus(o.cid),
                  !t && e.undo.register(n),
                  n
                );
              }
              File.editor.mathBlock.remove(i.cid);
            }
          };
        (t.backspaceHandler = y),
          (t.deleteSelectable = v),
          (t.deleteLineProcessor = b),
          (t.deleteLine = function (e) {
            e.undo.endSnap(!0);
            var t = $(document.activeElement).closest(".CodeMirror");
            if (t.length) t[0].CodeMirror.execCommand("deleteLine");
            else {
              var n,
                i = e.getMarkElem();
              if (i && i.length) {
                for (n in b)
                  if (i.closest(n).length) return void b[n](e, i.closest(n));
                var r = e.selection.getRangy().getBookmark(i[0]).start,
                  o = e.findNodeByElem(i);
                a.isEmptyBlock(o)
                  ? x(e)
                  : (function (t, n) {
                      var i = t.hasClass("md-expand");
                      t.addClass("md-expand"),
                        n &&
                          window
                            .getSelection()
                            .modify("move", "backward", "sentence"),
                        window
                          .getSelection()
                          .modify("extend", "forward", "sentence"),
                        i && t.removeClass("md-expand"),
                        y(e, null, "delSelection");
                    })(i, !!r);
              }
            }
          }),
          (t.deleteBlock = x),
          (t.backToParagraph = g);
      }
    ),
    $__System.registerDynamic(
      "5e",
      [
        "11",
        "13",
        "1b",
        "1d",
        "19",
        "46",
        "52",
        "2c",
        "49",
        "17",
        "32",
        "5d",
        "29",
      ],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("13"),
          o = e("1b"),
          a = r.Node,
          s = r.TYPE,
          l = r.NodeCollectionUtils,
          c = (e("1d"), e("19")),
          d = e("46"),
          u = e("52"),
          h = e("2c"),
          p = (e("49"), e("17")),
          f = (e("32"), e("5d")),
          m = e("29"),
          g = window.reqnode ? reqnode("electron") : null,
          v = f.backspaceHandler,
          y = function (e) {
            return (
              a.isEmptyBlock(e) ||
              (a.isType(e, s.list_item) &&
                1 == e.get("children").length &&
                a.isEmptyBlock(e.getFirstChild()))
            );
          },
          b = function (e, t, n, r, l, d) {
            if ((t = t || ((h = e.getMarkElem()), e.getNode(h.attr("cid"))))) {
              var u = e.getJQueryElem(window.getSelection().anchorNode),
                h = e.findElemById(t.id);
              a.noChangeLine(t) && (n = n.trim().split(/[\n\r]+/gi)[0]),
                "\n" == n && h.text().length <= r && (n = "\n​"),
                l && l.undo.push(o.buildReplaceUndo(t, void 0));
              var p = u.closest(".md-def-link, .md-def-footnote").length,
                f = "";
              if (p && u.hasClass("md-def-name"))
                (h = u.closest("[cid]")),
                  e.selection
                    .getRangy()
                    .insertNode(document.createTextNode(i.escape(n))),
                  t.set("ref", u.text());
              else if (p && u.hasClass("md-def-url"))
                (h = u.closest("[cid]")),
                  (n = n.replace(/\s/gi, "")),
                  e.selection
                    .getRangy()
                    .insertNode(document.createTextNode(i.escape(n))),
                  t.set("href", u.text());
              else if (p && u.hasClass("md-def-title"))
                (h = u.closest("[cid]")),
                  e.selection
                    .getRangy()
                    .insertNode(document.createTextNode(i.escape(n))),
                  t.set("title", u.text());
              else {
                var m,
                  g = r;
                if (
                  u.hasClass("md-meta-block") &&
                  0 == u.text().length &&
                  "\n​" == n
                )
                  m = "\n\n";
                else {
                  if (
                    (u.hasClass("md-meta-block") &&
                    f.length == r &&
                    "\n" == f[r - 1]
                      ? r--
                      : p && u.closest(".md-def-content").length
                      ? ((g -= (t.get("ref") || "").length + 1),
                        (f = u.closest(".md-def-content").rawText()))
                      : ((f = h.rawText()),
                        a.isType(t, s.meta_block) &&
                          (f = f.replace(/\n$/, ""))),
                    u.hasClass("md-meta-block") && "\t" == n)
                  ) {
                    var v = f.substring(0, g);
                    (v && !/\n\s*$/.exec(v)) ||
                      (n = " ".repeat(File.option.indentSize));
                  }
                  m =
                    void 0 !== g
                      ? f.substring(0, g) + n + f.substring(g)
                      : f.text() + n;
                }
                t.set("text", m.replace(/\u200B/g, "")),
                  h.html($(c.renderHtmlWithBlockMeta(t, e.brush)).html());
              }
              l && (e.store(t, !0), l.redo.push(o.buildReplaceUndo(t, void 0)));
              var y = { id: t.id, type: "cursor", start: r + n.length };
              if (((h = e.findElemById(t.id)), d)) {
                var b = f.match(/\u200b:|:\u200b/);
                b || h.find(".md-emoji-control-ch").text(""),
                  e.undo.exeCommand(y),
                  b || h.find(".md-emoji-control-ch").text("​"),
                  e.brush.addToQueue(t.id),
                  (y = e.selection.buildUndo());
              }
              l && l.redo.push(y),
                e.brush.addToQueue(t.id),
                d && h.addClass("md-focus"),
                h.length && e.refreshUnder(h[0]);
            }
          },
          w = function (e, t, n, r, a) {
            if (File.isMac)
              !(function (e, t, n, r) {
                var o = {};
                i.isDefined(e) && (o["text/html"] = E(e)[0]),
                  i.isDefined(t) && (o["text/markhtml"] = t),
                  i.isDefined(n) && (o["text/plain"] = n),
                  JSBridge.clipboard.writeForMac(o, r);
              })(e, t, n, r);
            else if (File.isNode)
              if (a) {
                if (
                  "cut_before" === File._CopyContentFlag ||
                  ("cut" == a.type && e)
                ) {
                  if (!e)
                    return (
                      JSBridge.invoke("webContents.copy"),
                      void (File._CopyContentFlag = "cut_after")
                    );
                  v(File.editor, null, "delSelection"),
                    (File._CopyContentFlag = !1);
                } else if ("cut_after" === File._CopyContentFlag) {
                  (File._CopyContentFlag = !1),
                    (e = (E(g.clipboard.readHTML()) || [])[0]);
                  let t =
                      File._CopyContentRange &&
                      editor.selection.buildUndo(File._CopyContentRange),
                    n = v(File.editor, null, "delSelection");
                  if (File._CopyContentRange) {
                    if (n) {
                      n.undo.unshift(t);
                      let e = v(editor, null, !0, !0);
                      e && o.append(n, e);
                    } else v(editor, null, !0);
                    File._CopyContentRange = null;
                  }
                } else if (e && !File._CopyContentFlag);
                else {
                  if (!File._CopyContentFlag)
                    return (
                      (File._CopyContentFlag = !0),
                      void (!e && JSBridge.invoke("webContents.copy"))
                    );
                  !0 !== File._CopyContentFlag ||
                    (null !== e && void 0 != e) ||
                    (e = (E(g.clipboard.readHTML() || e) || [])[0] || ""),
                    !t &&
                      /^markhtml\|/.exec(File._CopyContentFlag + "") &&
                      (t = File._CopyContentFlag.substring("markhtml|".length)),
                    (File._CopyContentFlag = !1);
                }
                !(function (e, t, n, i, r) {
                  null != n
                    ? r.clipboardData.setData("text/plain", n)
                    : i && r.clipboardData.setData("text/plain", ""),
                    null != e
                      ? r.clipboardData.setData("text/html", e)
                      : i && r.clipboardData.setData("text/html", ""),
                    null != t
                      ? r.clipboardData.setData("text/markhtml", t)
                      : i && r.clipboardData.setData("text/markhtml", "");
                })(e, t, n, r, a),
                  a.preventDefault();
              } else
                JSBridge.invoke(
                  "clipboard.write",
                  JSON.stringify({ html: E(e)[0] || n, text: n }),
                  r || !1
                ),
                  t
                    ? ((File._CopyContentFlag = "markhtml|" + t),
                      JSBridge.invoke("webContents.copy"))
                    : (File._CopyContentFlag = !1);
          },
          x = function (e, t, n) {
            e = e || File.editor;
            var i = document.activeElement,
              r = e.selection.getRangy();
            if (e.sourceView.inSourceMode)
              w(null, null, File.editor.sourceView.cm.getSelection(), !0, t);
            else if ("HR" == i.getAttribute("mdtype"))
              w(null, null, "---", !0, t);
            else if (
              i.getAttribute("mdtype") !== s.math_block ||
              (r && !r.collapsed)
            ) {
              if (isInputComponent(i) || void 0 !== i.tabindex)
                w(null, null, i.value || i.textContent, !0, t);
              else if (window.getSelection().rangeCount) {
                var o, a;
                r.collapsed &&
                  (o = (o = $(r.startContainer).closest(".md-table-fig")).length
                    ? u.getMarkElemFromCurrentHtml(o[0].outerHTML, e)
                    : null),
                  o || (o = u.getMarkElemFromCurrentHtml(r.toHtml(), e)),
                  (a = o.html()),
                  w(
                    null,
                    n ? null : a,
                    n ? T(a).replace(/\u200B/gi, "") : A(a),
                    !0,
                    t
                  );
              }
            } else
              w(
                null,
                null,
                "$$\n" + e.mathBlock.getTex(i.getAttribute("cid")) + "\n$$",
                !0,
                t
              );
            File._CopyContentFlag = !1;
          };
        function C(e, t, n) {
          var i,
            r = u.getMarkElemFromCurrentHtml(e, t),
            o = _((i = r.html()), void 0, void 0, void 0, !0);
          return [
            t.export.exportCollection(o, null, {
              forPrint: !1,
              noStyle: !0,
              exportFooter: !0,
              prettyForRendering: n,
              split: "\n",
            }),
            i,
            r
              .find(".md-fences,.md-heading,p,figure")
              .after("\n\n")
              .end()
              .text()
              .replace(/\n\n$/, ""),
          ];
        }
        var F = function (e, t) {
            x(e, t, !0);
          },
          S = function (e, t) {
            e = e || File.editor;
            var n = document.activeElement,
              r = e.selection.getRangy();
            if (e.sourceView.inSourceMode)
              w(null, null, File.editor.sourceView.cm.getSelection(), !0, t);
            else if ("HR" == n.getAttribute("mdtype"))
              w(null, null, "<hr/>", !0, t);
            else if (
              n.getAttribute("mdtype") !== s.math_block ||
              (r && !r.collapsed)
            ) {
              if (isInputComponent(n) || 0 == n.childElementCount) {
                if (
                  n.classList.contains("md-content") &&
                  r.toString() == n.textContent
                ) {
                  var o = $(n).closest(".md-image");
                  if (o.length) {
                    var a = C(o[0].outerHTML, e)[0];
                    return void w(
                      null,
                      "<pre mdtype='fences' lang='HTML'>" +
                        i.escape(a) +
                        "</pre>",
                      a,
                      !0,
                      t
                    );
                  }
                }
                w(null, null, n.value || n.textContent, !0, t);
              } else if (window.getSelection().rangeCount) {
                a = C(r.toHtml(), e)[0];
                w(
                  null,
                  "<pre mdtype='fences' lang='HTML'>" + i.escape(a) + "</pre>",
                  a,
                  !0,
                  t
                );
              }
            } else
              w(
                null,
                null,
                "$$\n" + e.mathBlock.getTex(n.getAttribute("cid")) + "\n$$",
                !0,
                t
              );
          },
          k = function (e, t) {
            e = e || File.editor;
            var n,
              i,
              r = document.activeElement,
              o = e.selection.getRangy();
            if (e.sourceView.inSourceMode)
              w(null, null, File.editor.sourceView.cm.getSelection(), !0, t);
            else if ("HR" == r.getAttribute("mdtype")) {
              var a = e.getNode(r.getAttribute("cid"));
              w("<hr/>", null, a.get("text"), !0, t);
            } else if (
              r.getAttribute("mdtype") !== s.math_block ||
              (o && !o.collapsed)
            )
              if (isInputComponent(r) || 0 == r.childElementCount) {
                if (r.classList.contains("md-content"))
                  if (o.toString() == r.textContent)
                    if ($(r).closest(".md-image").length)
                      return (
                        (i = C(o.toHtml(), e, !0)),
                        void w(i[0], i[1], i[2], !0, t)
                      );
                w(
                  r.value || r.textContent,
                  null,
                  r.value || r.textContent,
                  !0,
                  t
                );
              } else
                window.getSelection().rangeCount &&
                  ((i = C(o.toHtml(), e, !0)), w(i[0], i[1], i[2], !0, t));
            else {
              n = r.getAttribute("cid");
              var l = e.getNode(n);
              w(
                e.export.getSVGForExport(l, !1),
                "$$\n" + e.mathBlock.getTex(n) + "\n$$",
                "$$\n" + e.mathBlock.getTex(n) + "\n$$",
                !0,
                t
              );
            }
          },
          E = function (e) {
            if (!e) return ["", ""];
            File.isMac &&
              (e.match(/<\/p>/g) || []).length -
                (e.match(/<p/g) || []).length ==
                1 &&
              (e = "<p>" + e);
            var t = $.parseHTML("<div>" + e + "</div>"),
              n = "<!DOCTYPE html>",
              i = "<!DOCTYPE html>",
              r = File.option.showLineNumbersForFence ? "&nbsp;" : "";
            if (!t.length) return ["", ""];
            var o = $(t[0]),
              a = o.find(".md-emoji");
            a.text(function (e) {
              return $(a[e]).children("[data-emoji]").attr("data-emoji");
            }),
              o.find(".md-pants").text(function () {
                return this.dataset.content;
              }),
              o
                .find(
                  ".ty-table-edit, .md-meta, .md-content, .md-rawblock-tooltip, .md-tooltip-hide, span p, .md-meta-none, .md-reverse-footnote-area"
                )
                .remove(),
              o.find("[cid].md-fences").html(function () {
                var e = $(this);
                e.children("[cid]").each(function () {
                  e.after(this);
                });
                var t = this.querySelectorAll("pre.CodeMirror-line");
                if (t.length) {
                  for (var n = [], i = 0; i < t.length; i++)
                    t[i].innerHTML && n.push(r + t[i].innerHTML);
                  return n.join("<br/>");
                }
                return this.innerHTML;
              }),
              o
                .find(
                  "p, h1, h2, h3, h4, h5, h6, .md-def-link, .md-def-footnoote"
                )
                .css("width", ""),
              o.find(".md-br").text("\n"),
              o.find(".md-def-name").before("[").after("]   "),
              o.find(".task-list-item > p").replaceWith(function () {
                return (
                  (this.previousElementSibling &&
                  "INPUT" == this.previousElementSibling.tagName
                    ? " "
                    : "") +
                  this.innerHTML +
                  (this.nextSibling ? "\n" : "")
                );
              }),
              o.find(".md-entity").text(function () {
                return this.dataset.content;
              }),
              o.find("[contenteditable]").removeAttr("contenteditable");
            var s = location.href.replace(/[^\/\\]+.html/, "");
            return (
              o.find("a").attr("href", function (e, t) {
                return t && 0 == t.indexOf(location.href)
                  ? t.substr(location.href.length)
                  : t && 0 == t.indexOf(s)
                  ? t.substr(s.length)
                  : t;
              }),
              o.find("img[data-real-src]").attr("src", function () {
                return this.dataset.realSrc;
              }),
              o
                .find(".mathjax-block")
                .addBack(".mathjax-block")
                .html("$$<br /><span></span><br />$$")
                .find("span")
                .text(function () {
                  try {
                    return File.editor
                      .getNode(this.parentElement.getAttribute("cid"))
                      .get("text");
                  } catch (e) {
                    return "";
                  }
                })
                .end()
                .after("<br />"),
              o.find(".md-inline-math").text(function () {
                var e = this.getAttribute("id"),
                  t = document.querySelector("#" + e);
                return (t && (t.querySelector("script") || {}).innerText) || "";
              }),
              (n += o.html()),
              o.find(".md-toc").remove(),
              o.find("li p").replaceWith(function () {
                return this.innerHTML + (this.nextSibling ? "\n" : "");
              }),
              o
                .find(
                  "ul, ol, .md-def-link, .md-toc, .md-def-footnoote, blockquote, .md-fences, .mathjax-block"
                )
                .after("<br/><br/>"),
              o.find(".md-def-name").before("[").after("]   "),
              [n, (i += o.html())]
            );
          };
        function T(e) {
          var t = u.getBlocksFromMarkHtml(e, null, !0);
          return "string" == typeof t ? t : u.convertToPlain(t);
        }
        function _(e, t, n, i, r) {
          return u.getBlocksFromMarkHtml(e, t, !1, r);
        }
        function A(e) {
          var t = _(e, void 0, 0, 0, !0);
          return "string" == typeof t ? t : a.markFromArr(t);
        }
        var M,
          L = function (e, t, n, r) {
            var f,
              m = "";
            if (((File._PasteContentFlag = !1), (e = e || File.editor))) {
              "function" == typeof r && (B = r);
              var g,
                w = "string" != typeof t || n ? null : t,
                x = "string" == typeof t && n ? t : null,
                C = "object" == typeof t ? t : null;
              if (
                (C && C.commonHtml
                  ? ((w = C.commonHtml), (C = null))
                  : C && C.markhtml && ((g = C.markhtml), (C = null)),
                "INPUT" == document.activeElement.tagName ||
                  (document.activeElement.classList &&
                    document.activeElement.classList.contains("ty-input")))
              )
                return !0;
              if ("TEXTAREA" == document.activeElement.tagName) {
                if (!C && x) {
                  var F = $(document.activeElement).closest(".CodeMirror");
                  F && (F = F[0].CodeMirror).replaceSelection(x);
                }
                return !0;
              }
              if (a.isType(A, s.hr)) return !1;
              if ("BODY" == document.activeElement.tagName) return !1;
              var S,
                k,
                E =
                  e.UserOp.backspaceHandler(e, null, "delSelection", !0, !1) ||
                  o.makeEmptyCommand(),
                T = e.getMarkElem(),
                A = e.findNodeByElem(T),
                M = { markhtml: g, html: w, text: x };
              C
                ? (C.preventDefault(), JSBridge.clipboard.read(C, M).then(H))
                : M.html || M.text || M.markhtml
                ? H(M)
                : JSBridge.clipboard.read(null, M).then(H);
            }
            function L(e, t) {
              return e.get("attr") && e.get("attr").trim().length
                ? e.get("attr")
                : void 0;
            }
            function D(e) {
              return a.isType(
                e,
                a.TYPE.paragraph,
                a.TYPE.heading,
                a.TYPE.raw_edit,
                a.TYPE.fences,
                a.TYPE.table_cell
              )
                ? e.get("text")
                : (!a.isType(e, s.def_footnote) || (L(e) && L(e))) &&
                  (!a.isType(e, s.def_link) || (L(e) && L(e)))
                ? e
                    .get("children")
                    .toArray()
                    .reduce(function (e, t) {
                      return e + D(t);
                    }, " ")
                : L(blocks[0]) ||
                  L(blocks[0]) ||
                  L(blocks[0]) ||
                  L(blocks[0]) ||
                  "";
            }
            function B(t, n, i, o, a) {
              if (!r)
                try {
                  var s = e.selection.restoreEdge(e.findElemById(t), n);
                  void 0 !== o
                    ? (s = e.selection.restoreEdge(e.findElemById(i), o, !0, s))
                    : s.setEndAfter(
                        e.findElemById(i)[0] || e.findElemById(t)[0]
                      ),
                    e.imgEdit.tryMoveImageInRange(s, !0),
                    e.stylize.putBookmark(
                      null,
                      e.stylize.buildBookmark(e.findElemById(i))
                    ),
                    $(e.sessionStr).trigger("cursorChange", e.styleBookmark);
                } catch (e) {
                  console.error(e);
                }
            }
            function R(t, n, i, r, l, c) {
              i.undo.push(e.selection.buildUndo());
              var d = l(r, e.nodeMap, e, m, f);
              if ("string" == typeof d) return I(t, n, d || c || "", i);
              if (1 == d.length && n) {
                let e = (function e(t) {
                  var n = t.get("children").length;
                  return n
                    ? 1 == n
                      ? e(t.getFirstChild())
                      : "\n\n\n"
                    : t.get("text") || "";
                })(d[0]);
                if (-1 == e.indexOf("\n")) return I(t, n, e, i);
              } else if (0 == d.length) return;
              if (a.isType(t, s.table_cell))
                !(function (t, n, i, r) {
                  var l = e.tableEdit.TableEdit;
                  function c(e, t, n, i) {
                    var r = e.safeGetStrAttr("text"),
                      o = D(n).replace(/\r?\n/g, " ");
                    return (
                      e.set("text", r.substr(0, t) + o + r.substr(t)),
                      t + o.length
                    );
                  }
                  var d,
                    u = t.get("parent").get("parent"),
                    h = t,
                    p = h;
                  r.undo.push(o.buildReplaceUndo(u));
                  var f = [],
                    m = [];
                  i.forEach(function (e, t) {
                    e.get("type") == s.table
                      ? (m = m.concat(
                          (function (e) {
                            function t(e) {
                              for (var t = e.getFirstChild(), n = []; t; )
                                n.push(t), (t = t.get("after"));
                              return n;
                            }
                            for (var n = [], i = e.getFirstChild(); i; )
                              n.push(t(i)), (i = i.get("after"));
                            return n;
                          })(e)
                        ))
                      : 0 == m.length
                      ? ((m = [f]), f.push(e))
                      : 1 == m.length && f.push(e);
                  });
                  for (
                    var g = t.get("parent"),
                      v = l.getColumnIndex(t),
                      y = Math.min(m[0].length, g.get("children").length - v),
                      b = 0;
                    b < m.length;
                    b++
                  ) {
                    f = m[b];
                    for (var w = 0; w < f.length && h; w++)
                      (d = c(h, 0 === b && 0 === w ? n : 0, f[w])),
                        (p = h),
                        (h = a.isType(f[w], s.table_cell)
                          ? l.getSibling(h, !1, !0)
                          : l.getNextCellInColumn(h));
                    if (!(g = g.get("after"))) break;
                    0 == b &&
                      m.length > 1 &&
                      ((v -= Math.max(0, m[1].length - y)),
                      (v = Math.max(v, 0))),
                      (h = l.getCellAt(g, v));
                  }
                  e.findElemById(u.id).replaceWith(u.toHTML()),
                    r.redo.push(o.buildReplaceUndo(u)),
                    void 0 !== d
                      ? e.selection.jumpInto(e.findElemById(p.id), d)
                      : e.selection.jumpIntoElemEnd(e.findElemById(p.id)),
                    r.redo.push(e.selection.buildUndo());
                })(t, n, d, i);
              else if (a.isType(t, s.table_row, s.table));
              else {
                a.isType(t.get("parent"), s.list_item)
                  ? i.undo.push(e.undo.buildReplaceUndo(t.get("parent")))
                  : i.undo.push(e.undo.buildReplaceUndo(t));
                var u = t === e.nodeMap.getFirst() && 0 === n,
                  h = [];
                d.map(function (e, t) {
                  a.isType(e, s.meta_block) && (0 != t || !u) && h.push(e);
                }),
                  h.map(function (e) {
                    d.remove(e);
                  });
                var p = a.splitAt(t, n, e, !1, !0, !0);
                if (!p) return void e.undo.register(i);
                if (
                  (O(p.prev, p.next, d, i, p.insertArray, t),
                  p.prev && d.last())
                )
                  try {
                    var g = p.prev.isDeleted() ? d[0] : p.prev,
                      v = d.last();
                    !p.prev.isDeleted() &&
                      a.isType(p.prev, s.list_item) &&
                      (v.isDeleted() || p.prev.contains(d.last())) &&
                      (g = p.prev.getVeryFirst()),
                      B(g.getVeryFirst(!0, !1).cid, n, d.last().cid, void 0);
                  } catch (e) {
                    window.Reporter.error(e);
                  }
              }
              e.undo.register(i);
            }
            function P(t, n, i, r, l) {
              if (t && !t.isDeleted() && n && !n.isDeleted()) {
                var c,
                  d = t.canContainBlock() ? t.getLastChild() : t,
                  u = n.canContainBlock() ? n.getFirstChild() : n;
                if (
                  e.stylize.canContainInline(d) &&
                  e.stylize.canContainInline(u) &&
                  !a.isType(d, s.table_cell) &&
                  !a.isType(u, s.table_cell)
                ) {
                  c = d.get("text").length;
                  var h = d.get("text") + u.get("text");
                  l && !c && d.copyContentFrom(u), d.set("text", h);
                  var p = (function e(t) {
                    if (t && !t.isDeleted()) {
                      var n = t.get("parent");
                      return n
                        ? t.get("before") || t.get("after")
                          ? t
                          : e(n)
                        : t;
                    }
                  })(u);
                  return (
                    i && o.addUndoForRemove(i, p),
                    p.remove(),
                    r.remove(p),
                    n.isDeleted() ||
                      (a.isType(n, s.list_item) &&
                        a.isType(t, s.list_item) &&
                        (i && i.undo.push(o.buildReplaceUndo(t)),
                        t.getLastChild().addAfterTillEnd(n.getFirstChild()),
                        i && o.addUndoForRemove(i, n),
                        n.remove(),
                        r.remove(n))),
                    i && i.redo.push(o.buildReplaceUndo(t)),
                    c
                  );
                }
              }
            }
            function I(t, n, i, r) {
              var l = (i = i
                .replace(/\u00a0/g, " ")
                .replace(/\u200b/g, "")
                .replace(/^[\r\n]+/g, "")
                .replace(/[\r\n]+$/g, "")).split(/\r?\n/g);
              if (
                (l.length > 1 &&
                  !l[0].trim().length &&
                  l[1].trim().length &&
                  (l = l.slice(1)),
                a.isType(t, s.table_cell))
              )
                return (function (t, n, i, r) {
                  r.undo.push(e.selection.buildUndo()),
                    (i = i
                      .replace(/^\s*(\r?\n)+/, "")
                      .replace(/^\s*(\r?\n)+$/, "")
                      .replace(/(^\s*\|)|(\|\s*)/g, "|"));
                  var a = null;
                  /\|/.exec(i) && (a = /\s*\|\s*/);
                  var s,
                    l = t.get("parent"),
                    u = "npTable" == l.get("parent").get("style"),
                    h = l.get("children").length,
                    p = t;
                  if (a) {
                    var f = i.split(/\n/).filter(function (e) {
                        return e.length;
                      }),
                      m = d.getColumnIndex(t);
                    f.map(function (i, a) {
                      if (l && !/^[-\s:|]+$/.exec(i)) {
                        var d = c.splitTableCell(i, u, h) || [i];
                        "" == d[0] && (d = d.subarray(1)),
                          "" == d.last() && (d = d.subarray(0, d.length - 1));
                        var f = l.getNthChild(m);
                        d.map(function (e, i) {
                          f &&
                            (r.undo.push(o.buildReplaceUndo(f)),
                            0 == a && 0 == i
                              ? (t.set(
                                  "text",
                                  t.get("text").substring(0, n) +
                                    e +
                                    t.get("text").substring(n)
                                ),
                                (s = n + e.length))
                              : (i == d.length - 1
                                  ? f.set("text", e + f.get("text"))
                                  : f.set("text", e),
                                (p = f),
                                (s = e.length)),
                            r.redo.push(o.buildReplaceUndo(f)),
                            (f = f.get("after")));
                        }),
                          e.findElemById(l.id).replaceWith(l.toHTML()),
                          (l = l.get("after"));
                      }
                    });
                  } else
                    r.undo.push(o.buildReplaceUndo(t)),
                      (i = i
                        .replace(/<br\/?>/g, "\n")
                        .replace(/\r?\n/g, "<br/>")),
                      t.set(
                        "text",
                        t.get("text").substring(0, n) +
                          i +
                          t.get("text").substring(n)
                      ),
                      r.redo.push(o.buildReplaceUndo(t)),
                      e.findElemById(t.id).replaceWith(t.toHTML()),
                      (s = n + i.length);
                  var g = e.findElemById(p.cid);
                  e.selection.jumpInto(g, s),
                    r.redo.push(e.selection.buildUndo()),
                    e.undo.register(r),
                    g.length && e.refreshUnder(g[0]),
                    B(t.cid, 0, p.cid, p.get("text").length);
                })(t, n, i, r);
              if (
                (a.noChangeLine(t) && (l = [l[0]]),
                l.length <= 1 || h.CONST.NoInline.indexOf(t.get("type")) > -1)
              )
                (i = l.join("\n")),
                  b(e, t, i, n, r, !0),
                  (function (e, t, n, i, r) {
                    if (
                      a.isType(t, s.paragraph) &&
                      p.BLOCK_OPEN_REG.exec(n) &&
                      p.BLOCK_OPEN_REG.exec(t.get("text"))
                    ) {
                      var l = r.redo.last(),
                        c = t.parseFrom({
                          skips: { old_code: !1, pass_format: !0 },
                        });
                      r.redo.push(o.buildReplaceUndo(t)),
                        o.addUndoForInsertArray(r, c[1].subarray(1));
                      var d = c[1].last().getVeryFirst(!0),
                        u = l.end || n.length + i;
                      e.findElemById(t.id).replaceWith(c[0]),
                        e.selection.jumpInto(e.findElemById(d.cid), u),
                        r.redo.push(e.selection.buildUndo());
                    }
                  })(e, t, i, n, r);
              else {
                if (
                  (r.undo.push(e.selection.buildUndo()),
                  a.isType(t, s.paragraph) &&
                  a.isType(t.get("parent"), s.list_item)
                    ? r.undo.push(o.buildReplaceUndo(t.get("parent")))
                    : r.undo.push(o.buildReplaceUndo(t)),
                  a.isType(t, s.paragraph) &&
                    !a.isType(t.get("parent"), s.list_item))
                )
                  return (function (t, n, i, r) {
                    var a = t.get("text");
                    t.set("text", a.substring(0, n) + i + a.substring(n));
                    var s = t.parseFrom({
                      skips: { old_code: !1, pass_format: !0 },
                    });
                    r.redo.push(o.buildReplaceUndo(t)),
                      o.addUndoForInsertArray(r, s[1].subarray(1)),
                      e.findElemById(t.id).replaceWith(s[0]);
                    var l = s[1].last().getVeryFirst(!0),
                      c = Math.max(l.get("text").length - (a.length - n), 0);
                    e.selection.jumpInto(e.findElemById(l.cid), c),
                      r.redo.push(e.selection.buildUndo()),
                      e.undo.register(r),
                      (e.focusCid = l.cid),
                      e.refresh(),
                      B(t.cid, 0, l.cid, l.get("text").length);
                  })(t, n, i, r);
                var u = a.splitAt(t, n, e);
                if (!u) return void e.undo.register(r);
                var f = a.parseFrom(
                  l.join("\n"),
                  t.get("in"),
                  {
                    noTop: !u.prev.get("attachTo"),
                    skips: { old_code: !1, pass_format: !0 },
                  },
                  !0
                );
                a.isType(u.prev, s.list_item) &&
                  r.undo.push(o.buildReplaceUndo(u.prev)),
                  O(u.prev, u.next, f[1], r, u.insertArray, t);
              }
              e.undo.register(r), B(t.cid, n, t.cid, n + i.length, r);
            }
            function O(t, n, i, r, c, d) {
              var u,
                p = d.id,
                f = -1;
              (i = (function (e) {
                for (var t = [], n = -2, i = 0; i < e.length; i++) {
                  var r = e[i];
                  a.isType(r, s.table_cell)
                    ? (n !== i - 1
                        ? (r.set("type", s.paragraph), t.push(r))
                        : (t
                            .last()
                            .set(
                              "text",
                              t.last().get("text") + "  " + r.get("text")
                            ),
                          r.remove()),
                      (n = i))
                    : t.push(r);
                }
                return t;
              })(
                (i = (function (e) {
                  var t,
                    n,
                    i = [];
                  if (
                    (e.map(function (e) {
                      a.isType(e, s.list_item)
                        ? ((n = !0),
                          t ||
                            ((t = new a({ type: t, in: e.get("in") })),
                            i.push(t)),
                          t.appendChild(e))
                        : ((t = null), i.push(e));
                    }),
                    n)
                  ) {
                    console.log("group list items");
                    var r = e[0].get("before"),
                      o = e.last().get("after"),
                      l = e[0].get("parent");
                    if (r) r.addArrayAfter(i, !0);
                    else if (o) o.addArrayBefore(i, !0);
                    else if (l) i.forEach((e) => l.appendChild(e));
                    else {
                      var c;
                      i.forEach((e) => {
                        c && c.addAfter(e), (c = e);
                      });
                    }
                  }
                  return i;
                })(i))
              )),
                (u = i.last().getVeryFirst(!0));
              var m = (c = c || [n]).indexOf(n),
                g = !1;
              if (
                (y(n)
                  ? (c.remove(n), n.remove(), (g = !0))
                  : a.isType(u, h.CONST.Selectable) && (u = n),
                !a.isType(t, s.blockquote, s.list) &&
                  !a.isType(i[0], s.list_item))
              ) {
                if (a.isType(t, s.list_item))
                  !(function (t, n, c) {
                    var d = t.get("parent");
                    a.isType(i[0], s.list) ||
                      (function () {
                        var e = d.clone();
                        if (a.isType(i[0], s.list_item))
                          i.forEach((e) => {
                            if (a.isType(e, s.list_item)) d.appendChild(e);
                            else {
                              let t = new a({ type: s.list_item });
                              d.appendChild(t), t.appendChild(e);
                            }
                          });
                        else {
                          var t = new a({ type: s.list_item });
                          e.appendChild(t),
                            i.forEach((e) => {
                              t.appendChild(e);
                            });
                        }
                        i = [e];
                      })(),
                      (p = t.id),
                      r.undo.push(o.buildAttrUndo(d, "tail")),
                      t.addAfter(i[0]);
                    var h = i.shift().unwrap();
                    (c && !y(t)) ||
                      (void 0 != P(t, h[0], null, [], c) && h.splice(0, 1)),
                      n.isDeleted() || i.length || P(h.last(), n, null, []),
                      n.isDeleted() || h.push(n),
                      r.redo.push(o.buildReplaceUndo(t));
                    var f = a.genArrFrom(t);
                    if (
                      (o.addUndoForInsertArray(r, h),
                      e
                        .findElemById(t.cid)
                        .replaceWith(l.toHTML([t].concat(h))),
                      u.isDeleted() && (u = n),
                      i.length)
                    )
                      if (
                        (d.unset("tail"),
                        n.isDeleted() && (n = (n = h.last()) && n.get("after")),
                        n)
                      ) {
                        var m = d.clone();
                        m.unset("start"), m.unset("ahead");
                        var g = a.genArrFrom(n);
                        o.addUndoForRemoveArray(r, g),
                          m.appendChildrenTillEnd(n),
                          d.addAfter(m),
                          d.addArrayAfter(i),
                          (f = i.concat([m])),
                          o.addUndoForInsertArray(r, f),
                          e
                            .findElemById(d.cid)
                            .replaceWith(l.toHTML([d].concat(f))),
                          u.isDeleted() && (u = n);
                      } else
                        d.addArrayAfter(i),
                          o.addUndoForInsertArray(r, i),
                          e.findElemById(d.cid).after(l.toHTML(i));
                  })(t, n, g);
                else {
                  var v = t.getVeryFirst(!0);
                  v.addArrayAfter(i),
                    m > -1 && c.splice.apply(c, [m, 0].concat(i)),
                    o.addUndoForInsertArray(r, c);
                  var b = i.length > 1;
                  a.isEmptyBlock(v)
                    ? (o.addUndoForRemove(r, v),
                      v.remove(),
                      (b = a.isEmptyBlock(i.last())))
                    : ((b = !1), P(v, i.shift(), r, c)),
                    n.isDeleted() ||
                      (a.isEmptyBlock(n)
                        ? (o.addUndoForRemove(r, n), n.remove())
                        : (f = i.length
                            ? P(i.last(), n, r, c, b)
                            : P(t, n, r, c))),
                    (u = i.last() || t) &&
                      !u.isDeleted() &&
                      (u = u.getVeryFirst(!0)),
                    d.isDeleted() || r.redo.push(o.buildReplaceUndo(d));
                  var w =
                    (d.isDeleted() ? "" : d.toHTML()) +
                    c
                      .map(function (e) {
                        return e.isDeleted() ? "" : e.toHTML();
                      })
                      .join("");
                  e.mathBlock.beforeRenderMath(),
                    e.findElemById(p).replaceWith(w);
                }
                a.isType(u, h.CONST.Selectable) &&
                  (n && !n.isDeleted() && (u = n), (f = -1));
                try {
                  f >= 0
                    ? e.selection.jumpInto(e.findElemById(u.cid), f)
                    : u == n
                    ? e.selection.jumpIntoElemBegin(e.findElemById(n.cid))
                    : u.isDeleted()
                    ? e.selection.jumpIntoElemBegin(e.findElemById(n.cid))
                    : e.selection.jumpIntoElemEnd(
                        e.findElemById(u.getVeryFirst(!0).cid)
                      ),
                    u.isDeleted() || r.redo.push(e.selection.buildUndo());
                } catch (e) {
                  console.warn(e);
                }
                e.tryEnterBusyMode(),
                  setTimeout(function () {
                    e.refocus(), e.refresh();
                  }, 0),
                  setTimeout(function () {
                    e.selection.scrollAdjust();
                  }, 100);
              }
            }
            function H(t) {
              if (
                (E.undo.push(e.selection.buildUndo()),
                (E = o.append(E, v(e, C, "delSelection", !0))),
                (A = e.findNodeByElem(e.getMarkElem())),
                (S = e.selection.getRangy()),
                A && S)
              ) {
                k = S.getBookmark(e.findElemById(A.id)[0]).start;
                var a = e.getJQueryElem(S.startContainer);
                if (
                  ((n =
                    n ||
                    (S.startContainer &&
                      a.closest(
                        ".md-def-url, .md-def-name, .md-def-title, pre, code"
                      ).length)),
                  (g = t.markhtml),
                  (w = t.html),
                  (x = t.text),
                  (m = t.baseUrlInClipboard || ""),
                  (f = t.remap),
                  g && (g = g.replace(/[\u0000-\u0008\u000b-\u001f]/g, "")),
                  w && (w = w.replace(/[\u0000-\u0008\u000b-\u001f]/g, "")),
                  x && (x = x.replace(/[\u0000-\u0008\u000b-\u001f]/g, "")),
                  n)
                )
                  i.isDefined(x) || (x = u.parseInlineHTML(w, e, m, f)),
                    I(A, k, (x = x || ""), E);
                else if (g) {
                  var s = $($.parseHTML("<div>" + g + "</div>")[0]);
                  (r =
                    r ||
                    (s
                      .find("[data-copy-from-path]")
                      .attr("data-copy-from-path") || "-1") ===
                      File.bundle.filePath),
                    R(A, k, E, s, _);
                } else if (w)
                  a.closest(".md-def-content").length
                    ? ((x =
                        (x = u.parseInlineHTML(w, e, m, f)) || t.text || ""),
                      I(A, k, x, E))
                    : R(A, k, E, w, u.parseHTML, x);
                else {
                  if (!(t.files || []).length)
                    return void JSBridge.clipboard
                      .readImage()
                      .then(function (t) {
                        t && t.length ? N(e, t, E) : I(A, k, x || "", E),
                          e.selection.scrollAdjust(),
                          window.Reporter.fullValidate();
                      });
                  N(e, t.files, E),
                    e.undo.addSnap(A.id, 0),
                    e.selection.scrollAdjust();
                }
                e.undo.addSnap(A.id, 0),
                  e.selection.scrollAdjust(),
                  window.Reporter.fullValidate();
              }
            }
          },
          N = function (e, t, n) {
            if ((n && e.undo.register(n), File.isMac)) {
              if (File.bundle.isLocked) return;
            } else if (File.isLocked) return !1;
            e.sourceView.inSourceMode || m.insertURLs(t);
          };
        window.bridge &&
          bridge.registerHandler(
            "clipboard.processClipboardHTML",
            function (e, t) {
              D(File.editor), t(E(e));
            }
          );
        var D = function (e) {
          M &&
            (document.body.classList.remove("ty-on-copy"),
            !0 !== M && e.selection.setRange(M));
        };
        (t.getMarkdownSourceFrom = A),
          (t.nativeCopyText = function (e) {
            var t = document.createElement("textarea");
            document.body.appendChild(t),
              (t.value = e),
              t.focus(),
              t.select(),
              document.execCommand("Copy"),
              t.remove();
          }),
          (t.copyAsMarkdown = x),
          (t.copyAsSemanticHTML = k),
          (t.copyAsHTMLSource = S),
          (t.copyAsPlainText = F),
          (t.copyHandler = function (e, t, n) {
            if ("copyAsMarkdown" === File._CopyContentFlag) return x(e, t), !0;
            if ("copyAsHTMLSource" === File._CopyContentFlag)
              return S(e, t), !0;
            if ("copyAsSemanticHTML" === File._CopyContentFlag)
              return k(e, t), !0;
            if ("copyAsPlainText" === File._CopyContentFlag) return F(e, t), !0;
            var r = document.activeElement,
              o = e.selection.getRangy(),
              l = $(r).closest("[cid]");
            if (e.sourceView.inSourceMode) {
              let e = File.editor.sourceView.cm.getSelection();
              return e && w(null, null, e, !0, t), !0;
            }
            if (isInputComponent(r))
              return (
                t || console.sendError("in copyHandler : shouldn't be here"), !0
              );
            if ("hr" == r.getAttribute("mdtype"))
              return w(r.outerHTML, null, "---", !0, t), !0;
            if ("toc" == r.getAttribute("mdtype"))
              return (
                w(r.outerHTML, "<div mdtype='toc'><div>", "[toc]", !0, t), !0
              );
            if ("IMG" == r.tagName)
              return (
                w(r.outerHTML, null, r.getAttribute("src") || "", !0, t), !0
              );
            if (l.attr("mdtype") === s.math_block && (!o || o.collapsed)) {
              var c = e.mathBlock.getTex(l.attr("cid"));
              return (
                w(
                  (r.querySelector(".MathJax_Display") || {}).outerHTML || "",
                  "<div mdtype='" + s.math_block + "'>" + c + "</div>",
                  c,
                  !0,
                  t
                ),
                !0
              );
            }
            if (l.attr("mdtype") === s.html_block && (!o || o.collapsed)) {
              var d = e.getNode(l.attr("cid")),
                h = d.get("text");
              return (
                w(
                  h,
                  "<div mdtype='" +
                    s.html_block +
                    "' data-tag='" +
                    i.escape(d.get("style")) +
                    "'>" +
                    i.escape(h) +
                    "</div>",
                  h,
                  !0,
                  t
                ),
                !0
              );
            }
            if (o) {
              if (
                o.startContainer &&
                o.startContainer.parentElement &&
                o.startContainer.parentElement.closest(".ty-table-edit")
              ) {
                var p = l.closest("table").find(".td-span")[0];
                p && (o.setStart(p, 0), e.selection.setRange(o, !0));
              }
              var f = t && o.collapsed && File.option.lineWiseCopyCut;
              if (
                (f &&
                  (File._CopyContentFlag ||
                    ((document.querySelector("#no-sel-style").innerHTML =
                      "::selection {\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\ttext-shadow: none;\n\t\t\t\t\tcolor: inherit;\n\t\t\t\t}"),
                    setTimeout(() => {
                      File._CopyContentRange &&
                        ((e.selection.getRangy() || {}).collapsed ||
                          (document.querySelector("#no-sel-style").innerHTML =
                            ""));
                    }, 1e3)),
                  e.selection.selectLineWrap()),
                File._CopyContentRange &&
                  setTimeout(() => {
                    e.selection.setRange(File._CopyContentRange),
                      (File._CopyContentRange = null),
                      (document.querySelector("#no-sel-style").innerHTML = "");
                  }, 0),
                !o.collapsed || f)
              ) {
                if (!File._CopyContentFlag && File.isNode)
                  return (
                    (File._CopyContentFlag = !0),
                    f && (File._CopyContentRange = o),
                    g.clipboard.clear(),
                    JSBridge.invoke("webContents.copy"),
                    !1
                  );
                if ("cut_before" === File._CopyContentFlag && f)
                  return (
                    (File._CopyContentRange = o),
                    void JSBridge.invoke("webContents.copy")
                  );
                f &&
                  File.isMac &&
                  ((File._CopyContentRange = o), (o = e.selection.getRangy()));
                var m = "";
                if (f || File._CopyContentRange) {
                  let t = e.findElemById(e.focusCid)[0],
                    n = o.getBookmark(t || void 0);
                  o.commonAncestorContainer != t &&
                  o.commonAncestorContainer.contains(t)
                    ? (m = o.toHtml() + "<br/>")
                    : 0 === n.start && n.end >= t.textContent.length
                    ? ((m = t.outerHTML + "<p mdtype='paragraph'></p>"),
                      t.previousElementSibling ||
                        (t.previousElementSibling &&
                          "INPUT" != t.previousElementSibling.tagName) ||
                        ("LI" == t.parentElement.tagName
                          ? (m =
                              t.parentElement.outerHTML +
                              "<li mdtype='list_item'></li>")
                          : a.isType(t.parentElement.tagName, "BLOCKQUOTE") &&
                            (m =
                              t.parentElement.outerHTML +
                              "<p mdtype='paragraph'></p>")))
                    : (m = o.toHtml() + "<br/>");
                } else e.selection.includeTrailMeta(o), (m = o.toHtml());
                var v = u.getMarkElemFromCurrentHtml(m, e).html(),
                  y = File.option.copyMarkdownByDefault
                    ? A(v)
                    : T(v).replace(/\u200B/gi, "");
                return (
                  t && File.isMac
                    ? setTimeout(function () {
                        w(null, v, y, !1, t),
                          bridge.callHandler(
                            "clipboard.postCopy",
                            f ? void 0 : n
                          ),
                          f &&
                            (n && n(),
                            "copy" == t.type
                              ? (e.selection.setRange(File._CopyContentRange),
                                (document.querySelector(
                                  "#no-sel-style"
                                ).innerHTML = ""))
                              : setTimeout(function () {
                                  document.querySelector(
                                    "#no-sel-style"
                                  ).innerHTML = "";
                                }, 30),
                            (File._CopyContentRange = null));
                      }, 0)
                    : w(null, v, y, !1, t),
                  !1
                );
              }
            }
          }),
          (t.insertInlineText = b),
          (t.pasteHandler = L),
          (t.setClipboard = w),
          (t.prepMarkHtml = function (e, t) {
            return u.getMarkElemFromCurrentHtml(e, t);
          }),
          (t.insertParagraph = function (e, t, n) {
            if (!File.isNode || !File.isLocked) {
              (t = t || File.editor),
                (n = n || t.getMarkElem()),
                t.undo.endSnap(!0);
              var i = t.findNodeByElem(n),
                r = new a({ type: s.paragraph, text: "" }),
                l = o.makeEmptyCommand(t.selection.buildUndo(void 0, n));
              i &&
                ((i = i.getClosetBlock()),
                e
                  ? (i.addBefore(r), t.findElemById(i.cid).before(r.toHTML()))
                  : (i.addAfter(r), t.findElemById(i.cid).after(r.toHTML())),
                o.addUndoForInsert(l, r),
                t.selection.jumpIntoElemBegin(t.findElemById(r.cid)),
                l.redo.push(t.selection.buildUndo()),
                t.undo.register(l),
                t.refocus(),
                window.Reporter.fullValidate());
            }
          }),
          (t.insertDom = function (e) {
            File.editor.focusAndRestorePos(),
              L(File.editor, $("<div>").append(e).html(), !1);
          }),
          (t.processClipboardHTML = E),
          (t.beforeCopyStart = function (e) {
            (M = null),
              File.isMac &&
                (document.body.classList.add("ty-on-copy"),
                (M = !0),
                setTimeout(() => {
                  D(e);
                }, 1));
          }),
          (t.getSpeechText = function (e) {
            if ((e = File.editor).sourceView.inSourceMode)
              return (
                e.sourceView.cm.getSelection() || e.sourceView.cm.getValue()
              );
            var t = e.selection.getRangy();
            if (!t || t.collapsed) {
              var n = $("#write").children(),
                i = n.last()[0];
              t = e.selection.createRange(
                n.first()[0],
                0,
                i,
                i.childNodes.length
              );
            }
            return T(u.getMarkElemFromCurrentHtml(t.toHtml(), e).html());
          });
      }
    ),
    $__System.registerDynamic(
      "2f",
      [
        "11",
        "13",
        "1b",
        "1d",
        "19",
        "46",
        "32",
        "52",
        "5d",
        "5b",
        "5c",
        "1e",
        "5e",
      ],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("13"),
          o = e("1b"),
          a = r.Node,
          s = r.TYPE,
          l = (r.NodeCollectionUtils, e("1d"), e("19")),
          c = (e("46"), e("32")),
          d = (e("52"), e("5d")),
          u = e("5b"),
          h = e("5c"),
          p = e("1e"),
          f = e("5e"),
          m = function (e, t, n, i) {
            var r,
              o = e;
            if (e == t) return null;
            for (r = e.get(n); r; ) i(r, o), (r = (o = r).get(n));
            return m(e.get("parent"), t, n, i), o;
          };
        (t.getDisplayText = function (e) {
          var t = e.clone();
          return (
            t.find(".md-meta, .md-content, sub, sup").remove(),
            t.text().replace(/\u00A0/g, " ")
          );
        }),
          (t.decorateOneSide = m),
          (t.simpleExpand = function (e, t) {
            if (File.isLocked) return !1;
            var n,
              i,
              r,
              c = e.getNode(t),
              d = e.selection.buildUndo();
            if (!d) return !1;
            if (
              !a.isType(c, s.heading, s.def_footnote, s.def_link) ||
              (d.startId && d.startId != d.endId)
            )
              return !1;
            if ((n = c.toMark().trim()).match(/\n/)) return !1;
            e.undo.endSnap(!0);
            var u = o.makeEmptyCommand(e.lastCursor);
            if (
              !u.undo.length ||
              (!u.undo[0].id && u.undo[0].startId != u.undo[0].endId)
            )
              return !1;
            if (
              (u.undo.push(o.buildReplaceUndo(c)),
              a.isType(c, s.heading) &&
                (i =
                  (c.get("pattern") &&
                    c.get("pattern").replace("{0}", "").length) ||
                  c.get("depth") + 1),
              a.isType(c, s.def_link, s.def_footnote))
            ) {
              var h,
                p = e.selection.getRangy(),
                f = e.getJQueryElem(p.startContainer);
              (h = f.closest(".md-def-content")),
                (i = a.isType(c, s.def_link) ? 1 : 2),
                h.length && (i += 3),
                (h = f.closest(".md-def-title")).length &&
                  f.text().length &&
                  (i += 5);
            }
            return (
              c.set("text", n),
              c.set("type", s.paragraph),
              u.redo.push(o.buildReplaceUndo(c)),
              ((d = e.selection.buildUndo()).start += i),
              (d.end += i),
              (d.id = c.cid),
              (d.startId = d.endId = void 0),
              u.redo.push(d),
              (r = l.renderHtmlWithBlockMeta(c, e.brush)),
              e.findElemById(c.cid).replaceWith(r),
              e.undo.exeCommand(d, []),
              (u.incomplete = !0),
              e.undo.register(u),
              c.cid
            );
          }),
          (t.insertFileLink = function (e, t) {
            if (i.isFullUrl(t)) {
              var n = e.selection.getRangy();
              n &&
              n.commonAncestorContainer &&
              $(n.commonAncestorContainer).closest(".md-link").length
                ? f.pasteHandler(e, t, !0, !0)
                : f.pasteHandler(e, " " + t + " ", !0, !0);
            } else {
              var r = c.getFileNameFromPath(t);
              File.isTextBundle()
                ? 0 === t.indexOf(File.bundle.filePath) &&
                  (t = t.substring(File.bundle.filePath.length + 1))
                : (t = i.getRelativePath(c.getCurrentFileFolderPath(), t)),
                f.pasteHandler(e, " [" + r + "](" + t + ") ", !0, !0);
            }
          }),
          (t.backspaceHandler = d.backspaceHandler),
          (t.deleteSelectable = d.deleteSelectable),
          (t.deleteLineProcessor = d.deleteLineProcessor),
          (t.deleteLine = d.deleteLine),
          (t.deleteBlock = d.deleteBlock),
          (t.backToParagraph = d.backToParagraph),
          (t.getMarkdownSourceFrom = f.getMarkdownSourceFrom),
          (t.nativeCopyText = f.nativeCopyText),
          (t.copyAsMarkdown = f.copyAsMarkdown),
          (t.copyAsSemanticHTML = f.copyAsSemanticHTML),
          (t.copyAsHTMLSource = f.copyAsHTMLSource),
          (t.copyAsPlainText = f.copyAsPlainText),
          (t.copyHandler = f.copyHandler),
          (t.getSpeechText = f.getSpeechText),
          (t.insertInlineText = f.insertInlineText),
          (t.insertUrlWithTitle = function (e, t, n) {
            (n = n || t),
              f.pasteHandler(
                e,
                " [" + n + "](" + t + ") ",
                !0,
                function (t, i, r, o, a) {
                  a &&
                    t === r &&
                    (e.undo.exeCommand({
                      type: "cursor",
                      id: t,
                      start: i + 2,
                      end: i + 2 + n.length,
                    }),
                    e.brush.clearAndPause(),
                    a.redo.push(e.selection.buildUndo()),
                    e.brush.restart());
                }
              );
          }),
          (t.pasteHandler = f.pasteHandler),
          (t.setClipboard = f.setClipboard),
          (t.insertDom = f.insertDom),
          (t.prepMarkHtml = f.prepMarkHtml),
          (t.insertParagraph = f.insertParagraph),
          (t.processClipboardHTML = f.processClipboardHTML),
          (t.beforeCopyStart = f.beforeCopyStart),
          (t.pasteBlocksAt = f.pasteBlocksAt),
          (t.moreIndent = u.moreIndent),
          (t.lessIndent = u.lessIndent),
          (t.handlePair = h.handlePair),
          (t.surroundPair = h.surroundPair),
          (t.PunctuationOp = p);
      }
    ),
    $__System.registerDynamic("26", [], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i,
        r = {},
        o = { 16: !1, 18: !1, 17: !1, 91: !1 },
        a = "all",
        s = {
          "⇧": 16,
          shift: 16,
          "⌥": 18,
          alt: 18,
          option: 18,
          "⌃": 17,
          ctrl: 17,
          control: 17,
          "⌘": 91,
          command: 91,
        },
        l = {
          backspace: 8,
          tab: 9,
          clear: 12,
          enter: 13,
          return: 13,
          esc: 27,
          escape: 27,
          space: 32,
          left: 37,
          up: 38,
          right: 39,
          down: 40,
          del: 46,
          delete: 46,
          home: 36,
          end: 35,
          pageup: 33,
          pagedown: 34,
          ",": 188,
          ".": 190,
          "/": 191,
          "`": 192,
          "-": 189,
          "=": 187,
          ";": 186,
          "'": 222,
          "[": 219,
          "]": 221,
          "\\": 220,
        },
        c = function (e) {
          return l[e] || e.toUpperCase().charCodeAt(0);
        },
        d = [];
      for (i = 1; i < 20; i++) l["f" + i] = 111 + i;
      function u(e, t) {
        for (var n = e.length; n--; ) if (e[n] === t) return n;
        return -1;
      }
      function h(e, t) {
        if (e.length != t.length) return !1;
        for (var n = 0; n < e.length; n++) if (e[n] !== t[n]) return !1;
        return !0;
      }
      var p = { 16: "shiftKey", 18: "altKey", 17: "ctrlKey", 91: "metaKey" };
      function f(e) {
        for (i in o) o[i] = e[p[i]];
      }
      function m(e, t, n) {
        var i, o;
        (i = v(e)), void 0 === n && ((n = t), (t = "all"));
        for (var a = 0; a < i.length; a++)
          (o = []),
            (e = i[a].split("+")).length > 1 &&
              ((o = y(e)), (e = [e[e.length - 1]])),
            (e = e[0]),
            (e = c(e)) in r || (r[e] = []),
            r[e].push({
              shortcut: i[a],
              scope: t,
              method: n,
              key: i[a],
              mods: o,
            });
      }
      for (i in s) m[i] = !1;
      function g() {
        return a || "all";
      }
      function v(e) {
        var t;
        return (
          "" == (t = (e = e.replace(/\s/g, "")).split(","))[t.length - 1] &&
            (t[t.length - 2] += ","),
          t
        );
      }
      function y(e) {
        for (var t = e.slice(0, e.length - 1), n = 0; n < t.length; n++)
          t[n] = s[t[n]];
        return t;
      }
      function b(e, t, n) {
        e.addEventListener
          ? e.addEventListener(t, n, !1)
          : e.attachEvent &&
            e.attachEvent("on" + t, function () {
              n(window.event);
            });
      }
      b(document, "keydown", function (e) {
        !(function (e) {
          var t, n, i, a, l, c;
          if (
            ((t = e.keyCode),
            -1 == u(d, t) && d.push(t),
            (93 != t && 224 != t) || (t = 91),
            t in o)
          )
            for (i in ((o[t] = !0), s)) s[i] == t && (m[i] = !0);
          else if ((f(e), m.filter.call(this, e) && t in r))
            for (c = g(), a = 0; a < r[t].length; a++)
              if ((n = r[t][a]).scope == c || "all" == n.scope) {
                for (i in ((l = n.mods.length > 0), o))
                  ((!o[i] && u(n.mods, +i) > -1) ||
                    (o[i] && -1 == u(n.mods, +i))) &&
                    (l = !1);
                ((0 != n.mods.length || o[16] || o[18] || o[17] || o[91]) &&
                  !l) ||
                  (!1 === n.method(e, n) &&
                    (e.preventDefault
                      ? e.preventDefault()
                      : (e.returnValue = !1),
                    e.stopPropagation && e.stopPropagation(),
                    e.cancelBubble && (e.cancelBubble = !0)));
              }
        })(e);
      }),
        b(document, "keyup", function (e) {
          var t,
            n = e.keyCode,
            i = u(d, n);
          if (
            (i >= 0 && d.splice(i, 1),
            (93 != n && 224 != n) || (n = 91),
            n in o)
          )
            for (t in ((o[n] = !1), s)) s[t] == n && (m[t] = !1);
        }),
        b(window, "focus", function () {
          for (i in o) o[i] = !1;
          for (i in s) m[i] = !1;
        });
      var w = m;
      (n.exports = w),
        (w.setScope = function (e) {
          a = e || "all";
        }),
        (w.getScope = g),
        (w.deleteScope = function (e) {
          var t, n, i;
          for (t in r)
            for (n = r[t], i = 0; i < n.length; )
              n[i].scope === e ? n.splice(i, 1) : i++;
        }),
        (w.filter = function (e) {
          return !("SELECT" == (e.target || e.srcElement).tagName);
        }),
        (w.isPressed = function (e) {
          return "string" == typeof e && (e = c(e)), -1 != u(d, e);
        }),
        (w.getPressedKeyCodes = function () {
          return d.slice(0);
        }),
        (w.unbind = function (e, t) {
          var n,
            i,
            o,
            a,
            s,
            l = [];
          for (n = v(e), a = 0; a < n.length; a++) {
            if (
              ((i = n[a].split("+")).length > 1 &&
                ((l = y(i)), (e = i[i.length - 1])),
              (e = c(e)),
              void 0 === t && (t = g()),
              !r[e])
            )
              return;
            for (o in r[e])
              (s = r[e][o]).scope === t && h(s.mods, l) && (r[e][o] = {});
          }
        }),
        void 0 !== n && (n.exports = w);
      (w.map = {
        3: "Enter",
        8: "Backspace",
        9: "Tab",
        13: "Enter",
        16: "Shift",
        17: "Ctrl",
        18: "Alt",
        19: "Pause",
        20: "CapsLock",
        27: "Esc",
        32: "Space",
        33: "PageUp",
        34: "PageDown",
        35: "End",
        36: "Home",
        37: "Left",
        38: "Up",
        39: "Right",
        40: "Down",
        44: "PrintScrn",
        45: "Insert",
        46: "Delete",
        59: ";",
        91: "Command",
        107: "=",
        109: "-",
        127: "Delete",
        186: ";",
        187: "=",
        188: ",",
        189: "-",
        190: ".",
        191: "/",
        192: "`",
        219: "[",
        220: "\\",
        221: "]",
        222: "'",
        63232: "Up",
        63233: "Down",
        63234: "Left",
        63235: "Right",
        63272: "Delete",
        63273: "Home",
        63275: "End",
        63276: "PageUp",
        63277: "PageDown",
        63302: "Insert",
      }),
        (w.functionKey = [
          "Command",
          "Ctrl",
          "Shift",
          "Alt",
          "Home",
          "End",
          "PageUp",
          "PageDown",
          "CapsLock",
          "Esc",
          "PrintScrn",
          "Insert",
          "Pause",
        ]),
        (w.isCommand = function (e) {
          return (
            String.fromCharCode(e.which).length > 0 && (e.ctrlKey || e.metaKey)
          );
        });
    }),
    $__System.registerDynamic(
      "29",
      ["e", "13", "11", "33", "34", "2f", "26"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"),
          r = (e("13").Node, e("11")),
          o = e("33"),
          a = e("34"),
          s = e("2f");
        e("26").map;
        function l(e, t, n) {
          var r,
            o = e.cloneNode(!0),
            a = window.getComputedStyle(e);
          if (
            (e.querySelector("[*|href='#raphael-marker-block']") &&
              !e.querySelector("#raphael-marker-block") &&
              o
                .querySelector("defs")
                .appendChild(
                  document
                    .querySelector("path#raphael-marker-block")
                    .cloneNode()
                ),
            t &&
              (function e(t, n) {
                function i(e) {
                  for (var t = [], n = e.length, i = 0; i < n; i++)
                    t.push(e[i]);
                  return t;
                }
                var r = window.getComputedStyle(t);
                [
                  "backgroundColor",
                  "color",
                  "fill",
                  "stroke",
                  "strokeWidth",
                  "opacity",
                  "stroke-dasharray",
                  "fontSize",
                  "fontFamily",
                  "textAnchor",
                  "textSize",
                  "padding",
                  "margin",
                ].forEach(function (e) {
                  n.style[e] = r[e];
                });
                var o = i(n.children || []);
                o.length &&
                  i(t.children || []).forEach(function (t, n) {
                    e(t, o[n]);
                  });
              })(e, o),
            e.parentElement && "MJX-CONTAINER" == e.parentElement.tagName)
          ) {
            var s = e.getBoundingClientRect();
            (o.style.textAlign = "center"),
              o.setAttribute("height", s.height + 8),
              o.setAttribute("width", s.width + 8);
          }
          if (
            (o.style.color || (o.style.color = a.color),
            a.getPropertyValue &&
              (r = window.getComputedStyle(document.body).backgroundColor),
            !o.style.background &&
              ((o.style.background = a.backgroundColor),
              "rgba(0, 0, 0, 0)" !== a.backgroundColor &&
                (r = o.style.background),
              r))
          ) {
            var l = r.match(/\d+/gi);
            if (l.length)
              (299 * l[0] + 587 * l[1] + 114 * l[2]) / 256e3 < 0.5
                ? ((o.style.background = r),
                  i(o)
                    .find("[fill='var(--bg-color)']")
                    .attr("fill", r || "none"))
                : n
                ? ((o.style.background = "white"),
                  i(o).find("[fill='var(--bg-color)']").attr("fill", "white"))
                : ((o.style.background = ""),
                  i(o).find("[fill='var(--bg-color)']").attr("fill", "none"));
          }
          return o;
        }
        function c(e, t, n, i) {
          var r = e.getBoundingClientRect(),
            o = l(e, t, i);
          e.parentElement && "MJX-CONTAINER" == e.parentElement.tagName
            ? (o.setAttribute("height", 2 * (r.height + 8)),
              o.setAttribute("width", 2 * (r.width + 8)))
            : o.setAttribute("height", r.bottom - r.top);
          var a = u(o.outerHTML, !1);
          return (
            t || (a = d(a)),
            n ? a : "data:image/svg+xml;charset=utf-8," + encodeURIComponent(a)
          );
        }
        function d(e) {
          var t,
            n = window.getComputedStyle(document.documentElement);
          return (e = r.replaceAll(
            e,
            "var(--text-color)",
            (e) => (t || (t = n.getPropertyValue("--text-color")), t)
          ));
        }
        function u(e, t) {
          return (
            (e = e
              .replace(/xmlns:NS\d+/gi, "xmlns:xlink")
              .replace(/NS\d+:href/gi, "xlink:href")
              .replace(/NS\d+:space/gi, "xml:space")
              .replace(/NS\d+:/gi, "")
              .replace(/<br([^>]*)>/g, "<br/>")
              .replace(/<img([^>]*)>/g, (e, t) => `<img ${t} />`)),
            t || (e = e.replace(/xlink:/g, "")),
            e
          );
        }
        var h = 0;
        function p(e, t) {
          var n =
              "<html><head><meta charset='UTF-8'></head><body style='margin:0'>$1</body></html>",
            i = e.getBoundingClientRect();
          return (
            (i = { x: 0, y: 0, width: i.width, height: i.height }),
            (n = n.replace("$1", c(e, !0, !0))),
            new Promise((e) => {
              bridge.callHandler(
                "controller.screenshotHTML",
                { html: n, rect: i, extension: t || "png" },
                e
              );
            })
          );
        }
        function f(e, t, n, i) {
          return new Promise((r) => {
            var o = c(e, t, !1, "jpeg" == n),
              a = new Image();
            (a.onerror = function (e) {
              r("");
            }),
              (a.onload = function () {
                var e = document.createElement("canvas"),
                  t = e.getContext("2d"),
                  o = File.canvasratio,
                  s = a.width,
                  l = a.height;
                (e.width = s),
                  (e.height = l),
                  o > 1.1 &&
                    ((e.width = s * o), (e.height = l * o), t.scale(o, o)),
                  (e.style.width = s + "px"),
                  (e.style.height = l + "px"),
                  t.drawImage(a, 0, 0),
                  setTimeout(function () {
                    var t = "";
                    try {
                      t = e
                        .toDataURL(`image/${n}`)
                        .replace(`data:image/${n};base64,`, "");
                    } catch (e) {
                      console.warn(e);
                    }
                    !(function (e, t, n, i) {
                      if ("clipboard" === n) return m(e), void i();
                      if (File.isNode) {
                        var r = e;
                        reqnode("fs").writeFile(n, r, "base64", function (e) {
                          e ? (i(""), console.sendError(e)) : i(n);
                        });
                      } else
                        File.isMac &&
                          ((e = `data:image/${t};base64,` + e),
                          bridge.callHandler(
                            "images.savePNG",
                            e,
                            async function (e) {
                              e &&
                              n &&
                              (await JSBridge.invoke("path.moveFile", {
                                from: e,
                                to: n,
                              }))
                                ? i(n)
                                : i("");
                            }
                          ));
                    })(t, n, i, r);
                  }, 100);
              }),
              (a.src = o);
          });
        }
        function m(e) {
          if (((e = "data:image/png;base64," + e), File.isNode)) {
            const t = reqnode("electron").nativeImage.createFromDataURL(
              "data:image/png;base64," + e
            );
            reqnode("electron").clipboard.writeImage(t);
          } else
            bridge.callHandler(
              "clipboard.writeImage",
              { path: e },
              function () {
                callback();
              }
            );
        }
        async function g(e, t) {
          if (e)
            return "svg" == e.tagName
              ? await (async function (e) {
                  var n =
                    t ||
                    (await (File.isNode
                      ? JSBridge.invoke("dialog.showSaveDialog", {
                          properties: ["saveFile", "showOverwriteConfirmation"],
                          title: i.localize.getString("Save", "Menu"),
                          filters: [
                            {
                              name: "All Image Types",
                              extensions: ["svg", "png", "jpg", "jpeg"],
                            },
                            { name: "SVG", extensions: ["svg"] },
                            { name: "PNG", extensions: ["png"] },
                            { name: "JPEG", extensions: ["jpg", "jpeg"] },
                          ],
                        }).then(({ filePath: e }) => e)
                      : File.isMac
                      ? JSBridge.invoke("image.saveSVGDialog")
                      : void 0));
                  if (n) {
                    t && (n = "clipboard");
                    var r = e.closest("[lang='mermaid']"),
                      o = e.closest("mjx-container");
                    if (/\.svg$/.exec(n)) {
                      var a = d(u((e = l(e, r, !1)).outerHTML, !1));
                      if (File.isNode)
                        return new Promise((e) => {
                          reqnode("fs").writeFile(n, a, "utf8", e);
                        });
                      if (File.isMac)
                        return JSBridge.invoke("image.saveSVG", {
                          path: n,
                          content: a,
                        });
                    }
                    var s = t || /\.png$/.exec(n) ? "png" : "jpeg";
                    if (File.isNode || o) return await f(e, r, s, n);
                    if (File.isMac) {
                      var c = await p(e, s);
                      return t
                        ? (await JSBridge.invoke("clipboard.writeImage", {
                            path: c,
                          }),
                          "")
                        : (await JSBridge.invoke("path.moveFile", {
                            from: c,
                            to: n,
                          }))
                        ? n
                        : "";
                    }
                  }
                })(e)
              : await (async function (e) {
                  e.src && JSBridge.invoke("shell.showDownload", e.src);
                })(e);
        }
        const v = 31457280;
        async function y(e) {
          var t = File.editor;
          e = /^(wk)*file:(\/\/)*/.exec(e) ? r.absolutePathFrom(e) : e;
          var n = r.VIDEO_REG.exec(e),
            i = r.AUDIO_REG.exec(e),
            a = r.getFileName(e),
            l = File.isWin ? "\\" : "/",
            c = File.bundle.filePath + l + "assets" + l;
          var d = await (async function () {
            if (
              File.isTextBundle() &&
              /(^[\\\/])|(^[a-zA-Z]:)/.exec(e) &&
              !o.shouldManageResource(e) &&
              File.isNode
            ) {
              var t = reqnode("fs-extra");
              if ((await t.stat(e)).size < v)
                return await (async function (e) {
                  var t = reqnode("fs-extra"),
                    r = c + a;
                  try {
                    await t.access(r, t.F_OK),
                      (r = File.editor.imgEdit.uniqueFilePathOnNode(r));
                  } catch (e) {}
                  return n || i ? await t.copy(e, r) : t.copy(e, r), r;
                })(e);
            }
            return e;
          })();
          n
            ? (function (e) {
                e = t.imgEdit.resolveImagePath(e);
                var n = '<video src="{url}"></video>'.replace("{url}", e);
                s.pasteHandler(t, n, !1);
              })(d)
            : i
            ? (function (e) {
                e = t.imgEdit.resolveImagePath(e);
                var n = '<audio src="{url}"></audio>'.replace("{url}", e);
                s.pasteHandler(t, n, !1);
              })(d)
            : s.insertFileLink(t, d);
        }
        function b(e) {
          e &&
            (r.IMG_REG.exec(e)
              ? File.editor.imgEdit.insertImageFromURL(e)
              : y(e));
        }
        (t.onSaveDiscard = async function () {
          File.bundle.assetsChanges &&
            File.bundle.assetsChanges.add.length +
              File.bundle.assetsChanges.remove.length >
              0 &&
            (await (function (e) {
              const t = reqnode("fs-extra"),
                n = File.isWin ? "\\" : "/";
              var i = [];
              for (var r of e) {
                let [e, o] = r,
                  a = File.bundle.filePath + n + "assets" + n + o;
                i.push(t.move(e, a, { overwrite: !1 }), function () {});
              }
              return Promise.all(i);
            })(File.bundle.assetsChanges.remove),
            await a.backupAssets(File.bundle.assetsChanges.add, !0));
        }),
          (t.recordMediaMoves = function (e, t) {
            let n;
            (File.bundle.assetsChanges = File.bundle.assetsChanges || {
              add: [],
              remove: [],
            }),
              (n = o.shouldManageResource(e)) &&
                File.bundle.assetsChanges.add.push(n),
              t &&
                (n = o.shouldManageResource(t[1])) &&
                File.bundle.assetsChanges.remove.push([t[0], n]);
          }),
          (t.insertURL = b),
          (t.insertURLs = function (e) {
            var t = File.editor;
            e.forEach(function (e, n) {
              n > 0 && t.UserOp.insertParagraph(!1, t), b(e);
            });
          }),
          (t.SVG2HtmlImg = function (e) {
            if (!e) return "";
            var t = c(e, !0),
              n = document.createElement("img"),
              i = e.getBoundingClientRect();
            return (
              e.parentElement && "MJX-CONTAINER" == e.parentElement.tagName
                ? (e.setAttribute("height", i.height + 8),
                  e.setAttribute("width", i.width + 8),
                  (i.height += 8),
                  (i.width += 8))
                : (i = e.getBoundingClientRect()),
              (n.width = i.width),
              (n.height = i.height),
              n.setAttribute("src", "data:image/svg+xml;base64," + btoa(t)),
              n.outerHTML
            );
          }),
          (t.svg2DataURL = c),
          (t.processExportedSVG = u),
          (t.downloadAs = g),
          (t.copyImage = function (e) {
            return g(e, !0);
          }),
          (t.saveSVGToTempPath = async function (e, t) {
            return File.isMac
              ? await p(e, "png")
              : await f(
                  e,
                  t,
                  "png",
                  await (async function () {
                    var e = await reqnode("electron").ipcRenderer.invoke(
                      "getPath",
                      "temp"
                    );
                    h++;
                    var t =
                      e.replace(/[/\\]$/, "") +
                      (File.isWin ? "\\\\" : "/") +
                      Number(new Date()) +
                      h +
                      ".png";
                    return t;
                  })()
                );
          });
      }
    ),
    $__System.registerDynamic(
      "32",
      ["11", "33", "29", "28"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"),
          r = e("33"),
          o = e("29"),
          a = e("28"),
          s = {
            NSChangeDone: 0,
            NSChangeUndone: 1,
            NSChangeCleared: 2,
            NSChangeReadOtherContents: 3,
            NSChangeAutoSaved: 4,
            NSChangeRedone: 5,
            NodeSaveFailed: -1,
          },
          l = function () {
            (this.doneStack = []),
              (this.undoneStack = []),
              (this.curState = [s.NSChangeAutoSaved, new Date() - 0]),
              (this.lastSaved = this.curState[1]);
          };
        (l.prototype.isDocumentEdited = function () {
          return !this.curState;
        }),
          (l.prototype.withdrawAutoSaved = function () {
            if (this.curState) {
              if (this.curState[0] != s.NSChangeAutoSaved) return !0;
              this.curState = null;
            }
            return !1;
          }),
          (l.prototype.clone = function () {
            return {
              doneStack: this.doneStack.clone(),
              undoneStack: this.undoneStack.clone(),
              curState: this.curState,
              lastSaved: this.lastSaved,
            };
          }),
          (l.prototype.reset = function (e) {
            (this.doneStack = e ? e.doneStack : []),
              (this.undoneStack = e ? e.undoneStack : []),
              (this.curState = e
                ? e.curState
                : [s.NSChangeAutoSaved, new Date() - 0]);
            let t = this.lastSaved;
            (this.lastSaved = e ? e.lastSaved : this.curState[1]),
              t != this.lastSaved && c();
          }),
          (l.prototype.isDiscardableUntitled = function () {
            return !(File.isDocumentEdited() || File.bundle.filePath);
          }),
          (l.prototype.updateChangeCount = function (e) {
            var t,
              n = this.curState;
            switch (
              ((File.bundle.hasModified = File.bundle.filePath || !0), e)
            ) {
              case s.NSChangeDone:
                this.curState &&
                  this.curState[0] === s.NSChangeAutoSaved &&
                  (this.doneStack.push(this.curState), (this.curState = null)),
                  this.doneStack.push([e]),
                  this.doneStack.length > 200 &&
                    this.doneStack.splice(0, this.doneStack.length - 200),
                  (this.undoneStack = []);
                break;
              case s.NSChangeUndone:
                for (
                  this.curState &&
                    this.curState[0] === s.NSChangeAutoSaved &&
                    (this.undoneStack.push(this.curState),
                    (this.curState = null)),
                    this.doneStack.pop(),
                    this.undoneStack.push([e]);
                  (t = this.doneStack.last()) &&
                  t &&
                  t[0] === s.NSChangeAutoSaved;

                )
                  this.doneStack.pop(),
                    this.lastSaved === t[1] && (this.curState = t);
                break;
              case s.NSChangeRedone:
                for (
                  this.curState &&
                    this.curState[0] === s.NSChangeAutoSaved &&
                    (this.doneStack.push(this.curState),
                    (this.curState = null)),
                    this.undoneStack.pop(),
                    this.doneStack.push([e]);
                  (t = this.undoneStack.last()) &&
                  t &&
                  t[0] === s.NSChangeAutoSaved;

                )
                  this.undoneStack.pop(),
                    this.lastSaved === t[1] && (this.curState = t);
                break;
              case s.NSChangeCleared:
                (this.doneStack = []),
                  (this.undoneStack = []),
                  (this.curState = [s.NSChangeAutoSaved, new Date() - 0]),
                  (this.lastSaved = this.curState[1]);
                break;
              case s.NodeSaveFailed:
                this.curState &&
                  ((this.lastSaved = null), (this.curState = null));
                break;
              case s.NSChangeAutoSaved:
                if (this.curState) return;
                (this.curState = [s.NSChangeAutoSaved, new Date() - 0]),
                  (this.lastSaved = this.curState[1]);
                break;
              case s.NSChangeReadOtherContents:
                for (var i = [], r = [], o = 0; o < this.doneStack.length; o++)
                  this.doneStack[o][0] !== s.NSChangeAutoSaved &&
                    i.push(this.doneStack[o]);
                for (o = 0; o < this.undoneStack.length; o++)
                  this.undoneStack[o][0] !== s.NSChangeAutoSaved &&
                    r.push(this.undoneStack[o]);
                (this.doneStack = i),
                  (this.undoneStack = r),
                  (this.curState = null);
            }
            n !== this.curState && File.isNodeHtml && c();
          });
        var c = function () {
          const e =
            !File.bundle.filePath &&
            (File.bundle.fileName || File.bundle.originalPath);
          File.changeCounter &&
            (e || !File.changeCounter.curState || File.inSavingProcess
              ? (File.bundle.filePath &&
                  File.option.enableAutoSave &&
                  File.changeCounter.lastSaved) ||
                (document
                  .querySelector("#title-text")
                  .classList.add("title-modified"),
                File.isNode && JSBridge.invoke("window.setTitle", void 0, !0),
                document
                  .querySelector("#m-saved")
                  .parentElement.classList.remove("saved"))
              : ((File.bundle.filePath || File.bundle.fileName) &&
                  File.isNode &&
                  JSBridge.invoke("window.setTitle", void 0, !1),
                document
                  .querySelector("#title-text")
                  .classList.remove("title-modified"),
                document
                  .querySelector("#m-saved")
                  .parentElement.classList.add("saved")));
        };
        t.showExportDialog = async function (e, t, n) {
          if ((t = t || {}).path && t.overwrite) {
            if (File.option.noWarningForExportOverwrite) return t.path;
            var i = await a.showWarningDialog(
              $.localize
                .getString(
                  '"Export and Overwrite with Previous" will overwrite file at %@, would you continue?',
                  "Panel"
                )
                .replace("%@", t.path),
              !0
            );
            return 0 != i.response
              ? null
              : (i.checkboxChecked &&
                  (JSBridge.execForAll(
                    "window.File && File.option && (File.option.noWarningForExportOverwrite = true)"
                  ),
                  JSBridge.putSetting("noWarningForExportOverwrite", !0)),
                t.path);
          }
          return await new Promise((i) => {
            !(function (e, t, n, i) {
              var r,
                o = [];
              (n = n || {}).selectFolder ||
                (o = i || [
                  { name: e.toUpperCase(), extensions: [e] },
                  {
                    name: $.localize.getString("All Files", "Panel"),
                    extensions: ["*"],
                  },
                ]);
              var a = File.isLinuxSnap
                ? ""
                : d(e, n, (e) => {
                    r = e;
                  });
              File.isNode &&
                JSBridge.invoke(
                  n.selectFolder
                    ? "dialog.showOpenDialog"
                    : "dialog.showSaveDialog",
                  {
                    properties: n.selectFolder
                      ? ["saveFile", "createDirectory"]
                      : ["openDirectory"],
                    title: $.localize.getString("Save", "Menu"),
                    defaultPath: a,
                    filters: o,
                  }
                ).then(({ filePath: n }) => {
                  n &&
                    ((File.option.lastSaveLocation =
                      reqnode("path").dirname(n)),
                    Analytics.record("export", { format: e })),
                    t(n);
                }),
                File.isMac &&
                  (n.selectFolder
                    ? bridge.callHandler(
                        "path.selectFolderOrFile",
                        { forExport: !0, dir: !0, defaultPath: a },
                        (n) => {
                          Analytics.record("export", { format: e }), t(n);
                        }
                      )
                    : bridge.callHandler(
                        "path.showSaveDialog",
                        {
                          defaultPath: r ? "" : a,
                          filters: o ? o[0].extensions : null,
                        },
                        (n) => {
                          Analytics.record("export", { format: e }), t(n);
                        }
                      ));
            })(e, i, t, n);
          });
        };
        var d = function (e, t, n) {
            var r = File.isWin ? "\\" : "/",
              o = (e =
                null === e || void 0 === e
                  ? File.option.defaultExtension || "md"
                  : e)
                ? File.getSuggestedFileName() + "." + e
                : File.getSuggestedFileName();
            return (t = t || {}).path
              ? !File.option.lastExport || File.option.lastExportNoOverwrite
                ? i.pathByDeleteLastComponent(t.path) + r + o
                : t.path
              : File.option.lastSaveLocation
              ? File.option.lastSaveLocation + r + o
              : "same" === t.exportFolder
              ? u() + r + o
              : "custom" === t.exportFolder
              ? ((t.customExportPath =
                  t.customExportPath || window._options.documentsPath),
                t.customExportPath + r + o)
              : File.mountFolder_
              ? File.mountFolder_ + r + o
              : (n && n(o), o);
          },
          u = function () {
            return File.isMac
              ? File.bundle.currentFolderPath
              : File.isNode && File.bundle.filePath
              ? reqnode("path").dirname(
                  File.bundle.filePath || File.bundle.originalPath
                )
              : "";
          },
          h = function () {
            return File.bundle.filePath || "";
          };
        var p = async (e) => {
          if (
            (File.editor.searchPanel.closePanel(!0, !0), File.inSavingProcess)
          )
            return (
              await ((e) =>
                new Promise((t) => {
                  setTimeout(t, e);
                }))(500),
              File.inSavingProcess &&
                ((File.inSavingProcess = !1),
                File.updateChangeCount(File.ChangeType.NodeSaveFailed)),
              void (await p())
            );
          if (
            !File.bundle.unsupported &&
            (File.bundle.hasModified ||
              1 != File.draftsRecoverList.length ||
              reqnode("fs").unlink(File.draftsRecoverList[0], () => {}),
            File.bundle.hasModified &&
              File.changeCounter.isDocumentEdited() &&
              (await JSBridge.invoke("document.noOtherWindow")))
          ) {
            if (
              e &&
              (File.option.enableAutoSave || File.option.saveFileOnSwitch) &&
              File.bundle.filePath &&
              reqnode("fs").existsSync(File.bundle.filePath)
            ) {
              File.updateChangeCount(File.ChangeType.NSChangeAutoSaved);
              try {
                await File.buildDocumentSnapForNode(!0);
              } catch (e) {
                console.sendError(e),
                  File.updateChangeCount(File.ChangeType.NodeSaveFailed);
              }
              if (!1 === (await File.saveUseNode(!1, !1, !0)))
                throw new Error("save failed");
              return;
            }
            return (
              await File.backupWindow(!0),
              new Promise((e, t) => {
                a.showDialog({
                  title: $.localize.getString("Save", "Menu"),
                  html: $.localize.getString(
                    "Do you want to save the changes made to this document ?<br> Your changes will be lost if you don't save them.",
                    "Panel"
                  ),
                  buttons: [
                    $.localize.getString("Save", "Menu"),
                    $.localize.getString(
                      File.bundle.filePath ? "Discard Changes" : "Discard",
                      "Panel"
                    ),
                    $.localize.getString("Cancel"),
                  ],
                  backdrop: !1,
                  keyboard: !0,
                  callback: async function (n) {
                    if (0 == n) {
                      File._needsUpdateSnap = new Date();
                      var i = await File.saveUseNode(!1, !1, !0);
                      if (i)
                        try {
                          File.updateChangeCount(
                            File.ChangeType.NSChangeAutoSaved
                          ),
                            await File.buildDocumentSnapForNode(!0);
                        } catch (e) {
                          console.sendError(e),
                            File.updateChangeCount(
                              File.ChangeType.NodeSaveFailed
                            ),
                            (i = !1);
                        }
                      i ? e() : t(null);
                    } else
                      1 == n
                        ? (File.buildDocumentSnapForNode(),
                          JSBridge.invoke("document.setLastSync", -1),
                          await o.onSaveDiscard(),
                          e(),
                          (File._needsUpdateSnap = !1))
                        : (JSBridge.invoke("app.cancelQuit"),
                          (File._onFileSwitching = !1),
                          t(null));
                  },
                });
              })
            );
          }
        };
        t.tryLeaveDocument = function (e, t) {
          p(t)
            .then(e)
            .catch((t) => {
              null != t && e(t.message || t);
            });
        };
        var f = function (e, t) {
            if (e && "." != e[0]) {
              var n = m(e).toLowerCase();
              return n ? ~File.SupportedFiles.indexOf(n) : !t;
            }
            return !1;
          },
          m = function (e) {
            return (
              (e
                .split(/[\/\\]/)
                .last()
                .match(/\.([^.]+)$/) || [])[1] || ""
            );
          };
        !(function () {
          function e() {
            (File.option.copyMarkdownByDefault = !0),
              window.ClientCommand.selectAll(),
              setTimeout(function () {
                window.ClientCommand.copy(),
                  setTimeout(function () {
                    File.editor.EditHelper.showNotification(
                      "Context copied to clipboard."
                    );
                  }, 500);
              }, 500);
          }
          $("#save-error-banner")
            .on("click", ".btn", e)
            .on("click", "#trigger-save-error-dialog", function () {
              let t = $.localize.getString(
                "Save content failed for some reason.<br/>You could copy the content into a new Typora window, and then save it. <br/>Learn more about:<ul><li><a href='https://support.typora.io/Report-Bugs/'>Report bugs to us</a></li><li><a href='https://support.typora.io/Version-Control/'>Recover lost contents</a></li></ul>",
                "Panel"
              );
              File.option.useMirrorInCN && (t = t.replace(/\.io\//g, "io.cn/")),
                a.showDialog({
                  title: $.localize.getString("Something is Wrong…", "Panel"),
                  html: t,
                  buttons: [
                    $.localize.getString("Copy Content", "Panel"),
                    $.localize.getString("Close", "Panel"),
                  ],
                  callback: function (t) {
                    (File._onFileSwitching = !1),
                      0 == t && (e(), $("#save-error-banner").show());
                  },
                }),
                $("#save-error-banner").hide();
            });
        })();
        const g = function () {
          return reqnode(
            `../../${window._options.mainPath || "launch/app"}/main.node`
          );
        };
        t.winShell = g;
        var v,
          y = !1,
          b = [],
          w = null;
        function x() {
          var e = document.caretRangeFromPoint(window.innerWidth / 2, 40);
          b =
            e && e.startContainer.parentElement.closest("[cid]")
              ? [e, e ? e.getBoundingClientRect() : null]
              : [];
        }
        function C() {
          if (b) {
            var e = b[0],
              t = b[1];
            if (e) {
              var n = e.getBoundingClientRect().top - t.top;
              v.scrollTop += n;
            }
          }
        }
        $(document).ready(function () {
          v = document.querySelector("content");
          var e,
            t,
            n,
            i,
            r = function () {
              w && clearTimeout(w),
                (w = setTimeout(function () {
                  b = null;
                }, 500));
            };
          window.addEventListener("beforeResize", function () {
            File && File.editor && !File._onInitParse && x();
          }),
            window.addEventListener("resize", function () {
              File && File.editor && !File._onInitParse && !b && (x(), r());
            }),
            (e = "resize"),
            (t = "optimizedResize"),
            (i = !1),
            (n = n || window).addEventListener(e, function () {
              i ||
                ((i = !0),
                requestAnimationFrame(function () {
                  n.dispatchEvent(new CustomEvent(t)), (i = !1);
                }));
            }),
            window.addEventListener("optimizedResize", function () {
              File &&
                File.editor &&
                !File._onInitParse &&
                b &&
                (setTimeout(C, 0), r());
            });
        }),
          (t.setItemInDB = function (e, t) {
            try {
              localStorage.setItem(e + "", t + "");
            } catch (n) {
              localStorage.clear(), localStorage.setItem(e, t);
            }
          }),
          (t.removeItemInDB = function (e) {
            try {
              localStorage.removeItem(e);
            } catch (e) {
              localStorage.clear();
            }
          }),
          (t.getItemInDB = function (e) {
            return localStorage.getItem(e);
          }),
          (t.getColorBrightness = function (e) {
            var t = (e.match(/[\d.]+/gi) || []).map(function (e) {
              return e - 0;
            });
            return (
              (void 0 !== t[3] && null !== t[3]) || (t[3] = 1),
              0 == t[3] ? 1 : (299 * t[0] + 587 * t[1] + 114 * t[2]) / 256e3
            );
          }),
          (t.getFileNameFromPath = function (e, t) {
            try {
              e = e && decodeURI(e);
            } catch (e) {}
            return (
              e &&
                ((e = (e = e.replace(/\\/g, "/").replace(/\/$/, "")).substring(
                  e.lastIndexOf("/") + 1
                )),
                t && (e = e.replace(/#[^\/]+$/, "").replace(/\?[^\/]+$/, ""))),
              e
            );
          }),
          (t.normalizePath = function (e, t) {
            return !t && /^([a-z][a-z0-9+\-]+):\/\//gi.exec(e)
              ? e
              : File.isNode
              ? reqnode("path").normalize(e)
              : (function (e) {
                  for (var t = e.split("/"), n = [], i = 0; i < t.length; i++)
                    "." != t[i] && (".." == t[i] ? n.pop() : n.push(t[i]));
                  return n.join("/").replace(/[\/]{1,}/g, "/");
                })(e);
          }),
          (t.getCurrentFilePath = h),
          (t.getCurrentFileFolderPath = u),
          (t.getExtension = m),
          (t.ChangeType = s),
          (t.ChangeCounter = l),
          (t.refreshTitlebarText = c),
          (t.isSupportedFile = f),
          (t.detectEncodeByNode = function (e) {
            var t = !1;
            if (
              (e.length > 2 &&
                239 === e[0] &&
                187 === e[1] &&
                191 === e[2] &&
                (t = !0),
              i.isUTF8(e))
            )
              return t ? "utf8-bom" : "utf8";
            var n = reqnode("jschardet"),
              r = reqnode("iconv-lite");
            n.Constants.MINIMUM_THRESHOLD = 0.3;
            var o = n.detect(e).encoding || "utf8";
            return (
              "ascii" == o.toLowerCase() && (o = "utf8"),
              r.encodingExists(o) || (o = o.replace(/-/g, "_")),
              (o = r.encodingExists(o) ? o : "utf8")
            );
          }),
          (t.getContentFromBuffer = function (e, t, n) {
            if ("utf8" == t || "uft16le" == t) {
              if (239 != e[0]) return e.toString(t);
              if (239 == e[0] && 187 == e[1] && 191 == e[2] && 239 == e[0]) {
                var i = e.toString(t).replace(/^\uFEFF+/, "");
                return "function" == typeof n && n(), i;
              }
            }
            return reqnode("iconv-lite").decode(e, t, { stripBOM: n });
          }),
          (t.statWrapper = function (e, t) {
            (async function (e) {
              var t = {},
                n = reqnode("path").basename(e),
                i = e === File.getMountFolder();
              if (!i && n && "." == n[0]) return (t.shouldIgnore = !i), t;
              if (((t.name = n), File.isWin)) {
                var o = await new Promise(function (t) {
                  reqnode("fswin").getAttributes(e, t);
                });
                if (!o) return null;
                (t.shouldIgnore = o.IS_HIDDEN || o.IS_SYSTEM || o.IS_TEMPORARY),
                  (t.isDir = o.IS_DIRECTORY),
                  (t.isFile = !t.isDir),
                  (t.mtime = o.LAST_WRITE_TIME),
                  (t.birthtime = o.CREATION_TIME),
                  (t.size = o.SIZE / 1e3);
              } else {
                var a = reqnode("util");
                try {
                  var s = await reqnode("fs-extra").stat(e);
                  (t.isDir = s.isDirectory()),
                    (t.isFile = s.isFile()),
                    (t.mtime = new Date(a.inspect(s.mtime))),
                    (t.birthtime = new Date(a.inspect(s.birthtime))),
                    (t.size = Number(s.size) / 1e3);
                } catch (e) {
                  return null;
                }
              }
              if (
                (t.isDir
                  ? (t.shouldIgnore = "node_modules" == n)
                  : t.isFile &&
                    ((t.shouldIgnore = t.shouldIgnore || !f(n)),
                    File.isWin ||
                      (t.shouldIgnore =
                        t.shouldIgnore ||
                        1e3 * t.size > 1e3 * File.MAX_FILE_SIZE)),
                i && (t.shouldIgnore = !1),
                !t.shouldIgnore &&
                  File.option.supportTextBundle &&
                  /\.textbundle$/i.exec(n))
              ) {
                t.isDir || (t.shouldIgnore = !0),
                  (t.isBundle = !0),
                  (t.isDir = !1),
                  (t.isFile = !0),
                  (t.shouldIgnore = !1);
                let n = await r.findTextFile(e);
                n
                  ? (t.textFile = e + (File.isWin ? "\\" : "/") + n)
                  : (t.shouldIgnore = !0);
              }
              return t;
            })(e).then(t);
          }),
          (t.bindOversizePlaceholder = function () {
            File.isLinux ||
              y ||
              (File.isMac
                ? $("#ty-oversize-file-quick-look")
                    .css("display", "inline-block")
                    .on("click", function () {
                      bridge.callHandler("window.previewFile", h());
                    })
                : File.isWin &&
                  $("#ty-oversize-file-open-in")
                    .css("display", "inline-block")
                    .on("click", function () {
                      g().openAs(File.bundle.filePath);
                    }),
              (y = !0));
          }),
          (t.getDefaultPathOrName = d);
      }
    ),
    (function (e, t) {
      "use strict";
      "object" == typeof module && "object" == typeof module.exports
        ? (module.exports = e.document
            ? t(e, !0)
            : function (e) {
                if (!e.document)
                  throw new Error("jQuery requires a window with a document");
                return t(e);
              })
        : t(e);
    })("undefined" != typeof window ? window : this, function (e, t) {
      "use strict";
      var n = [],
        i = e.document,
        r = Object.getPrototypeOf,
        o = n.slice,
        a = n.concat,
        s = n.push,
        l = n.indexOf,
        c = {},
        d = c.toString,
        u = c.hasOwnProperty,
        h = u.toString,
        p = h.call(Object),
        f = {},
        m = function (e) {
          return "function" == typeof e && "number" != typeof e.nodeType;
        },
        g = function (e) {
          return null != e && e === e.window;
        },
        v = { type: !0, src: !0, noModule: !0 };
      function y(e, t, n) {
        var r,
          o = (t = t || i).createElement("script");
        if (((o.text = e), n)) for (r in v) n[r] && (o[r] = n[r]);
        t.head.appendChild(o).parentNode.removeChild(o);
      }
      function b(e) {
        return null == e
          ? e + ""
          : "object" == typeof e || "function" == typeof e
          ? c[d.call(e)] || "object"
          : typeof e;
      }
      var w = function (e, t) {
          return new w.fn.init(e, t);
        },
        x = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
      function C(e) {
        var t = !!e && "length" in e && e.length,
          n = b(e);
        return (
          !m(e) &&
          !g(e) &&
          ("array" === n ||
            0 === t ||
            ("number" == typeof t && t > 0 && t - 1 in e))
        );
      }
      (w.fn = w.prototype =
        {
          jquery: "3.3.1",
          constructor: w,
          length: 0,
          toArray: function () {
            return o.call(this);
          },
          get: function (e) {
            return null == e
              ? o.call(this)
              : e < 0
              ? this[e + this.length]
              : this[e];
          },
          pushStack: function (e) {
            var t = w.merge(this.constructor(), e);
            return (t.prevObject = this), t;
          },
          each: function (e) {
            return w.each(this, e);
          },
          map: function (e) {
            return this.pushStack(
              w.map(this, function (t, n) {
                return e.call(t, n, t);
              })
            );
          },
          slice: function () {
            return this.pushStack(o.apply(this, arguments));
          },
          first: function () {
            return this.eq(0);
          },
          last: function () {
            return this.eq(-1);
          },
          eq: function (e) {
            var t = this.length,
              n = +e + (e < 0 ? t : 0);
            return this.pushStack(n >= 0 && n < t ? [this[n]] : []);
          },
          end: function () {
            return this.prevObject || this.constructor();
          },
          push: s,
          sort: n.sort,
          splice: n.splice,
        }),
        (w.extend = w.fn.extend =
          function () {
            var e,
              t,
              n,
              i,
              r,
              o,
              a = arguments[0] || {},
              s = 1,
              l = arguments.length,
              c = !1;
            for (
              "boolean" == typeof a && ((c = a), (a = arguments[s] || {}), s++),
                "object" == typeof a || m(a) || (a = {}),
                s === l && ((a = this), s--);
              s < l;
              s++
            )
              if (null != (e = arguments[s]))
                for (t in e)
                  (n = a[t]),
                    a !== (i = e[t]) &&
                      (c && i && (w.isPlainObject(i) || (r = Array.isArray(i)))
                        ? (r
                            ? ((r = !1), (o = n && Array.isArray(n) ? n : []))
                            : (o = n && w.isPlainObject(n) ? n : {}),
                          (a[t] = w.extend(c, o, i)))
                        : void 0 !== i && (a[t] = i));
            return a;
          }),
        w.extend({
          expando: "jQuery" + ("3.3.1" + Math.random()).replace(/\D/g, ""),
          isReady: !0,
          error: function (e) {
            throw new Error(e);
          },
          noop: function () {},
          isPlainObject: function (e) {
            var t, n;
            return !(
              !e ||
              "[object Object]" !== d.call(e) ||
              ((t = r(e)) &&
                ("function" !=
                  typeof (n = u.call(t, "constructor") && t.constructor) ||
                  h.call(n) !== p))
            );
          },
          isEmptyObject: function (e) {
            var t;
            for (t in e) return !1;
            return !0;
          },
          globalEval: function (e) {
            y(e);
          },
          each: function (e, t) {
            var n,
              i = 0;
            if (C(e))
              for (n = e.length; i < n && !1 !== t.call(e[i], i, e[i]); i++);
            else for (i in e) if (!1 === t.call(e[i], i, e[i])) break;
            return e;
          },
          trim: function (e) {
            return null == e ? "" : (e + "").replace(x, "");
          },
          makeArray: function (e, t) {
            var n = t || [];
            return (
              null != e &&
                (C(Object(e))
                  ? w.merge(n, "string" == typeof e ? [e] : e)
                  : s.call(n, e)),
              n
            );
          },
          inArray: function (e, t, n) {
            return null == t ? -1 : l.call(t, e, n);
          },
          merge: function (e, t) {
            for (var n = +t.length, i = 0, r = e.length; i < n; i++)
              e[r++] = t[i];
            return (e.length = r), e;
          },
          grep: function (e, t, n) {
            for (var i = [], r = 0, o = e.length, a = !n; r < o; r++)
              !t(e[r], r) !== a && i.push(e[r]);
            return i;
          },
          map: function (e, t, n) {
            var i,
              r,
              o = 0,
              s = [];
            if (C(e))
              for (i = e.length; o < i; o++)
                null != (r = t(e[o], o, n)) && s.push(r);
            else for (o in e) null != (r = t(e[o], o, n)) && s.push(r);
            return a.apply([], s);
          },
          guid: 1,
          support: f,
        }),
        "function" == typeof Symbol &&
          (w.fn[Symbol.iterator] = n[Symbol.iterator]),
        w.each(
          "Boolean Number String Function Array Date RegExp Object Error Symbol".split(
            " "
          ),
          function (e, t) {
            c["[object " + t + "]"] = t.toLowerCase();
          }
        );
      var F = (function (e) {
        var t,
          n,
          i,
          r,
          o,
          a,
          s,
          l,
          c,
          d,
          u,
          h,
          p,
          f,
          m,
          g,
          v,
          y,
          b,
          w = "sizzle" + 1 * new Date(),
          x = e.document,
          C = 0,
          F = 0,
          S = ae(),
          k = ae(),
          E = ae(),
          T = function (e, t) {
            return e === t && (u = !0), 0;
          },
          _ = {}.hasOwnProperty,
          A = [],
          M = A.pop,
          L = A.push,
          N = A.push,
          D = A.slice,
          B = function (e, t) {
            for (var n = 0, i = e.length; n < i; n++) if (e[n] === t) return n;
            return -1;
          },
          R =
            "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
          P = "[\\x20\\t\\r\\n\\f]",
          I = "(?:\\\\.|[\\w-]|[^\0-\\xa0])+",
          O =
            "\\[" +
            P +
            "*(" +
            I +
            ")(?:" +
            P +
            "*([*^$|!~]?=)" +
            P +
            "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" +
            I +
            "))|)" +
            P +
            "*\\]",
          $ =
            ":(" +
            I +
            ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" +
            O +
            ")*)|.*)\\)|)",
          H = new RegExp(P + "+", "g"),
          U = new RegExp(
            "^" + P + "+|((?:^|[^\\\\])(?:\\\\.)*)" + P + "+$",
            "g"
          ),
          j = new RegExp("^" + P + "*," + P + "*"),
          q = new RegExp("^" + P + "*([>+~]|" + P + ")" + P + "*"),
          W = new RegExp("=" + P + "*([^\\]'\"]*?)" + P + "*\\]", "g"),
          z = new RegExp($),
          V = new RegExp("^" + I + "$"),
          J = {
            ID: new RegExp("^#(" + I + ")"),
            CLASS: new RegExp("^\\.(" + I + ")"),
            TAG: new RegExp("^(" + I + "|[*])"),
            ATTR: new RegExp("^" + O),
            PSEUDO: new RegExp("^" + $),
            CHILD: new RegExp(
              "^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" +
                P +
                "*(even|odd|(([+-]|)(\\d*)n|)" +
                P +
                "*(?:([+-]|)" +
                P +
                "*(\\d+)|))" +
                P +
                "*\\)|)",
              "i"
            ),
            bool: new RegExp("^(?:" + R + ")$", "i"),
            needsContext: new RegExp(
              "^" +
                P +
                "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
                P +
                "*((?:-\\d)?\\d*)" +
                P +
                "*\\)|)(?=[^-]|$)",
              "i"
            ),
          },
          K = /^(?:input|select|textarea|button)$/i,
          Y = /^h\d$/i,
          G = /^[^{]+\{\s*\[native \w/,
          Q = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
          X = /[+~]/,
          Z = new RegExp("\\\\([\\da-f]{1,6}" + P + "?|(" + P + ")|.)", "ig"),
          ee = function (e, t, n) {
            var i = "0x" + t - 65536;
            return i != i || n
              ? t
              : i < 0
              ? String.fromCharCode(i + 65536)
              : String.fromCharCode((i >> 10) | 55296, (1023 & i) | 56320);
          },
          te = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,
          ne = function (e, t) {
            return t
              ? "\0" === e
                ? "�"
                : e.slice(0, -1) +
                  "\\" +
                  e.charCodeAt(e.length - 1).toString(16) +
                  " "
              : "\\" + e;
          },
          ie = function () {
            h();
          },
          re = ye(
            function (e) {
              return !0 === e.disabled && ("form" in e || "label" in e);
            },
            { dir: "parentNode", next: "legend" }
          );
        try {
          N.apply((A = D.call(x.childNodes)), x.childNodes),
            A[x.childNodes.length].nodeType;
        } catch (e) {
          N = {
            apply: A.length
              ? function (e, t) {
                  L.apply(e, D.call(t));
                }
              : function (e, t) {
                  for (var n = e.length, i = 0; (e[n++] = t[i++]); );
                  e.length = n - 1;
                },
          };
        }
        function oe(e, t, i, r) {
          var o,
            s,
            c,
            d,
            u,
            f,
            v,
            y = t && t.ownerDocument,
            C = t ? t.nodeType : 9;
          if (
            ((i = i || []),
            "string" != typeof e || !e || (1 !== C && 9 !== C && 11 !== C))
          )
            return i;
          if (
            !r &&
            ((t ? t.ownerDocument || t : x) !== p && h(t), (t = t || p), m)
          ) {
            if (11 !== C && (u = Q.exec(e)))
              if ((o = u[1])) {
                if (9 === C) {
                  if (!(c = t.getElementById(o))) return i;
                  if (c.id === o) return i.push(c), i;
                } else if (
                  y &&
                  (c = y.getElementById(o)) &&
                  b(t, c) &&
                  c.id === o
                )
                  return i.push(c), i;
              } else {
                if (u[2]) return N.apply(i, t.getElementsByTagName(e)), i;
                if (
                  (o = u[3]) &&
                  n.getElementsByClassName &&
                  t.getElementsByClassName
                )
                  return N.apply(i, t.getElementsByClassName(o)), i;
              }
            if (n.qsa && !E[e + " "] && (!g || !g.test(e))) {
              if (1 !== C) (y = t), (v = e);
              else if ("object" !== t.nodeName.toLowerCase()) {
                for (
                  (d = t.getAttribute("id"))
                    ? (d = d.replace(te, ne))
                    : t.setAttribute("id", (d = w)),
                    s = (f = a(e)).length;
                  s--;

                )
                  f[s] = "#" + d + " " + ve(f[s]);
                (v = f.join(",")), (y = (X.test(e) && me(t.parentNode)) || t);
              }
              if (v)
                try {
                  return N.apply(i, y.querySelectorAll(v)), i;
                } catch (e) {
                } finally {
                  d === w && t.removeAttribute("id");
                }
            }
          }
          return l(e.replace(U, "$1"), t, i, r);
        }
        function ae() {
          var e = [];
          return function t(n, r) {
            return (
              e.push(n + " ") > i.cacheLength && delete t[e.shift()],
              (t[n + " "] = r)
            );
          };
        }
        function se(e) {
          return (e[w] = !0), e;
        }
        function le(e) {
          var t = p.createElement("fieldset");
          try {
            return !!e(t);
          } catch (e) {
            return !1;
          } finally {
            t.parentNode && t.parentNode.removeChild(t), (t = null);
          }
        }
        function ce(e, t) {
          for (var n = e.split("|"), r = n.length; r--; )
            i.attrHandle[n[r]] = t;
        }
        function de(e, t) {
          var n = t && e,
            i =
              n &&
              1 === e.nodeType &&
              1 === t.nodeType &&
              e.sourceIndex - t.sourceIndex;
          if (i) return i;
          if (n) for (; (n = n.nextSibling); ) if (n === t) return -1;
          return e ? 1 : -1;
        }
        function ue(e) {
          return function (t) {
            return "input" === t.nodeName.toLowerCase() && t.type === e;
          };
        }
        function he(e) {
          return function (t) {
            var n = t.nodeName.toLowerCase();
            return ("input" === n || "button" === n) && t.type === e;
          };
        }
        function pe(e) {
          return function (t) {
            return "form" in t
              ? t.parentNode && !1 === t.disabled
                ? "label" in t
                  ? "label" in t.parentNode
                    ? t.parentNode.disabled === e
                    : t.disabled === e
                  : t.isDisabled === e || (t.isDisabled !== !e && re(t) === e)
                : t.disabled === e
              : "label" in t && t.disabled === e;
          };
        }
        function fe(e) {
          return se(function (t) {
            return (
              (t = +t),
              se(function (n, i) {
                for (var r, o = e([], n.length, t), a = o.length; a--; )
                  n[(r = o[a])] && (n[r] = !(i[r] = n[r]));
              })
            );
          });
        }
        function me(e) {
          return e && void 0 !== e.getElementsByTagName && e;
        }
        for (t in ((n = oe.support = {}),
        (o = oe.isXML =
          function (e) {
            var t = e && (e.ownerDocument || e).documentElement;
            return !!t && "HTML" !== t.nodeName;
          }),
        (h = oe.setDocument =
          function (e) {
            var t,
              r,
              a = e ? e.ownerDocument || e : x;
            return a !== p && 9 === a.nodeType && a.documentElement
              ? ((f = (p = a).documentElement),
                (m = !o(p)),
                x !== p &&
                  (r = p.defaultView) &&
                  r.top !== r &&
                  (r.addEventListener
                    ? r.addEventListener("unload", ie, !1)
                    : r.attachEvent && r.attachEvent("onunload", ie)),
                (n.attributes = le(function (e) {
                  return (e.className = "i"), !e.getAttribute("className");
                })),
                (n.getElementsByTagName = le(function (e) {
                  return (
                    e.appendChild(p.createComment("")),
                    !e.getElementsByTagName("*").length
                  );
                })),
                (n.getElementsByClassName = G.test(p.getElementsByClassName)),
                (n.getById = le(function (e) {
                  return (
                    (f.appendChild(e).id = w),
                    !p.getElementsByName || !p.getElementsByName(w).length
                  );
                })),
                n.getById
                  ? ((i.filter.ID = function (e) {
                      var t = e.replace(Z, ee);
                      return function (e) {
                        return e.getAttribute("id") === t;
                      };
                    }),
                    (i.find.ID = function (e, t) {
                      if (void 0 !== t.getElementById && m) {
                        var n = t.getElementById(e);
                        return n ? [n] : [];
                      }
                    }))
                  : ((i.filter.ID = function (e) {
                      var t = e.replace(Z, ee);
                      return function (e) {
                        var n =
                          void 0 !== e.getAttributeNode &&
                          e.getAttributeNode("id");
                        return n && n.value === t;
                      };
                    }),
                    (i.find.ID = function (e, t) {
                      if (void 0 !== t.getElementById && m) {
                        var n,
                          i,
                          r,
                          o = t.getElementById(e);
                        if (o) {
                          if ((n = o.getAttributeNode("id")) && n.value === e)
                            return [o];
                          for (
                            r = t.getElementsByName(e), i = 0;
                            (o = r[i++]);

                          )
                            if ((n = o.getAttributeNode("id")) && n.value === e)
                              return [o];
                        }
                        return [];
                      }
                    })),
                (i.find.TAG = n.getElementsByTagName
                  ? function (e, t) {
                      return void 0 !== t.getElementsByTagName
                        ? t.getElementsByTagName(e)
                        : n.qsa
                        ? t.querySelectorAll(e)
                        : void 0;
                    }
                  : function (e, t) {
                      var n,
                        i = [],
                        r = 0,
                        o = t.getElementsByTagName(e);
                      if ("*" === e) {
                        for (; (n = o[r++]); ) 1 === n.nodeType && i.push(n);
                        return i;
                      }
                      return o;
                    }),
                (i.find.CLASS =
                  n.getElementsByClassName &&
                  function (e, t) {
                    if (void 0 !== t.getElementsByClassName && m)
                      return t.getElementsByClassName(e);
                  }),
                (v = []),
                (g = []),
                (n.qsa = G.test(p.querySelectorAll)) &&
                  (le(function (e) {
                    (f.appendChild(e).innerHTML =
                      "<a id='" +
                      w +
                      "'></a><select id='" +
                      w +
                      "-\r\\' msallowcapture=''><option selected=''></option></select>"),
                      e.querySelectorAll("[msallowcapture^='']").length &&
                        g.push("[*^$]=" + P + "*(?:''|\"\")"),
                      e.querySelectorAll("[selected]").length ||
                        g.push("\\[" + P + "*(?:value|" + R + ")"),
                      e.querySelectorAll("[id~=" + w + "-]").length ||
                        g.push("~="),
                      e.querySelectorAll(":checked").length ||
                        g.push(":checked"),
                      e.querySelectorAll("a#" + w + "+*").length ||
                        g.push(".#.+[+~]");
                  }),
                  le(function (e) {
                    e.innerHTML =
                      "<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";
                    var t = p.createElement("input");
                    t.setAttribute("type", "hidden"),
                      e.appendChild(t).setAttribute("name", "D"),
                      e.querySelectorAll("[name=d]").length &&
                        g.push("name" + P + "*[*^$|!~]?="),
                      2 !== e.querySelectorAll(":enabled").length &&
                        g.push(":enabled", ":disabled"),
                      (f.appendChild(e).disabled = !0),
                      2 !== e.querySelectorAll(":disabled").length &&
                        g.push(":enabled", ":disabled"),
                      e.querySelectorAll("*,:x"),
                      g.push(",.*:");
                  })),
                (n.matchesSelector = G.test(
                  (y =
                    f.matches ||
                    f.webkitMatchesSelector ||
                    f.mozMatchesSelector ||
                    f.oMatchesSelector ||
                    f.msMatchesSelector)
                )) &&
                  le(function (e) {
                    (n.disconnectedMatch = y.call(e, "*")),
                      y.call(e, "[s!='']:x"),
                      v.push("!=", $);
                  }),
                (g = g.length && new RegExp(g.join("|"))),
                (v = v.length && new RegExp(v.join("|"))),
                (t = G.test(f.compareDocumentPosition)),
                (b =
                  t || G.test(f.contains)
                    ? function (e, t) {
                        var n = 9 === e.nodeType ? e.documentElement : e,
                          i = t && t.parentNode;
                        return (
                          e === i ||
                          !(
                            !i ||
                            1 !== i.nodeType ||
                            !(n.contains
                              ? n.contains(i)
                              : e.compareDocumentPosition &&
                                16 & e.compareDocumentPosition(i))
                          )
                        );
                      }
                    : function (e, t) {
                        if (t)
                          for (; (t = t.parentNode); ) if (t === e) return !0;
                        return !1;
                      }),
                (T = t
                  ? function (e, t) {
                      if (e === t) return (u = !0), 0;
                      var i =
                        !e.compareDocumentPosition - !t.compareDocumentPosition;
                      return (
                        i ||
                        (1 &
                          (i =
                            (e.ownerDocument || e) === (t.ownerDocument || t)
                              ? e.compareDocumentPosition(t)
                              : 1) ||
                        (!n.sortDetached && t.compareDocumentPosition(e) === i)
                          ? e === p || (e.ownerDocument === x && b(x, e))
                            ? -1
                            : t === p || (t.ownerDocument === x && b(x, t))
                            ? 1
                            : d
                            ? B(d, e) - B(d, t)
                            : 0
                          : 4 & i
                          ? -1
                          : 1)
                      );
                    }
                  : function (e, t) {
                      if (e === t) return (u = !0), 0;
                      var n,
                        i = 0,
                        r = e.parentNode,
                        o = t.parentNode,
                        a = [e],
                        s = [t];
                      if (!r || !o)
                        return e === p
                          ? -1
                          : t === p
                          ? 1
                          : r
                          ? -1
                          : o
                          ? 1
                          : d
                          ? B(d, e) - B(d, t)
                          : 0;
                      if (r === o) return de(e, t);
                      for (n = e; (n = n.parentNode); ) a.unshift(n);
                      for (n = t; (n = n.parentNode); ) s.unshift(n);
                      for (; a[i] === s[i]; ) i++;
                      return i
                        ? de(a[i], s[i])
                        : a[i] === x
                        ? -1
                        : s[i] === x
                        ? 1
                        : 0;
                    }),
                p)
              : p;
          }),
        (oe.matches = function (e, t) {
          return oe(e, null, null, t);
        }),
        (oe.matchesSelector = function (e, t) {
          if (
            ((e.ownerDocument || e) !== p && h(e),
            (t = t.replace(W, "='$1']")),
            n.matchesSelector &&
              m &&
              !E[t + " "] &&
              (!v || !v.test(t)) &&
              (!g || !g.test(t)))
          )
            try {
              var i = y.call(e, t);
              if (
                i ||
                n.disconnectedMatch ||
                (e.document && 11 !== e.document.nodeType)
              )
                return i;
            } catch (e) {}
          return oe(t, p, null, [e]).length > 0;
        }),
        (oe.contains = function (e, t) {
          return (e.ownerDocument || e) !== p && h(e), b(e, t);
        }),
        (oe.attr = function (e, t) {
          (e.ownerDocument || e) !== p && h(e);
          var r = i.attrHandle[t.toLowerCase()],
            o =
              r && _.call(i.attrHandle, t.toLowerCase()) ? r(e, t, !m) : void 0;
          return void 0 !== o
            ? o
            : n.attributes || !m
            ? e.getAttribute(t)
            : (o = e.getAttributeNode(t)) && o.specified
            ? o.value
            : null;
        }),
        (oe.escape = function (e) {
          return (e + "").replace(te, ne);
        }),
        (oe.error = function (e) {
          throw new Error("Syntax error, unrecognized expression: " + e);
        }),
        (oe.uniqueSort = function (e) {
          var t,
            i = [],
            r = 0,
            o = 0;
          if (
            ((u = !n.detectDuplicates),
            (d = !n.sortStable && e.slice(0)),
            e.sort(T),
            u)
          ) {
            for (; (t = e[o++]); ) t === e[o] && (r = i.push(o));
            for (; r--; ) e.splice(i[r], 1);
          }
          return (d = null), e;
        }),
        (r = oe.getText =
          function (e) {
            var t,
              n = "",
              i = 0,
              o = e.nodeType;
            if (o) {
              if (1 === o || 9 === o || 11 === o) {
                if ("string" == typeof e.textContent) return e.textContent;
                for (e = e.firstChild; e; e = e.nextSibling) n += r(e);
              } else if (3 === o || 4 === o) return e.nodeValue;
            } else for (; (t = e[i++]); ) n += r(t);
            return n;
          }),
        ((i = oe.selectors =
          {
            cacheLength: 50,
            createPseudo: se,
            match: J,
            attrHandle: {},
            find: {},
            relative: {
              ">": { dir: "parentNode", first: !0 },
              " ": { dir: "parentNode" },
              "+": { dir: "previousSibling", first: !0 },
              "~": { dir: "previousSibling" },
            },
            preFilter: {
              ATTR: function (e) {
                return (
                  (e[1] = e[1].replace(Z, ee)),
                  (e[3] = (e[3] || e[4] || e[5] || "").replace(Z, ee)),
                  "~=" === e[2] && (e[3] = " " + e[3] + " "),
                  e.slice(0, 4)
                );
              },
              CHILD: function (e) {
                return (
                  (e[1] = e[1].toLowerCase()),
                  "nth" === e[1].slice(0, 3)
                    ? (e[3] || oe.error(e[0]),
                      (e[4] = +(e[4]
                        ? e[5] + (e[6] || 1)
                        : 2 * ("even" === e[3] || "odd" === e[3]))),
                      (e[5] = +(e[7] + e[8] || "odd" === e[3])))
                    : e[3] && oe.error(e[0]),
                  e
                );
              },
              PSEUDO: function (e) {
                var t,
                  n = !e[6] && e[2];
                return J.CHILD.test(e[0])
                  ? null
                  : (e[3]
                      ? (e[2] = e[4] || e[5] || "")
                      : n &&
                        z.test(n) &&
                        (t = a(n, !0)) &&
                        (t = n.indexOf(")", n.length - t) - n.length) &&
                        ((e[0] = e[0].slice(0, t)), (e[2] = n.slice(0, t))),
                    e.slice(0, 3));
              },
            },
            filter: {
              TAG: function (e) {
                var t = e.replace(Z, ee).toLowerCase();
                return "*" === e
                  ? function () {
                      return !0;
                    }
                  : function (e) {
                      return e.nodeName && e.nodeName.toLowerCase() === t;
                    };
              },
              CLASS: function (e) {
                var t = S[e + " "];
                return (
                  t ||
                  ((t = new RegExp("(^|" + P + ")" + e + "(" + P + "|$)")) &&
                    S(e, function (e) {
                      return t.test(
                        ("string" == typeof e.className && e.className) ||
                          (void 0 !== e.getAttribute &&
                            e.getAttribute("class")) ||
                          ""
                      );
                    }))
                );
              },
              ATTR: function (e, t, n) {
                return function (i) {
                  var r = oe.attr(i, e);
                  return null == r
                    ? "!=" === t
                    : !t ||
                        ((r += ""),
                        "=" === t
                          ? r === n
                          : "!=" === t
                          ? r !== n
                          : "^=" === t
                          ? n && 0 === r.indexOf(n)
                          : "*=" === t
                          ? n && r.indexOf(n) > -1
                          : "$=" === t
                          ? n && r.slice(-n.length) === n
                          : "~=" === t
                          ? (" " + r.replace(H, " ") + " ").indexOf(n) > -1
                          : "|=" === t &&
                            (r === n || r.slice(0, n.length + 1) === n + "-"));
                };
              },
              CHILD: function (e, t, n, i, r) {
                var o = "nth" !== e.slice(0, 3),
                  a = "last" !== e.slice(-4),
                  s = "of-type" === t;
                return 1 === i && 0 === r
                  ? function (e) {
                      return !!e.parentNode;
                    }
                  : function (t, n, l) {
                      var c,
                        d,
                        u,
                        h,
                        p,
                        f,
                        m = o !== a ? "nextSibling" : "previousSibling",
                        g = t.parentNode,
                        v = s && t.nodeName.toLowerCase(),
                        y = !l && !s,
                        b = !1;
                      if (g) {
                        if (o) {
                          for (; m; ) {
                            for (h = t; (h = h[m]); )
                              if (
                                s
                                  ? h.nodeName.toLowerCase() === v
                                  : 1 === h.nodeType
                              )
                                return !1;
                            f = m = "only" === e && !f && "nextSibling";
                          }
                          return !0;
                        }
                        if (((f = [a ? g.firstChild : g.lastChild]), a && y)) {
                          for (
                            b =
                              (p =
                                (c =
                                  (d =
                                    (u = (h = g)[w] || (h[w] = {}))[
                                      h.uniqueID
                                    ] || (u[h.uniqueID] = {}))[e] || [])[0] ===
                                  C && c[1]) && c[2],
                              h = p && g.childNodes[p];
                            (h = (++p && h && h[m]) || (b = p = 0) || f.pop());

                          )
                            if (1 === h.nodeType && ++b && h === t) {
                              d[e] = [C, p, b];
                              break;
                            }
                        } else if (
                          (y &&
                            (b = p =
                              (c =
                                (d =
                                  (u = (h = t)[w] || (h[w] = {}))[h.uniqueID] ||
                                  (u[h.uniqueID] = {}))[e] || [])[0] === C &&
                              c[1]),
                          !1 === b)
                        )
                          for (
                            ;
                            (h =
                              (++p && h && h[m]) || (b = p = 0) || f.pop()) &&
                            ((s
                              ? h.nodeName.toLowerCase() !== v
                              : 1 !== h.nodeType) ||
                              !++b ||
                              (y &&
                                ((d =
                                  (u = h[w] || (h[w] = {}))[h.uniqueID] ||
                                  (u[h.uniqueID] = {}))[e] = [C, b]),
                              h !== t));

                          );
                        return (b -= r) === i || (b % i == 0 && b / i >= 0);
                      }
                    };
              },
              PSEUDO: function (e, t) {
                var n,
                  r =
                    i.pseudos[e] ||
                    i.setFilters[e.toLowerCase()] ||
                    oe.error("unsupported pseudo: " + e);
                return r[w]
                  ? r(t)
                  : r.length > 1
                  ? ((n = [e, e, "", t]),
                    i.setFilters.hasOwnProperty(e.toLowerCase())
                      ? se(function (e, n) {
                          for (var i, o = r(e, t), a = o.length; a--; )
                            e[(i = B(e, o[a]))] = !(n[i] = o[a]);
                        })
                      : function (e) {
                          return r(e, 0, n);
                        })
                  : r;
              },
            },
            pseudos: {
              not: se(function (e) {
                var t = [],
                  n = [],
                  i = s(e.replace(U, "$1"));
                return i[w]
                  ? se(function (e, t, n, r) {
                      for (var o, a = i(e, null, r, []), s = e.length; s--; )
                        (o = a[s]) && (e[s] = !(t[s] = o));
                    })
                  : function (e, r, o) {
                      return (
                        (t[0] = e), i(t, null, o, n), (t[0] = null), !n.pop()
                      );
                    };
              }),
              has: se(function (e) {
                return function (t) {
                  return oe(e, t).length > 0;
                };
              }),
              contains: se(function (e) {
                return (
                  (e = e.replace(Z, ee)),
                  function (t) {
                    return (
                      (t.textContent || t.innerText || r(t)).indexOf(e) > -1
                    );
                  }
                );
              }),
              lang: se(function (e) {
                return (
                  V.test(e || "") || oe.error("unsupported lang: " + e),
                  (e = e.replace(Z, ee).toLowerCase()),
                  function (t) {
                    var n;
                    do {
                      if (
                        (n = m
                          ? t.lang
                          : t.getAttribute("xml:lang") ||
                            t.getAttribute("lang"))
                      )
                        return (
                          (n = n.toLowerCase()) === e ||
                          0 === n.indexOf(e + "-")
                        );
                    } while ((t = t.parentNode) && 1 === t.nodeType);
                    return !1;
                  }
                );
              }),
              target: function (t) {
                var n = e.location && e.location.hash;
                return n && n.slice(1) === t.id;
              },
              root: function (e) {
                return e === f;
              },
              focus: function (e) {
                return (
                  e === p.activeElement &&
                  (!p.hasFocus || p.hasFocus()) &&
                  !!(e.type || e.href || ~e.tabIndex)
                );
              },
              enabled: pe(!1),
              disabled: pe(!0),
              checked: function (e) {
                var t = e.nodeName.toLowerCase();
                return (
                  ("input" === t && !!e.checked) ||
                  ("option" === t && !!e.selected)
                );
              },
              selected: function (e) {
                return (
                  e.parentNode && e.parentNode.selectedIndex, !0 === e.selected
                );
              },
              empty: function (e) {
                for (e = e.firstChild; e; e = e.nextSibling)
                  if (e.nodeType < 6) return !1;
                return !0;
              },
              parent: function (e) {
                return !i.pseudos.empty(e);
              },
              header: function (e) {
                return Y.test(e.nodeName);
              },
              input: function (e) {
                return K.test(e.nodeName);
              },
              button: function (e) {
                var t = e.nodeName.toLowerCase();
                return ("input" === t && "button" === e.type) || "button" === t;
              },
              text: function (e) {
                var t;
                return (
                  "input" === e.nodeName.toLowerCase() &&
                  "text" === e.type &&
                  (null == (t = e.getAttribute("type")) ||
                    "text" === t.toLowerCase())
                );
              },
              first: fe(function () {
                return [0];
              }),
              last: fe(function (e, t) {
                return [t - 1];
              }),
              eq: fe(function (e, t, n) {
                return [n < 0 ? n + t : n];
              }),
              even: fe(function (e, t) {
                for (var n = 0; n < t; n += 2) e.push(n);
                return e;
              }),
              odd: fe(function (e, t) {
                for (var n = 1; n < t; n += 2) e.push(n);
                return e;
              }),
              lt: fe(function (e, t, n) {
                for (var i = n < 0 ? n + t : n; --i >= 0; ) e.push(i);
                return e;
              }),
              gt: fe(function (e, t, n) {
                for (var i = n < 0 ? n + t : n; ++i < t; ) e.push(i);
                return e;
              }),
            },
          }).pseudos.nth = i.pseudos.eq),
        { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }))
          i.pseudos[t] = ue(t);
        for (t in { submit: !0, reset: !0 }) i.pseudos[t] = he(t);
        function ge() {}
        function ve(e) {
          for (var t = 0, n = e.length, i = ""; t < n; t++) i += e[t].value;
          return i;
        }
        function ye(e, t, n) {
          var i = t.dir,
            r = t.next,
            o = r || i,
            a = n && "parentNode" === o,
            s = F++;
          return t.first
            ? function (t, n, r) {
                for (; (t = t[i]); )
                  if (1 === t.nodeType || a) return e(t, n, r);
                return !1;
              }
            : function (t, n, l) {
                var c,
                  d,
                  u,
                  h = [C, s];
                if (l) {
                  for (; (t = t[i]); )
                    if ((1 === t.nodeType || a) && e(t, n, l)) return !0;
                } else
                  for (; (t = t[i]); )
                    if (1 === t.nodeType || a)
                      if (
                        ((d =
                          (u = t[w] || (t[w] = {}))[t.uniqueID] ||
                          (u[t.uniqueID] = {})),
                        r && r === t.nodeName.toLowerCase())
                      )
                        t = t[i] || t;
                      else {
                        if ((c = d[o]) && c[0] === C && c[1] === s)
                          return (h[2] = c[2]);
                        if (((d[o] = h), (h[2] = e(t, n, l)))) return !0;
                      }
                return !1;
              };
        }
        function be(e) {
          return e.length > 1
            ? function (t, n, i) {
                for (var r = e.length; r--; ) if (!e[r](t, n, i)) return !1;
                return !0;
              }
            : e[0];
        }
        function we(e, t, n, i, r) {
          for (var o, a = [], s = 0, l = e.length, c = null != t; s < l; s++)
            (o = e[s]) && ((n && !n(o, i, r)) || (a.push(o), c && t.push(s)));
          return a;
        }
        function xe(e, t, n, i, r, o) {
          return (
            i && !i[w] && (i = xe(i)),
            r && !r[w] && (r = xe(r, o)),
            se(function (o, a, s, l) {
              var c,
                d,
                u,
                h = [],
                p = [],
                f = a.length,
                m =
                  o ||
                  (function (e, t, n) {
                    for (var i = 0, r = t.length; i < r; i++) oe(e, t[i], n);
                    return n;
                  })(t || "*", s.nodeType ? [s] : s, []),
                g = !e || (!o && t) ? m : we(m, h, e, s, l),
                v = n ? (r || (o ? e : f || i) ? [] : a) : g;
              if ((n && n(g, v, s, l), i))
                for (c = we(v, p), i(c, [], s, l), d = c.length; d--; )
                  (u = c[d]) && (v[p[d]] = !(g[p[d]] = u));
              if (o) {
                if (r || e) {
                  if (r) {
                    for (c = [], d = v.length; d--; )
                      (u = v[d]) && c.push((g[d] = u));
                    r(null, (v = []), c, l);
                  }
                  for (d = v.length; d--; )
                    (u = v[d]) &&
                      (c = r ? B(o, u) : h[d]) > -1 &&
                      (o[c] = !(a[c] = u));
                }
              } else (v = we(v === a ? v.splice(f, v.length) : v)), r ? r(null, a, v, l) : N.apply(a, v);
            })
          );
        }
        function Ce(e) {
          for (
            var t,
              n,
              r,
              o = e.length,
              a = i.relative[e[0].type],
              s = a || i.relative[" "],
              l = a ? 1 : 0,
              d = ye(
                function (e) {
                  return e === t;
                },
                s,
                !0
              ),
              u = ye(
                function (e) {
                  return B(t, e) > -1;
                },
                s,
                !0
              ),
              h = [
                function (e, n, i) {
                  var r =
                    (!a && (i || n !== c)) ||
                    ((t = n).nodeType ? d(e, n, i) : u(e, n, i));
                  return (t = null), r;
                },
              ];
            l < o;
            l++
          )
            if ((n = i.relative[e[l].type])) h = [ye(be(h), n)];
            else {
              if ((n = i.filter[e[l].type].apply(null, e[l].matches))[w]) {
                for (r = ++l; r < o && !i.relative[e[r].type]; r++);
                return xe(
                  l > 1 && be(h),
                  l > 1 &&
                    ve(
                      e
                        .slice(0, l - 1)
                        .concat({ value: " " === e[l - 2].type ? "*" : "" })
                    ).replace(U, "$1"),
                  n,
                  l < r && Ce(e.slice(l, r)),
                  r < o && Ce((e = e.slice(r))),
                  r < o && ve(e)
                );
              }
              h.push(n);
            }
          return be(h);
        }
        function Fe(e, t) {
          var n = t.length > 0,
            r = e.length > 0,
            o = function (o, a, s, l, d) {
              var u,
                f,
                g,
                v = 0,
                y = "0",
                b = o && [],
                w = [],
                x = c,
                F = o || (r && i.find.TAG("*", d)),
                S = (C += null == x ? 1 : Math.random() || 0.1),
                k = F.length;
              for (
                d && (c = a === p || a || d);
                y !== k && null != (u = F[y]);
                y++
              ) {
                if (r && u) {
                  for (
                    f = 0, a || u.ownerDocument === p || (h(u), (s = !m));
                    (g = e[f++]);

                  )
                    if (g(u, a || p, s)) {
                      l.push(u);
                      break;
                    }
                  d && (C = S);
                }
                n && ((u = !g && u) && v--, o && b.push(u));
              }
              if (((v += y), n && y !== v)) {
                for (f = 0; (g = t[f++]); ) g(b, w, a, s);
                if (o) {
                  if (v > 0) for (; y--; ) b[y] || w[y] || (w[y] = M.call(l));
                  w = we(w);
                }
                N.apply(l, w),
                  d &&
                    !o &&
                    w.length > 0 &&
                    v + t.length > 1 &&
                    oe.uniqueSort(l);
              }
              return d && ((C = S), (c = x)), b;
            };
          return n ? se(o) : o;
        }
        return (
          (ge.prototype = i.filters = i.pseudos),
          (i.setFilters = new ge()),
          (a = oe.tokenize =
            function (e, t) {
              var n,
                r,
                o,
                a,
                s,
                l,
                c,
                d = k[e + " "];
              if (d) return t ? 0 : d.slice(0);
              for (s = e, l = [], c = i.preFilter; s; ) {
                for (a in ((n && !(r = j.exec(s))) ||
                  (r && (s = s.slice(r[0].length) || s), l.push((o = []))),
                (n = !1),
                (r = q.exec(s)) &&
                  ((n = r.shift()),
                  o.push({ value: n, type: r[0].replace(U, " ") }),
                  (s = s.slice(n.length))),
                i.filter))
                  !(r = J[a].exec(s)) ||
                    (c[a] && !(r = c[a](r))) ||
                    ((n = r.shift()),
                    o.push({ value: n, type: a, matches: r }),
                    (s = s.slice(n.length)));
                if (!n) break;
              }
              return t ? s.length : s ? oe.error(e) : k(e, l).slice(0);
            }),
          (s = oe.compile =
            function (e, t) {
              var n,
                i = [],
                r = [],
                o = E[e + " "];
              if (!o) {
                for (t || (t = a(e)), n = t.length; n--; )
                  (o = Ce(t[n]))[w] ? i.push(o) : r.push(o);
                (o = E(e, Fe(r, i))).selector = e;
              }
              return o;
            }),
          (l = oe.select =
            function (e, t, n, r) {
              var o,
                l,
                c,
                d,
                u,
                h = "function" == typeof e && e,
                p = !r && a((e = h.selector || e));
              if (((n = n || []), 1 === p.length)) {
                if (
                  (l = p[0] = p[0].slice(0)).length > 2 &&
                  "ID" === (c = l[0]).type &&
                  9 === t.nodeType &&
                  m &&
                  i.relative[l[1].type]
                ) {
                  if (
                    !(t = (i.find.ID(c.matches[0].replace(Z, ee), t) || [])[0])
                  )
                    return n;
                  h && (t = t.parentNode),
                    (e = e.slice(l.shift().value.length));
                }
                for (
                  o = J.needsContext.test(e) ? 0 : l.length;
                  o-- && ((c = l[o]), !i.relative[(d = c.type)]);

                )
                  if (
                    (u = i.find[d]) &&
                    (r = u(
                      c.matches[0].replace(Z, ee),
                      (X.test(l[0].type) && me(t.parentNode)) || t
                    ))
                  ) {
                    if ((l.splice(o, 1), !(e = r.length && ve(l))))
                      return N.apply(n, r), n;
                    break;
                  }
              }
              return (
                (h || s(e, p))(
                  r,
                  t,
                  !m,
                  n,
                  !t || (X.test(e) && me(t.parentNode)) || t
                ),
                n
              );
            }),
          (n.sortStable = w.split("").sort(T).join("") === w),
          (n.detectDuplicates = !!u),
          h(),
          (n.sortDetached = le(function (e) {
            return 1 & e.compareDocumentPosition(p.createElement("fieldset"));
          })),
          le(function (e) {
            return (
              (e.innerHTML = "<a href='#'></a>"),
              "#" === e.firstChild.getAttribute("href")
            );
          }) ||
            ce("type|href|height|width", function (e, t, n) {
              if (!n)
                return e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2);
            }),
          (n.attributes &&
            le(function (e) {
              return (
                (e.innerHTML = "<input/>"),
                e.firstChild.setAttribute("value", ""),
                "" === e.firstChild.getAttribute("value")
              );
            })) ||
            ce("value", function (e, t, n) {
              if (!n && "input" === e.nodeName.toLowerCase())
                return e.defaultValue;
            }),
          le(function (e) {
            return null == e.getAttribute("disabled");
          }) ||
            ce(R, function (e, t, n) {
              var i;
              if (!n)
                return !0 === e[t]
                  ? t.toLowerCase()
                  : (i = e.getAttributeNode(t)) && i.specified
                  ? i.value
                  : null;
            }),
          oe
        );
      })(e);
      (w.find = F),
        (w.expr = F.selectors),
        (w.expr[":"] = w.expr.pseudos),
        (w.uniqueSort = w.unique = F.uniqueSort),
        (w.text = F.getText),
        (w.isXMLDoc = F.isXML),
        (w.contains = F.contains),
        (w.escapeSelector = F.escape);
      var S = function (e, t, n) {
          for (var i = [], r = void 0 !== n; (e = e[t]) && 9 !== e.nodeType; )
            if (1 === e.nodeType) {
              if (r && w(e).is(n)) break;
              i.push(e);
            }
          return i;
        },
        k = function (e, t) {
          for (var n = []; e; e = e.nextSibling)
            1 === e.nodeType && e !== t && n.push(e);
          return n;
        },
        E = w.expr.match.needsContext;
      function T(e, t) {
        return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase();
      }
      var _ = /^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;
      function A(e, t, n) {
        return m(t)
          ? w.grep(e, function (e, i) {
              return !!t.call(e, i, e) !== n;
            })
          : t.nodeType
          ? w.grep(e, function (e) {
              return (e === t) !== n;
            })
          : "string" != typeof t
          ? w.grep(e, function (e) {
              return l.call(t, e) > -1 !== n;
            })
          : w.filter(t, e, n);
      }
      (w.filter = function (e, t, n) {
        var i = t[0];
        return (
          n && (e = ":not(" + e + ")"),
          1 === t.length && 1 === i.nodeType
            ? w.find.matchesSelector(i, e)
              ? [i]
              : []
            : w.find.matches(
                e,
                w.grep(t, function (e) {
                  return 1 === e.nodeType;
                })
              )
        );
      }),
        w.fn.extend({
          find: function (e) {
            var t,
              n,
              i = this.length,
              r = this;
            if ("string" != typeof e)
              return this.pushStack(
                w(e).filter(function () {
                  for (t = 0; t < i; t++) if (w.contains(r[t], this)) return !0;
                })
              );
            for (n = this.pushStack([]), t = 0; t < i; t++) w.find(e, r[t], n);
            return i > 1 ? w.uniqueSort(n) : n;
          },
          filter: function (e) {
            return this.pushStack(A(this, e || [], !1));
          },
          not: function (e) {
            return this.pushStack(A(this, e || [], !0));
          },
          is: function (e) {
            return !!A(
              this,
              "string" == typeof e && E.test(e) ? w(e) : e || [],
              !1
            ).length;
          },
        });
      var M,
        L = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;
      ((w.fn.init = function (e, t, n) {
        var r, o;
        if (!e) return this;
        if (((n = n || M), "string" == typeof e)) {
          if (
            !(r =
              "<" === e[0] && ">" === e[e.length - 1] && e.length >= 3
                ? [null, e, null]
                : L.exec(e)) ||
            (!r[1] && t)
          )
            return !t || t.jquery
              ? (t || n).find(e)
              : this.constructor(t).find(e);
          if (r[1]) {
            if (
              ((t = t instanceof w ? t[0] : t),
              w.merge(
                this,
                w.parseHTML(
                  r[1],
                  t && t.nodeType ? t.ownerDocument || t : i,
                  !0
                )
              ),
              _.test(r[1]) && w.isPlainObject(t))
            )
              for (r in t) m(this[r]) ? this[r](t[r]) : this.attr(r, t[r]);
            return this;
          }
          return (
            (o = i.getElementById(r[2])) && ((this[0] = o), (this.length = 1)),
            this
          );
        }
        return e.nodeType
          ? ((this[0] = e), (this.length = 1), this)
          : m(e)
          ? void 0 !== n.ready
            ? n.ready(e)
            : e(w)
          : w.makeArray(e, this);
      }).prototype = w.fn),
        (M = w(i));
      var N = /^(?:parents|prev(?:Until|All))/,
        D = { children: !0, contents: !0, next: !0, prev: !0 };
      function B(e, t) {
        for (; (e = e[t]) && 1 !== e.nodeType; );
        return e;
      }
      w.fn.extend({
        has: function (e) {
          var t = w(e, this),
            n = t.length;
          return this.filter(function () {
            for (var e = 0; e < n; e++) if (w.contains(this, t[e])) return !0;
          });
        },
        closest: function (e, t) {
          var n,
            i = 0,
            r = this.length,
            o = [],
            a = "string" != typeof e && w(e);
          if (!E.test(e))
            for (; i < r; i++)
              for (n = this[i]; n && n !== t; n = n.parentNode)
                if (
                  n.nodeType < 11 &&
                  (a
                    ? a.index(n) > -1
                    : 1 === n.nodeType && w.find.matchesSelector(n, e))
                ) {
                  o.push(n);
                  break;
                }
          return this.pushStack(o.length > 1 ? w.uniqueSort(o) : o);
        },
        index: function (e) {
          return e
            ? "string" == typeof e
              ? l.call(w(e), this[0])
              : l.call(this, e.jquery ? e[0] : e)
            : this[0] && this[0].parentNode
            ? this.first().prevAll().length
            : -1;
        },
        add: function (e, t) {
          return this.pushStack(w.uniqueSort(w.merge(this.get(), w(e, t))));
        },
        addBack: function (e) {
          return this.add(
            null == e ? this.prevObject : this.prevObject.filter(e)
          );
        },
      }),
        w.each(
          {
            parent: function (e) {
              var t = e.parentNode;
              return t && 11 !== t.nodeType ? t : null;
            },
            parents: function (e) {
              return S(e, "parentNode");
            },
            parentsUntil: function (e, t, n) {
              return S(e, "parentNode", n);
            },
            next: function (e) {
              return B(e, "nextSibling");
            },
            prev: function (e) {
              return B(e, "previousSibling");
            },
            nextAll: function (e) {
              return S(e, "nextSibling");
            },
            prevAll: function (e) {
              return S(e, "previousSibling");
            },
            nextUntil: function (e, t, n) {
              return S(e, "nextSibling", n);
            },
            prevUntil: function (e, t, n) {
              return S(e, "previousSibling", n);
            },
            siblings: function (e) {
              return k((e.parentNode || {}).firstChild, e);
            },
            children: function (e) {
              return k(e.firstChild);
            },
            contents: function (e) {
              return T(e, "iframe")
                ? e.contentDocument
                : (T(e, "template") && (e = e.content || e),
                  w.merge([], e.childNodes));
            },
          },
          function (e, t) {
            w.fn[e] = function (n, i) {
              var r = w.map(this, t, n);
              return (
                "Until" !== e.slice(-5) && (i = n),
                i && "string" == typeof i && (r = w.filter(i, r)),
                this.length > 1 &&
                  (D[e] || w.uniqueSort(r), N.test(e) && r.reverse()),
                this.pushStack(r)
              );
            };
          }
        );
      var R = /[^\x20\t\r\n\f]+/g;
      function P(e) {
        return e;
      }
      function I(e) {
        throw e;
      }
      function O(e, t, n, i) {
        var r;
        try {
          e && m((r = e.promise))
            ? r.call(e).done(t).fail(n)
            : e && m((r = e.then))
            ? r.call(e, t, n)
            : t.apply(void 0, [e].slice(i));
        } catch (e) {
          n.apply(void 0, [e]);
        }
      }
      (w.Callbacks = function (e) {
        e =
          "string" == typeof e
            ? (function (e) {
                var t = {};
                return (
                  w.each(e.match(R) || [], function (e, n) {
                    t[n] = !0;
                  }),
                  t
                );
              })(e)
            : w.extend({}, e);
        var t,
          n,
          i,
          r,
          o = [],
          a = [],
          s = -1,
          l = function () {
            for (r = r || e.once, i = t = !0; a.length; s = -1)
              for (n = a.shift(); ++s < o.length; )
                !1 === o[s].apply(n[0], n[1]) &&
                  e.stopOnFalse &&
                  ((s = o.length), (n = !1));
            e.memory || (n = !1), (t = !1), r && (o = n ? [] : "");
          },
          c = {
            add: function () {
              return (
                o &&
                  (n && !t && ((s = o.length - 1), a.push(n)),
                  (function t(n) {
                    w.each(n, function (n, i) {
                      m(i)
                        ? (e.unique && c.has(i)) || o.push(i)
                        : i && i.length && "string" !== b(i) && t(i);
                    });
                  })(arguments),
                  n && !t && l()),
                this
              );
            },
            remove: function () {
              return (
                w.each(arguments, function (e, t) {
                  for (var n; (n = w.inArray(t, o, n)) > -1; )
                    o.splice(n, 1), n <= s && s--;
                }),
                this
              );
            },
            has: function (e) {
              return e ? w.inArray(e, o) > -1 : o.length > 0;
            },
            empty: function () {
              return o && (o = []), this;
            },
            disable: function () {
              return (r = a = []), (o = n = ""), this;
            },
            disabled: function () {
              return !o;
            },
            lock: function () {
              return (r = a = []), n || t || (o = n = ""), this;
            },
            locked: function () {
              return !!r;
            },
            fireWith: function (e, n) {
              return (
                r ||
                  ((n = [e, (n = n || []).slice ? n.slice() : n]),
                  a.push(n),
                  t || l()),
                this
              );
            },
            fire: function () {
              return c.fireWith(this, arguments), this;
            },
            fired: function () {
              return !!i;
            },
          };
        return c;
      }),
        w.extend({
          Deferred: function (t) {
            var n = [
                [
                  "notify",
                  "progress",
                  w.Callbacks("memory"),
                  w.Callbacks("memory"),
                  2,
                ],
                [
                  "resolve",
                  "done",
                  w.Callbacks("once memory"),
                  w.Callbacks("once memory"),
                  0,
                  "resolved",
                ],
                [
                  "reject",
                  "fail",
                  w.Callbacks("once memory"),
                  w.Callbacks("once memory"),
                  1,
                  "rejected",
                ],
              ],
              i = "pending",
              r = {
                state: function () {
                  return i;
                },
                always: function () {
                  return o.done(arguments).fail(arguments), this;
                },
                catch: function (e) {
                  return r.then(null, e);
                },
                pipe: function () {
                  var e = arguments;
                  return w
                    .Deferred(function (t) {
                      w.each(n, function (n, i) {
                        var r = m(e[i[4]]) && e[i[4]];
                        o[i[1]](function () {
                          var e = r && r.apply(this, arguments);
                          e && m(e.promise)
                            ? e
                                .promise()
                                .progress(t.notify)
                                .done(t.resolve)
                                .fail(t.reject)
                            : t[i[0] + "With"](this, r ? [e] : arguments);
                        });
                      }),
                        (e = null);
                    })
                    .promise();
                },
                then: function (t, i, r) {
                  var o = 0;
                  function a(t, n, i, r) {
                    return function () {
                      var s = this,
                        l = arguments,
                        c = function () {
                          var e, c;
                          if (!(t < o)) {
                            if ((e = i.apply(s, l)) === n.promise())
                              throw new TypeError("Thenable self-resolution");
                            (c =
                              e &&
                              ("object" == typeof e ||
                                "function" == typeof e) &&
                              e.then),
                              m(c)
                                ? r
                                  ? c.call(e, a(o, n, P, r), a(o, n, I, r))
                                  : (o++,
                                    c.call(
                                      e,
                                      a(o, n, P, r),
                                      a(o, n, I, r),
                                      a(o, n, P, n.notifyWith)
                                    ))
                                : (i !== P && ((s = void 0), (l = [e])),
                                  (r || n.resolveWith)(s, l));
                          }
                        },
                        d = r
                          ? c
                          : function () {
                              try {
                                c();
                              } catch (e) {
                                w.Deferred.exceptionHook &&
                                  w.Deferred.exceptionHook(e, d.stackTrace),
                                  t + 1 >= o &&
                                    (i !== I && ((s = void 0), (l = [e])),
                                    n.rejectWith(s, l));
                              }
                            };
                      t
                        ? d()
                        : (w.Deferred.getStackHook &&
                            (d.stackTrace = w.Deferred.getStackHook()),
                          e.setTimeout(d));
                    };
                  }
                  return w
                    .Deferred(function (e) {
                      n[0][3].add(a(0, e, m(r) ? r : P, e.notifyWith)),
                        n[1][3].add(a(0, e, m(t) ? t : P)),
                        n[2][3].add(a(0, e, m(i) ? i : I));
                    })
                    .promise();
                },
                promise: function (e) {
                  return null != e ? w.extend(e, r) : r;
                },
              },
              o = {};
            return (
              w.each(n, function (e, t) {
                var a = t[2],
                  s = t[5];
                (r[t[1]] = a.add),
                  s &&
                    a.add(
                      function () {
                        i = s;
                      },
                      n[3 - e][2].disable,
                      n[3 - e][3].disable,
                      n[0][2].lock,
                      n[0][3].lock
                    ),
                  a.add(t[3].fire),
                  (o[t[0]] = function () {
                    return (
                      o[t[0] + "With"](this === o ? void 0 : this, arguments),
                      this
                    );
                  }),
                  (o[t[0] + "With"] = a.fireWith);
              }),
              r.promise(o),
              t && t.call(o, o),
              o
            );
          },
          when: function (e) {
            var t = arguments.length,
              n = t,
              i = Array(n),
              r = o.call(arguments),
              a = w.Deferred(),
              s = function (e) {
                return function (n) {
                  (i[e] = this),
                    (r[e] = arguments.length > 1 ? o.call(arguments) : n),
                    --t || a.resolveWith(i, r);
                };
              };
            if (
              t <= 1 &&
              (O(e, a.done(s(n)).resolve, a.reject, !t),
              "pending" === a.state() || m(r[n] && r[n].then))
            )
              return a.then();
            for (; n--; ) O(r[n], s(n), a.reject);
            return a.promise();
          },
        });
      var $ = /^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;
      (w.Deferred.exceptionHook = function (t, n) {
        e.console &&
          e.console.warn &&
          t &&
          $.test(t.name) &&
          e.console.warn("jQuery.Deferred exception: " + t.message, t.stack, n);
      }),
        (w.readyException = function (t) {
          e.setTimeout(function () {
            throw t;
          });
        });
      var H = w.Deferred();
      function U() {
        i.removeEventListener("DOMContentLoaded", U),
          e.removeEventListener("load", U),
          w.ready();
      }
      (w.fn.ready = function (e) {
        return (
          H.then(e).catch(function (e) {
            w.readyException(e);
          }),
          this
        );
      }),
        w.extend({
          isReady: !1,
          readyWait: 1,
          ready: function (e) {
            (!0 === e ? --w.readyWait : w.isReady) ||
              ((w.isReady = !0),
              (!0 !== e && --w.readyWait > 0) || H.resolveWith(i, [w]));
          },
        }),
        (w.ready.then = H.then),
        "complete" === i.readyState ||
        ("loading" !== i.readyState && !i.documentElement.doScroll)
          ? e.setTimeout(w.ready)
          : (i.addEventListener("DOMContentLoaded", U),
            e.addEventListener("load", U));
      var j = function (e, t, n, i, r, o, a) {
          var s = 0,
            l = e.length,
            c = null == n;
          if ("object" === b(n))
            for (s in ((r = !0), n)) j(e, t, s, n[s], !0, o, a);
          else if (
            void 0 !== i &&
            ((r = !0),
            m(i) || (a = !0),
            c &&
              (a
                ? (t.call(e, i), (t = null))
                : ((c = t),
                  (t = function (e, t, n) {
                    return c.call(w(e), n);
                  }))),
            t)
          )
            for (; s < l; s++) t(e[s], n, a ? i : i.call(e[s], s, t(e[s], n)));
          return r ? e : c ? t.call(e) : l ? t(e[0], n) : o;
        },
        q = /^-ms-/,
        W = /-([a-z])/g;
      function z(e, t) {
        return t.toUpperCase();
      }
      function V(e) {
        return e.replace(q, "ms-").replace(W, z);
      }
      var J = function (e) {
        return 1 === e.nodeType || 9 === e.nodeType || !+e.nodeType;
      };
      function K() {
        this.expando = w.expando + K.uid++;
      }
      (K.uid = 1),
        (K.prototype = {
          cache: function (e) {
            var t = e[this.expando];
            return (
              t ||
                ((t = {}),
                J(e) &&
                  (e.nodeType
                    ? (e[this.expando] = t)
                    : Object.defineProperty(e, this.expando, {
                        value: t,
                        configurable: !0,
                      }))),
              t
            );
          },
          set: function (e, t, n) {
            var i,
              r = this.cache(e);
            if ("string" == typeof t) r[V(t)] = n;
            else for (i in t) r[V(i)] = t[i];
            return r;
          },
          get: function (e, t) {
            return void 0 === t
              ? this.cache(e)
              : e[this.expando] && e[this.expando][V(t)];
          },
          access: function (e, t, n) {
            return void 0 === t || (t && "string" == typeof t && void 0 === n)
              ? this.get(e, t)
              : (this.set(e, t, n), void 0 !== n ? n : t);
          },
          remove: function (e, t) {
            var n,
              i = e[this.expando];
            if (void 0 !== i) {
              if (void 0 !== t) {
                n = (t = Array.isArray(t)
                  ? t.map(V)
                  : (t = V(t)) in i
                  ? [t]
                  : t.match(R) || []).length;
                for (; n--; ) delete i[t[n]];
              }
              (void 0 === t || w.isEmptyObject(i)) &&
                (e.nodeType
                  ? (e[this.expando] = void 0)
                  : delete e[this.expando]);
            }
          },
          hasData: function (e) {
            var t = e[this.expando];
            return void 0 !== t && !w.isEmptyObject(t);
          },
        });
      var Y = new K(),
        G = new K(),
        Q = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,
        X = /[A-Z]/g;
      function Z(e, t, n) {
        var i;
        if (void 0 === n && 1 === e.nodeType)
          if (
            ((i = "data-" + t.replace(X, "-$&").toLowerCase()),
            "string" == typeof (n = e.getAttribute(i)))
          ) {
            try {
              n = (function (e) {
                return (
                  "true" === e ||
                  ("false" !== e &&
                    ("null" === e
                      ? null
                      : e === +e + ""
                      ? +e
                      : Q.test(e)
                      ? JSON.parse(e)
                      : e))
                );
              })(n);
            } catch (e) {}
            G.set(e, t, n);
          } else n = void 0;
        return n;
      }
      w.extend({
        hasData: function (e) {
          return G.hasData(e) || Y.hasData(e);
        },
        data: function (e, t, n) {
          return G.access(e, t, n);
        },
        removeData: function (e, t) {
          G.remove(e, t);
        },
        _data: function (e, t, n) {
          return Y.access(e, t, n);
        },
        _removeData: function (e, t) {
          Y.remove(e, t);
        },
      }),
        w.fn.extend({
          data: function (e, t) {
            var n,
              i,
              r,
              o = this[0],
              a = o && o.attributes;
            if (void 0 === e) {
              if (
                this.length &&
                ((r = G.get(o)), 1 === o.nodeType && !Y.get(o, "hasDataAttrs"))
              ) {
                for (n = a.length; n--; )
                  a[n] &&
                    0 === (i = a[n].name).indexOf("data-") &&
                    ((i = V(i.slice(5))), Z(o, i, r[i]));
                Y.set(o, "hasDataAttrs", !0);
              }
              return r;
            }
            return "object" == typeof e
              ? this.each(function () {
                  G.set(this, e);
                })
              : j(
                  this,
                  function (t) {
                    var n;
                    if (o && void 0 === t) {
                      if (void 0 !== (n = G.get(o, e))) return n;
                      if (void 0 !== (n = Z(o, e))) return n;
                    } else
                      this.each(function () {
                        G.set(this, e, t);
                      });
                  },
                  null,
                  t,
                  arguments.length > 1,
                  null,
                  !0
                );
          },
          removeData: function (e) {
            return this.each(function () {
              G.remove(this, e);
            });
          },
        }),
        w.extend({
          queue: function (e, t, n) {
            var i;
            if (e)
              return (
                (t = (t || "fx") + "queue"),
                (i = Y.get(e, t)),
                n &&
                  (!i || Array.isArray(n)
                    ? (i = Y.access(e, t, w.makeArray(n)))
                    : i.push(n)),
                i || []
              );
          },
          dequeue: function (e, t) {
            t = t || "fx";
            var n = w.queue(e, t),
              i = n.length,
              r = n.shift(),
              o = w._queueHooks(e, t);
            "inprogress" === r && ((r = n.shift()), i--),
              r &&
                ("fx" === t && n.unshift("inprogress"),
                delete o.stop,
                r.call(
                  e,
                  function () {
                    w.dequeue(e, t);
                  },
                  o
                )),
              !i && o && o.empty.fire();
          },
          _queueHooks: function (e, t) {
            var n = t + "queueHooks";
            return (
              Y.get(e, n) ||
              Y.access(e, n, {
                empty: w.Callbacks("once memory").add(function () {
                  Y.remove(e, [t + "queue", n]);
                }),
              })
            );
          },
        }),
        w.fn.extend({
          queue: function (e, t) {
            var n = 2;
            return (
              "string" != typeof e && ((t = e), (e = "fx"), n--),
              arguments.length < n
                ? w.queue(this[0], e)
                : void 0 === t
                ? this
                : this.each(function () {
                    var n = w.queue(this, e, t);
                    w._queueHooks(this, e),
                      "fx" === e && "inprogress" !== n[0] && w.dequeue(this, e);
                  })
            );
          },
          dequeue: function (e) {
            return this.each(function () {
              w.dequeue(this, e);
            });
          },
          clearQueue: function (e) {
            return this.queue(e || "fx", []);
          },
          promise: function (e, t) {
            var n,
              i = 1,
              r = w.Deferred(),
              o = this,
              a = this.length,
              s = function () {
                --i || r.resolveWith(o, [o]);
              };
            for (
              "string" != typeof e && ((t = e), (e = void 0)), e = e || "fx";
              a--;

            )
              (n = Y.get(o[a], e + "queueHooks")) &&
                n.empty &&
                (i++, n.empty.add(s));
            return s(), r.promise(t);
          },
        });
      var ee = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,
        te = new RegExp("^(?:([+-])=|)(" + ee + ")([a-z%]*)$", "i"),
        ne = ["Top", "Right", "Bottom", "Left"],
        ie = function (e, t) {
          return (
            "none" === (e = t || e).style.display ||
            ("" === e.style.display &&
              w.contains(e.ownerDocument, e) &&
              "none" === w.css(e, "display"))
          );
        },
        re = function (e, t, n, i) {
          var r,
            o,
            a = {};
          for (o in t) (a[o] = e.style[o]), (e.style[o] = t[o]);
          for (o in ((r = n.apply(e, i || [])), t)) e.style[o] = a[o];
          return r;
        };
      function oe(e, t, n, i) {
        var r,
          o,
          a = 20,
          s = i
            ? function () {
                return i.cur();
              }
            : function () {
                return w.css(e, t, "");
              },
          l = s(),
          c = (n && n[3]) || (w.cssNumber[t] ? "" : "px"),
          d = (w.cssNumber[t] || ("px" !== c && +l)) && te.exec(w.css(e, t));
        if (d && d[3] !== c) {
          for (l /= 2, c = c || d[3], d = +l || 1; a--; )
            w.style(e, t, d + c),
              (1 - o) * (1 - (o = s() / l || 0.5)) <= 0 && (a = 0),
              (d /= o);
          (d *= 2), w.style(e, t, d + c), (n = n || []);
        }
        return (
          n &&
            ((d = +d || +l || 0),
            (r = n[1] ? d + (n[1] + 1) * n[2] : +n[2]),
            i && ((i.unit = c), (i.start = d), (i.end = r))),
          r
        );
      }
      var ae = {};
      function se(e) {
        var t,
          n = e.ownerDocument,
          i = e.nodeName,
          r = ae[i];
        return (
          r ||
          ((t = n.body.appendChild(n.createElement(i))),
          (r = w.css(t, "display")),
          t.parentNode.removeChild(t),
          "none" === r && (r = "block"),
          (ae[i] = r),
          r)
        );
      }
      function le(e, t) {
        for (var n, i, r = [], o = 0, a = e.length; o < a; o++)
          (i = e[o]).style &&
            ((n = i.style.display),
            t
              ? ("none" === n &&
                  ((r[o] = Y.get(i, "display") || null),
                  r[o] || (i.style.display = "")),
                "" === i.style.display && ie(i) && (r[o] = se(i)))
              : "none" !== n && ((r[o] = "none"), Y.set(i, "display", n)));
        for (o = 0; o < a; o++) null != r[o] && (e[o].style.display = r[o]);
        return e;
      }
      w.fn.extend({
        show: function () {
          return le(this, !0);
        },
        hide: function () {
          return le(this);
        },
        toggle: function (e) {
          return "boolean" == typeof e
            ? e
              ? this.show()
              : this.hide()
            : this.each(function () {
                ie(this) ? w(this).show() : w(this).hide();
              });
        },
      });
      var ce = /^(?:checkbox|radio)$/i,
        de = /<([a-z][^\/\0>\x20\t\r\n\f]+)/i,
        ue = /^$|^module$|\/(?:java|ecma)script/i,
        he = {
          option: [1, "<select multiple='multiple'>", "</select>"],
          thead: [1, "<table>", "</table>"],
          col: [2, "<table><colgroup>", "</colgroup></table>"],
          tr: [2, "<table><tbody>", "</tbody></table>"],
          td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
          _default: [0, "", ""],
        };
      function pe(e, t) {
        var n;
        return (
          (n =
            void 0 !== e.getElementsByTagName
              ? e.getElementsByTagName(t || "*")
              : void 0 !== e.querySelectorAll
              ? e.querySelectorAll(t || "*")
              : []),
          void 0 === t || (t && T(e, t)) ? w.merge([e], n) : n
        );
      }
      function fe(e, t) {
        for (var n = 0, i = e.length; n < i; n++)
          Y.set(e[n], "globalEval", !t || Y.get(t[n], "globalEval"));
      }
      (he.optgroup = he.option),
        (he.tbody = he.tfoot = he.colgroup = he.caption = he.thead),
        (he.th = he.td);
      var me = /<|&#?\w+;/;
      function ge(e, t, n, i, r) {
        for (
          var o,
            a,
            s,
            l,
            c,
            d,
            u = t.createDocumentFragment(),
            h = [],
            p = 0,
            f = e.length;
          p < f;
          p++
        )
          if ((o = e[p]) || 0 === o)
            if ("object" === b(o)) w.merge(h, o.nodeType ? [o] : o);
            else if (me.test(o)) {
              for (
                a = a || u.appendChild(t.createElement("div")),
                  s = (de.exec(o) || ["", ""])[1].toLowerCase(),
                  l = he[s] || he._default,
                  a.innerHTML = l[1] + w.htmlPrefilter(o) + l[2],
                  d = l[0];
                d--;

              )
                a = a.lastChild;
              w.merge(h, a.childNodes), ((a = u.firstChild).textContent = "");
            } else h.push(t.createTextNode(o));
        for (u.textContent = "", p = 0; (o = h[p++]); )
          if (i && w.inArray(o, i) > -1) r && r.push(o);
          else if (
            ((c = w.contains(o.ownerDocument, o)),
            (a = pe(u.appendChild(o), "script")),
            c && fe(a),
            n)
          )
            for (d = 0; (o = a[d++]); ) ue.test(o.type || "") && n.push(o);
        return u;
      }
      !(function () {
        var e = i.createDocumentFragment().appendChild(i.createElement("div")),
          t = i.createElement("input");
        t.setAttribute("type", "radio"),
          t.setAttribute("checked", "checked"),
          t.setAttribute("name", "t"),
          e.appendChild(t),
          (f.checkClone = e.cloneNode(!0).cloneNode(!0).lastChild.checked),
          (e.innerHTML = "<textarea>x</textarea>"),
          (f.noCloneChecked = !!e.cloneNode(!0).lastChild.defaultValue);
      })();
      var ve = i.documentElement,
        ye = /^key/,
        be = /^(?:mouse|pointer|contextmenu|drag|drop)|click/,
        we = /^([^.]*)(?:\.(.+)|)/;
      function xe() {
        return !0;
      }
      function Ce() {
        return !1;
      }
      function Fe() {
        try {
          return i.activeElement;
        } catch (e) {}
      }
      function Se(e, t, n, i, r, o) {
        var a, s;
        if ("object" == typeof t) {
          for (s in ("string" != typeof n && ((i = i || n), (n = void 0)), t))
            Se(e, s, n, i, t[s], o);
          return e;
        }
        if (
          (null == i && null == r
            ? ((r = n), (i = n = void 0))
            : null == r &&
              ("string" == typeof n
                ? ((r = i), (i = void 0))
                : ((r = i), (i = n), (n = void 0))),
          !1 === r)
        )
          r = Ce;
        else if (!r) return e;
        return (
          1 === o &&
            ((a = r),
            ((r = function (e) {
              return w().off(e), a.apply(this, arguments);
            }).guid = a.guid || (a.guid = w.guid++))),
          e.each(function () {
            w.event.add(this, t, r, i, n);
          })
        );
      }
      (w.event = {
        global: {},
        add: function (e, t, n, i, r) {
          var o,
            a,
            s,
            l,
            c,
            d,
            u,
            h,
            p,
            f,
            m,
            g = Y.get(e);
          if (g)
            for (
              n.handler && ((n = (o = n).handler), (r = o.selector)),
                r && w.find.matchesSelector(ve, r),
                n.guid || (n.guid = w.guid++),
                (l = g.events) || (l = g.events = {}),
                (a = g.handle) ||
                  (a = g.handle =
                    function (t) {
                      return void 0 !== w && w.event.triggered !== t.type
                        ? w.event.dispatch.apply(e, arguments)
                        : void 0;
                    }),
                c = (t = (t || "").match(R) || [""]).length;
              c--;

            )
              (p = m = (s = we.exec(t[c]) || [])[1]),
                (f = (s[2] || "").split(".").sort()),
                p &&
                  ((u = w.event.special[p] || {}),
                  (p = (r ? u.delegateType : u.bindType) || p),
                  (u = w.event.special[p] || {}),
                  (d = w.extend(
                    {
                      type: p,
                      origType: m,
                      data: i,
                      handler: n,
                      guid: n.guid,
                      selector: r,
                      needsContext: r && w.expr.match.needsContext.test(r),
                      namespace: f.join("."),
                    },
                    o
                  )),
                  (h = l[p]) ||
                    (((h = l[p] = []).delegateCount = 0),
                    (u.setup && !1 !== u.setup.call(e, i, f, a)) ||
                      (e.addEventListener && e.addEventListener(p, a))),
                  u.add &&
                    (u.add.call(e, d),
                    d.handler.guid || (d.handler.guid = n.guid)),
                  r ? h.splice(h.delegateCount++, 0, d) : h.push(d),
                  (w.event.global[p] = !0));
        },
        remove: function (e, t, n, i, r) {
          var o,
            a,
            s,
            l,
            c,
            d,
            u,
            h,
            p,
            f,
            m,
            g = Y.hasData(e) && Y.get(e);
          if (g && (l = g.events)) {
            for (c = (t = (t || "").match(R) || [""]).length; c--; )
              if (
                ((p = m = (s = we.exec(t[c]) || [])[1]),
                (f = (s[2] || "").split(".").sort()),
                p)
              ) {
                for (
                  u = w.event.special[p] || {},
                    h = l[(p = (i ? u.delegateType : u.bindType) || p)] || [],
                    s =
                      s[2] &&
                      new RegExp(
                        "(^|\\.)" + f.join("\\.(?:.*\\.|)") + "(\\.|$)"
                      ),
                    a = o = h.length;
                  o--;

                )
                  (d = h[o]),
                    (!r && m !== d.origType) ||
                      (n && n.guid !== d.guid) ||
                      (s && !s.test(d.namespace)) ||
                      (i && i !== d.selector && ("**" !== i || !d.selector)) ||
                      (h.splice(o, 1),
                      d.selector && h.delegateCount--,
                      u.remove && u.remove.call(e, d));
                a &&
                  !h.length &&
                  ((u.teardown && !1 !== u.teardown.call(e, f, g.handle)) ||
                    w.removeEvent(e, p, g.handle),
                  delete l[p]);
              } else for (p in l) w.event.remove(e, p + t[c], n, i, !0);
            w.isEmptyObject(l) && Y.remove(e, "handle events");
          }
        },
        dispatch: function (e) {
          var t,
            n,
            i,
            r,
            o,
            a,
            s = w.event.fix(e),
            l = new Array(arguments.length),
            c = (Y.get(this, "events") || {})[s.type] || [],
            d = w.event.special[s.type] || {};
          for (l[0] = s, t = 1; t < arguments.length; t++) l[t] = arguments[t];
          if (
            ((s.delegateTarget = this),
            !d.preDispatch || !1 !== d.preDispatch.call(this, s))
          ) {
            for (
              a = w.event.handlers.call(this, s, c), t = 0;
              (r = a[t++]) && !s.isPropagationStopped();

            )
              for (
                s.currentTarget = r.elem, n = 0;
                (o = r.handlers[n++]) && !s.isImmediatePropagationStopped();

              )
                (s.rnamespace && !s.rnamespace.test(o.namespace)) ||
                  ((s.handleObj = o),
                  (s.data = o.data),
                  void 0 !==
                    (i = (
                      (w.event.special[o.origType] || {}).handle || o.handler
                    ).apply(r.elem, l)) &&
                    !1 === (s.result = i) &&
                    (s.preventDefault(), s.stopPropagation()));
            return d.postDispatch && d.postDispatch.call(this, s), s.result;
          }
        },
        handlers: function (e, t) {
          var n,
            i,
            r,
            o,
            a,
            s = [],
            l = t.delegateCount,
            c = e.target;
          if (l && c.nodeType && !("click" === e.type && e.button >= 1))
            for (; c !== this; c = c.parentNode || this)
              if (
                1 === c.nodeType &&
                ("click" !== e.type || !0 !== c.disabled)
              ) {
                for (o = [], a = {}, n = 0; n < l; n++)
                  void 0 === a[(r = (i = t[n]).selector + " ")] &&
                    (a[r] = i.needsContext
                      ? w(r, this).index(c) > -1
                      : w.find(r, this, null, [c]).length),
                    a[r] && o.push(i);
                o.length && s.push({ elem: c, handlers: o });
              }
          return (
            (c = this),
            l < t.length && s.push({ elem: c, handlers: t.slice(l) }),
            s
          );
        },
        addProp: function (e, t) {
          Object.defineProperty(w.Event.prototype, e, {
            enumerable: !0,
            configurable: !0,
            get: m(t)
              ? function () {
                  if (this.originalEvent) return t(this.originalEvent);
                }
              : function () {
                  if (this.originalEvent) return this.originalEvent[e];
                },
            set: function (t) {
              Object.defineProperty(this, e, {
                enumerable: !0,
                configurable: !0,
                writable: !0,
                value: t,
              });
            },
          });
        },
        fix: function (e) {
          return e[w.expando] ? e : new w.Event(e);
        },
        special: {
          load: { noBubble: !0 },
          focus: {
            trigger: function () {
              if (this !== Fe() && this.focus) return this.focus(), !1;
            },
            delegateType: "focusin",
          },
          blur: {
            trigger: function () {
              if (this === Fe() && this.blur) return this.blur(), !1;
            },
            delegateType: "focusout",
          },
          click: {
            trigger: function () {
              if ("checkbox" === this.type && this.click && T(this, "input"))
                return this.click(), !1;
            },
            _default: function (e) {
              return T(e.target, "a");
            },
          },
          beforeunload: {
            postDispatch: function (e) {
              void 0 !== e.result &&
                e.originalEvent &&
                (e.originalEvent.returnValue = e.result);
            },
          },
        },
      }),
        (w.removeEvent = function (e, t, n) {
          e.removeEventListener && e.removeEventListener(t, n);
        }),
        (w.Event = function (e, t) {
          if (!(this instanceof w.Event)) return new w.Event(e, t);
          e && e.type
            ? ((this.originalEvent = e),
              (this.type = e.type),
              (this.isDefaultPrevented =
                e.defaultPrevented ||
                (void 0 === e.defaultPrevented && !1 === e.returnValue)
                  ? xe
                  : Ce),
              (this.target =
                e.target && 3 === e.target.nodeType
                  ? e.target.parentNode
                  : e.target),
              (this.currentTarget = e.currentTarget),
              (this.relatedTarget = e.relatedTarget))
            : (this.type = e),
            t && w.extend(this, t),
            (this.timeStamp = (e && e.timeStamp) || Date.now()),
            (this[w.expando] = !0);
        }),
        (w.Event.prototype = {
          constructor: w.Event,
          isDefaultPrevented: Ce,
          isPropagationStopped: Ce,
          isImmediatePropagationStopped: Ce,
          isSimulated: !1,
          preventDefault: function () {
            var e = this.originalEvent;
            (this.isDefaultPrevented = xe),
              e && !this.isSimulated && e.preventDefault();
          },
          stopPropagation: function () {
            var e = this.originalEvent;
            (this.isPropagationStopped = xe),
              e && !this.isSimulated && e.stopPropagation();
          },
          stopImmediatePropagation: function () {
            var e = this.originalEvent;
            (this.isImmediatePropagationStopped = xe),
              e && !this.isSimulated && e.stopImmediatePropagation(),
              this.stopPropagation();
          },
        }),
        w.each(
          {
            altKey: !0,
            bubbles: !0,
            cancelable: !0,
            changedTouches: !0,
            ctrlKey: !0,
            detail: !0,
            eventPhase: !0,
            metaKey: !0,
            pageX: !0,
            pageY: !0,
            shiftKey: !0,
            view: !0,
            char: !0,
            charCode: !0,
            key: !0,
            keyCode: !0,
            button: !0,
            buttons: !0,
            clientX: !0,
            clientY: !0,
            offsetX: !0,
            offsetY: !0,
            pointerId: !0,
            pointerType: !0,
            screenX: !0,
            screenY: !0,
            targetTouches: !0,
            toElement: !0,
            touches: !0,
            which: function (e) {
              var t = e.button;
              return null == e.which && ye.test(e.type)
                ? null != e.charCode
                  ? e.charCode
                  : e.keyCode
                : !e.which && void 0 !== t && be.test(e.type)
                ? 1 & t
                  ? 1
                  : 2 & t
                  ? 3
                  : 4 & t
                  ? 2
                  : 0
                : e.which;
            },
          },
          w.event.addProp
        ),
        w.each(
          {
            mouseenter: "mouseover",
            mouseleave: "mouseout",
            pointerenter: "pointerover",
            pointerleave: "pointerout",
          },
          function (e, t) {
            w.event.special[e] = {
              delegateType: t,
              bindType: t,
              handle: function (e) {
                var n,
                  i = e.relatedTarget,
                  r = e.handleObj;
                return (
                  (i && (i === this || w.contains(this, i))) ||
                    ((e.type = r.origType),
                    (n = r.handler.apply(this, arguments)),
                    (e.type = t)),
                  n
                );
              },
            };
          }
        ),
        w.fn.extend({
          on: function (e, t, n, i) {
            return Se(this, e, t, n, i);
          },
          one: function (e, t, n, i) {
            return Se(this, e, t, n, i, 1);
          },
          off: function (e, t, n) {
            var i, r;
            if (e && e.preventDefault && e.handleObj)
              return (
                (i = e.handleObj),
                w(e.delegateTarget).off(
                  i.namespace ? i.origType + "." + i.namespace : i.origType,
                  i.selector,
                  i.handler
                ),
                this
              );
            if ("object" == typeof e) {
              for (r in e) this.off(r, t, e[r]);
              return this;
            }
            return (
              (!1 !== t && "function" != typeof t) || ((n = t), (t = void 0)),
              !1 === n && (n = Ce),
              this.each(function () {
                w.event.remove(this, e, n, t);
              })
            );
          },
        });
      var ke =
          /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,
        Ee = /<script|<style|<link/i,
        Te = /checked\s*(?:[^=]|=\s*.checked.)/i,
        _e = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;
      function Ae(e, t) {
        return (
          (T(e, "table") &&
            T(11 !== t.nodeType ? t : t.firstChild, "tr") &&
            w(e).children("tbody")[0]) ||
          e
        );
      }
      function Me(e) {
        return (e.type = (null !== e.getAttribute("type")) + "/" + e.type), e;
      }
      function Le(e) {
        return (
          "true/" === (e.type || "").slice(0, 5)
            ? (e.type = e.type.slice(5))
            : e.removeAttribute("type"),
          e
        );
      }
      function Ne(e, t) {
        var n, i, r, o, a, s, l, c;
        if (1 === t.nodeType) {
          if (
            Y.hasData(e) &&
            ((o = Y.access(e)), (a = Y.set(t, o)), (c = o.events))
          )
            for (r in (delete a.handle, (a.events = {}), c))
              for (n = 0, i = c[r].length; n < i; n++)
                w.event.add(t, r, c[r][n]);
          G.hasData(e) &&
            ((s = G.access(e)), (l = w.extend({}, s)), G.set(t, l));
        }
      }
      function De(e, t) {
        var n = t.nodeName.toLowerCase();
        "input" === n && ce.test(e.type)
          ? (t.checked = e.checked)
          : ("input" !== n && "textarea" !== n) ||
            (t.defaultValue = e.defaultValue);
      }
      function Be(e, t, n, i) {
        t = a.apply([], t);
        var r,
          o,
          s,
          l,
          c,
          d,
          u = 0,
          h = e.length,
          p = h - 1,
          g = t[0],
          v = m(g);
        if (v || (h > 1 && "string" == typeof g && !f.checkClone && Te.test(g)))
          return e.each(function (r) {
            var o = e.eq(r);
            v && (t[0] = g.call(this, r, o.html())), Be(o, t, n, i);
          });
        if (
          h &&
          ((o = (r = ge(t, e[0].ownerDocument, !1, e, i)).firstChild),
          1 === r.childNodes.length && (r = o),
          o || i)
        ) {
          for (l = (s = w.map(pe(r, "script"), Me)).length; u < h; u++)
            (c = r),
              u !== p &&
                ((c = w.clone(c, !0, !0)), l && w.merge(s, pe(c, "script"))),
              n.call(e[u], c, u);
          if (l)
            for (
              d = s[s.length - 1].ownerDocument, w.map(s, Le), u = 0;
              u < l;
              u++
            )
              (c = s[u]),
                ue.test(c.type || "") &&
                  !Y.access(c, "globalEval") &&
                  w.contains(d, c) &&
                  (c.src && "module" !== (c.type || "").toLowerCase()
                    ? w._evalUrl && w._evalUrl(c.src)
                    : y(c.textContent.replace(_e, ""), d, c));
        }
        return e;
      }
      function Re(e, t, n) {
        for (var i, r = t ? w.filter(t, e) : e, o = 0; null != (i = r[o]); o++)
          n || 1 !== i.nodeType || w.cleanData(pe(i)),
            i.parentNode &&
              (n && w.contains(i.ownerDocument, i) && fe(pe(i, "script")),
              i.parentNode.removeChild(i));
        return e;
      }
      w.extend({
        htmlPrefilter: function (e) {
          return e.replace(ke, "<$1></$2>");
        },
        clone: function (e, t, n) {
          var i,
            r,
            o,
            a,
            s = e.cloneNode(!0),
            l = w.contains(e.ownerDocument, e);
          if (
            !(
              f.noCloneChecked ||
              (1 !== e.nodeType && 11 !== e.nodeType) ||
              w.isXMLDoc(e)
            )
          )
            for (a = pe(s), i = 0, r = (o = pe(e)).length; i < r; i++)
              De(o[i], a[i]);
          if (t)
            if (n)
              for (
                o = o || pe(e), a = a || pe(s), i = 0, r = o.length;
                i < r;
                i++
              )
                Ne(o[i], a[i]);
            else Ne(e, s);
          return (
            (a = pe(s, "script")).length > 0 && fe(a, !l && pe(e, "script")), s
          );
        },
        cleanData: function (e) {
          for (
            var t, n, i, r = w.event.special, o = 0;
            void 0 !== (n = e[o]);
            o++
          )
            if (J(n)) {
              if ((t = n[Y.expando])) {
                if (t.events)
                  for (i in t.events)
                    r[i] ? w.event.remove(n, i) : w.removeEvent(n, i, t.handle);
                n[Y.expando] = void 0;
              }
              n[G.expando] && (n[G.expando] = void 0);
            }
        },
      }),
        w.fn.extend({
          detach: function (e) {
            return Re(this, e, !0);
          },
          remove: function (e) {
            return Re(this, e);
          },
          text: function (e) {
            return j(
              this,
              function (e) {
                return void 0 === e
                  ? w.text(this)
                  : this.empty().each(function () {
                      (1 !== this.nodeType &&
                        11 !== this.nodeType &&
                        9 !== this.nodeType) ||
                        (this.textContent = e);
                    });
              },
              null,
              e,
              arguments.length
            );
          },
          append: function () {
            return Be(this, arguments, function (e) {
              (1 !== this.nodeType &&
                11 !== this.nodeType &&
                9 !== this.nodeType) ||
                Ae(this, e).appendChild(e);
            });
          },
          prepend: function () {
            return Be(this, arguments, function (e) {
              if (
                1 === this.nodeType ||
                11 === this.nodeType ||
                9 === this.nodeType
              ) {
                var t = Ae(this, e);
                t.insertBefore(e, t.firstChild);
              }
            });
          },
          before: function () {
            return Be(this, arguments, function (e) {
              this.parentNode && this.parentNode.insertBefore(e, this);
            });
          },
          after: function () {
            return Be(this, arguments, function (e) {
              this.parentNode &&
                this.parentNode.insertBefore(e, this.nextSibling);
            });
          },
          empty: function () {
            for (var e, t = 0; null != (e = this[t]); t++)
              1 === e.nodeType &&
                (w.cleanData(pe(e, !1)), (e.textContent = ""));
            return this;
          },
          clone: function (e, t) {
            return (
              (e = null != e && e),
              (t = null == t ? e : t),
              this.map(function () {
                return w.clone(this, e, t);
              })
            );
          },
          html: function (e) {
            return j(
              this,
              function (e) {
                var t = this[0] || {},
                  n = 0,
                  i = this.length;
                if (void 0 === e && 1 === t.nodeType) return t.innerHTML;
                if (
                  "string" == typeof e &&
                  !Ee.test(e) &&
                  !he[(de.exec(e) || ["", ""])[1].toLowerCase()]
                ) {
                  e = w.htmlPrefilter(e);
                  try {
                    for (; n < i; n++)
                      1 === (t = this[n] || {}).nodeType &&
                        (w.cleanData(pe(t, !1)), (t.innerHTML = e));
                    t = 0;
                  } catch (e) {}
                }
                t && this.empty().append(e);
              },
              null,
              e,
              arguments.length
            );
          },
          replaceWith: function () {
            var e = [];
            return Be(
              this,
              arguments,
              function (t) {
                var n = this.parentNode;
                w.inArray(this, e) < 0 &&
                  (w.cleanData(pe(this)), n && n.replaceChild(t, this));
              },
              e
            );
          },
        }),
        w.each(
          {
            appendTo: "append",
            prependTo: "prepend",
            insertBefore: "before",
            insertAfter: "after",
            replaceAll: "replaceWith",
          },
          function (e, t) {
            w.fn[e] = function (e) {
              for (
                var n, i = [], r = w(e), o = r.length - 1, a = 0;
                a <= o;
                a++
              )
                (n = a === o ? this : this.clone(!0)),
                  w(r[a])[t](n),
                  s.apply(i, n.get());
              return this.pushStack(i);
            };
          }
        );
      var Pe = new RegExp("^(" + ee + ")(?!px)[a-z%]+$", "i"),
        Ie = function (t) {
          var n = t.ownerDocument.defaultView;
          return (n && n.opener) || (n = e), n.getComputedStyle(t);
        },
        Oe = new RegExp(ne.join("|"), "i");
      function $e(e, t, n) {
        var i,
          r,
          o,
          a,
          s = e.style;
        return (
          (n = n || Ie(e)) &&
            ("" !== (a = n.getPropertyValue(t) || n[t]) ||
              w.contains(e.ownerDocument, e) ||
              (a = w.style(e, t)),
            !f.pixelBoxStyles() &&
              Pe.test(a) &&
              Oe.test(t) &&
              ((i = s.width),
              (r = s.minWidth),
              (o = s.maxWidth),
              (s.minWidth = s.maxWidth = s.width = a),
              (a = n.width),
              (s.width = i),
              (s.minWidth = r),
              (s.maxWidth = o))),
          void 0 !== a ? a + "" : a
        );
      }
      function He(e, t) {
        return {
          get: function () {
            if (!e()) return (this.get = t).apply(this, arguments);
            delete this.get;
          },
        };
      }
      !(function () {
        function t() {
          if (d) {
            (c.style.cssText =
              "position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0"),
              (d.style.cssText =
                "position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%"),
              ve.appendChild(c).appendChild(d);
            var t = e.getComputedStyle(d);
            (r = "1%" !== t.top),
              (l = 12 === n(t.marginLeft)),
              (d.style.right = "60%"),
              (s = 36 === n(t.right)),
              (o = 36 === n(t.width)),
              (d.style.position = "absolute"),
              (a = 36 === d.offsetWidth || "absolute"),
              ve.removeChild(c),
              (d = null);
          }
        }
        function n(e) {
          return Math.round(parseFloat(e));
        }
        var r,
          o,
          a,
          s,
          l,
          c = i.createElement("div"),
          d = i.createElement("div");
        d.style &&
          ((d.style.backgroundClip = "content-box"),
          (d.cloneNode(!0).style.backgroundClip = ""),
          (f.clearCloneStyle = "content-box" === d.style.backgroundClip),
          w.extend(f, {
            boxSizingReliable: function () {
              return t(), o;
            },
            pixelBoxStyles: function () {
              return t(), s;
            },
            pixelPosition: function () {
              return t(), r;
            },
            reliableMarginLeft: function () {
              return t(), l;
            },
            scrollboxSize: function () {
              return t(), a;
            },
          }));
      })();
      var Ue = /^(none|table(?!-c[ea]).+)/,
        je = /^--/,
        qe = { position: "absolute", visibility: "hidden", display: "block" },
        We = { letterSpacing: "0", fontWeight: "400" },
        ze = ["Webkit", "Moz", "ms"],
        Ve = i.createElement("div").style;
      function Je(e) {
        var t = w.cssProps[e];
        return (
          t ||
            (t = w.cssProps[e] =
              (function (e) {
                if (e in Ve) return e;
                for (
                  var t = e[0].toUpperCase() + e.slice(1), n = ze.length;
                  n--;

                )
                  if ((e = ze[n] + t) in Ve) return e;
              })(e) || e),
          t
        );
      }
      function Ke(e, t, n) {
        var i = te.exec(t);
        return i ? Math.max(0, i[2] - (n || 0)) + (i[3] || "px") : t;
      }
      function Ye(e, t, n, i, r, o) {
        var a = "width" === t ? 1 : 0,
          s = 0,
          l = 0;
        if (n === (i ? "border" : "content")) return 0;
        for (; a < 4; a += 2)
          "margin" === n && (l += w.css(e, n + ne[a], !0, r)),
            i
              ? ("content" === n && (l -= w.css(e, "padding" + ne[a], !0, r)),
                "margin" !== n &&
                  (l -= w.css(e, "border" + ne[a] + "Width", !0, r)))
              : ((l += w.css(e, "padding" + ne[a], !0, r)),
                "padding" !== n
                  ? (l += w.css(e, "border" + ne[a] + "Width", !0, r))
                  : (s += w.css(e, "border" + ne[a] + "Width", !0, r)));
        return (
          !i &&
            o >= 0 &&
            (l += Math.max(
              0,
              Math.ceil(
                e["offset" + t[0].toUpperCase() + t.slice(1)] - o - l - s - 0.5
              )
            )),
          l
        );
      }
      function Ge(e, t, n) {
        var i = Ie(e),
          r = $e(e, t, i),
          o = "border-box" === w.css(e, "boxSizing", !1, i),
          a = o;
        if (Pe.test(r)) {
          if (!n) return r;
          r = "auto";
        }
        return (
          (a = a && (f.boxSizingReliable() || r === e.style[t])),
          ("auto" === r ||
            (!parseFloat(r) && "inline" === w.css(e, "display", !1, i))) &&
            ((r = e["offset" + t[0].toUpperCase() + t.slice(1)]), (a = !0)),
          (r = parseFloat(r) || 0) +
            Ye(e, t, n || (o ? "border" : "content"), a, i, r) +
            "px"
        );
      }
      function Qe(e, t, n, i, r) {
        return new Qe.prototype.init(e, t, n, i, r);
      }
      w.extend({
        cssHooks: {
          opacity: {
            get: function (e, t) {
              if (t) {
                var n = $e(e, "opacity");
                return "" === n ? "1" : n;
              }
            },
          },
        },
        cssNumber: {
          animationIterationCount: !0,
          columnCount: !0,
          fillOpacity: !0,
          flexGrow: !0,
          flexShrink: !0,
          fontWeight: !0,
          lineHeight: !0,
          opacity: !0,
          order: !0,
          orphans: !0,
          widows: !0,
          zIndex: !0,
          zoom: !0,
        },
        cssProps: {},
        style: function (e, t, n, i) {
          if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
            var r,
              o,
              a,
              s = V(t),
              l = je.test(t),
              c = e.style;
            if (
              (l || (t = Je(s)),
              (a = w.cssHooks[t] || w.cssHooks[s]),
              void 0 === n)
            )
              return a && "get" in a && void 0 !== (r = a.get(e, !1, i))
                ? r
                : c[t];
            "string" == (o = typeof n) &&
              (r = te.exec(n)) &&
              r[1] &&
              ((n = oe(e, t, r)), (o = "number")),
              null != n &&
                n == n &&
                ("number" === o &&
                  (n += (r && r[3]) || (w.cssNumber[s] ? "" : "px")),
                f.clearCloneStyle ||
                  "" !== n ||
                  0 !== t.indexOf("background") ||
                  (c[t] = "inherit"),
                (a && "set" in a && void 0 === (n = a.set(e, n, i))) ||
                  (l ? c.setProperty(t, n) : (c[t] = n)));
          }
        },
        css: function (e, t, n, i) {
          var r,
            o,
            a,
            s = V(t);
          return (
            je.test(t) || (t = Je(s)),
            (a = w.cssHooks[t] || w.cssHooks[s]) &&
              "get" in a &&
              (r = a.get(e, !0, n)),
            void 0 === r && (r = $e(e, t, i)),
            "normal" === r && t in We && (r = We[t]),
            "" === n || n
              ? ((o = parseFloat(r)), !0 === n || isFinite(o) ? o || 0 : r)
              : r
          );
        },
      }),
        w.each(["height", "width"], function (e, t) {
          w.cssHooks[t] = {
            get: function (e, n, i) {
              if (n)
                return !Ue.test(w.css(e, "display")) ||
                  (e.getClientRects().length && e.getBoundingClientRect().width)
                  ? Ge(e, t, i)
                  : re(e, qe, function () {
                      return Ge(e, t, i);
                    });
            },
            set: function (e, n, i) {
              var r,
                o = Ie(e),
                a = "border-box" === w.css(e, "boxSizing", !1, o),
                s = i && Ye(e, t, i, a, o);
              return (
                a &&
                  f.scrollboxSize() === o.position &&
                  (s -= Math.ceil(
                    e["offset" + t[0].toUpperCase() + t.slice(1)] -
                      parseFloat(o[t]) -
                      Ye(e, t, "border", !1, o) -
                      0.5
                  )),
                s &&
                  (r = te.exec(n)) &&
                  "px" !== (r[3] || "px") &&
                  ((e.style[t] = n), (n = w.css(e, t))),
                Ke(0, n, s)
              );
            },
          };
        }),
        (w.cssHooks.marginLeft = He(f.reliableMarginLeft, function (e, t) {
          if (t)
            return (
              (parseFloat($e(e, "marginLeft")) ||
                e.getBoundingClientRect().left -
                  re(e, { marginLeft: 0 }, function () {
                    return e.getBoundingClientRect().left;
                  })) + "px"
            );
        })),
        w.each({ margin: "", padding: "", border: "Width" }, function (e, t) {
          (w.cssHooks[e + t] = {
            expand: function (n) {
              for (
                var i = 0,
                  r = {},
                  o = "string" == typeof n ? n.split(" ") : [n];
                i < 4;
                i++
              )
                r[e + ne[i] + t] = o[i] || o[i - 2] || o[0];
              return r;
            },
          }),
            "margin" !== e && (w.cssHooks[e + t].set = Ke);
        }),
        w.fn.extend({
          css: function (e, t) {
            return j(
              this,
              function (e, t, n) {
                var i,
                  r,
                  o = {},
                  a = 0;
                if (Array.isArray(t)) {
                  for (i = Ie(e), r = t.length; a < r; a++)
                    o[t[a]] = w.css(e, t[a], !1, i);
                  return o;
                }
                return void 0 !== n ? w.style(e, t, n) : w.css(e, t);
              },
              e,
              t,
              arguments.length > 1
            );
          },
        }),
        (w.Tween = Qe),
        (Qe.prototype = {
          constructor: Qe,
          init: function (e, t, n, i, r, o) {
            (this.elem = e),
              (this.prop = n),
              (this.easing = r || w.easing._default),
              (this.options = t),
              (this.start = this.now = this.cur()),
              (this.end = i),
              (this.unit = o || (w.cssNumber[n] ? "" : "px"));
          },
          cur: function () {
            var e = Qe.propHooks[this.prop];
            return e && e.get ? e.get(this) : Qe.propHooks._default.get(this);
          },
          run: function (e) {
            var t,
              n = Qe.propHooks[this.prop];
            return (
              this.options.duration
                ? (this.pos = t =
                    w.easing[this.easing](
                      e,
                      this.options.duration * e,
                      0,
                      1,
                      this.options.duration
                    ))
                : (this.pos = t = e),
              (this.now = (this.end - this.start) * t + this.start),
              this.options.step &&
                this.options.step.call(this.elem, this.now, this),
              n && n.set ? n.set(this) : Qe.propHooks._default.set(this),
              this
            );
          },
        }),
        (Qe.prototype.init.prototype = Qe.prototype),
        (Qe.propHooks = {
          _default: {
            get: function (e) {
              var t;
              return 1 !== e.elem.nodeType ||
                (null != e.elem[e.prop] && null == e.elem.style[e.prop])
                ? e.elem[e.prop]
                : (t = w.css(e.elem, e.prop, "")) && "auto" !== t
                ? t
                : 0;
            },
            set: function (e) {
              w.fx.step[e.prop]
                ? w.fx.step[e.prop](e)
                : 1 !== e.elem.nodeType ||
                  (null == e.elem.style[w.cssProps[e.prop]] &&
                    !w.cssHooks[e.prop])
                ? (e.elem[e.prop] = e.now)
                : w.style(e.elem, e.prop, e.now + e.unit);
            },
          },
        }),
        (Qe.propHooks.scrollTop = Qe.propHooks.scrollLeft =
          {
            set: function (e) {
              e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now);
            },
          }),
        (w.easing = {
          linear: function (e) {
            return e;
          },
          swing: function (e) {
            return 0.5 - Math.cos(e * Math.PI) / 2;
          },
          _default: "swing",
        }),
        (w.fx = Qe.prototype.init),
        (w.fx.step = {});
      var Xe,
        Ze,
        et = /^(?:toggle|show|hide)$/,
        tt = /queueHooks$/;
      function nt() {
        Ze &&
          (!1 === i.hidden && e.requestAnimationFrame
            ? e.requestAnimationFrame(nt)
            : e.setTimeout(nt, w.fx.interval),
          w.fx.tick());
      }
      function it() {
        return (
          e.setTimeout(function () {
            Xe = void 0;
          }),
          (Xe = Date.now())
        );
      }
      function rt(e, t) {
        var n,
          i = 0,
          r = { height: e };
        for (t = t ? 1 : 0; i < 4; i += 2 - t)
          r["margin" + (n = ne[i])] = r["padding" + n] = e;
        return t && (r.opacity = r.width = e), r;
      }
      function ot(e, t, n) {
        for (
          var i,
            r = (at.tweeners[t] || []).concat(at.tweeners["*"]),
            o = 0,
            a = r.length;
          o < a;
          o++
        )
          if ((i = r[o].call(n, t, e))) return i;
      }
      function at(e, t, n) {
        var i,
          r,
          o = 0,
          a = at.prefilters.length,
          s = w.Deferred().always(function () {
            delete l.elem;
          }),
          l = function () {
            if (r) return !1;
            for (
              var t = Xe || it(),
                n = Math.max(0, c.startTime + c.duration - t),
                i = 1 - (n / c.duration || 0),
                o = 0,
                a = c.tweens.length;
              o < a;
              o++
            )
              c.tweens[o].run(i);
            return (
              s.notifyWith(e, [c, i, n]),
              i < 1 && a
                ? n
                : (a || s.notifyWith(e, [c, 1, 0]), s.resolveWith(e, [c]), !1)
            );
          },
          c = s.promise({
            elem: e,
            props: w.extend({}, t),
            opts: w.extend(
              !0,
              { specialEasing: {}, easing: w.easing._default },
              n
            ),
            originalProperties: t,
            originalOptions: n,
            startTime: Xe || it(),
            duration: n.duration,
            tweens: [],
            createTween: function (t, n) {
              var i = w.Tween(
                e,
                c.opts,
                t,
                n,
                c.opts.specialEasing[t] || c.opts.easing
              );
              return c.tweens.push(i), i;
            },
            stop: function (t) {
              var n = 0,
                i = t ? c.tweens.length : 0;
              if (r) return this;
              for (r = !0; n < i; n++) c.tweens[n].run(1);
              return (
                t
                  ? (s.notifyWith(e, [c, 1, 0]), s.resolveWith(e, [c, t]))
                  : s.rejectWith(e, [c, t]),
                this
              );
            },
          }),
          d = c.props;
        for (
          (function (e, t) {
            var n, i, r, o, a;
            for (n in e)
              if (
                ((r = t[(i = V(n))]),
                (o = e[n]),
                Array.isArray(o) && ((r = o[1]), (o = e[n] = o[0])),
                n !== i && ((e[i] = o), delete e[n]),
                (a = w.cssHooks[i]) && ("expand" in a))
              )
                for (n in ((o = a.expand(o)), delete e[i], o))
                  (n in e) || ((e[n] = o[n]), (t[n] = r));
              else t[i] = r;
          })(d, c.opts.specialEasing);
          o < a;
          o++
        )
          if ((i = at.prefilters[o].call(c, e, d, c.opts)))
            return (
              m(i.stop) &&
                (w._queueHooks(c.elem, c.opts.queue).stop = i.stop.bind(i)),
              i
            );
        return (
          w.map(d, ot, c),
          m(c.opts.start) && c.opts.start.call(e, c),
          c
            .progress(c.opts.progress)
            .done(c.opts.done, c.opts.complete)
            .fail(c.opts.fail)
            .always(c.opts.always),
          w.fx.timer(w.extend(l, { elem: e, anim: c, queue: c.opts.queue })),
          c
        );
      }
      (w.Animation = w.extend(at, {
        tweeners: {
          "*": [
            function (e, t) {
              var n = this.createTween(e, t);
              return oe(n.elem, e, te.exec(t), n), n;
            },
          ],
        },
        tweener: function (e, t) {
          m(e) ? ((t = e), (e = ["*"])) : (e = e.match(R));
          for (var n, i = 0, r = e.length; i < r; i++)
            (n = e[i]),
              (at.tweeners[n] = at.tweeners[n] || []),
              at.tweeners[n].unshift(t);
        },
        prefilters: [
          function (e, t, n) {
            var i,
              r,
              o,
              a,
              s,
              l,
              c,
              d,
              u = "width" in t || "height" in t,
              h = this,
              p = {},
              f = e.style,
              m = e.nodeType && ie(e),
              g = Y.get(e, "fxshow");
            for (i in (n.queue ||
              (null == (a = w._queueHooks(e, "fx")).unqueued &&
                ((a.unqueued = 0),
                (s = a.empty.fire),
                (a.empty.fire = function () {
                  a.unqueued || s();
                })),
              a.unqueued++,
              h.always(function () {
                h.always(function () {
                  a.unqueued--, w.queue(e, "fx").length || a.empty.fire();
                });
              })),
            t))
              if (((r = t[i]), et.test(r))) {
                if (
                  (delete t[i],
                  (o = o || "toggle" === r),
                  r === (m ? "hide" : "show"))
                ) {
                  if ("show" !== r || !g || void 0 === g[i]) continue;
                  m = !0;
                }
                p[i] = (g && g[i]) || w.style(e, i);
              }
            if ((l = !w.isEmptyObject(t)) || !w.isEmptyObject(p))
              for (i in (u &&
                1 === e.nodeType &&
                ((n.overflow = [f.overflow, f.overflowX, f.overflowY]),
                null == (c = g && g.display) && (c = Y.get(e, "display")),
                "none" === (d = w.css(e, "display")) &&
                  (c
                    ? (d = c)
                    : (le([e], !0),
                      (c = e.style.display || c),
                      (d = w.css(e, "display")),
                      le([e]))),
                ("inline" === d || ("inline-block" === d && null != c)) &&
                  "none" === w.css(e, "float") &&
                  (l ||
                    (h.done(function () {
                      f.display = c;
                    }),
                    null == c &&
                      ((d = f.display), (c = "none" === d ? "" : d))),
                  (f.display = "inline-block"))),
              n.overflow &&
                ((f.overflow = "hidden"),
                h.always(function () {
                  (f.overflow = n.overflow[0]),
                    (f.overflowX = n.overflow[1]),
                    (f.overflowY = n.overflow[2]);
                })),
              (l = !1),
              p))
                l ||
                  (g
                    ? "hidden" in g && (m = g.hidden)
                    : (g = Y.access(e, "fxshow", { display: c })),
                  o && (g.hidden = !m),
                  m && le([e], !0),
                  h.done(function () {
                    for (i in (m || le([e]), Y.remove(e, "fxshow"), p))
                      w.style(e, i, p[i]);
                  })),
                  (l = ot(m ? g[i] : 0, i, h)),
                  i in g ||
                    ((g[i] = l.start), m && ((l.end = l.start), (l.start = 0)));
          },
        ],
        prefilter: function (e, t) {
          t ? at.prefilters.unshift(e) : at.prefilters.push(e);
        },
      })),
        (w.speed = function (e, t, n) {
          var i =
            e && "object" == typeof e
              ? w.extend({}, e)
              : {
                  complete: n || (!n && t) || (m(e) && e),
                  duration: e,
                  easing: (n && t) || (t && !m(t) && t),
                };
          return (
            w.fx.off
              ? (i.duration = 0)
              : "number" != typeof i.duration &&
                (i.duration in w.fx.speeds
                  ? (i.duration = w.fx.speeds[i.duration])
                  : (i.duration = w.fx.speeds._default)),
            (null != i.queue && !0 !== i.queue) || (i.queue = "fx"),
            (i.old = i.complete),
            (i.complete = function () {
              m(i.old) && i.old.call(this), i.queue && w.dequeue(this, i.queue);
            }),
            i
          );
        }),
        w.fn.extend({
          fadeTo: function (e, t, n, i) {
            return this.filter(ie)
              .css("opacity", 0)
              .show()
              .end()
              .animate({ opacity: t }, e, n, i);
          },
          animate: function (e, t, n, i) {
            var r = w.isEmptyObject(e),
              o = w.speed(t, n, i),
              a = function () {
                var t = at(this, w.extend({}, e), o);
                (r || Y.get(this, "finish")) && t.stop(!0);
              };
            return (
              (a.finish = a),
              r || !1 === o.queue ? this.each(a) : this.queue(o.queue, a)
            );
          },
          stop: function (e, t, n) {
            var i = function (e) {
              var t = e.stop;
              delete e.stop, t(n);
            };
            return (
              "string" != typeof e && ((n = t), (t = e), (e = void 0)),
              t && !1 !== e && this.queue(e || "fx", []),
              this.each(function () {
                var t = !0,
                  r = null != e && e + "queueHooks",
                  o = w.timers,
                  a = Y.get(this);
                if (r) a[r] && a[r].stop && i(a[r]);
                else for (r in a) a[r] && a[r].stop && tt.test(r) && i(a[r]);
                for (r = o.length; r--; )
                  o[r].elem !== this ||
                    (null != e && o[r].queue !== e) ||
                    (o[r].anim.stop(n), (t = !1), o.splice(r, 1));
                (!t && n) || w.dequeue(this, e);
              })
            );
          },
          finish: function (e) {
            return (
              !1 !== e && (e = e || "fx"),
              this.each(function () {
                var t,
                  n = Y.get(this),
                  i = n[e + "queue"],
                  r = n[e + "queueHooks"],
                  o = w.timers,
                  a = i ? i.length : 0;
                for (
                  n.finish = !0,
                    w.queue(this, e, []),
                    r && r.stop && r.stop.call(this, !0),
                    t = o.length;
                  t--;

                )
                  o[t].elem === this &&
                    o[t].queue === e &&
                    (o[t].anim.stop(!0), o.splice(t, 1));
                for (t = 0; t < a; t++)
                  i[t] && i[t].finish && i[t].finish.call(this);
                delete n.finish;
              })
            );
          },
        }),
        w.each(["toggle", "show", "hide"], function (e, t) {
          var n = w.fn[t];
          w.fn[t] = function (e, i, r) {
            return null == e || "boolean" == typeof e
              ? n.apply(this, arguments)
              : this.animate(rt(t, !0), e, i, r);
          };
        }),
        w.each(
          {
            slideDown: rt("show"),
            slideUp: rt("hide"),
            slideToggle: rt("toggle"),
            fadeIn: { opacity: "show" },
            fadeOut: { opacity: "hide" },
            fadeToggle: { opacity: "toggle" },
          },
          function (e, t) {
            w.fn[e] = function (e, n, i) {
              return this.animate(t, e, n, i);
            };
          }
        ),
        (w.timers = []),
        (w.fx.tick = function () {
          var e,
            t = 0,
            n = w.timers;
          for (Xe = Date.now(); t < n.length; t++)
            (e = n[t])() || n[t] !== e || n.splice(t--, 1);
          n.length || w.fx.stop(), (Xe = void 0);
        }),
        (w.fx.timer = function (e) {
          w.timers.push(e), w.fx.start();
        }),
        (w.fx.interval = 13),
        (w.fx.start = function () {
          Ze || ((Ze = !0), nt());
        }),
        (w.fx.stop = function () {
          Ze = null;
        }),
        (w.fx.speeds = { slow: 600, fast: 200, _default: 400 }),
        (w.fn.delay = function (t, n) {
          return (
            (t = (w.fx && w.fx.speeds[t]) || t),
            (n = n || "fx"),
            this.queue(n, function (n, i) {
              var r = e.setTimeout(n, t);
              i.stop = function () {
                e.clearTimeout(r);
              };
            })
          );
        }),
        (function () {
          var e = i.createElement("input"),
            t = i
              .createElement("select")
              .appendChild(i.createElement("option"));
          (e.type = "checkbox"),
            (f.checkOn = "" !== e.value),
            (f.optSelected = t.selected),
            ((e = i.createElement("input")).value = "t"),
            (e.type = "radio"),
            (f.radioValue = "t" === e.value);
        })();
      var st,
        lt = w.expr.attrHandle;
      w.fn.extend({
        attr: function (e, t) {
          return j(this, w.attr, e, t, arguments.length > 1);
        },
        removeAttr: function (e) {
          return this.each(function () {
            w.removeAttr(this, e);
          });
        },
      }),
        w.extend({
          attr: function (e, t, n) {
            var i,
              r,
              o = e.nodeType;
            if (3 !== o && 8 !== o && 2 !== o)
              return void 0 === e.getAttribute
                ? w.prop(e, t, n)
                : ((1 === o && w.isXMLDoc(e)) ||
                    (r =
                      w.attrHooks[t.toLowerCase()] ||
                      (w.expr.match.bool.test(t) ? st : void 0)),
                  void 0 !== n
                    ? null === n
                      ? void w.removeAttr(e, t)
                      : r && "set" in r && void 0 !== (i = r.set(e, n, t))
                      ? i
                      : (e.setAttribute(t, n + ""), n)
                    : r && "get" in r && null !== (i = r.get(e, t))
                    ? i
                    : null == (i = w.find.attr(e, t))
                    ? void 0
                    : i);
          },
          attrHooks: {
            type: {
              set: function (e, t) {
                if (!f.radioValue && "radio" === t && T(e, "input")) {
                  var n = e.value;
                  return e.setAttribute("type", t), n && (e.value = n), t;
                }
              },
            },
          },
          removeAttr: function (e, t) {
            var n,
              i = 0,
              r = t && t.match(R);
            if (r && 1 === e.nodeType)
              for (; (n = r[i++]); ) e.removeAttribute(n);
          },
        }),
        (st = {
          set: function (e, t, n) {
            return !1 === t ? w.removeAttr(e, n) : e.setAttribute(n, n), n;
          },
        }),
        w.each(w.expr.match.bool.source.match(/\w+/g), function (e, t) {
          var n = lt[t] || w.find.attr;
          lt[t] = function (e, t, i) {
            var r,
              o,
              a = t.toLowerCase();
            return (
              i ||
                ((o = lt[a]),
                (lt[a] = r),
                (r = null != n(e, t, i) ? a : null),
                (lt[a] = o)),
              r
            );
          };
        });
      var ct = /^(?:input|select|textarea|button)$/i,
        dt = /^(?:a|area)$/i;
      function ut(e) {
        return (e.match(R) || []).join(" ");
      }
      function ht(e) {
        return (e.getAttribute && e.getAttribute("class")) || "";
      }
      function pt(e) {
        return Array.isArray(e)
          ? e
          : ("string" == typeof e && e.match(R)) || [];
      }
      w.fn.extend({
        prop: function (e, t) {
          return j(this, w.prop, e, t, arguments.length > 1);
        },
        removeProp: function (e) {
          return this.each(function () {
            delete this[w.propFix[e] || e];
          });
        },
      }),
        w.extend({
          prop: function (e, t, n) {
            var i,
              r,
              o = e.nodeType;
            if (3 !== o && 8 !== o && 2 !== o)
              return (
                (1 === o && w.isXMLDoc(e)) ||
                  ((t = w.propFix[t] || t), (r = w.propHooks[t])),
                void 0 !== n
                  ? r && "set" in r && void 0 !== (i = r.set(e, n, t))
                    ? i
                    : (e[t] = n)
                  : r && "get" in r && null !== (i = r.get(e, t))
                  ? i
                  : e[t]
              );
          },
          propHooks: {
            tabIndex: {
              get: function (e) {
                var t = w.find.attr(e, "tabindex");
                return t
                  ? parseInt(t, 10)
                  : ct.test(e.nodeName) || (dt.test(e.nodeName) && e.href)
                  ? 0
                  : -1;
              },
            },
          },
          propFix: { for: "htmlFor", class: "className" },
        }),
        f.optSelected ||
          (w.propHooks.selected = {
            get: function (e) {
              var t = e.parentNode;
              return t && t.parentNode && t.parentNode.selectedIndex, null;
            },
            set: function (e) {
              var t = e.parentNode;
              t &&
                (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex);
            },
          }),
        w.each(
          [
            "tabIndex",
            "readOnly",
            "maxLength",
            "cellSpacing",
            "cellPadding",
            "rowSpan",
            "colSpan",
            "useMap",
            "frameBorder",
            "contentEditable",
          ],
          function () {
            w.propFix[this.toLowerCase()] = this;
          }
        ),
        w.fn.extend({
          addClass: function (e) {
            var t,
              n,
              i,
              r,
              o,
              a,
              s,
              l = 0;
            if (m(e))
              return this.each(function (t) {
                w(this).addClass(e.call(this, t, ht(this)));
              });
            if ((t = pt(e)).length)
              for (; (n = this[l++]); )
                if (
                  ((r = ht(n)), (i = 1 === n.nodeType && " " + ut(r) + " "))
                ) {
                  for (a = 0; (o = t[a++]); )
                    i.indexOf(" " + o + " ") < 0 && (i += o + " ");
                  r !== (s = ut(i)) && n.setAttribute("class", s);
                }
            return this;
          },
          removeClass: function (e) {
            var t,
              n,
              i,
              r,
              o,
              a,
              s,
              l = 0;
            if (m(e))
              return this.each(function (t) {
                w(this).removeClass(e.call(this, t, ht(this)));
              });
            if (!arguments.length) return this.attr("class", "");
            if ((t = pt(e)).length)
              for (; (n = this[l++]); )
                if (
                  ((r = ht(n)), (i = 1 === n.nodeType && " " + ut(r) + " "))
                ) {
                  for (a = 0; (o = t[a++]); )
                    for (; i.indexOf(" " + o + " ") > -1; )
                      i = i.replace(" " + o + " ", " ");
                  r !== (s = ut(i)) && n.setAttribute("class", s);
                }
            return this;
          },
          toggleClass: function (e, t) {
            var n = typeof e,
              i = "string" === n || Array.isArray(e);
            return "boolean" == typeof t && i
              ? t
                ? this.addClass(e)
                : this.removeClass(e)
              : m(e)
              ? this.each(function (n) {
                  w(this).toggleClass(e.call(this, n, ht(this), t), t);
                })
              : this.each(function () {
                  var t, r, o, a;
                  if (i)
                    for (r = 0, o = w(this), a = pt(e); (t = a[r++]); )
                      o.hasClass(t) ? o.removeClass(t) : o.addClass(t);
                  else
                    (void 0 !== e && "boolean" !== n) ||
                      ((t = ht(this)) && Y.set(this, "__className__", t),
                      this.setAttribute &&
                        this.setAttribute(
                          "class",
                          t || !1 === e
                            ? ""
                            : Y.get(this, "__className__") || ""
                        ));
                });
          },
          hasClass: function (e) {
            var t,
              n,
              i = 0;
            for (t = " " + e + " "; (n = this[i++]); )
              if (1 === n.nodeType && (" " + ut(ht(n)) + " ").indexOf(t) > -1)
                return !0;
            return !1;
          },
        });
      var ft = /\r/g;
      w.fn.extend({
        val: function (e) {
          var t,
            n,
            i,
            r = this[0];
          return arguments.length
            ? ((i = m(e)),
              this.each(function (n) {
                var r;
                1 === this.nodeType &&
                  (null == (r = i ? e.call(this, n, w(this).val()) : e)
                    ? (r = "")
                    : "number" == typeof r
                    ? (r += "")
                    : Array.isArray(r) &&
                      (r = w.map(r, function (e) {
                        return null == e ? "" : e + "";
                      })),
                  ((t =
                    w.valHooks[this.type] ||
                    w.valHooks[this.nodeName.toLowerCase()]) &&
                    "set" in t &&
                    void 0 !== t.set(this, r, "value")) ||
                    (this.value = r));
              }))
            : r
            ? (t =
                w.valHooks[r.type] || w.valHooks[r.nodeName.toLowerCase()]) &&
              "get" in t &&
              void 0 !== (n = t.get(r, "value"))
              ? n
              : "string" == typeof (n = r.value)
              ? n.replace(ft, "")
              : null == n
              ? ""
              : n
            : void 0;
        },
      }),
        w.extend({
          valHooks: {
            option: {
              get: function (e) {
                var t = w.find.attr(e, "value");
                return null != t ? t : ut(w.text(e));
              },
            },
            select: {
              get: function (e) {
                var t,
                  n,
                  i,
                  r = e.options,
                  o = e.selectedIndex,
                  a = "select-one" === e.type,
                  s = a ? null : [],
                  l = a ? o + 1 : r.length;
                for (i = o < 0 ? l : a ? o : 0; i < l; i++)
                  if (
                    ((n = r[i]).selected || i === o) &&
                    !n.disabled &&
                    (!n.parentNode.disabled || !T(n.parentNode, "optgroup"))
                  ) {
                    if (((t = w(n).val()), a)) return t;
                    s.push(t);
                  }
                return s;
              },
              set: function (e, t) {
                for (
                  var n, i, r = e.options, o = w.makeArray(t), a = r.length;
                  a--;

                )
                  ((i = r[a]).selected =
                    w.inArray(w.valHooks.option.get(i), o) > -1) && (n = !0);
                return n || (e.selectedIndex = -1), o;
              },
            },
          },
        }),
        w.each(["radio", "checkbox"], function () {
          (w.valHooks[this] = {
            set: function (e, t) {
              if (Array.isArray(t))
                return (e.checked = w.inArray(w(e).val(), t) > -1);
            },
          }),
            f.checkOn ||
              (w.valHooks[this].get = function (e) {
                return null === e.getAttribute("value") ? "on" : e.value;
              });
        }),
        (f.focusin = "onfocusin" in e);
      var mt = /^(?:focusinfocus|focusoutblur)$/,
        gt = function (e) {
          e.stopPropagation();
        };
      w.extend(w.event, {
        trigger: function (t, n, r, o) {
          var a,
            s,
            l,
            c,
            d,
            h,
            p,
            f,
            v = [r || i],
            y = u.call(t, "type") ? t.type : t,
            b = u.call(t, "namespace") ? t.namespace.split(".") : [];
          if (
            ((s = f = l = r = r || i),
            3 !== r.nodeType &&
              8 !== r.nodeType &&
              !mt.test(y + w.event.triggered) &&
              (y.indexOf(".") > -1 &&
                ((y = (b = y.split(".")).shift()), b.sort()),
              (d = y.indexOf(":") < 0 && "on" + y),
              ((t = t[w.expando]
                ? t
                : new w.Event(y, "object" == typeof t && t)).isTrigger = o
                ? 2
                : 3),
              (t.namespace = b.join(".")),
              (t.rnamespace = t.namespace
                ? new RegExp("(^|\\.)" + b.join("\\.(?:.*\\.|)") + "(\\.|$)")
                : null),
              (t.result = void 0),
              t.target || (t.target = r),
              (n = null == n ? [t] : w.makeArray(n, [t])),
              (p = w.event.special[y] || {}),
              o || !p.trigger || !1 !== p.trigger.apply(r, n)))
          ) {
            if (!o && !p.noBubble && !g(r)) {
              for (
                c = p.delegateType || y, mt.test(c + y) || (s = s.parentNode);
                s;
                s = s.parentNode
              )
                v.push(s), (l = s);
              l === (r.ownerDocument || i) &&
                v.push(l.defaultView || l.parentWindow || e);
            }
            for (a = 0; (s = v[a++]) && !t.isPropagationStopped(); )
              (f = s),
                (t.type = a > 1 ? c : p.bindType || y),
                (h =
                  (Y.get(s, "events") || {})[t.type] && Y.get(s, "handle")) &&
                  h.apply(s, n),
                (h = d && s[d]) &&
                  h.apply &&
                  J(s) &&
                  ((t.result = h.apply(s, n)),
                  !1 === t.result && t.preventDefault());
            return (
              (t.type = y),
              o ||
                t.isDefaultPrevented() ||
                (p._default && !1 !== p._default.apply(v.pop(), n)) ||
                !J(r) ||
                (d &&
                  m(r[y]) &&
                  !g(r) &&
                  ((l = r[d]) && (r[d] = null),
                  (w.event.triggered = y),
                  t.isPropagationStopped() && f.addEventListener(y, gt),
                  r[y](),
                  t.isPropagationStopped() && f.removeEventListener(y, gt),
                  (w.event.triggered = void 0),
                  l && (r[d] = l))),
              t.result
            );
          }
        },
        simulate: function (e, t, n) {
          var i = w.extend(new w.Event(), n, { type: e, isSimulated: !0 });
          w.event.trigger(i, null, t);
        },
      }),
        w.fn.extend({
          trigger: function (e, t) {
            return this.each(function () {
              w.event.trigger(e, t, this);
            });
          },
          triggerHandler: function (e, t) {
            var n = this[0];
            if (n) return w.event.trigger(e, t, n, !0);
          },
        }),
        f.focusin ||
          w.each({ focus: "focusin", blur: "focusout" }, function (e, t) {
            var n = function (e) {
              w.event.simulate(t, e.target, w.event.fix(e));
            };
            w.event.special[t] = {
              setup: function () {
                var i = this.ownerDocument || this,
                  r = Y.access(i, t);
                r || i.addEventListener(e, n, !0), Y.access(i, t, (r || 0) + 1);
              },
              teardown: function () {
                var i = this.ownerDocument || this,
                  r = Y.access(i, t) - 1;
                r
                  ? Y.access(i, t, r)
                  : (i.removeEventListener(e, n, !0), Y.remove(i, t));
              },
            };
          });
      var vt = e.location,
        yt = Date.now(),
        bt = /\?/;
      w.parseXML = function (t) {
        var n;
        if (!t || "string" != typeof t) return null;
        try {
          n = new e.DOMParser().parseFromString(t, "text/xml");
        } catch (e) {
          n = void 0;
        }
        return (
          (n && !n.getElementsByTagName("parsererror").length) ||
            w.error("Invalid XML: " + t),
          n
        );
      };
      var wt = /\[\]$/,
        xt = /\r?\n/g,
        Ct = /^(?:submit|button|image|reset|file)$/i,
        Ft = /^(?:input|select|textarea|keygen)/i;
      function St(e, t, n, i) {
        var r;
        if (Array.isArray(t))
          w.each(t, function (t, r) {
            n || wt.test(e)
              ? i(e, r)
              : St(
                  e + "[" + ("object" == typeof r && null != r ? t : "") + "]",
                  r,
                  n,
                  i
                );
          });
        else if (n || "object" !== b(t)) i(e, t);
        else for (r in t) St(e + "[" + r + "]", t[r], n, i);
      }
      (w.param = function (e, t) {
        var n,
          i = [],
          r = function (e, t) {
            var n = m(t) ? t() : t;
            i[i.length] =
              encodeURIComponent(e) +
              "=" +
              encodeURIComponent(null == n ? "" : n);
          };
        if (Array.isArray(e) || (e.jquery && !w.isPlainObject(e)))
          w.each(e, function () {
            r(this.name, this.value);
          });
        else for (n in e) St(n, e[n], t, r);
        return i.join("&");
      }),
        w.fn.extend({
          serialize: function () {
            return w.param(this.serializeArray());
          },
          serializeArray: function () {
            return this.map(function () {
              var e = w.prop(this, "elements");
              return e ? w.makeArray(e) : this;
            })
              .filter(function () {
                var e = this.type;
                return (
                  this.name &&
                  !w(this).is(":disabled") &&
                  Ft.test(this.nodeName) &&
                  !Ct.test(e) &&
                  (this.checked || !ce.test(e))
                );
              })
              .map(function (e, t) {
                var n = w(this).val();
                return null == n
                  ? null
                  : Array.isArray(n)
                  ? w.map(n, function (e) {
                      return { name: t.name, value: e.replace(xt, "\r\n") };
                    })
                  : { name: t.name, value: n.replace(xt, "\r\n") };
              })
              .get();
          },
        });
      var kt = /%20/g,
        Et = /#.*$/,
        Tt = /([?&])_=[^&]*/,
        _t = /^(.*?):[ \t]*([^\r\n]*)$/gm,
        At = /^(?:GET|HEAD)$/,
        Mt = /^\/\//,
        Lt = {},
        Nt = {},
        Dt = "*/".concat("*"),
        Bt = i.createElement("a");
      function Rt(e) {
        return function (t, n) {
          "string" != typeof t && ((n = t), (t = "*"));
          var i,
            r = 0,
            o = t.toLowerCase().match(R) || [];
          if (m(n))
            for (; (i = o[r++]); )
              "+" === i[0]
                ? ((i = i.slice(1) || "*"), (e[i] = e[i] || []).unshift(n))
                : (e[i] = e[i] || []).push(n);
        };
      }
      function Pt(e, t, n, i) {
        var r = {},
          o = e === Nt;
        function a(s) {
          var l;
          return (
            (r[s] = !0),
            w.each(e[s] || [], function (e, s) {
              var c = s(t, n, i);
              return "string" != typeof c || o || r[c]
                ? o
                  ? !(l = c)
                  : void 0
                : (t.dataTypes.unshift(c), a(c), !1);
            }),
            l
          );
        }
        return a(t.dataTypes[0]) || (!r["*"] && a("*"));
      }
      function It(e, t) {
        var n,
          i,
          r = w.ajaxSettings.flatOptions || {};
        for (n in t) void 0 !== t[n] && ((r[n] ? e : i || (i = {}))[n] = t[n]);
        return i && w.extend(!0, e, i), e;
      }
      (Bt.href = vt.href),
        w.extend({
          active: 0,
          lastModified: {},
          etag: {},
          ajaxSettings: {
            url: vt.href,
            type: "GET",
            isLocal:
              /^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(
                vt.protocol
              ),
            global: !0,
            processData: !0,
            async: !0,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            accepts: {
              "*": Dt,
              text: "text/plain",
              html: "text/html",
              xml: "application/xml, text/xml",
              json: "application/json, text/javascript",
            },
            contents: { xml: /\bxml\b/, html: /\bhtml/, json: /\bjson\b/ },
            responseFields: {
              xml: "responseXML",
              text: "responseText",
              json: "responseJSON",
            },
            converters: {
              "* text": String,
              "text html": !0,
              "text json": JSON.parse,
              "text xml": w.parseXML,
            },
            flatOptions: { url: !0, context: !0 },
          },
          ajaxSetup: function (e, t) {
            return t ? It(It(e, w.ajaxSettings), t) : It(w.ajaxSettings, e);
          },
          ajaxPrefilter: Rt(Lt),
          ajaxTransport: Rt(Nt),
          ajax: function (t, n) {
            "object" == typeof t && ((n = t), (t = void 0)), (n = n || {});
            var r,
              o,
              a,
              s,
              l,
              c,
              d,
              u,
              h,
              p,
              f = w.ajaxSetup({}, n),
              m = f.context || f,
              g = f.context && (m.nodeType || m.jquery) ? w(m) : w.event,
              v = w.Deferred(),
              y = w.Callbacks("once memory"),
              b = f.statusCode || {},
              x = {},
              C = {},
              F = "canceled",
              S = {
                readyState: 0,
                getResponseHeader: function (e) {
                  var t;
                  if (d) {
                    if (!s)
                      for (s = {}; (t = _t.exec(a)); )
                        s[t[1].toLowerCase()] = t[2];
                    t = s[e.toLowerCase()];
                  }
                  return null == t ? null : t;
                },
                getAllResponseHeaders: function () {
                  return d ? a : null;
                },
                setRequestHeader: function (e, t) {
                  return (
                    null == d &&
                      ((e = C[e.toLowerCase()] = C[e.toLowerCase()] || e),
                      (x[e] = t)),
                    this
                  );
                },
                overrideMimeType: function (e) {
                  return null == d && (f.mimeType = e), this;
                },
                statusCode: function (e) {
                  var t;
                  if (e)
                    if (d) S.always(e[S.status]);
                    else for (t in e) b[t] = [b[t], e[t]];
                  return this;
                },
                abort: function (e) {
                  var t = e || F;
                  return r && r.abort(t), k(0, t), this;
                },
              };
            if (
              (v.promise(S),
              (f.url = ((t || f.url || vt.href) + "").replace(
                Mt,
                vt.protocol + "//"
              )),
              (f.type = n.method || n.type || f.method || f.type),
              (f.dataTypes = (f.dataType || "*").toLowerCase().match(R) || [
                "",
              ]),
              null == f.crossDomain)
            ) {
              c = i.createElement("a");
              try {
                (c.href = f.url),
                  (c.href = c.href),
                  (f.crossDomain =
                    Bt.protocol + "//" + Bt.host != c.protocol + "//" + c.host);
              } catch (e) {
                f.crossDomain = !0;
              }
            }
            if (
              (f.data &&
                f.processData &&
                "string" != typeof f.data &&
                (f.data = w.param(f.data, f.traditional)),
              Pt(Lt, f, n, S),
              d)
            )
              return S;
            for (h in ((u = w.event && f.global) &&
              0 == w.active++ &&
              w.event.trigger("ajaxStart"),
            (f.type = f.type.toUpperCase()),
            (f.hasContent = !At.test(f.type)),
            (o = f.url.replace(Et, "")),
            f.hasContent
              ? f.data &&
                f.processData &&
                0 ===
                  (f.contentType || "").indexOf(
                    "application/x-www-form-urlencoded"
                  ) &&
                (f.data = f.data.replace(kt, "+"))
              : ((p = f.url.slice(o.length)),
                f.data &&
                  (f.processData || "string" == typeof f.data) &&
                  ((o += (bt.test(o) ? "&" : "?") + f.data), delete f.data),
                !1 === f.cache &&
                  ((o = o.replace(Tt, "$1")),
                  (p = (bt.test(o) ? "&" : "?") + "_=" + yt++ + p)),
                (f.url = o + p)),
            f.ifModified &&
              (w.lastModified[o] &&
                S.setRequestHeader("If-Modified-Since", w.lastModified[o]),
              w.etag[o] && S.setRequestHeader("If-None-Match", w.etag[o])),
            ((f.data && f.hasContent && !1 !== f.contentType) ||
              n.contentType) &&
              S.setRequestHeader("Content-Type", f.contentType),
            S.setRequestHeader(
              "Accept",
              f.dataTypes[0] && f.accepts[f.dataTypes[0]]
                ? f.accepts[f.dataTypes[0]] +
                    ("*" !== f.dataTypes[0] ? ", " + Dt + "; q=0.01" : "")
                : f.accepts["*"]
            ),
            f.headers))
              S.setRequestHeader(h, f.headers[h]);
            if (f.beforeSend && (!1 === f.beforeSend.call(m, S, f) || d))
              return S.abort();
            if (
              ((F = "abort"),
              y.add(f.complete),
              S.done(f.success),
              S.fail(f.error),
              (r = Pt(Nt, f, n, S)))
            ) {
              if (((S.readyState = 1), u && g.trigger("ajaxSend", [S, f]), d))
                return S;
              f.async &&
                f.timeout > 0 &&
                (l = e.setTimeout(function () {
                  S.abort("timeout");
                }, f.timeout));
              try {
                (d = !1), r.send(x, k);
              } catch (e) {
                if (d) throw e;
                k(-1, e);
              }
            } else k(-1, "No Transport");
            function k(t, n, i, s) {
              var c,
                h,
                p,
                x,
                C,
                F = n;
              d ||
                ((d = !0),
                l && e.clearTimeout(l),
                (r = void 0),
                (a = s || ""),
                (S.readyState = t > 0 ? 4 : 0),
                (c = (t >= 200 && t < 300) || 304 === t),
                i &&
                  (x = (function (e, t, n) {
                    for (
                      var i, r, o, a, s = e.contents, l = e.dataTypes;
                      "*" === l[0];

                    )
                      l.shift(),
                        void 0 === i &&
                          (i =
                            e.mimeType || t.getResponseHeader("Content-Type"));
                    if (i)
                      for (r in s)
                        if (s[r] && s[r].test(i)) {
                          l.unshift(r);
                          break;
                        }
                    if (l[0] in n) o = l[0];
                    else {
                      for (r in n) {
                        if (!l[0] || e.converters[r + " " + l[0]]) {
                          o = r;
                          break;
                        }
                        a || (a = r);
                      }
                      o = o || a;
                    }
                    if (o) return o !== l[0] && l.unshift(o), n[o];
                  })(f, S, i)),
                (x = (function (e, t, n, i) {
                  var r,
                    o,
                    a,
                    s,
                    l,
                    c = {},
                    d = e.dataTypes.slice();
                  if (d[1])
                    for (a in e.converters)
                      c[a.toLowerCase()] = e.converters[a];
                  for (o = d.shift(); o; )
                    if (
                      (e.responseFields[o] && (n[e.responseFields[o]] = t),
                      !l &&
                        i &&
                        e.dataFilter &&
                        (t = e.dataFilter(t, e.dataType)),
                      (l = o),
                      (o = d.shift()))
                    )
                      if ("*" === o) o = l;
                      else if ("*" !== l && l !== o) {
                        if (!(a = c[l + " " + o] || c["* " + o]))
                          for (r in c)
                            if (
                              (s = r.split(" "))[1] === o &&
                              (a = c[l + " " + s[0]] || c["* " + s[0]])
                            ) {
                              !0 === a
                                ? (a = c[r])
                                : !0 !== c[r] && ((o = s[0]), d.unshift(s[1]));
                              break;
                            }
                        if (!0 !== a)
                          if (a && e.throws) t = a(t);
                          else
                            try {
                              t = a(t);
                            } catch (e) {
                              return {
                                state: "parsererror",
                                error: a
                                  ? e
                                  : "No conversion from " + l + " to " + o,
                              };
                            }
                      }
                  return { state: "success", data: t };
                })(f, x, S, c)),
                c
                  ? (f.ifModified &&
                      ((C = S.getResponseHeader("Last-Modified")) &&
                        (w.lastModified[o] = C),
                      (C = S.getResponseHeader("etag")) && (w.etag[o] = C)),
                    204 === t || "HEAD" === f.type
                      ? (F = "nocontent")
                      : 304 === t
                      ? (F = "notmodified")
                      : ((F = x.state), (h = x.data), (c = !(p = x.error))))
                  : ((p = F), (!t && F) || ((F = "error"), t < 0 && (t = 0))),
                (S.status = t),
                (S.statusText = (n || F) + ""),
                c ? v.resolveWith(m, [h, F, S]) : v.rejectWith(m, [S, F, p]),
                S.statusCode(b),
                (b = void 0),
                u &&
                  g.trigger(c ? "ajaxSuccess" : "ajaxError", [S, f, c ? h : p]),
                y.fireWith(m, [S, F]),
                u &&
                  (g.trigger("ajaxComplete", [S, f]),
                  --w.active || w.event.trigger("ajaxStop")));
            }
            return S;
          },
          getJSON: function (e, t, n) {
            return w.get(e, t, n, "json");
          },
          getScript: function (e, t) {
            return w.get(e, void 0, t, "script");
          },
        }),
        w.each(["get", "post"], function (e, t) {
          w[t] = function (e, n, i, r) {
            return (
              m(n) && ((r = r || i), (i = n), (n = void 0)),
              w.ajax(
                w.extend(
                  { url: e, type: t, dataType: r, data: n, success: i },
                  w.isPlainObject(e) && e
                )
              )
            );
          };
        }),
        (w._evalUrl = function (e) {
          return w.ajax({
            url: e,
            type: "GET",
            dataType: "script",
            cache: !0,
            async: !1,
            global: !1,
            throws: !0,
          });
        }),
        w.fn.extend({
          wrapAll: function (e) {
            var t;
            return (
              this[0] &&
                (m(e) && (e = e.call(this[0])),
                (t = w(e, this[0].ownerDocument).eq(0).clone(!0)),
                this[0].parentNode && t.insertBefore(this[0]),
                t
                  .map(function () {
                    for (var e = this; e.firstElementChild; )
                      e = e.firstElementChild;
                    return e;
                  })
                  .append(this)),
              this
            );
          },
          wrapInner: function (e) {
            return m(e)
              ? this.each(function (t) {
                  w(this).wrapInner(e.call(this, t));
                })
              : this.each(function () {
                  var t = w(this),
                    n = t.contents();
                  n.length ? n.wrapAll(e) : t.append(e);
                });
          },
          wrap: function (e) {
            var t = m(e);
            return this.each(function (n) {
              w(this).wrapAll(t ? e.call(this, n) : e);
            });
          },
          unwrap: function (e) {
            return (
              this.parent(e)
                .not("body")
                .each(function () {
                  w(this).replaceWith(this.childNodes);
                }),
              this
            );
          },
        }),
        (w.expr.pseudos.hidden = function (e) {
          return !w.expr.pseudos.visible(e);
        }),
        (w.expr.pseudos.visible = function (e) {
          return !!(
            e.offsetWidth ||
            e.offsetHeight ||
            e.getClientRects().length
          );
        }),
        (w.ajaxSettings.xhr = function () {
          try {
            return new e.XMLHttpRequest();
          } catch (e) {}
        });
      var Ot = { 0: 200, 1223: 204 },
        $t = w.ajaxSettings.xhr();
      (f.cors = !!$t && "withCredentials" in $t),
        (f.ajax = $t = !!$t),
        w.ajaxTransport(function (t) {
          var n, i;
          if (f.cors || ($t && !t.crossDomain))
            return {
              send: function (r, o) {
                var a,
                  s = t.xhr();
                if (
                  (s.open(t.type, t.url, t.async, t.username, t.password),
                  t.xhrFields)
                )
                  for (a in t.xhrFields) s[a] = t.xhrFields[a];
                for (a in (t.mimeType &&
                  s.overrideMimeType &&
                  s.overrideMimeType(t.mimeType),
                t.crossDomain ||
                  r["X-Requested-With"] ||
                  (r["X-Requested-With"] = "XMLHttpRequest"),
                r))
                  s.setRequestHeader(a, r[a]);
                (n = function (e) {
                  return function () {
                    n &&
                      ((n =
                        i =
                        s.onload =
                        s.onerror =
                        s.onabort =
                        s.ontimeout =
                        s.onreadystatechange =
                          null),
                      "abort" === e
                        ? s.abort()
                        : "error" === e
                        ? "number" != typeof s.status
                          ? o(0, "error")
                          : o(s.status, s.statusText)
                        : o(
                            Ot[s.status] || s.status,
                            s.statusText,
                            "text" !== (s.responseType || "text") ||
                              "string" != typeof s.responseText
                              ? { binary: s.response }
                              : { text: s.responseText },
                            s.getAllResponseHeaders()
                          ));
                  };
                }),
                  (s.onload = n()),
                  (i = s.onerror = s.ontimeout = n("error")),
                  void 0 !== s.onabort
                    ? (s.onabort = i)
                    : (s.onreadystatechange = function () {
                        4 === s.readyState &&
                          e.setTimeout(function () {
                            n && i();
                          });
                      }),
                  (n = n("abort"));
                try {
                  s.send((t.hasContent && t.data) || null);
                } catch (e) {
                  if (n) throw e;
                }
              },
              abort: function () {
                n && n();
              },
            };
        }),
        w.ajaxPrefilter(function (e) {
          e.crossDomain && (e.contents.script = !1);
        }),
        w.ajaxSetup({
          accepts: {
            script:
              "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",
          },
          contents: { script: /\b(?:java|ecma)script\b/ },
          converters: {
            "text script": function (e) {
              return w.globalEval(e), e;
            },
          },
        }),
        w.ajaxPrefilter("script", function (e) {
          void 0 === e.cache && (e.cache = !1),
            e.crossDomain && (e.type = "GET");
        }),
        w.ajaxTransport("script", function (e) {
          var t, n;
          if (e.crossDomain)
            return {
              send: function (r, o) {
                (t = w("<script>")
                  .prop({ charset: e.scriptCharset, src: e.url })
                  .on(
                    "load error",
                    (n = function (e) {
                      t.remove(),
                        (n = null),
                        e && o("error" === e.type ? 404 : 200, e.type);
                    })
                  )),
                  i.head.appendChild(t[0]);
              },
              abort: function () {
                n && n();
              },
            };
        });
      var Ht = [],
        Ut = /(=)\?(?=&|$)|\?\?/;
      w.ajaxSetup({
        jsonp: "callback",
        jsonpCallback: function () {
          var e = Ht.pop() || w.expando + "_" + yt++;
          return (this[e] = !0), e;
        },
      }),
        w.ajaxPrefilter("json jsonp", function (t, n, i) {
          var r,
            o,
            a,
            s =
              !1 !== t.jsonp &&
              (Ut.test(t.url)
                ? "url"
                : "string" == typeof t.data &&
                  0 ===
                    (t.contentType || "").indexOf(
                      "application/x-www-form-urlencoded"
                    ) &&
                  Ut.test(t.data) &&
                  "data");
          if (s || "jsonp" === t.dataTypes[0])
            return (
              (r = t.jsonpCallback =
                m(t.jsonpCallback) ? t.jsonpCallback() : t.jsonpCallback),
              s
                ? (t[s] = t[s].replace(Ut, "$1" + r))
                : !1 !== t.jsonp &&
                  (t.url += (bt.test(t.url) ? "&" : "?") + t.jsonp + "=" + r),
              (t.converters["script json"] = function () {
                return a || w.error(r + " was not called"), a[0];
              }),
              (t.dataTypes[0] = "json"),
              (o = e[r]),
              (e[r] = function () {
                a = arguments;
              }),
              i.always(function () {
                void 0 === o ? w(e).removeProp(r) : (e[r] = o),
                  t[r] && ((t.jsonpCallback = n.jsonpCallback), Ht.push(r)),
                  a && m(o) && o(a[0]),
                  (a = o = void 0);
              }),
              "script"
            );
        }),
        (f.createHTMLDocument = (function () {
          var e = i.implementation.createHTMLDocument("").body;
          return (
            (e.innerHTML = "<form></form><form></form>"),
            2 === e.childNodes.length
          );
        })()),
        (w.parseHTML = function (e, t, n) {
          return "string" != typeof e
            ? []
            : ("boolean" == typeof t && ((n = t), (t = !1)),
              t ||
                (f.createHTMLDocument
                  ? (((r = (t =
                      i.implementation.createHTMLDocument("")).createElement(
                      "base"
                    )).href = i.location.href),
                    t.head.appendChild(r))
                  : (t = i)),
              (o = _.exec(e)),
              (a = !n && []),
              o
                ? [t.createElement(o[1])]
                : ((o = ge([e], t, a)),
                  a && a.length && w(a).remove(),
                  w.merge([], o.childNodes)));
          var r, o, a;
        }),
        (w.fn.load = function (e, t, n) {
          var i,
            r,
            o,
            a = this,
            s = e.indexOf(" ");
          return (
            s > -1 && ((i = ut(e.slice(s))), (e = e.slice(0, s))),
            m(t)
              ? ((n = t), (t = void 0))
              : t && "object" == typeof t && (r = "POST"),
            a.length > 0 &&
              w
                .ajax({ url: e, type: r || "GET", dataType: "html", data: t })
                .done(function (e) {
                  (o = arguments),
                    a.html(i ? w("<div>").append(w.parseHTML(e)).find(i) : e);
                })
                .always(
                  n &&
                    function (e, t) {
                      a.each(function () {
                        n.apply(this, o || [e.responseText, t, e]);
                      });
                    }
                ),
            this
          );
        }),
        w.each(
          [
            "ajaxStart",
            "ajaxStop",
            "ajaxComplete",
            "ajaxError",
            "ajaxSuccess",
            "ajaxSend",
          ],
          function (e, t) {
            w.fn[t] = function (e) {
              return this.on(t, e);
            };
          }
        ),
        (w.expr.pseudos.animated = function (e) {
          return w.grep(w.timers, function (t) {
            return e === t.elem;
          }).length;
        }),
        (w.offset = {
          setOffset: function (e, t, n) {
            var i,
              r,
              o,
              a,
              s,
              l,
              c = w.css(e, "position"),
              d = w(e),
              u = {};
            "static" === c && (e.style.position = "relative"),
              (s = d.offset()),
              (o = w.css(e, "top")),
              (l = w.css(e, "left")),
              ("absolute" === c || "fixed" === c) &&
              (o + l).indexOf("auto") > -1
                ? ((a = (i = d.position()).top), (r = i.left))
                : ((a = parseFloat(o) || 0), (r = parseFloat(l) || 0)),
              m(t) && (t = t.call(e, n, w.extend({}, s))),
              null != t.top && (u.top = t.top - s.top + a),
              null != t.left && (u.left = t.left - s.left + r),
              "using" in t ? t.using.call(e, u) : d.css(u);
          },
        }),
        w.fn.extend({
          offset: function (e) {
            if (arguments.length)
              return void 0 === e
                ? this
                : this.each(function (t) {
                    w.offset.setOffset(this, e, t);
                  });
            var t,
              n,
              i = this[0];
            return i
              ? i.getClientRects().length
                ? ((t = i.getBoundingClientRect()),
                  (n = i.ownerDocument.defaultView),
                  { top: t.top + n.pageYOffset, left: t.left + n.pageXOffset })
                : { top: 0, left: 0 }
              : void 0;
          },
          position: function () {
            if (this[0]) {
              var e,
                t,
                n,
                i = this[0],
                r = { top: 0, left: 0 };
              if ("fixed" === w.css(i, "position"))
                t = i.getBoundingClientRect();
              else {
                for (
                  t = this.offset(),
                    n = i.ownerDocument,
                    e = i.offsetParent || n.documentElement;
                  e &&
                  (e === n.body || e === n.documentElement) &&
                  "static" === w.css(e, "position");

                )
                  e = e.parentNode;
                e &&
                  e !== i &&
                  1 === e.nodeType &&
                  (((r = w(e).offset()).top += w.css(e, "borderTopWidth", !0)),
                  (r.left += w.css(e, "borderLeftWidth", !0)));
              }
              return {
                top: t.top - r.top - w.css(i, "marginTop", !0),
                left: t.left - r.left - w.css(i, "marginLeft", !0),
              };
            }
          },
          offsetParent: function () {
            return this.map(function () {
              for (
                var e = this.offsetParent;
                e && "static" === w.css(e, "position");

              )
                e = e.offsetParent;
              return e || ve;
            });
          },
        }),
        w.each(
          { scrollLeft: "pageXOffset", scrollTop: "pageYOffset" },
          function (e, t) {
            var n = "pageYOffset" === t;
            w.fn[e] = function (i) {
              return j(
                this,
                function (e, i, r) {
                  var o;
                  if (
                    (g(e) ? (o = e) : 9 === e.nodeType && (o = e.defaultView),
                    void 0 === r)
                  )
                    return o ? o[t] : e[i];
                  o
                    ? o.scrollTo(n ? o.pageXOffset : r, n ? r : o.pageYOffset)
                    : (e[i] = r);
                },
                e,
                i,
                arguments.length
              );
            };
          }
        ),
        w.each(["top", "left"], function (e, t) {
          w.cssHooks[t] = He(f.pixelPosition, function (e, n) {
            if (n)
              return (n = $e(e, t)), Pe.test(n) ? w(e).position()[t] + "px" : n;
          });
        }),
        w.each({ Height: "height", Width: "width" }, function (e, t) {
          w.each(
            { padding: "inner" + e, content: t, "": "outer" + e },
            function (n, i) {
              w.fn[i] = function (r, o) {
                var a = arguments.length && (n || "boolean" != typeof r),
                  s = n || (!0 === r || !0 === o ? "margin" : "border");
                return j(
                  this,
                  function (t, n, r) {
                    var o;
                    return g(t)
                      ? 0 === i.indexOf("outer")
                        ? t["inner" + e]
                        : t.document.documentElement["client" + e]
                      : 9 === t.nodeType
                      ? ((o = t.documentElement),
                        Math.max(
                          t.body["scroll" + e],
                          o["scroll" + e],
                          t.body["offset" + e],
                          o["offset" + e],
                          o["client" + e]
                        ))
                      : void 0 === r
                      ? w.css(t, n, s)
                      : w.style(t, n, r, s);
                  },
                  t,
                  a ? r : void 0,
                  a
                );
              };
            }
          );
        }),
        w.each(
          "blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(
            " "
          ),
          function (e, t) {
            w.fn[t] = function (e, n) {
              return arguments.length > 0
                ? this.on(t, null, e, n)
                : this.trigger(t);
            };
          }
        ),
        w.fn.extend({
          hover: function (e, t) {
            return this.mouseenter(e).mouseleave(t || e);
          },
        }),
        w.fn.extend({
          bind: function (e, t, n) {
            return this.on(e, null, t, n);
          },
          unbind: function (e, t) {
            return this.off(e, null, t);
          },
          delegate: function (e, t, n, i) {
            return this.on(t, e, n, i);
          },
          undelegate: function (e, t, n) {
            return 1 === arguments.length
              ? this.off(e, "**")
              : this.off(t, e || "**", n);
          },
        }),
        (w.proxy = function (e, t) {
          var n, i, r;
          if (("string" == typeof t && ((n = e[t]), (t = e), (e = n)), m(e)))
            return (
              (i = o.call(arguments, 2)),
              ((r = function () {
                return e.apply(t || this, i.concat(o.call(arguments)));
              }).guid = e.guid =
                e.guid || w.guid++),
              r
            );
        }),
        (w.holdReady = function (e) {
          e ? w.readyWait++ : w.ready(!0);
        }),
        (w.isArray = Array.isArray),
        (w.parseJSON = JSON.parse),
        (w.nodeName = T),
        (w.isFunction = m),
        (w.isWindow = g),
        (w.camelCase = V),
        (w.type = b),
        (w.now = Date.now),
        (w.isNumeric = function (e) {
          var t = w.type(e);
          return (
            ("number" === t || "string" === t) && !isNaN(e - parseFloat(e))
          );
        }),
        $__System.registerDynamic("e", [], !1, function (e, t, n) {
          return function () {
            return w;
          }.call(this);
        });
      var jt = e.jQuery,
        qt = e.$;
      return (
        (w.noConflict = function (t) {
          return (
            e.$ === w && (e.$ = qt), t && e.jQuery === w && (e.jQuery = jt), w
          );
        }),
        t || (e.jQuery = e.$ = w),
        w
      );
    }),
    $__System.registerDynamic("28", ["e", "13", "11"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = e("e"),
        r = (e("13").Node, e("11"));
      var o = !1;
      function a(e, t) {
        if (e.match(/^#/)) {
          if (!t) {
            var n = i(
              "#write [name='@'],[ty-id='@'],mjx-container g[id='@']".replace(
                /@/g,
                r.escapeSelector(e.substr(1))
              )
            );
            if (n.length) return [n, void 0];
          }
          var o,
            [a, s, l] = r.splitAnchor(r.titleToAnchor(e.substr(1) || "")),
            c = l + 1,
            d = i("#write")
              .find("h1, h2, h3, h4, h5, h6")
              .filter(function () {
                var e = this.textContent,
                  t = this.innerText,
                  n = r.titleToAnchor(e);
                return n == s || n == r.decodeFromEscapedPath(s)
                  ? !--c
                  : e == t ||
                    ((t = r.titleToAnchor(t)) != s &&
                      t != r.decodeFromEscapedPath(s))
                  ? (n == a || n == r.decodeFromEscapedPath(a)
                      ? (o = i(this))
                      : e != t &&
                        (((t = r.titleToAnchor(t)) != a &&
                          t != r.decodeFromEscapedPath(a)) ||
                          (o = i(this))),
                    !1)
                  : !--c;
              });
          return (o || []).length ? [o, 0] : [d, l + 1];
        }
        return [void 0, void 0];
      }
      var s,
        l = i("#ty-tooltip");
      i("body")
        .on("mouseenter", "[ty-hint]", function () {
          var e = i(this),
            t = i.Event("before-show-ty-hint", { cancel: !1 });
          if ((e.trigger(t), !t.cancel)) {
            l
              .text(this.getAttribute("ty-hint"))
              .addClass("shown")
              .attr("style", ""),
              this.getAttribute("ty-hint-html") &&
                l.html(this.getAttribute("ty-hint"));
            var n = this.getBoundingClientRect(),
              r = { left: n.left, top: n.top },
              o = l[0].clientWidth,
              a = r.left + this.clientWidth / 2;
            "right" == e.attr("ty-hint-pos")
              ? (r.left += this.clientWidth + 4)
              : "left" == e.attr("ty-hint-pos")
              ? (r.left -= this.clientWidth + 4)
              : (r.top > window.innerHeight / 2
                  ? (r.top = r.top - l[0].clientHeight - 6)
                  : (r.top += n.height + 1),
                o / 2 + a > window.innerWidth
                  ? (r.left = window.innerWidth - o - 4)
                  : ((r.left = a - o / 2 - 2), (r.left = Math.max(2, r.left)))),
              l.offset(r),
              new Date() - s < 2e3 || this.getAttribute("ty-hint-instant")
                ? l.addClass("instant")
                : l.removeClass("instant");
          }
        })
        .on("mouseleave click", "[ty-hint]", function () {
          (s = new Date()), l.removeClass("shown");
        });
      var c,
        d = !1;
      function u(e, t, n) {
        h({
          key: e,
          title: i.localize
            .getString("<strong>%@</strong> has been turned on.", "Front")
            .replace("%@", i.localize.getString(t, "Menu")),
          body: i.localize.getString(
            "You could turn it off from `View` menu.",
            "Front"
          ),
          focus: n,
        });
      }
      function h(e) {
        var { key: t, title: n, body: r, focus: o, checked: a } = e;
        if (!File.option[t]) {
          File.option[t];
          var s = document.querySelector(
              "#ty-enter-mode-warning-temp"
            ).innerText,
            l = i("#md-notification");
          return (
            l
              .html(s)
              .find(".ty-enter-mode-warning-header")
              .html(n)
              .end()
              .find(".ty-enter-mode-warning-body")
              .html(r || "&nbsp;")
              .end()
              .find("[data-lg='Front']")
              .localize("Front", i.localize.localeOption)
              .end()
              .find("[data-lg='Panel']")
              .localize("Panel", i.localize.localeOption)
              .end(),
            document.body.classList.add("ty-show-notification"),
            o && l.focus(),
            (c = t),
            t
              ? (d ||
                  ((d = !0),
                  i("#md-notification")
                    .on(
                      "change",
                      "#ty-suppress-mode-warning-input",
                      function () {
                        var e = i(this).prop("checked");
                        JSBridge.putSetting(c, e),
                          JSBridge.execForAll(
                            "File.option." + c + "=" + e + ";"
                          );
                      }
                    )
                    .on(
                      "click",
                      "#ty-suppress-mode-warning-close-btn",
                      function () {
                        document.body.classList.remove("ty-show-notification");
                      }
                    )),
                a
                  ? i("#ty-suppress-mode-warning-input")
                      .prop("checked", !0)
                      .trigger("change")
                  : i("#ty-suppress-mode-warning-input").prop("checked", !1))
              : (l.find("label").remove(),
                l.one(
                  "click",
                  "#ty-suppress-mode-warning-close-btn",
                  function () {
                    document.body.classList.remove("ty-show-notification");
                  }
                )),
            l
          );
        }
      }
      var p,
        f = function () {
          (this.$dialog = i("#common-dialog")),
            (this.isShown_ = !1),
            (this.callback_ = null),
            (this.checkBoxState = null),
            this.init();
        };
      (f.prototype.isShown = function () {
        return this.isShown_;
      }),
        (f.prototype.init = function () {
          var e = this;
          this.$dialog
            .on("change", "#common-dialog-checkbox", function () {
              return (e.checkBoxState = i(this).prop("checked")), !1;
            })
            .on("click", ".modal-footer button", function () {
              if (e.callback_) {
                if (
                  (e.callback_(
                    i(this).prevAll("button").length,
                    e.checkBoxState
                  ),
                  this.classList.contains("btn-light"))
                )
                  return !1;
                e.callback_ = null;
              }
            })
            .on("hidden.bs.modal", function () {
              e.callback_ && e.callback_(null);
            });
        }),
        (f.prototype.show = function (e) {
          this.isShown_ && this.hide(),
            (this.callback_ = e.callback || function () {}),
            this.render_(e),
            this.$dialog.modal(e);
        }),
        (f.prototype.render_ = function (e) {
          var t = this.$dialog;
          t.removeClass("error-dialog"),
            t.attr("data-tag", e.tag),
            "error" == e.type && t.addClass("error-dialog"),
            e.title
              ? (t.removeClass("ty-dialog-no-title"),
                t.find(".modal-title").text(e.title))
              : t.addClass("ty-dialog-no-title"),
            (e.html
              ? t.find("#common-dialog-message").html(e.html)
              : t.find("#common-dialog-message").text(e.message || "")
            ).css("text-align", e.leftAlign ? "left" : ""),
            e.checkbox
              ? (t.addClass("ty-dialog-show-checkbox"),
                t
                  .find("#common-dialog-checkbox")
                  .prop("checked", e.checkbox.state || !1),
                t.find("#common-dialog-checkbox-label").text(e.checkbox.label))
              : t.removeClass("ty-dialog-show-checkbox"),
            (function () {
              (e.buttons = e.buttons || [i.localize.getString("Close")]),
                (e.helperButtons = e.helperButtons || []);
              var n = i(
                  '<button type="button" data-dismiss="modal" class="btn"></button>'
                ),
                r = t.find(".modal-footer").html("");
              3 == e.buttons.length
                ? t.addClass("ty-three-way-buttons")
                : t.removeClass("ty-three-way-buttons"),
                e.helperButtons.forEach(function (e, t) {
                  var i = n.clone();
                  i.text(e),
                    i.addClass("btn-light"),
                    i[0].removeAttribute("data-dismiss"),
                    r.append(i);
                }),
                e.buttons.forEach(function (e, t) {
                  var i = n.clone();
                  i.text(e),
                    0 == t
                      ? i.addClass("btn-primary")
                      : i.addClass("btn-default"),
                    r.append(i);
                });
            })();
        }),
        (f.prototype.hide = function () {
          this.isShown_ = !1;
        });
      var m,
        g = function () {
          p && clearTimeout(p),
            (p = null),
            document.body.classList.remove("ty-show-notification");
        },
        v = function (e, t, n, o, a) {
          p && clearTimeout(p), (p = null);
          var s = n || [];
          s && "string" == typeof s && (s = [s]);
          var l = i("#md-notification").html(
            `<div class="md-notification-content"><p style='padding-right: 0;overflow-wrap: anywhere;max-height: 60vh;overflow-y: auto;'>${
              t ? e : r.escape(e)
            }</p>` +
              (s.length
                ? s
                    .map(
                      (e, t) =>
                        `<span data-index='${t}' class='btn-default btn-xs btn'>${e}</span>`
                    )
                    .join(" ")
                : "") +
              `<span class='${
                s.length ? "" : "btn-default"
              } btn-xs btn ok-btn'>${i.localize.getString(
                "Close"
              )}</span></div>`
          );
          return (
            document.body.classList.add("ty-show-notification"),
            s.length &&
              i(".btn-default").one("click", function () {
                g(), o && o(this.dataset.index - 0);
              }),
            a &&
              (a.checkFocus
                ? document.hasFocus() && (p = setTimeout(g, a.timeout || 1e4))
                : (p = setTimeout(g, a.timeout || 1e4))),
            l
          );
        },
        y = function (e) {
          if (!e) return e;
          var t = function (e) {
              return e.childNodes && 0 == e.childNodes.length
                ? e
                : t(e.childNodes[0]);
            },
            n = e.nextSibling;
          return null == n ? y(e.parentElement) : t(n);
        },
        b = function (e) {
          for (var t, n = e.childNodes.length, i = [], r = 0; r < n; r++) {
            var o = e.childNodes[r];
            o.tagName
              ? t
                ? t.tagName != o.tagName ||
                  o.childElementCount ||
                  t.childElementCount ||
                  t.getAttribute("class") != o.getAttribute("class")
                  ? (t = o)
                  : (i.push(o), (t.textContent = t.textContent + o.textContent))
                : (t = o)
              : (t = null);
          }
          i.forEach(function (t) {
            e.removeChild(t);
          });
        },
        w = function (e, t, n) {
          window.reqnode
            ? JSBridge.invoke("dialog.showMessageBox", {
                title: i.localize.getString("Confirm"),
                message: e,
                type: "question",
                defaultId: 0,
                cancelId: 1,
                buttons: [
                  i.localize.getString("OK"),
                  i.localize.getString("Cancel"),
                ],
              }).then(({ response: e }) => {
                0 == e ? t() : n && n();
              })
            : window.confirm(e)
            ? t()
            : n && n();
        },
        x = !0,
        C = function (e) {
          x &&
            ((x = !1),
            i("#zoom-hint")
              .on("click", "#zoom-hint-in", function () {
                JSBridge.zoom.zoomOut();
              })
              .on("click", "#zoom-hint-out", function () {
                JSBridge.zoom.zoomIn();
              })
              .on("click", "#zoom-hint-reset", function () {
                JSBridge.zoom.resetZoom();
              })),
            i("#zoom-hint-current").text(
              (100 * e + "").replace(/\..+/, "") + "%"
            ),
            m && clearTimeout(m),
            i("#zoom-hint").show(),
            document.body.classList.add("on-zoom"),
            (m = setTimeout(function () {
              (m = null),
                i("#zoom-hint").hide(),
                document.body.classList.remove("on-zoom");
            }, 3e3));
        },
        F = new f(),
        S = F.show.bind(F);
      (t.dialog = F),
        (t.showDialog = S),
        (window.showDialog = S),
        (t.showNativeDialog = function (e) {
          File.isMac
            ? window.bridge.callHandler(
                "window.showDialog",
                {
                  message: e.message,
                  checkbox: e.checkbox || "",
                  buttons: e.buttons || [],
                },
                function (t) {
                  e.callback(t[0], t[1]);
                }
              )
            : (e.checkbox && (e.checkbox = { label: e.checkbox }), F.show(e));
        }),
        (t.showErrorDialog = function (e, t) {
          window.reqnode
            ? JSBridge.invoke("dialog.showMessageBox", {
                type: "error",
                title: i.localize.getString("Error"),
                message: i.localize.getString(e, "Panel"),
                detail: i.localize.getString(t, "Panel"),
                buttons: [i.localize.getString("OK")],
              })
            : alert(
                i.localize.getString(e, "Panel") +
                  "\n" +
                  i.localize.getString(t, "Panel")
              );
        }),
        (t.showWarningDialog = function (e, t) {
          var n = t
            ? i.localize.getString("Do not show this again", "Panel")
            : "";
          return window.reqnode
            ? JSBridge.invoke("dialog.showMessageBox", {
                type: "question",
                message: e,
                defaultId: 0,
                cancelId: 1,
                buttons: [
                  i.localize.getString("OK"),
                  i.localize.getString("Cancel"),
                ],
                checkboxLabel: n,
              })
            : File.isMac
            ? new Promise((t) => {
                window.bridge.callHandler(
                  "window.showDialog",
                  {
                    message: e,
                    checkbox: n,
                    buttons: [
                      i.localize.getString("OK"),
                      i.localize.getString("Cancel"),
                    ],
                  },
                  function (e) {
                    t({ response: e[0], checkboxChecked: e[1] });
                  }
                );
              })
            : void 0;
        }),
        (t.showNotificationWithTitle = function (e, t, n, o, a) {
          (t = t || "").trim || (t = t.message || "");
          var s = t
              ? `<br/><span class='md-notification-detail'>${r.escape(
                  t.trim().replace(/\n[\s\S]*/, "")
                )}</span>`
              : t,
            l = t ? "<strong>" + r.escape(e) + "</strong>" : r.escape(e),
            c = v(l + s, !0, n, o, a).find(".md-notification-detail");
          c.length &&
            ((c[0].scrollWidth > c[0].offsetWidth ||
              t.trim().indexOf("\n") > -1) &&
              c.after(
                "<a id='md-notification-more-btn' class='btn-xs btn'>{label}</a>".replace(
                  "{label}",
                  i.localize.getString("View More", "Panel")
                )
              ),
            i("#md-notification-more-btn")
              .off("click")
              .on("click", function () {
                S({
                  message: t,
                  tag: "detail",
                  helperButtons: [i.localize.getString("Copy", "Menu")],
                  callback: function (e) {
                    0 == e &&
                      File.editor.UserOp.setClipboard(null, null, t, !0);
                  },
                });
              }));
        }),
        (t.showNotification = v),
        (window.showNotification = v),
        (t.showProcessingNotification = function (e, t) {
          i("#md-notification").html(
            [
              "<p>" + i.localize.getString(e, "Panel"),
              '\n<div class="typora-search-spinner typora-export-spinner" style="margin-right:16px;top:8px">',
              '<div class="rect1"></div>',
              '<div class="rect2"></div>',
              '<div class="rect3"></div>',
              '<div class="rect4"></div>',
              '<div class="rect5"></div>',
              "</div></p>",
            ].join("")
          ),
            document.body.classList.add("ty-show-notification"),
            t
              ? document.body.classList.add("ty-notification-no-animation")
              : document.body.classList.remove("ty-notification-no-animation");
        }),
        (t.hideNotification = g),
        (t.confirm = w),
        (t.confirmWithPromise = function (e) {
          return new Promise((t) => {
            w(
              e,
              () => {
                t(!0);
              },
              () => {
                t(!1);
              }
            );
          });
        }),
        (t.showZoomPanel = C),
        (t.replaceTag = function (e, t) {
          var n = e[0].outerHTML,
            r = new RegExp("<" + e[0].tagName, "i"),
            o = n.replace(r, "<" + t);
          (r = new RegExp("</" + e[0].tagName + ">$", "i")),
            (o = o.replace(r, "</" + t + ">"));
          var a = i(o);
          return e.replaceWith(a), a;
        }),
        (t.getEditParent = function (e, t) {
          return t.getClosetBlock(!0);
        }),
        (t.fixPopoverPosition = function (e, t, n) {
          var r,
            o = e.offset(),
            a = i(editor.sessionStr).offset().left + 10,
            s = i(editor.sessionStr).width(),
            l = e.find(".md-arrow");
          return (
            (t = t || ".code-tooltip.md-hover-tip").jquery
              ? (l = (r = t).find(".md-arrow"))
              : (r = e.find(t)),
            e.length
              ? (r.css("max-width", s - 60),
                (o.top += e.height() * (n ? 1 : 1.5) + (n ? 0 : 4)),
                (o.left += (e.width() - r.width()) / 2),
                o.left + r.width() > window.innerWidth - 10
                  ? (o.left = window.innerWidth - 10 - r.width())
                  : o.left < a && (o.left = a),
                r.css("position", "absolute").offset(o),
                !n &&
                  l.offset(function (t, n) {
                    var i = {};
                    return (
                      (i.left = e.offset().left + e.width() / 2),
                      (i.top = n.top),
                      i
                    );
                  }),
                r)
              : (console.sendError(
                  "cannot fixPopoverPosition on empty $parent"
                ),
                r.hide())
          );
        }),
        (t.resetClick = function (e) {
          var t = File.editor;
          if (o) return !(o = !1);
          if (
            e.target &&
            ("CONTENT" == e.target.tagName || "HTML" == e.target.tagName)
          ) {
            var n = e.clientX,
              r = e.clientY,
              a = document.querySelector(t.sessionStr),
              s = i(a).offset();
            if (!s) return;
            var l = document.createEvent("MouseEvents"),
              c = s.left,
              d = s.left + a.clientWidth,
              u = s.top,
              h = s.top + a.clientHeight;
            if ((n >= c && n <= d) || (r >= u && r <= h)) return;
            if (
              ((o = !0),
              (n = n < s.left ? s.left + 1 : s.left + a.clientWidth - 1),
              (r = r < s.top ? s.top + 1 : s.top + a.clientHeight - 1),
              e.stopPropagation(),
              (l = document.createEvent("MouseEvents")),
              !(a = document.elementFromPoint(n, r)))
            )
              return;
            l.initMouseEvent(
              "click",
              !0,
              !0,
              a.ownerDocument.defaultView,
              1,
              e.screenX + (n - e.clientX),
              e.screenY + (r - e.clientY),
              n,
              r,
              e.ctrlKey,
              e.altKey,
              e.shiftKey,
              e.metaKey,
              e.button
            ),
              a.dispatchEvent(l);
          }
        }),
        (t.getWordCount = function (e) {
          if (0 === e.trim().length) return 0;
          var t = 0,
            n = [
              "d",
              e
                .replace(/[\u3040-\uABFF\uD7A4-\uFAFF]/gi, function (e) {
                  return t++, " ";
                })
                .replace(
                  /(^|\s+)[(\u3000-\u303F)!-\/:-@\[-`{-~]+(\s+|$)/gm,
                  " "
                ),
              "d",
            ]
              .join(" ")
              .split(/[(\u3000-\u303F)\s!-,\.\\:-@\[-`{-~]+/g).length;
          return t + n - 2;
        }),
        (t.findAnchorElem = function (e, t) {
          return a(e, t)[0];
        }),
        (t.normalizeAnchor = function (e, t, n) {
          var [i, o] = a(e, !0);
          return (
            (e = i ? "#" + r.titleToAnchor(i.text()) : e),
            0 === o
              ? t && t.filter((t) => t == e).length > 1
                ? (o = 1)
                : n && "write" == e && (o = 1)
              : i || (o = void 0),
            e + (o ? "-" + o : "")
          );
        }),
        (t.fetchAnchorList = function (e, t) {
          var n = [];
          return (
            Array.prototype.slice
              .call(
                document.querySelectorAll(
                  ".md-html-inline a[name], .md-htmlblock-container a[name]"
                )
              )
              .map(function (e) {
                var t = r.decodeFromEscapedPath(
                  (e.getAttribute("name") || "").substring(1)
                );
                n.push(t);
              }),
            Array.prototype.slice
              .call(document.querySelectorAll(".md-heading[cid]"))
              .map(function (i) {
                var o = i.getAttribute("cid");
                if (!e[o]) {
                  var a = r.titleToAnchor(i.innerText),
                    s = (function (e) {
                      for (var t = 0, i = 0; i < n.length; i++)
                        n[i].toLowerCase() == e && t++;
                      return t;
                    })(a);
                  n.push(a),
                    s
                      ? (1 == s &&
                          (function (t) {
                            var n = Object.keys(e);
                            for (var i of n)
                              if (e[i] == t) return void (e[i] = t + "-1");
                          })(a),
                        (e[o] = a + "-" + (s + 1)))
                      : ((function (e) {
                          return !t && "write" == e;
                        })(a) && (a += "-1"),
                        (e[o] = a));
                }
              }),
            n
          );
        }),
        (t.keyOnControl = function (e, t, n) {
          var r, o, a;
          function s(e) {
            var t = i(".modal-dialog:visible");
            if (!t.length) {
              if (e) {
                var n = document.querySelector("#write");
                if (
                  n == document.activeElement ||
                  n.contains(document.activeElement)
                )
                  return t;
                t = i(".ty-show-notification #md-notification");
              }
              t = i(".ty-show-notification #md-notification");
            }
            return t;
          }
          if ("Tab" == e) {
            if ((r = s(n)).length)
              return (
                (a = (o = r.find(
                  "button, input:not(#common-dialog-checkbox), #common-dialog-checkbox:visible"
                )).index(document.activeElement)),
                o.length
                  ? (t.shiftKey ? a-- : a++,
                    (a = a >= o.length ? 0 : a),
                    (a = Math.max(0, a)),
                    o.eq(a).focus(),
                    !0)
                  : void 0
              );
          } else if ("Esc" == e)
            (r = s(!0)) && r.hasClass("modal-dialog")
              ? (1 == r.find("button").length &&
                  1 == r.find(".btn-primary").length) ||
                r.parent().modal("hide")
              : document.body.classList.contains("ty-show-notification") &&
                document.body.classList.remove("ty-show-notification");
          else if ("Enter" == e && document.activeElement) {
            if (
              document.activeElement == document.body ||
              "DIV" == document.activeElement.tagName
            ) {
              if ((r = s()).length)
                return r
                  .find("button.btn-primary")
                  .eq(0)
                  .focus()
                  .trigger("click").length;
            } else if ("BUTTON" == document.activeElement.tagName)
              return i(document.activeElement).focus().trigger("click"), !0;
          } else if (
            ("Left" == e || "Right" == e) &&
            (r = s()).length &&
            document.activeElement &&
            "BUTTON" == document.activeElement.tagName &&
            (a = (o = r.find("button")).index(document.activeElement)) > -1
          )
            return (
              "Left" === e ? a-- : a++,
              (a = a >= o.length ? 0 : a),
              (a = Math.max(0, a)),
              o.eq(a).focus(),
              !0
            );
        }),
        (t.showTypeWriterModeWarning = function () {
          u("noWarnigForTypeWriterMode", "Typewriter Mode");
        }),
        (t.showFocusModeWarning = function () {
          u("noWarnigForFocusMode", "Focus Mode");
        }),
        (t.markRange = function (e, t) {
          var n,
            i,
            r = document.createElement("span");
          r.classList.add(t),
            (n = e.startContainer),
            (i = e.startOffset),
            n && n.length === i && e.setStart(y(e.startContainer), 0);
          var o =
            e.endContainer &&
            e.endContainer.parentElement &&
            e.endContainer.parentElement.closest(".md-entity");
          return (
            r.appendChild(e.extractContents()),
            e.insertNode(r),
            !o || o.innerText || o.contains(r) || o.remove(),
            r
          );
        }),
        (t.unmarkSpan = function (e) {
          var t = e.parentElement;
          if (t) {
            for (; e.firstChild; ) t.insertBefore(e.firstChild, e);
            t.removeChild(e),
              t.getAttribute("md-inline") && b(t),
              t.normalize();
          }
        }),
        (t.mergeSameChildren = b),
        (t.showHintOrWarning = h),
        window._options &&
          window._options.zoomFactor &&
          1 != _options.zoomFactor &&
          (window._options.onFirstLaunch
            ? C(_options.zoomFactor)
            : document.body.classList.remove("on-zoom"));
    }),
    $__System.registerDynamic("34", ["11", "32", "28"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i,
        r,
        o = e("11"),
        a = e("32"),
        s = e("28"),
        l = null,
        c = null,
        d = function (e) {
          var t = new Date();
          return (i =
            o.formateDateOnly(new Date()) +
            " " +
            (e || "untitled").replace(/\.[^.]*$/, "") +
            " " +
            o.formateTimeOnly(t, !0).replace(/:/g, "") +
            ".md");
        };
      function u(e) {
        var t;
        try {
          var n = reqnode("fs");
          c && n.unwatchFile(c),
            (c = e),
            n.watchFile(e, function (n, i) {
              new Date() - File.bundle.modifiedDate < 900 ||
                (n && n.mtime == i.mtime) ||
                (t && clearTimeout(t),
                (t = setTimeout(function () {
                  n ? File.presentedItemChanged(void 0, n, e) : f(), (t = null);
                }, 200)));
            });
        } catch (e) {
          console.log(e);
        }
      }
      function h(e, t) {
        var n = reqnode("fs");
        File.editor.library.isSuppressOnChange() ||
          (n.stat(e, function (n, i) {
            if (File.isTextBundle()) {
              if (
                0 != e.indexOf(File.bundle.filePath || ":") &&
                e.indexOf(File.bundle.originalPath || ":")
              )
                return;
            } else if (e !== File.bundle.filePath && e !== File.bundle.originalPath) return;
            n || !i
              ? (p(null), window.clientHandlerOnPresentationMoved())
              : (File.presentedItemChanged(void 0, i, e), t && p(e));
          }),
          (r = null));
      }
      function p(e) {
        if (reqnode) {
          var t = reqnode("fs");
          if (
            (l &&
              (l.removeAllListeners(),
              l.close(),
              (l._handle = null),
              (l = null)),
            r && clearTimeout(r),
            (r = null),
            c && t.unwatchFile(c),
            e)
          )
            try {
              ((l = t.watch(e, { persistent: !1 }))._start = new Date()),
                l.on("change", function (t, n) {
                  if (!(new Date() - l._start < 100))
                    if ("rename" != t)
                      new Date() - File.bundle.modifiedDate < 900 ||
                        (r && clearTimeout(r),
                        (r = setTimeout(function () {
                          h(e);
                        }, 500)));
                    else if (File.inSavingProcess) p(e);
                    else {
                      var i = reqnode("path");
                      i.join(i.dirname(e), n) == e && h(e, !0);
                    }
                }),
                l.on("error", function (t) {
                  l.close(), (l._handle = null), (l = null), u(e);
                });
            } catch (t) {
              if (l && "ENOENT" == t.code)
                return l.close(), (l._handle = null), void (l = null);
              u(e);
            }
        }
      }
      var f = function () {
        JSBridge.invoke("document.switchToUntitled", File.bundle.filePath),
          Reporter.record("current file is moved/deleted");
      };
      window.clientHandlerOnPresentationMoved = function () {
        File.isNode &&
          File.isActiveWindow() &&
          File.updateChangeCount(File.ChangeType.NSChangeReadOtherContents),
          y();
      };
      var m = function (e) {
          e && window.debugMode && console.warn(e);
        },
        g = async function (e, t) {
          if (i && e) {
            var n = await C(!0);
            t && (n = n + (File.isWin ? "\\" : "/") + t);
            try {
              var r = reqnode("fs"),
                o = reqnode("path"),
                a = File.isWin ? "\\" : "/",
                s = o.resolve(n, i);
              if (t) return File.draftsRecoverList.push(n + a + i), void v();
              r.stat(s, function (t, i) {
                if (!t) {
                  var a = o.resolve(n, d(e));
                  r.rename(s, a, m), File.draftsRecoverList.push(a), v();
                }
              });
            } catch (e) {
              console.sendError(e);
            }
          }
        },
        v = function () {
          if (File.draftsRecoverList.length < (File.isTextBundle() ? 6 : 10))
            return;
          const e = File.draftsRecoverList.length > 20 ? 1e3 : 500;
          for (
            var t = [],
              n = [File.draftsRecoverList[0]],
              i = /(\d+)\.md$/,
              r = i.exec(File.draftsRecoverList[0])[1] - 0,
              o = 2;
            o < File.draftsRecoverList.length;
            o++
          ) {
            var a = File.draftsRecoverList[o],
              s = i.exec(File.draftsRecoverList[o])[1] - 0;
            s - r > 0 && s - r < e ? t.push(a) : (n.push(a), (r = s));
          }
          var l = n;
          n.length > 40 &&
            ((l = []),
            n.forEach((e, i) => {
              i % 2 == 0 || i == n.length - 1 ? l.push(e) : t.push(e);
            })),
            (File.draftsRecoverList = l);
          var c = reqnode("fs");
          t.forEach((e) => {
            c.unlink(e, (e) => {});
          });
        },
        y = function (e) {
          console.log("onFilePathRemoved"),
            File.bundle.filePath &&
              ((File.bundle.originalPath = File.bundle.filePath),
              (File.bundle.filePath = ""),
              b(File.bundle.fileName));
        },
        b = function (e, t, n) {
          var i = File.bundle.filePath;
          /bundle\//.exec(i),
            (e = e || a.getFileNameFromPath(i || File.bundle.originalPath)),
            (File.bundle.fileName = e);
          var r = {
            "File→Open File Location": { enabled: !!i },
            "File→Reveal in Sidebar": { enabled: !!i },
            "File→Delete…": { enabled: !!i },
          };
          File.isNode &&
            !File.isMacNode &&
            (r["File→Reopen with Encoding"] = { hidden: !i }),
            File.isWin
              ? (r["File→Properties"] = { enabled: !!i })
              : File.isMac && (r["File→Get Info"] = { enabled: !!i }),
            JSBridge.menu.update(r),
            console.log(`onFilePathUpdated ${i}`),
            window.Reporter.record(`File.bundle.filePath = ${o.hashCode(i)}`),
            (File.bundle.assetsChanges = null);
          const l = File.editor && File.editor.imgEdit,
            c = File.editor && File.editor.library;
          if (
            (l && (l.cachedFileImageStorage = void 0),
            File.setDefaultImageStorage(File.option.defaultImageStorage),
            File.onMetaDataChanged(),
            c && File.editor.library.markCurrentFile(),
            t &&
              (function (e, t) {
                File.isTextBundle() || File.editor.imgEdit.onFileMoved(e, t);
              })(t, n),
            File.isTextBundle() &&
              (async function (e) {
                var t = File.isWin ? "\\" : "/",
                  n = C(!0),
                  i = w(e),
                  r = w();
                try {
                  await reqnode("fs-extra").move(n + t + i, n + t + r);
                } catch (e) {
                  console.info(e);
                }
              })(t || ""),
            File.isNode)
          ) {
            var d = $("#title-text");
            if (i) {
              if (
                (JSBridge.invoke("document.hasDuplicateName", e).then((t) => {
                  t
                    ? (d.text(i),
                      JSBridge.invoke("window.setTitle", i + " - Typora"))
                    : (d.text(e),
                      JSBridge.invoke("window.setTitle", e + " - Typora")),
                    a.refreshTitlebarText();
                }),
                g(e),
                File.editor.library)
              ) {
                File.editor.library.markCurrentFile();
                var u = !File.mountFolder_;
                if (!u) {
                  const e = reqnode("path").normalize;
                  u =
                    -1 ==
                    e(i).indexOf(
                      e(
                        File.mountFolder_.replace(/[\/\\]$/, "") +
                          (File.isWin ? "\\" : "/")
                      )
                    );
                }
                u &&
                  (File.setMountFolder(reqnode("path").dirname(i)),
                  File.editor.library.onRootChanged(File.mountFolder_, !0));
              }
            } else
              e
                ? (d.text(e),
                  JSBridge.invoke("window.setTitle", e + "• - Typora"))
                : (d.text($.localize.getString("Untitled")),
                  JSBridge.invoke(
                    "window.setTitle",
                    $.localize.getString("Untitled") +
                      (File.changeCounter && !File.changeCounter.curState
                        ? "• - Typora"
                        : " - Typora")
                  ));
            p(File.getTextFile() || null),
              /draftsRecover/.exec(File.bundle.filePath || "") &&
                (function () {
                  const e = reqnode("path"),
                    t = e.join(File.option.userDataPath, "draftsRecover");
                  0 == e.normalize(File.bundle.filePath).indexOf(t + e.sep) &&
                    s.showHintOrWarning({
                      key: "",
                      title:
                        "<strong>" +
                        $.localize.getString(
                          "You are not supposed to edit or save this file.",
                          "Front"
                        ) +
                        "</strong>",
                      body: $.localize
                        .getString(
                          "Files in this location (%@) are managed by Typora, and may be deleted automatically.<br/>Please copy content to a new file for further editing.",
                          "Front"
                        )
                        .replace("%@", "draftsRecover"),
                    });
                })();
          }
        };
      var w = function (e) {
          if (!File.isTextBundle()) return null;
          var t =
              void 0 !== e
                ? e
                : File.bundle.filePath || File.bundle.originalPath,
            n = t
              ? (function (e) {
                  let t = 0;
                  for (let n = 0, i = e.length; n < i; n++)
                    (t = (t << 5) - t + e.charCodeAt(n)), (t |= 0);
                  return t;
                })(t)
              : File.bundle.untitledId;
          return (
            (a.getFileNameFromPath(t) || "untitled").replace(
              /\.textbundle$/,
              ""
            ) +
            "-" +
            n
          );
        },
        x = async function (e, t) {
          var n = File.isWin ? "\\" : "/",
            r = w(),
            o = await C(!0);
          if (0 != (File.bundle.filePath || "").indexOf(o)) {
            var a = o + n + r,
              s = reqnode("fs-extra");
            await s.ensureDir(a), d("text");
            try {
              await s.writeFile(a + n + i, e), g(i, r);
            } catch (e) {
              console.sendError(e, "skip");
            }
            if ("skip" !== t)
              try {
                await s.copy(
                  File.bundle.filePath + n + "assets",
                  a + n + "assets",
                  { overwrite: "overwrite" === t }
                );
              } catch (e) {
                "ENOENT" == !e.code && console.sendError(e, "skip");
              }
          }
        },
        C = function (e) {
          var t =
            window._options.userDataPath +
            (File.isWin ? "\\" : "/") +
            "draftsRecover";
          return e
            ? t
            : new Promise((e) => {
                reqnode("fs-extra")
                  .ensureDir(t)
                  .then(
                    () => {
                      e(t);
                    },
                    () => {
                      e("");
                    }
                  );
              });
        };
      (t.textBundleDraftFolder = async function () {
        var e = await C();
        if (e) {
          var t = File.isWin ? "\\" : "/";
          if (0 != (File.bundle.filePath || "").indexOf(e))
            return (e = e + t + w());
        }
      }),
        (t.saveFileToRecover = async function (e) {
          if (File.bundle.filePath) {
            var t = await C();
            if (t) {
              var n = File.isWin ? "\\" : "/";
              if (0 != (File.bundle.filePath || "").indexOf(t)) {
                if (File.isTextBundle()) {
                  if ((d("text"), (t = t + n + w()), e))
                    try {
                      return void (await reqnode("fs-extra").copy(
                        File.bundle.fileName,
                        t,
                        { overwrite: !1 }
                      ));
                    } catch (e) {
                      console.sendError(e, "skip");
                    }
                } else d(File.getFileName());
                try {
                  await reqnode("fs-extra").copy(
                    File.getTextFile(),
                    t + (File.isWin ? "\\" : "/") + i
                  ),
                    g(File.getFileName(!0), w());
                } catch (e) {
                  console.sendError(e, "skip");
                }
              }
            }
          }
        }),
        (t.backupAssets = async function (e, t) {
          if (!File.bundle.filePath) return;
          const n = reqnode("fs-extra"),
            i = await x(),
            r = File.isWin ? "\\" : "/",
            o = i + r + File.getFileName() + r + "assets";
          await n.ensureDir(o);
          var a = [];
          for (var s of e) {
            let e = File.bundle.filePath + r + "assets" + r + s;
            t
              ? a.push(n.move(e, o + r + s, { overwrite: !1 }))
              : a.push(
                  n.copy(e, o + r + s, { overwrite: !1, errorOnExist: !1 })
                );
          }
          return await Promise.all(a);
        }),
        (t.watchFileChange = p),
        (t.onPresentationMoved = f),
        (t.onFilePathUpdated = b),
        (t.onFilePathRemoved = y),
        (t.saveToRecover = async function (e, t) {
          if (e && ("string" != typeof e || e.trim().length)) {
            var n = await C();
            n &&
              (File.isTextBundle()
                ? await x(e, t)
                : (function (e, t) {
                    try {
                      d(File.getFileName()),
                        reqnode("fs").writeFile(t + "/" + i, e, function (e) {
                          e ? m(e) : g(File.getFileName(!0));
                        });
                    } catch (e) {
                      console.sendError(e, "skip");
                    }
                  })(e, n));
          }
        }),
        (t.prepareInfoPanel = function () {
          function e(e) {
            $(".info-panel-tab.active").removeClass("active"),
              "file" == e
                ? File.editor.library.switch("files", !0)
                : File.editor.library.switch("outline");
          }
          (document.querySelector("#file-library").style.display = ""),
            (document.querySelector("#file-info-content").style.display =
              "none"),
            $("#info-panel-tab-file").on("click", function () {
              e("file");
            }),
            $("#info-panel-tab-outline").on("click", function () {
              e("outline");
            });
        }),
        (t.assetsParentForUntitled = function () {
          var e = File.isWin ? "\\" : "/",
            t = w();
          return C(!0) + e + t;
        });
    }),
    $__System.registerDynamic(
      "58",
      ["11", "28", "32", "34"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = void 0;
        if (window.reqnode) {
          var r,
            o = reqnode("child_process").spawn,
            a = e("11"),
            s = e("28"),
            l = e("32"),
            c = (e("34"), null),
            d = () => File.option.pandocPath || "pandoc",
            u = function (e, t, n, i) {
              if ((h(), !(i || {}).cwd)) {
                let e = l.getCurrentFileFolderPath();
                e && (i = Object.assign({ cwd: e }, i));
              }
              e.join(" ");
              var r = [],
                a = [];
              return (
                (c = o(d(), e, i)).on("close", function (e) {
                  var i = Buffer.concat(r),
                    o = Buffer.concat(a).toString();
                  t(n, i, o, e), (c = null);
                }),
                c.stdout.on("data", function (e) {
                  r.push(e);
                }),
                c.stderr.on("data", function (e) {
                  a.push(e);
                }),
                c
              );
            },
            h = function () {
              c && c.kill && (c.removeAllListeners("close"), c.kill()),
                (c = null);
            },
            p = async function (e) {
              var t = await JSBridge.invoke("pandoc.version"),
                n = void 0 === n ? void 0 : n && n + "" != "false";
              if (e && void 0 !== n) return n;
              if (n) return (window.pandocVersion = t), !0;
              try {
                n = !0;
                var i = await ((...e) =>
                  new Promise(function (t, n) {
                    var i = "",
                      r = "",
                      a = o.apply(null, e);
                    a.stdout.on("data", function (e) {
                      i += e;
                    }),
                      a.stderr.on("data", function (e) {
                        r += e;
                      }),
                      a.on("error", n).on("close", function (e) {
                        0 === e ? t(i) : n(r);
                      });
                  }))(d(), ["--version"], { windowsHide: !0 });
                (t = ((i = (i.toString("utf8").split(/\r|\n|\r\n/) ||
                  [])[0]).match(/[\d.]{2,}/) || [])[0]),
                  (n = a.compareVersion(t, "2.0") >= 0),
                  (window.pandocVersion = t);
              } catch (e) {
                (n = !1), console.sendError(e, !1);
              }
              return (
                n ||
                  e ||
                  s.showDialog({
                    title: $.localize.getString(
                      "Require Pandoc to Continue...",
                      "Panel"
                    ),
                    html: $.localize.getString(
                      "Import or some export features requires <a href='http://pandoc.org/' target='_blank'>Pandoc</a> (≥ v2.0) to be installed.",
                      "Panel"
                    ),
                    buttons: [
                      $.localize.getString(
                        "Follow Instructions to Install/Update Pandoc",
                        "Panel"
                      ),
                      $.localize.getString("Set Pandoc Path", "Panel"),
                      $.localize.getString("Cancel", "Panel"),
                    ],
                    tag: "pandoc-warning",
                    backdrop: !1,
                    callback: function (e) {
                      document.body.classList.remove("ty-show-notification"),
                        0 == e &&
                          JSBridge.invoke(
                            "app.openFile",
                            window.dirname + "/Docs/Install and Use Pandoc.md",
                            { forceCreateWindow: !0 }
                          ),
                        1 == e && (s.dialog.hide(), setTimeout(m, 10));
                    },
                  }),
                JSBridge.invoke("pandoc.setVersion", n ? t : "false"),
                n
              );
            },
            f = !1,
            m = function () {
              s.showDialog({
                title: $.localize.getString("Pandoc Path", "Panel"),
                html: `<div class='input-group ty-pandoc-path-select-row'><input id='ty-pandoc-path-input' type='text' value='${
                  File.option.pandocPath || ""
                }' placeholder='(auto detect)'/><button id='ty-pandoc-path-select' type='button' class='btn' ty-hint='${$.localize.getString(
                  "Select",
                  "Panel"
                )}'><i class='fa fa-folder' aria-hidden='true'/></button><button id='ty-pandoc-path-reset' type='button' class='btn'><i class='fa fa-times-circle' aria-hidden='true' ty-hint='${$.localize.getString(
                  "Reset",
                  "Panel"
                )}'></i></button></div>`,
                buttons: [
                  $.localize.getString("OK", "Panel"),
                  $.localize.getString("Cancel", "Panel"),
                ],
                backdrop: !1,
                callback: function (e) {
                  0 == e &&
                    (JSBridge.invoke("pandoc.setVersion", void 0),
                    (File.option.pandocPath = $("#ty-pandoc-path-input")
                      .val()
                      .trim()),
                    JSBridge.putSetting("pandocPath", File.option.pandocPath),
                    JSBridge.execForAll(
                      `File.option.pandocPath=${JSON.stringify(
                        File.option.pandocPath
                      )}`
                    ));
                },
              }),
                f ||
                  ((f = !0),
                  s.dialog.$dialog
                    .on("click", "#ty-pandoc-path-select", function () {
                      JSBridge.selectFile(
                        File.option.pandocPath || "",
                        [
                          {
                            name: "Executable",
                            extensions: [File.isWin ? "exe" : ""],
                          },
                        ],
                        (e) => {
                          $("#ty-pandoc-path-input").val(e || "");
                        }
                      );
                    })
                    .on("click", "#ty-pandoc-path-reset", function () {
                      $("#ty-pandoc-path-input").val("");
                    }));
            },
            g = !1;
          i = {
            prepImport: async function () {
              (g = !1),
                (await p()) &&
                  ((g = File.changeCounter.isDiscardableUntitled()),
                  JSBridge.invoke("pandoc.import", g));
            },
            import: function (e) {
              File.lock(),
                (File.blockUI = !0),
                (r = $("#import-process-dialog")),
                (c = u(
                  [
                    e,
                    "--quiet",
                    "--wrap=none",
                    "-t",
                    "gfm-smart+tex_math_dollars-fenced_divs-bracketed_spans-raw_html",
                  ],
                  y,
                  e
                )),
                setTimeout(function () {
                  c &&
                    (r.modal({ backdrop: "static", keyboard: !1 }),
                    r.find(".btn").one("click", function () {
                      h(), g || JSBridge.invoke("window.close");
                    }));
                }, 200);
            },
            runExportCommand: function (e, t) {
              return (
                h(),
                e
                  ? new Promise((n) => {
                      var i, r, o;
                      (0, reqnode("child_process").exec)(
                        e,
                        { cwd: t },
                        (e, t, a) => {
                          if (e)
                            return (
                              console.log(`error: ${e.message}`),
                              void n({ code: -1, error: e.message })
                            );
                          a && console.log(`stderr: ${a}`),
                            (i = a),
                            (r = t),
                            void 0 === o ||
                              n({ code: o, error: i, message: r });
                        }
                      ).on("exit", function (e) {
                        (o = e),
                          (void 0 === i && void 0 === r) ||
                            n({ code: o, error: i, message: r });
                      });
                    })
                  : { code: -1, error: "command is empty" }
              );
            },
            customExport: async function (e, t, n, r) {
              var o = await i.runExportCommand(t, n);
              v(e || "", o.message || "", o.error || "", o.code, [t], r);
            },
            export: async function (e, t) {
              if (await p()) {
                var n;
                (t = t || {}),
                  (n =
                    "pandoc" == e
                      ? ((t.extensions || "").trim().split(/\s+/g) || []).map(
                          (e) => e.replace(/^\./, "")
                        )
                      : "native" == e
                      ? [""]
                      : b(e, t));
                var i = await l.showExportDialog(n[0], t, [
                  { name: "pandoc" == e ? t.targetFormat : e, extensions: n },
                  {
                    name: $.localize.getString("All Files", "Panel"),
                    extensions: [""],
                  },
                ]);
                if (i) {
                  File.editor.export.recordLastExport(t, i),
                    (File.blockUI = !0);
                  var o = "pandoc" == e || "native" == e,
                    a = x(e, i, t),
                    s = a[0],
                    d = o || a[1];
                  s.join(", ");
                  var f = new Date(),
                    m = function (e, t) {
                      (s = s.map((e) =>
                        File.editor.export.processExportVariables(e, {
                          outputPath: i,
                        })
                      )),
                        (c = u(
                          s,
                          (e, n, i, r) => {
                            v(e, n, i, r, d ? s : null, t);
                          },
                          i,
                          { stdio: "pipe", cwd: t.cwd }
                        )).stdin.end(e, "utf8"),
                        (r = $("#export-process-dialog"));
                      var n = Math.max(500 - new Date() + f, 0);
                      setTimeout(function () {
                        c &&
                          (r.modal({ backdrop: "static", keyboard: !1 }),
                          r.find(".btn").one("click", function () {
                            (File.blockUI = !1), h(), r.modal("hide");
                          }));
                      }, n);
                    };
                  "native" == e &&
                    (m = function (e) {
                      reqnode("fs").writeFile(i, e, function (e) {
                        v(i, "", e, e ? -1 : 0, d ? s : null, t);
                      });
                    });
                  var g = reqnode("path").dirname(i);
                  File.editor.export.exportToNative(e, m, g, t);
                } else document.body.classList.remove("ty-show-notification");
              }
            },
          };
          var v = function (e, t, n, i, o, l) {
              r && r.modal("hide"),
                document.body.classList.remove("ty-show-notification"),
                (File.blockUI = !1),
                0 !== i
                  ? (function (t) {
                      s.showDialog({
                        title: $.localize.getString("Export Failed", "Panel"),
                        html:
                          (e
                            ? $.localize
                                .getString(
                                  "Failed to export file to <em>{0}</em>"
                                )
                                .format(a.escape(e))
                            : "") +
                          "<br />" +
                          (o
                            ? `${$.localize.getString(
                                "Command Arguments:",
                                "Panel"
                              )}<pre style="user-select: all;">${o
                                .map((e) =>
                                  o.length > 1 &&
                                  /[\s'"]/.exec(e) &&
                                  !/^['"-]/.exec(e)
                                    ? JSON.stringify(e)
                                    : e
                                )
                                .join(" ")}</pre>`
                            : "") +
                          `Error:<pre style='white-space: pre-line;' >${a.escape(
                            t.substring(0, 500)
                          )}</pre>`,
                        type: "error",
                        backdrop: "static",
                      }),
                        console.sendError(t);
                    })(n)
                  : File.editor.export.onExportSuccess(
                      "pandoc",
                      e,
                      l,
                      t,
                      n,
                      o &&
                        o.map((e) =>
                          o.length > 1 && /[\s'"]/.exec(e) && !/^['"-]/.exec(e)
                            ? JSON.stringify(e)
                            : e
                        )
                    ),
                File.editor.export.cleanUpTempFiles();
            },
            y = function (e, t, n, i) {
              r.modal("hide"),
                File.unlock(),
                (File.blockUI = !1),
                t && 0 != t.length
                  ? File.reloadContent(t.toString(), { skipUndo: !0 })
                  : s.showDialog({
                      title: $.localize.getString("Import Failed", "Panel"),
                      html:
                        $.localize
                          .getString(
                            "Failed to import file from <em>{0}</em>",
                            "Panel"
                          )
                          .format(a.escape(e)) +
                        "<br />" +
                        a.escape(n),
                      type: "error",
                      backdrop: "static",
                    }),
                File.updateChangeCount(File.ChangeType.NSChangeDone),
                h();
            },
            b = function (e, t) {
              var n = [e];
              return (
                "latex" == e
                  ? (n = ["tex", "latex", "txt"])
                  : "wiki" == e
                  ? (n = ["wiki", "txt"])
                  : "rst" == e
                  ? (n = ["rst", "text", "rest", "reStructuredText"])
                  : "opml" == e
                  ? (n = ["opml", "xml"])
                  : "textile" == e
                  ? (n = ["textile", "txt", "text"])
                  : "latex-pdf" == e
                  ? (n = ["pdf"])
                  : "pandoc" == e
                  ? (n = t.extensions || [])
                  : "markdown" == e &&
                    ((n = [
                      "md",
                      "markdown",
                      "mmd",
                      "mkd",
                      "mkdown",
                      "rmd",
                      "qmd",
                      "rmarkdown",
                      "text",
                      "txt",
                    ]),
                    "markdown_mmd" == t.variants &&
                      (n = [
                        "mmd",
                        "md",
                        "markdown",
                        "mkd",
                        "mkdown",
                        "rmd",
                        "qmd",
                        "rmarkdown",
                        "text",
                        "txt",
                      ])),
                n
              );
            },
            w = function (e, t, n, i) {
              var r = e[t];
              return (
                !(!r || !r.trim().length) &&
                (i
                  ? (n.push(`--${t}`), n.push(r))
                  : n.push(`--${t}=${/\d+/.exec(r) ? r : JSON.stringify(r)}`),
                !0)
              );
            },
            x = function (e, t, n) {
              var i = ["-f", "native", "-s", "-o", t, "-t", e],
                r = !1;
              "wiki" == e && (i.pop(), i.push("mediawiki")),
                "latex-pdf" == e && (i.pop(), i.push("pdf")),
                "pandoc" == e &&
                  ((r = !0),
                  i.pop(),
                  n.targetFormat ? i.push(n.targetFormat) : i.pop()),
                "markdown" == e &&
                  ((r = !0),
                  i.pop(),
                  i.push(n.variants || "markdown"),
                  n.hardLineWrap && i.push(`--columns=${n.columns || 130}`),
                  n.eol && i.push(`--eol=${n.eol || "native"}`),
                  "tab" == n.tab
                    ? i.push("--preserve-tabs")
                    : n.tab && i.push(`--tab-stop=${n.tab || 4}`),
                  n.ascii && i.push("--ascii"),
                  n["reference-links"] && i.push("--reference-links"),
                  n["reference-location"] &&
                    i.push(
                      `--reference-location=${
                        n["--reference-location"] || "document"
                      }`
                    ),
                  n["markdown-headings"] &&
                    i.push(
                      `--markdown-headings=${n["--markdown-headings"] || "atx"}`
                    ),
                  n.webtex &&
                    i.push(
                      `--webtex=https://latex.codecogs.com/${
                        n["webtex-format"] || "png"
                      }.latex`
                    ));
              var o = i.length;
              return (
                n.extraArguments && (i = i.concat(n.extraArguments)),
                w(n, "reference-doc", i, !0),
                w(n, "template", i, !0),
                w(n, "css", i, !0),
                w(n, "epub-chapter-level", i),
                w(n, "toc", i) && i.pop(),
                w(n, "pdf-engine", i),
                [i, r || o !== i.length]
              );
            };
          (i.silentQuit = h), (i.validatePandocInstall = p);
        }
        n.exports = i;
      }
    ),
    $__System.registerDynamic("5f", [], !1, function (e, t, n) {
      var i = $__System.registry
        .get("@@global-helpers")
        .prepareGlobal(n.id, null, null);
      return (
        (function (e) {
          (e.nfkc = D),
            (e.nfc = N),
            (e.nfkd = L),
            (e.nfd = M),
            (e.fromCpFilter = A),
            (e.fromRuleBasedJamo = _),
            (e.fromCpOnly = T),
            (e.fromData = E),
            (e.fromCache = k);
          var t = e.root,
            n = e.DEFAULT_FEATURE,
            i = e.CACHE_THRESHOLD,
            r = e.SBase,
            o = e.LBase,
            a = e.VBase,
            s = e.TBase,
            l = e.LCount,
            c = e.VCount,
            d = e.TCount,
            u = e.NCount,
            h = e.SCount,
            p = e.UChar,
            f = e.cache,
            m = e.cacheCounter,
            g = e.i,
            v = e.strategies,
            y = e.UCharIterator,
            b = e.RecursDecompIterator,
            w = e.DecompIterator,
            x = e.CompIterator,
            C = e.createIterator,
            F = e.normalize,
            S = e.unorm;
          for (
            t = window,
              n = [null, 0, {}],
              i = 10,
              r = 44032,
              o = 4352,
              a = 4449,
              s = 4519,
              h = (l = 19) * (u = (c = 21) * (d = 28)),
              p = function (e, t) {
                (this.codepoint = e), (this.feature = t);
              },
              f = {},
              m = [],
              g = 0;
            g <= 255;
            ++g
          )
            m[g] = 0;
          function k(e, t, n) {
            var r = f[t];
            return (
              r ||
                ((r = e(t, n)).feature &&
                  ++m[(t >> 8) & 255] > i &&
                  (f[t] = r)),
              r
            );
          }
          function E(e, t, i) {
            var r = 65280 & t,
              o = (p.udata[r] || {})[t];
            return new p(t, o || n);
          }
          function T(e, t, n) {
            return n ? e(t, n) : new p(t, null);
          }
          function _(e, t, n) {
            var i;
            if (t < o || (o + l <= t && t < r) || r + h < t) return e(t, n);
            if (o <= t && t < o + l) {
              var f = {},
                m = (t - o) * c;
              for (i = 0; i < c; ++i) f[a + i] = r + d * (i + m);
              return new p(t, [, , f]);
            }
            var g = t - r,
              v = g % d,
              y = [];
            if (0 !== v) y[0] = [r + g - v, s + v];
            else
              for (
                y[0] = [o + Math.floor(g / u), a + Math.floor((g % u) / d)],
                  y[2] = {},
                  i = 1;
                i < d;
                ++i
              )
                y[2][s + i] = t + i;
            return new p(t, y);
          }
          function A(e, t, i) {
            return t < 60 || (13311 < t && t < 42607) ? new p(t, n) : e(t, i);
          }
          v = [A, k, T, _, E];
          (p.fromCharCode = v.reduceRight(function (e, t) {
            return function (n, i) {
              return t(e, n, i);
            };
          }, null)),
            (p.isHighSurrogate = function (e) {
              return e >= 55296 && e <= 56319;
            }),
            (p.isLowSurrogate = function (e) {
              return e >= 56320 && e <= 57343;
            }),
            (p.prototype.prepFeature = function () {
              this.feature ||
                (this.feature = p.fromCharCode(this.codepoint, !0).feature);
            }),
            (p.prototype.toString = function () {
              if (this.codepoint < 65536)
                return String.fromCharCode(this.codepoint);
              var e = this.codepoint - 65536;
              return String.fromCharCode(
                Math.floor(e / 1024) + 55296,
                (e % 1024) + 56320
              );
            }),
            (p.prototype.getDecomp = function () {
              return this.prepFeature(), this.feature[0] || null;
            }),
            (p.prototype.isCompatibility = function () {
              return (
                this.prepFeature(), !!this.feature[1] && 256 & this.feature[1]
              );
            }),
            (p.prototype.isExclude = function () {
              return (
                this.prepFeature(), !!this.feature[1] && 512 & this.feature[1]
              );
            }),
            (p.prototype.getCanonicalClass = function () {
              return (
                this.prepFeature(), this.feature[1] ? 255 & this.feature[1] : 0
              );
            }),
            (p.prototype.getComposite = function (e) {
              if ((this.prepFeature(), !this.feature[2])) return null;
              var t = this.feature[2][e.codepoint];
              return t ? p.fromCharCode(t) : null;
            }),
            ((y = function (e) {
              (this.str = e), (this.cursor = 0);
            }).prototype.next = function () {
              if (this.str && this.cursor < this.str.length) {
                var e,
                  t = this.str.charCodeAt(this.cursor++);
                return (
                  p.isHighSurrogate(t) &&
                    this.cursor < this.str.length &&
                    p.isLowSurrogate((e = this.str.charCodeAt(this.cursor))) &&
                    ((t = 1024 * (t - 55296) + (e - 56320) + 65536),
                    ++this.cursor),
                  p.fromCharCode(t)
                );
              }
              return (this.str = null), null;
            }),
            ((b = function (e, t) {
              (this.it = e), (this.canonical = t), (this.resBuf = []);
            }).prototype.next = function () {
              if (0 === this.resBuf.length) {
                var e = this.it.next();
                if (!e) return null;
                this.resBuf = (function e(t, n) {
                  var i = n.getDecomp();
                  if (!i || (t && n.isCompatibility())) return [n];
                  for (var r = [], o = 0; o < i.length; ++o) {
                    var a = e(t, p.fromCharCode(i[o]));
                    r = r.concat(a);
                  }
                  return r;
                })(this.canonical, e);
              }
              return this.resBuf.shift();
            }),
            ((w = function (e) {
              (this.it = e), (this.resBuf = []);
            }).prototype.next = function () {
              var e;
              if (0 === this.resBuf.length)
                do {
                  var t = this.it.next();
                  if (!t) break;
                  e = t.getCanonicalClass();
                  var n = this.resBuf.length;
                  if (0 !== e)
                    for (; n > 0; --n) {
                      if (this.resBuf[n - 1].getCanonicalClass() <= e) break;
                    }
                  this.resBuf.splice(n, 0, t);
                } while (0 !== e);
              return this.resBuf.shift();
            }),
            ((x = function (e) {
              (this.it = e),
                (this.procBuf = []),
                (this.resBuf = []),
                (this.lastClass = null);
            }).prototype.next = function () {
              for (; 0 === this.resBuf.length; ) {
                var e = this.it.next();
                if (!e) {
                  (this.resBuf = this.procBuf), (this.procBuf = []);
                  break;
                }
                if (0 === this.procBuf.length)
                  (this.lastClass = e.getCanonicalClass()),
                    this.procBuf.push(e);
                else {
                  var t = this.procBuf[0].getComposite(e),
                    n = e.getCanonicalClass();
                  t && (this.lastClass < n || 0 === this.lastClass)
                    ? (this.procBuf[0] = t)
                    : (0 === n &&
                        ((this.resBuf = this.procBuf), (this.procBuf = [])),
                      (this.lastClass = n),
                      this.procBuf.push(e));
                }
              }
              return this.resBuf.shift();
            });
          (C = function (e, t) {
            switch (e) {
              case "NFD":
                return new w(new b(new y(t), !0));
              case "NFKD":
                return new w(new b(new y(t), !1));
              case "NFC":
                return new x(new w(new b(new y(t), !0)));
              case "NFKC":
                return new x(new w(new b(new y(t), !1)));
            }
            throw e + " is invalid";
          }),
            (F = function (e, t) {
              for (var n, i = C(e, t), r = ""; (n = i.next()); )
                r += n.toString();
              return r;
            });
          function M(e) {
            return F("NFD", e);
          }
          function L(e) {
            return F("NFKD", e);
          }
          function N(e) {
            return F("NFC", e);
          }
          function D(e) {
            return F("NFKC", e);
          }
          p.udata = {
            0: {
              60: [, , { 824: 8814 }],
              61: [, , { 824: 8800 }],
              62: [, , { 824: 8815 }],
              65: [
                ,
                ,
                {
                  768: 192,
                  769: 193,
                  770: 194,
                  771: 195,
                  772: 256,
                  774: 258,
                  775: 550,
                  776: 196,
                  777: 7842,
                  778: 197,
                  780: 461,
                  783: 512,
                  785: 514,
                  803: 7840,
                  805: 7680,
                  808: 260,
                },
              ],
              66: [, , { 775: 7682, 803: 7684, 817: 7686 }],
              67: [, , { 769: 262, 770: 264, 775: 266, 780: 268, 807: 199 }],
              68: [
                ,
                ,
                {
                  775: 7690,
                  780: 270,
                  803: 7692,
                  807: 7696,
                  813: 7698,
                  817: 7694,
                },
              ],
              69: [
                ,
                ,
                {
                  768: 200,
                  769: 201,
                  770: 202,
                  771: 7868,
                  772: 274,
                  774: 276,
                  775: 278,
                  776: 203,
                  777: 7866,
                  780: 282,
                  783: 516,
                  785: 518,
                  803: 7864,
                  807: 552,
                  808: 280,
                  813: 7704,
                  816: 7706,
                },
              ],
              70: [, , { 775: 7710 }],
              71: [
                ,
                ,
                {
                  769: 500,
                  770: 284,
                  772: 7712,
                  774: 286,
                  775: 288,
                  780: 486,
                  807: 290,
                },
              ],
              72: [
                ,
                ,
                {
                  770: 292,
                  775: 7714,
                  776: 7718,
                  780: 542,
                  803: 7716,
                  807: 7720,
                  814: 7722,
                },
              ],
              73: [
                ,
                ,
                {
                  768: 204,
                  769: 205,
                  770: 206,
                  771: 296,
                  772: 298,
                  774: 300,
                  775: 304,
                  776: 207,
                  777: 7880,
                  780: 463,
                  783: 520,
                  785: 522,
                  803: 7882,
                  808: 302,
                  816: 7724,
                },
              ],
              74: [, , { 770: 308 }],
              75: [, , { 769: 7728, 780: 488, 803: 7730, 807: 310, 817: 7732 }],
              76: [
                ,
                ,
                {
                  769: 313,
                  780: 317,
                  803: 7734,
                  807: 315,
                  813: 7740,
                  817: 7738,
                },
              ],
              77: [, , { 769: 7742, 775: 7744, 803: 7746 }],
              78: [
                ,
                ,
                {
                  768: 504,
                  769: 323,
                  771: 209,
                  775: 7748,
                  780: 327,
                  803: 7750,
                  807: 325,
                  813: 7754,
                  817: 7752,
                },
              ],
              79: [
                ,
                ,
                {
                  768: 210,
                  769: 211,
                  770: 212,
                  771: 213,
                  772: 332,
                  774: 334,
                  775: 558,
                  776: 214,
                  777: 7886,
                  779: 336,
                  780: 465,
                  783: 524,
                  785: 526,
                  795: 416,
                  803: 7884,
                  808: 490,
                },
              ],
              80: [, , { 769: 7764, 775: 7766 }],
              82: [
                ,
                ,
                {
                  769: 340,
                  775: 7768,
                  780: 344,
                  783: 528,
                  785: 530,
                  803: 7770,
                  807: 342,
                  817: 7774,
                },
              ],
              83: [
                ,
                ,
                {
                  769: 346,
                  770: 348,
                  775: 7776,
                  780: 352,
                  803: 7778,
                  806: 536,
                  807: 350,
                },
              ],
              84: [
                ,
                ,
                {
                  775: 7786,
                  780: 356,
                  803: 7788,
                  806: 538,
                  807: 354,
                  813: 7792,
                  817: 7790,
                },
              ],
              85: [
                ,
                ,
                {
                  768: 217,
                  769: 218,
                  770: 219,
                  771: 360,
                  772: 362,
                  774: 364,
                  776: 220,
                  777: 7910,
                  778: 366,
                  779: 368,
                  780: 467,
                  783: 532,
                  785: 534,
                  795: 431,
                  803: 7908,
                  804: 7794,
                  808: 370,
                  813: 7798,
                  816: 7796,
                },
              ],
              86: [, , { 771: 7804, 803: 7806 }],
              87: [
                ,
                ,
                {
                  768: 7808,
                  769: 7810,
                  770: 372,
                  775: 7814,
                  776: 7812,
                  803: 7816,
                },
              ],
              88: [, , { 775: 7818, 776: 7820 }],
              89: [
                ,
                ,
                {
                  768: 7922,
                  769: 221,
                  770: 374,
                  771: 7928,
                  772: 562,
                  775: 7822,
                  776: 376,
                  777: 7926,
                  803: 7924,
                },
              ],
              90: [
                ,
                ,
                {
                  769: 377,
                  770: 7824,
                  775: 379,
                  780: 381,
                  803: 7826,
                  817: 7828,
                },
              ],
              97: [
                ,
                ,
                {
                  768: 224,
                  769: 225,
                  770: 226,
                  771: 227,
                  772: 257,
                  774: 259,
                  775: 551,
                  776: 228,
                  777: 7843,
                  778: 229,
                  780: 462,
                  783: 513,
                  785: 515,
                  803: 7841,
                  805: 7681,
                  808: 261,
                },
              ],
              98: [, , { 775: 7683, 803: 7685, 817: 7687 }],
              99: [, , { 769: 263, 770: 265, 775: 267, 780: 269, 807: 231 }],
              100: [
                ,
                ,
                {
                  775: 7691,
                  780: 271,
                  803: 7693,
                  807: 7697,
                  813: 7699,
                  817: 7695,
                },
              ],
              101: [
                ,
                ,
                {
                  768: 232,
                  769: 233,
                  770: 234,
                  771: 7869,
                  772: 275,
                  774: 277,
                  775: 279,
                  776: 235,
                  777: 7867,
                  780: 283,
                  783: 517,
                  785: 519,
                  803: 7865,
                  807: 553,
                  808: 281,
                  813: 7705,
                  816: 7707,
                },
              ],
              102: [, , { 775: 7711 }],
              103: [
                ,
                ,
                {
                  769: 501,
                  770: 285,
                  772: 7713,
                  774: 287,
                  775: 289,
                  780: 487,
                  807: 291,
                },
              ],
              104: [
                ,
                ,
                {
                  770: 293,
                  775: 7715,
                  776: 7719,
                  780: 543,
                  803: 7717,
                  807: 7721,
                  814: 7723,
                  817: 7830,
                },
              ],
              105: [
                ,
                ,
                {
                  768: 236,
                  769: 237,
                  770: 238,
                  771: 297,
                  772: 299,
                  774: 301,
                  776: 239,
                  777: 7881,
                  780: 464,
                  783: 521,
                  785: 523,
                  803: 7883,
                  808: 303,
                  816: 7725,
                },
              ],
              106: [, , { 770: 309, 780: 496 }],
              107: [
                ,
                ,
                { 769: 7729, 780: 489, 803: 7731, 807: 311, 817: 7733 },
              ],
              108: [
                ,
                ,
                {
                  769: 314,
                  780: 318,
                  803: 7735,
                  807: 316,
                  813: 7741,
                  817: 7739,
                },
              ],
              109: [, , { 769: 7743, 775: 7745, 803: 7747 }],
              110: [
                ,
                ,
                {
                  768: 505,
                  769: 324,
                  771: 241,
                  775: 7749,
                  780: 328,
                  803: 7751,
                  807: 326,
                  813: 7755,
                  817: 7753,
                },
              ],
              111: [
                ,
                ,
                {
                  768: 242,
                  769: 243,
                  770: 244,
                  771: 245,
                  772: 333,
                  774: 335,
                  775: 559,
                  776: 246,
                  777: 7887,
                  779: 337,
                  780: 466,
                  783: 525,
                  785: 527,
                  795: 417,
                  803: 7885,
                  808: 491,
                },
              ],
              112: [, , { 769: 7765, 775: 7767 }],
              114: [
                ,
                ,
                {
                  769: 341,
                  775: 7769,
                  780: 345,
                  783: 529,
                  785: 531,
                  803: 7771,
                  807: 343,
                  817: 7775,
                },
              ],
              115: [
                ,
                ,
                {
                  769: 347,
                  770: 349,
                  775: 7777,
                  780: 353,
                  803: 7779,
                  806: 537,
                  807: 351,
                },
              ],
              116: [
                ,
                ,
                {
                  775: 7787,
                  776: 7831,
                  780: 357,
                  803: 7789,
                  806: 539,
                  807: 355,
                  813: 7793,
                  817: 7791,
                },
              ],
              117: [
                ,
                ,
                {
                  768: 249,
                  769: 250,
                  770: 251,
                  771: 361,
                  772: 363,
                  774: 365,
                  776: 252,
                  777: 7911,
                  778: 367,
                  779: 369,
                  780: 468,
                  783: 533,
                  785: 535,
                  795: 432,
                  803: 7909,
                  804: 7795,
                  808: 371,
                  813: 7799,
                  816: 7797,
                },
              ],
              118: [, , { 771: 7805, 803: 7807 }],
              119: [
                ,
                ,
                {
                  768: 7809,
                  769: 7811,
                  770: 373,
                  775: 7815,
                  776: 7813,
                  778: 7832,
                  803: 7817,
                },
              ],
              120: [, , { 775: 7819, 776: 7821 }],
              121: [
                ,
                ,
                {
                  768: 7923,
                  769: 253,
                  770: 375,
                  771: 7929,
                  772: 563,
                  775: 7823,
                  776: 255,
                  777: 7927,
                  778: 7833,
                  803: 7925,
                },
              ],
              122: [
                ,
                ,
                {
                  769: 378,
                  770: 7825,
                  775: 380,
                  780: 382,
                  803: 7827,
                  817: 7829,
                },
              ],
              160: [[32], 256],
              168: [[32, 776], 256, { 768: 8173, 769: 901, 834: 8129 }],
              170: [[97], 256],
              175: [[32, 772], 256],
              178: [[50], 256],
              179: [[51], 256],
              180: [[32, 769], 256],
              181: [[956], 256],
              184: [[32, 807], 256],
              185: [[49], 256],
              186: [[111], 256],
              188: [[49, 8260, 52], 256],
              189: [[49, 8260, 50], 256],
              190: [[51, 8260, 52], 256],
              192: [[65, 768]],
              193: [[65, 769]],
              194: [
                [65, 770],
                ,
                { 768: 7846, 769: 7844, 771: 7850, 777: 7848 },
              ],
              195: [[65, 771]],
              196: [[65, 776], , { 772: 478 }],
              197: [[65, 778], , { 769: 506 }],
              198: [, , { 769: 508, 772: 482 }],
              199: [[67, 807], , { 769: 7688 }],
              200: [[69, 768]],
              201: [[69, 769]],
              202: [
                [69, 770],
                ,
                { 768: 7872, 769: 7870, 771: 7876, 777: 7874 },
              ],
              203: [[69, 776]],
              204: [[73, 768]],
              205: [[73, 769]],
              206: [[73, 770]],
              207: [[73, 776], , { 769: 7726 }],
              209: [[78, 771]],
              210: [[79, 768]],
              211: [[79, 769]],
              212: [
                [79, 770],
                ,
                { 768: 7890, 769: 7888, 771: 7894, 777: 7892 },
              ],
              213: [[79, 771], , { 769: 7756, 772: 556, 776: 7758 }],
              214: [[79, 776], , { 772: 554 }],
              216: [, , { 769: 510 }],
              217: [[85, 768]],
              218: [[85, 769]],
              219: [[85, 770]],
              220: [[85, 776], , { 768: 475, 769: 471, 772: 469, 780: 473 }],
              221: [[89, 769]],
              224: [[97, 768]],
              225: [[97, 769]],
              226: [
                [97, 770],
                ,
                { 768: 7847, 769: 7845, 771: 7851, 777: 7849 },
              ],
              227: [[97, 771]],
              228: [[97, 776], , { 772: 479 }],
              229: [[97, 778], , { 769: 507 }],
              230: [, , { 769: 509, 772: 483 }],
              231: [[99, 807], , { 769: 7689 }],
              232: [[101, 768]],
              233: [[101, 769]],
              234: [
                [101, 770],
                ,
                { 768: 7873, 769: 7871, 771: 7877, 777: 7875 },
              ],
              235: [[101, 776]],
              236: [[105, 768]],
              237: [[105, 769]],
              238: [[105, 770]],
              239: [[105, 776], , { 769: 7727 }],
              241: [[110, 771]],
              242: [[111, 768]],
              243: [[111, 769]],
              244: [
                [111, 770],
                ,
                { 768: 7891, 769: 7889, 771: 7895, 777: 7893 },
              ],
              245: [[111, 771], , { 769: 7757, 772: 557, 776: 7759 }],
              246: [[111, 776], , { 772: 555 }],
              248: [, , { 769: 511 }],
              249: [[117, 768]],
              250: [[117, 769]],
              251: [[117, 770]],
              252: [[117, 776], , { 768: 476, 769: 472, 772: 470, 780: 474 }],
              253: [[121, 769]],
              255: [[121, 776]],
            },
            256: {
              256: [[65, 772]],
              257: [[97, 772]],
              258: [
                [65, 774],
                ,
                { 768: 7856, 769: 7854, 771: 7860, 777: 7858 },
              ],
              259: [
                [97, 774],
                ,
                { 768: 7857, 769: 7855, 771: 7861, 777: 7859 },
              ],
              260: [[65, 808]],
              261: [[97, 808]],
              262: [[67, 769]],
              263: [[99, 769]],
              264: [[67, 770]],
              265: [[99, 770]],
              266: [[67, 775]],
              267: [[99, 775]],
              268: [[67, 780]],
              269: [[99, 780]],
              270: [[68, 780]],
              271: [[100, 780]],
              274: [[69, 772], , { 768: 7700, 769: 7702 }],
              275: [[101, 772], , { 768: 7701, 769: 7703 }],
              276: [[69, 774]],
              277: [[101, 774]],
              278: [[69, 775]],
              279: [[101, 775]],
              280: [[69, 808]],
              281: [[101, 808]],
              282: [[69, 780]],
              283: [[101, 780]],
              284: [[71, 770]],
              285: [[103, 770]],
              286: [[71, 774]],
              287: [[103, 774]],
              288: [[71, 775]],
              289: [[103, 775]],
              290: [[71, 807]],
              291: [[103, 807]],
              292: [[72, 770]],
              293: [[104, 770]],
              296: [[73, 771]],
              297: [[105, 771]],
              298: [[73, 772]],
              299: [[105, 772]],
              300: [[73, 774]],
              301: [[105, 774]],
              302: [[73, 808]],
              303: [[105, 808]],
              304: [[73, 775]],
              306: [[73, 74], 256],
              307: [[105, 106], 256],
              308: [[74, 770]],
              309: [[106, 770]],
              310: [[75, 807]],
              311: [[107, 807]],
              313: [[76, 769]],
              314: [[108, 769]],
              315: [[76, 807]],
              316: [[108, 807]],
              317: [[76, 780]],
              318: [[108, 780]],
              319: [[76, 183], 256],
              320: [[108, 183], 256],
              323: [[78, 769]],
              324: [[110, 769]],
              325: [[78, 807]],
              326: [[110, 807]],
              327: [[78, 780]],
              328: [[110, 780]],
              329: [[700, 110], 256],
              332: [[79, 772], , { 768: 7760, 769: 7762 }],
              333: [[111, 772], , { 768: 7761, 769: 7763 }],
              334: [[79, 774]],
              335: [[111, 774]],
              336: [[79, 779]],
              337: [[111, 779]],
              340: [[82, 769]],
              341: [[114, 769]],
              342: [[82, 807]],
              343: [[114, 807]],
              344: [[82, 780]],
              345: [[114, 780]],
              346: [[83, 769], , { 775: 7780 }],
              347: [[115, 769], , { 775: 7781 }],
              348: [[83, 770]],
              349: [[115, 770]],
              350: [[83, 807]],
              351: [[115, 807]],
              352: [[83, 780], , { 775: 7782 }],
              353: [[115, 780], , { 775: 7783 }],
              354: [[84, 807]],
              355: [[116, 807]],
              356: [[84, 780]],
              357: [[116, 780]],
              360: [[85, 771], , { 769: 7800 }],
              361: [[117, 771], , { 769: 7801 }],
              362: [[85, 772], , { 776: 7802 }],
              363: [[117, 772], , { 776: 7803 }],
              364: [[85, 774]],
              365: [[117, 774]],
              366: [[85, 778]],
              367: [[117, 778]],
              368: [[85, 779]],
              369: [[117, 779]],
              370: [[85, 808]],
              371: [[117, 808]],
              372: [[87, 770]],
              373: [[119, 770]],
              374: [[89, 770]],
              375: [[121, 770]],
              376: [[89, 776]],
              377: [[90, 769]],
              378: [[122, 769]],
              379: [[90, 775]],
              380: [[122, 775]],
              381: [[90, 780]],
              382: [[122, 780]],
              383: [[115], 256, { 775: 7835 }],
              416: [
                [79, 795],
                ,
                { 768: 7900, 769: 7898, 771: 7904, 777: 7902, 803: 7906 },
              ],
              417: [
                [111, 795],
                ,
                { 768: 7901, 769: 7899, 771: 7905, 777: 7903, 803: 7907 },
              ],
              431: [
                [85, 795],
                ,
                { 768: 7914, 769: 7912, 771: 7918, 777: 7916, 803: 7920 },
              ],
              432: [
                [117, 795],
                ,
                { 768: 7915, 769: 7913, 771: 7919, 777: 7917, 803: 7921 },
              ],
              439: [, , { 780: 494 }],
              452: [[68, 381], 256],
              453: [[68, 382], 256],
              454: [[100, 382], 256],
              455: [[76, 74], 256],
              456: [[76, 106], 256],
              457: [[108, 106], 256],
              458: [[78, 74], 256],
              459: [[78, 106], 256],
              460: [[110, 106], 256],
              461: [[65, 780]],
              462: [[97, 780]],
              463: [[73, 780]],
              464: [[105, 780]],
              465: [[79, 780]],
              466: [[111, 780]],
              467: [[85, 780]],
              468: [[117, 780]],
              469: [[220, 772]],
              470: [[252, 772]],
              471: [[220, 769]],
              472: [[252, 769]],
              473: [[220, 780]],
              474: [[252, 780]],
              475: [[220, 768]],
              476: [[252, 768]],
              478: [[196, 772]],
              479: [[228, 772]],
              480: [[550, 772]],
              481: [[551, 772]],
              482: [[198, 772]],
              483: [[230, 772]],
              486: [[71, 780]],
              487: [[103, 780]],
              488: [[75, 780]],
              489: [[107, 780]],
              490: [[79, 808], , { 772: 492 }],
              491: [[111, 808], , { 772: 493 }],
              492: [[490, 772]],
              493: [[491, 772]],
              494: [[439, 780]],
              495: [[658, 780]],
              496: [[106, 780]],
              497: [[68, 90], 256],
              498: [[68, 122], 256],
              499: [[100, 122], 256],
              500: [[71, 769]],
              501: [[103, 769]],
              504: [[78, 768]],
              505: [[110, 768]],
              506: [[197, 769]],
              507: [[229, 769]],
              508: [[198, 769]],
              509: [[230, 769]],
              510: [[216, 769]],
              511: [[248, 769]],
              66045: [, 220],
            },
            512: {
              512: [[65, 783]],
              513: [[97, 783]],
              514: [[65, 785]],
              515: [[97, 785]],
              516: [[69, 783]],
              517: [[101, 783]],
              518: [[69, 785]],
              519: [[101, 785]],
              520: [[73, 783]],
              521: [[105, 783]],
              522: [[73, 785]],
              523: [[105, 785]],
              524: [[79, 783]],
              525: [[111, 783]],
              526: [[79, 785]],
              527: [[111, 785]],
              528: [[82, 783]],
              529: [[114, 783]],
              530: [[82, 785]],
              531: [[114, 785]],
              532: [[85, 783]],
              533: [[117, 783]],
              534: [[85, 785]],
              535: [[117, 785]],
              536: [[83, 806]],
              537: [[115, 806]],
              538: [[84, 806]],
              539: [[116, 806]],
              542: [[72, 780]],
              543: [[104, 780]],
              550: [[65, 775], , { 772: 480 }],
              551: [[97, 775], , { 772: 481 }],
              552: [[69, 807], , { 774: 7708 }],
              553: [[101, 807], , { 774: 7709 }],
              554: [[214, 772]],
              555: [[246, 772]],
              556: [[213, 772]],
              557: [[245, 772]],
              558: [[79, 775], , { 772: 560 }],
              559: [[111, 775], , { 772: 561 }],
              560: [[558, 772]],
              561: [[559, 772]],
              562: [[89, 772]],
              563: [[121, 772]],
              658: [, , { 780: 495 }],
              688: [[104], 256],
              689: [[614], 256],
              690: [[106], 256],
              691: [[114], 256],
              692: [[633], 256],
              693: [[635], 256],
              694: [[641], 256],
              695: [[119], 256],
              696: [[121], 256],
              728: [[32, 774], 256],
              729: [[32, 775], 256],
              730: [[32, 778], 256],
              731: [[32, 808], 256],
              732: [[32, 771], 256],
              733: [[32, 779], 256],
              736: [[611], 256],
              737: [[108], 256],
              738: [[115], 256],
              739: [[120], 256],
              740: [[661], 256],
              66272: [, 220],
            },
            768: {
              768: [, 230],
              769: [, 230],
              770: [, 230],
              771: [, 230],
              772: [, 230],
              773: [, 230],
              774: [, 230],
              775: [, 230],
              776: [, 230, { 769: 836 }],
              777: [, 230],
              778: [, 230],
              779: [, 230],
              780: [, 230],
              781: [, 230],
              782: [, 230],
              783: [, 230],
              784: [, 230],
              785: [, 230],
              786: [, 230],
              787: [, 230],
              788: [, 230],
              789: [, 232],
              790: [, 220],
              791: [, 220],
              792: [, 220],
              793: [, 220],
              794: [, 232],
              795: [, 216],
              796: [, 220],
              797: [, 220],
              798: [, 220],
              799: [, 220],
              800: [, 220],
              801: [, 202],
              802: [, 202],
              803: [, 220],
              804: [, 220],
              805: [, 220],
              806: [, 220],
              807: [, 202],
              808: [, 202],
              809: [, 220],
              810: [, 220],
              811: [, 220],
              812: [, 220],
              813: [, 220],
              814: [, 220],
              815: [, 220],
              816: [, 220],
              817: [, 220],
              818: [, 220],
              819: [, 220],
              820: [, 1],
              821: [, 1],
              822: [, 1],
              823: [, 1],
              824: [, 1],
              825: [, 220],
              826: [, 220],
              827: [, 220],
              828: [, 220],
              829: [, 230],
              830: [, 230],
              831: [, 230],
              832: [[768], 230],
              833: [[769], 230],
              834: [, 230],
              835: [[787], 230],
              836: [[776, 769], 230],
              837: [, 240],
              838: [, 230],
              839: [, 220],
              840: [, 220],
              841: [, 220],
              842: [, 230],
              843: [, 230],
              844: [, 230],
              845: [, 220],
              846: [, 220],
              848: [, 230],
              849: [, 230],
              850: [, 230],
              851: [, 220],
              852: [, 220],
              853: [, 220],
              854: [, 220],
              855: [, 230],
              856: [, 232],
              857: [, 220],
              858: [, 220],
              859: [, 230],
              860: [, 233],
              861: [, 234],
              862: [, 234],
              863: [, 233],
              864: [, 234],
              865: [, 234],
              866: [, 233],
              867: [, 230],
              868: [, 230],
              869: [, 230],
              870: [, 230],
              871: [, 230],
              872: [, 230],
              873: [, 230],
              874: [, 230],
              875: [, 230],
              876: [, 230],
              877: [, 230],
              878: [, 230],
              879: [, 230],
              884: [[697]],
              890: [[32, 837], 256],
              894: [[59]],
              900: [[32, 769], 256],
              901: [[168, 769]],
              902: [[913, 769]],
              903: [[183]],
              904: [[917, 769]],
              905: [[919, 769]],
              906: [[921, 769]],
              908: [[927, 769]],
              910: [[933, 769]],
              911: [[937, 769]],
              912: [[970, 769]],
              913: [
                ,
                ,
                {
                  768: 8122,
                  769: 902,
                  772: 8121,
                  774: 8120,
                  787: 7944,
                  788: 7945,
                  837: 8124,
                },
              ],
              917: [, , { 768: 8136, 769: 904, 787: 7960, 788: 7961 }],
              919: [
                ,
                ,
                { 768: 8138, 769: 905, 787: 7976, 788: 7977, 837: 8140 },
              ],
              921: [
                ,
                ,
                {
                  768: 8154,
                  769: 906,
                  772: 8153,
                  774: 8152,
                  776: 938,
                  787: 7992,
                  788: 7993,
                },
              ],
              927: [, , { 768: 8184, 769: 908, 787: 8008, 788: 8009 }],
              929: [, , { 788: 8172 }],
              933: [
                ,
                ,
                {
                  768: 8170,
                  769: 910,
                  772: 8169,
                  774: 8168,
                  776: 939,
                  788: 8025,
                },
              ],
              937: [
                ,
                ,
                { 768: 8186, 769: 911, 787: 8040, 788: 8041, 837: 8188 },
              ],
              938: [[921, 776]],
              939: [[933, 776]],
              940: [[945, 769], , { 837: 8116 }],
              941: [[949, 769]],
              942: [[951, 769], , { 837: 8132 }],
              943: [[953, 769]],
              944: [[971, 769]],
              945: [
                ,
                ,
                {
                  768: 8048,
                  769: 940,
                  772: 8113,
                  774: 8112,
                  787: 7936,
                  788: 7937,
                  834: 8118,
                  837: 8115,
                },
              ],
              949: [, , { 768: 8050, 769: 941, 787: 7952, 788: 7953 }],
              951: [
                ,
                ,
                {
                  768: 8052,
                  769: 942,
                  787: 7968,
                  788: 7969,
                  834: 8134,
                  837: 8131,
                },
              ],
              953: [
                ,
                ,
                {
                  768: 8054,
                  769: 943,
                  772: 8145,
                  774: 8144,
                  776: 970,
                  787: 7984,
                  788: 7985,
                  834: 8150,
                },
              ],
              959: [, , { 768: 8056, 769: 972, 787: 8e3, 788: 8001 }],
              961: [, , { 787: 8164, 788: 8165 }],
              965: [
                ,
                ,
                {
                  768: 8058,
                  769: 973,
                  772: 8161,
                  774: 8160,
                  776: 971,
                  787: 8016,
                  788: 8017,
                  834: 8166,
                },
              ],
              969: [
                ,
                ,
                {
                  768: 8060,
                  769: 974,
                  787: 8032,
                  788: 8033,
                  834: 8182,
                  837: 8179,
                },
              ],
              970: [[953, 776], , { 768: 8146, 769: 912, 834: 8151 }],
              971: [[965, 776], , { 768: 8162, 769: 944, 834: 8167 }],
              972: [[959, 769]],
              973: [[965, 769]],
              974: [[969, 769], , { 837: 8180 }],
              976: [[946], 256],
              977: [[952], 256],
              978: [[933], 256, { 769: 979, 776: 980 }],
              979: [[978, 769]],
              980: [[978, 776]],
              981: [[966], 256],
              982: [[960], 256],
              1008: [[954], 256],
              1009: [[961], 256],
              1010: [[962], 256],
              1012: [[920], 256],
              1013: [[949], 256],
              1017: [[931], 256],
              66422: [, 230],
              66423: [, 230],
              66424: [, 230],
              66425: [, 230],
              66426: [, 230],
            },
            1024: {
              1024: [[1045, 768]],
              1025: [[1045, 776]],
              1027: [[1043, 769]],
              1030: [, , { 776: 1031 }],
              1031: [[1030, 776]],
              1036: [[1050, 769]],
              1037: [[1048, 768]],
              1038: [[1059, 774]],
              1040: [, , { 774: 1232, 776: 1234 }],
              1043: [, , { 769: 1027 }],
              1045: [, , { 768: 1024, 774: 1238, 776: 1025 }],
              1046: [, , { 774: 1217, 776: 1244 }],
              1047: [, , { 776: 1246 }],
              1048: [, , { 768: 1037, 772: 1250, 774: 1049, 776: 1252 }],
              1049: [[1048, 774]],
              1050: [, , { 769: 1036 }],
              1054: [, , { 776: 1254 }],
              1059: [, , { 772: 1262, 774: 1038, 776: 1264, 779: 1266 }],
              1063: [, , { 776: 1268 }],
              1067: [, , { 776: 1272 }],
              1069: [, , { 776: 1260 }],
              1072: [, , { 774: 1233, 776: 1235 }],
              1075: [, , { 769: 1107 }],
              1077: [, , { 768: 1104, 774: 1239, 776: 1105 }],
              1078: [, , { 774: 1218, 776: 1245 }],
              1079: [, , { 776: 1247 }],
              1080: [, , { 768: 1117, 772: 1251, 774: 1081, 776: 1253 }],
              1081: [[1080, 774]],
              1082: [, , { 769: 1116 }],
              1086: [, , { 776: 1255 }],
              1091: [, , { 772: 1263, 774: 1118, 776: 1265, 779: 1267 }],
              1095: [, , { 776: 1269 }],
              1099: [, , { 776: 1273 }],
              1101: [, , { 776: 1261 }],
              1104: [[1077, 768]],
              1105: [[1077, 776]],
              1107: [[1075, 769]],
              1110: [, , { 776: 1111 }],
              1111: [[1110, 776]],
              1116: [[1082, 769]],
              1117: [[1080, 768]],
              1118: [[1091, 774]],
              1140: [, , { 783: 1142 }],
              1141: [, , { 783: 1143 }],
              1142: [[1140, 783]],
              1143: [[1141, 783]],
              1155: [, 230],
              1156: [, 230],
              1157: [, 230],
              1158: [, 230],
              1159: [, 230],
              1217: [[1046, 774]],
              1218: [[1078, 774]],
              1232: [[1040, 774]],
              1233: [[1072, 774]],
              1234: [[1040, 776]],
              1235: [[1072, 776]],
              1238: [[1045, 774]],
              1239: [[1077, 774]],
              1240: [, , { 776: 1242 }],
              1241: [, , { 776: 1243 }],
              1242: [[1240, 776]],
              1243: [[1241, 776]],
              1244: [[1046, 776]],
              1245: [[1078, 776]],
              1246: [[1047, 776]],
              1247: [[1079, 776]],
              1250: [[1048, 772]],
              1251: [[1080, 772]],
              1252: [[1048, 776]],
              1253: [[1080, 776]],
              1254: [[1054, 776]],
              1255: [[1086, 776]],
              1256: [, , { 776: 1258 }],
              1257: [, , { 776: 1259 }],
              1258: [[1256, 776]],
              1259: [[1257, 776]],
              1260: [[1069, 776]],
              1261: [[1101, 776]],
              1262: [[1059, 772]],
              1263: [[1091, 772]],
              1264: [[1059, 776]],
              1265: [[1091, 776]],
              1266: [[1059, 779]],
              1267: [[1091, 779]],
              1268: [[1063, 776]],
              1269: [[1095, 776]],
              1272: [[1067, 776]],
              1273: [[1099, 776]],
            },
            1280: {
              1415: [[1381, 1410], 256],
              1425: [, 220],
              1426: [, 230],
              1427: [, 230],
              1428: [, 230],
              1429: [, 230],
              1430: [, 220],
              1431: [, 230],
              1432: [, 230],
              1433: [, 230],
              1434: [, 222],
              1435: [, 220],
              1436: [, 230],
              1437: [, 230],
              1438: [, 230],
              1439: [, 230],
              1440: [, 230],
              1441: [, 230],
              1442: [, 220],
              1443: [, 220],
              1444: [, 220],
              1445: [, 220],
              1446: [, 220],
              1447: [, 220],
              1448: [, 230],
              1449: [, 230],
              1450: [, 220],
              1451: [, 230],
              1452: [, 230],
              1453: [, 222],
              1454: [, 228],
              1455: [, 230],
              1456: [, 10],
              1457: [, 11],
              1458: [, 12],
              1459: [, 13],
              1460: [, 14],
              1461: [, 15],
              1462: [, 16],
              1463: [, 17],
              1464: [, 18],
              1465: [, 19],
              1466: [, 19],
              1467: [, 20],
              1468: [, 21],
              1469: [, 22],
              1471: [, 23],
              1473: [, 24],
              1474: [, 25],
              1476: [, 230],
              1477: [, 220],
              1479: [, 18],
            },
            1536: {
              1552: [, 230],
              1553: [, 230],
              1554: [, 230],
              1555: [, 230],
              1556: [, 230],
              1557: [, 230],
              1558: [, 230],
              1559: [, 230],
              1560: [, 30],
              1561: [, 31],
              1562: [, 32],
              1570: [[1575, 1619]],
              1571: [[1575, 1620]],
              1572: [[1608, 1620]],
              1573: [[1575, 1621]],
              1574: [[1610, 1620]],
              1575: [, , { 1619: 1570, 1620: 1571, 1621: 1573 }],
              1608: [, , { 1620: 1572 }],
              1610: [, , { 1620: 1574 }],
              1611: [, 27],
              1612: [, 28],
              1613: [, 29],
              1614: [, 30],
              1615: [, 31],
              1616: [, 32],
              1617: [, 33],
              1618: [, 34],
              1619: [, 230],
              1620: [, 230],
              1621: [, 220],
              1622: [, 220],
              1623: [, 230],
              1624: [, 230],
              1625: [, 230],
              1626: [, 230],
              1627: [, 230],
              1628: [, 220],
              1629: [, 230],
              1630: [, 230],
              1631: [, 220],
              1648: [, 35],
              1653: [[1575, 1652], 256],
              1654: [[1608, 1652], 256],
              1655: [[1735, 1652], 256],
              1656: [[1610, 1652], 256],
              1728: [[1749, 1620]],
              1729: [, , { 1620: 1730 }],
              1730: [[1729, 1620]],
              1746: [, , { 1620: 1747 }],
              1747: [[1746, 1620]],
              1749: [, , { 1620: 1728 }],
              1750: [, 230],
              1751: [, 230],
              1752: [, 230],
              1753: [, 230],
              1754: [, 230],
              1755: [, 230],
              1756: [, 230],
              1759: [, 230],
              1760: [, 230],
              1761: [, 230],
              1762: [, 230],
              1763: [, 220],
              1764: [, 230],
              1767: [, 230],
              1768: [, 230],
              1770: [, 220],
              1771: [, 230],
              1772: [, 230],
              1773: [, 220],
            },
            1792: {
              1809: [, 36],
              1840: [, 230],
              1841: [, 220],
              1842: [, 230],
              1843: [, 230],
              1844: [, 220],
              1845: [, 230],
              1846: [, 230],
              1847: [, 220],
              1848: [, 220],
              1849: [, 220],
              1850: [, 230],
              1851: [, 220],
              1852: [, 220],
              1853: [, 230],
              1854: [, 220],
              1855: [, 230],
              1856: [, 230],
              1857: [, 230],
              1858: [, 220],
              1859: [, 230],
              1860: [, 220],
              1861: [, 230],
              1862: [, 220],
              1863: [, 230],
              1864: [, 220],
              1865: [, 230],
              1866: [, 230],
              2027: [, 230],
              2028: [, 230],
              2029: [, 230],
              2030: [, 230],
              2031: [, 230],
              2032: [, 230],
              2033: [, 230],
              2034: [, 220],
              2035: [, 230],
            },
            2048: {
              2070: [, 230],
              2071: [, 230],
              2072: [, 230],
              2073: [, 230],
              2075: [, 230],
              2076: [, 230],
              2077: [, 230],
              2078: [, 230],
              2079: [, 230],
              2080: [, 230],
              2081: [, 230],
              2082: [, 230],
              2083: [, 230],
              2085: [, 230],
              2086: [, 230],
              2087: [, 230],
              2089: [, 230],
              2090: [, 230],
              2091: [, 230],
              2092: [, 230],
              2093: [, 230],
              2137: [, 220],
              2138: [, 220],
              2139: [, 220],
              2276: [, 230],
              2277: [, 230],
              2278: [, 220],
              2279: [, 230],
              2280: [, 230],
              2281: [, 220],
              2282: [, 230],
              2283: [, 230],
              2284: [, 230],
              2285: [, 220],
              2286: [, 220],
              2287: [, 220],
              2288: [, 27],
              2289: [, 28],
              2290: [, 29],
              2291: [, 230],
              2292: [, 230],
              2293: [, 230],
              2294: [, 220],
              2295: [, 230],
              2296: [, 230],
              2297: [, 220],
              2298: [, 220],
              2299: [, 230],
              2300: [, 230],
              2301: [, 230],
              2302: [, 230],
              2303: [, 230],
            },
            2304: {
              2344: [, , { 2364: 2345 }],
              2345: [[2344, 2364]],
              2352: [, , { 2364: 2353 }],
              2353: [[2352, 2364]],
              2355: [, , { 2364: 2356 }],
              2356: [[2355, 2364]],
              2364: [, 7],
              2381: [, 9],
              2385: [, 230],
              2386: [, 220],
              2387: [, 230],
              2388: [, 230],
              2392: [[2325, 2364], 512],
              2393: [[2326, 2364], 512],
              2394: [[2327, 2364], 512],
              2395: [[2332, 2364], 512],
              2396: [[2337, 2364], 512],
              2397: [[2338, 2364], 512],
              2398: [[2347, 2364], 512],
              2399: [[2351, 2364], 512],
              2492: [, 7],
              2503: [, , { 2494: 2507, 2519: 2508 }],
              2507: [[2503, 2494]],
              2508: [[2503, 2519]],
              2509: [, 9],
              2524: [[2465, 2492], 512],
              2525: [[2466, 2492], 512],
              2527: [[2479, 2492], 512],
            },
            2560: {
              2611: [[2610, 2620], 512],
              2614: [[2616, 2620], 512],
              2620: [, 7],
              2637: [, 9],
              2649: [[2582, 2620], 512],
              2650: [[2583, 2620], 512],
              2651: [[2588, 2620], 512],
              2654: [[2603, 2620], 512],
              2748: [, 7],
              2765: [, 9],
              68109: [, 220],
              68111: [, 230],
              68152: [, 230],
              68153: [, 1],
              68154: [, 220],
              68159: [, 9],
              68325: [, 230],
              68326: [, 220],
            },
            2816: {
              2876: [, 7],
              2887: [, , { 2878: 2891, 2902: 2888, 2903: 2892 }],
              2888: [[2887, 2902]],
              2891: [[2887, 2878]],
              2892: [[2887, 2903]],
              2893: [, 9],
              2908: [[2849, 2876], 512],
              2909: [[2850, 2876], 512],
              2962: [, , { 3031: 2964 }],
              2964: [[2962, 3031]],
              3014: [, , { 3006: 3018, 3031: 3020 }],
              3015: [, , { 3006: 3019 }],
              3018: [[3014, 3006]],
              3019: [[3015, 3006]],
              3020: [[3014, 3031]],
              3021: [, 9],
            },
            3072: {
              3142: [, , { 3158: 3144 }],
              3144: [[3142, 3158]],
              3149: [, 9],
              3157: [, 84],
              3158: [, 91],
              3260: [, 7],
              3263: [, , { 3285: 3264 }],
              3264: [[3263, 3285]],
              3270: [, , { 3266: 3274, 3285: 3271, 3286: 3272 }],
              3271: [[3270, 3285]],
              3272: [[3270, 3286]],
              3274: [[3270, 3266], , { 3285: 3275 }],
              3275: [[3274, 3285]],
              3277: [, 9],
            },
            3328: {
              3398: [, , { 3390: 3402, 3415: 3404 }],
              3399: [, , { 3390: 3403 }],
              3402: [[3398, 3390]],
              3403: [[3399, 3390]],
              3404: [[3398, 3415]],
              3405: [, 9],
              3530: [, 9],
              3545: [, , { 3530: 3546, 3535: 3548, 3551: 3550 }],
              3546: [[3545, 3530]],
              3548: [[3545, 3535], , { 3530: 3549 }],
              3549: [[3548, 3530]],
              3550: [[3545, 3551]],
            },
            3584: {
              3635: [[3661, 3634], 256],
              3640: [, 103],
              3641: [, 103],
              3642: [, 9],
              3656: [, 107],
              3657: [, 107],
              3658: [, 107],
              3659: [, 107],
              3763: [[3789, 3762], 256],
              3768: [, 118],
              3769: [, 118],
              3784: [, 122],
              3785: [, 122],
              3786: [, 122],
              3787: [, 122],
              3804: [[3755, 3737], 256],
              3805: [[3755, 3745], 256],
            },
            3840: {
              3852: [[3851], 256],
              3864: [, 220],
              3865: [, 220],
              3893: [, 220],
              3895: [, 220],
              3897: [, 216],
              3907: [[3906, 4023], 512],
              3917: [[3916, 4023], 512],
              3922: [[3921, 4023], 512],
              3927: [[3926, 4023], 512],
              3932: [[3931, 4023], 512],
              3945: [[3904, 4021], 512],
              3953: [, 129],
              3954: [, 130],
              3955: [[3953, 3954], 512],
              3956: [, 132],
              3957: [[3953, 3956], 512],
              3958: [[4018, 3968], 512],
              3959: [[4018, 3969], 256],
              3960: [[4019, 3968], 512],
              3961: [[4019, 3969], 256],
              3962: [, 130],
              3963: [, 130],
              3964: [, 130],
              3965: [, 130],
              3968: [, 130],
              3969: [[3953, 3968], 512],
              3970: [, 230],
              3971: [, 230],
              3972: [, 9],
              3974: [, 230],
              3975: [, 230],
              3987: [[3986, 4023], 512],
              3997: [[3996, 4023], 512],
              4002: [[4001, 4023], 512],
              4007: [[4006, 4023], 512],
              4012: [[4011, 4023], 512],
              4025: [[3984, 4021], 512],
              4038: [, 220],
            },
            4096: {
              4133: [, , { 4142: 4134 }],
              4134: [[4133, 4142]],
              4151: [, 7],
              4153: [, 9],
              4154: [, 9],
              4237: [, 220],
              4348: [[4316], 256],
              69702: [, 9],
              69759: [, 9],
              69785: [, , { 69818: 69786 }],
              69786: [[69785, 69818]],
              69787: [, , { 69818: 69788 }],
              69788: [[69787, 69818]],
              69797: [, , { 69818: 69803 }],
              69803: [[69797, 69818]],
              69817: [, 9],
              69818: [, 7],
            },
            4352: {
              69888: [, 230],
              69889: [, 230],
              69890: [, 230],
              69934: [[69937, 69927]],
              69935: [[69938, 69927]],
              69937: [, , { 69927: 69934 }],
              69938: [, , { 69927: 69935 }],
              69939: [, 9],
              69940: [, 9],
              70003: [, 7],
              70080: [, 9],
            },
            4608: { 70197: [, 9], 70198: [, 7], 70377: [, 7], 70378: [, 9] },
            4864: {
              4957: [, 230],
              4958: [, 230],
              4959: [, 230],
              70460: [, 7],
              70471: [, , { 70462: 70475, 70487: 70476 }],
              70475: [[70471, 70462]],
              70476: [[70471, 70487]],
              70477: [, 9],
              70502: [, 230],
              70503: [, 230],
              70504: [, 230],
              70505: [, 230],
              70506: [, 230],
              70507: [, 230],
              70508: [, 230],
              70512: [, 230],
              70513: [, 230],
              70514: [, 230],
              70515: [, 230],
              70516: [, 230],
            },
            5120: {
              70841: [, , { 70832: 70844, 70842: 70843, 70845: 70846 }],
              70843: [[70841, 70842]],
              70844: [[70841, 70832]],
              70846: [[70841, 70845]],
              70850: [, 9],
              70851: [, 7],
            },
            5376: {
              71096: [, , { 71087: 71098 }],
              71097: [, , { 71087: 71099 }],
              71098: [[71096, 71087]],
              71099: [[71097, 71087]],
              71103: [, 9],
              71104: [, 7],
            },
            5632: { 71231: [, 9], 71350: [, 9], 71351: [, 7] },
            5888: { 5908: [, 9], 5940: [, 9], 6098: [, 9], 6109: [, 230] },
            6144: { 6313: [, 228] },
            6400: { 6457: [, 222], 6458: [, 230], 6459: [, 220] },
            6656: {
              6679: [, 230],
              6680: [, 220],
              6752: [, 9],
              6773: [, 230],
              6774: [, 230],
              6775: [, 230],
              6776: [, 230],
              6777: [, 230],
              6778: [, 230],
              6779: [, 230],
              6780: [, 230],
              6783: [, 220],
              6832: [, 230],
              6833: [, 230],
              6834: [, 230],
              6835: [, 230],
              6836: [, 230],
              6837: [, 220],
              6838: [, 220],
              6839: [, 220],
              6840: [, 220],
              6841: [, 220],
              6842: [, 220],
              6843: [, 230],
              6844: [, 230],
              6845: [, 220],
            },
            6912: {
              6917: [, , { 6965: 6918 }],
              6918: [[6917, 6965]],
              6919: [, , { 6965: 6920 }],
              6920: [[6919, 6965]],
              6921: [, , { 6965: 6922 }],
              6922: [[6921, 6965]],
              6923: [, , { 6965: 6924 }],
              6924: [[6923, 6965]],
              6925: [, , { 6965: 6926 }],
              6926: [[6925, 6965]],
              6929: [, , { 6965: 6930 }],
              6930: [[6929, 6965]],
              6964: [, 7],
              6970: [, , { 6965: 6971 }],
              6971: [[6970, 6965]],
              6972: [, , { 6965: 6973 }],
              6973: [[6972, 6965]],
              6974: [, , { 6965: 6976 }],
              6975: [, , { 6965: 6977 }],
              6976: [[6974, 6965]],
              6977: [[6975, 6965]],
              6978: [, , { 6965: 6979 }],
              6979: [[6978, 6965]],
              6980: [, 9],
              7019: [, 230],
              7020: [, 220],
              7021: [, 230],
              7022: [, 230],
              7023: [, 230],
              7024: [, 230],
              7025: [, 230],
              7026: [, 230],
              7027: [, 230],
              7082: [, 9],
              7083: [, 9],
              7142: [, 7],
              7154: [, 9],
              7155: [, 9],
            },
            7168: {
              7223: [, 7],
              7376: [, 230],
              7377: [, 230],
              7378: [, 230],
              7380: [, 1],
              7381: [, 220],
              7382: [, 220],
              7383: [, 220],
              7384: [, 220],
              7385: [, 220],
              7386: [, 230],
              7387: [, 230],
              7388: [, 220],
              7389: [, 220],
              7390: [, 220],
              7391: [, 220],
              7392: [, 230],
              7394: [, 1],
              7395: [, 1],
              7396: [, 1],
              7397: [, 1],
              7398: [, 1],
              7399: [, 1],
              7400: [, 1],
              7405: [, 220],
              7412: [, 230],
              7416: [, 230],
              7417: [, 230],
            },
            7424: {
              7468: [[65], 256],
              7469: [[198], 256],
              7470: [[66], 256],
              7472: [[68], 256],
              7473: [[69], 256],
              7474: [[398], 256],
              7475: [[71], 256],
              7476: [[72], 256],
              7477: [[73], 256],
              7478: [[74], 256],
              7479: [[75], 256],
              7480: [[76], 256],
              7481: [[77], 256],
              7482: [[78], 256],
              7484: [[79], 256],
              7485: [[546], 256],
              7486: [[80], 256],
              7487: [[82], 256],
              7488: [[84], 256],
              7489: [[85], 256],
              7490: [[87], 256],
              7491: [[97], 256],
              7492: [[592], 256],
              7493: [[593], 256],
              7494: [[7426], 256],
              7495: [[98], 256],
              7496: [[100], 256],
              7497: [[101], 256],
              7498: [[601], 256],
              7499: [[603], 256],
              7500: [[604], 256],
              7501: [[103], 256],
              7503: [[107], 256],
              7504: [[109], 256],
              7505: [[331], 256],
              7506: [[111], 256],
              7507: [[596], 256],
              7508: [[7446], 256],
              7509: [[7447], 256],
              7510: [[112], 256],
              7511: [[116], 256],
              7512: [[117], 256],
              7513: [[7453], 256],
              7514: [[623], 256],
              7515: [[118], 256],
              7516: [[7461], 256],
              7517: [[946], 256],
              7518: [[947], 256],
              7519: [[948], 256],
              7520: [[966], 256],
              7521: [[967], 256],
              7522: [[105], 256],
              7523: [[114], 256],
              7524: [[117], 256],
              7525: [[118], 256],
              7526: [[946], 256],
              7527: [[947], 256],
              7528: [[961], 256],
              7529: [[966], 256],
              7530: [[967], 256],
              7544: [[1085], 256],
              7579: [[594], 256],
              7580: [[99], 256],
              7581: [[597], 256],
              7582: [[240], 256],
              7583: [[604], 256],
              7584: [[102], 256],
              7585: [[607], 256],
              7586: [[609], 256],
              7587: [[613], 256],
              7588: [[616], 256],
              7589: [[617], 256],
              7590: [[618], 256],
              7591: [[7547], 256],
              7592: [[669], 256],
              7593: [[621], 256],
              7594: [[7557], 256],
              7595: [[671], 256],
              7596: [[625], 256],
              7597: [[624], 256],
              7598: [[626], 256],
              7599: [[627], 256],
              7600: [[628], 256],
              7601: [[629], 256],
              7602: [[632], 256],
              7603: [[642], 256],
              7604: [[643], 256],
              7605: [[427], 256],
              7606: [[649], 256],
              7607: [[650], 256],
              7608: [[7452], 256],
              7609: [[651], 256],
              7610: [[652], 256],
              7611: [[122], 256],
              7612: [[656], 256],
              7613: [[657], 256],
              7614: [[658], 256],
              7615: [[952], 256],
              7616: [, 230],
              7617: [, 230],
              7618: [, 220],
              7619: [, 230],
              7620: [, 230],
              7621: [, 230],
              7622: [, 230],
              7623: [, 230],
              7624: [, 230],
              7625: [, 230],
              7626: [, 220],
              7627: [, 230],
              7628: [, 230],
              7629: [, 234],
              7630: [, 214],
              7631: [, 220],
              7632: [, 202],
              7633: [, 230],
              7634: [, 230],
              7635: [, 230],
              7636: [, 230],
              7637: [, 230],
              7638: [, 230],
              7639: [, 230],
              7640: [, 230],
              7641: [, 230],
              7642: [, 230],
              7643: [, 230],
              7644: [, 230],
              7645: [, 230],
              7646: [, 230],
              7647: [, 230],
              7648: [, 230],
              7649: [, 230],
              7650: [, 230],
              7651: [, 230],
              7652: [, 230],
              7653: [, 230],
              7654: [, 230],
              7655: [, 230],
              7656: [, 230],
              7657: [, 230],
              7658: [, 230],
              7659: [, 230],
              7660: [, 230],
              7661: [, 230],
              7662: [, 230],
              7663: [, 230],
              7664: [, 230],
              7665: [, 230],
              7666: [, 230],
              7667: [, 230],
              7668: [, 230],
              7669: [, 230],
              7676: [, 233],
              7677: [, 220],
              7678: [, 230],
              7679: [, 220],
            },
            7680: {
              7680: [[65, 805]],
              7681: [[97, 805]],
              7682: [[66, 775]],
              7683: [[98, 775]],
              7684: [[66, 803]],
              7685: [[98, 803]],
              7686: [[66, 817]],
              7687: [[98, 817]],
              7688: [[199, 769]],
              7689: [[231, 769]],
              7690: [[68, 775]],
              7691: [[100, 775]],
              7692: [[68, 803]],
              7693: [[100, 803]],
              7694: [[68, 817]],
              7695: [[100, 817]],
              7696: [[68, 807]],
              7697: [[100, 807]],
              7698: [[68, 813]],
              7699: [[100, 813]],
              7700: [[274, 768]],
              7701: [[275, 768]],
              7702: [[274, 769]],
              7703: [[275, 769]],
              7704: [[69, 813]],
              7705: [[101, 813]],
              7706: [[69, 816]],
              7707: [[101, 816]],
              7708: [[552, 774]],
              7709: [[553, 774]],
              7710: [[70, 775]],
              7711: [[102, 775]],
              7712: [[71, 772]],
              7713: [[103, 772]],
              7714: [[72, 775]],
              7715: [[104, 775]],
              7716: [[72, 803]],
              7717: [[104, 803]],
              7718: [[72, 776]],
              7719: [[104, 776]],
              7720: [[72, 807]],
              7721: [[104, 807]],
              7722: [[72, 814]],
              7723: [[104, 814]],
              7724: [[73, 816]],
              7725: [[105, 816]],
              7726: [[207, 769]],
              7727: [[239, 769]],
              7728: [[75, 769]],
              7729: [[107, 769]],
              7730: [[75, 803]],
              7731: [[107, 803]],
              7732: [[75, 817]],
              7733: [[107, 817]],
              7734: [[76, 803], , { 772: 7736 }],
              7735: [[108, 803], , { 772: 7737 }],
              7736: [[7734, 772]],
              7737: [[7735, 772]],
              7738: [[76, 817]],
              7739: [[108, 817]],
              7740: [[76, 813]],
              7741: [[108, 813]],
              7742: [[77, 769]],
              7743: [[109, 769]],
              7744: [[77, 775]],
              7745: [[109, 775]],
              7746: [[77, 803]],
              7747: [[109, 803]],
              7748: [[78, 775]],
              7749: [[110, 775]],
              7750: [[78, 803]],
              7751: [[110, 803]],
              7752: [[78, 817]],
              7753: [[110, 817]],
              7754: [[78, 813]],
              7755: [[110, 813]],
              7756: [[213, 769]],
              7757: [[245, 769]],
              7758: [[213, 776]],
              7759: [[245, 776]],
              7760: [[332, 768]],
              7761: [[333, 768]],
              7762: [[332, 769]],
              7763: [[333, 769]],
              7764: [[80, 769]],
              7765: [[112, 769]],
              7766: [[80, 775]],
              7767: [[112, 775]],
              7768: [[82, 775]],
              7769: [[114, 775]],
              7770: [[82, 803], , { 772: 7772 }],
              7771: [[114, 803], , { 772: 7773 }],
              7772: [[7770, 772]],
              7773: [[7771, 772]],
              7774: [[82, 817]],
              7775: [[114, 817]],
              7776: [[83, 775]],
              7777: [[115, 775]],
              7778: [[83, 803], , { 775: 7784 }],
              7779: [[115, 803], , { 775: 7785 }],
              7780: [[346, 775]],
              7781: [[347, 775]],
              7782: [[352, 775]],
              7783: [[353, 775]],
              7784: [[7778, 775]],
              7785: [[7779, 775]],
              7786: [[84, 775]],
              7787: [[116, 775]],
              7788: [[84, 803]],
              7789: [[116, 803]],
              7790: [[84, 817]],
              7791: [[116, 817]],
              7792: [[84, 813]],
              7793: [[116, 813]],
              7794: [[85, 804]],
              7795: [[117, 804]],
              7796: [[85, 816]],
              7797: [[117, 816]],
              7798: [[85, 813]],
              7799: [[117, 813]],
              7800: [[360, 769]],
              7801: [[361, 769]],
              7802: [[362, 776]],
              7803: [[363, 776]],
              7804: [[86, 771]],
              7805: [[118, 771]],
              7806: [[86, 803]],
              7807: [[118, 803]],
              7808: [[87, 768]],
              7809: [[119, 768]],
              7810: [[87, 769]],
              7811: [[119, 769]],
              7812: [[87, 776]],
              7813: [[119, 776]],
              7814: [[87, 775]],
              7815: [[119, 775]],
              7816: [[87, 803]],
              7817: [[119, 803]],
              7818: [[88, 775]],
              7819: [[120, 775]],
              7820: [[88, 776]],
              7821: [[120, 776]],
              7822: [[89, 775]],
              7823: [[121, 775]],
              7824: [[90, 770]],
              7825: [[122, 770]],
              7826: [[90, 803]],
              7827: [[122, 803]],
              7828: [[90, 817]],
              7829: [[122, 817]],
              7830: [[104, 817]],
              7831: [[116, 776]],
              7832: [[119, 778]],
              7833: [[121, 778]],
              7834: [[97, 702], 256],
              7835: [[383, 775]],
              7840: [[65, 803], , { 770: 7852, 774: 7862 }],
              7841: [[97, 803], , { 770: 7853, 774: 7863 }],
              7842: [[65, 777]],
              7843: [[97, 777]],
              7844: [[194, 769]],
              7845: [[226, 769]],
              7846: [[194, 768]],
              7847: [[226, 768]],
              7848: [[194, 777]],
              7849: [[226, 777]],
              7850: [[194, 771]],
              7851: [[226, 771]],
              7852: [[7840, 770]],
              7853: [[7841, 770]],
              7854: [[258, 769]],
              7855: [[259, 769]],
              7856: [[258, 768]],
              7857: [[259, 768]],
              7858: [[258, 777]],
              7859: [[259, 777]],
              7860: [[258, 771]],
              7861: [[259, 771]],
              7862: [[7840, 774]],
              7863: [[7841, 774]],
              7864: [[69, 803], , { 770: 7878 }],
              7865: [[101, 803], , { 770: 7879 }],
              7866: [[69, 777]],
              7867: [[101, 777]],
              7868: [[69, 771]],
              7869: [[101, 771]],
              7870: [[202, 769]],
              7871: [[234, 769]],
              7872: [[202, 768]],
              7873: [[234, 768]],
              7874: [[202, 777]],
              7875: [[234, 777]],
              7876: [[202, 771]],
              7877: [[234, 771]],
              7878: [[7864, 770]],
              7879: [[7865, 770]],
              7880: [[73, 777]],
              7881: [[105, 777]],
              7882: [[73, 803]],
              7883: [[105, 803]],
              7884: [[79, 803], , { 770: 7896 }],
              7885: [[111, 803], , { 770: 7897 }],
              7886: [[79, 777]],
              7887: [[111, 777]],
              7888: [[212, 769]],
              7889: [[244, 769]],
              7890: [[212, 768]],
              7891: [[244, 768]],
              7892: [[212, 777]],
              7893: [[244, 777]],
              7894: [[212, 771]],
              7895: [[244, 771]],
              7896: [[7884, 770]],
              7897: [[7885, 770]],
              7898: [[416, 769]],
              7899: [[417, 769]],
              7900: [[416, 768]],
              7901: [[417, 768]],
              7902: [[416, 777]],
              7903: [[417, 777]],
              7904: [[416, 771]],
              7905: [[417, 771]],
              7906: [[416, 803]],
              7907: [[417, 803]],
              7908: [[85, 803]],
              7909: [[117, 803]],
              7910: [[85, 777]],
              7911: [[117, 777]],
              7912: [[431, 769]],
              7913: [[432, 769]],
              7914: [[431, 768]],
              7915: [[432, 768]],
              7916: [[431, 777]],
              7917: [[432, 777]],
              7918: [[431, 771]],
              7919: [[432, 771]],
              7920: [[431, 803]],
              7921: [[432, 803]],
              7922: [[89, 768]],
              7923: [[121, 768]],
              7924: [[89, 803]],
              7925: [[121, 803]],
              7926: [[89, 777]],
              7927: [[121, 777]],
              7928: [[89, 771]],
              7929: [[121, 771]],
            },
            7936: {
              7936: [
                [945, 787],
                ,
                { 768: 7938, 769: 7940, 834: 7942, 837: 8064 },
              ],
              7937: [
                [945, 788],
                ,
                { 768: 7939, 769: 7941, 834: 7943, 837: 8065 },
              ],
              7938: [[7936, 768], , { 837: 8066 }],
              7939: [[7937, 768], , { 837: 8067 }],
              7940: [[7936, 769], , { 837: 8068 }],
              7941: [[7937, 769], , { 837: 8069 }],
              7942: [[7936, 834], , { 837: 8070 }],
              7943: [[7937, 834], , { 837: 8071 }],
              7944: [
                [913, 787],
                ,
                { 768: 7946, 769: 7948, 834: 7950, 837: 8072 },
              ],
              7945: [
                [913, 788],
                ,
                { 768: 7947, 769: 7949, 834: 7951, 837: 8073 },
              ],
              7946: [[7944, 768], , { 837: 8074 }],
              7947: [[7945, 768], , { 837: 8075 }],
              7948: [[7944, 769], , { 837: 8076 }],
              7949: [[7945, 769], , { 837: 8077 }],
              7950: [[7944, 834], , { 837: 8078 }],
              7951: [[7945, 834], , { 837: 8079 }],
              7952: [[949, 787], , { 768: 7954, 769: 7956 }],
              7953: [[949, 788], , { 768: 7955, 769: 7957 }],
              7954: [[7952, 768]],
              7955: [[7953, 768]],
              7956: [[7952, 769]],
              7957: [[7953, 769]],
              7960: [[917, 787], , { 768: 7962, 769: 7964 }],
              7961: [[917, 788], , { 768: 7963, 769: 7965 }],
              7962: [[7960, 768]],
              7963: [[7961, 768]],
              7964: [[7960, 769]],
              7965: [[7961, 769]],
              7968: [
                [951, 787],
                ,
                { 768: 7970, 769: 7972, 834: 7974, 837: 8080 },
              ],
              7969: [
                [951, 788],
                ,
                { 768: 7971, 769: 7973, 834: 7975, 837: 8081 },
              ],
              7970: [[7968, 768], , { 837: 8082 }],
              7971: [[7969, 768], , { 837: 8083 }],
              7972: [[7968, 769], , { 837: 8084 }],
              7973: [[7969, 769], , { 837: 8085 }],
              7974: [[7968, 834], , { 837: 8086 }],
              7975: [[7969, 834], , { 837: 8087 }],
              7976: [
                [919, 787],
                ,
                { 768: 7978, 769: 7980, 834: 7982, 837: 8088 },
              ],
              7977: [
                [919, 788],
                ,
                { 768: 7979, 769: 7981, 834: 7983, 837: 8089 },
              ],
              7978: [[7976, 768], , { 837: 8090 }],
              7979: [[7977, 768], , { 837: 8091 }],
              7980: [[7976, 769], , { 837: 8092 }],
              7981: [[7977, 769], , { 837: 8093 }],
              7982: [[7976, 834], , { 837: 8094 }],
              7983: [[7977, 834], , { 837: 8095 }],
              7984: [[953, 787], , { 768: 7986, 769: 7988, 834: 7990 }],
              7985: [[953, 788], , { 768: 7987, 769: 7989, 834: 7991 }],
              7986: [[7984, 768]],
              7987: [[7985, 768]],
              7988: [[7984, 769]],
              7989: [[7985, 769]],
              7990: [[7984, 834]],
              7991: [[7985, 834]],
              7992: [[921, 787], , { 768: 7994, 769: 7996, 834: 7998 }],
              7993: [[921, 788], , { 768: 7995, 769: 7997, 834: 7999 }],
              7994: [[7992, 768]],
              7995: [[7993, 768]],
              7996: [[7992, 769]],
              7997: [[7993, 769]],
              7998: [[7992, 834]],
              7999: [[7993, 834]],
              8000: [[959, 787], , { 768: 8002, 769: 8004 }],
              8001: [[959, 788], , { 768: 8003, 769: 8005 }],
              8002: [[8e3, 768]],
              8003: [[8001, 768]],
              8004: [[8e3, 769]],
              8005: [[8001, 769]],
              8008: [[927, 787], , { 768: 8010, 769: 8012 }],
              8009: [[927, 788], , { 768: 8011, 769: 8013 }],
              8010: [[8008, 768]],
              8011: [[8009, 768]],
              8012: [[8008, 769]],
              8013: [[8009, 769]],
              8016: [[965, 787], , { 768: 8018, 769: 8020, 834: 8022 }],
              8017: [[965, 788], , { 768: 8019, 769: 8021, 834: 8023 }],
              8018: [[8016, 768]],
              8019: [[8017, 768]],
              8020: [[8016, 769]],
              8021: [[8017, 769]],
              8022: [[8016, 834]],
              8023: [[8017, 834]],
              8025: [[933, 788], , { 768: 8027, 769: 8029, 834: 8031 }],
              8027: [[8025, 768]],
              8029: [[8025, 769]],
              8031: [[8025, 834]],
              8032: [
                [969, 787],
                ,
                { 768: 8034, 769: 8036, 834: 8038, 837: 8096 },
              ],
              8033: [
                [969, 788],
                ,
                { 768: 8035, 769: 8037, 834: 8039, 837: 8097 },
              ],
              8034: [[8032, 768], , { 837: 8098 }],
              8035: [[8033, 768], , { 837: 8099 }],
              8036: [[8032, 769], , { 837: 8100 }],
              8037: [[8033, 769], , { 837: 8101 }],
              8038: [[8032, 834], , { 837: 8102 }],
              8039: [[8033, 834], , { 837: 8103 }],
              8040: [
                [937, 787],
                ,
                { 768: 8042, 769: 8044, 834: 8046, 837: 8104 },
              ],
              8041: [
                [937, 788],
                ,
                { 768: 8043, 769: 8045, 834: 8047, 837: 8105 },
              ],
              8042: [[8040, 768], , { 837: 8106 }],
              8043: [[8041, 768], , { 837: 8107 }],
              8044: [[8040, 769], , { 837: 8108 }],
              8045: [[8041, 769], , { 837: 8109 }],
              8046: [[8040, 834], , { 837: 8110 }],
              8047: [[8041, 834], , { 837: 8111 }],
              8048: [[945, 768], , { 837: 8114 }],
              8049: [[940]],
              8050: [[949, 768]],
              8051: [[941]],
              8052: [[951, 768], , { 837: 8130 }],
              8053: [[942]],
              8054: [[953, 768]],
              8055: [[943]],
              8056: [[959, 768]],
              8057: [[972]],
              8058: [[965, 768]],
              8059: [[973]],
              8060: [[969, 768], , { 837: 8178 }],
              8061: [[974]],
              8064: [[7936, 837]],
              8065: [[7937, 837]],
              8066: [[7938, 837]],
              8067: [[7939, 837]],
              8068: [[7940, 837]],
              8069: [[7941, 837]],
              8070: [[7942, 837]],
              8071: [[7943, 837]],
              8072: [[7944, 837]],
              8073: [[7945, 837]],
              8074: [[7946, 837]],
              8075: [[7947, 837]],
              8076: [[7948, 837]],
              8077: [[7949, 837]],
              8078: [[7950, 837]],
              8079: [[7951, 837]],
              8080: [[7968, 837]],
              8081: [[7969, 837]],
              8082: [[7970, 837]],
              8083: [[7971, 837]],
              8084: [[7972, 837]],
              8085: [[7973, 837]],
              8086: [[7974, 837]],
              8087: [[7975, 837]],
              8088: [[7976, 837]],
              8089: [[7977, 837]],
              8090: [[7978, 837]],
              8091: [[7979, 837]],
              8092: [[7980, 837]],
              8093: [[7981, 837]],
              8094: [[7982, 837]],
              8095: [[7983, 837]],
              8096: [[8032, 837]],
              8097: [[8033, 837]],
              8098: [[8034, 837]],
              8099: [[8035, 837]],
              8100: [[8036, 837]],
              8101: [[8037, 837]],
              8102: [[8038, 837]],
              8103: [[8039, 837]],
              8104: [[8040, 837]],
              8105: [[8041, 837]],
              8106: [[8042, 837]],
              8107: [[8043, 837]],
              8108: [[8044, 837]],
              8109: [[8045, 837]],
              8110: [[8046, 837]],
              8111: [[8047, 837]],
              8112: [[945, 774]],
              8113: [[945, 772]],
              8114: [[8048, 837]],
              8115: [[945, 837]],
              8116: [[940, 837]],
              8118: [[945, 834], , { 837: 8119 }],
              8119: [[8118, 837]],
              8120: [[913, 774]],
              8121: [[913, 772]],
              8122: [[913, 768]],
              8123: [[902]],
              8124: [[913, 837]],
              8125: [[32, 787], 256],
              8126: [[953]],
              8127: [[32, 787], 256, { 768: 8141, 769: 8142, 834: 8143 }],
              8128: [[32, 834], 256],
              8129: [[168, 834]],
              8130: [[8052, 837]],
              8131: [[951, 837]],
              8132: [[942, 837]],
              8134: [[951, 834], , { 837: 8135 }],
              8135: [[8134, 837]],
              8136: [[917, 768]],
              8137: [[904]],
              8138: [[919, 768]],
              8139: [[905]],
              8140: [[919, 837]],
              8141: [[8127, 768]],
              8142: [[8127, 769]],
              8143: [[8127, 834]],
              8144: [[953, 774]],
              8145: [[953, 772]],
              8146: [[970, 768]],
              8147: [[912]],
              8150: [[953, 834]],
              8151: [[970, 834]],
              8152: [[921, 774]],
              8153: [[921, 772]],
              8154: [[921, 768]],
              8155: [[906]],
              8157: [[8190, 768]],
              8158: [[8190, 769]],
              8159: [[8190, 834]],
              8160: [[965, 774]],
              8161: [[965, 772]],
              8162: [[971, 768]],
              8163: [[944]],
              8164: [[961, 787]],
              8165: [[961, 788]],
              8166: [[965, 834]],
              8167: [[971, 834]],
              8168: [[933, 774]],
              8169: [[933, 772]],
              8170: [[933, 768]],
              8171: [[910]],
              8172: [[929, 788]],
              8173: [[168, 768]],
              8174: [[901]],
              8175: [[96]],
              8178: [[8060, 837]],
              8179: [[969, 837]],
              8180: [[974, 837]],
              8182: [[969, 834], , { 837: 8183 }],
              8183: [[8182, 837]],
              8184: [[927, 768]],
              8185: [[908]],
              8186: [[937, 768]],
              8187: [[911]],
              8188: [[937, 837]],
              8189: [[180]],
              8190: [[32, 788], 256, { 768: 8157, 769: 8158, 834: 8159 }],
            },
            8192: {
              8192: [[8194]],
              8193: [[8195]],
              8194: [[32], 256],
              8195: [[32], 256],
              8196: [[32], 256],
              8197: [[32], 256],
              8198: [[32], 256],
              8199: [[32], 256],
              8200: [[32], 256],
              8201: [[32], 256],
              8202: [[32], 256],
              8209: [[8208], 256],
              8215: [[32, 819], 256],
              8228: [[46], 256],
              8229: [[46, 46], 256],
              8230: [[46, 46, 46], 256],
              8239: [[32], 256],
              8243: [[8242, 8242], 256],
              8244: [[8242, 8242, 8242], 256],
              8246: [[8245, 8245], 256],
              8247: [[8245, 8245, 8245], 256],
              8252: [[33, 33], 256],
              8254: [[32, 773], 256],
              8263: [[63, 63], 256],
              8264: [[63, 33], 256],
              8265: [[33, 63], 256],
              8279: [[8242, 8242, 8242, 8242], 256],
              8287: [[32], 256],
              8304: [[48], 256],
              8305: [[105], 256],
              8308: [[52], 256],
              8309: [[53], 256],
              8310: [[54], 256],
              8311: [[55], 256],
              8312: [[56], 256],
              8313: [[57], 256],
              8314: [[43], 256],
              8315: [[8722], 256],
              8316: [[61], 256],
              8317: [[40], 256],
              8318: [[41], 256],
              8319: [[110], 256],
              8320: [[48], 256],
              8321: [[49], 256],
              8322: [[50], 256],
              8323: [[51], 256],
              8324: [[52], 256],
              8325: [[53], 256],
              8326: [[54], 256],
              8327: [[55], 256],
              8328: [[56], 256],
              8329: [[57], 256],
              8330: [[43], 256],
              8331: [[8722], 256],
              8332: [[61], 256],
              8333: [[40], 256],
              8334: [[41], 256],
              8336: [[97], 256],
              8337: [[101], 256],
              8338: [[111], 256],
              8339: [[120], 256],
              8340: [[601], 256],
              8341: [[104], 256],
              8342: [[107], 256],
              8343: [[108], 256],
              8344: [[109], 256],
              8345: [[110], 256],
              8346: [[112], 256],
              8347: [[115], 256],
              8348: [[116], 256],
              8360: [[82, 115], 256],
              8400: [, 230],
              8401: [, 230],
              8402: [, 1],
              8403: [, 1],
              8404: [, 230],
              8405: [, 230],
              8406: [, 230],
              8407: [, 230],
              8408: [, 1],
              8409: [, 1],
              8410: [, 1],
              8411: [, 230],
              8412: [, 230],
              8417: [, 230],
              8421: [, 1],
              8422: [, 1],
              8423: [, 230],
              8424: [, 220],
              8425: [, 230],
              8426: [, 1],
              8427: [, 1],
              8428: [, 220],
              8429: [, 220],
              8430: [, 220],
              8431: [, 220],
              8432: [, 230],
            },
            8448: {
              8448: [[97, 47, 99], 256],
              8449: [[97, 47, 115], 256],
              8450: [[67], 256],
              8451: [[176, 67], 256],
              8453: [[99, 47, 111], 256],
              8454: [[99, 47, 117], 256],
              8455: [[400], 256],
              8457: [[176, 70], 256],
              8458: [[103], 256],
              8459: [[72], 256],
              8460: [[72], 256],
              8461: [[72], 256],
              8462: [[104], 256],
              8463: [[295], 256],
              8464: [[73], 256],
              8465: [[73], 256],
              8466: [[76], 256],
              8467: [[108], 256],
              8469: [[78], 256],
              8470: [[78, 111], 256],
              8473: [[80], 256],
              8474: [[81], 256],
              8475: [[82], 256],
              8476: [[82], 256],
              8477: [[82], 256],
              8480: [[83, 77], 256],
              8481: [[84, 69, 76], 256],
              8482: [[84, 77], 256],
              8484: [[90], 256],
              8486: [[937]],
              8488: [[90], 256],
              8490: [[75]],
              8491: [[197]],
              8492: [[66], 256],
              8493: [[67], 256],
              8495: [[101], 256],
              8496: [[69], 256],
              8497: [[70], 256],
              8499: [[77], 256],
              8500: [[111], 256],
              8501: [[1488], 256],
              8502: [[1489], 256],
              8503: [[1490], 256],
              8504: [[1491], 256],
              8505: [[105], 256],
              8507: [[70, 65, 88], 256],
              8508: [[960], 256],
              8509: [[947], 256],
              8510: [[915], 256],
              8511: [[928], 256],
              8512: [[8721], 256],
              8517: [[68], 256],
              8518: [[100], 256],
              8519: [[101], 256],
              8520: [[105], 256],
              8521: [[106], 256],
              8528: [[49, 8260, 55], 256],
              8529: [[49, 8260, 57], 256],
              8530: [[49, 8260, 49, 48], 256],
              8531: [[49, 8260, 51], 256],
              8532: [[50, 8260, 51], 256],
              8533: [[49, 8260, 53], 256],
              8534: [[50, 8260, 53], 256],
              8535: [[51, 8260, 53], 256],
              8536: [[52, 8260, 53], 256],
              8537: [[49, 8260, 54], 256],
              8538: [[53, 8260, 54], 256],
              8539: [[49, 8260, 56], 256],
              8540: [[51, 8260, 56], 256],
              8541: [[53, 8260, 56], 256],
              8542: [[55, 8260, 56], 256],
              8543: [[49, 8260], 256],
              8544: [[73], 256],
              8545: [[73, 73], 256],
              8546: [[73, 73, 73], 256],
              8547: [[73, 86], 256],
              8548: [[86], 256],
              8549: [[86, 73], 256],
              8550: [[86, 73, 73], 256],
              8551: [[86, 73, 73, 73], 256],
              8552: [[73, 88], 256],
              8553: [[88], 256],
              8554: [[88, 73], 256],
              8555: [[88, 73, 73], 256],
              8556: [[76], 256],
              8557: [[67], 256],
              8558: [[68], 256],
              8559: [[77], 256],
              8560: [[105], 256],
              8561: [[105, 105], 256],
              8562: [[105, 105, 105], 256],
              8563: [[105, 118], 256],
              8564: [[118], 256],
              8565: [[118, 105], 256],
              8566: [[118, 105, 105], 256],
              8567: [[118, 105, 105, 105], 256],
              8568: [[105, 120], 256],
              8569: [[120], 256],
              8570: [[120, 105], 256],
              8571: [[120, 105, 105], 256],
              8572: [[108], 256],
              8573: [[99], 256],
              8574: [[100], 256],
              8575: [[109], 256],
              8585: [[48, 8260, 51], 256],
              8592: [, , { 824: 8602 }],
              8594: [, , { 824: 8603 }],
              8596: [, , { 824: 8622 }],
              8602: [[8592, 824]],
              8603: [[8594, 824]],
              8622: [[8596, 824]],
              8653: [[8656, 824]],
              8654: [[8660, 824]],
              8655: [[8658, 824]],
              8656: [, , { 824: 8653 }],
              8658: [, , { 824: 8655 }],
              8660: [, , { 824: 8654 }],
            },
            8704: {
              8707: [, , { 824: 8708 }],
              8708: [[8707, 824]],
              8712: [, , { 824: 8713 }],
              8713: [[8712, 824]],
              8715: [, , { 824: 8716 }],
              8716: [[8715, 824]],
              8739: [, , { 824: 8740 }],
              8740: [[8739, 824]],
              8741: [, , { 824: 8742 }],
              8742: [[8741, 824]],
              8748: [[8747, 8747], 256],
              8749: [[8747, 8747, 8747], 256],
              8751: [[8750, 8750], 256],
              8752: [[8750, 8750, 8750], 256],
              8764: [, , { 824: 8769 }],
              8769: [[8764, 824]],
              8771: [, , { 824: 8772 }],
              8772: [[8771, 824]],
              8773: [, , { 824: 8775 }],
              8775: [[8773, 824]],
              8776: [, , { 824: 8777 }],
              8777: [[8776, 824]],
              8781: [, , { 824: 8813 }],
              8800: [[61, 824]],
              8801: [, , { 824: 8802 }],
              8802: [[8801, 824]],
              8804: [, , { 824: 8816 }],
              8805: [, , { 824: 8817 }],
              8813: [[8781, 824]],
              8814: [[60, 824]],
              8815: [[62, 824]],
              8816: [[8804, 824]],
              8817: [[8805, 824]],
              8818: [, , { 824: 8820 }],
              8819: [, , { 824: 8821 }],
              8820: [[8818, 824]],
              8821: [[8819, 824]],
              8822: [, , { 824: 8824 }],
              8823: [, , { 824: 8825 }],
              8824: [[8822, 824]],
              8825: [[8823, 824]],
              8826: [, , { 824: 8832 }],
              8827: [, , { 824: 8833 }],
              8828: [, , { 824: 8928 }],
              8829: [, , { 824: 8929 }],
              8832: [[8826, 824]],
              8833: [[8827, 824]],
              8834: [, , { 824: 8836 }],
              8835: [, , { 824: 8837 }],
              8836: [[8834, 824]],
              8837: [[8835, 824]],
              8838: [, , { 824: 8840 }],
              8839: [, , { 824: 8841 }],
              8840: [[8838, 824]],
              8841: [[8839, 824]],
              8849: [, , { 824: 8930 }],
              8850: [, , { 824: 8931 }],
              8866: [, , { 824: 8876 }],
              8872: [, , { 824: 8877 }],
              8873: [, , { 824: 8878 }],
              8875: [, , { 824: 8879 }],
              8876: [[8866, 824]],
              8877: [[8872, 824]],
              8878: [[8873, 824]],
              8879: [[8875, 824]],
              8882: [, , { 824: 8938 }],
              8883: [, , { 824: 8939 }],
              8884: [, , { 824: 8940 }],
              8885: [, , { 824: 8941 }],
              8928: [[8828, 824]],
              8929: [[8829, 824]],
              8930: [[8849, 824]],
              8931: [[8850, 824]],
              8938: [[8882, 824]],
              8939: [[8883, 824]],
              8940: [[8884, 824]],
              8941: [[8885, 824]],
            },
            8960: { 9001: [[12296]], 9002: [[12297]] },
            9216: {
              9312: [[49], 256],
              9313: [[50], 256],
              9314: [[51], 256],
              9315: [[52], 256],
              9316: [[53], 256],
              9317: [[54], 256],
              9318: [[55], 256],
              9319: [[56], 256],
              9320: [[57], 256],
              9321: [[49, 48], 256],
              9322: [[49, 49], 256],
              9323: [[49, 50], 256],
              9324: [[49, 51], 256],
              9325: [[49, 52], 256],
              9326: [[49, 53], 256],
              9327: [[49, 54], 256],
              9328: [[49, 55], 256],
              9329: [[49, 56], 256],
              9330: [[49, 57], 256],
              9331: [[50, 48], 256],
              9332: [[40, 49, 41], 256],
              9333: [[40, 50, 41], 256],
              9334: [[40, 51, 41], 256],
              9335: [[40, 52, 41], 256],
              9336: [[40, 53, 41], 256],
              9337: [[40, 54, 41], 256],
              9338: [[40, 55, 41], 256],
              9339: [[40, 56, 41], 256],
              9340: [[40, 57, 41], 256],
              9341: [[40, 49, 48, 41], 256],
              9342: [[40, 49, 49, 41], 256],
              9343: [[40, 49, 50, 41], 256],
              9344: [[40, 49, 51, 41], 256],
              9345: [[40, 49, 52, 41], 256],
              9346: [[40, 49, 53, 41], 256],
              9347: [[40, 49, 54, 41], 256],
              9348: [[40, 49, 55, 41], 256],
              9349: [[40, 49, 56, 41], 256],
              9350: [[40, 49, 57, 41], 256],
              9351: [[40, 50, 48, 41], 256],
              9352: [[49, 46], 256],
              9353: [[50, 46], 256],
              9354: [[51, 46], 256],
              9355: [[52, 46], 256],
              9356: [[53, 46], 256],
              9357: [[54, 46], 256],
              9358: [[55, 46], 256],
              9359: [[56, 46], 256],
              9360: [[57, 46], 256],
              9361: [[49, 48, 46], 256],
              9362: [[49, 49, 46], 256],
              9363: [[49, 50, 46], 256],
              9364: [[49, 51, 46], 256],
              9365: [[49, 52, 46], 256],
              9366: [[49, 53, 46], 256],
              9367: [[49, 54, 46], 256],
              9368: [[49, 55, 46], 256],
              9369: [[49, 56, 46], 256],
              9370: [[49, 57, 46], 256],
              9371: [[50, 48, 46], 256],
              9372: [[40, 97, 41], 256],
              9373: [[40, 98, 41], 256],
              9374: [[40, 99, 41], 256],
              9375: [[40, 100, 41], 256],
              9376: [[40, 101, 41], 256],
              9377: [[40, 102, 41], 256],
              9378: [[40, 103, 41], 256],
              9379: [[40, 104, 41], 256],
              9380: [[40, 105, 41], 256],
              9381: [[40, 106, 41], 256],
              9382: [[40, 107, 41], 256],
              9383: [[40, 108, 41], 256],
              9384: [[40, 109, 41], 256],
              9385: [[40, 110, 41], 256],
              9386: [[40, 111, 41], 256],
              9387: [[40, 112, 41], 256],
              9388: [[40, 113, 41], 256],
              9389: [[40, 114, 41], 256],
              9390: [[40, 115, 41], 256],
              9391: [[40, 116, 41], 256],
              9392: [[40, 117, 41], 256],
              9393: [[40, 118, 41], 256],
              9394: [[40, 119, 41], 256],
              9395: [[40, 120, 41], 256],
              9396: [[40, 121, 41], 256],
              9397: [[40, 122, 41], 256],
              9398: [[65], 256],
              9399: [[66], 256],
              9400: [[67], 256],
              9401: [[68], 256],
              9402: [[69], 256],
              9403: [[70], 256],
              9404: [[71], 256],
              9405: [[72], 256],
              9406: [[73], 256],
              9407: [[74], 256],
              9408: [[75], 256],
              9409: [[76], 256],
              9410: [[77], 256],
              9411: [[78], 256],
              9412: [[79], 256],
              9413: [[80], 256],
              9414: [[81], 256],
              9415: [[82], 256],
              9416: [[83], 256],
              9417: [[84], 256],
              9418: [[85], 256],
              9419: [[86], 256],
              9420: [[87], 256],
              9421: [[88], 256],
              9422: [[89], 256],
              9423: [[90], 256],
              9424: [[97], 256],
              9425: [[98], 256],
              9426: [[99], 256],
              9427: [[100], 256],
              9428: [[101], 256],
              9429: [[102], 256],
              9430: [[103], 256],
              9431: [[104], 256],
              9432: [[105], 256],
              9433: [[106], 256],
              9434: [[107], 256],
              9435: [[108], 256],
              9436: [[109], 256],
              9437: [[110], 256],
              9438: [[111], 256],
              9439: [[112], 256],
              9440: [[113], 256],
              9441: [[114], 256],
              9442: [[115], 256],
              9443: [[116], 256],
              9444: [[117], 256],
              9445: [[118], 256],
              9446: [[119], 256],
              9447: [[120], 256],
              9448: [[121], 256],
              9449: [[122], 256],
              9450: [[48], 256],
            },
            10752: {
              10764: [[8747, 8747, 8747, 8747], 256],
              10868: [[58, 58, 61], 256],
              10869: [[61, 61], 256],
              10870: [[61, 61, 61], 256],
              10972: [[10973, 824], 512],
            },
            11264: {
              11388: [[106], 256],
              11389: [[86], 256],
              11503: [, 230],
              11504: [, 230],
              11505: [, 230],
            },
            11520: {
              11631: [[11617], 256],
              11647: [, 9],
              11744: [, 230],
              11745: [, 230],
              11746: [, 230],
              11747: [, 230],
              11748: [, 230],
              11749: [, 230],
              11750: [, 230],
              11751: [, 230],
              11752: [, 230],
              11753: [, 230],
              11754: [, 230],
              11755: [, 230],
              11756: [, 230],
              11757: [, 230],
              11758: [, 230],
              11759: [, 230],
              11760: [, 230],
              11761: [, 230],
              11762: [, 230],
              11763: [, 230],
              11764: [, 230],
              11765: [, 230],
              11766: [, 230],
              11767: [, 230],
              11768: [, 230],
              11769: [, 230],
              11770: [, 230],
              11771: [, 230],
              11772: [, 230],
              11773: [, 230],
              11774: [, 230],
              11775: [, 230],
            },
            11776: { 11935: [[27597], 256], 12019: [[40863], 256] },
            12032: {
              12032: [[19968], 256],
              12033: [[20008], 256],
              12034: [[20022], 256],
              12035: [[20031], 256],
              12036: [[20057], 256],
              12037: [[20101], 256],
              12038: [[20108], 256],
              12039: [[20128], 256],
              12040: [[20154], 256],
              12041: [[20799], 256],
              12042: [[20837], 256],
              12043: [[20843], 256],
              12044: [[20866], 256],
              12045: [[20886], 256],
              12046: [[20907], 256],
              12047: [[20960], 256],
              12048: [[20981], 256],
              12049: [[20992], 256],
              12050: [[21147], 256],
              12051: [[21241], 256],
              12052: [[21269], 256],
              12053: [[21274], 256],
              12054: [[21304], 256],
              12055: [[21313], 256],
              12056: [[21340], 256],
              12057: [[21353], 256],
              12058: [[21378], 256],
              12059: [[21430], 256],
              12060: [[21448], 256],
              12061: [[21475], 256],
              12062: [[22231], 256],
              12063: [[22303], 256],
              12064: [[22763], 256],
              12065: [[22786], 256],
              12066: [[22794], 256],
              12067: [[22805], 256],
              12068: [[22823], 256],
              12069: [[22899], 256],
              12070: [[23376], 256],
              12071: [[23424], 256],
              12072: [[23544], 256],
              12073: [[23567], 256],
              12074: [[23586], 256],
              12075: [[23608], 256],
              12076: [[23662], 256],
              12077: [[23665], 256],
              12078: [[24027], 256],
              12079: [[24037], 256],
              12080: [[24049], 256],
              12081: [[24062], 256],
              12082: [[24178], 256],
              12083: [[24186], 256],
              12084: [[24191], 256],
              12085: [[24308], 256],
              12086: [[24318], 256],
              12087: [[24331], 256],
              12088: [[24339], 256],
              12089: [[24400], 256],
              12090: [[24417], 256],
              12091: [[24435], 256],
              12092: [[24515], 256],
              12093: [[25096], 256],
              12094: [[25142], 256],
              12095: [[25163], 256],
              12096: [[25903], 256],
              12097: [[25908], 256],
              12098: [[25991], 256],
              12099: [[26007], 256],
              12100: [[26020], 256],
              12101: [[26041], 256],
              12102: [[26080], 256],
              12103: [[26085], 256],
              12104: [[26352], 256],
              12105: [[26376], 256],
              12106: [[26408], 256],
              12107: [[27424], 256],
              12108: [[27490], 256],
              12109: [[27513], 256],
              12110: [[27571], 256],
              12111: [[27595], 256],
              12112: [[27604], 256],
              12113: [[27611], 256],
              12114: [[27663], 256],
              12115: [[27668], 256],
              12116: [[27700], 256],
              12117: [[28779], 256],
              12118: [[29226], 256],
              12119: [[29238], 256],
              12120: [[29243], 256],
              12121: [[29247], 256],
              12122: [[29255], 256],
              12123: [[29273], 256],
              12124: [[29275], 256],
              12125: [[29356], 256],
              12126: [[29572], 256],
              12127: [[29577], 256],
              12128: [[29916], 256],
              12129: [[29926], 256],
              12130: [[29976], 256],
              12131: [[29983], 256],
              12132: [[29992], 256],
              12133: [[3e4], 256],
              12134: [[30091], 256],
              12135: [[30098], 256],
              12136: [[30326], 256],
              12137: [[30333], 256],
              12138: [[30382], 256],
              12139: [[30399], 256],
              12140: [[30446], 256],
              12141: [[30683], 256],
              12142: [[30690], 256],
              12143: [[30707], 256],
              12144: [[31034], 256],
              12145: [[31160], 256],
              12146: [[31166], 256],
              12147: [[31348], 256],
              12148: [[31435], 256],
              12149: [[31481], 256],
              12150: [[31859], 256],
              12151: [[31992], 256],
              12152: [[32566], 256],
              12153: [[32593], 256],
              12154: [[32650], 256],
              12155: [[32701], 256],
              12156: [[32769], 256],
              12157: [[32780], 256],
              12158: [[32786], 256],
              12159: [[32819], 256],
              12160: [[32895], 256],
              12161: [[32905], 256],
              12162: [[33251], 256],
              12163: [[33258], 256],
              12164: [[33267], 256],
              12165: [[33276], 256],
              12166: [[33292], 256],
              12167: [[33307], 256],
              12168: [[33311], 256],
              12169: [[33390], 256],
              12170: [[33394], 256],
              12171: [[33400], 256],
              12172: [[34381], 256],
              12173: [[34411], 256],
              12174: [[34880], 256],
              12175: [[34892], 256],
              12176: [[34915], 256],
              12177: [[35198], 256],
              12178: [[35211], 256],
              12179: [[35282], 256],
              12180: [[35328], 256],
              12181: [[35895], 256],
              12182: [[35910], 256],
              12183: [[35925], 256],
              12184: [[35960], 256],
              12185: [[35997], 256],
              12186: [[36196], 256],
              12187: [[36208], 256],
              12188: [[36275], 256],
              12189: [[36523], 256],
              12190: [[36554], 256],
              12191: [[36763], 256],
              12192: [[36784], 256],
              12193: [[36789], 256],
              12194: [[37009], 256],
              12195: [[37193], 256],
              12196: [[37318], 256],
              12197: [[37324], 256],
              12198: [[37329], 256],
              12199: [[38263], 256],
              12200: [[38272], 256],
              12201: [[38428], 256],
              12202: [[38582], 256],
              12203: [[38585], 256],
              12204: [[38632], 256],
              12205: [[38737], 256],
              12206: [[38750], 256],
              12207: [[38754], 256],
              12208: [[38761], 256],
              12209: [[38859], 256],
              12210: [[38893], 256],
              12211: [[38899], 256],
              12212: [[38913], 256],
              12213: [[39080], 256],
              12214: [[39131], 256],
              12215: [[39135], 256],
              12216: [[39318], 256],
              12217: [[39321], 256],
              12218: [[39340], 256],
              12219: [[39592], 256],
              12220: [[39640], 256],
              12221: [[39647], 256],
              12222: [[39717], 256],
              12223: [[39727], 256],
              12224: [[39730], 256],
              12225: [[39740], 256],
              12226: [[39770], 256],
              12227: [[40165], 256],
              12228: [[40565], 256],
              12229: [[40575], 256],
              12230: [[40613], 256],
              12231: [[40635], 256],
              12232: [[40643], 256],
              12233: [[40653], 256],
              12234: [[40657], 256],
              12235: [[40697], 256],
              12236: [[40701], 256],
              12237: [[40718], 256],
              12238: [[40723], 256],
              12239: [[40736], 256],
              12240: [[40763], 256],
              12241: [[40778], 256],
              12242: [[40786], 256],
              12243: [[40845], 256],
              12244: [[40860], 256],
              12245: [[40864], 256],
            },
            12288: {
              12288: [[32], 256],
              12330: [, 218],
              12331: [, 228],
              12332: [, 232],
              12333: [, 222],
              12334: [, 224],
              12335: [, 224],
              12342: [[12306], 256],
              12344: [[21313], 256],
              12345: [[21316], 256],
              12346: [[21317], 256],
              12358: [, , { 12441: 12436 }],
              12363: [, , { 12441: 12364 }],
              12364: [[12363, 12441]],
              12365: [, , { 12441: 12366 }],
              12366: [[12365, 12441]],
              12367: [, , { 12441: 12368 }],
              12368: [[12367, 12441]],
              12369: [, , { 12441: 12370 }],
              12370: [[12369, 12441]],
              12371: [, , { 12441: 12372 }],
              12372: [[12371, 12441]],
              12373: [, , { 12441: 12374 }],
              12374: [[12373, 12441]],
              12375: [, , { 12441: 12376 }],
              12376: [[12375, 12441]],
              12377: [, , { 12441: 12378 }],
              12378: [[12377, 12441]],
              12379: [, , { 12441: 12380 }],
              12380: [[12379, 12441]],
              12381: [, , { 12441: 12382 }],
              12382: [[12381, 12441]],
              12383: [, , { 12441: 12384 }],
              12384: [[12383, 12441]],
              12385: [, , { 12441: 12386 }],
              12386: [[12385, 12441]],
              12388: [, , { 12441: 12389 }],
              12389: [[12388, 12441]],
              12390: [, , { 12441: 12391 }],
              12391: [[12390, 12441]],
              12392: [, , { 12441: 12393 }],
              12393: [[12392, 12441]],
              12399: [, , { 12441: 12400, 12442: 12401 }],
              12400: [[12399, 12441]],
              12401: [[12399, 12442]],
              12402: [, , { 12441: 12403, 12442: 12404 }],
              12403: [[12402, 12441]],
              12404: [[12402, 12442]],
              12405: [, , { 12441: 12406, 12442: 12407 }],
              12406: [[12405, 12441]],
              12407: [[12405, 12442]],
              12408: [, , { 12441: 12409, 12442: 12410 }],
              12409: [[12408, 12441]],
              12410: [[12408, 12442]],
              12411: [, , { 12441: 12412, 12442: 12413 }],
              12412: [[12411, 12441]],
              12413: [[12411, 12442]],
              12436: [[12358, 12441]],
              12441: [, 8],
              12442: [, 8],
              12443: [[32, 12441], 256],
              12444: [[32, 12442], 256],
              12445: [, , { 12441: 12446 }],
              12446: [[12445, 12441]],
              12447: [[12424, 12426], 256],
              12454: [, , { 12441: 12532 }],
              12459: [, , { 12441: 12460 }],
              12460: [[12459, 12441]],
              12461: [, , { 12441: 12462 }],
              12462: [[12461, 12441]],
              12463: [, , { 12441: 12464 }],
              12464: [[12463, 12441]],
              12465: [, , { 12441: 12466 }],
              12466: [[12465, 12441]],
              12467: [, , { 12441: 12468 }],
              12468: [[12467, 12441]],
              12469: [, , { 12441: 12470 }],
              12470: [[12469, 12441]],
              12471: [, , { 12441: 12472 }],
              12472: [[12471, 12441]],
              12473: [, , { 12441: 12474 }],
              12474: [[12473, 12441]],
              12475: [, , { 12441: 12476 }],
              12476: [[12475, 12441]],
              12477: [, , { 12441: 12478 }],
              12478: [[12477, 12441]],
              12479: [, , { 12441: 12480 }],
              12480: [[12479, 12441]],
              12481: [, , { 12441: 12482 }],
              12482: [[12481, 12441]],
              12484: [, , { 12441: 12485 }],
              12485: [[12484, 12441]],
              12486: [, , { 12441: 12487 }],
              12487: [[12486, 12441]],
              12488: [, , { 12441: 12489 }],
              12489: [[12488, 12441]],
              12495: [, , { 12441: 12496, 12442: 12497 }],
              12496: [[12495, 12441]],
              12497: [[12495, 12442]],
              12498: [, , { 12441: 12499, 12442: 12500 }],
              12499: [[12498, 12441]],
              12500: [[12498, 12442]],
              12501: [, , { 12441: 12502, 12442: 12503 }],
              12502: [[12501, 12441]],
              12503: [[12501, 12442]],
              12504: [, , { 12441: 12505, 12442: 12506 }],
              12505: [[12504, 12441]],
              12506: [[12504, 12442]],
              12507: [, , { 12441: 12508, 12442: 12509 }],
              12508: [[12507, 12441]],
              12509: [[12507, 12442]],
              12527: [, , { 12441: 12535 }],
              12528: [, , { 12441: 12536 }],
              12529: [, , { 12441: 12537 }],
              12530: [, , { 12441: 12538 }],
              12532: [[12454, 12441]],
              12535: [[12527, 12441]],
              12536: [[12528, 12441]],
              12537: [[12529, 12441]],
              12538: [[12530, 12441]],
              12541: [, , { 12441: 12542 }],
              12542: [[12541, 12441]],
              12543: [[12467, 12488], 256],
            },
            12544: {
              12593: [[4352], 256],
              12594: [[4353], 256],
              12595: [[4522], 256],
              12596: [[4354], 256],
              12597: [[4524], 256],
              12598: [[4525], 256],
              12599: [[4355], 256],
              12600: [[4356], 256],
              12601: [[4357], 256],
              12602: [[4528], 256],
              12603: [[4529], 256],
              12604: [[4530], 256],
              12605: [[4531], 256],
              12606: [[4532], 256],
              12607: [[4533], 256],
              12608: [[4378], 256],
              12609: [[4358], 256],
              12610: [[4359], 256],
              12611: [[4360], 256],
              12612: [[4385], 256],
              12613: [[4361], 256],
              12614: [[4362], 256],
              12615: [[4363], 256],
              12616: [[4364], 256],
              12617: [[4365], 256],
              12618: [[4366], 256],
              12619: [[4367], 256],
              12620: [[4368], 256],
              12621: [[4369], 256],
              12622: [[4370], 256],
              12623: [[4449], 256],
              12624: [[4450], 256],
              12625: [[4451], 256],
              12626: [[4452], 256],
              12627: [[4453], 256],
              12628: [[4454], 256],
              12629: [[4455], 256],
              12630: [[4456], 256],
              12631: [[4457], 256],
              12632: [[4458], 256],
              12633: [[4459], 256],
              12634: [[4460], 256],
              12635: [[4461], 256],
              12636: [[4462], 256],
              12637: [[4463], 256],
              12638: [[4464], 256],
              12639: [[4465], 256],
              12640: [[4466], 256],
              12641: [[4467], 256],
              12642: [[4468], 256],
              12643: [[4469], 256],
              12644: [[4448], 256],
              12645: [[4372], 256],
              12646: [[4373], 256],
              12647: [[4551], 256],
              12648: [[4552], 256],
              12649: [[4556], 256],
              12650: [[4558], 256],
              12651: [[4563], 256],
              12652: [[4567], 256],
              12653: [[4569], 256],
              12654: [[4380], 256],
              12655: [[4573], 256],
              12656: [[4575], 256],
              12657: [[4381], 256],
              12658: [[4382], 256],
              12659: [[4384], 256],
              12660: [[4386], 256],
              12661: [[4387], 256],
              12662: [[4391], 256],
              12663: [[4393], 256],
              12664: [[4395], 256],
              12665: [[4396], 256],
              12666: [[4397], 256],
              12667: [[4398], 256],
              12668: [[4399], 256],
              12669: [[4402], 256],
              12670: [[4406], 256],
              12671: [[4416], 256],
              12672: [[4423], 256],
              12673: [[4428], 256],
              12674: [[4593], 256],
              12675: [[4594], 256],
              12676: [[4439], 256],
              12677: [[4440], 256],
              12678: [[4441], 256],
              12679: [[4484], 256],
              12680: [[4485], 256],
              12681: [[4488], 256],
              12682: [[4497], 256],
              12683: [[4498], 256],
              12684: [[4500], 256],
              12685: [[4510], 256],
              12686: [[4513], 256],
              12690: [[19968], 256],
              12691: [[20108], 256],
              12692: [[19977], 256],
              12693: [[22235], 256],
              12694: [[19978], 256],
              12695: [[20013], 256],
              12696: [[19979], 256],
              12697: [[30002], 256],
              12698: [[20057], 256],
              12699: [[19993], 256],
              12700: [[19969], 256],
              12701: [[22825], 256],
              12702: [[22320], 256],
              12703: [[20154], 256],
            },
            12800: {
              12800: [[40, 4352, 41], 256],
              12801: [[40, 4354, 41], 256],
              12802: [[40, 4355, 41], 256],
              12803: [[40, 4357, 41], 256],
              12804: [[40, 4358, 41], 256],
              12805: [[40, 4359, 41], 256],
              12806: [[40, 4361, 41], 256],
              12807: [[40, 4363, 41], 256],
              12808: [[40, 4364, 41], 256],
              12809: [[40, 4366, 41], 256],
              12810: [[40, 4367, 41], 256],
              12811: [[40, 4368, 41], 256],
              12812: [[40, 4369, 41], 256],
              12813: [[40, 4370, 41], 256],
              12814: [[40, 4352, 4449, 41], 256],
              12815: [[40, 4354, 4449, 41], 256],
              12816: [[40, 4355, 4449, 41], 256],
              12817: [[40, 4357, 4449, 41], 256],
              12818: [[40, 4358, 4449, 41], 256],
              12819: [[40, 4359, 4449, 41], 256],
              12820: [[40, 4361, 4449, 41], 256],
              12821: [[40, 4363, 4449, 41], 256],
              12822: [[40, 4364, 4449, 41], 256],
              12823: [[40, 4366, 4449, 41], 256],
              12824: [[40, 4367, 4449, 41], 256],
              12825: [[40, 4368, 4449, 41], 256],
              12826: [[40, 4369, 4449, 41], 256],
              12827: [[40, 4370, 4449, 41], 256],
              12828: [[40, 4364, 4462, 41], 256],
              12829: [[40, 4363, 4457, 4364, 4453, 4523, 41], 256],
              12830: [[40, 4363, 4457, 4370, 4462, 41], 256],
              12832: [[40, 19968, 41], 256],
              12833: [[40, 20108, 41], 256],
              12834: [[40, 19977, 41], 256],
              12835: [[40, 22235, 41], 256],
              12836: [[40, 20116, 41], 256],
              12837: [[40, 20845, 41], 256],
              12838: [[40, 19971, 41], 256],
              12839: [[40, 20843, 41], 256],
              12840: [[40, 20061, 41], 256],
              12841: [[40, 21313, 41], 256],
              12842: [[40, 26376, 41], 256],
              12843: [[40, 28779, 41], 256],
              12844: [[40, 27700, 41], 256],
              12845: [[40, 26408, 41], 256],
              12846: [[40, 37329, 41], 256],
              12847: [[40, 22303, 41], 256],
              12848: [[40, 26085, 41], 256],
              12849: [[40, 26666, 41], 256],
              12850: [[40, 26377, 41], 256],
              12851: [[40, 31038, 41], 256],
              12852: [[40, 21517, 41], 256],
              12853: [[40, 29305, 41], 256],
              12854: [[40, 36001, 41], 256],
              12855: [[40, 31069, 41], 256],
              12856: [[40, 21172, 41], 256],
              12857: [[40, 20195, 41], 256],
              12858: [[40, 21628, 41], 256],
              12859: [[40, 23398, 41], 256],
              12860: [[40, 30435, 41], 256],
              12861: [[40, 20225, 41], 256],
              12862: [[40, 36039, 41], 256],
              12863: [[40, 21332, 41], 256],
              12864: [[40, 31085, 41], 256],
              12865: [[40, 20241, 41], 256],
              12866: [[40, 33258, 41], 256],
              12867: [[40, 33267, 41], 256],
              12868: [[21839], 256],
              12869: [[24188], 256],
              12870: [[25991], 256],
              12871: [[31631], 256],
              12880: [[80, 84, 69], 256],
              12881: [[50, 49], 256],
              12882: [[50, 50], 256],
              12883: [[50, 51], 256],
              12884: [[50, 52], 256],
              12885: [[50, 53], 256],
              12886: [[50, 54], 256],
              12887: [[50, 55], 256],
              12888: [[50, 56], 256],
              12889: [[50, 57], 256],
              12890: [[51, 48], 256],
              12891: [[51, 49], 256],
              12892: [[51, 50], 256],
              12893: [[51, 51], 256],
              12894: [[51, 52], 256],
              12895: [[51, 53], 256],
              12896: [[4352], 256],
              12897: [[4354], 256],
              12898: [[4355], 256],
              12899: [[4357], 256],
              12900: [[4358], 256],
              12901: [[4359], 256],
              12902: [[4361], 256],
              12903: [[4363], 256],
              12904: [[4364], 256],
              12905: [[4366], 256],
              12906: [[4367], 256],
              12907: [[4368], 256],
              12908: [[4369], 256],
              12909: [[4370], 256],
              12910: [[4352, 4449], 256],
              12911: [[4354, 4449], 256],
              12912: [[4355, 4449], 256],
              12913: [[4357, 4449], 256],
              12914: [[4358, 4449], 256],
              12915: [[4359, 4449], 256],
              12916: [[4361, 4449], 256],
              12917: [[4363, 4449], 256],
              12918: [[4364, 4449], 256],
              12919: [[4366, 4449], 256],
              12920: [[4367, 4449], 256],
              12921: [[4368, 4449], 256],
              12922: [[4369, 4449], 256],
              12923: [[4370, 4449], 256],
              12924: [[4366, 4449, 4535, 4352, 4457], 256],
              12925: [[4364, 4462, 4363, 4468], 256],
              12926: [[4363, 4462], 256],
              12928: [[19968], 256],
              12929: [[20108], 256],
              12930: [[19977], 256],
              12931: [[22235], 256],
              12932: [[20116], 256],
              12933: [[20845], 256],
              12934: [[19971], 256],
              12935: [[20843], 256],
              12936: [[20061], 256],
              12937: [[21313], 256],
              12938: [[26376], 256],
              12939: [[28779], 256],
              12940: [[27700], 256],
              12941: [[26408], 256],
              12942: [[37329], 256],
              12943: [[22303], 256],
              12944: [[26085], 256],
              12945: [[26666], 256],
              12946: [[26377], 256],
              12947: [[31038], 256],
              12948: [[21517], 256],
              12949: [[29305], 256],
              12950: [[36001], 256],
              12951: [[31069], 256],
              12952: [[21172], 256],
              12953: [[31192], 256],
              12954: [[30007], 256],
              12955: [[22899], 256],
              12956: [[36969], 256],
              12957: [[20778], 256],
              12958: [[21360], 256],
              12959: [[27880], 256],
              12960: [[38917], 256],
              12961: [[20241], 256],
              12962: [[20889], 256],
              12963: [[27491], 256],
              12964: [[19978], 256],
              12965: [[20013], 256],
              12966: [[19979], 256],
              12967: [[24038], 256],
              12968: [[21491], 256],
              12969: [[21307], 256],
              12970: [[23447], 256],
              12971: [[23398], 256],
              12972: [[30435], 256],
              12973: [[20225], 256],
              12974: [[36039], 256],
              12975: [[21332], 256],
              12976: [[22812], 256],
              12977: [[51, 54], 256],
              12978: [[51, 55], 256],
              12979: [[51, 56], 256],
              12980: [[51, 57], 256],
              12981: [[52, 48], 256],
              12982: [[52, 49], 256],
              12983: [[52, 50], 256],
              12984: [[52, 51], 256],
              12985: [[52, 52], 256],
              12986: [[52, 53], 256],
              12987: [[52, 54], 256],
              12988: [[52, 55], 256],
              12989: [[52, 56], 256],
              12990: [[52, 57], 256],
              12991: [[53, 48], 256],
              12992: [[49, 26376], 256],
              12993: [[50, 26376], 256],
              12994: [[51, 26376], 256],
              12995: [[52, 26376], 256],
              12996: [[53, 26376], 256],
              12997: [[54, 26376], 256],
              12998: [[55, 26376], 256],
              12999: [[56, 26376], 256],
              13000: [[57, 26376], 256],
              13001: [[49, 48, 26376], 256],
              13002: [[49, 49, 26376], 256],
              13003: [[49, 50, 26376], 256],
              13004: [[72, 103], 256],
              13005: [[101, 114, 103], 256],
              13006: [[101, 86], 256],
              13007: [[76, 84, 68], 256],
              13008: [[12450], 256],
              13009: [[12452], 256],
              13010: [[12454], 256],
              13011: [[12456], 256],
              13012: [[12458], 256],
              13013: [[12459], 256],
              13014: [[12461], 256],
              13015: [[12463], 256],
              13016: [[12465], 256],
              13017: [[12467], 256],
              13018: [[12469], 256],
              13019: [[12471], 256],
              13020: [[12473], 256],
              13021: [[12475], 256],
              13022: [[12477], 256],
              13023: [[12479], 256],
              13024: [[12481], 256],
              13025: [[12484], 256],
              13026: [[12486], 256],
              13027: [[12488], 256],
              13028: [[12490], 256],
              13029: [[12491], 256],
              13030: [[12492], 256],
              13031: [[12493], 256],
              13032: [[12494], 256],
              13033: [[12495], 256],
              13034: [[12498], 256],
              13035: [[12501], 256],
              13036: [[12504], 256],
              13037: [[12507], 256],
              13038: [[12510], 256],
              13039: [[12511], 256],
              13040: [[12512], 256],
              13041: [[12513], 256],
              13042: [[12514], 256],
              13043: [[12516], 256],
              13044: [[12518], 256],
              13045: [[12520], 256],
              13046: [[12521], 256],
              13047: [[12522], 256],
              13048: [[12523], 256],
              13049: [[12524], 256],
              13050: [[12525], 256],
              13051: [[12527], 256],
              13052: [[12528], 256],
              13053: [[12529], 256],
              13054: [[12530], 256],
            },
            13056: {
              13056: [[12450, 12497, 12540, 12488], 256],
              13057: [[12450, 12523, 12501, 12449], 256],
              13058: [[12450, 12531, 12506, 12450], 256],
              13059: [[12450, 12540, 12523], 256],
              13060: [[12452, 12491, 12531, 12464], 256],
              13061: [[12452, 12531, 12481], 256],
              13062: [[12454, 12457, 12531], 256],
              13063: [[12456, 12473, 12463, 12540, 12489], 256],
              13064: [[12456, 12540, 12459, 12540], 256],
              13065: [[12458, 12531, 12473], 256],
              13066: [[12458, 12540, 12512], 256],
              13067: [[12459, 12452, 12522], 256],
              13068: [[12459, 12521, 12483, 12488], 256],
              13069: [[12459, 12525, 12522, 12540], 256],
              13070: [[12460, 12525, 12531], 256],
              13071: [[12460, 12531, 12510], 256],
              13072: [[12462, 12460], 256],
              13073: [[12462, 12491, 12540], 256],
              13074: [[12461, 12517, 12522, 12540], 256],
              13075: [[12462, 12523, 12480, 12540], 256],
              13076: [[12461, 12525], 256],
              13077: [[12461, 12525, 12464, 12521, 12512], 256],
              13078: [[12461, 12525, 12513, 12540, 12488, 12523], 256],
              13079: [[12461, 12525, 12527, 12483, 12488], 256],
              13080: [[12464, 12521, 12512], 256],
              13081: [[12464, 12521, 12512, 12488, 12531], 256],
              13082: [[12463, 12523, 12476, 12452, 12525], 256],
              13083: [[12463, 12525, 12540, 12493], 256],
              13084: [[12465, 12540, 12473], 256],
              13085: [[12467, 12523, 12490], 256],
              13086: [[12467, 12540, 12509], 256],
              13087: [[12469, 12452, 12463, 12523], 256],
              13088: [[12469, 12531, 12481, 12540, 12512], 256],
              13089: [[12471, 12522, 12531, 12464], 256],
              13090: [[12475, 12531, 12481], 256],
              13091: [[12475, 12531, 12488], 256],
              13092: [[12480, 12540, 12473], 256],
              13093: [[12487, 12471], 256],
              13094: [[12489, 12523], 256],
              13095: [[12488, 12531], 256],
              13096: [[12490, 12494], 256],
              13097: [[12494, 12483, 12488], 256],
              13098: [[12495, 12452, 12484], 256],
              13099: [[12497, 12540, 12475, 12531, 12488], 256],
              13100: [[12497, 12540, 12484], 256],
              13101: [[12496, 12540, 12524, 12523], 256],
              13102: [[12500, 12450, 12473, 12488, 12523], 256],
              13103: [[12500, 12463, 12523], 256],
              13104: [[12500, 12467], 256],
              13105: [[12499, 12523], 256],
              13106: [[12501, 12449, 12521, 12483, 12489], 256],
              13107: [[12501, 12451, 12540, 12488], 256],
              13108: [[12502, 12483, 12471, 12455, 12523], 256],
              13109: [[12501, 12521, 12531], 256],
              13110: [[12504, 12463, 12479, 12540, 12523], 256],
              13111: [[12506, 12477], 256],
              13112: [[12506, 12491, 12498], 256],
              13113: [[12504, 12523, 12484], 256],
              13114: [[12506, 12531, 12473], 256],
              13115: [[12506, 12540, 12472], 256],
              13116: [[12505, 12540, 12479], 256],
              13117: [[12509, 12452, 12531, 12488], 256],
              13118: [[12508, 12523, 12488], 256],
              13119: [[12507, 12531], 256],
              13120: [[12509, 12531, 12489], 256],
              13121: [[12507, 12540, 12523], 256],
              13122: [[12507, 12540, 12531], 256],
              13123: [[12510, 12452, 12463, 12525], 256],
              13124: [[12510, 12452, 12523], 256],
              13125: [[12510, 12483, 12495], 256],
              13126: [[12510, 12523, 12463], 256],
              13127: [[12510, 12531, 12471, 12519, 12531], 256],
              13128: [[12511, 12463, 12525, 12531], 256],
              13129: [[12511, 12522], 256],
              13130: [[12511, 12522, 12496, 12540, 12523], 256],
              13131: [[12513, 12460], 256],
              13132: [[12513, 12460, 12488, 12531], 256],
              13133: [[12513, 12540, 12488, 12523], 256],
              13134: [[12516, 12540, 12489], 256],
              13135: [[12516, 12540, 12523], 256],
              13136: [[12518, 12450, 12531], 256],
              13137: [[12522, 12483, 12488, 12523], 256],
              13138: [[12522, 12521], 256],
              13139: [[12523, 12500, 12540], 256],
              13140: [[12523, 12540, 12502, 12523], 256],
              13141: [[12524, 12512], 256],
              13142: [[12524, 12531, 12488, 12466, 12531], 256],
              13143: [[12527, 12483, 12488], 256],
              13144: [[48, 28857], 256],
              13145: [[49, 28857], 256],
              13146: [[50, 28857], 256],
              13147: [[51, 28857], 256],
              13148: [[52, 28857], 256],
              13149: [[53, 28857], 256],
              13150: [[54, 28857], 256],
              13151: [[55, 28857], 256],
              13152: [[56, 28857], 256],
              13153: [[57, 28857], 256],
              13154: [[49, 48, 28857], 256],
              13155: [[49, 49, 28857], 256],
              13156: [[49, 50, 28857], 256],
              13157: [[49, 51, 28857], 256],
              13158: [[49, 52, 28857], 256],
              13159: [[49, 53, 28857], 256],
              13160: [[49, 54, 28857], 256],
              13161: [[49, 55, 28857], 256],
              13162: [[49, 56, 28857], 256],
              13163: [[49, 57, 28857], 256],
              13164: [[50, 48, 28857], 256],
              13165: [[50, 49, 28857], 256],
              13166: [[50, 50, 28857], 256],
              13167: [[50, 51, 28857], 256],
              13168: [[50, 52, 28857], 256],
              13169: [[104, 80, 97], 256],
              13170: [[100, 97], 256],
              13171: [[65, 85], 256],
              13172: [[98, 97, 114], 256],
              13173: [[111, 86], 256],
              13174: [[112, 99], 256],
              13175: [[100, 109], 256],
              13176: [[100, 109, 178], 256],
              13177: [[100, 109, 179], 256],
              13178: [[73, 85], 256],
              13179: [[24179, 25104], 256],
              13180: [[26157, 21644], 256],
              13181: [[22823, 27491], 256],
              13182: [[26126, 27835], 256],
              13183: [[26666, 24335, 20250, 31038], 256],
              13184: [[112, 65], 256],
              13185: [[110, 65], 256],
              13186: [[956, 65], 256],
              13187: [[109, 65], 256],
              13188: [[107, 65], 256],
              13189: [[75, 66], 256],
              13190: [[77, 66], 256],
              13191: [[71, 66], 256],
              13192: [[99, 97, 108], 256],
              13193: [[107, 99, 97, 108], 256],
              13194: [[112, 70], 256],
              13195: [[110, 70], 256],
              13196: [[956, 70], 256],
              13197: [[956, 103], 256],
              13198: [[109, 103], 256],
              13199: [[107, 103], 256],
              13200: [[72, 122], 256],
              13201: [[107, 72, 122], 256],
              13202: [[77, 72, 122], 256],
              13203: [[71, 72, 122], 256],
              13204: [[84, 72, 122], 256],
              13205: [[956, 8467], 256],
              13206: [[109, 8467], 256],
              13207: [[100, 8467], 256],
              13208: [[107, 8467], 256],
              13209: [[102, 109], 256],
              13210: [[110, 109], 256],
              13211: [[956, 109], 256],
              13212: [[109, 109], 256],
              13213: [[99, 109], 256],
              13214: [[107, 109], 256],
              13215: [[109, 109, 178], 256],
              13216: [[99, 109, 178], 256],
              13217: [[109, 178], 256],
              13218: [[107, 109, 178], 256],
              13219: [[109, 109, 179], 256],
              13220: [[99, 109, 179], 256],
              13221: [[109, 179], 256],
              13222: [[107, 109, 179], 256],
              13223: [[109, 8725, 115], 256],
              13224: [[109, 8725, 115, 178], 256],
              13225: [[80, 97], 256],
              13226: [[107, 80, 97], 256],
              13227: [[77, 80, 97], 256],
              13228: [[71, 80, 97], 256],
              13229: [[114, 97, 100], 256],
              13230: [[114, 97, 100, 8725, 115], 256],
              13231: [[114, 97, 100, 8725, 115, 178], 256],
              13232: [[112, 115], 256],
              13233: [[110, 115], 256],
              13234: [[956, 115], 256],
              13235: [[109, 115], 256],
              13236: [[112, 86], 256],
              13237: [[110, 86], 256],
              13238: [[956, 86], 256],
              13239: [[109, 86], 256],
              13240: [[107, 86], 256],
              13241: [[77, 86], 256],
              13242: [[112, 87], 256],
              13243: [[110, 87], 256],
              13244: [[956, 87], 256],
              13245: [[109, 87], 256],
              13246: [[107, 87], 256],
              13247: [[77, 87], 256],
              13248: [[107, 937], 256],
              13249: [[77, 937], 256],
              13250: [[97, 46, 109, 46], 256],
              13251: [[66, 113], 256],
              13252: [[99, 99], 256],
              13253: [[99, 100], 256],
              13254: [[67, 8725, 107, 103], 256],
              13255: [[67, 111, 46], 256],
              13256: [[100, 66], 256],
              13257: [[71, 121], 256],
              13258: [[104, 97], 256],
              13259: [[72, 80], 256],
              13260: [[105, 110], 256],
              13261: [[75, 75], 256],
              13262: [[75, 77], 256],
              13263: [[107, 116], 256],
              13264: [[108, 109], 256],
              13265: [[108, 110], 256],
              13266: [[108, 111, 103], 256],
              13267: [[108, 120], 256],
              13268: [[109, 98], 256],
              13269: [[109, 105, 108], 256],
              13270: [[109, 111, 108], 256],
              13271: [[80, 72], 256],
              13272: [[112, 46, 109, 46], 256],
              13273: [[80, 80, 77], 256],
              13274: [[80, 82], 256],
              13275: [[115, 114], 256],
              13276: [[83, 118], 256],
              13277: [[87, 98], 256],
              13278: [[86, 8725, 109], 256],
              13279: [[65, 8725, 109], 256],
              13280: [[49, 26085], 256],
              13281: [[50, 26085], 256],
              13282: [[51, 26085], 256],
              13283: [[52, 26085], 256],
              13284: [[53, 26085], 256],
              13285: [[54, 26085], 256],
              13286: [[55, 26085], 256],
              13287: [[56, 26085], 256],
              13288: [[57, 26085], 256],
              13289: [[49, 48, 26085], 256],
              13290: [[49, 49, 26085], 256],
              13291: [[49, 50, 26085], 256],
              13292: [[49, 51, 26085], 256],
              13293: [[49, 52, 26085], 256],
              13294: [[49, 53, 26085], 256],
              13295: [[49, 54, 26085], 256],
              13296: [[49, 55, 26085], 256],
              13297: [[49, 56, 26085], 256],
              13298: [[49, 57, 26085], 256],
              13299: [[50, 48, 26085], 256],
              13300: [[50, 49, 26085], 256],
              13301: [[50, 50, 26085], 256],
              13302: [[50, 51, 26085], 256],
              13303: [[50, 52, 26085], 256],
              13304: [[50, 53, 26085], 256],
              13305: [[50, 54, 26085], 256],
              13306: [[50, 55, 26085], 256],
              13307: [[50, 56, 26085], 256],
              13308: [[50, 57, 26085], 256],
              13309: [[51, 48, 26085], 256],
              13310: [[51, 49, 26085], 256],
              13311: [[103, 97, 108], 256],
            },
            27136: {
              92912: [, 1],
              92913: [, 1],
              92914: [, 1],
              92915: [, 1],
              92916: [, 1],
            },
            27392: {
              92976: [, 230],
              92977: [, 230],
              92978: [, 230],
              92979: [, 230],
              92980: [, 230],
              92981: [, 230],
              92982: [, 230],
            },
            42496: {
              42607: [, 230],
              42612: [, 230],
              42613: [, 230],
              42614: [, 230],
              42615: [, 230],
              42616: [, 230],
              42617: [, 230],
              42618: [, 230],
              42619: [, 230],
              42620: [, 230],
              42621: [, 230],
              42652: [[1098], 256],
              42653: [[1100], 256],
              42655: [, 230],
              42736: [, 230],
              42737: [, 230],
            },
            42752: {
              42864: [[42863], 256],
              43000: [[294], 256],
              43001: [[339], 256],
            },
            43008: {
              43014: [, 9],
              43204: [, 9],
              43232: [, 230],
              43233: [, 230],
              43234: [, 230],
              43235: [, 230],
              43236: [, 230],
              43237: [, 230],
              43238: [, 230],
              43239: [, 230],
              43240: [, 230],
              43241: [, 230],
              43242: [, 230],
              43243: [, 230],
              43244: [, 230],
              43245: [, 230],
              43246: [, 230],
              43247: [, 230],
              43248: [, 230],
              43249: [, 230],
            },
            43264: {
              43307: [, 220],
              43308: [, 220],
              43309: [, 220],
              43347: [, 9],
              43443: [, 7],
              43456: [, 9],
            },
            43520: {
              43696: [, 230],
              43698: [, 230],
              43699: [, 230],
              43700: [, 220],
              43703: [, 230],
              43704: [, 230],
              43710: [, 230],
              43711: [, 230],
              43713: [, 230],
              43766: [, 9],
            },
            43776: {
              43868: [[42791], 256],
              43869: [[43831], 256],
              43870: [[619], 256],
              43871: [[43858], 256],
              44013: [, 9],
            },
            48128: { 113822: [, 1] },
            53504: {
              119134: [[119127, 119141], 512],
              119135: [[119128, 119141], 512],
              119136: [[119135, 119150], 512],
              119137: [[119135, 119151], 512],
              119138: [[119135, 119152], 512],
              119139: [[119135, 119153], 512],
              119140: [[119135, 119154], 512],
              119141: [, 216],
              119142: [, 216],
              119143: [, 1],
              119144: [, 1],
              119145: [, 1],
              119149: [, 226],
              119150: [, 216],
              119151: [, 216],
              119152: [, 216],
              119153: [, 216],
              119154: [, 216],
              119163: [, 220],
              119164: [, 220],
              119165: [, 220],
              119166: [, 220],
              119167: [, 220],
              119168: [, 220],
              119169: [, 220],
              119170: [, 220],
              119173: [, 230],
              119174: [, 230],
              119175: [, 230],
              119176: [, 230],
              119177: [, 230],
              119178: [, 220],
              119179: [, 220],
              119210: [, 230],
              119211: [, 230],
              119212: [, 230],
              119213: [, 230],
              119227: [[119225, 119141], 512],
              119228: [[119226, 119141], 512],
              119229: [[119227, 119150], 512],
              119230: [[119228, 119150], 512],
              119231: [[119227, 119151], 512],
              119232: [[119228, 119151], 512],
            },
            53760: { 119362: [, 230], 119363: [, 230], 119364: [, 230] },
            54272: {
              119808: [[65], 256],
              119809: [[66], 256],
              119810: [[67], 256],
              119811: [[68], 256],
              119812: [[69], 256],
              119813: [[70], 256],
              119814: [[71], 256],
              119815: [[72], 256],
              119816: [[73], 256],
              119817: [[74], 256],
              119818: [[75], 256],
              119819: [[76], 256],
              119820: [[77], 256],
              119821: [[78], 256],
              119822: [[79], 256],
              119823: [[80], 256],
              119824: [[81], 256],
              119825: [[82], 256],
              119826: [[83], 256],
              119827: [[84], 256],
              119828: [[85], 256],
              119829: [[86], 256],
              119830: [[87], 256],
              119831: [[88], 256],
              119832: [[89], 256],
              119833: [[90], 256],
              119834: [[97], 256],
              119835: [[98], 256],
              119836: [[99], 256],
              119837: [[100], 256],
              119838: [[101], 256],
              119839: [[102], 256],
              119840: [[103], 256],
              119841: [[104], 256],
              119842: [[105], 256],
              119843: [[106], 256],
              119844: [[107], 256],
              119845: [[108], 256],
              119846: [[109], 256],
              119847: [[110], 256],
              119848: [[111], 256],
              119849: [[112], 256],
              119850: [[113], 256],
              119851: [[114], 256],
              119852: [[115], 256],
              119853: [[116], 256],
              119854: [[117], 256],
              119855: [[118], 256],
              119856: [[119], 256],
              119857: [[120], 256],
              119858: [[121], 256],
              119859: [[122], 256],
              119860: [[65], 256],
              119861: [[66], 256],
              119862: [[67], 256],
              119863: [[68], 256],
              119864: [[69], 256],
              119865: [[70], 256],
              119866: [[71], 256],
              119867: [[72], 256],
              119868: [[73], 256],
              119869: [[74], 256],
              119870: [[75], 256],
              119871: [[76], 256],
              119872: [[77], 256],
              119873: [[78], 256],
              119874: [[79], 256],
              119875: [[80], 256],
              119876: [[81], 256],
              119877: [[82], 256],
              119878: [[83], 256],
              119879: [[84], 256],
              119880: [[85], 256],
              119881: [[86], 256],
              119882: [[87], 256],
              119883: [[88], 256],
              119884: [[89], 256],
              119885: [[90], 256],
              119886: [[97], 256],
              119887: [[98], 256],
              119888: [[99], 256],
              119889: [[100], 256],
              119890: [[101], 256],
              119891: [[102], 256],
              119892: [[103], 256],
              119894: [[105], 256],
              119895: [[106], 256],
              119896: [[107], 256],
              119897: [[108], 256],
              119898: [[109], 256],
              119899: [[110], 256],
              119900: [[111], 256],
              119901: [[112], 256],
              119902: [[113], 256],
              119903: [[114], 256],
              119904: [[115], 256],
              119905: [[116], 256],
              119906: [[117], 256],
              119907: [[118], 256],
              119908: [[119], 256],
              119909: [[120], 256],
              119910: [[121], 256],
              119911: [[122], 256],
              119912: [[65], 256],
              119913: [[66], 256],
              119914: [[67], 256],
              119915: [[68], 256],
              119916: [[69], 256],
              119917: [[70], 256],
              119918: [[71], 256],
              119919: [[72], 256],
              119920: [[73], 256],
              119921: [[74], 256],
              119922: [[75], 256],
              119923: [[76], 256],
              119924: [[77], 256],
              119925: [[78], 256],
              119926: [[79], 256],
              119927: [[80], 256],
              119928: [[81], 256],
              119929: [[82], 256],
              119930: [[83], 256],
              119931: [[84], 256],
              119932: [[85], 256],
              119933: [[86], 256],
              119934: [[87], 256],
              119935: [[88], 256],
              119936: [[89], 256],
              119937: [[90], 256],
              119938: [[97], 256],
              119939: [[98], 256],
              119940: [[99], 256],
              119941: [[100], 256],
              119942: [[101], 256],
              119943: [[102], 256],
              119944: [[103], 256],
              119945: [[104], 256],
              119946: [[105], 256],
              119947: [[106], 256],
              119948: [[107], 256],
              119949: [[108], 256],
              119950: [[109], 256],
              119951: [[110], 256],
              119952: [[111], 256],
              119953: [[112], 256],
              119954: [[113], 256],
              119955: [[114], 256],
              119956: [[115], 256],
              119957: [[116], 256],
              119958: [[117], 256],
              119959: [[118], 256],
              119960: [[119], 256],
              119961: [[120], 256],
              119962: [[121], 256],
              119963: [[122], 256],
              119964: [[65], 256],
              119966: [[67], 256],
              119967: [[68], 256],
              119970: [[71], 256],
              119973: [[74], 256],
              119974: [[75], 256],
              119977: [[78], 256],
              119978: [[79], 256],
              119979: [[80], 256],
              119980: [[81], 256],
              119982: [[83], 256],
              119983: [[84], 256],
              119984: [[85], 256],
              119985: [[86], 256],
              119986: [[87], 256],
              119987: [[88], 256],
              119988: [[89], 256],
              119989: [[90], 256],
              119990: [[97], 256],
              119991: [[98], 256],
              119992: [[99], 256],
              119993: [[100], 256],
              119995: [[102], 256],
              119997: [[104], 256],
              119998: [[105], 256],
              119999: [[106], 256],
              120000: [[107], 256],
              120001: [[108], 256],
              120002: [[109], 256],
              120003: [[110], 256],
              120005: [[112], 256],
              120006: [[113], 256],
              120007: [[114], 256],
              120008: [[115], 256],
              120009: [[116], 256],
              120010: [[117], 256],
              120011: [[118], 256],
              120012: [[119], 256],
              120013: [[120], 256],
              120014: [[121], 256],
              120015: [[122], 256],
              120016: [[65], 256],
              120017: [[66], 256],
              120018: [[67], 256],
              120019: [[68], 256],
              120020: [[69], 256],
              120021: [[70], 256],
              120022: [[71], 256],
              120023: [[72], 256],
              120024: [[73], 256],
              120025: [[74], 256],
              120026: [[75], 256],
              120027: [[76], 256],
              120028: [[77], 256],
              120029: [[78], 256],
              120030: [[79], 256],
              120031: [[80], 256],
              120032: [[81], 256],
              120033: [[82], 256],
              120034: [[83], 256],
              120035: [[84], 256],
              120036: [[85], 256],
              120037: [[86], 256],
              120038: [[87], 256],
              120039: [[88], 256],
              120040: [[89], 256],
              120041: [[90], 256],
              120042: [[97], 256],
              120043: [[98], 256],
              120044: [[99], 256],
              120045: [[100], 256],
              120046: [[101], 256],
              120047: [[102], 256],
              120048: [[103], 256],
              120049: [[104], 256],
              120050: [[105], 256],
              120051: [[106], 256],
              120052: [[107], 256],
              120053: [[108], 256],
              120054: [[109], 256],
              120055: [[110], 256],
              120056: [[111], 256],
              120057: [[112], 256],
              120058: [[113], 256],
              120059: [[114], 256],
              120060: [[115], 256],
              120061: [[116], 256],
              120062: [[117], 256],
              120063: [[118], 256],
            },
            54528: {
              120064: [[119], 256],
              120065: [[120], 256],
              120066: [[121], 256],
              120067: [[122], 256],
              120068: [[65], 256],
              120069: [[66], 256],
              120071: [[68], 256],
              120072: [[69], 256],
              120073: [[70], 256],
              120074: [[71], 256],
              120077: [[74], 256],
              120078: [[75], 256],
              120079: [[76], 256],
              120080: [[77], 256],
              120081: [[78], 256],
              120082: [[79], 256],
              120083: [[80], 256],
              120084: [[81], 256],
              120086: [[83], 256],
              120087: [[84], 256],
              120088: [[85], 256],
              120089: [[86], 256],
              120090: [[87], 256],
              120091: [[88], 256],
              120092: [[89], 256],
              120094: [[97], 256],
              120095: [[98], 256],
              120096: [[99], 256],
              120097: [[100], 256],
              120098: [[101], 256],
              120099: [[102], 256],
              120100: [[103], 256],
              120101: [[104], 256],
              120102: [[105], 256],
              120103: [[106], 256],
              120104: [[107], 256],
              120105: [[108], 256],
              120106: [[109], 256],
              120107: [[110], 256],
              120108: [[111], 256],
              120109: [[112], 256],
              120110: [[113], 256],
              120111: [[114], 256],
              120112: [[115], 256],
              120113: [[116], 256],
              120114: [[117], 256],
              120115: [[118], 256],
              120116: [[119], 256],
              120117: [[120], 256],
              120118: [[121], 256],
              120119: [[122], 256],
              120120: [[65], 256],
              120121: [[66], 256],
              120123: [[68], 256],
              120124: [[69], 256],
              120125: [[70], 256],
              120126: [[71], 256],
              120128: [[73], 256],
              120129: [[74], 256],
              120130: [[75], 256],
              120131: [[76], 256],
              120132: [[77], 256],
              120134: [[79], 256],
              120138: [[83], 256],
              120139: [[84], 256],
              120140: [[85], 256],
              120141: [[86], 256],
              120142: [[87], 256],
              120143: [[88], 256],
              120144: [[89], 256],
              120146: [[97], 256],
              120147: [[98], 256],
              120148: [[99], 256],
              120149: [[100], 256],
              120150: [[101], 256],
              120151: [[102], 256],
              120152: [[103], 256],
              120153: [[104], 256],
              120154: [[105], 256],
              120155: [[106], 256],
              120156: [[107], 256],
              120157: [[108], 256],
              120158: [[109], 256],
              120159: [[110], 256],
              120160: [[111], 256],
              120161: [[112], 256],
              120162: [[113], 256],
              120163: [[114], 256],
              120164: [[115], 256],
              120165: [[116], 256],
              120166: [[117], 256],
              120167: [[118], 256],
              120168: [[119], 256],
              120169: [[120], 256],
              120170: [[121], 256],
              120171: [[122], 256],
              120172: [[65], 256],
              120173: [[66], 256],
              120174: [[67], 256],
              120175: [[68], 256],
              120176: [[69], 256],
              120177: [[70], 256],
              120178: [[71], 256],
              120179: [[72], 256],
              120180: [[73], 256],
              120181: [[74], 256],
              120182: [[75], 256],
              120183: [[76], 256],
              120184: [[77], 256],
              120185: [[78], 256],
              120186: [[79], 256],
              120187: [[80], 256],
              120188: [[81], 256],
              120189: [[82], 256],
              120190: [[83], 256],
              120191: [[84], 256],
              120192: [[85], 256],
              120193: [[86], 256],
              120194: [[87], 256],
              120195: [[88], 256],
              120196: [[89], 256],
              120197: [[90], 256],
              120198: [[97], 256],
              120199: [[98], 256],
              120200: [[99], 256],
              120201: [[100], 256],
              120202: [[101], 256],
              120203: [[102], 256],
              120204: [[103], 256],
              120205: [[104], 256],
              120206: [[105], 256],
              120207: [[106], 256],
              120208: [[107], 256],
              120209: [[108], 256],
              120210: [[109], 256],
              120211: [[110], 256],
              120212: [[111], 256],
              120213: [[112], 256],
              120214: [[113], 256],
              120215: [[114], 256],
              120216: [[115], 256],
              120217: [[116], 256],
              120218: [[117], 256],
              120219: [[118], 256],
              120220: [[119], 256],
              120221: [[120], 256],
              120222: [[121], 256],
              120223: [[122], 256],
              120224: [[65], 256],
              120225: [[66], 256],
              120226: [[67], 256],
              120227: [[68], 256],
              120228: [[69], 256],
              120229: [[70], 256],
              120230: [[71], 256],
              120231: [[72], 256],
              120232: [[73], 256],
              120233: [[74], 256],
              120234: [[75], 256],
              120235: [[76], 256],
              120236: [[77], 256],
              120237: [[78], 256],
              120238: [[79], 256],
              120239: [[80], 256],
              120240: [[81], 256],
              120241: [[82], 256],
              120242: [[83], 256],
              120243: [[84], 256],
              120244: [[85], 256],
              120245: [[86], 256],
              120246: [[87], 256],
              120247: [[88], 256],
              120248: [[89], 256],
              120249: [[90], 256],
              120250: [[97], 256],
              120251: [[98], 256],
              120252: [[99], 256],
              120253: [[100], 256],
              120254: [[101], 256],
              120255: [[102], 256],
              120256: [[103], 256],
              120257: [[104], 256],
              120258: [[105], 256],
              120259: [[106], 256],
              120260: [[107], 256],
              120261: [[108], 256],
              120262: [[109], 256],
              120263: [[110], 256],
              120264: [[111], 256],
              120265: [[112], 256],
              120266: [[113], 256],
              120267: [[114], 256],
              120268: [[115], 256],
              120269: [[116], 256],
              120270: [[117], 256],
              120271: [[118], 256],
              120272: [[119], 256],
              120273: [[120], 256],
              120274: [[121], 256],
              120275: [[122], 256],
              120276: [[65], 256],
              120277: [[66], 256],
              120278: [[67], 256],
              120279: [[68], 256],
              120280: [[69], 256],
              120281: [[70], 256],
              120282: [[71], 256],
              120283: [[72], 256],
              120284: [[73], 256],
              120285: [[74], 256],
              120286: [[75], 256],
              120287: [[76], 256],
              120288: [[77], 256],
              120289: [[78], 256],
              120290: [[79], 256],
              120291: [[80], 256],
              120292: [[81], 256],
              120293: [[82], 256],
              120294: [[83], 256],
              120295: [[84], 256],
              120296: [[85], 256],
              120297: [[86], 256],
              120298: [[87], 256],
              120299: [[88], 256],
              120300: [[89], 256],
              120301: [[90], 256],
              120302: [[97], 256],
              120303: [[98], 256],
              120304: [[99], 256],
              120305: [[100], 256],
              120306: [[101], 256],
              120307: [[102], 256],
              120308: [[103], 256],
              120309: [[104], 256],
              120310: [[105], 256],
              120311: [[106], 256],
              120312: [[107], 256],
              120313: [[108], 256],
              120314: [[109], 256],
              120315: [[110], 256],
              120316: [[111], 256],
              120317: [[112], 256],
              120318: [[113], 256],
              120319: [[114], 256],
            },
            54784: {
              120320: [[115], 256],
              120321: [[116], 256],
              120322: [[117], 256],
              120323: [[118], 256],
              120324: [[119], 256],
              120325: [[120], 256],
              120326: [[121], 256],
              120327: [[122], 256],
              120328: [[65], 256],
              120329: [[66], 256],
              120330: [[67], 256],
              120331: [[68], 256],
              120332: [[69], 256],
              120333: [[70], 256],
              120334: [[71], 256],
              120335: [[72], 256],
              120336: [[73], 256],
              120337: [[74], 256],
              120338: [[75], 256],
              120339: [[76], 256],
              120340: [[77], 256],
              120341: [[78], 256],
              120342: [[79], 256],
              120343: [[80], 256],
              120344: [[81], 256],
              120345: [[82], 256],
              120346: [[83], 256],
              120347: [[84], 256],
              120348: [[85], 256],
              120349: [[86], 256],
              120350: [[87], 256],
              120351: [[88], 256],
              120352: [[89], 256],
              120353: [[90], 256],
              120354: [[97], 256],
              120355: [[98], 256],
              120356: [[99], 256],
              120357: [[100], 256],
              120358: [[101], 256],
              120359: [[102], 256],
              120360: [[103], 256],
              120361: [[104], 256],
              120362: [[105], 256],
              120363: [[106], 256],
              120364: [[107], 256],
              120365: [[108], 256],
              120366: [[109], 256],
              120367: [[110], 256],
              120368: [[111], 256],
              120369: [[112], 256],
              120370: [[113], 256],
              120371: [[114], 256],
              120372: [[115], 256],
              120373: [[116], 256],
              120374: [[117], 256],
              120375: [[118], 256],
              120376: [[119], 256],
              120377: [[120], 256],
              120378: [[121], 256],
              120379: [[122], 256],
              120380: [[65], 256],
              120381: [[66], 256],
              120382: [[67], 256],
              120383: [[68], 256],
              120384: [[69], 256],
              120385: [[70], 256],
              120386: [[71], 256],
              120387: [[72], 256],
              120388: [[73], 256],
              120389: [[74], 256],
              120390: [[75], 256],
              120391: [[76], 256],
              120392: [[77], 256],
              120393: [[78], 256],
              120394: [[79], 256],
              120395: [[80], 256],
              120396: [[81], 256],
              120397: [[82], 256],
              120398: [[83], 256],
              120399: [[84], 256],
              120400: [[85], 256],
              120401: [[86], 256],
              120402: [[87], 256],
              120403: [[88], 256],
              120404: [[89], 256],
              120405: [[90], 256],
              120406: [[97], 256],
              120407: [[98], 256],
              120408: [[99], 256],
              120409: [[100], 256],
              120410: [[101], 256],
              120411: [[102], 256],
              120412: [[103], 256],
              120413: [[104], 256],
              120414: [[105], 256],
              120415: [[106], 256],
              120416: [[107], 256],
              120417: [[108], 256],
              120418: [[109], 256],
              120419: [[110], 256],
              120420: [[111], 256],
              120421: [[112], 256],
              120422: [[113], 256],
              120423: [[114], 256],
              120424: [[115], 256],
              120425: [[116], 256],
              120426: [[117], 256],
              120427: [[118], 256],
              120428: [[119], 256],
              120429: [[120], 256],
              120430: [[121], 256],
              120431: [[122], 256],
              120432: [[65], 256],
              120433: [[66], 256],
              120434: [[67], 256],
              120435: [[68], 256],
              120436: [[69], 256],
              120437: [[70], 256],
              120438: [[71], 256],
              120439: [[72], 256],
              120440: [[73], 256],
              120441: [[74], 256],
              120442: [[75], 256],
              120443: [[76], 256],
              120444: [[77], 256],
              120445: [[78], 256],
              120446: [[79], 256],
              120447: [[80], 256],
              120448: [[81], 256],
              120449: [[82], 256],
              120450: [[83], 256],
              120451: [[84], 256],
              120452: [[85], 256],
              120453: [[86], 256],
              120454: [[87], 256],
              120455: [[88], 256],
              120456: [[89], 256],
              120457: [[90], 256],
              120458: [[97], 256],
              120459: [[98], 256],
              120460: [[99], 256],
              120461: [[100], 256],
              120462: [[101], 256],
              120463: [[102], 256],
              120464: [[103], 256],
              120465: [[104], 256],
              120466: [[105], 256],
              120467: [[106], 256],
              120468: [[107], 256],
              120469: [[108], 256],
              120470: [[109], 256],
              120471: [[110], 256],
              120472: [[111], 256],
              120473: [[112], 256],
              120474: [[113], 256],
              120475: [[114], 256],
              120476: [[115], 256],
              120477: [[116], 256],
              120478: [[117], 256],
              120479: [[118], 256],
              120480: [[119], 256],
              120481: [[120], 256],
              120482: [[121], 256],
              120483: [[122], 256],
              120484: [[305], 256],
              120485: [[567], 256],
              120488: [[913], 256],
              120489: [[914], 256],
              120490: [[915], 256],
              120491: [[916], 256],
              120492: [[917], 256],
              120493: [[918], 256],
              120494: [[919], 256],
              120495: [[920], 256],
              120496: [[921], 256],
              120497: [[922], 256],
              120498: [[923], 256],
              120499: [[924], 256],
              120500: [[925], 256],
              120501: [[926], 256],
              120502: [[927], 256],
              120503: [[928], 256],
              120504: [[929], 256],
              120505: [[1012], 256],
              120506: [[931], 256],
              120507: [[932], 256],
              120508: [[933], 256],
              120509: [[934], 256],
              120510: [[935], 256],
              120511: [[936], 256],
              120512: [[937], 256],
              120513: [[8711], 256],
              120514: [[945], 256],
              120515: [[946], 256],
              120516: [[947], 256],
              120517: [[948], 256],
              120518: [[949], 256],
              120519: [[950], 256],
              120520: [[951], 256],
              120521: [[952], 256],
              120522: [[953], 256],
              120523: [[954], 256],
              120524: [[955], 256],
              120525: [[956], 256],
              120526: [[957], 256],
              120527: [[958], 256],
              120528: [[959], 256],
              120529: [[960], 256],
              120530: [[961], 256],
              120531: [[962], 256],
              120532: [[963], 256],
              120533: [[964], 256],
              120534: [[965], 256],
              120535: [[966], 256],
              120536: [[967], 256],
              120537: [[968], 256],
              120538: [[969], 256],
              120539: [[8706], 256],
              120540: [[1013], 256],
              120541: [[977], 256],
              120542: [[1008], 256],
              120543: [[981], 256],
              120544: [[1009], 256],
              120545: [[982], 256],
              120546: [[913], 256],
              120547: [[914], 256],
              120548: [[915], 256],
              120549: [[916], 256],
              120550: [[917], 256],
              120551: [[918], 256],
              120552: [[919], 256],
              120553: [[920], 256],
              120554: [[921], 256],
              120555: [[922], 256],
              120556: [[923], 256],
              120557: [[924], 256],
              120558: [[925], 256],
              120559: [[926], 256],
              120560: [[927], 256],
              120561: [[928], 256],
              120562: [[929], 256],
              120563: [[1012], 256],
              120564: [[931], 256],
              120565: [[932], 256],
              120566: [[933], 256],
              120567: [[934], 256],
              120568: [[935], 256],
              120569: [[936], 256],
              120570: [[937], 256],
              120571: [[8711], 256],
              120572: [[945], 256],
              120573: [[946], 256],
              120574: [[947], 256],
              120575: [[948], 256],
            },
            55040: {
              120576: [[949], 256],
              120577: [[950], 256],
              120578: [[951], 256],
              120579: [[952], 256],
              120580: [[953], 256],
              120581: [[954], 256],
              120582: [[955], 256],
              120583: [[956], 256],
              120584: [[957], 256],
              120585: [[958], 256],
              120586: [[959], 256],
              120587: [[960], 256],
              120588: [[961], 256],
              120589: [[962], 256],
              120590: [[963], 256],
              120591: [[964], 256],
              120592: [[965], 256],
              120593: [[966], 256],
              120594: [[967], 256],
              120595: [[968], 256],
              120596: [[969], 256],
              120597: [[8706], 256],
              120598: [[1013], 256],
              120599: [[977], 256],
              120600: [[1008], 256],
              120601: [[981], 256],
              120602: [[1009], 256],
              120603: [[982], 256],
              120604: [[913], 256],
              120605: [[914], 256],
              120606: [[915], 256],
              120607: [[916], 256],
              120608: [[917], 256],
              120609: [[918], 256],
              120610: [[919], 256],
              120611: [[920], 256],
              120612: [[921], 256],
              120613: [[922], 256],
              120614: [[923], 256],
              120615: [[924], 256],
              120616: [[925], 256],
              120617: [[926], 256],
              120618: [[927], 256],
              120619: [[928], 256],
              120620: [[929], 256],
              120621: [[1012], 256],
              120622: [[931], 256],
              120623: [[932], 256],
              120624: [[933], 256],
              120625: [[934], 256],
              120626: [[935], 256],
              120627: [[936], 256],
              120628: [[937], 256],
              120629: [[8711], 256],
              120630: [[945], 256],
              120631: [[946], 256],
              120632: [[947], 256],
              120633: [[948], 256],
              120634: [[949], 256],
              120635: [[950], 256],
              120636: [[951], 256],
              120637: [[952], 256],
              120638: [[953], 256],
              120639: [[954], 256],
              120640: [[955], 256],
              120641: [[956], 256],
              120642: [[957], 256],
              120643: [[958], 256],
              120644: [[959], 256],
              120645: [[960], 256],
              120646: [[961], 256],
              120647: [[962], 256],
              120648: [[963], 256],
              120649: [[964], 256],
              120650: [[965], 256],
              120651: [[966], 256],
              120652: [[967], 256],
              120653: [[968], 256],
              120654: [[969], 256],
              120655: [[8706], 256],
              120656: [[1013], 256],
              120657: [[977], 256],
              120658: [[1008], 256],
              120659: [[981], 256],
              120660: [[1009], 256],
              120661: [[982], 256],
              120662: [[913], 256],
              120663: [[914], 256],
              120664: [[915], 256],
              120665: [[916], 256],
              120666: [[917], 256],
              120667: [[918], 256],
              120668: [[919], 256],
              120669: [[920], 256],
              120670: [[921], 256],
              120671: [[922], 256],
              120672: [[923], 256],
              120673: [[924], 256],
              120674: [[925], 256],
              120675: [[926], 256],
              120676: [[927], 256],
              120677: [[928], 256],
              120678: [[929], 256],
              120679: [[1012], 256],
              120680: [[931], 256],
              120681: [[932], 256],
              120682: [[933], 256],
              120683: [[934], 256],
              120684: [[935], 256],
              120685: [[936], 256],
              120686: [[937], 256],
              120687: [[8711], 256],
              120688: [[945], 256],
              120689: [[946], 256],
              120690: [[947], 256],
              120691: [[948], 256],
              120692: [[949], 256],
              120693: [[950], 256],
              120694: [[951], 256],
              120695: [[952], 256],
              120696: [[953], 256],
              120697: [[954], 256],
              120698: [[955], 256],
              120699: [[956], 256],
              120700: [[957], 256],
              120701: [[958], 256],
              120702: [[959], 256],
              120703: [[960], 256],
              120704: [[961], 256],
              120705: [[962], 256],
              120706: [[963], 256],
              120707: [[964], 256],
              120708: [[965], 256],
              120709: [[966], 256],
              120710: [[967], 256],
              120711: [[968], 256],
              120712: [[969], 256],
              120713: [[8706], 256],
              120714: [[1013], 256],
              120715: [[977], 256],
              120716: [[1008], 256],
              120717: [[981], 256],
              120718: [[1009], 256],
              120719: [[982], 256],
              120720: [[913], 256],
              120721: [[914], 256],
              120722: [[915], 256],
              120723: [[916], 256],
              120724: [[917], 256],
              120725: [[918], 256],
              120726: [[919], 256],
              120727: [[920], 256],
              120728: [[921], 256],
              120729: [[922], 256],
              120730: [[923], 256],
              120731: [[924], 256],
              120732: [[925], 256],
              120733: [[926], 256],
              120734: [[927], 256],
              120735: [[928], 256],
              120736: [[929], 256],
              120737: [[1012], 256],
              120738: [[931], 256],
              120739: [[932], 256],
              120740: [[933], 256],
              120741: [[934], 256],
              120742: [[935], 256],
              120743: [[936], 256],
              120744: [[937], 256],
              120745: [[8711], 256],
              120746: [[945], 256],
              120747: [[946], 256],
              120748: [[947], 256],
              120749: [[948], 256],
              120750: [[949], 256],
              120751: [[950], 256],
              120752: [[951], 256],
              120753: [[952], 256],
              120754: [[953], 256],
              120755: [[954], 256],
              120756: [[955], 256],
              120757: [[956], 256],
              120758: [[957], 256],
              120759: [[958], 256],
              120760: [[959], 256],
              120761: [[960], 256],
              120762: [[961], 256],
              120763: [[962], 256],
              120764: [[963], 256],
              120765: [[964], 256],
              120766: [[965], 256],
              120767: [[966], 256],
              120768: [[967], 256],
              120769: [[968], 256],
              120770: [[969], 256],
              120771: [[8706], 256],
              120772: [[1013], 256],
              120773: [[977], 256],
              120774: [[1008], 256],
              120775: [[981], 256],
              120776: [[1009], 256],
              120777: [[982], 256],
              120778: [[988], 256],
              120779: [[989], 256],
              120782: [[48], 256],
              120783: [[49], 256],
              120784: [[50], 256],
              120785: [[51], 256],
              120786: [[52], 256],
              120787: [[53], 256],
              120788: [[54], 256],
              120789: [[55], 256],
              120790: [[56], 256],
              120791: [[57], 256],
              120792: [[48], 256],
              120793: [[49], 256],
              120794: [[50], 256],
              120795: [[51], 256],
              120796: [[52], 256],
              120797: [[53], 256],
              120798: [[54], 256],
              120799: [[55], 256],
              120800: [[56], 256],
              120801: [[57], 256],
              120802: [[48], 256],
              120803: [[49], 256],
              120804: [[50], 256],
              120805: [[51], 256],
              120806: [[52], 256],
              120807: [[53], 256],
              120808: [[54], 256],
              120809: [[55], 256],
              120810: [[56], 256],
              120811: [[57], 256],
              120812: [[48], 256],
              120813: [[49], 256],
              120814: [[50], 256],
              120815: [[51], 256],
              120816: [[52], 256],
              120817: [[53], 256],
              120818: [[54], 256],
              120819: [[55], 256],
              120820: [[56], 256],
              120821: [[57], 256],
              120822: [[48], 256],
              120823: [[49], 256],
              120824: [[50], 256],
              120825: [[51], 256],
              120826: [[52], 256],
              120827: [[53], 256],
              120828: [[54], 256],
              120829: [[55], 256],
              120830: [[56], 256],
              120831: [[57], 256],
            },
            59392: {
              125136: [, 220],
              125137: [, 220],
              125138: [, 220],
              125139: [, 220],
              125140: [, 220],
              125141: [, 220],
              125142: [, 220],
            },
            60928: {
              126464: [[1575], 256],
              126465: [[1576], 256],
              126466: [[1580], 256],
              126467: [[1583], 256],
              126469: [[1608], 256],
              126470: [[1586], 256],
              126471: [[1581], 256],
              126472: [[1591], 256],
              126473: [[1610], 256],
              126474: [[1603], 256],
              126475: [[1604], 256],
              126476: [[1605], 256],
              126477: [[1606], 256],
              126478: [[1587], 256],
              126479: [[1593], 256],
              126480: [[1601], 256],
              126481: [[1589], 256],
              126482: [[1602], 256],
              126483: [[1585], 256],
              126484: [[1588], 256],
              126485: [[1578], 256],
              126486: [[1579], 256],
              126487: [[1582], 256],
              126488: [[1584], 256],
              126489: [[1590], 256],
              126490: [[1592], 256],
              126491: [[1594], 256],
              126492: [[1646], 256],
              126493: [[1722], 256],
              126494: [[1697], 256],
              126495: [[1647], 256],
              126497: [[1576], 256],
              126498: [[1580], 256],
              126500: [[1607], 256],
              126503: [[1581], 256],
              126505: [[1610], 256],
              126506: [[1603], 256],
              126507: [[1604], 256],
              126508: [[1605], 256],
              126509: [[1606], 256],
              126510: [[1587], 256],
              126511: [[1593], 256],
              126512: [[1601], 256],
              126513: [[1589], 256],
              126514: [[1602], 256],
              126516: [[1588], 256],
              126517: [[1578], 256],
              126518: [[1579], 256],
              126519: [[1582], 256],
              126521: [[1590], 256],
              126523: [[1594], 256],
              126530: [[1580], 256],
              126535: [[1581], 256],
              126537: [[1610], 256],
              126539: [[1604], 256],
              126541: [[1606], 256],
              126542: [[1587], 256],
              126543: [[1593], 256],
              126545: [[1589], 256],
              126546: [[1602], 256],
              126548: [[1588], 256],
              126551: [[1582], 256],
              126553: [[1590], 256],
              126555: [[1594], 256],
              126557: [[1722], 256],
              126559: [[1647], 256],
              126561: [[1576], 256],
              126562: [[1580], 256],
              126564: [[1607], 256],
              126567: [[1581], 256],
              126568: [[1591], 256],
              126569: [[1610], 256],
              126570: [[1603], 256],
              126572: [[1605], 256],
              126573: [[1606], 256],
              126574: [[1587], 256],
              126575: [[1593], 256],
              126576: [[1601], 256],
              126577: [[1589], 256],
              126578: [[1602], 256],
              126580: [[1588], 256],
              126581: [[1578], 256],
              126582: [[1579], 256],
              126583: [[1582], 256],
              126585: [[1590], 256],
              126586: [[1592], 256],
              126587: [[1594], 256],
              126588: [[1646], 256],
              126590: [[1697], 256],
              126592: [[1575], 256],
              126593: [[1576], 256],
              126594: [[1580], 256],
              126595: [[1583], 256],
              126596: [[1607], 256],
              126597: [[1608], 256],
              126598: [[1586], 256],
              126599: [[1581], 256],
              126600: [[1591], 256],
              126601: [[1610], 256],
              126603: [[1604], 256],
              126604: [[1605], 256],
              126605: [[1606], 256],
              126606: [[1587], 256],
              126607: [[1593], 256],
              126608: [[1601], 256],
              126609: [[1589], 256],
              126610: [[1602], 256],
              126611: [[1585], 256],
              126612: [[1588], 256],
              126613: [[1578], 256],
              126614: [[1579], 256],
              126615: [[1582], 256],
              126616: [[1584], 256],
              126617: [[1590], 256],
              126618: [[1592], 256],
              126619: [[1594], 256],
              126625: [[1576], 256],
              126626: [[1580], 256],
              126627: [[1583], 256],
              126629: [[1608], 256],
              126630: [[1586], 256],
              126631: [[1581], 256],
              126632: [[1591], 256],
              126633: [[1610], 256],
              126635: [[1604], 256],
              126636: [[1605], 256],
              126637: [[1606], 256],
              126638: [[1587], 256],
              126639: [[1593], 256],
              126640: [[1601], 256],
              126641: [[1589], 256],
              126642: [[1602], 256],
              126643: [[1585], 256],
              126644: [[1588], 256],
              126645: [[1578], 256],
              126646: [[1579], 256],
              126647: [[1582], 256],
              126648: [[1584], 256],
              126649: [[1590], 256],
              126650: [[1592], 256],
              126651: [[1594], 256],
            },
            61696: {
              127232: [[48, 46], 256],
              127233: [[48, 44], 256],
              127234: [[49, 44], 256],
              127235: [[50, 44], 256],
              127236: [[51, 44], 256],
              127237: [[52, 44], 256],
              127238: [[53, 44], 256],
              127239: [[54, 44], 256],
              127240: [[55, 44], 256],
              127241: [[56, 44], 256],
              127242: [[57, 44], 256],
              127248: [[40, 65, 41], 256],
              127249: [[40, 66, 41], 256],
              127250: [[40, 67, 41], 256],
              127251: [[40, 68, 41], 256],
              127252: [[40, 69, 41], 256],
              127253: [[40, 70, 41], 256],
              127254: [[40, 71, 41], 256],
              127255: [[40, 72, 41], 256],
              127256: [[40, 73, 41], 256],
              127257: [[40, 74, 41], 256],
              127258: [[40, 75, 41], 256],
              127259: [[40, 76, 41], 256],
              127260: [[40, 77, 41], 256],
              127261: [[40, 78, 41], 256],
              127262: [[40, 79, 41], 256],
              127263: [[40, 80, 41], 256],
              127264: [[40, 81, 41], 256],
              127265: [[40, 82, 41], 256],
              127266: [[40, 83, 41], 256],
              127267: [[40, 84, 41], 256],
              127268: [[40, 85, 41], 256],
              127269: [[40, 86, 41], 256],
              127270: [[40, 87, 41], 256],
              127271: [[40, 88, 41], 256],
              127272: [[40, 89, 41], 256],
              127273: [[40, 90, 41], 256],
              127274: [[12308, 83, 12309], 256],
              127275: [[67], 256],
              127276: [[82], 256],
              127277: [[67, 68], 256],
              127278: [[87, 90], 256],
              127280: [[65], 256],
              127281: [[66], 256],
              127282: [[67], 256],
              127283: [[68], 256],
              127284: [[69], 256],
              127285: [[70], 256],
              127286: [[71], 256],
              127287: [[72], 256],
              127288: [[73], 256],
              127289: [[74], 256],
              127290: [[75], 256],
              127291: [[76], 256],
              127292: [[77], 256],
              127293: [[78], 256],
              127294: [[79], 256],
              127295: [[80], 256],
              127296: [[81], 256],
              127297: [[82], 256],
              127298: [[83], 256],
              127299: [[84], 256],
              127300: [[85], 256],
              127301: [[86], 256],
              127302: [[87], 256],
              127303: [[88], 256],
              127304: [[89], 256],
              127305: [[90], 256],
              127306: [[72, 86], 256],
              127307: [[77, 86], 256],
              127308: [[83, 68], 256],
              127309: [[83, 83], 256],
              127310: [[80, 80, 86], 256],
              127311: [[87, 67], 256],
              127338: [[77, 67], 256],
              127339: [[77, 68], 256],
              127376: [[68, 74], 256],
            },
            61952: {
              127488: [[12411, 12363], 256],
              127489: [[12467, 12467], 256],
              127490: [[12469], 256],
              127504: [[25163], 256],
              127505: [[23383], 256],
              127506: [[21452], 256],
              127507: [[12487], 256],
              127508: [[20108], 256],
              127509: [[22810], 256],
              127510: [[35299], 256],
              127511: [[22825], 256],
              127512: [[20132], 256],
              127513: [[26144], 256],
              127514: [[28961], 256],
              127515: [[26009], 256],
              127516: [[21069], 256],
              127517: [[24460], 256],
              127518: [[20877], 256],
              127519: [[26032], 256],
              127520: [[21021], 256],
              127521: [[32066], 256],
              127522: [[29983], 256],
              127523: [[36009], 256],
              127524: [[22768], 256],
              127525: [[21561], 256],
              127526: [[28436], 256],
              127527: [[25237], 256],
              127528: [[25429], 256],
              127529: [[19968], 256],
              127530: [[19977], 256],
              127531: [[36938], 256],
              127532: [[24038], 256],
              127533: [[20013], 256],
              127534: [[21491], 256],
              127535: [[25351], 256],
              127536: [[36208], 256],
              127537: [[25171], 256],
              127538: [[31105], 256],
              127539: [[31354], 256],
              127540: [[21512], 256],
              127541: [[28288], 256],
              127542: [[26377], 256],
              127543: [[26376], 256],
              127544: [[30003], 256],
              127545: [[21106], 256],
              127546: [[21942], 256],
              127552: [[12308, 26412, 12309], 256],
              127553: [[12308, 19977, 12309], 256],
              127554: [[12308, 20108, 12309], 256],
              127555: [[12308, 23433, 12309], 256],
              127556: [[12308, 28857, 12309], 256],
              127557: [[12308, 25171, 12309], 256],
              127558: [[12308, 30423, 12309], 256],
              127559: [[12308, 21213, 12309], 256],
              127560: [[12308, 25943, 12309], 256],
              127568: [[24471], 256],
              127569: [[21487], 256],
            },
            63488: {
              194560: [[20029]],
              194561: [[20024]],
              194562: [[20033]],
              194563: [[131362]],
              194564: [[20320]],
              194565: [[20398]],
              194566: [[20411]],
              194567: [[20482]],
              194568: [[20602]],
              194569: [[20633]],
              194570: [[20711]],
              194571: [[20687]],
              194572: [[13470]],
              194573: [[132666]],
              194574: [[20813]],
              194575: [[20820]],
              194576: [[20836]],
              194577: [[20855]],
              194578: [[132380]],
              194579: [[13497]],
              194580: [[20839]],
              194581: [[20877]],
              194582: [[132427]],
              194583: [[20887]],
              194584: [[20900]],
              194585: [[20172]],
              194586: [[20908]],
              194587: [[20917]],
              194588: [[168415]],
              194589: [[20981]],
              194590: [[20995]],
              194591: [[13535]],
              194592: [[21051]],
              194593: [[21062]],
              194594: [[21106]],
              194595: [[21111]],
              194596: [[13589]],
              194597: [[21191]],
              194598: [[21193]],
              194599: [[21220]],
              194600: [[21242]],
              194601: [[21253]],
              194602: [[21254]],
              194603: [[21271]],
              194604: [[21321]],
              194605: [[21329]],
              194606: [[21338]],
              194607: [[21363]],
              194608: [[21373]],
              194609: [[21375]],
              194610: [[21375]],
              194611: [[21375]],
              194612: [[133676]],
              194613: [[28784]],
              194614: [[21450]],
              194615: [[21471]],
              194616: [[133987]],
              194617: [[21483]],
              194618: [[21489]],
              194619: [[21510]],
              194620: [[21662]],
              194621: [[21560]],
              194622: [[21576]],
              194623: [[21608]],
              194624: [[21666]],
              194625: [[21750]],
              194626: [[21776]],
              194627: [[21843]],
              194628: [[21859]],
              194629: [[21892]],
              194630: [[21892]],
              194631: [[21913]],
              194632: [[21931]],
              194633: [[21939]],
              194634: [[21954]],
              194635: [[22294]],
              194636: [[22022]],
              194637: [[22295]],
              194638: [[22097]],
              194639: [[22132]],
              194640: [[20999]],
              194641: [[22766]],
              194642: [[22478]],
              194643: [[22516]],
              194644: [[22541]],
              194645: [[22411]],
              194646: [[22578]],
              194647: [[22577]],
              194648: [[22700]],
              194649: [[136420]],
              194650: [[22770]],
              194651: [[22775]],
              194652: [[22790]],
              194653: [[22810]],
              194654: [[22818]],
              194655: [[22882]],
              194656: [[136872]],
              194657: [[136938]],
              194658: [[23020]],
              194659: [[23067]],
              194660: [[23079]],
              194661: [[23e3]],
              194662: [[23142]],
              194663: [[14062]],
              194664: [[14076]],
              194665: [[23304]],
              194666: [[23358]],
              194667: [[23358]],
              194668: [[137672]],
              194669: [[23491]],
              194670: [[23512]],
              194671: [[23527]],
              194672: [[23539]],
              194673: [[138008]],
              194674: [[23551]],
              194675: [[23558]],
              194676: [[24403]],
              194677: [[23586]],
              194678: [[14209]],
              194679: [[23648]],
              194680: [[23662]],
              194681: [[23744]],
              194682: [[23693]],
              194683: [[138724]],
              194684: [[23875]],
              194685: [[138726]],
              194686: [[23918]],
              194687: [[23915]],
              194688: [[23932]],
              194689: [[24033]],
              194690: [[24034]],
              194691: [[14383]],
              194692: [[24061]],
              194693: [[24104]],
              194694: [[24125]],
              194695: [[24169]],
              194696: [[14434]],
              194697: [[139651]],
              194698: [[14460]],
              194699: [[24240]],
              194700: [[24243]],
              194701: [[24246]],
              194702: [[24266]],
              194703: [[172946]],
              194704: [[24318]],
              194705: [[140081]],
              194706: [[140081]],
              194707: [[33281]],
              194708: [[24354]],
              194709: [[24354]],
              194710: [[14535]],
              194711: [[144056]],
              194712: [[156122]],
              194713: [[24418]],
              194714: [[24427]],
              194715: [[14563]],
              194716: [[24474]],
              194717: [[24525]],
              194718: [[24535]],
              194719: [[24569]],
              194720: [[24705]],
              194721: [[14650]],
              194722: [[14620]],
              194723: [[24724]],
              194724: [[141012]],
              194725: [[24775]],
              194726: [[24904]],
              194727: [[24908]],
              194728: [[24910]],
              194729: [[24908]],
              194730: [[24954]],
              194731: [[24974]],
              194732: [[25010]],
              194733: [[24996]],
              194734: [[25007]],
              194735: [[25054]],
              194736: [[25074]],
              194737: [[25078]],
              194738: [[25104]],
              194739: [[25115]],
              194740: [[25181]],
              194741: [[25265]],
              194742: [[25300]],
              194743: [[25424]],
              194744: [[142092]],
              194745: [[25405]],
              194746: [[25340]],
              194747: [[25448]],
              194748: [[25475]],
              194749: [[25572]],
              194750: [[142321]],
              194751: [[25634]],
              194752: [[25541]],
              194753: [[25513]],
              194754: [[14894]],
              194755: [[25705]],
              194756: [[25726]],
              194757: [[25757]],
              194758: [[25719]],
              194759: [[14956]],
              194760: [[25935]],
              194761: [[25964]],
              194762: [[143370]],
              194763: [[26083]],
              194764: [[26360]],
              194765: [[26185]],
              194766: [[15129]],
              194767: [[26257]],
              194768: [[15112]],
              194769: [[15076]],
              194770: [[20882]],
              194771: [[20885]],
              194772: [[26368]],
              194773: [[26268]],
              194774: [[32941]],
              194775: [[17369]],
              194776: [[26391]],
              194777: [[26395]],
              194778: [[26401]],
              194779: [[26462]],
              194780: [[26451]],
              194781: [[144323]],
              194782: [[15177]],
              194783: [[26618]],
              194784: [[26501]],
              194785: [[26706]],
              194786: [[26757]],
              194787: [[144493]],
              194788: [[26766]],
              194789: [[26655]],
              194790: [[26900]],
              194791: [[15261]],
              194792: [[26946]],
              194793: [[27043]],
              194794: [[27114]],
              194795: [[27304]],
              194796: [[145059]],
              194797: [[27355]],
              194798: [[15384]],
              194799: [[27425]],
              194800: [[145575]],
              194801: [[27476]],
              194802: [[15438]],
              194803: [[27506]],
              194804: [[27551]],
              194805: [[27578]],
              194806: [[27579]],
              194807: [[146061]],
              194808: [[138507]],
              194809: [[146170]],
              194810: [[27726]],
              194811: [[146620]],
              194812: [[27839]],
              194813: [[27853]],
              194814: [[27751]],
              194815: [[27926]],
            },
            63744: {
              63744: [[35912]],
              63745: [[26356]],
              63746: [[36554]],
              63747: [[36040]],
              63748: [[28369]],
              63749: [[20018]],
              63750: [[21477]],
              63751: [[40860]],
              63752: [[40860]],
              63753: [[22865]],
              63754: [[37329]],
              63755: [[21895]],
              63756: [[22856]],
              63757: [[25078]],
              63758: [[30313]],
              63759: [[32645]],
              63760: [[34367]],
              63761: [[34746]],
              63762: [[35064]],
              63763: [[37007]],
              63764: [[27138]],
              63765: [[27931]],
              63766: [[28889]],
              63767: [[29662]],
              63768: [[33853]],
              63769: [[37226]],
              63770: [[39409]],
              63771: [[20098]],
              63772: [[21365]],
              63773: [[27396]],
              63774: [[29211]],
              63775: [[34349]],
              63776: [[40478]],
              63777: [[23888]],
              63778: [[28651]],
              63779: [[34253]],
              63780: [[35172]],
              63781: [[25289]],
              63782: [[33240]],
              63783: [[34847]],
              63784: [[24266]],
              63785: [[26391]],
              63786: [[28010]],
              63787: [[29436]],
              63788: [[37070]],
              63789: [[20358]],
              63790: [[20919]],
              63791: [[21214]],
              63792: [[25796]],
              63793: [[27347]],
              63794: [[29200]],
              63795: [[30439]],
              63796: [[32769]],
              63797: [[34310]],
              63798: [[34396]],
              63799: [[36335]],
              63800: [[38706]],
              63801: [[39791]],
              63802: [[40442]],
              63803: [[30860]],
              63804: [[31103]],
              63805: [[32160]],
              63806: [[33737]],
              63807: [[37636]],
              63808: [[40575]],
              63809: [[35542]],
              63810: [[22751]],
              63811: [[24324]],
              63812: [[31840]],
              63813: [[32894]],
              63814: [[29282]],
              63815: [[30922]],
              63816: [[36034]],
              63817: [[38647]],
              63818: [[22744]],
              63819: [[23650]],
              63820: [[27155]],
              63821: [[28122]],
              63822: [[28431]],
              63823: [[32047]],
              63824: [[32311]],
              63825: [[38475]],
              63826: [[21202]],
              63827: [[32907]],
              63828: [[20956]],
              63829: [[20940]],
              63830: [[31260]],
              63831: [[32190]],
              63832: [[33777]],
              63833: [[38517]],
              63834: [[35712]],
              63835: [[25295]],
              63836: [[27138]],
              63837: [[35582]],
              63838: [[20025]],
              63839: [[23527]],
              63840: [[24594]],
              63841: [[29575]],
              63842: [[30064]],
              63843: [[21271]],
              63844: [[30971]],
              63845: [[20415]],
              63846: [[24489]],
              63847: [[19981]],
              63848: [[27852]],
              63849: [[25976]],
              63850: [[32034]],
              63851: [[21443]],
              63852: [[22622]],
              63853: [[30465]],
              63854: [[33865]],
              63855: [[35498]],
              63856: [[27578]],
              63857: [[36784]],
              63858: [[27784]],
              63859: [[25342]],
              63860: [[33509]],
              63861: [[25504]],
              63862: [[30053]],
              63863: [[20142]],
              63864: [[20841]],
              63865: [[20937]],
              63866: [[26753]],
              63867: [[31975]],
              63868: [[33391]],
              63869: [[35538]],
              63870: [[37327]],
              63871: [[21237]],
              63872: [[21570]],
              63873: [[22899]],
              63874: [[24300]],
              63875: [[26053]],
              63876: [[28670]],
              63877: [[31018]],
              63878: [[38317]],
              63879: [[39530]],
              63880: [[40599]],
              63881: [[40654]],
              63882: [[21147]],
              63883: [[26310]],
              63884: [[27511]],
              63885: [[36706]],
              63886: [[24180]],
              63887: [[24976]],
              63888: [[25088]],
              63889: [[25754]],
              63890: [[28451]],
              63891: [[29001]],
              63892: [[29833]],
              63893: [[31178]],
              63894: [[32244]],
              63895: [[32879]],
              63896: [[36646]],
              63897: [[34030]],
              63898: [[36899]],
              63899: [[37706]],
              63900: [[21015]],
              63901: [[21155]],
              63902: [[21693]],
              63903: [[28872]],
              63904: [[35010]],
              63905: [[35498]],
              63906: [[24265]],
              63907: [[24565]],
              63908: [[25467]],
              63909: [[27566]],
              63910: [[31806]],
              63911: [[29557]],
              63912: [[20196]],
              63913: [[22265]],
              63914: [[23527]],
              63915: [[23994]],
              63916: [[24604]],
              63917: [[29618]],
              63918: [[29801]],
              63919: [[32666]],
              63920: [[32838]],
              63921: [[37428]],
              63922: [[38646]],
              63923: [[38728]],
              63924: [[38936]],
              63925: [[20363]],
              63926: [[31150]],
              63927: [[37300]],
              63928: [[38584]],
              63929: [[24801]],
              63930: [[20102]],
              63931: [[20698]],
              63932: [[23534]],
              63933: [[23615]],
              63934: [[26009]],
              63935: [[27138]],
              63936: [[29134]],
              63937: [[30274]],
              63938: [[34044]],
              63939: [[36988]],
              63940: [[40845]],
              63941: [[26248]],
              63942: [[38446]],
              63943: [[21129]],
              63944: [[26491]],
              63945: [[26611]],
              63946: [[27969]],
              63947: [[28316]],
              63948: [[29705]],
              63949: [[30041]],
              63950: [[30827]],
              63951: [[32016]],
              63952: [[39006]],
              63953: [[20845]],
              63954: [[25134]],
              63955: [[38520]],
              63956: [[20523]],
              63957: [[23833]],
              63958: [[28138]],
              63959: [[36650]],
              63960: [[24459]],
              63961: [[24900]],
              63962: [[26647]],
              63963: [[29575]],
              63964: [[38534]],
              63965: [[21033]],
              63966: [[21519]],
              63967: [[23653]],
              63968: [[26131]],
              63969: [[26446]],
              63970: [[26792]],
              63971: [[27877]],
              63972: [[29702]],
              63973: [[30178]],
              63974: [[32633]],
              63975: [[35023]],
              63976: [[35041]],
              63977: [[37324]],
              63978: [[38626]],
              63979: [[21311]],
              63980: [[28346]],
              63981: [[21533]],
              63982: [[29136]],
              63983: [[29848]],
              63984: [[34298]],
              63985: [[38563]],
              63986: [[40023]],
              63987: [[40607]],
              63988: [[26519]],
              63989: [[28107]],
              63990: [[33256]],
              63991: [[31435]],
              63992: [[31520]],
              63993: [[31890]],
              63994: [[29376]],
              63995: [[28825]],
              63996: [[35672]],
              63997: [[20160]],
              63998: [[33590]],
              63999: [[21050]],
              194816: [[27966]],
              194817: [[28023]],
              194818: [[27969]],
              194819: [[28009]],
              194820: [[28024]],
              194821: [[28037]],
              194822: [[146718]],
              194823: [[27956]],
              194824: [[28207]],
              194825: [[28270]],
              194826: [[15667]],
              194827: [[28363]],
              194828: [[28359]],
              194829: [[147153]],
              194830: [[28153]],
              194831: [[28526]],
              194832: [[147294]],
              194833: [[147342]],
              194834: [[28614]],
              194835: [[28729]],
              194836: [[28702]],
              194837: [[28699]],
              194838: [[15766]],
              194839: [[28746]],
              194840: [[28797]],
              194841: [[28791]],
              194842: [[28845]],
              194843: [[132389]],
              194844: [[28997]],
              194845: [[148067]],
              194846: [[29084]],
              194847: [[148395]],
              194848: [[29224]],
              194849: [[29237]],
              194850: [[29264]],
              194851: [[149e3]],
              194852: [[29312]],
              194853: [[29333]],
              194854: [[149301]],
              194855: [[149524]],
              194856: [[29562]],
              194857: [[29579]],
              194858: [[16044]],
              194859: [[29605]],
              194860: [[16056]],
              194861: [[16056]],
              194862: [[29767]],
              194863: [[29788]],
              194864: [[29809]],
              194865: [[29829]],
              194866: [[29898]],
              194867: [[16155]],
              194868: [[29988]],
              194869: [[150582]],
              194870: [[30014]],
              194871: [[150674]],
              194872: [[30064]],
              194873: [[139679]],
              194874: [[30224]],
              194875: [[151457]],
              194876: [[151480]],
              194877: [[151620]],
              194878: [[16380]],
              194879: [[16392]],
              194880: [[30452]],
              194881: [[151795]],
              194882: [[151794]],
              194883: [[151833]],
              194884: [[151859]],
              194885: [[30494]],
              194886: [[30495]],
              194887: [[30495]],
              194888: [[30538]],
              194889: [[16441]],
              194890: [[30603]],
              194891: [[16454]],
              194892: [[16534]],
              194893: [[152605]],
              194894: [[30798]],
              194895: [[30860]],
              194896: [[30924]],
              194897: [[16611]],
              194898: [[153126]],
              194899: [[31062]],
              194900: [[153242]],
              194901: [[153285]],
              194902: [[31119]],
              194903: [[31211]],
              194904: [[16687]],
              194905: [[31296]],
              194906: [[31306]],
              194907: [[31311]],
              194908: [[153980]],
              194909: [[154279]],
              194910: [[154279]],
              194911: [[31470]],
              194912: [[16898]],
              194913: [[154539]],
              194914: [[31686]],
              194915: [[31689]],
              194916: [[16935]],
              194917: [[154752]],
              194918: [[31954]],
              194919: [[17056]],
              194920: [[31976]],
              194921: [[31971]],
              194922: [[32e3]],
              194923: [[155526]],
              194924: [[32099]],
              194925: [[17153]],
              194926: [[32199]],
              194927: [[32258]],
              194928: [[32325]],
              194929: [[17204]],
              194930: [[156200]],
              194931: [[156231]],
              194932: [[17241]],
              194933: [[156377]],
              194934: [[32634]],
              194935: [[156478]],
              194936: [[32661]],
              194937: [[32762]],
              194938: [[32773]],
              194939: [[156890]],
              194940: [[156963]],
              194941: [[32864]],
              194942: [[157096]],
              194943: [[32880]],
              194944: [[144223]],
              194945: [[17365]],
              194946: [[32946]],
              194947: [[33027]],
              194948: [[17419]],
              194949: [[33086]],
              194950: [[23221]],
              194951: [[157607]],
              194952: [[157621]],
              194953: [[144275]],
              194954: [[144284]],
              194955: [[33281]],
              194956: [[33284]],
              194957: [[36766]],
              194958: [[17515]],
              194959: [[33425]],
              194960: [[33419]],
              194961: [[33437]],
              194962: [[21171]],
              194963: [[33457]],
              194964: [[33459]],
              194965: [[33469]],
              194966: [[33510]],
              194967: [[158524]],
              194968: [[33509]],
              194969: [[33565]],
              194970: [[33635]],
              194971: [[33709]],
              194972: [[33571]],
              194973: [[33725]],
              194974: [[33767]],
              194975: [[33879]],
              194976: [[33619]],
              194977: [[33738]],
              194978: [[33740]],
              194979: [[33756]],
              194980: [[158774]],
              194981: [[159083]],
              194982: [[158933]],
              194983: [[17707]],
              194984: [[34033]],
              194985: [[34035]],
              194986: [[34070]],
              194987: [[160714]],
              194988: [[34148]],
              194989: [[159532]],
              194990: [[17757]],
              194991: [[17761]],
              194992: [[159665]],
              194993: [[159954]],
              194994: [[17771]],
              194995: [[34384]],
              194996: [[34396]],
              194997: [[34407]],
              194998: [[34409]],
              194999: [[34473]],
              195000: [[34440]],
              195001: [[34574]],
              195002: [[34530]],
              195003: [[34681]],
              195004: [[34600]],
              195005: [[34667]],
              195006: [[34694]],
              195007: [[17879]],
              195008: [[34785]],
              195009: [[34817]],
              195010: [[17913]],
              195011: [[34912]],
              195012: [[34915]],
              195013: [[161383]],
              195014: [[35031]],
              195015: [[35038]],
              195016: [[17973]],
              195017: [[35066]],
              195018: [[13499]],
              195019: [[161966]],
              195020: [[162150]],
              195021: [[18110]],
              195022: [[18119]],
              195023: [[35488]],
              195024: [[35565]],
              195025: [[35722]],
              195026: [[35925]],
              195027: [[162984]],
              195028: [[36011]],
              195029: [[36033]],
              195030: [[36123]],
              195031: [[36215]],
              195032: [[163631]],
              195033: [[133124]],
              195034: [[36299]],
              195035: [[36284]],
              195036: [[36336]],
              195037: [[133342]],
              195038: [[36564]],
              195039: [[36664]],
              195040: [[165330]],
              195041: [[165357]],
              195042: [[37012]],
              195043: [[37105]],
              195044: [[37137]],
              195045: [[165678]],
              195046: [[37147]],
              195047: [[37432]],
              195048: [[37591]],
              195049: [[37592]],
              195050: [[37500]],
              195051: [[37881]],
              195052: [[37909]],
              195053: [[166906]],
              195054: [[38283]],
              195055: [[18837]],
              195056: [[38327]],
              195057: [[167287]],
              195058: [[18918]],
              195059: [[38595]],
              195060: [[23986]],
              195061: [[38691]],
              195062: [[168261]],
              195063: [[168474]],
              195064: [[19054]],
              195065: [[19062]],
              195066: [[38880]],
              195067: [[168970]],
              195068: [[19122]],
              195069: [[169110]],
              195070: [[38923]],
              195071: [[38923]],
            },
            64000: {
              64000: [[20999]],
              64001: [[24230]],
              64002: [[25299]],
              64003: [[31958]],
              64004: [[23429]],
              64005: [[27934]],
              64006: [[26292]],
              64007: [[36667]],
              64008: [[34892]],
              64009: [[38477]],
              64010: [[35211]],
              64011: [[24275]],
              64012: [[20800]],
              64013: [[21952]],
              64016: [[22618]],
              64018: [[26228]],
              64021: [[20958]],
              64022: [[29482]],
              64023: [[30410]],
              64024: [[31036]],
              64025: [[31070]],
              64026: [[31077]],
              64027: [[31119]],
              64028: [[38742]],
              64029: [[31934]],
              64030: [[32701]],
              64032: [[34322]],
              64034: [[35576]],
              64037: [[36920]],
              64038: [[37117]],
              64042: [[39151]],
              64043: [[39164]],
              64044: [[39208]],
              64045: [[40372]],
              64046: [[37086]],
              64047: [[38583]],
              64048: [[20398]],
              64049: [[20711]],
              64050: [[20813]],
              64051: [[21193]],
              64052: [[21220]],
              64053: [[21329]],
              64054: [[21917]],
              64055: [[22022]],
              64056: [[22120]],
              64057: [[22592]],
              64058: [[22696]],
              64059: [[23652]],
              64060: [[23662]],
              64061: [[24724]],
              64062: [[24936]],
              64063: [[24974]],
              64064: [[25074]],
              64065: [[25935]],
              64066: [[26082]],
              64067: [[26257]],
              64068: [[26757]],
              64069: [[28023]],
              64070: [[28186]],
              64071: [[28450]],
              64072: [[29038]],
              64073: [[29227]],
              64074: [[29730]],
              64075: [[30865]],
              64076: [[31038]],
              64077: [[31049]],
              64078: [[31048]],
              64079: [[31056]],
              64080: [[31062]],
              64081: [[31069]],
              64082: [[31117]],
              64083: [[31118]],
              64084: [[31296]],
              64085: [[31361]],
              64086: [[31680]],
              64087: [[32244]],
              64088: [[32265]],
              64089: [[32321]],
              64090: [[32626]],
              64091: [[32773]],
              64092: [[33261]],
              64093: [[33401]],
              64094: [[33401]],
              64095: [[33879]],
              64096: [[35088]],
              64097: [[35222]],
              64098: [[35585]],
              64099: [[35641]],
              64100: [[36051]],
              64101: [[36104]],
              64102: [[36790]],
              64103: [[36920]],
              64104: [[38627]],
              64105: [[38911]],
              64106: [[38971]],
              64107: [[24693]],
              64108: [[148206]],
              64109: [[33304]],
              64112: [[20006]],
              64113: [[20917]],
              64114: [[20840]],
              64115: [[20352]],
              64116: [[20805]],
              64117: [[20864]],
              64118: [[21191]],
              64119: [[21242]],
              64120: [[21917]],
              64121: [[21845]],
              64122: [[21913]],
              64123: [[21986]],
              64124: [[22618]],
              64125: [[22707]],
              64126: [[22852]],
              64127: [[22868]],
              64128: [[23138]],
              64129: [[23336]],
              64130: [[24274]],
              64131: [[24281]],
              64132: [[24425]],
              64133: [[24493]],
              64134: [[24792]],
              64135: [[24910]],
              64136: [[24840]],
              64137: [[24974]],
              64138: [[24928]],
              64139: [[25074]],
              64140: [[25140]],
              64141: [[25540]],
              64142: [[25628]],
              64143: [[25682]],
              64144: [[25942]],
              64145: [[26228]],
              64146: [[26391]],
              64147: [[26395]],
              64148: [[26454]],
              64149: [[27513]],
              64150: [[27578]],
              64151: [[27969]],
              64152: [[28379]],
              64153: [[28363]],
              64154: [[28450]],
              64155: [[28702]],
              64156: [[29038]],
              64157: [[30631]],
              64158: [[29237]],
              64159: [[29359]],
              64160: [[29482]],
              64161: [[29809]],
              64162: [[29958]],
              64163: [[30011]],
              64164: [[30237]],
              64165: [[30239]],
              64166: [[30410]],
              64167: [[30427]],
              64168: [[30452]],
              64169: [[30538]],
              64170: [[30528]],
              64171: [[30924]],
              64172: [[31409]],
              64173: [[31680]],
              64174: [[31867]],
              64175: [[32091]],
              64176: [[32244]],
              64177: [[32574]],
              64178: [[32773]],
              64179: [[33618]],
              64180: [[33775]],
              64181: [[34681]],
              64182: [[35137]],
              64183: [[35206]],
              64184: [[35222]],
              64185: [[35519]],
              64186: [[35576]],
              64187: [[35531]],
              64188: [[35585]],
              64189: [[35582]],
              64190: [[35565]],
              64191: [[35641]],
              64192: [[35722]],
              64193: [[36104]],
              64194: [[36664]],
              64195: [[36978]],
              64196: [[37273]],
              64197: [[37494]],
              64198: [[38524]],
              64199: [[38627]],
              64200: [[38742]],
              64201: [[38875]],
              64202: [[38911]],
              64203: [[38923]],
              64204: [[38971]],
              64205: [[39698]],
              64206: [[40860]],
              64207: [[141386]],
              64208: [[141380]],
              64209: [[144341]],
              64210: [[15261]],
              64211: [[16408]],
              64212: [[16441]],
              64213: [[152137]],
              64214: [[154832]],
              64215: [[163539]],
              64216: [[40771]],
              64217: [[40846]],
              195072: [[38953]],
              195073: [[169398]],
              195074: [[39138]],
              195075: [[19251]],
              195076: [[39209]],
              195077: [[39335]],
              195078: [[39362]],
              195079: [[39422]],
              195080: [[19406]],
              195081: [[170800]],
              195082: [[39698]],
              195083: [[4e4]],
              195084: [[40189]],
              195085: [[19662]],
              195086: [[19693]],
              195087: [[40295]],
              195088: [[172238]],
              195089: [[19704]],
              195090: [[172293]],
              195091: [[172558]],
              195092: [[172689]],
              195093: [[40635]],
              195094: [[19798]],
              195095: [[40697]],
              195096: [[40702]],
              195097: [[40709]],
              195098: [[40719]],
              195099: [[40726]],
              195100: [[40763]],
              195101: [[173568]],
            },
            64256: {
              64256: [[102, 102], 256],
              64257: [[102, 105], 256],
              64258: [[102, 108], 256],
              64259: [[102, 102, 105], 256],
              64260: [[102, 102, 108], 256],
              64261: [[383, 116], 256],
              64262: [[115, 116], 256],
              64275: [[1396, 1398], 256],
              64276: [[1396, 1381], 256],
              64277: [[1396, 1387], 256],
              64278: [[1406, 1398], 256],
              64279: [[1396, 1389], 256],
              64285: [[1497, 1460], 512],
              64286: [, 26],
              64287: [[1522, 1463], 512],
              64288: [[1506], 256],
              64289: [[1488], 256],
              64290: [[1491], 256],
              64291: [[1492], 256],
              64292: [[1499], 256],
              64293: [[1500], 256],
              64294: [[1501], 256],
              64295: [[1512], 256],
              64296: [[1514], 256],
              64297: [[43], 256],
              64298: [[1513, 1473], 512],
              64299: [[1513, 1474], 512],
              64300: [[64329, 1473], 512],
              64301: [[64329, 1474], 512],
              64302: [[1488, 1463], 512],
              64303: [[1488, 1464], 512],
              64304: [[1488, 1468], 512],
              64305: [[1489, 1468], 512],
              64306: [[1490, 1468], 512],
              64307: [[1491, 1468], 512],
              64308: [[1492, 1468], 512],
              64309: [[1493, 1468], 512],
              64310: [[1494, 1468], 512],
              64312: [[1496, 1468], 512],
              64313: [[1497, 1468], 512],
              64314: [[1498, 1468], 512],
              64315: [[1499, 1468], 512],
              64316: [[1500, 1468], 512],
              64318: [[1502, 1468], 512],
              64320: [[1504, 1468], 512],
              64321: [[1505, 1468], 512],
              64323: [[1507, 1468], 512],
              64324: [[1508, 1468], 512],
              64326: [[1510, 1468], 512],
              64327: [[1511, 1468], 512],
              64328: [[1512, 1468], 512],
              64329: [[1513, 1468], 512],
              64330: [[1514, 1468], 512],
              64331: [[1493, 1465], 512],
              64332: [[1489, 1471], 512],
              64333: [[1499, 1471], 512],
              64334: [[1508, 1471], 512],
              64335: [[1488, 1500], 256],
              64336: [[1649], 256],
              64337: [[1649], 256],
              64338: [[1659], 256],
              64339: [[1659], 256],
              64340: [[1659], 256],
              64341: [[1659], 256],
              64342: [[1662], 256],
              64343: [[1662], 256],
              64344: [[1662], 256],
              64345: [[1662], 256],
              64346: [[1664], 256],
              64347: [[1664], 256],
              64348: [[1664], 256],
              64349: [[1664], 256],
              64350: [[1658], 256],
              64351: [[1658], 256],
              64352: [[1658], 256],
              64353: [[1658], 256],
              64354: [[1663], 256],
              64355: [[1663], 256],
              64356: [[1663], 256],
              64357: [[1663], 256],
              64358: [[1657], 256],
              64359: [[1657], 256],
              64360: [[1657], 256],
              64361: [[1657], 256],
              64362: [[1700], 256],
              64363: [[1700], 256],
              64364: [[1700], 256],
              64365: [[1700], 256],
              64366: [[1702], 256],
              64367: [[1702], 256],
              64368: [[1702], 256],
              64369: [[1702], 256],
              64370: [[1668], 256],
              64371: [[1668], 256],
              64372: [[1668], 256],
              64373: [[1668], 256],
              64374: [[1667], 256],
              64375: [[1667], 256],
              64376: [[1667], 256],
              64377: [[1667], 256],
              64378: [[1670], 256],
              64379: [[1670], 256],
              64380: [[1670], 256],
              64381: [[1670], 256],
              64382: [[1671], 256],
              64383: [[1671], 256],
              64384: [[1671], 256],
              64385: [[1671], 256],
              64386: [[1677], 256],
              64387: [[1677], 256],
              64388: [[1676], 256],
              64389: [[1676], 256],
              64390: [[1678], 256],
              64391: [[1678], 256],
              64392: [[1672], 256],
              64393: [[1672], 256],
              64394: [[1688], 256],
              64395: [[1688], 256],
              64396: [[1681], 256],
              64397: [[1681], 256],
              64398: [[1705], 256],
              64399: [[1705], 256],
              64400: [[1705], 256],
              64401: [[1705], 256],
              64402: [[1711], 256],
              64403: [[1711], 256],
              64404: [[1711], 256],
              64405: [[1711], 256],
              64406: [[1715], 256],
              64407: [[1715], 256],
              64408: [[1715], 256],
              64409: [[1715], 256],
              64410: [[1713], 256],
              64411: [[1713], 256],
              64412: [[1713], 256],
              64413: [[1713], 256],
              64414: [[1722], 256],
              64415: [[1722], 256],
              64416: [[1723], 256],
              64417: [[1723], 256],
              64418: [[1723], 256],
              64419: [[1723], 256],
              64420: [[1728], 256],
              64421: [[1728], 256],
              64422: [[1729], 256],
              64423: [[1729], 256],
              64424: [[1729], 256],
              64425: [[1729], 256],
              64426: [[1726], 256],
              64427: [[1726], 256],
              64428: [[1726], 256],
              64429: [[1726], 256],
              64430: [[1746], 256],
              64431: [[1746], 256],
              64432: [[1747], 256],
              64433: [[1747], 256],
              64467: [[1709], 256],
              64468: [[1709], 256],
              64469: [[1709], 256],
              64470: [[1709], 256],
              64471: [[1735], 256],
              64472: [[1735], 256],
              64473: [[1734], 256],
              64474: [[1734], 256],
              64475: [[1736], 256],
              64476: [[1736], 256],
              64477: [[1655], 256],
              64478: [[1739], 256],
              64479: [[1739], 256],
              64480: [[1733], 256],
              64481: [[1733], 256],
              64482: [[1737], 256],
              64483: [[1737], 256],
              64484: [[1744], 256],
              64485: [[1744], 256],
              64486: [[1744], 256],
              64487: [[1744], 256],
              64488: [[1609], 256],
              64489: [[1609], 256],
              64490: [[1574, 1575], 256],
              64491: [[1574, 1575], 256],
              64492: [[1574, 1749], 256],
              64493: [[1574, 1749], 256],
              64494: [[1574, 1608], 256],
              64495: [[1574, 1608], 256],
              64496: [[1574, 1735], 256],
              64497: [[1574, 1735], 256],
              64498: [[1574, 1734], 256],
              64499: [[1574, 1734], 256],
              64500: [[1574, 1736], 256],
              64501: [[1574, 1736], 256],
              64502: [[1574, 1744], 256],
              64503: [[1574, 1744], 256],
              64504: [[1574, 1744], 256],
              64505: [[1574, 1609], 256],
              64506: [[1574, 1609], 256],
              64507: [[1574, 1609], 256],
              64508: [[1740], 256],
              64509: [[1740], 256],
              64510: [[1740], 256],
              64511: [[1740], 256],
            },
            64512: {
              64512: [[1574, 1580], 256],
              64513: [[1574, 1581], 256],
              64514: [[1574, 1605], 256],
              64515: [[1574, 1609], 256],
              64516: [[1574, 1610], 256],
              64517: [[1576, 1580], 256],
              64518: [[1576, 1581], 256],
              64519: [[1576, 1582], 256],
              64520: [[1576, 1605], 256],
              64521: [[1576, 1609], 256],
              64522: [[1576, 1610], 256],
              64523: [[1578, 1580], 256],
              64524: [[1578, 1581], 256],
              64525: [[1578, 1582], 256],
              64526: [[1578, 1605], 256],
              64527: [[1578, 1609], 256],
              64528: [[1578, 1610], 256],
              64529: [[1579, 1580], 256],
              64530: [[1579, 1605], 256],
              64531: [[1579, 1609], 256],
              64532: [[1579, 1610], 256],
              64533: [[1580, 1581], 256],
              64534: [[1580, 1605], 256],
              64535: [[1581, 1580], 256],
              64536: [[1581, 1605], 256],
              64537: [[1582, 1580], 256],
              64538: [[1582, 1581], 256],
              64539: [[1582, 1605], 256],
              64540: [[1587, 1580], 256],
              64541: [[1587, 1581], 256],
              64542: [[1587, 1582], 256],
              64543: [[1587, 1605], 256],
              64544: [[1589, 1581], 256],
              64545: [[1589, 1605], 256],
              64546: [[1590, 1580], 256],
              64547: [[1590, 1581], 256],
              64548: [[1590, 1582], 256],
              64549: [[1590, 1605], 256],
              64550: [[1591, 1581], 256],
              64551: [[1591, 1605], 256],
              64552: [[1592, 1605], 256],
              64553: [[1593, 1580], 256],
              64554: [[1593, 1605], 256],
              64555: [[1594, 1580], 256],
              64556: [[1594, 1605], 256],
              64557: [[1601, 1580], 256],
              64558: [[1601, 1581], 256],
              64559: [[1601, 1582], 256],
              64560: [[1601, 1605], 256],
              64561: [[1601, 1609], 256],
              64562: [[1601, 1610], 256],
              64563: [[1602, 1581], 256],
              64564: [[1602, 1605], 256],
              64565: [[1602, 1609], 256],
              64566: [[1602, 1610], 256],
              64567: [[1603, 1575], 256],
              64568: [[1603, 1580], 256],
              64569: [[1603, 1581], 256],
              64570: [[1603, 1582], 256],
              64571: [[1603, 1604], 256],
              64572: [[1603, 1605], 256],
              64573: [[1603, 1609], 256],
              64574: [[1603, 1610], 256],
              64575: [[1604, 1580], 256],
              64576: [[1604, 1581], 256],
              64577: [[1604, 1582], 256],
              64578: [[1604, 1605], 256],
              64579: [[1604, 1609], 256],
              64580: [[1604, 1610], 256],
              64581: [[1605, 1580], 256],
              64582: [[1605, 1581], 256],
              64583: [[1605, 1582], 256],
              64584: [[1605, 1605], 256],
              64585: [[1605, 1609], 256],
              64586: [[1605, 1610], 256],
              64587: [[1606, 1580], 256],
              64588: [[1606, 1581], 256],
              64589: [[1606, 1582], 256],
              64590: [[1606, 1605], 256],
              64591: [[1606, 1609], 256],
              64592: [[1606, 1610], 256],
              64593: [[1607, 1580], 256],
              64594: [[1607, 1605], 256],
              64595: [[1607, 1609], 256],
              64596: [[1607, 1610], 256],
              64597: [[1610, 1580], 256],
              64598: [[1610, 1581], 256],
              64599: [[1610, 1582], 256],
              64600: [[1610, 1605], 256],
              64601: [[1610, 1609], 256],
              64602: [[1610, 1610], 256],
              64603: [[1584, 1648], 256],
              64604: [[1585, 1648], 256],
              64605: [[1609, 1648], 256],
              64606: [[32, 1612, 1617], 256],
              64607: [[32, 1613, 1617], 256],
              64608: [[32, 1614, 1617], 256],
              64609: [[32, 1615, 1617], 256],
              64610: [[32, 1616, 1617], 256],
              64611: [[32, 1617, 1648], 256],
              64612: [[1574, 1585], 256],
              64613: [[1574, 1586], 256],
              64614: [[1574, 1605], 256],
              64615: [[1574, 1606], 256],
              64616: [[1574, 1609], 256],
              64617: [[1574, 1610], 256],
              64618: [[1576, 1585], 256],
              64619: [[1576, 1586], 256],
              64620: [[1576, 1605], 256],
              64621: [[1576, 1606], 256],
              64622: [[1576, 1609], 256],
              64623: [[1576, 1610], 256],
              64624: [[1578, 1585], 256],
              64625: [[1578, 1586], 256],
              64626: [[1578, 1605], 256],
              64627: [[1578, 1606], 256],
              64628: [[1578, 1609], 256],
              64629: [[1578, 1610], 256],
              64630: [[1579, 1585], 256],
              64631: [[1579, 1586], 256],
              64632: [[1579, 1605], 256],
              64633: [[1579, 1606], 256],
              64634: [[1579, 1609], 256],
              64635: [[1579, 1610], 256],
              64636: [[1601, 1609], 256],
              64637: [[1601, 1610], 256],
              64638: [[1602, 1609], 256],
              64639: [[1602, 1610], 256],
              64640: [[1603, 1575], 256],
              64641: [[1603, 1604], 256],
              64642: [[1603, 1605], 256],
              64643: [[1603, 1609], 256],
              64644: [[1603, 1610], 256],
              64645: [[1604, 1605], 256],
              64646: [[1604, 1609], 256],
              64647: [[1604, 1610], 256],
              64648: [[1605, 1575], 256],
              64649: [[1605, 1605], 256],
              64650: [[1606, 1585], 256],
              64651: [[1606, 1586], 256],
              64652: [[1606, 1605], 256],
              64653: [[1606, 1606], 256],
              64654: [[1606, 1609], 256],
              64655: [[1606, 1610], 256],
              64656: [[1609, 1648], 256],
              64657: [[1610, 1585], 256],
              64658: [[1610, 1586], 256],
              64659: [[1610, 1605], 256],
              64660: [[1610, 1606], 256],
              64661: [[1610, 1609], 256],
              64662: [[1610, 1610], 256],
              64663: [[1574, 1580], 256],
              64664: [[1574, 1581], 256],
              64665: [[1574, 1582], 256],
              64666: [[1574, 1605], 256],
              64667: [[1574, 1607], 256],
              64668: [[1576, 1580], 256],
              64669: [[1576, 1581], 256],
              64670: [[1576, 1582], 256],
              64671: [[1576, 1605], 256],
              64672: [[1576, 1607], 256],
              64673: [[1578, 1580], 256],
              64674: [[1578, 1581], 256],
              64675: [[1578, 1582], 256],
              64676: [[1578, 1605], 256],
              64677: [[1578, 1607], 256],
              64678: [[1579, 1605], 256],
              64679: [[1580, 1581], 256],
              64680: [[1580, 1605], 256],
              64681: [[1581, 1580], 256],
              64682: [[1581, 1605], 256],
              64683: [[1582, 1580], 256],
              64684: [[1582, 1605], 256],
              64685: [[1587, 1580], 256],
              64686: [[1587, 1581], 256],
              64687: [[1587, 1582], 256],
              64688: [[1587, 1605], 256],
              64689: [[1589, 1581], 256],
              64690: [[1589, 1582], 256],
              64691: [[1589, 1605], 256],
              64692: [[1590, 1580], 256],
              64693: [[1590, 1581], 256],
              64694: [[1590, 1582], 256],
              64695: [[1590, 1605], 256],
              64696: [[1591, 1581], 256],
              64697: [[1592, 1605], 256],
              64698: [[1593, 1580], 256],
              64699: [[1593, 1605], 256],
              64700: [[1594, 1580], 256],
              64701: [[1594, 1605], 256],
              64702: [[1601, 1580], 256],
              64703: [[1601, 1581], 256],
              64704: [[1601, 1582], 256],
              64705: [[1601, 1605], 256],
              64706: [[1602, 1581], 256],
              64707: [[1602, 1605], 256],
              64708: [[1603, 1580], 256],
              64709: [[1603, 1581], 256],
              64710: [[1603, 1582], 256],
              64711: [[1603, 1604], 256],
              64712: [[1603, 1605], 256],
              64713: [[1604, 1580], 256],
              64714: [[1604, 1581], 256],
              64715: [[1604, 1582], 256],
              64716: [[1604, 1605], 256],
              64717: [[1604, 1607], 256],
              64718: [[1605, 1580], 256],
              64719: [[1605, 1581], 256],
              64720: [[1605, 1582], 256],
              64721: [[1605, 1605], 256],
              64722: [[1606, 1580], 256],
              64723: [[1606, 1581], 256],
              64724: [[1606, 1582], 256],
              64725: [[1606, 1605], 256],
              64726: [[1606, 1607], 256],
              64727: [[1607, 1580], 256],
              64728: [[1607, 1605], 256],
              64729: [[1607, 1648], 256],
              64730: [[1610, 1580], 256],
              64731: [[1610, 1581], 256],
              64732: [[1610, 1582], 256],
              64733: [[1610, 1605], 256],
              64734: [[1610, 1607], 256],
              64735: [[1574, 1605], 256],
              64736: [[1574, 1607], 256],
              64737: [[1576, 1605], 256],
              64738: [[1576, 1607], 256],
              64739: [[1578, 1605], 256],
              64740: [[1578, 1607], 256],
              64741: [[1579, 1605], 256],
              64742: [[1579, 1607], 256],
              64743: [[1587, 1605], 256],
              64744: [[1587, 1607], 256],
              64745: [[1588, 1605], 256],
              64746: [[1588, 1607], 256],
              64747: [[1603, 1604], 256],
              64748: [[1603, 1605], 256],
              64749: [[1604, 1605], 256],
              64750: [[1606, 1605], 256],
              64751: [[1606, 1607], 256],
              64752: [[1610, 1605], 256],
              64753: [[1610, 1607], 256],
              64754: [[1600, 1614, 1617], 256],
              64755: [[1600, 1615, 1617], 256],
              64756: [[1600, 1616, 1617], 256],
              64757: [[1591, 1609], 256],
              64758: [[1591, 1610], 256],
              64759: [[1593, 1609], 256],
              64760: [[1593, 1610], 256],
              64761: [[1594, 1609], 256],
              64762: [[1594, 1610], 256],
              64763: [[1587, 1609], 256],
              64764: [[1587, 1610], 256],
              64765: [[1588, 1609], 256],
              64766: [[1588, 1610], 256],
              64767: [[1581, 1609], 256],
            },
            64768: {
              64768: [[1581, 1610], 256],
              64769: [[1580, 1609], 256],
              64770: [[1580, 1610], 256],
              64771: [[1582, 1609], 256],
              64772: [[1582, 1610], 256],
              64773: [[1589, 1609], 256],
              64774: [[1589, 1610], 256],
              64775: [[1590, 1609], 256],
              64776: [[1590, 1610], 256],
              64777: [[1588, 1580], 256],
              64778: [[1588, 1581], 256],
              64779: [[1588, 1582], 256],
              64780: [[1588, 1605], 256],
              64781: [[1588, 1585], 256],
              64782: [[1587, 1585], 256],
              64783: [[1589, 1585], 256],
              64784: [[1590, 1585], 256],
              64785: [[1591, 1609], 256],
              64786: [[1591, 1610], 256],
              64787: [[1593, 1609], 256],
              64788: [[1593, 1610], 256],
              64789: [[1594, 1609], 256],
              64790: [[1594, 1610], 256],
              64791: [[1587, 1609], 256],
              64792: [[1587, 1610], 256],
              64793: [[1588, 1609], 256],
              64794: [[1588, 1610], 256],
              64795: [[1581, 1609], 256],
              64796: [[1581, 1610], 256],
              64797: [[1580, 1609], 256],
              64798: [[1580, 1610], 256],
              64799: [[1582, 1609], 256],
              64800: [[1582, 1610], 256],
              64801: [[1589, 1609], 256],
              64802: [[1589, 1610], 256],
              64803: [[1590, 1609], 256],
              64804: [[1590, 1610], 256],
              64805: [[1588, 1580], 256],
              64806: [[1588, 1581], 256],
              64807: [[1588, 1582], 256],
              64808: [[1588, 1605], 256],
              64809: [[1588, 1585], 256],
              64810: [[1587, 1585], 256],
              64811: [[1589, 1585], 256],
              64812: [[1590, 1585], 256],
              64813: [[1588, 1580], 256],
              64814: [[1588, 1581], 256],
              64815: [[1588, 1582], 256],
              64816: [[1588, 1605], 256],
              64817: [[1587, 1607], 256],
              64818: [[1588, 1607], 256],
              64819: [[1591, 1605], 256],
              64820: [[1587, 1580], 256],
              64821: [[1587, 1581], 256],
              64822: [[1587, 1582], 256],
              64823: [[1588, 1580], 256],
              64824: [[1588, 1581], 256],
              64825: [[1588, 1582], 256],
              64826: [[1591, 1605], 256],
              64827: [[1592, 1605], 256],
              64828: [[1575, 1611], 256],
              64829: [[1575, 1611], 256],
              64848: [[1578, 1580, 1605], 256],
              64849: [[1578, 1581, 1580], 256],
              64850: [[1578, 1581, 1580], 256],
              64851: [[1578, 1581, 1605], 256],
              64852: [[1578, 1582, 1605], 256],
              64853: [[1578, 1605, 1580], 256],
              64854: [[1578, 1605, 1581], 256],
              64855: [[1578, 1605, 1582], 256],
              64856: [[1580, 1605, 1581], 256],
              64857: [[1580, 1605, 1581], 256],
              64858: [[1581, 1605, 1610], 256],
              64859: [[1581, 1605, 1609], 256],
              64860: [[1587, 1581, 1580], 256],
              64861: [[1587, 1580, 1581], 256],
              64862: [[1587, 1580, 1609], 256],
              64863: [[1587, 1605, 1581], 256],
              64864: [[1587, 1605, 1581], 256],
              64865: [[1587, 1605, 1580], 256],
              64866: [[1587, 1605, 1605], 256],
              64867: [[1587, 1605, 1605], 256],
              64868: [[1589, 1581, 1581], 256],
              64869: [[1589, 1581, 1581], 256],
              64870: [[1589, 1605, 1605], 256],
              64871: [[1588, 1581, 1605], 256],
              64872: [[1588, 1581, 1605], 256],
              64873: [[1588, 1580, 1610], 256],
              64874: [[1588, 1605, 1582], 256],
              64875: [[1588, 1605, 1582], 256],
              64876: [[1588, 1605, 1605], 256],
              64877: [[1588, 1605, 1605], 256],
              64878: [[1590, 1581, 1609], 256],
              64879: [[1590, 1582, 1605], 256],
              64880: [[1590, 1582, 1605], 256],
              64881: [[1591, 1605, 1581], 256],
              64882: [[1591, 1605, 1581], 256],
              64883: [[1591, 1605, 1605], 256],
              64884: [[1591, 1605, 1610], 256],
              64885: [[1593, 1580, 1605], 256],
              64886: [[1593, 1605, 1605], 256],
              64887: [[1593, 1605, 1605], 256],
              64888: [[1593, 1605, 1609], 256],
              64889: [[1594, 1605, 1605], 256],
              64890: [[1594, 1605, 1610], 256],
              64891: [[1594, 1605, 1609], 256],
              64892: [[1601, 1582, 1605], 256],
              64893: [[1601, 1582, 1605], 256],
              64894: [[1602, 1605, 1581], 256],
              64895: [[1602, 1605, 1605], 256],
              64896: [[1604, 1581, 1605], 256],
              64897: [[1604, 1581, 1610], 256],
              64898: [[1604, 1581, 1609], 256],
              64899: [[1604, 1580, 1580], 256],
              64900: [[1604, 1580, 1580], 256],
              64901: [[1604, 1582, 1605], 256],
              64902: [[1604, 1582, 1605], 256],
              64903: [[1604, 1605, 1581], 256],
              64904: [[1604, 1605, 1581], 256],
              64905: [[1605, 1581, 1580], 256],
              64906: [[1605, 1581, 1605], 256],
              64907: [[1605, 1581, 1610], 256],
              64908: [[1605, 1580, 1581], 256],
              64909: [[1605, 1580, 1605], 256],
              64910: [[1605, 1582, 1580], 256],
              64911: [[1605, 1582, 1605], 256],
              64914: [[1605, 1580, 1582], 256],
              64915: [[1607, 1605, 1580], 256],
              64916: [[1607, 1605, 1605], 256],
              64917: [[1606, 1581, 1605], 256],
              64918: [[1606, 1581, 1609], 256],
              64919: [[1606, 1580, 1605], 256],
              64920: [[1606, 1580, 1605], 256],
              64921: [[1606, 1580, 1609], 256],
              64922: [[1606, 1605, 1610], 256],
              64923: [[1606, 1605, 1609], 256],
              64924: [[1610, 1605, 1605], 256],
              64925: [[1610, 1605, 1605], 256],
              64926: [[1576, 1582, 1610], 256],
              64927: [[1578, 1580, 1610], 256],
              64928: [[1578, 1580, 1609], 256],
              64929: [[1578, 1582, 1610], 256],
              64930: [[1578, 1582, 1609], 256],
              64931: [[1578, 1605, 1610], 256],
              64932: [[1578, 1605, 1609], 256],
              64933: [[1580, 1605, 1610], 256],
              64934: [[1580, 1581, 1609], 256],
              64935: [[1580, 1605, 1609], 256],
              64936: [[1587, 1582, 1609], 256],
              64937: [[1589, 1581, 1610], 256],
              64938: [[1588, 1581, 1610], 256],
              64939: [[1590, 1581, 1610], 256],
              64940: [[1604, 1580, 1610], 256],
              64941: [[1604, 1605, 1610], 256],
              64942: [[1610, 1581, 1610], 256],
              64943: [[1610, 1580, 1610], 256],
              64944: [[1610, 1605, 1610], 256],
              64945: [[1605, 1605, 1610], 256],
              64946: [[1602, 1605, 1610], 256],
              64947: [[1606, 1581, 1610], 256],
              64948: [[1602, 1605, 1581], 256],
              64949: [[1604, 1581, 1605], 256],
              64950: [[1593, 1605, 1610], 256],
              64951: [[1603, 1605, 1610], 256],
              64952: [[1606, 1580, 1581], 256],
              64953: [[1605, 1582, 1610], 256],
              64954: [[1604, 1580, 1605], 256],
              64955: [[1603, 1605, 1605], 256],
              64956: [[1604, 1580, 1605], 256],
              64957: [[1606, 1580, 1581], 256],
              64958: [[1580, 1581, 1610], 256],
              64959: [[1581, 1580, 1610], 256],
              64960: [[1605, 1580, 1610], 256],
              64961: [[1601, 1605, 1610], 256],
              64962: [[1576, 1581, 1610], 256],
              64963: [[1603, 1605, 1605], 256],
              64964: [[1593, 1580, 1605], 256],
              64965: [[1589, 1605, 1605], 256],
              64966: [[1587, 1582, 1610], 256],
              64967: [[1606, 1580, 1610], 256],
              65008: [[1589, 1604, 1746], 256],
              65009: [[1602, 1604, 1746], 256],
              65010: [[1575, 1604, 1604, 1607], 256],
              65011: [[1575, 1603, 1576, 1585], 256],
              65012: [[1605, 1581, 1605, 1583], 256],
              65013: [[1589, 1604, 1593, 1605], 256],
              65014: [[1585, 1587, 1608, 1604], 256],
              65015: [[1593, 1604, 1610, 1607], 256],
              65016: [[1608, 1587, 1604, 1605], 256],
              65017: [[1589, 1604, 1609], 256],
              65018: [
                [
                  1589, 1604, 1609, 32, 1575, 1604, 1604, 1607, 32, 1593, 1604,
                  1610, 1607, 32, 1608, 1587, 1604, 1605,
                ],
                256,
              ],
              65019: [[1580, 1604, 32, 1580, 1604, 1575, 1604, 1607], 256],
              65020: [[1585, 1740, 1575, 1604], 256],
            },
            65024: {
              65040: [[44], 256],
              65041: [[12289], 256],
              65042: [[12290], 256],
              65043: [[58], 256],
              65044: [[59], 256],
              65045: [[33], 256],
              65046: [[63], 256],
              65047: [[12310], 256],
              65048: [[12311], 256],
              65049: [[8230], 256],
              65056: [, 230],
              65057: [, 230],
              65058: [, 230],
              65059: [, 230],
              65060: [, 230],
              65061: [, 230],
              65062: [, 230],
              65063: [, 220],
              65064: [, 220],
              65065: [, 220],
              65066: [, 220],
              65067: [, 220],
              65068: [, 220],
              65069: [, 220],
              65072: [[8229], 256],
              65073: [[8212], 256],
              65074: [[8211], 256],
              65075: [[95], 256],
              65076: [[95], 256],
              65077: [[40], 256],
              65078: [[41], 256],
              65079: [[123], 256],
              65080: [[125], 256],
              65081: [[12308], 256],
              65082: [[12309], 256],
              65083: [[12304], 256],
              65084: [[12305], 256],
              65085: [[12298], 256],
              65086: [[12299], 256],
              65087: [[12296], 256],
              65088: [[12297], 256],
              65089: [[12300], 256],
              65090: [[12301], 256],
              65091: [[12302], 256],
              65092: [[12303], 256],
              65095: [[91], 256],
              65096: [[93], 256],
              65097: [[8254], 256],
              65098: [[8254], 256],
              65099: [[8254], 256],
              65100: [[8254], 256],
              65101: [[95], 256],
              65102: [[95], 256],
              65103: [[95], 256],
              65104: [[44], 256],
              65105: [[12289], 256],
              65106: [[46], 256],
              65108: [[59], 256],
              65109: [[58], 256],
              65110: [[63], 256],
              65111: [[33], 256],
              65112: [[8212], 256],
              65113: [[40], 256],
              65114: [[41], 256],
              65115: [[123], 256],
              65116: [[125], 256],
              65117: [[12308], 256],
              65118: [[12309], 256],
              65119: [[35], 256],
              65120: [[38], 256],
              65121: [[42], 256],
              65122: [[43], 256],
              65123: [[45], 256],
              65124: [[60], 256],
              65125: [[62], 256],
              65126: [[61], 256],
              65128: [[92], 256],
              65129: [[36], 256],
              65130: [[37], 256],
              65131: [[64], 256],
              65136: [[32, 1611], 256],
              65137: [[1600, 1611], 256],
              65138: [[32, 1612], 256],
              65140: [[32, 1613], 256],
              65142: [[32, 1614], 256],
              65143: [[1600, 1614], 256],
              65144: [[32, 1615], 256],
              65145: [[1600, 1615], 256],
              65146: [[32, 1616], 256],
              65147: [[1600, 1616], 256],
              65148: [[32, 1617], 256],
              65149: [[1600, 1617], 256],
              65150: [[32, 1618], 256],
              65151: [[1600, 1618], 256],
              65152: [[1569], 256],
              65153: [[1570], 256],
              65154: [[1570], 256],
              65155: [[1571], 256],
              65156: [[1571], 256],
              65157: [[1572], 256],
              65158: [[1572], 256],
              65159: [[1573], 256],
              65160: [[1573], 256],
              65161: [[1574], 256],
              65162: [[1574], 256],
              65163: [[1574], 256],
              65164: [[1574], 256],
              65165: [[1575], 256],
              65166: [[1575], 256],
              65167: [[1576], 256],
              65168: [[1576], 256],
              65169: [[1576], 256],
              65170: [[1576], 256],
              65171: [[1577], 256],
              65172: [[1577], 256],
              65173: [[1578], 256],
              65174: [[1578], 256],
              65175: [[1578], 256],
              65176: [[1578], 256],
              65177: [[1579], 256],
              65178: [[1579], 256],
              65179: [[1579], 256],
              65180: [[1579], 256],
              65181: [[1580], 256],
              65182: [[1580], 256],
              65183: [[1580], 256],
              65184: [[1580], 256],
              65185: [[1581], 256],
              65186: [[1581], 256],
              65187: [[1581], 256],
              65188: [[1581], 256],
              65189: [[1582], 256],
              65190: [[1582], 256],
              65191: [[1582], 256],
              65192: [[1582], 256],
              65193: [[1583], 256],
              65194: [[1583], 256],
              65195: [[1584], 256],
              65196: [[1584], 256],
              65197: [[1585], 256],
              65198: [[1585], 256],
              65199: [[1586], 256],
              65200: [[1586], 256],
              65201: [[1587], 256],
              65202: [[1587], 256],
              65203: [[1587], 256],
              65204: [[1587], 256],
              65205: [[1588], 256],
              65206: [[1588], 256],
              65207: [[1588], 256],
              65208: [[1588], 256],
              65209: [[1589], 256],
              65210: [[1589], 256],
              65211: [[1589], 256],
              65212: [[1589], 256],
              65213: [[1590], 256],
              65214: [[1590], 256],
              65215: [[1590], 256],
              65216: [[1590], 256],
              65217: [[1591], 256],
              65218: [[1591], 256],
              65219: [[1591], 256],
              65220: [[1591], 256],
              65221: [[1592], 256],
              65222: [[1592], 256],
              65223: [[1592], 256],
              65224: [[1592], 256],
              65225: [[1593], 256],
              65226: [[1593], 256],
              65227: [[1593], 256],
              65228: [[1593], 256],
              65229: [[1594], 256],
              65230: [[1594], 256],
              65231: [[1594], 256],
              65232: [[1594], 256],
              65233: [[1601], 256],
              65234: [[1601], 256],
              65235: [[1601], 256],
              65236: [[1601], 256],
              65237: [[1602], 256],
              65238: [[1602], 256],
              65239: [[1602], 256],
              65240: [[1602], 256],
              65241: [[1603], 256],
              65242: [[1603], 256],
              65243: [[1603], 256],
              65244: [[1603], 256],
              65245: [[1604], 256],
              65246: [[1604], 256],
              65247: [[1604], 256],
              65248: [[1604], 256],
              65249: [[1605], 256],
              65250: [[1605], 256],
              65251: [[1605], 256],
              65252: [[1605], 256],
              65253: [[1606], 256],
              65254: [[1606], 256],
              65255: [[1606], 256],
              65256: [[1606], 256],
              65257: [[1607], 256],
              65258: [[1607], 256],
              65259: [[1607], 256],
              65260: [[1607], 256],
              65261: [[1608], 256],
              65262: [[1608], 256],
              65263: [[1609], 256],
              65264: [[1609], 256],
              65265: [[1610], 256],
              65266: [[1610], 256],
              65267: [[1610], 256],
              65268: [[1610], 256],
              65269: [[1604, 1570], 256],
              65270: [[1604, 1570], 256],
              65271: [[1604, 1571], 256],
              65272: [[1604, 1571], 256],
              65273: [[1604, 1573], 256],
              65274: [[1604, 1573], 256],
              65275: [[1604, 1575], 256],
              65276: [[1604, 1575], 256],
            },
            65280: {
              65281: [[33], 256],
              65282: [[34], 256],
              65283: [[35], 256],
              65284: [[36], 256],
              65285: [[37], 256],
              65286: [[38], 256],
              65287: [[39], 256],
              65288: [[40], 256],
              65289: [[41], 256],
              65290: [[42], 256],
              65291: [[43], 256],
              65292: [[44], 256],
              65293: [[45], 256],
              65294: [[46], 256],
              65295: [[47], 256],
              65296: [[48], 256],
              65297: [[49], 256],
              65298: [[50], 256],
              65299: [[51], 256],
              65300: [[52], 256],
              65301: [[53], 256],
              65302: [[54], 256],
              65303: [[55], 256],
              65304: [[56], 256],
              65305: [[57], 256],
              65306: [[58], 256],
              65307: [[59], 256],
              65308: [[60], 256],
              65309: [[61], 256],
              65310: [[62], 256],
              65311: [[63], 256],
              65312: [[64], 256],
              65313: [[65], 256],
              65314: [[66], 256],
              65315: [[67], 256],
              65316: [[68], 256],
              65317: [[69], 256],
              65318: [[70], 256],
              65319: [[71], 256],
              65320: [[72], 256],
              65321: [[73], 256],
              65322: [[74], 256],
              65323: [[75], 256],
              65324: [[76], 256],
              65325: [[77], 256],
              65326: [[78], 256],
              65327: [[79], 256],
              65328: [[80], 256],
              65329: [[81], 256],
              65330: [[82], 256],
              65331: [[83], 256],
              65332: [[84], 256],
              65333: [[85], 256],
              65334: [[86], 256],
              65335: [[87], 256],
              65336: [[88], 256],
              65337: [[89], 256],
              65338: [[90], 256],
              65339: [[91], 256],
              65340: [[92], 256],
              65341: [[93], 256],
              65342: [[94], 256],
              65343: [[95], 256],
              65344: [[96], 256],
              65345: [[97], 256],
              65346: [[98], 256],
              65347: [[99], 256],
              65348: [[100], 256],
              65349: [[101], 256],
              65350: [[102], 256],
              65351: [[103], 256],
              65352: [[104], 256],
              65353: [[105], 256],
              65354: [[106], 256],
              65355: [[107], 256],
              65356: [[108], 256],
              65357: [[109], 256],
              65358: [[110], 256],
              65359: [[111], 256],
              65360: [[112], 256],
              65361: [[113], 256],
              65362: [[114], 256],
              65363: [[115], 256],
              65364: [[116], 256],
              65365: [[117], 256],
              65366: [[118], 256],
              65367: [[119], 256],
              65368: [[120], 256],
              65369: [[121], 256],
              65370: [[122], 256],
              65371: [[123], 256],
              65372: [[124], 256],
              65373: [[125], 256],
              65374: [[126], 256],
              65375: [[10629], 256],
              65376: [[10630], 256],
              65377: [[12290], 256],
              65378: [[12300], 256],
              65379: [[12301], 256],
              65380: [[12289], 256],
              65381: [[12539], 256],
              65382: [[12530], 256],
              65383: [[12449], 256],
              65384: [[12451], 256],
              65385: [[12453], 256],
              65386: [[12455], 256],
              65387: [[12457], 256],
              65388: [[12515], 256],
              65389: [[12517], 256],
              65390: [[12519], 256],
              65391: [[12483], 256],
              65392: [[12540], 256],
              65393: [[12450], 256],
              65394: [[12452], 256],
              65395: [[12454], 256],
              65396: [[12456], 256],
              65397: [[12458], 256],
              65398: [[12459], 256],
              65399: [[12461], 256],
              65400: [[12463], 256],
              65401: [[12465], 256],
              65402: [[12467], 256],
              65403: [[12469], 256],
              65404: [[12471], 256],
              65405: [[12473], 256],
              65406: [[12475], 256],
              65407: [[12477], 256],
              65408: [[12479], 256],
              65409: [[12481], 256],
              65410: [[12484], 256],
              65411: [[12486], 256],
              65412: [[12488], 256],
              65413: [[12490], 256],
              65414: [[12491], 256],
              65415: [[12492], 256],
              65416: [[12493], 256],
              65417: [[12494], 256],
              65418: [[12495], 256],
              65419: [[12498], 256],
              65420: [[12501], 256],
              65421: [[12504], 256],
              65422: [[12507], 256],
              65423: [[12510], 256],
              65424: [[12511], 256],
              65425: [[12512], 256],
              65426: [[12513], 256],
              65427: [[12514], 256],
              65428: [[12516], 256],
              65429: [[12518], 256],
              65430: [[12520], 256],
              65431: [[12521], 256],
              65432: [[12522], 256],
              65433: [[12523], 256],
              65434: [[12524], 256],
              65435: [[12525], 256],
              65436: [[12527], 256],
              65437: [[12531], 256],
              65438: [[12441], 256],
              65439: [[12442], 256],
              65440: [[12644], 256],
              65441: [[12593], 256],
              65442: [[12594], 256],
              65443: [[12595], 256],
              65444: [[12596], 256],
              65445: [[12597], 256],
              65446: [[12598], 256],
              65447: [[12599], 256],
              65448: [[12600], 256],
              65449: [[12601], 256],
              65450: [[12602], 256],
              65451: [[12603], 256],
              65452: [[12604], 256],
              65453: [[12605], 256],
              65454: [[12606], 256],
              65455: [[12607], 256],
              65456: [[12608], 256],
              65457: [[12609], 256],
              65458: [[12610], 256],
              65459: [[12611], 256],
              65460: [[12612], 256],
              65461: [[12613], 256],
              65462: [[12614], 256],
              65463: [[12615], 256],
              65464: [[12616], 256],
              65465: [[12617], 256],
              65466: [[12618], 256],
              65467: [[12619], 256],
              65468: [[12620], 256],
              65469: [[12621], 256],
              65470: [[12622], 256],
              65474: [[12623], 256],
              65475: [[12624], 256],
              65476: [[12625], 256],
              65477: [[12626], 256],
              65478: [[12627], 256],
              65479: [[12628], 256],
              65482: [[12629], 256],
              65483: [[12630], 256],
              65484: [[12631], 256],
              65485: [[12632], 256],
              65486: [[12633], 256],
              65487: [[12634], 256],
              65490: [[12635], 256],
              65491: [[12636], 256],
              65492: [[12637], 256],
              65493: [[12638], 256],
              65494: [[12639], 256],
              65495: [[12640], 256],
              65498: [[12641], 256],
              65499: [[12642], 256],
              65500: [[12643], 256],
              65504: [[162], 256],
              65505: [[163], 256],
              65506: [[172], 256],
              65507: [[175], 256],
              65508: [[166], 256],
              65509: [[165], 256],
              65510: [[8361], 256],
              65512: [[9474], 256],
              65513: [[8592], 256],
              65514: [[8593], 256],
              65515: [[8594], 256],
              65516: [[8595], 256],
              65517: [[9632], 256],
              65518: [[9675], 256],
            },
          };
          S = { nfc: N, nfd: M, nfkc: D, nfkd: L };
          (t.unorm = S),
            (S.shimApplied = !1),
            String.prototype.normalize ||
              (Object.defineProperty(String.prototype, "normalize", {
                enumerable: !1,
                configurable: !0,
                writable: !0,
                value: function (e) {
                  var t = "" + this;
                  if ("NFC" === (e = void 0 === e ? "NFC" : e)) return S.nfc(t);
                  if ("NFD" === e) return S.nfd(t);
                  if ("NFKC" === e) return S.nfkc(t);
                  if ("NFKD" === e) return S.nfkd(t);
                  throw new RangeError("Invalid normalization form: " + e);
                },
              }),
              (S.shimApplied = !0)),
            (e.root = t),
            (e.DEFAULT_FEATURE = n),
            (e.CACHE_THRESHOLD = i),
            (e.SBase = r),
            (e.LBase = o),
            (e.VBase = a),
            (e.TBase = s),
            (e.LCount = l),
            (e.VCount = c),
            (e.TCount = d),
            (e.NCount = u),
            (e.SCount = h),
            (e.UChar = p),
            (e.cache = f),
            (e.cacheCounter = m),
            (e.i = g),
            (e.strategies = v),
            (e.UCharIterator = y),
            (e.RecursDecompIterator = b),
            (e.DecompIterator = w),
            (e.CompIterator = x),
            (e.createIterator = C),
            (e.normalize = F),
            (e.unorm = S);
        })(this),
        i()
      );
    }),
    $__System.registerDynamic("11", ["5f"], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = /^[\s\u200b]+$/,
        r = function (e) {
          return null == e || void 0 == e || "" === e || "​" === e;
        },
        o = function (e, t, n) {
          return null == e || void 0 == e || "" == e
            ? ""
            : "string" != typeof e && "number" != typeof e
            ? e
            : ((e = (e + "")
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#39;")),
              t && (e = a(e)),
              e);
        },
        a = function (e) {
          return e
            .replace(/[[\]~`*\\$<]/g, "\\$&")
            .replace(/(\b_)|(_(?=\s))/g, "\\$&");
        },
        s = /^\s*(([\w-_]+:\/\/)|(www\.)|\w*\/)[\w-.\/?%&=:@]*/i,
        l =
          /^\s*(([\w-_]+:\/\/)|(www\.)|\w*\/)?[\w-.\/?%&=:@]+(\.jpe?g|png|gif|webp|svg|tiff)/i,
        c = function (e, t, n) {
          return e.replace(new RegExp("\\b" + t + "\\b", "gi"), n);
        },
        d = function (e, t) {
          var n = e.getHours() + "",
            i = e.getMinutes() + "",
            r = e.getSeconds() + "";
          return (
            (n.length < 2 ? "0" : "") +
            n +
            ":" +
            (i.length < 2 ? "0" : "") +
            i +
            (t ? (r.length < 2 ? "0" : "") + r : "")
          );
        },
        u = function (e, t, n) {
          if (!e) return t;
          t = t || "";
          var i = e.split(/[\\\/]/g),
            r = t.split(/[\\\/]/g);
          !n && i.pop();
          for (var o = 0; o < r.length; o++)
            "." != r[o] && (".." == r[o] ? i.pop() : i.push(r[o]));
          return i.join("/");
        },
        h = function (e) {
          return e.replace(/[\-\\\{\}\*\+\?\|\^\$\.\[\]\(\)\#]/g, "\\$&");
        };
      (String.prototype.replaceExact = function (e, t) {
        return c(this, e, t);
      }),
        (String.prototype.repeat = function (e) {
          return (
            (!$.isNumeric(e) || e < 0) && (e = 0),
            new Array(e - 0 + 1).join(this)
          );
        }),
        (String.prototype.startsWith =
          String.prototype.startsWith ||
          function (e) {
            return this.match("^" + e) === e;
          }),
        (String.prototype.endsWith =
          String.prototype.endsWith ||
          function (e) {
            return this.match(e + "$") === e;
          }),
        (String.prototype.format = function () {
          var e = arguments;
          return this.replace(/\{\d+\}/g, function (t) {
            return e[t.match(/\d+/)];
          });
        }),
        (String.prototype.trim = function () {
          return this.replace(/^\s+|\s+$/g, "");
        });
      for (
        var p = [
            { base: "A", letters: "AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ" },
            { base: "AA", letters: "Ꜳ" },
            { base: "AE", letters: "ÆǼǢ" },
            { base: "AO", letters: "Ꜵ" },
            { base: "AU", letters: "Ꜷ" },
            { base: "AV", letters: "ꜸꜺ" },
            { base: "AY", letters: "Ꜽ" },
            { base: "B", letters: "BⒷＢḂḄḆɃƂƁ" },
            { base: "C", letters: "CⒸＣĆĈĊČÇḈƇȻꜾ" },
            { base: "D", letters: "DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ" },
            { base: "DZ", letters: "ǱǄ" },
            { base: "Dz", letters: "ǲǅ" },
            { base: "E", letters: "EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ" },
            { base: "F", letters: "FⒻＦḞƑꝻ" },
            { base: "G", letters: "GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ" },
            { base: "H", letters: "HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ" },
            { base: "I", letters: "IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ" },
            { base: "J", letters: "JⒿＪĴɈ" },
            { base: "K", letters: "KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ" },
            { base: "L", letters: "LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ" },
            { base: "LJ", letters: "Ǉ" },
            { base: "Lj", letters: "ǈ" },
            { base: "M", letters: "MⓂＭḾṀṂⱮƜ" },
            { base: "N", letters: "NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ" },
            { base: "NJ", letters: "Ǌ" },
            { base: "Nj", letters: "ǋ" },
            {
              base: "O",
              letters: "OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ",
            },
            { base: "OI", letters: "Ƣ" },
            { base: "OO", letters: "Ꝏ" },
            { base: "OU", letters: "Ȣ" },
            { base: "OE", letters: "Œ" },
            { base: "oe", letters: "œ" },
            { base: "P", letters: "PⓅＰṔṖƤⱣꝐꝒꝔ" },
            { base: "Q", letters: "QⓆＱꝖꝘɊ" },
            { base: "R", letters: "RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ" },
            { base: "S", letters: "SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ" },
            { base: "T", letters: "TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ" },
            { base: "TZ", letters: "Ꜩ" },
            { base: "U", letters: "UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ" },
            { base: "V", letters: "VⓋＶṼṾƲꝞɅ" },
            { base: "VY", letters: "Ꝡ" },
            { base: "W", letters: "WⓌＷẀẂŴẆẄẈⱲ" },
            { base: "X", letters: "XⓍＸẊẌ" },
            { base: "Y", letters: "YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ" },
            { base: "Z", letters: "ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ" },
            { base: "a", letters: "aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ" },
            { base: "aa", letters: "ꜳ" },
            { base: "ae", letters: "æǽǣ" },
            { base: "ao", letters: "ꜵ" },
            { base: "au", letters: "ꜷ" },
            { base: "av", letters: "ꜹꜻ" },
            { base: "ay", letters: "ꜽ" },
            { base: "b", letters: "bⓑｂḃḅḇƀƃɓ" },
            { base: "c", letters: "cⓒｃćĉċčçḉƈȼꜿↄ" },
            { base: "d", letters: "dⓓｄḋďḍḑḓḏđƌɖɗꝺ" },
            { base: "dz", letters: "ǳǆ" },
            { base: "e", letters: "eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ" },
            { base: "f", letters: "fⓕｆḟƒꝼ" },
            { base: "g", letters: "gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ" },
            { base: "h", letters: "hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ" },
            { base: "hv", letters: "ƕ" },
            { base: "i", letters: "iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı" },
            { base: "j", letters: "jⓙｊĵǰɉ" },
            { base: "k", letters: "kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ" },
            { base: "l", letters: "lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ" },
            { base: "lj", letters: "ǉ" },
            { base: "m", letters: "mⓜｍḿṁṃɱɯ" },
            { base: "n", letters: "nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ" },
            { base: "nj", letters: "ǌ" },
            {
              base: "o",
              letters: "oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ",
            },
            { base: "oi", letters: "ƣ" },
            { base: "ou", letters: "ȣ" },
            { base: "oo", letters: "ꝏ" },
            { base: "p", letters: "pⓟｐṕṗƥᵽꝑꝓꝕ" },
            { base: "q", letters: "qⓠｑɋꝗꝙ" },
            { base: "r", letters: "rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ" },
            { base: "s", letters: "sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ" },
            { base: "t", letters: "tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ" },
            { base: "tz", letters: "ꜩ" },
            { base: "u", letters: "uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ" },
            { base: "v", letters: "vⓥｖṽṿʋꝟʌ" },
            { base: "vy", letters: "ꝡ" },
            { base: "w", letters: "wⓦｗẁẃŵẇẅẘẉⱳ" },
            { base: "x", letters: "xⓧｘẋẍ" },
            { base: "y", letters: "yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ" },
            { base: "z", letters: "zⓩｚźẑżžẓẕƶȥɀⱬꝣ" },
          ],
          f = {},
          m = 0;
        m < p.length;
        m++
      )
        for (var g = p[m].letters, v = 0; v < g.length; v++)
          f[g[v]] = p[m].base;
      var y = {
          "\b": "\\b",
          "\t": "\\t",
          "\n": "\\n",
          "\f": "\\f",
          "\r": "\\r",
          '"': '\\"',
          "'": "\\'",
          "\\": "\\\\",
        },
        b = function (e) {
          return File.isMac
            ? (e.replace(/[\/]+$/, "").split("/") || []).last()
            : reqnode("path").basename(e);
        },
        w = b,
        x = {
          "&newline;": null,
          "&tab;": "\t",
          "&copy;": "©",
          "&amp;": "&",
          "&gt": ">",
          "&lt": "<",
          "&num;": "#",
        },
        C = document.createElement("textarea"),
        F = [
          [768, 879],
          [1155, 1158],
          [1160, 1161],
          [1425, 1469],
          [1471, 1471],
          [1473, 1474],
          [1476, 1477],
          [1479, 1479],
          [1536, 1539],
          [1552, 1557],
          [1611, 1630],
          [1648, 1648],
          [1750, 1764],
          [1767, 1768],
          [1770, 1773],
          [1807, 1807],
          [1809, 1809],
          [1840, 1866],
          [1958, 1968],
          [2027, 2035],
          [2305, 2306],
          [2364, 2364],
          [2369, 2376],
          [2381, 2381],
          [2385, 2388],
          [2402, 2403],
          [2433, 2433],
          [2492, 2492],
          [2497, 2500],
          [2509, 2509],
          [2530, 2531],
          [2561, 2562],
          [2620, 2620],
          [2625, 2626],
          [2631, 2632],
          [2635, 2637],
          [2672, 2673],
          [2689, 2690],
          [2748, 2748],
          [2753, 2757],
          [2759, 2760],
          [2765, 2765],
          [2786, 2787],
          [2817, 2817],
          [2876, 2876],
          [2879, 2879],
          [2881, 2883],
          [2893, 2893],
          [2902, 2902],
          [2946, 2946],
          [3008, 3008],
          [3021, 3021],
          [3134, 3136],
          [3142, 3144],
          [3146, 3149],
          [3157, 3158],
          [3260, 3260],
          [3263, 3263],
          [3270, 3270],
          [3276, 3277],
          [3298, 3299],
          [3393, 3395],
          [3405, 3405],
          [3530, 3530],
          [3538, 3540],
          [3542, 3542],
          [3633, 3633],
          [3636, 3642],
          [3655, 3662],
          [3761, 3761],
          [3764, 3769],
          [3771, 3772],
          [3784, 3789],
          [3864, 3865],
          [3893, 3893],
          [3895, 3895],
          [3897, 3897],
          [3953, 3966],
          [3968, 3972],
          [3974, 3975],
          [3984, 3991],
          [3993, 4028],
          [4038, 4038],
          [4141, 4144],
          [4146, 4146],
          [4150, 4151],
          [4153, 4153],
          [4184, 4185],
          [4448, 4607],
          [4959, 4959],
          [5906, 5908],
          [5938, 5940],
          [5970, 5971],
          [6002, 6003],
          [6068, 6069],
          [6071, 6077],
          [6086, 6086],
          [6089, 6099],
          [6109, 6109],
          [6155, 6157],
          [6313, 6313],
          [6432, 6434],
          [6439, 6440],
          [6450, 6450],
          [6457, 6459],
          [6679, 6680],
          [6912, 6915],
          [6964, 6964],
          [6966, 6970],
          [6972, 6972],
          [6978, 6978],
          [7019, 7027],
          [7616, 7626],
          [7678, 7679],
          [8203, 8207],
          [8234, 8238],
          [8288, 8291],
          [8298, 8303],
          [8400, 8431],
          [12330, 12335],
          [12441, 12442],
          [43014, 43014],
          [43019, 43019],
          [43045, 43046],
          [64286, 64286],
          [65024, 65039],
          [65056, 65059],
          [65279, 65279],
          [65529, 65531],
          [68097, 68099],
          [68101, 68102],
          [68108, 68111],
          [68152, 68154],
          [68159, 68159],
          [119143, 119145],
          [119155, 119170],
          [119173, 119179],
          [119210, 119213],
          [119362, 119364],
          [917505, 917505],
          [917536, 917631],
          [917760, 917999],
        ],
        S = { nul: 0, control: 0, tabSize: 4 };
      var k = function (e, t) {
        return 0 === e
          ? t.nul
          : 9 === e
          ? t.tabSize
          : e < 32 || (e >= 127 && e < 160)
          ? t.control
          : (function (e) {
              var t,
                n = 0,
                i = F.length - 1;
              if (e < F[0][0] || e > F[i][1]) return !1;
              for (; i >= n; )
                if (((t = Math.floor((n + i) / 2)), e > F[t][1])) n = t + 1;
                else {
                  if (!(e < F[t][0])) return !0;
                  i = t - 1;
                }
              return !1;
            })(e)
          ? 0
          : 1 +
            (e >= 4352 &&
              (e <= 4447 ||
                9001 == e ||
                9002 == e ||
                (e >= 11904 && e <= 42191 && 12351 != e) ||
                (e >= 44032 && e <= 55203) ||
                (e >= 63744 && e <= 64255) ||
                (e >= 65040 && e <= 65049) ||
                (e >= 65072 && e <= 65135) ||
                (e >= 65280 && e <= 65376) ||
                (e >= 65504 && e <= 65510) ||
                (e >= 131072 && e <= 196605) ||
                (e >= 196608 && e <= 262141)));
      };
      var E = function (e) {
        return 0 == e.indexOf("http://typora-app/")
          ? _options.appPath + "/" + e.substring("http://typora-app/".length)
          : 0 == e.indexOf("http://typora-theme/")
          ? "file://" +
            _options.currentThemeFolder +
            "/" +
            e.substring("http://typora-theme/".length)
          : e;
      };
      t.orDefault = function (e, t) {
        return null === e || void 0 === e ? t : e;
      };
      var T = window.reqnode && "win32" == process.platform ? "\\" : "/",
        _ = !!"".normalize;
      (t.isSamePath = function (e, t) {
        return (
          File.isMac &&
            _ &&
            ((e = (e || "").normalize()), (t = (t || "").normalize())),
          JSBridge.fsCaseInsensitive()
            ? e.toLowerCase() == t.toLowerCase()
            : e == t
        );
      }),
        (t.isAncestorPathOf = function (e, t) {
          return JSBridge.fsCaseInsensitive()
            ? 0 == t.toLowerCase().indexOf(e.toLowerCase() + T)
            : 0 == t.indexOf(e + T);
        });
      var A = function (e) {
        try {
          e = decodeURI(e);
        } catch (e) {}
        return e;
      };
      (t.decodeFromEscapedURL = A),
        (t.decodeFromEscapedPath = function (e) {
          try {
            var t = /[\\\/]/.exec(e) ? "//" : decodeURIComponent(e);
            e = /[\\\/]/.exec(t) ? decodeURI(e).replace(/%40/g, "@") : t;
          } catch (t) {
            try {
              e = decodeURI(e).replace(/%40/g, "@");
            } catch (e) {}
          }
          return e;
        }),
        (t.normalize = function (t, n) {
          return t.normalize || e("5f"), t.normalize(n);
        }),
        (t.titleToAnchor = function (e) {
          return e
            .toLowerCase()
            .trim()
            .replace(/—/g, "---")
            .replace(/–/g, "--")
            .replace(/ /g, "-")
            .replace(
              /[\u2000-\u206F\u2E00-\u2E7F\u3000-\u303F﹡﹨﹪-﹫！-＃％-（＊，．-／：-；？-＠［-＼｛｟｡-｢､-･\\'!"#$%&()*+,\.\/:;<=>?@\[\]^_`{|}~]/g,
              ""
            );
        }),
        (t.splitAnchor = function (e) {
          var t = e,
            n = /-(\d+)$/.exec(e);
          return (
            n &&
              ((n = n[1]),
              (t = e.substr(0, e.length - 1 - n.length)),
              (n = n - 0 - 1)),
            [e, t, n]
          );
        }),
        (t.floatToPercent = function (e) {
          return Math.round(100 * e) + "%";
        }),
        (t.dateToNumberString = function (e) {
          function t(e) {
            return e < 10 ? "0" + e : e;
          }
          var n;
          return (
            "" +
            e.getFullYear() +
            t(e.getMonth() + 1) +
            t(e.getDate()) +
            t(e.getHours()) +
            t(e.getMinutes()) +
            t(e.getSeconds()) +
            ((n = t(e.getMilliseconds())) < 100 ? "0" + n : n)
          );
        }),
        (t.escapeShell = function (e) {
          var t = [];
          return (
            e.forEach(function (e) {
              (e = JSON.stringify(e)), t.push(e);
            }),
            t.join(" ")
          );
        }),
        (t.truncate = function (e, t, n) {
          if (e.length <= t) return e;
          var i = t - (n = n || "…").length,
            r = Math.ceil(i / 2),
            o = Math.floor(i / 2);
          return e.substr(0, r) + n + e.substr(e.length - o);
        });
      var M = function (e) {
        return e.replace(/#[^.\/\\]+$/, "").replace(/\?[^\/\\]+/, "");
      };
      (t.trimPathParam = M),
        (t.absolutePathFrom = function (e) {
          var t = (e || "").replace(/^(wk)*file:(\/\/)*/, "");
          return (
            File.isWin && (t = t.replace(/^[\/\\]+/, "")),
            /^[a-z]+:/.exec(t) ||
              ((t = A(t)), (t = (t = M(t)).replace(/%23/g, "#"))),
            t
          );
        }),
        (t.compareVersion = function (e, t) {
          var n, i, r;
          for (
            e = e.split("."),
              t = t.split("."),
              i = Math.min(e.length, t.length),
              n = 0;
            n < i;
            n++
          )
            if (0 !== (r = parseInt(e[n], 10) - parseInt(t[n], 10))) return r;
          return e.length - t.length;
        }),
        (t.capitalize = function (e) {
          return e.length <= 1
            ? e.toUpperCase()
            : e[0].toUpperCase() + e.substr(1);
        }),
        (t.capitalizeEachWord = function (e) {
          return e
            .split(" ")
            .map((e) => (e[0] || "").toUpperCase() + e.substring(1))
            .join(" ");
        }),
        (t.hashCode = function (e) {
          var t = 0;
          if (!e) return t;
          for (var n = 0; n < e.length; n++) {
            (t = (t << 5) - t + e.charCodeAt(n)), (t &= t);
          }
          return t;
        });
      var L = 0;
      (t.tempString = function () {
        return L++, new Date() - 0 + "-" + L;
      }),
        (t.IMG_REG = /\.(png|jpg|jpeg|svg|gif|bmp|webp|tiff)$/i),
        (t.VIDEO_REG =
          /\.(mp4|webm|mkv|flv|avi|mov|wmv|rm|rmvb|m4p|mpe?g|mpv|ogg)$/i),
        (t.AUDIO_REG = /\.(mp3|vox|wav|wma|w4a|m4p|wave|flac|aac)$/i),
        (t.decodeHtmlEntity = function (e) {
          var t = x[e];
          return (
            t ||
              ((C.innerHTML = e), (t = C.value) != e ? (x[e] = t) : (t = null)),
            t
          );
        }),
        (t.formateDateTime = function (e) {
          return (
            e.getFullYear() +
            "/" +
            (e.getMonth() + 1) +
            "/" +
            e.getDate() +
            "  " +
            d(e)
          );
        }),
        (t.formateTimeOnly = d),
        (t.formateDateOnly = function (e) {
          return e.getFullYear() + "-" + (e.getMonth() + 1) + "-" + e.getDate();
        }),
        (t.insert = function (e, t, n) {
          return t < (e = e || "").length
            ? e.substring(0, t) + n + e.substring(t)
            : e + n;
        }),
        (t.escape = function (e, t, n) {
          return (e = o(e, t));
        }),
        (t.escapeForPreWrap = o),
        (t.unescape = function (e) {
          return null == e || void 0 == e || "" == e
            ? ""
            : (e + "")
                .replace(/&amp;/g, "&")
                .replace(/&lt;/g, "<")
                .replace(/&gt;/g, ">")
                .replace(/&quot;/g, '"')
                .replace(/&#39;/g, "'");
        }),
        (t.escapeHead = function (e) {
          return e.replace(
            /(^ *)((#+)|(\+ +)|(\- +)|(\* +)|(\d+(\.|\)) +)|(```|~~~)|(>)|(-+\s*$))/,
            "$1\\$2"
          );
        }),
        (t.escapeMark = a),
        (t.escapeSelector = function (e) {
          return window.CSS && CSS.escape ? CSS.escape(e) : $.escapeSelector(e);
        }),
        (t.escapeStringReplace = function (e) {
          return e.replace(/\$/g, "$$$$");
        }),
        (t.escapeRegExp = h),
        (t.unicodeEscapesToPCRE2 = function (e) {
          for (
            var t = /((?:[^\\]|^)(?:\\\\)*)\\u([a-z0-9]{4})(?!\d)/g;
            e.match(t);

          )
            e = e.replace(t, "$1\\x{$2}");
          return e;
        }),
        (t.replaceAll = function (e, t, n) {
          return e.replaceAll
            ? e.replaceAll(t, n)
            : e.replace(new RegExp(h(t), "g"), n);
        }),
        (t.isDefined = function (e) {
          return null !== e && void 0 !== e;
        }),
        (t.isNullOrEmpty = r),
        (t.isNotNullOrEmpty = function (e) {
          return !r(e);
        }),
        (t.isNullOrBlank = function (e) {
          return null == e || void 0 == e || "" === e || i.exec(e);
        }),
        (t.replaceExact = c),
        (t.splitExact = function (e, t) {
          return e.split(new RegExp("\\b" + t + "\\b", "gi"));
        }),
        (t.trimArr = function (e) {
          if (e && e.length) {
            for (
              var t = 0, n = e.length - 1;
              0 === e[t].trim().length && t < n;

            )
              t++;
            for (; n > t && 0 === e[n].trim().length; ) n--;
            return e.slice(t, n + 1);
          }
          return e;
        }),
        (t.isURL = function (e) {
          return !(!s.exec(e) && !/\s*mailto:/.exec(e));
        }),
        (t.isImg = function (e) {
          return !!l.exec(e);
        }),
        (t.camelize = function (e) {
          return e.replace(/(?:^|_|-)(\w)/g, function (e, t, n) {
            return 0 == n ? t.toLowerCase() : t.toUpperCase();
          });
        }),
        (t.getRelativePath = function (e, t, n, i) {
          if (!e) return t;
          var r;
          if (((i = n || i), File.isNode))
            return (
              (r = reqnode("path").relative(e, t)),
              i && !r.match(/^\.\.?\//) && (r = "./" + r),
              r
            );
          e = e.replace(/\\\\/g, "/").replace(/^\.\//, "");
          var o,
            a = (t = t.replace(/\\\\/g, "/")).split(/\//g),
            s = e.split(/\//g),
            l = "",
            c = "";
          for (
            n || (l = a.pop()),
              "" == s.last() && s.pop(),
              "" == s[0] && s.shift(),
              "" == a[0] && a.shift(),
              o = a.join("/");
            0 !== o.indexOf(s.join("/"));

          )
            s.pop(), (c += "../");
          var d = a.slice(s.length);
          return (
            d.length && (c += d.join("/") + "/"),
            (r = (c + l).replace(/\/$/, "")),
            i && !r.match(/^\.\.?\//) && (r = "./" + r),
            r
          );
        }),
        (t.getAbsolutePath = u),
        (t.ensureAbsolutePath = function (e, t, n) {
          return File.isWin && /^[A-Z]{1,2}:/i.exec(t)
            ? t
            : /^~[\/\\]/.exec(t)
            ? File.option.userPath + t.substr(1)
            : /^[\/\\]/.exec(t)
            ? t
            : e
            ? u(e, t, n)
            : null;
        }),
        (t.getAbsoluteURL = function (e, t) {
          if (!t) return "";
          var n = t.replace(/^[\\\/]{2}/, "http://");
          return (
            (e = e || ""),
            n.match(/^[^:]+:\/\//)
              ? n
              : n.match(/^[\\\/]/)
              ? e.replace(/(^[^:]+:\/\/[^\/]+)\/.*/, "$1" + t)
              : u(e, n)
          );
        }),
        (t.isAbsolutePath = function (e) {
          return (
            !(!File.isWin || !/^[A-Z]{1,2}:/i.exec(e)) ||
            !!/^~[\/\\]/.exec(e) ||
            !!/^[\/\\]/.exec(e)
          );
        }),
        (t.getFilePathFromMacProxy = E),
        (t.getFilePathFromProxy = function (e) {
          return File.isMac
            ? E(e)
            : File.isNode && /^typora:\/\//.exec(e)
            ? (function (e) {
                if (/^typora:\/\//.exec(e)) {
                  try {
                    e = decodeURI(e);
                  } catch (e) {}
                  var t = e.substr(9 + "app/".length);
                  return (
                    /^userData/.exec(t) &&
                      (t = t.replace(
                        /^userData/,
                        window._options.userDataPath.replace(/\\/g, "\\\\")
                      )),
                    /current-theme\.css$/.exec(t) &&
                      (t = t.replace(
                        /current-theme\.css$/,
                        File.option.curTheme
                      )),
                    /^typemark/i.exec(t) &&
                      (t = t.replace(/^typemark/, window.dirname)),
                    (t = t.replace(/[?#][^\\\/]*$/, ""))
                  );
                }
                return e;
              })(e)
            : e;
        }),
        (t.useOrDefault = function (e, t) {
          return e.trim().length ? e : t;
        }),
        (t.removeDiacritics = function (e) {
          return (e || "").replace(/[^\u0000-\u007E]/g, function (e) {
            return f[e] || e;
          });
        }),
        (t.escapeInQuote = function (e) {
          return e
            .replace(/["'\\\b\t\n\f\r]/g, function (e) {
              return y[e];
            })
            .replace(/\u200b/g, "");
        }),
        (t.pathByDeleteLastComponent = function (e) {
          return File.isMac
            ? e.split("/").slice(0, -1).join("/")
            : reqnode("path").join(e, "..");
        }),
        (t.getFolder = b),
        (t.getFileName = w),
        (t.date2NaturalLang = function (e, t) {
          var n,
            i,
            r,
            o,
            a,
            s = new Date(),
            l = (s - e) / 1e3;
          return (
            l < 30
              ? (n = "just now")
              : l < 60
              ? (n = "1 minutes ago")
              : l < 3600
              ? (n = Math.floor((l + 30) / 60).toString() + " minutes ago")
              : l < 18e3 && s.getDay() == e.getDay()
              ? ((i = e.getHours()),
                (r = e.getMinutes()),
                (n = [(i > 9 ? "" : "0") + i, (r > 9 ? "" : "0") + r].join(
                  ":"
                )))
              : l < 172800 && s.getDay() == (e.getDay() + 1) % 7
              ? (n = t ? "Yesterday" : "yesterday")
              : l < 518400
              ? (n = Math.floor(l / 86400) + " days ago")
              : s.getYear() == e.getYear()
              ? ((a = e.getDate()),
                (n =
                  [
                    "Jan",
                    "Feb",
                    "Mar",
                    "Apr",
                    "May",
                    "Jun",
                    "Jul",
                    "Aug",
                    "Sep",
                    "Oct",
                    "Nov",
                    "Dec",
                  ][e.getMonth()] +
                  " " +
                  (a > 9 ? "" : "0") +
                  a))
              : ((o = e.getMonth() + 1),
                (a = e.getDate()),
                (n = [
                  e.getFullYear(),
                  (o > 9 ? "" : "0") + o,
                  (a > 9 ? "" : "0") + a,
                ].join("-"))),
            n
          );
        }),
        (t.abbreviatingWithTilde = function (e) {
          var t = File.option.userPath;
          if (File.isWin) return e;
          return t && 0 == e.indexOf(t + "/") ? "~" + e.substring(t.length) : e;
        }),
        (t.naturalCompare = function (e, t) {
          (e = e.toLowerCase()), (t = t.toLowerCase());
          var n = /([.,\s+-]+|\d+)/,
            i = /^\d/,
            r =
              /^(?:(jan(?:uary)?)|(feb(?:ruary)?)|(mar(?:ch)?)|(apr(?:il))|(may)|(jun(?:e)?)|(jul(?:y)?)|(aug(?:ust)?)|(sep(?:tember)?)|(oct(?:ober)?)|(nov(?:ember)?)|(dec(?:ember)?))$/;
          function o(e, t) {
            return t.exec(e)
              ? Array.from(r.exec(e)).findIndex(function (e, t) {
                  return t > 0 && !!e;
                })
              : -1;
          }
          function a(e) {
            return e.split(n).filter(function (e) {
              return !!e;
            });
          }
          function s(e, t) {
            if (e == t) return 0;
            var n = !!i.exec(e),
              a = !!i.exec(t);
            if (n && a) return Number(e) - Number(t);
            if (n || a) return n ? 1 : -1;
            var s = o(e, r),
              l = o(t, r);
            return s > 0 && l > 0 ? s - l : e.localeCompare(t);
          }
          var l = a(e),
            c = a(t),
            d = Math.min(l.length, c.length);
          for (m = 0; m < d; m++) {
            var u = s(l[m], c[m]);
            if (0 != u) return u;
          }
          return l.length - c.length;
        }),
        (t.wcswidth = function (e) {
          if (!e) return 0;
          var t,
            n,
            i,
            r = 0;
          if ("string" != typeof e) return k(e, S);
          for (var o = 0; o < e.length; o++) {
            if (
              ((t = e.charCodeAt(o)) >= 55296 &&
                t <= 56319 &&
                ((n = e.charCodeAt(++o)) >= 56320 && n <= 57343
                  ? (t = 1024 * (t - 55296) + (n - 56320) + 65536)
                  : o--),
              (i = k(t, S)) < 0)
            )
              return -1;
            r += i;
          }
          return r;
        }),
        (t.removeInvalidPathCh = function (e) {
          return e
            .replace(/[\u200b\u0000~\u0019\u007f~\u009f\\\/<>:"|?*]/g, "")
            .replace(/[\t\r\n]/g, " ")
            .replace(/([ .]+)$/, "");
        }),
        (t.isFullUrl = function (e) {
          return /^([a-z][a-z0-9+\-.]+):([^\/\/]{2}|\/{2})/i.exec(e);
        }),
        (t.fromExternalPath = function (e) {
          return !1;
        }),
        (t.file2wkfile = function (e) {
          return (e || "").replace(/^file:/i, "wkfile:");
        }),
        (t.wkfile2file = function (e) {
          return (e || "").replace(/^wkfile:/i, "file:");
        }),
        (t.escapeURL = function (e) {
          return (
            (e = e || ""),
            encodeURI(e.replace(/\\/g, "/"))
              .replace(/'/g, "%27")
              .replace(/"/g, "%22")
              .replace(/#/g, "%23")
          );
        }),
        (t.findLine = function (e, t) {
          for (
            var n = e.split(/\n/), i = 0, r = 0;
            t > 0 && i < n.length && t > r + n[i].length;

          )
            (r += n[i].length + 1), i++;
          return { line: n[i] || "", start: r };
        }),
        (t.isUTF8 = function (e) {
          for (var t = 0, n = Math.min(e.length, 12e3); t < n; )
            if (e[t] <= 126) t += 1;
            else if (
              194 <= e[t] &&
              e[t] <= 223 &&
              128 <= e[t + 1] &&
              e[t + 1] <= 191
            )
              t += 2;
            else if (
              (224 == e[t] &&
                160 <= e[t + 1] &&
                e[t + 1] <= 191 &&
                128 <= e[t + 2] &&
                e[t + 2] <= 191) ||
              (((225 <= e[t] && e[t] <= 236) || 238 == e[t] || 239 == e[t]) &&
                128 <= e[t + 1] &&
                e[t + 1] <= 191 &&
                128 <= e[t + 2] &&
                e[t + 2] <= 191) ||
              (237 == e[t] &&
                128 <= e[t + 1] &&
                e[t + 1] <= 159 &&
                128 <= e[t + 2] &&
                e[t + 2] <= 191)
            )
              t += 3;
            else {
              if (
                !(
                  (240 == e[t] &&
                    144 <= e[t + 1] &&
                    e[t + 1] <= 191 &&
                    128 <= e[t + 2] &&
                    e[t + 2] <= 191 &&
                    128 <= e[t + 3] &&
                    e[t + 3] <= 191) ||
                  (241 <= e[t] &&
                    e[t] <= 243 &&
                    128 <= e[t + 1] &&
                    e[t + 1] <= 191 &&
                    128 <= e[t + 2] &&
                    e[t + 2] <= 191 &&
                    128 <= e[t + 3] &&
                    e[t + 3] <= 191) ||
                  (244 == e[t] &&
                    128 <= e[t + 1] &&
                    e[t + 1] <= 143 &&
                    128 <= e[t + 2] &&
                    e[t + 2] <= 191 &&
                    128 <= e[t + 3] &&
                    e[t + 3] <= 191)
                )
              )
                return !1;
              t += 4;
            }
          return !0;
        }),
        (t.WESTERN_WORD_SPLITTER =
          /([<>\u3040-\uABFF\uD7A4-\uFAFF\s!-#%-\*,-\/:;\+\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65])/),
        (t.WESTERN_WORD_SPLITTER_SPELLCHECKER =
          /([_<>\u3040-\uABFF\uD7A4-\uFAFF\s!-#%-\*,-\/:;\+\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65])/),
        (t.NOT_WORD =
          /^[\s!-#%-\*,-\/:;\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/),
        (t.WORD_LETTER =
          /[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/);
    }),
    $__System.registerDynamic("13", ["11"], !0, function (e, t, n) {
      "use strict";
      var i = this || self,
        r = e("11"),
        o = {
          paragraph: "paragraph",
          heading: "heading",
          blockquote: "blockquote",
          fences: "fences",
          hr: "hr",
          def_link: "def_link",
          def_footnote: "def_footnote",
          table: "table",
          raw_edit: "raw_edit",
          meta_block: "meta_block",
          math_block: "math_block",
          html_block: "html_block",
          list: "list",
          toc: "toc",
          iframe: "iframe",
        },
        a = {
          list_item: "list_item",
          table_row: "table_row",
          table_cell: "table_cell",
        },
        s = {};
      Object.assign(s, o, a, {
        tab: "tab",
        plain: "plain",
        strong: "strong",
        em: "em",
        code: "code",
        underline: "underline",
        escape: "escape",
        autolink: "autolink",
        reflink: "reflink",
        refimg: "refimg",
        link: "link",
        url: "url",
        br: "br",
        tag: "tag",
        comment: "comment",
        atag: "atag",
        imgtag: "imgtag",
        del: "del",
        todo: "todo",
        image: "image",
        footnote: "footnote",
        attr: "attr",
        emoji: "emoji",
        inline_math: "inline_math",
        subscript: "subscript",
        superscript: "superscript",
        linebreak: "linebreak",
        highlight: "highlight",
        html_entity: "html_entity",
        pants: "pants",
        emptyline: "emptyline",
        softbreak: "softbreak",
        html_inline: "html_inline",
        ruby: "ruby",
      });
      var l = 0,
        c = function () {
          return "n" + l++;
        };
      class d {
        constructor(e) {
          (e = e || {}), (this.attributes = {});
          var t = e.id || e.cid || c();
          e.id || e.cid || this.set("id", t),
            d.pool.has(t) && console.warn("Duplicate Model"),
            d.pool.set(t, this),
            this.set(e),
            void 0 == e.text && this.set("text", this.get("text") || ""),
            e.children || this.set("children", new p());
        }
        isBlock(e) {
          return d.isBlock(this.get("type"), e);
        }
        isTopBlock() {
          return this.get("attachTo") && !this.get("parent");
        }
        isVirtualBlock() {
          return d.isVirtualBlock(this.get("type"));
        }
        getClosetBlock(e) {
          return this.isBlock(e) ? this : this.get("parent").getClosetBlock(e);
        }
        getTopBlock() {
          return this.isTopBlock() ? this : this.get("parent").getTopBlock();
        }
        isInline() {
          return !this.isBlock(!0);
        }
        getLastChild() {
          var e;
          try {
            e = this.get("children").at(this.get("children").length - 1);
          } catch (e) {
            return null;
          }
          return e ? e.getLastBrother(!1) : null;
        }
        getFirstChild() {
          var e;
          try {
            e = this.get("children").at(0);
          } catch (e) {
            return null;
          }
          return e && e.getFirstBrother();
        }
        escapedMark(e) {
          return e.replace(/\*/g, "*").replace(/_/g, "_").replace(/`/g, "`");
        }
        isLoose(e) {
          function t(e) {
            for (var t = e.getFirstChild(), n = 0, i = 0; t; ) {
              if (d.isType(t, s.paragraph)) n++;
              else {
                if (!d.isType(t, s.list)) return !0;
                if (d.isType(t.get("after"), s.paragraph) || t.isLoose())
                  return !0;
                i++;
              }
              t = t.get("after");
            }
            return !(n <= 1 && i <= 1);
          }
          for (var n = this.getFirstChild(), i = n, r = !1; i; ) {
            if (t(i)) {
              r = !0;
              break;
            }
            i = i.get("after");
          }
          if (e) for (i = n; i; ) i.set("tight", !r), (i = i.get("after"));
          return r;
        }
        safeGetStrAttr(e, t) {
          if ("href-title" == e)
            return (
              this.safeGetStrAttr("href") + " " + this.safeGetStrAttr("title")
            );
          var n = this.get(e) ? this.get(e) : "";
          return t ? r.escape(n) : n;
        }
        replaceWith(e) {
          e.id != this.id &&
            (e.get("after") && e.get("after").set("before", e.get("before")),
            e.get("before") && e.get("before").set("after", e.get("after")),
            e.set("parent", this.get("parent")),
            e.set("before", this.get("before")),
            e.set("after", this.get("after")),
            this.remove());
        }
        canContainBlock(e) {
          return d.canContainBlock(this.get("type"), e);
        }
        canNotDirectEdit() {
          return d.isType(this, s.hr, s.math_block, s.list, s.list_item, s.toc);
        }
        getText(e, t) {
          var n = [],
            i = this.get("children");
          if (((t = t || ""), this.canContainBlock(!0) || (i && i.length > 0)))
            i.sortedForEach(function (t) {
              n.push(t.getText(e));
            }),
              (n = n.join(t)),
              this.unset("text");
          else {
            if (this.get("type") == s.def_link)
              return this.get("href") + (this.get("title") || "");
            (n = this.get("text") || ""),
              e &&
                d.isType(this, s.heading, s.paragraph) &&
                (n = r.escapeHead(n));
          }
          return n;
        }
        getNthChild(e) {
          try {
            for (var t = this.getFirstChild(), n = 0; t && n < e; )
              n++, (t = t.get("after"));
            return t;
          } catch (e) {}
          return null;
        }
        getChildIndex() {
          for (var e = this.get("before"), t = 0; e; )
            (e = e.get("before")), t++;
          return t;
        }
        getVeryFirst(e) {
          return 0 == this.get("children").length
            ? this
            : (e ? this.getLastChild() : this.getFirstChild()).getVeryFirst(e);
        }
        getFirstBrother() {
          return this.getLastBrother(!0);
        }
        getLastBrother(e, t, n) {
          var i = e ? "before" : "after";
          if (this.isTopBlock()) {
            var r = this.get("in").blocks;
            if (t) return null;
            if (!n && r.length)
              return r.at(e ? 0 : r.length - 1).getLastBrother(e, !1, !0);
          }
          if (this.get(i)) {
            for (var o = this.attributes[i]; o.attributes[i]; )
              o = o.attributes[i];
            return o.getLastBrother(e, t, !0);
          }
          return this;
        }
        getVeryFirstBrotherIncludeTopBlock(e) {
          return this.getVeryFirstBrother(e, !0);
        }
        getVeryFirstBrother(e, t) {
          var n = e ? "before" : "after";
          return !t && this.isTopBlock()
            ? null
            : !this.get(n) && this.get("parent")
            ? this.get("parent").getVeryFirstBrother(e, t)
            : this.get(n)
            ? this.get(n).getVeryFirst(e)
            : null;
        }
        getClosetParagraphLevel() {
          return this;
        }
        contains(e) {
          return !!e && (this.id == e.id || this.contains(e.get("parent")));
        }
        closest() {
          for (var e = this.get("type"), t = 0; t < arguments.length; t++)
            if (e == arguments[t]) return this;
          var n = this.get("parent");
          return n ? d.prototype.closest.apply(n, arguments) : null;
        }
        isDeleted() {
          return void 0 == this.attributes;
        }
        _delete(e) {
          e && this.cid,
            this.attributes &&
              (this.set("in", null),
              e
                ? this.get("children")
                    .toArray()
                    .map(function (e) {
                      e.attributes.parent = null;
                    })
                : this.clearChildren()),
            d.pool.delete(this.cid),
            (this.attributes = void 0);
        }
        detach() {
          var e = this.get("before"),
            t = this.get("after");
          e && (e.attributes.after = t),
            t && (t.attributes.before = e),
            (this.attributes.before = void 0),
            (this.attributes.after = void 0),
            this.set("parent", null),
            this.set("attachTo", null);
        }
        remove(e) {
          this.detach(), this._delete(e);
        }
        _appendOrPrepend(e, t) {
          if (e == this) throw Error("trying to append this into this");
          if (!e) return e;
          e.detach();
          var n = t ? this.getFirstChild() : this.getLastChild();
          return (
            n
              ? t
                ? n.addBefore(e)
                : n.addAfter(e)
              : (e.set("parent", this), e.set("in", this.get("in"))),
            e
          );
        }
        prependChild(e) {
          return this._appendOrPrepend(e, !0);
        }
        appendChild(e) {
          return this._appendOrPrepend(e, !1);
        }
        appendChildrenTillEnd(e) {
          this.cid, e && e.cid;
          for (var t, n = e; n; )
            (t = n.get("after")), this.appendChild(n), (n = t);
        }
        addAfter(e) {
          if (e == this) throw Error("trying to insert this after this");
          e.detach();
          var t = this.get("after") || void 0;
          return (
            (this.attributes.after = e),
            (e.attributes.after = t),
            t &&
              ((t.attributes.before = e), (e.attributes.noCloseTag = void 0)),
            (e.attributes.before = this),
            e.set({
              parent: this.get("parent"),
              attachTo: this.get("attachTo"),
              in: this.get("in"),
            }),
            (this.attributes.noCloseTag = void 0),
            e
          );
        }
        addBefore(e) {
          if (e == this) throw Error("trying to insert this before this");
          e.detach();
          var t = this.get("before") || void 0;
          return (
            t
              ? t.addAfter(e)
              : ((e.attributes.after = this),
                (this.attributes.before = e),
                e.set({
                  parent: this.get("parent"),
                  attachTo: this.get("attachTo"),
                  in: this.get("in"),
                }),
                (e.attributes.noCloseTag = void 0)),
            e
          );
        }
        addAfterTillEnd(e) {
          for (var t, n = this, i = e; i; )
            (t = i.get("after")), n.addAfter(i), (n = i), (i = t);
        }
        addArrayAfter(e, t) {
          if (e && e.length) {
            var n = this;
            e.forEach((e) => {
              n.addAfter(e), (n = e);
            }),
              !t && u(e[0], e.last());
          }
        }
        addArrayBefore(e, t) {
          if (e && e.length) {
            for (var n = this, i = e.length - 1; i >= 0; i--) {
              let t = e[i];
              n.addBefore(t), (n = t);
            }
            !t && u(e[0], e.last());
          }
        }
        clearChildren() {
          this.get("children").forEach(function (e) {
            e.remove();
          });
        }
        get(e) {
          if (!this.attributes) {
            let e = new Error(
              `attributes for node has been deleted (${File.option.appVersion})`
            );
            if (i.debugMode) throw e;
            try {
              throw e;
            } catch (e) {
              window.Reporter.error(e);
            }
            return (
              console.sendError("attributes for node has been deleted", !0),
              null
            );
          }
          var t = this.attributes[e];
          switch (e) {
            case "text":
              return (
                (t = t || ""),
                d.isType(this, s.math_block) &&
                  (t = t.replace(/^(\w*)\$\$(\w*)$/m, "$1\\$$$$$2")),
                t
              );
            default:
              return t;
          }
        }
        set(e, t) {
          var n,
            i,
            r = this,
            o = this.get("in");
          if ("string" == typeof e) {
            switch (((i = this.get(e)), e)) {
              case "parent":
                i && i.attributes && i.get("children").remove(this),
                  t && t.get("children").add(this);
                break;
              case "before":
                if (
                  (i &&
                    i.attributes &&
                    i.attributes.after == this &&
                    (i.attributes.after = null),
                  t)
                ) {
                  var a = t.attributes.after && t.attributes.after.attributes;
                  a && a.before == t && (a.before = null),
                    (t.attributes.after = this),
                    (t.attributes.noCloseTag = void 0);
                }
                break;
              case "after":
                if (
                  (i &&
                    i.attributes &&
                    i.attributes.before == this &&
                    (i.attributes.before = null),
                  t)
                ) {
                  var l = t.attributes.before && t.attributes.before.attributes;
                  l && l.after == t && (l.after = null),
                    (t.attributes.before = this),
                    (this.attributes.noCloseTag = void 0);
                }
                break;
              case "attachTo":
                i && i.blocks.remove(this), t && t.blocks.add(this);
                break;
              case "in":
                if (i == t) break;
                var u = this.get("attachTo");
                i &&
                  (i.foot_list.remove(this),
                  i.link_list.remove(this),
                  i.allNodes.remove(this),
                  this.set("attachTo", null)),
                  t &&
                    (this.get("type") != s.def_footnote ||
                    t.foot_list.get(this.id)
                      ? this.get("type") != s.def_link ||
                        t.link_list.get(this.id) ||
                        t.link_list.push(this)
                      : t.foot_list.push(this),
                    t.allNodes.add(this),
                    u && this.set("attachTo", u)),
                  (this.get("children") || []).map((e) => {
                    e.set("in", t);
                  });
                break;
              case "id":
                t && ((this.id = t), (this.cid = t));
                break;
              case "ref":
                t = t
                  ? (t + "").replace(/\u200b/gi, "").replace(/\\?\]/gi, "\\]")
                  : t;
                break;
              case "href":
                t =
                  t && this.get("type") === s.def_link
                    ? (t || "").replace(/\[|\]|"]/gi, "")
                    : t;
                break;
              case "title":
                break;
              case "type":
                t != i &&
                  (h.forEach(function (e) {
                    this.attributes[e] = void 0;
                  }, this),
                  (this.attributes.ahead = void 0),
                  (this.attributes.tail = void 0),
                  (this.attributes.mathLabel = void 0),
                  (this.attributes.mathEqLabel = void 0));
                break;
              case "text":
                (t = t ? t.replace(/^\u200b/, "") : t),
                  function (e) {
                    if (
                      this.get("type") == s.table_cell &&
                      void 0 !== this.attributes.text
                    ) {
                      e != this.attributes.text &&
                        d.tryResetTable(this.closest(s.table));
                      var t =
                        (e || "").length - (this.attributes.text || "").length;
                      if (t) {
                        var n = this.attributes.marginLeft,
                          i = this.attributes.marginRight,
                          r = 0;
                        n &&
                          (i.length > n.length &&
                            ((r = Math.min(i.length - 1, t)),
                            (i = i.substring(0, i.length - r)),
                            (t -= r)),
                          t > 0 &&
                            n.length > i.length &&
                            ((r = Math.min(n.length - 1, t)),
                            (n = n.substring(0, n.length - r))),
                          !i && n.length && ((i = " "), (n = " ")),
                          (this.attributes.marginLeft = n),
                          (this.attributes.marginRight = i));
                      }
                    }
                  }.call(this, t),
                  (this.attributes.empty = void 0);
                break;
              case "style":
                !(function (e) {
                  if (
                    e &&
                    e.attributes &&
                    !e.get("type") != s.list &&
                    e.attributes.style
                  )
                    for (var t = e.getFirstChild(); t; )
                      t.unset("userIndent"), (t = t.get("after"));
                })(this);
            }
            (this.attributes[e] = t),
              function () {
                var n = this.get("in") || o,
                  a =
                    ("type" === e && i === s.heading) ||
                    (this.get("type") == s.heading &&
                      d.isType(
                        e,
                        "depth",
                        "text",
                        "parent",
                        "before",
                        "after"
                      ));
                n &&
                  n.toc &&
                  i != t &&
                  a &&
                  ("text" != e || File._onInitParse
                    ? n.toc.refresh(!1)
                    : setTimeout(function () {
                        r.isDeleted() || n.toc.updateHeaderText(r);
                      }, 10)),
                  this.get("type") === s.def_link &&
                    i != t &&
                    ("ref" === e
                      ? (File.editor.imgEdit.willUpdateImgRef(i),
                        File.editor.imgEdit.willUpdateImgRef(t))
                      : "text" === e &&
                        File.editor.imgEdit.willUpdateImgRef(this.get("ref"))),
                  n &&
                    n.toc &&
                    "type" == e &&
                    t == s.toc &&
                    setTimeout(function () {
                      n.toc.refresh();
                    }, 20);
              }.call(this),
              function () {
                var n = this.get("in") || o;
                "type" === e &&
                  n &&
                  (i === s.def_footnote && n.foot_list.remove(this),
                  i === s.def_link && n.link_list.remove(this),
                  t === s.def_footnote && n.foot_list.push(this),
                  t === s.def_link && n.link_list.push(this)),
                  "ref" == e &&
                    i !== t &&
                    this.get("type") == s.def_footnote &&
                    setTimeout(function () {
                      File.editor &&
                        File.editor.docMenu &&
                        File.editor.docMenu.refreshFootnoteReverseLink();
                    }, 10);
              }.call(this),
              function () {
                this.get("attachTo")
                  ? ((this.get("type") == s.meta_block && "text" == e) ||
                      ("type" == e &&
                        (i == s.meta_block || t == s.meta_block))) &&
                    File.onMetaDataChanged(!File._onInitParse)
                  : this.get("type") == s.meta_block &&
                    t &&
                    "attachTo" == e &&
                    File.onMetaDataChanged(!File._onInitParse);
              }.call(this);
          } else {
            for (n in (this.id || e.id || (e.id = c()),
            e.id && this.set("id", e.id),
            e.in && this.set("in", e.in),
            e.attachTo && this.set("attachTo", e.attachTo),
            e.type && this.set("type", e.type),
            e))
              -1 ==
                [
                  "id",
                  "in",
                  "attachTo",
                  "type",
                  "marginLeft",
                  "marginRight",
                ].indexOf(n) && d.prototype.set.call(this, n, e[n]);
            void 0 !== e.marginLeft &&
              (this.set("marginLeft", e.marginLeft),
              this.set("marginRight", e.marginRight));
          }
          return this;
        }
        unset(e) {
          this.set(e, void 0);
        }
      }
      var u = function (e, t) {
          var n = e,
            i = e.get("parent");
          if (
            i &&
            !i.isDeleted() &&
            d.isType(e, s.list_item) &&
            i.get("style") == d.ListType.ol &&
            !i.get("isFixed")
          )
            for (; n && n != t; ) n.unset("userIndent"), (n = n.get("after"));
        },
        h = [
          "depth",
          "lang",
          "pattern",
          "patternEnd",
          "align",
          "style",
          "displayStyle",
          "checked",
          "alt",
          "attr",
          "prespace",
          "subindent",
          "markindent",
          "marginLeft",
          "marginRight",
          "alignText",
          "userText",
          "userIndent",
          "isFixed",
          "tagBefore",
          "tagAfter",
          "noCloseTag",
          "empty",
        ];
      (d.property = [
        "text",
        "type",
        "ahead",
        "tail",
        "header",
        "href",
        "title",
        "ref",
        "start",
        "width",
        "height",
      ].concat(h)),
        (d.isBlock = function (e, t) {
          return o[e] || (t && a[e]);
        }),
        (d.isVirtualBlock = function (e) {
          return a[e];
        }),
        (d.canContainBlock = function (e, t) {
          return (
            e == s.blockquote ||
            e == s.list ||
            e == s.list_item ||
            (t && (e == s.table_row || e == s.table))
          );
        }),
        (d.noChangeLine = function (e) {
          for (var t = e; t; ) {
            if (d.isType(e, s.table_cell, s.def_footnote, s.def_link))
              return !0;
            t = t.get("parent");
          }
          return !1;
        }),
        (d.isType = function (e) {
          if (null !== e && void 0 !== e && !1 !== e) {
            var t =
              "object" == typeof e && e.attributes ? e.attributes.type : e;
            if (arguments[1] instanceof Array)
              return d.isType.apply(null, [t].concat(arguments[1]));
            for (var n = 1; n < arguments.length; n++)
              if (t == arguments[n]) return !0;
            return !(arguments.length > 1) && void 0;
          }
        }),
        (d.sortArray = function (e) {
          if (!e.length) return [];
          const t = [];
          for (var n = e[0].getFirstBrother(); n; )
            e.indexOf(n) >= -1 && t.push(n), (n = n.get("after"));
          return t;
        });
      var p = function () {
        this.reset(),
          Object.defineProperty(this, "length", {
            get: function () {
              return this._set.length;
            },
          });
      };
      (p.prototype.get = function (e) {
        return this._map.get(e);
      }),
        (p.prototype.add = function (e) {
          e.cid && this._map.set(e.cid, e), this._set.push(e);
        }),
        (p.prototype.remove = function (e) {
          if (e.cid) {
            var t = this._map.get(e.cid);
            t && t !== e && this._set.remove(t), this._map.delete(e.cid);
          }
          this._set.remove(e);
        }),
        (p.prototype.at = function (e) {
          return this._set[e];
        }),
        (p.prototype.first = function () {
          return this._set[0];
        }),
        (p.prototype.sortedFirst = function () {
          for (var e = this.first(); e && e.get("before"); )
            e = e.get("before");
          return e;
        }),
        (p.prototype.toArray = function () {
          return this._set.clone();
        }),
        (p.prototype.reset = function () {
          (this._set = []), (this._map = new Map());
        }),
        (p.prototype.forEach = function (e, t) {
          this._set.clone().forEach(e, t);
        }),
        (p.prototype.map = function (e, t) {
          return this._set.clone().map(e, t);
        }),
        (p.prototype.sortedForEach = function (e, t) {
          for (var n = this.sortedFirst(); n; ) {
            var i = n.get("after");
            e.call(t, n), (n = i);
          }
        }),
        (p.prototype.update = function (e) {
          e.cid && this._map.set(e.cid, e);
        }),
        (p.prototype.indexOf = function (e) {
          for (var t = 0, n = this.sortedFirst(); n; ) {
            if (e == n) return t;
            (n = n.get("after")), t++;
          }
          return -1;
        }),
        (d.pool = new Map()),
        (window.NodeDef = d);
      var f = {
          toHTML: function (e, t) {
            var n = [],
              i = "";
            if (e.length) {
              var r = e instanceof Array,
                o = r ? e[0] : e.at(0);
              if (!r) for (; o.get("before"); ) o = o.get("before");
              File.option.ignoreLineBreak && (i = "\n");
              do {
                n.push(o.toHTML(void 0, void 0, t)), (o = o.get("after"));
              } while (o && (!r || e.indexOf(o) > -1));
            }
            return n.join(i || "");
          },
        },
        m = function () {
          (this.blocks = new p()),
            (this.allNodes = new p()),
            (this.foot_list = []),
            (this.link_list = []);
        };
      (m.prototype.storeToJson = function () {
        return {
          blocks: this.blocks.map(function (e) {
            return e.storeToJson();
          }),
          nid: l,
        };
      }),
        (m.prototype.restoreFromJson = function (e) {
          this.reset(),
            e.blocks
              .map(function (e) {
                return d.readFromJson(e, this, !0);
              }, this)
              .map(function (t, n) {
                t.set(
                  "before",
                  this.allNodes.get(e.blocks[n].relation.before_id)
                ),
                  t.set(
                    "after",
                    this.allNodes.get(e.blocks[n].relation.after_id)
                  );
              }, this),
            (l = e.nid - 0),
            this.toc && this.toc.refresh(!0, !0);
        }),
        (m.prototype.get = function (e) {
          switch (e) {
            case "allNodes":
              return this.allNodes;
            case "blocks":
              return this.blocks;
          }
        }),
        (m.prototype.reset = function (e, t) {
          File.editor &&
            this == File.editor.nodeMap &&
            console.sendLog("reset NodeMap"),
            this.blocks.forEach(function (e) {
              e.remove();
            }),
            this.blocks.reset(),
            i.debugMode &&
              this.allNodes.length &&
              console.warn("nodeMap not clean"),
            this.allNodes.length && (d.pool = new Map()),
            this.allNodes.reset(),
            this.foot_list instanceof Array
              ? ((this.foot_list = []), (this.link_list = []))
              : (this.foot_list.reset(), this.link_list.reset()),
            t && ((l = 0), (d.pool = new Map())),
            window.File.editor &&
              File.editor.mathBlock &&
              File.editor.mathBlock.cleanUpAMS();
        }),
        (m.prototype.getFirst = function () {
          return this.blocks.sortedFirst();
        }),
        (m.prototype.getLast = function () {
          if (this.blocks.length > 0) {
            var e = this.blocks.at(this.blocks.length - 1);
            return (e = e.getLastBrother(!1));
          }
          return null;
        }),
        (d.backToParagraphBeforeDelete = [
          s.heading,
          s.def_footnote,
          s.def_link,
          s.meta_block,
          s.fences,
        ]),
        (d.ListType = { ol: "ol", ul: "ul", task: "tasklist" }),
        (t.Node = d),
        (t.NodeMap = m),
        (t.NodeCollection = p),
        (t.NodeCollectionUtils = f),
        (t.TYPE = s),
        (d.TYPE = s);
    }),
    $__System.registerDynamic("1b", ["11", "13"], !0, function (e, t, n) {
      "use strict";
      var i = this || self,
        r = (e("11"), e("13")),
        o = r.Node,
        a = r.TYPE,
        s = { NONE: 0, ADD: 1, REPLACE: 2, DELETE: -1 };
      class l {
        constructor(e) {
          (this.commandStack = []),
            (this.index = -1),
            (this.editor = e),
            (this.UndoManager = l),
            (this.undoManagerContext = !1);
        }
        reset() {
          (this.commandStack = []),
            (this.index = -1),
            console.sendLog("[UndoManager] reset commandStack");
        }
        setIndex(e) {
          this.index = e;
        }
        restoreFromJson(e) {
          this.setIndex(e.index),
            (this.commandStack = JSON.parse(e.commandStackJson)),
            console.sendLog(
              `[UndoManager] restoreFromJson all: ${this.commandStack.length} at: ${e.index}`
            );
        }
        storeToJson() {
          var e;
          try {
            e = JSON.stringify(this.commandStack);
          } catch (t) {
            console.sendError(t),
              this.resize(20),
              (e = JSON.stringify(this.commandStack));
          }
          return { index: this.index, commandStackJson: e };
        }
        callCommand(e, t) {
          var n, i;
          if (((this.lastUndo = null), t))
            for (var r = (e.undo || []).length - 1; r > -1; r--)
              (i = this.exeCommand(e.undo[r], e.redo)),
                n || (n = void 0 === n ? i : !!i);
          else
            for (r = 0; r < (e.redo || []).length; r++)
              (i = this.exeCommand(e.redo[r], e.undo)),
                n || (n = void 0 === n ? i : !!i);
          return n;
        }
      }
      function c() {
        return (
          ("INPUT" == document.activeElement.tagName &&
            "checkbox" != document.activeElement.getAttribute("type")) ||
          ("IFRAME" == (document.activeElement.tagName || "").toUpperCase() &&
            "BODY" !=
              document.activeElement.ownerDocument.activeElement.tagName)
        );
      }
      function d(e) {
        var t = window.getSelection();
        t &&
          t.isCollapsed &&
          !t.anchorOffset &&
          t.anchorNode == e.writingArea &&
          t.removeAllRanges();
      }
      (l.prototype.register = function (e, t, n, i) {
        if (!this.undoManagerContext && e) {
          if (window.debugMode)
            try {
              JSON.stringify(e);
            } catch (e) {
              alert("found error: " + e), console.error(e);
            }
          (!e.cursorOnly &&
            this.index != this.commandStack.length - 1 &&
            e.undo.length <= 1 &&
            e.redo.length <= 1 &&
            o.isType(
              (e.undo[0] || { type: "cursor" }).type,
              "cursor",
              "fences-pos"
            ) &&
            o.isType(
              (e.redo[0] || { type: "cursor" }).type,
              "cursor",
              "fences-pos"
            )) ||
            ("sync" === n ||
              i ||
              (this.commandStack.splice(this.index + 1),
              this.resizeIfNeeded(),
              i
                ? (f(this.commandStack[0]), this.commandStack.unshift(e))
                : (f(this.commandStack.last()), this.commandStack.push(e)),
              this.setIndex(this.commandStack.length - 1)),
            t ||
              e.cursorOnly ||
              ("sync" !== n &&
                "restore" !== n &&
                File.updateChangeCount(File.ChangeType.NSChangeDone)),
            "undo" !== n && "input" !== n && this.editor.syncChange(e.redo));
        }
      }),
        (l.prototype.resizeIfNeeded = function () {
          var e = 0,
            t = File.inBusyMode ? 10 : 5;
          if (
            (this.commandStack.forEach((n) => {
              e += "reload" == n.tag ? t : 1;
            }),
            e > 160)
          ) {
            var n = Math.floor(Math.min(160, this.commandStack.length) / 2);
            return this.resize(n), !0;
          }
          return !1;
        }),
        (l.prototype.resize = function (e) {
          this.commandStack.length, e || (e = Math.floor(80));
          var t = this.index;
          e += Math.max(0, this.commandStack.length - t);
          var n = Math.max(this.commandStack.length - e, 0);
          this.commandStack.length > e &&
            (this.commandStack.splice(0, n), this.setIndex(t - n)),
            this.commandStack.length,
            this.index;
        }),
        (l.prototype.lastRegisteredOperationCommand = function () {
          return this.commandStack.length == this.index + 1
            ? this.commandStack[this.index]
            : null;
        }),
        (l.prototype.removeLastRegisteredOperationCommand = function () {
          this.commandStack.length == this.index + 1 &&
            (this.commandStack.pop(), this.setIndex(this.index - 1));
        }),
        (l.prototype.undoLastDiscardable = function () {
          if (!this.editor.sourceView.inSourceMode && !File.isLocked) {
            if (
              (this.endSnap(!0),
              "INPUT" == document.activeElement.tagName &&
                "checkbox" != document.activeElement.getAttribute("type"))
            )
              return !0;
            var e = this.commandStack[this.index];
            e && e.discardable && this.undo();
          }
        }),
        (l.prototype.undo = function (e) {
          if (!File.isFileLoading()) {
            if (
              (this.editor.selection.clearGlobalColumn(),
              this.editor.sourceView.inSourceMode)
            )
              return (
                this.editor.sourceView.cm.undo(),
                this.editor.sourceView.cm.scrollIntoView(),
                e && e.preventDefault()
              );
            if ((this.endSnap(!0), c())) {
              if (File.isNode)
                return (
                  JSBridge.invoke("webContents.undo"),
                  e && e.preventDefault(),
                  !1
                );
            } else
              this.editor.mathBlock.currentCm
                ? this.editor.mathBlock.tryAddTagUndo(
                    void 0,
                    $(document.activeElement)
                  )
                : document.activeElement.classList.contains(
                    "ty-cm-lang-input"
                  ) && this.editor.fences.tryAddLangUndo();
            e && e.preventDefault();
            var t = this.commandStack[this.index];
            if (t) {
              this.editor.brush.pause();
              var n = this.callCommand(t, !0);
              if (
                (this.setIndex(this.index - 1),
                t.cursorOnly ||
                  File.updateChangeCount(File.ChangeType.NSChangeUndone),
                void 0 === n)
              )
                return this.undo(), void this.editor.brush.resume();
              n && this.editor.wordCount.quickUpdate(null, !0, !0),
                this.editor.refocus(void 0, null, null, !0, !0),
                this.editor.syncChange(t.undo.clone().reverse()),
                n &&
                  (this.editor.brush.clearAndPause(),
                  this.editor.quickRefresh(),
                  d(this.editor),
                  $(this.editor.sessionStr).trigger("cursorChange")),
                this.editor.selection.scrollAdjust(),
                this.editor.brush.resume(!0),
                window.Reporter.fullValidate();
            }
          }
        }),
        (l.prototype.redo = function (e) {
          if (!File.isFileLoading()) {
            if (
              (this.editor.selection.clearGlobalColumn(),
              this.editor.sourceView.inSourceMode)
            )
              return (
                this.editor.sourceView.cm.redo(),
                this.editor.sourceView.cm.scrollIntoView(),
                e && e.preventDefault()
              );
            if (c()) {
              if (File.isNode)
                return (
                  JSBridge.invoke("webContents.redo"),
                  e && e.preventDefault(),
                  !1
                );
            } else if (this.editor.mathBlock.currentCm) {
              if (
                this.editor.mathBlock.tryAddTagUndo(
                  void 0,
                  $(document.activeElement)
                )
              )
                return !1;
            } else if (
              document.activeElement.classList.contains("ty-cm-lang-input") &&
              this.editor.fences.tryAddLangUndo(void 0, document.activeElement)
            )
              return !1;
            e && e.preventDefault();
            var t = this.commandStack[this.index + 1];
            if (t) {
              this.editor.brush.pause();
              var n = this.callCommand(t, !1);
              if (
                (this.setIndex(this.index + 1),
                t.cursorOnly ||
                  File.updateChangeCount(File.ChangeType.NSChangeRedone),
                void 0 === n)
              )
                return this.redo(), void this.editor.brush.resume();
              n && this.editor.wordCount.quickUpdate(null, !0, !0),
                this.editor.refocus(void 0, null, null, !0, !0),
                this.editor.syncChange(t.redo),
                n &&
                  (this.editor.brush.clearAndPause(),
                  this.editor.quickRefresh(),
                  d(this.editor),
                  $(this.editor.sessionStr).trigger("cursorChange")),
                this.editor.selection.scrollAdjust(),
                this.editor.brush.resume(!0),
                window.Reporter.fullValidate();
            }
          }
        }),
        (l.prototype.hasUndo = function () {
          return -1 !== this.index;
        }),
        (l.prototype.hasRedo = function () {
          return this.index < this.commandStack.length - 1;
        }),
        (l.prototype.exeCommand = function (e, t, n) {
          var s,
            l,
            c,
            d = this.editor,
            u = !1,
            h = d.sourceView.inSourceMode;
          function p(t, n) {
            (n = n || []),
              (t = t || d.nodeMap),
              e.json.map(function (e) {
                n.push(o.readFromJson(e, t, !0));
              }),
              e.json.map(function (e) {
                var t = d.getNode(e.id);
                t.set("before", d.getNode(e.relation.before_id)),
                  t.set("after", d.getNode(e.relation.after_id)),
                  t.set("parent", d.getNode(e.relation.parent_id));
              });
          }
          if (!e) return !1;
          switch (e.type) {
            case "initSrc":
              if (h) return !1;
              (d.brush.queue = []),
                (u = !1),
                File.reloadContent(e.src, {
                  skipUndo: !0,
                  delayRefresh: !0,
                  fromDiskChange: !0,
                  skipChangeCount: !0,
                  onInit: !0,
                });
              break;
            case "reload":
              if (h) return !1;
              d.nodeMap.reset(d),
                p(),
                (d.brush.queue = []),
                (u = !0),
                $(d.sessionStr).html(
                  r.NodeCollectionUtils.toHTML(d.nodeMap.blocks)
                ),
                (d.focusCid = null),
                (d.lastCursor = null),
                window.getSelection().removeAllRanges(),
                (File.bundle.fileEncode = e.encode);
              break;
            case "replace":
              if (h) return !1;
              if (!(c = d.getNode(e.id)))
                return console.error(e.id + " not found in  replace");
              c.get("type") == a.fences && d.fences.beforeDeleteFences(c, t),
                c.get("type") == a.math_block &&
                  d.mathBlock.beforeDeleteFences(c),
                c.get("type") == a.html_block &&
                  d.htmlBlock.beforeDeleteFences(c),
                e.id != e.json.id
                  ? (d.getNode(e.id).remove(),
                    (c = o.readFromJson(e.json, d.nodeMap)))
                  : c.readFromJson(e.json, d.nodeMap),
                d
                  .findElemById(e.id)
                  .replaceWith(
                    d.MarkParser.renderHtmlWithBlockMeta(c, d.brush)
                  ),
                File.inBusyMode ||
                  d.writingArea.setAttribute("contenteditable", "true"),
                (u = !0),
                d.brush.restart(),
                n ||
                  (d.brush.addToQueue(c.id, !0),
                  d.wordCount.quickUpdate(c, !1, !0));
              break;
            case "insert":
              if (h) return !1;
              var f = d.nodeMap,
                m = new Array(),
                g = [];
              if (
                (p(f, m),
                e.after &&
                  (g = d.findElemById(e.after)).before(
                    r.NodeCollectionUtils.toHTML(m, { mathCount: 0 })
                  ),
                !g.length &&
                  e.before &&
                  (g = d.findElemById(e.before)).after(
                    r.NodeCollectionUtils.toHTML(m, { mathCount: 0 })
                  ),
                !g.length)
              ) {
                var v = m[0].get("parent");
                v
                  ? d.findElemById(v.id).replaceWith(v.toHTML())
                  : 0 === $(d.sessionStr).children().length &&
                    ($(d.sessionStr).html(
                      r.NodeCollectionUtils.toHTML(m, { mathCount: 0 })
                    ),
                    (d.focusCid = null),
                    (d.lastCursor = null));
              }
              u = !0;
              break;
            case "remove":
              if (h) return !1;
              e.idArray.map(function (e) {
                var n = d.getNode(e);
                o.isType(n, a.fences) && d.fences.beforeDeleteFences(n, t),
                  o.isType(n, a.math_block) &&
                    d.mathBlock.beforeDeleteFences(n),
                  o.isType(n, a.html_block) &&
                    d.htmlBlock.beforeDeleteFences(n);
                var i = (s = d.findElemById(e)).parent("li");
                i.length && i.css("margin", "0.1px"),
                  s.remove(),
                  i.length && i.css("margin", ""),
                  n && n.remove();
              }),
                (u = !0);
              break;
            case "text":
              if (h) return !1;
              (s = d.findElemById(e.id)),
                d.getNode(e.id).set("text", e.text),
                e.html && s.html(e.html),
                (u = !1),
                ("def-footnote" != s.attr("mdtype") &&
                  "def-link" != s.attr("mdtype")) ||
                  (u = !0),
                !n && d.brush.addToQueue(e.id, !0);
              break;
            case "deleteMedia":
              d.imgEdit.deleteMedia(e.from, !1);
              break;
            case "restoreMedia":
              d.imgEdit.restoreMedia(e.from, e.to);
              break;
            case "cursor":
              if (n) return !1;
              try {
                if (h)
                  return void (
                    e.inSourceMode && d.sourceView.cm.setCursor(e.pos)
                  );
                if (e.inSourceMode) return;
                if (
                  (void 0 == e.end && (e.end = e.start),
                  void 0 == e.startId && void 0 == e.id && (e.id = e.cid),
                  e.focus)
                )
                  return (
                    setTimeout(function () {
                      d.findElemById(e.id)
                        .children("[tabindex]")
                        .addBack("[tabindex]")
                        .focus();
                    }, 100),
                    d
                      .findElemById(e.id)
                      .children("[tabindex]")
                      .addBack("[tabindex]")
                      .focus(),
                    !1
                  );
                if (e.id || e.startId == e.endId) {
                  var y;
                  if (
                    ((e.id = e.id || e.startId),
                    (s = d.findElemById(e.id)).addClass("md-focus"),
                    o.isType(
                      s.attr("mdtype"),
                      a.fences,
                      a.math_block,
                      a.html_block
                    ))
                  )
                    s.attr("mdtype") == a.fences
                      ? (d.fences.refreshEditor(),
                        (y = d.fences.getCm(e.id)).focus())
                      : s.attr("mdtype") == a.math_block
                      ? (y = d.mathBlock.startEditing(s))
                      : s.attr("mdtype") == a.html_block &&
                        (y = d.htmlBlock.startEditing(s)),
                      e.selections && e.selections.length
                        ? y.setSelection(
                            e.selections[0].head,
                            e.selections[0].anchor
                          )
                        : e.pos
                        ? (y.setCursor(e.pos),
                          e.selections && y.setSelections(e.selections))
                        : e.start > -1
                        ? (y.setCursor(y.posFromIndex(e.start)),
                          e.end > -1 &&
                            y.setSelection(
                              y.posFromIndex(e.start),
                              y.posFromIndex(e.end)
                            ))
                        : d.selection.jumpIntoElemEnd(s);
                  else if (s.length && void 0 !== e.end) {
                    var b = s.text().length;
                    e.start > b && (e.start = b),
                      e.end > b && (e.end = b),
                      d.selection.restoreSelection(s[0], {
                        start: e.start,
                        end: e.end,
                      });
                  } else window.getSelection().removeAllRanges();
                  t || d.refocus(e.id);
                } else if (e.startId) {
                  File.inBusyMode &&
                    !File.isLocked &&
                    d.writingArea.setAttribute("contenteditable", "true");
                  try {
                    var w = d.selection.restoreEdge(
                      d.findElemById(e.startId),
                      e.start
                    );
                    (w = d.selection.restoreEdge(
                      d.findElemById(e.endId),
                      e.end,
                      !0,
                      w
                    )),
                      d.selection.fixSafariRange(w),
                      d.selection.setRange(w),
                      d.refocus();
                  } catch (e) {
                    console.log(e.stack);
                  }
                }
                File.isTypeWriterMode && d.selection.scrollAdjust(), (u = !1);
              } catch (e) {
                console.warn(e.stack);
              }
              break;
            case "fences":
              if (h) return !1;
              (c = d.getNode(e.id)),
                o.isType(c, a.math_block)
                  ? (d.mathBlock.startEditing(e.id),
                    (l = d.mathBlock.currentCm))
                  : o.isType(c, a.html_block)
                  ? (d.htmlBlock.startEditing(e.id),
                    (l = d.htmlBlock.currentCm))
                  : (l = d.fences.getCm(e.id)),
                l
                  ? (l.focus(),
                    e.change &&
                      (d.searchPanel.closePanel(!0),
                      l.doc.makeChange(e.change)))
                  : i.debugMode &&
                    (console.error("cm is null"), window.alert("error")),
                (u = !1);
              break;
            case "fences-pos":
              if (h || n) return !1;
              (c = d.getNode(e.id)),
                o.isType(c, a.math_block)
                  ? (d.mathBlock.startEditing(e.id),
                    (l = d.mathBlock.currentCm))
                  : o.isType(c, a.html_block)
                  ? (d.htmlBlock.startEditing(e.id),
                    (l = d.htmlBlock.currentCm))
                  : (d.fences.refreshEditor(), (l = d.fences.getCm(e.id))),
                l && (l.focus(), l.setCursor(e.pos), (u = !1));
              break;
            case "attr":
              if (h) return !1;
              (e.value = e.value),
                (c = this.editor.getNode(e.id)).attr(
                  e.key,
                  e.value,
                  this.editor,
                  !0
                ),
                !n && d.brush.addToQueue(e.id, !0);
              break;
            case "wrap":
              if (h) return !1;
              var x = { type: "insert" };
              (x.json = [e.json]),
                e.json.children.map(function (n, i) {
                  var r = d.getNode(n.id);
                  0 === i
                    ? (x.before = r.get("before") ? r.get("before").id : null)
                    : i === e.json.children.length - 1 &&
                      (x.after = r.get("after") ? r.get("after").id : null),
                    r &&
                      (r.get("type") == a.fences &&
                        ((u = !0), d.fences.beforeDeleteFences(r, t)),
                      r.get("type") == a.math_block &&
                        ((u = !0), d.mathBlock.beforeDeleteFences(r)),
                      r.remove(),
                      d.findElemById(n.id).remove());
                }),
                this.exeCommand(x, t);
              break;
            case "unwrap":
              if (h) return !1;
              var C = (c = d.getNode(e.id)).unwrap();
              !e.skipHTML &&
                d
                  .findElemById(e.id)
                  .replaceWith(
                    r.NodeCollectionUtils.toHTML(C, { mathCount: 0 })
                  ),
                (u = !0);
              break;
            case "scroll":
              if (h || n) return !1;
              d.selection.scrollAdjust(
                e.id ? d.findElemById(e.id) : void 0,
                e.marginTop
              );
              break;
            case "sync":
              if (!n) return !1;
              if (void 0 !== e.html)
                d.findElemById(e.id)
                  .html(e.html)
                  .find(".md-expand, .md-focus")
                  .removeClass("md-expand md-focus");
              else if (void 0 !== e.allHtml)
                d.nodeMap.reset(), p(), $("#write").html(e.allHtml);
              else if (void 0 !== e.cmChanges)
                (l = d.fences.getCm(e.id)),
                  e.cmChanges.forEach(function (e) {
                    l.replaceRange(e.text, e.from, e.to);
                  });
              else {
                if (void 0 !== e.tex)
                  return (
                    (c = d.getNode(e.id)).set("text", e.tex),
                    d.findElemById(e.id).replaceWith(c.toHTML()),
                    !0
                  );
                if (void 0 !== e.srcChanges)
                  h &&
                    e.srcChanges.forEach(function (e) {
                      d.sourceView.cm.replaceRange(e.text, e.from, e.to);
                    });
                else if (void 0 !== e.content) {
                  if (h && !e.fromSourceMode) {
                    var F = d.sourceView.cm.getScrollInfo().top;
                    d.sourceView.cm.setValue(e.content, "sync"),
                      d.sourceView.cm.scrollTo(0, F);
                  }
                  !h &&
                    e.fromSourceMode &&
                    (d.nodeMap.reset(), d.reset(e.content));
                }
              }
            case "option":
              "finalNewline" == e.option &&
                ((File.finalNewline = e.value), File.freshMenuWithDelay());
            default:
              return !1;
          }
          return u;
        });
      var u = null;
      l.prototype.clearEventTimer = function () {
        u && clearTimeout(u), (u = null);
      };
      l.prototype.buildSnap = function (e, t, n) {
        var i = this.editor.selection.buildUndo(void 0, void 0, !0),
          r = this.editor.getNode(e);
        return r
          ? (void 0 !== n && null !== n
              ? r.set("text", content)
              : t && this.editor.store(e, !0),
            new (function (e, t, n, i, r) {
              (this.id = e),
                (this.type = t || 0),
                (this.content = n),
                (this.selection = i),
                (this.snapDate = r || new Date());
            })(e, t, r.storeToJson(), i))
          : null;
      };
      var h,
        p = function (e, t) {
          if (!e) return [];
          var n = [{ type: "replace", id: e.id, json: e.content }, e.selection];
          return t && n.reverse(), n;
        };
      l.prototype.prepCursorSnap = function (e) {
        (h = l.makeEmptyCommand()).undo.push(
          this.editor.selection.buildUndo(e)
        );
      };
      var f = function (e) {
        e && ((e.incomplete = null), (e.date = null), (e.source = null));
      };
      (l.prototype.endSnap = function (e) {
        if ((e && (h = null), h))
          return (
            h.redo.push(this.editor.selection.buildUndo()),
            this.register(h),
            void (h = null)
          );
        f(this.lastRegisteredOperationCommand());
      }),
        (l.prototype.addSnap = function (e, t) {
          var n = this.lastRegisteredOperationCommand();
          if (
            n &&
            t != s.REPLACE &&
            n.source === e + "#" + t &&
            new Date() - n.date < 3e3
          ) {
            if (
              ((this.lastUndo = this.buildSnap(e, t)),
              this.lastUndo &&
                (function (e, t) {
                  return !(
                    e &&
                    0 != e.length &&
                    (2 != e.length ||
                      !e[0] ||
                      "replace" != e[0].type ||
                      e[0].id != t ||
                      (e[1] && "cursor" != e[1].type))
                  );
                })(n.redo, e))
            )
              return void (n.redo = p(this.lastUndo));
            n.date = 0;
          }
          if (0 != t) {
            var i = l.makeEmptyCommand();
            if (this.lastUndo) i.undo = p(this.lastUndo, !0);
            else {
              i.undo.push(this.editor.selection.buildUndo());
              var r = l.buildReplaceUndo(this.editor.getNode(e), null, !0);
              r && i.undo.push(r);
            }
            (this.lastUndo = this.buildSnap(e, t)),
              this.lastUndo &&
                ((i.redo = p(this.lastUndo)),
                (i.source = e + "#" + t),
                (i.date = this.lastUndo.snapDate)),
              this.register(i);
          } else this.lastUndo = this.buildSnap(e, t);
        }),
        (l.prototype.buildReplaceUndo = function (e) {
          return l.buildReplaceUndo(e);
        }),
        (l.buildReplaceUndo = function (e, t, n) {
          if (e)
            return { type: "replace", id: t || e.id, json: e.storeToJson() };
          if (!n) throw new Error("empty node");
        }),
        (l.buildAttrUndo = function (e, t) {
          return { type: "attr", id: e.id, key: t, value: e.get(t) };
        }),
        (l.addUndoForInsert = function (e, t, n, i) {
          return t
            ? (e.redo.push({
                type: "insert",
                after: i ? i.id : t.get("after") ? t.get("after").id : null,
                before: n ? n.id : t.get("before") ? t.get("before").id : null,
                json: [t.storeToJson()],
              }),
              e.undo.push({ type: "remove", idArray: [t.id] }),
              e)
            : e;
        }),
        (l.addUndoForWrap = function (e, t, n) {
          t &&
            (e.redo.push({ type: "wrap", json: t.storeToJson(), skipHTML: n }),
            e.undo.push({ type: "unwrap", id: t.id, skipHTML: n }));
        }),
        (l.addUndoForUnwrap = function (e, t) {
          t &&
            (e.undo.push({ type: "wrap", json: t.storeToJson() }),
            e.redo.push({ type: "unwrap", id: t.id }));
        }),
        (l.buildAllDoc = function (e, t) {
          var n = e.blocks.at(0),
            i = [];
          if (n)
            for (n = n.getFirstBrother(); n; )
              i.push(n.storeToJson()), (n = n.get("after"));
          return {
            type: "reload",
            json: i,
            reloadFromDisk: t,
            encode: File.bundle.fileEncode,
          };
        }),
        (l.addUndoForInsertArray = function (e, t, n, i) {
          return t && 0 != t.length
            ? (e.redo.push({
                type: "insert",
                after: i
                  ? i.id
                  : t[t.length - 1].get("after")
                  ? t[t.length - 1].get("after").id
                  : null,
                before: n
                  ? n.id
                  : t[0].get("before")
                  ? t[0].get("before").id
                  : null,
                json: t.reduce(function (e, t) {
                  return e.push(t.storeToJson()), e;
                }, []),
              }),
              e.undo.push({
                type: "remove",
                idArray: t.reduce(function (e, t) {
                  return e.push(t.id), e;
                }, []),
              }),
              e)
            : e;
        }),
        (l.addUndoForRemoveArray = function (e, t, n, i) {
          t &&
            0 != t.length &&
            (e.undo.push({
              type: "insert",
              after: i
                ? i.id
                : t[t.length - 1].get("after")
                ? t[t.length - 1].get("after").id
                : null,
              before: n
                ? n.id
                : t[0].get("before")
                ? t[0].get("before").id
                : null,
              parent: t[0].get("parent") ? t[0].get("parent").id : null,
              json: t.reduce(function (e, t) {
                return e.push(t.storeToJson()), e;
              }, []),
            }),
            e.redo.push({
              type: "remove",
              idArray: t.reduce(function (e, t) {
                return e.push(t.id), e;
              }, []),
            }));
        }),
        (l.addUndoForRemove = function (e, t, n, i) {
          e.undo.push({
            type: "insert",
            after: i ? i.id : t.get("after") ? t.get("after").id : null,
            before: n ? n.id : t.get("before") ? t.get("before").id : null,
            json: [t.storeToJson()],
          }),
            e.redo.push({ type: "remove", idArray: [t.id] });
        }),
        (l.makeEmptyCommand = function (e) {
          var t = { undo: [], redo: [] };
          return e && t.undo.push(e), t;
        }),
        (l.isEmptyCommand = function (e) {
          return !(e && e.undo && e.redo && (e.undo.length || e.redo.length));
        }),
        (l.isEmptyOrUnchangedCommand = function (e) {
          return (
            !!l.isEmptyCommand(e) ||
            !(
              e.undo.find((e) => e && "cursor" != e.type) ||
              e.redo.find((e) => e && "cursor" != e.type)
            )
          );
        }),
        (l.append = function (e, t) {
          return (
            t &&
              ((e.undo = e.undo.concat(t.undo)),
              (e.redo = e.redo.concat(t.redo))),
            e
          );
        }),
        (o.storeToJson = function (e) {
          var t = { content: {}, relation: {} };
          return (
            (t.children = new Array()),
            o.property.map(function (n) {
              var i = e.get(n);
              void 0 !== i &&
                null !== i &&
                (i instanceof Array
                  ? (t.content[n] = $.merge([], i))
                  : typeof i == Object
                  ? (t.content[n] = $.extend({}, i))
                  : (t.content[n] = i));
            }),
            (t.relation.before_id = e.get("before")
              ? e.get("before").id
              : null),
            (t.relation.after_id = e.get("after") ? e.get("after").id : null),
            (t.relation.parent_id = e.get("parent")
              ? e.get("parent").id
              : null),
            (t.is_top = !!e.get("attachTo")),
            e.get("children").sortedForEach(function (e) {
              var n = o.storeToJson(e);
              t.children.push(n);
            }),
            (t.id = e.id),
            t
          );
        }),
        (o.readFromJson = function (e, t, n) {
          var i =
            (function (e) {
              var n = t.allNodes.get(e);
              return (
                n &&
                  !n.attributes &&
                  (console.assert(null, "node deleted"), (n.attributes = {})),
                n
              );
            })(e.id) || new o({ id: e.id });
          return (
            i.set("in", t),
            e.is_top && i.set("attachTo", t),
            o.property.map(function (e) {
              i.attributes[e] = void 0;
            }),
            i.set(e.content),
            i.clearChildren(!0),
            e.relation.parent_id || i.set("attachTo", t),
            e.children.map(function (e) {
              o.readFromJson(e, t, !0);
            }),
            e.children.map(function (e) {
              var n = t.allNodes.get(e.id);
              n.set("before", t.allNodes.get(e.relation.before_id)),
                n.set("after", t.allNodes.get(e.relation.after_id)),
                n.set("parent", i);
            }),
            n ||
              (i.set("before", t.allNodes.get(e.relation.before_id)),
              i.set("after", t.allNodes.get(e.relation.after_id)),
              i.set("parent", t.allNodes.get(e.relation.parent_id))),
            i
          );
        }),
        (o.prototype.storeToJson = function () {
          return o.storeToJson(this);
        }),
        (o.prototype.readFromJson = function (e, t) {
          this.clearChildren();
          var n = o.readFromJson(e, t || this.get("in"));
          this.replaceWith(n);
        }),
        (l.SnapFlag = s),
        (n.exports = l);
    }),
    $__System.registerDynamic("1d", [], !0, function (e, t, n) {
      "use strict";
      this || self;
      var i = (function (e) {
        var t = "object",
          n = "function",
          i = "undefined",
          r = [
            "startContainer",
            "startOffset",
            "endContainer",
            "endOffset",
            "collapsed",
            "commonAncestorContainer",
          ],
          o = [
            "setStart",
            "setStartBefore",
            "setStartAfter",
            "setEnd",
            "setEndBefore",
            "setEndAfter",
            "collapse",
            "selectNode",
            "selectNodeContents",
            "compareBoundaryPoints",
            "deleteContents",
            "extractContents",
            "cloneContents",
            "insertNode",
            "surroundContents",
            "cloneRange",
            "toString",
            "detach",
          ],
          a = [
            "boundingHeight",
            "boundingLeft",
            "boundingTop",
            "boundingWidth",
            "htmlText",
            "text",
          ],
          s = [
            "collapse",
            "compareEndPoints",
            "duplicate",
            "moveToElementText",
            "parentElement",
            "select",
            "setEndPoint",
            "getBoundingClientRect",
          ];
        function l(e, i) {
          var r = typeof e[i];
          return r == n || !(r != t || !e[i]) || "unknown" == r;
        }
        function c(e, n) {
          return !(typeof e[n] != t || !e[n]);
        }
        function d(e, t) {
          return typeof e[t] != i;
        }
        function u(e) {
          return function (t, n) {
            for (var i = n.length; i--; ) if (!e(t, n[i])) return !1;
            return !0;
          };
        }
        var h = u(l),
          p = u(c),
          f = u(d);
        function m(e) {
          return e && h(e, s) && f(e, a);
        }
        function g(e) {
          return c(e, "body") ? e.body : e.getElementsByTagName("body")[0];
        }
        var v,
          y = {},
          b = {
            version: "1.3alpha.20140716",
            initialized: !1,
            supported: !0,
            util: {
              isHostMethod: l,
              isHostObject: c,
              isHostProperty: d,
              areHostMethods: h,
              areHostObjects: p,
              areHostProperties: f,
              isTextRange: m,
              getBody: g,
            },
            features: {},
            modules: y,
            config: { alertOnFail: !0, alertOnWarn: !1, preferTextRange: !1 },
          };
        function w(e) {
          c(window, "console") &&
            l(window.console, "log") &&
            window.console.log(e);
        }
        function x(e, t) {
          t ? window.alert(e) : w(e);
        }
        function C(e) {
          (b.initialized = !0),
            (b.supported = !1),
            x(
              "Rangy is not supported on this page in your browser. Reason: " +
                e,
              b.config.alertOnFail
            );
        }
        (b.fail = C),
          (b.warn = function (e) {
            x("Rangy warning: " + e, b.config.alertOnWarn);
          }),
          !{}.hasOwnProperty
            ? C("hasOwnProperty not supported")
            : (b.util.extend = function (e, t, n) {
                var i, r;
                for (var o in t)
                  t.hasOwnProperty(o) &&
                    ((i = e[o]),
                    (r = t[o]),
                    n &&
                      null !== i &&
                      "object" == typeof i &&
                      null !== r &&
                      "object" == typeof r &&
                      b.util.extend(i, r, !0),
                    (e[o] = r));
                return (
                  t.hasOwnProperty("toString") && (e.toString = t.toString), e
                );
              }),
          (function () {
            var e = document.createElement("div");
            e.appendChild(document.createElement("span"));
            var t,
              n = [].slice;
            try {
              1 == n.call(e.childNodes, 0)[0].nodeType &&
                (t = function (e) {
                  return n.call(e, 0);
                });
            } catch (e) {}
            t ||
              (t = function (e) {
                for (var t = [], n = 0, i = e.length; n < i; ++n) t[n] = e[n];
                return t;
              }),
              (b.util.toArray = t);
          })(),
          l(document, "addEventListener")
            ? (v = function (e, t, n) {
                e.addEventListener(t, n, !1);
              })
            : l(document, "attachEvent")
            ? (v = function (e, t, n) {
                e.attachEvent("on" + t, n);
              })
            : C(
                "Document does not have required addEventListener or attachEvent method"
              ),
          (b.util.addListener = v);
        var F = [];
        function S(e) {
          return e.message || e.description || String(e);
        }
        function k() {
          if (!b.initialized) {
            var e,
              t = !1,
              n = !1;
            l(document, "createRange") &&
              ((e = document.createRange()), h(e, o) && f(e, r) && (t = !0));
            var i = g(document);
            if (i && "body" == i.nodeName.toLowerCase())
              if (
                (i &&
                  l(i, "createTextRange") &&
                  m((e = i.createTextRange())) &&
                  (n = !0),
                t || n)
              ) {
                var a;
                for (var s in ((b.initialized = !0),
                (b.features = {
                  implementsDomRange: t,
                  implementsTextRange: n,
                }),
                y))
                  (a = y[s]) instanceof T && a.init(a, b);
                for (var c = 0, d = F.length; c < d; ++c)
                  try {
                    F[c](b);
                  } catch (e) {
                    w(
                      "Rangy init listener threw an exception. Continuing. Detail: " +
                        S(e)
                    );
                  }
              } else C("Neither Range nor TextRange are available");
            else C("No body element found");
          }
        }
        (b.init = k),
          (b.addInitListener = function (e) {
            b.initialized ? e(b) : F.push(e);
          });
        var E = [];
        function T(e, t, n) {
          (this.name = e),
            (this.dependencies = t),
            (this.initialized = !1),
            (this.supported = !1),
            (this.initializer = n);
        }
        function _(e, t, n, i) {
          var r = new T(t, n, function (e) {
            if (!e.initialized) {
              e.initialized = !0;
              try {
                i(b, e), (e.supported = !0);
              } catch (e) {
                w("Module '" + t + "' failed to load: " + S(e));
              }
            }
          });
          y[t] = r;
        }
        function A() {}
        (b.addCreateMissingNativeApiListener = function (e) {
          E.push(e);
        }),
          (b.createMissingNativeApi = function (e) {
            (e = e || window), k();
            for (var t = 0, n = E.length; t < n; ++t) E[t](e);
          }),
          (T.prototype = {
            init: function (e) {
              for (
                var t, n, i = this.dependencies || [], r = 0, o = i.length;
                r < o;
                ++r
              ) {
                if (((n = i[r]), !((t = y[n]) && t instanceof T)))
                  throw new Error("required module '" + n + "' not found");
                if ((t.init(), !t.supported))
                  throw new Error("required module '" + n + "' not supported");
              }
              this.initializer(this);
            },
            fail: function (e) {
              throw (
                ((this.initialized = !0),
                (this.supported = !1),
                new Error("Module '" + this.name + "' failed to load: " + e))
              );
            },
            warn: function (e) {
              b.warn("Module " + this.name + ": " + e);
            },
            deprecationNotice: function (e, t) {
              b.warn(
                "DEPRECATED: " +
                  e +
                  " in module " +
                  this.name +
                  "is deprecated. Please use " +
                  t +
                  " instead"
              );
            },
            createError: function (e) {
              return new Error("Error in Rangy " + this.name + " module: " + e);
            },
          }),
          (b.createModule = function (e) {
            var t, n;
            2 == arguments.length
              ? ((t = arguments[1]), (n = []))
              : ((t = arguments[2]), (n = arguments[1])),
              _(0, e, n, t);
          }),
          (b.createCoreModule = function (e, t, n) {
            _(0, e, t, n);
          }),
          (b.RangePrototype = A),
          (b.rangePrototype = new A()),
          (b.selectionPrototype = new (function () {})());
        var M = !1,
          L = function (e) {
            M || ((M = !0), b.initialized || k());
          };
        if (typeof window != i) {
          if (typeof document != i)
            return (
              l(document, "addEventListener") &&
                document.addEventListener("DOMContentLoaded", L, !1),
              v(window, "load", L),
              b
            );
          C("No document found");
        } else C("No window found");
      })();
      i.createCoreModule("DomUtil", [], function (e, t) {
        var n = "undefined",
          i = e.util;
        i.areHostMethods(document, [
          "createDocumentFragment",
          "createElement",
          "createTextNode",
        ]) || t.fail("document missing a Node creation method"),
          i.isHostMethod(document, "getElementsByTagName") ||
            t.fail("document missing getElementsByTagName method");
        var r = document.createElement("div");
        i.areHostMethods(
          r,
          ["insertBefore", "appendChild", "cloneNode"] ||
            !i.areHostObjects(r, [
              "previousSibling",
              "nextSibling",
              "childNodes",
              "parentNode",
            ])
        ) || t.fail("Incomplete Element implementation"),
          i.isHostProperty(r, "innerHTML") ||
            t.fail("Element is missing innerHTML property");
        var o = document.createTextNode("test");
        i.areHostMethods(
          o,
          [
            "splitText",
            "deleteData",
            "insertData",
            "appendData",
            "cloneNode",
          ] ||
            !i.areHostObjects(r, [
              "previousSibling",
              "nextSibling",
              "childNodes",
              "parentNode",
            ]) ||
            !i.areHostProperties(o, ["data"])
        ) || t.fail("Incomplete Text Node implementation");
        var a = function (e, t) {
          for (var n = e.length; n--; ) if (e[n] === t) return !0;
          return !1;
        };
        function s(e) {
          for (var t = 0; (e = e.previousSibling); ) ++t;
          return t;
        }
        function l(e, t) {
          var n,
            i = [];
          for (n = e; n; n = n.parentNode) i.push(n);
          for (n = t; n; n = n.parentNode) if (a(i, n)) return n;
          return null;
        }
        function c(e, t, n) {
          for (var i = n ? t : t.parentNode; i; ) {
            if (i === e) return !0;
            i = i.parentNode;
          }
          return !1;
        }
        function d(e, t, n) {
          for (var i, r = n ? e : e.parentNode; r; ) {
            if ((i = r.parentNode) === t) return r;
            r = i;
          }
          return null;
        }
        function u(e) {
          var t = e.nodeType;
          return 3 == t || 4 == t || 8 == t;
        }
        function h(e, t) {
          var n = t.nextSibling,
            i = t.parentNode;
          return n ? i.insertBefore(e, n) : i.appendChild(e), e;
        }
        function p(e) {
          if (9 == e.nodeType) return e;
          if (typeof e.ownerDocument != n) return e.ownerDocument;
          if (typeof e.document != n) return e.document;
          if (e.parentNode) return p(e.parentNode);
          throw t.createError("getDocument: no document found for node");
        }
        function f(e) {
          var i = p(e);
          if (typeof i.defaultView != n) return i.defaultView;
          if (typeof i.parentWindow != n) return i.parentWindow;
          throw t.createError("Cannot get a window object for node");
        }
        function m(e) {
          if (typeof e.contentDocument != n) return e.contentDocument;
          if (typeof e.contentWindow != n) return e.contentWindow.document;
          throw t.createError(
            "getIframeDocument: No Document object found for iframe element"
          );
        }
        function g(e) {
          return (
            e &&
            i.isHostMethod(e, "setTimeout") &&
            i.isHostObject(e, "document")
          );
        }
        var v,
          y = !1;
        function b(e) {
          try {
            return e.parentNode, !1;
          } catch (e) {
            return !0;
          }
        }
        function w(e) {
          if (!e) return "[No node]";
          if (y && b(e)) return "[Broken node]";
          if (u(e)) return '"' + e.data + '"';
          if (1 == e.nodeType) {
            var t = e.id ? ' id="' + e.id + '"' : "";
            return (
              "<" +
              e.nodeName +
              t +
              ">[index:" +
              s(e) +
              ",length:" +
              e.childNodes.length +
              "][" +
              (e.innerHTML || "[innerHTML not supported]").slice(0, 25) +
              "]"
            );
          }
          return e.nodeName;
        }
        function x(e) {
          (this.root = e), (this._next = e);
        }
        function C(e, t) {
          (this.node = e), (this.offset = t);
        }
        function F(e) {
          (this.code = this[e]),
            (this.codeName = e),
            (this.message = "[rangy] DOMException: " + this.codeName),
            "captureStackTrace" in Error
              ? Error.captureStackTrace(this, F)
              : (this.stack = new Error().stack);
        }
        !(function () {
          var t = document.createElement("b");
          t.innerHTML = "1";
          var n = t.firstChild;
          (t.innerHTML = "<br>"), (y = b(n)), (e.features.crashyTextNodes = y);
        })(),
          typeof window.getComputedStyle != n
            ? (v = function (e, t) {
                return f(e).getComputedStyle(e, null)[t];
              })
            : typeof document.documentElement.currentStyle != n
            ? (v = function (e, t) {
                return e.currentStyle[t];
              })
            : t.fail("No means of obtaining computed style properties found"),
          (x.prototype = {
            _current: null,
            hasNext: function () {
              return !!this._next;
            },
            next: function () {
              var e,
                t,
                n = (this._current = this._next);
              if (this._current)
                if ((e = n.firstChild)) this._next = e;
                else {
                  for (t = null; n !== this.root && !(t = n.nextSibling); )
                    n = n.parentNode;
                  this._next = t;
                }
              return this._current;
            },
            detach: function () {
              this._current = this._next = this.root = null;
            },
          }),
          (C.prototype = {
            equals: function (e) {
              return !!e && this.node === e.node && this.offset == e.offset;
            },
            inspect: function () {
              return "[DomPosition(" + w(this.node) + ":" + this.offset + ")]";
            },
            toString: function () {
              return this.inspect();
            },
          }),
          (F.prototype = {
            INDEX_SIZE_ERR: 1,
            HIERARCHY_REQUEST_ERR: 3,
            WRONG_DOCUMENT_ERR: 4,
            NO_MODIFICATION_ALLOWED_ERR: 7,
            NOT_FOUND_ERR: 8,
            NOT_SUPPORTED_ERR: 9,
            INVALID_STATE_ERR: 11,
            INVALID_NODE_TYPE_ERR: 24,
          }),
          (e.dom = {
            arrayContains: a,
            isHtmlNamespace: function (e) {
              var t;
              return (
                typeof e.namespaceURI == n ||
                null === (t = e.namespaceURI) ||
                "http://www.w3.org/1999/xhtml" == t
              );
            },
            parentElement: function (e) {
              var t = e.parentNode;
              return 1 == t.nodeType ? t : null;
            },
            getNodeIndex: s,
            getNodeLength: function (e) {
              switch (e.nodeType) {
                case 7:
                case 10:
                  return 0;
                case 3:
                case 8:
                  return e.length;
                default:
                  return e.childNodes.length;
              }
            },
            getCommonAncestor: l,
            isAncestorOf: c,
            isOrIsAncestorOf: function (e, t) {
              return c(e, t, !0);
            },
            getClosestAncestorIn: d,
            isCharacterDataNode: u,
            isTextOrCommentNode: function (e) {
              if (!e) return !1;
              var t = e.nodeType;
              return 3 == t || 8 == t;
            },
            insertAfter: h,
            splitDataNode: function (e, t, n) {
              var i = e.cloneNode(!1);
              if (
                (i.deleteData(0, t), e.deleteData(t, e.length - t), h(i, e), n)
              )
                for (var r, o = 0; (r = n[o++]); )
                  r.node == e && r.offset > t
                    ? ((r.node = i), (r.offset -= t))
                    : r.node == e.parentNode && r.offset > s(e) && ++r.offset;
              return i;
            },
            getDocument: p,
            getWindow: f,
            getIframeWindow: function (e) {
              if (typeof e.contentWindow != n) return e.contentWindow;
              if (typeof e.contentDocument != n)
                return e.contentDocument.defaultView;
              throw t.createError(
                "getIframeWindow: No Window object found for iframe element"
              );
            },
            getIframeDocument: m,
            getBody: i.getBody,
            isWindow: g,
            getContentDocument: function (e, t, n) {
              var r;
              if (
                (e
                  ? i.isHostProperty(e, "nodeType")
                    ? (r =
                        1 == e.nodeType && "iframe" == e.tagName.toLowerCase()
                          ? m(e)
                          : p(e))
                    : g(e) && (r = e.document)
                  : (r = document),
                !r)
              )
                throw t.createError(
                  n + "(): Parameter must be a Window object or DOM node"
                );
              return r;
            },
            getRootContainer: function (e) {
              for (var t; (t = e.parentNode); ) e = t;
              return e;
            },
            comparePoints: function (e, n, i, r) {
              var o, a, c, u, h;
              if (e == i) return n === r ? 0 : n < r ? -1 : 1;
              if ((o = d(i, e, !0))) return n <= s(o) ? -1 : 1;
              if ((o = d(e, i, !0))) return s(o) < r ? -1 : 1;
              if (!(a = l(e, i)))
                throw new Error(
                  "comparePoints error: nodes have no common ancestor"
                );
              if (
                (c = e === a ? a : d(e, a, !0)) ===
                (u = i === a ? a : d(i, a, !0))
              )
                throw t.createError(
                  "comparePoints got to case 4 and childA and childB are the same!"
                );
              for (h = a.firstChild; h; ) {
                if (h === c) return -1;
                if (h === u) return 1;
                h = h.nextSibling;
              }
            },
            isBrokenNode: b,
            inspectNode: w,
            getComputedStyleProperty: v,
            fragmentFromNodeChildren: function (e) {
              for (
                var t, n = p(e).createDocumentFragment();
                (t = e.firstChild);

              )
                n.appendChild(t);
              return n;
            },
            createIterator: function (e) {
              return new x(e);
            },
            DomPosition: C,
          }),
          (e.DOMException = F);
      }),
        i.createCoreModule("DomRange", ["DomUtil"], function (e, t) {
          var n = e.dom,
            i = e.util,
            r = n.DomPosition,
            o = e.DOMException,
            a = n.isCharacterDataNode,
            s = n.getNodeIndex,
            l = n.isOrIsAncestorOf,
            c = n.getDocument,
            d = n.comparePoints,
            u = n.splitDataNode,
            h = n.getClosestAncestorIn,
            p = n.getNodeLength,
            f = n.arrayContains,
            m = n.getRootContainer,
            g = e.features.crashyTextNodes;
          function v(e, t) {
            return (
              3 != e.nodeType &&
              (l(e, t.startContainer) || l(e, t.endContainer))
            );
          }
          function y(e) {
            return e.document || c(e.startContainer);
          }
          function b(e) {
            return new r(e.parentNode, s(e));
          }
          function w(e) {
            return new r(e.parentNode, s(e) + 1);
          }
          function x(e, t, i) {
            var r = 11 == e.nodeType ? e.firstChild : e;
            return (
              a(t)
                ? i == t.length
                  ? n.insertAfter(e, t)
                  : t.parentNode.insertBefore(e, 0 == i ? t : u(t, i))
                : i >= t.childNodes.length
                ? t.appendChild(e)
                : t.insertBefore(e, t.childNodes[i]),
              r
            );
          }
          function C(e, t, n) {
            if ((z(e), z(t), y(t) != y(e))) throw new o("WRONG_DOCUMENT_ERR");
            var i = d(
                e.startContainer,
                e.startOffset,
                t.endContainer,
                t.endOffset
              ),
              r = d(
                e.endContainer,
                e.endOffset,
                t.startContainer,
                t.startOffset
              );
            return n ? i <= 0 && r >= 0 : i < 0 && r > 0;
          }
          function F(e, t, i) {
            var r, o, a, s;
            for (i = i || { stop: !1 }; (a = e.next()); )
              if (e.isPartiallySelectedSubtree()) {
                if (!1 === t(a)) return void (i.stop = !0);
                if ((F((s = e.getSubtreeIterator()), t, i), s.detach(), i.stop))
                  return;
              } else
                for (r = n.createIterator(a); (o = r.next()); )
                  if (!1 === t(o)) return void (i.stop = !0);
          }
          function S(e) {
            for (var t; e.next(); )
              e.isPartiallySelectedSubtree()
                ? (S((t = e.getSubtreeIterator())), t.detach())
                : e.remove();
          }
          function k(e) {
            for (
              var t, n, i = y(e.range).createDocumentFragment();
              (t = e.next());

            ) {
              if (
                (e.isPartiallySelectedSubtree()
                  ? ((t = t.cloneNode(!1)),
                    (n = e.getSubtreeIterator()),
                    t.appendChild(k(n)),
                    n.detach())
                  : e.remove(),
                10 == t.nodeType)
              )
                throw new o("HIERARCHY_REQUEST_ERR");
              i.appendChild(t);
            }
            return i;
          }
          function E(e) {
            return (
              "[" +
              (void 0 === e.getName ? "Range" : e.getName()) +
              "(" +
              n.inspectNode(e.startContainer) +
              ":" +
              e.startOffset +
              ", " +
              n.inspectNode(e.endContainer) +
              ":" +
              e.endOffset +
              ")]"
            );
          }
          function T(e, t) {
            if (
              ((this.range = e),
              (this.clonePartiallySelectedTextNodes = t),
              !e.collapsed)
            ) {
              (this.sc = e.startContainer),
                (this.so = e.startOffset),
                (this.ec = e.endContainer),
                (this.eo = e.endOffset);
              var n = e.commonAncestorContainer;
              this.sc === this.ec && a(this.sc)
                ? ((this.isSingleCharacterDataNode = !0),
                  (this._first = this._last = this._next = this.sc))
                : ((this._first = this._next =
                    this.sc !== n || a(this.sc)
                      ? h(this.sc, n, !0)
                      : this.sc.childNodes[this.so]),
                  (this._last =
                    this.ec !== n || a(this.ec)
                      ? h(this.ec, n, !0)
                      : this.ec.childNodes[this.eo - 1]));
            }
          }
          T.prototype = {
            _current: null,
            _next: null,
            _first: null,
            _last: null,
            isSingleCharacterDataNode: !1,
            reset: function () {
              (this._current = null), (this._next = this._first);
            },
            hasNext: function () {
              return !!this._next;
            },
            next: function () {
              var e = (this._current = this._next);
              return (
                e &&
                  ((this._next = e !== this._last ? e.nextSibling : null),
                  a(e) &&
                    this.clonePartiallySelectedTextNodes &&
                    (e === this.ec &&
                      (e = e.cloneNode(!0)).deleteData(
                        this.eo,
                        e.length - this.eo
                      ),
                    this._current === this.sc &&
                      (e = e.cloneNode(!0)).deleteData(0, this.so))),
                e
              );
            },
            remove: function () {
              var e,
                t,
                n = this._current;
              !a(n) || (n !== this.sc && n !== this.ec)
                ? n.parentNode && n.parentNode.removeChild(n)
                : (e = n === this.sc ? this.so : 0) !=
                    (t = n === this.ec ? this.eo : n.length) &&
                  n.deleteData(e, t - e);
            },
            isPartiallySelectedSubtree: function () {
              return v(this._current, this.range);
            },
            getSubtreeIterator: function () {
              var e;
              if (this.isSingleCharacterDataNode)
                (e = this.range.cloneRange()).collapse(!1);
              else {
                e = new ue(y(this.range));
                var t = this._current,
                  n = t,
                  i = 0,
                  r = t,
                  o = p(t);
                l(t, this.sc) && ((n = this.sc), (i = this.so)),
                  l(t, this.ec) && ((r = this.ec), (o = this.eo)),
                  de(e, n, i, r, o);
              }
              return new T(e, this.clonePartiallySelectedTextNodes);
            },
            detach: function () {
              this.range =
                this._current =
                this._next =
                this._first =
                this._last =
                this.sc =
                this.so =
                this.ec =
                this.eo =
                  null;
            },
          };
          var _ = [1, 3, 4, 5, 7, 8, 10],
            A = [2, 9, 11],
            M = [1, 3, 4, 5, 7, 8, 10, 11],
            L = [1, 3, 4, 5, 7, 8];
          function N(e) {
            return function (t, n) {
              for (var i, r = n ? t : t.parentNode; r; ) {
                if (((i = r.nodeType), f(e, i))) return r;
                r = r.parentNode;
              }
              return null;
            };
          }
          var D = N([9, 11]),
            B = N([5, 6, 10, 12]),
            R = N([6, 10, 12]);
          function P(e, t) {
            if (R(e, t)) throw new o("INVALID_NODE_TYPE_ERR");
          }
          function I(e, t) {
            if (!f(t, e.nodeType)) throw new o("INVALID_NODE_TYPE_ERR");
          }
          function O(e, t) {
            if (t < 0 || t > (a(e) ? e.length : e.childNodes.length))
              throw new o("INDEX_SIZE_ERR");
          }
          function $(e, t) {
            if (D(e, !0) !== D(t, !0)) throw new o("WRONG_DOCUMENT_ERR");
          }
          function H(e) {
            if (B(e, !0)) throw new o("NO_MODIFICATION_ALLOWED_ERR");
          }
          function U(e, t) {
            if (!e) throw new o(t);
          }
          function j(e) {
            return (g && n.isBrokenNode(e)) || (!f(A, e.nodeType) && !D(e, !0));
          }
          function q(e, t) {
            return t <= (a(e) ? e.length : e.childNodes.length);
          }
          function W(e) {
            return (
              !!e.startContainer &&
              !!e.endContainer &&
              !j(e.startContainer) &&
              !j(e.endContainer) &&
              q(e.startContainer, e.startOffset) &&
              q(e.endContainer, e.endOffset)
            );
          }
          function z(e) {
            if (!W(e))
              throw new Error(
                "Range error: Range is no longer valid after DOM mutation (" +
                  e.inspect() +
                  ")"
              );
          }
          var V = document.createElement("style"),
            J = !1;
          try {
            (V.innerHTML = "<b>x</b>"), (J = 3 == V.firstChild.nodeType);
          } catch (e) {}
          e.features.htmlParsingConforms = J;
          var K = J
            ? function (e) {
                var t = this.startContainer,
                  i = c(t);
                if (!t) throw new o("INVALID_STATE_ERR");
                var r = null;
                return (
                  1 == t.nodeType ? (r = t) : a(t) && (r = n.parentElement(t)),
                  ((r =
                    null === r ||
                    ("HTML" == r.nodeName &&
                      n.isHtmlNamespace(c(r).documentElement) &&
                      n.isHtmlNamespace(r))
                      ? i.createElement("body")
                      : r.cloneNode(!1)).innerHTML = e),
                  n.fragmentFromNodeChildren(r)
                );
              }
            : function (e) {
                var t = y(this).createElement("body");
                return (t.innerHTML = e), n.fragmentFromNodeChildren(t);
              };
          function Y(e, t) {
            z(e);
            var n = e.startContainer,
              i = e.startOffset,
              r = e.endContainer,
              o = e.endOffset,
              l = n === r;
            a(r) && o > 0 && o < r.length && u(r, o, t),
              a(n) &&
                i > 0 &&
                i < n.length &&
                ((n = u(n, i, t)),
                l ? ((o -= i), (r = n)) : r == n.parentNode && o >= s(n) && o++,
                (i = 0)),
              e.setStartAndEnd(n, i, r, o);
          }
          var G = [
              "startContainer",
              "startOffset",
              "endContainer",
              "endOffset",
              "collapsed",
              "commonAncestorContainer",
            ],
            Q = 0,
            X = 1,
            Z = 2,
            ee = 3,
            te = 0,
            ne = 1,
            ie = 2,
            re = 3;
          function oe(e) {
            (e.START_TO_START = Q),
              (e.START_TO_END = X),
              (e.END_TO_END = Z),
              (e.END_TO_START = ee),
              (e.NODE_BEFORE = te),
              (e.NODE_AFTER = ne),
              (e.NODE_BEFORE_AND_AFTER = ie),
              (e.NODE_INSIDE = re);
          }
          function ae(e) {
            oe(e), oe(e.prototype);
          }
          function se(e, t) {
            return function () {
              z(this);
              var n,
                i = this.startContainer,
                r = this.startOffset,
                o = this.commonAncestorContainer,
                a = new T(this, !0);
              i !== o && ((i = (n = w(h(i, o, !0))).node), (r = n.offset)),
                F(a, H),
                a.reset();
              var s = e(a);
              return a.detach(), t(this, i, r, i, r), s;
            };
          }
          function le(t, n) {
            function r(e, t) {
              return function (n) {
                I(n, _), I(m(n), A);
                var i = (e ? b : w)(n);
                (t ? o : l)(this, i.node, i.offset);
              };
            }
            function o(e, t, i) {
              var r = e.endContainer,
                o = e.endOffset;
              (t === e.startContainer && i === e.startOffset) ||
                ((m(t) == m(r) && 1 != d(t, i, r, o)) || ((r = t), (o = i)),
                n(e, t, i, r, o));
            }
            function l(e, t, i) {
              var r = e.startContainer,
                o = e.startOffset;
              (t === e.endContainer && i === e.endOffset) ||
                ((m(t) == m(r) && -1 != d(t, i, r, o)) || ((r = t), (o = i)),
                n(e, r, o, t, i));
            }
            var c = function () {};
            (c.prototype = e.rangePrototype),
              (t.prototype = new c()),
              i.extend(t.prototype, {
                setStart: function (e, t) {
                  P(e, !0), O(e, t), o(this, e, t);
                },
                setEnd: function (e, t) {
                  P(e, !0), O(e, t), l(this, e, t);
                },
                setStartAndEnd: function () {
                  var e = arguments,
                    t = e[0],
                    i = e[1],
                    r = t,
                    o = i;
                  switch (e.length) {
                    case 3:
                      o = e[2];
                      break;
                    case 4:
                      (r = e[2]), (o = e[3]);
                  }
                  n(this, t, i, r, o);
                },
                setBoundary: function (e, t, n) {
                  this["set" + (n ? "Start" : "End")](e, t);
                },
                setStartBefore: r(!0, !0),
                setStartAfter: r(!1, !0),
                setEndBefore: r(!0, !1),
                setEndAfter: r(!1, !1),
                collapse: function (e) {
                  z(this),
                    e
                      ? n(
                          this,
                          this.startContainer,
                          this.startOffset,
                          this.startContainer,
                          this.startOffset
                        )
                      : n(
                          this,
                          this.endContainer,
                          this.endOffset,
                          this.endContainer,
                          this.endOffset
                        );
                },
                selectNodeContents: function (e) {
                  P(e, !0), n(this, e, 0, e, p(e));
                },
                selectNode: function (e) {
                  P(e, !1), I(e, _);
                  var t = b(e),
                    i = w(e);
                  n(this, t.node, t.offset, i.node, i.offset);
                },
                extractContents: se(k, n),
                deleteContents: se(S, n),
                canSurroundContents: function () {
                  z(this), H(this.startContainer), H(this.endContainer);
                  var e = new T(this, !0),
                    t =
                      (e._first && v(e._first, this)) ||
                      (e._last && v(e._last, this));
                  return e.detach(), !t;
                },
                splitBoundaries: function () {
                  Y(this);
                },
                splitBoundariesPreservingPositions: function (e) {
                  Y(this, e);
                },
                normalizeBoundaries: function () {
                  z(this);
                  var e = this.startContainer,
                    t = this.startOffset,
                    i = this.endContainer,
                    r = this.endOffset,
                    o = function (e) {
                      var t = e.nextSibling;
                      t &&
                        t.nodeType == e.nodeType &&
                        ((i = e),
                        (r = e.length),
                        e.appendData(t.data),
                        t.parentNode.removeChild(t));
                    },
                    l = function (n) {
                      var o = n.previousSibling;
                      if (o && o.nodeType == n.nodeType) {
                        e = n;
                        var a = n.length;
                        if (
                          ((t = o.length),
                          n.insertData(0, o.data),
                          o.parentNode.removeChild(o),
                          e == i)
                        )
                          (r += t), (i = e);
                        else if (i == n.parentNode) {
                          var l = s(n);
                          r == l ? ((i = n), (r = a)) : r > l && r--;
                        }
                      }
                    },
                    c = !0;
                  if (a(i)) i.length == r && o(i);
                  else {
                    if (r > 0) {
                      var d = i.childNodes[r - 1];
                      d && a(d) && o(d);
                    }
                    c = !this.collapsed;
                  }
                  if (c) {
                    if (a(e)) 0 == t && l(e);
                    else if (t < e.childNodes.length) {
                      var u = e.childNodes[t];
                      u && a(u) && l(u);
                    }
                  } else (e = i), (t = r);
                  n(this, e, t, i, r);
                },
                collapseToPoint: function (e, t) {
                  P(e, !0), O(e, t), this.setStartAndEnd(e, t);
                },
              }),
              ae(t);
          }
          function ce(e) {
            (e.collapsed =
              e.startContainer === e.endContainer &&
              e.startOffset === e.endOffset),
              (e.commonAncestorContainer = e.collapsed
                ? e.startContainer
                : n.getCommonAncestor(e.startContainer, e.endContainer));
          }
          function de(e, t, i, r, o) {
            (e.startContainer = t),
              (e.startOffset = i),
              (e.endContainer = r),
              (e.endOffset = o),
              (e.document = n.getDocument(t)),
              ce(e);
          }
          function ue(e) {
            (this.startContainer = e),
              (this.startOffset = 0),
              (this.endContainer = e),
              (this.endOffset = 0),
              (this.document = e),
              ce(this);
          }
          i.extend(e.rangePrototype, {
            compareBoundaryPoints: function (e, t) {
              var n, i, r, o;
              z(this), $(this.startContainer, t.startContainer);
              var a = e == ee || e == Q ? "start" : "end",
                s = e == X || e == Q ? "start" : "end";
              return (
                (n = this[a + "Container"]),
                (i = this[a + "Offset"]),
                (r = t[s + "Container"]),
                (o = t[s + "Offset"]),
                d(n, i, r, o)
              );
            },
            insertNode: function (e) {
              if (
                (z(this),
                I(e, M),
                H(this.startContainer),
                l(e, this.startContainer))
              )
                throw new o("HIERARCHY_REQUEST_ERR");
              var t = x(e, this.startContainer, this.startOffset);
              this.setStartBefore(t);
            },
            cloneContents: function () {
              var e, t;
              if ((z(this), this.collapsed))
                return y(this).createDocumentFragment();
              if (
                this.startContainer === this.endContainer &&
                a(this.startContainer)
              )
                return (
                  ((e = this.startContainer.cloneNode(!0)).data = e.data.slice(
                    this.startOffset,
                    this.endOffset
                  )),
                  (t = y(this).createDocumentFragment()).appendChild(e),
                  t
                );
              var n = new T(this, !0);
              return (
                (e = (function e(t) {
                  for (
                    var n, i, r, a = y(t.range).createDocumentFragment();
                    (i = t.next());

                  ) {
                    if (
                      ((n = t.isPartiallySelectedSubtree()),
                      (i = i.cloneNode(!n)),
                      n &&
                        ((r = t.getSubtreeIterator()),
                        i.appendChild(e(r)),
                        r.detach()),
                      10 == i.nodeType)
                    )
                      throw new o("HIERARCHY_REQUEST_ERR");
                    a.appendChild(i);
                  }
                  return a;
                })(n)),
                n.detach(),
                e
              );
            },
            canSurroundContents: function () {
              z(this), H(this.startContainer), H(this.endContainer);
              var e = new T(this, !0),
                t =
                  (e._first && v(e._first, this)) ||
                  (e._last && v(e._last, this));
              return e.detach(), !t;
            },
            surroundContents: function (e) {
              if ((I(e, L), !this.canSurroundContents()))
                throw new o("INVALID_STATE_ERR");
              var t = this.extractContents();
              if (e.hasChildNodes())
                for (; e.lastChild; ) e.removeChild(e.lastChild);
              x(e, this.startContainer, this.startOffset),
                e.appendChild(t),
                this.selectNode(e);
            },
            cloneRange: function () {
              z(this);
              for (var e, t = new ue(y(this)), n = G.length; n--; )
                t[(e = G[n])] = this[e];
              return (t.isBackward = this.isBackward), t;
            },
            toString: function () {
              z(this);
              var e = this.startContainer;
              if (e === this.endContainer && a(e))
                return 3 == e.nodeType || 4 == e.nodeType
                  ? e.data.slice(this.startOffset, this.endOffset)
                  : "";
              var t = [],
                n = new T(this, !0);
              return (
                F(n, function (e) {
                  (3 != e.nodeType && 4 != e.nodeType) || t.push(e.data);
                }),
                n.detach(),
                t.join("")
              );
            },
            compareNode: function (e) {
              z(this);
              var t = e.parentNode,
                n = s(e);
              if (!t) throw new o("NOT_FOUND_ERR");
              var i = this.comparePoint(t, n),
                r = this.comparePoint(t, n + 1);
              return i < 0 ? (r > 0 ? ie : te) : r > 0 ? ne : re;
            },
            comparePoint: function (e, t) {
              return (
                z(this),
                U(e, "HIERARCHY_REQUEST_ERR"),
                $(e, this.startContainer),
                d(e, t, this.startContainer, this.startOffset) < 0
                  ? -1
                  : d(e, t, this.endContainer, this.endOffset) > 0
                  ? 1
                  : 0
              );
            },
            createContextualFragment: K,
            toHtml: function () {
              z(this);
              var e = this.commonAncestorContainer.parentNode.cloneNode(!1);
              return e.appendChild(this.cloneContents()), e.innerHTML;
            },
            intersectsNode: function (e, t) {
              if ((z(this), U(e, "NOT_FOUND_ERR"), c(e) !== y(this))) return !1;
              var n = e.parentNode,
                i = s(e);
              U(n, "NOT_FOUND_ERR");
              var r = d(n, i, this.endContainer, this.endOffset),
                o = d(n, i + 1, this.startContainer, this.startOffset);
              return t ? r <= 0 && o >= 0 : r < 0 && o > 0;
            },
            isPointInRange: function (e, t) {
              return (
                z(this),
                U(e, "HIERARCHY_REQUEST_ERR"),
                $(e, this.startContainer),
                d(e, t, this.startContainer, this.startOffset) >= 0 &&
                  d(e, t, this.endContainer, this.endOffset) <= 0
              );
            },
            intersectsRange: function (e) {
              return C(this, e, !1);
            },
            intersectsOrTouchesRange: function (e) {
              return C(this, e, !0);
            },
            intersection: function (e) {
              if (this.intersectsRange(e)) {
                var t = d(
                    this.startContainer,
                    this.startOffset,
                    e.startContainer,
                    e.startOffset
                  ),
                  n = d(
                    this.endContainer,
                    this.endOffset,
                    e.endContainer,
                    e.endOffset
                  ),
                  i = this.cloneRange();
                return (
                  -1 == t && i.setStart(e.startContainer, e.startOffset),
                  1 == n && i.setEnd(e.endContainer, e.endOffset),
                  i
                );
              }
              return null;
            },
            union: function (e) {
              if (this.intersectsOrTouchesRange(e)) {
                var t = this.cloneRange();
                return (
                  -1 ==
                    d(
                      e.startContainer,
                      e.startOffset,
                      this.startContainer,
                      this.startOffset
                    ) && t.setStart(e.startContainer, e.startOffset),
                  1 ==
                    d(
                      e.endContainer,
                      e.endOffset,
                      this.endContainer,
                      this.endOffset
                    ) && t.setEnd(e.endContainer, e.endOffset),
                  t
                );
              }
              throw new o("Ranges do not intersect");
            },
            containsNode: function (e, t) {
              try {
                return t
                  ? this.intersectsNode(e, !1)
                  : this.compareNode(e) == re;
              } catch (e) {
                return console.sendError(e), !1;
              }
            },
            containsNodeContents: function (e) {
              return (
                this.comparePoint(e, 0) >= 0 && this.comparePoint(e, p(e)) <= 0
              );
            },
            containsRange: function (e) {
              var t = this.intersection(e);
              return null !== t && e.equals(t);
            },
            containsNodeText: function (e) {
              var t = this.cloneRange();
              t.selectNode(e);
              var n = t.getNodes([3]);
              if (n.length > 0) {
                t.setStart(n[0], 0);
                var i = n.pop();
                return t.setEnd(i, i.length), this.containsRange(t);
              }
              return this.containsNodeContents(e);
            },
            getNodes: function (e, t) {
              return (
                z(this),
                (function (e, t, n) {
                  var i,
                    r = !(!t || !t.length),
                    o = !!n;
                  r && (i = new RegExp("^(" + t.join("|") + ")$"));
                  var s = [];
                  return (
                    F(new T(e, !1), function (t) {
                      if ((!r || i.test(t.nodeType)) && (!o || n(t))) {
                        var l = e.startContainer;
                        if (t != l || !a(l) || e.startOffset != l.length) {
                          var c = e.endContainer;
                          (t == c && a(c) && 0 == e.endOffset) || s.push(t);
                        }
                      }
                    }),
                    s
                  );
                })(this, e, t)
              );
            },
            getDocument: function () {
              return y(this);
            },
            collapseBefore: function (e) {
              this.setEndBefore(e), this.collapse(!1);
            },
            collapseAfter: function (e) {
              this.setStartAfter(e), this.collapse(!0);
            },
            getBookmark: function (t, i) {
              if (!t) return {};
              function r(e) {
                var t = e.cloneContents();
                if (t.querySelector("mjx-container, text, ruby")) {
                  for (
                    var n = t.querySelectorAll(
                        `mjx-container, svg, ruby${
                          i ? ",.md-math-after-sym" : ""
                        }`
                      ),
                      r = 0;
                    r < n.length;
                    r++
                  )
                    n[r].parentElement && n[r].parentElement.removeChild(n[r]);
                  return t.textContent.length;
                }
                return e.toString().length;
              }
              var o = y(this),
                a = e.createRange(o);
              (t = t || n.getBody(o)), a.selectNodeContents(t);
              var s = this.intersection(a),
                l = t.querySelectorAll("mjx-container, text, ruby").length,
                c = 0,
                d = 0;
              return (
                s &&
                  (a.setEnd(s.startContainer, s.startOffset),
                  (d =
                    (c = l ? r(a) : a.toString().length) +
                    (l ? r(s) : s.toString().length))),
                { start: c, end: d, containerNode: t }
              );
            },
            moveToBookmark: function (e) {
              var t = e.containerNode,
                n = 0;
              this.setStart(t, 0), this.collapse(!0);
              for (
                var i, r, o, a, s = [t], l = !1, c = !1;
                !c && (i = s.pop());

              )
                if (3 == i.nodeType)
                  (r = n + i.length),
                    !l &&
                      e.start >= n &&
                      e.start <= r &&
                      (this.setStart(i, e.start - n), (l = !0)),
                    l &&
                      e.end >= n &&
                      e.end <= r &&
                      (this.setEnd(i, e.end - n), (c = !0)),
                    (n = r);
                else if (!/^(MJX\-CONTAINER|text|RUBY)$/i.exec(i.tagName || ""))
                  for (o = (a = i.childNodes).length; o--; ) s.push(a[o]);
            },
            getName: function () {
              return "DomRange";
            },
            equals: function (e) {
              return ue.rangesEqual(this, e);
            },
            isValid: function () {
              return W(this);
            },
            inspect: function () {
              return E(this);
            },
            detach: function () {},
          }),
            le(ue, de),
            i.extend(ue, {
              rangeProperties: G,
              RangeIterator: T,
              copyComparisonConstants: ae,
              createPrototypeRange: le,
              inspect: E,
              getRangeDocument: y,
              rangesEqual: function (e, t) {
                return (
                  e.startContainer === t.startContainer &&
                  e.startOffset === t.startOffset &&
                  e.endContainer === t.endContainer &&
                  e.endOffset === t.endOffset
                );
              },
            }),
            (e.DomRange = ue);
        }),
        i.createCoreModule("WrappedRange", ["DomRange"], function (e, t) {
          var n,
            i,
            r = e.dom,
            o = e.util,
            a = r.DomPosition,
            s = e.DomRange,
            l = r.getBody,
            c = r.getContentDocument,
            d = r.isCharacterDataNode;
          if (
            (e.features.implementsDomRange &&
              (function () {
                var i,
                  a,
                  d = s.rangeProperties;
                function u(e) {
                  for (var t, n = d.length; n--; )
                    e[(t = d[n])] = e.nativeRange[t];
                  e.collapsed =
                    e.startContainer === e.endContainer &&
                    e.startOffset === e.endOffset;
                }
                (n = function (e) {
                  if (!e)
                    throw t.createError(
                      "WrappedRange: Range must be specified"
                    );
                  (this.nativeRange = e), u(this);
                }),
                  s.createPrototypeRange(n, function (e, t, n, i, r) {
                    var o = e.startContainer !== t || e.startOffset != n,
                      a = e.endContainer !== i || e.endOffset != r,
                      s = !e.equals(e.nativeRange);
                    (o || a || s) && (e.setEnd(i, r), e.setStart(t, n));
                  }),
                  ((i = n.prototype).selectNode = function (e) {
                    this.nativeRange.selectNode(e), u(this);
                  }),
                  (i.cloneContents = function () {
                    return this.nativeRange.cloneContents();
                  }),
                  (i.surroundContents = function (e) {
                    this.nativeRange.surroundContents(e), u(this);
                  }),
                  (i.collapse = function (e) {
                    this.nativeRange.collapse(e), u(this);
                  }),
                  (i.cloneRange = function () {
                    var e = new n(this.nativeRange.cloneRange());
                    return (e.isBackward = this.isBackward), e;
                  }),
                  (i.refresh = function () {
                    u(this);
                  }),
                  (i.toString = function () {
                    return this.nativeRange.toString();
                  });
                var h = document.createTextNode("test");
                l(document).appendChild(h);
                var p = document.createRange();
                p.setStart(h, 0), p.setEnd(h, 0);
                try {
                  p.setStart(h, 1),
                    (i.setStart = function (e, t) {
                      this.nativeRange.setStart(e, t), u(this);
                    }),
                    (i.setEnd = function (e, t) {
                      this.nativeRange.setEnd(e, t), u(this);
                    }),
                    (a = function (e) {
                      return function (t) {
                        this.nativeRange[e](t), u(this);
                      };
                    });
                } catch (e) {
                  (i.setStart = function (e, t) {
                    try {
                      this.nativeRange.setStart(e, t);
                    } catch (n) {
                      this.nativeRange.setEnd(e, t),
                        this.nativeRange.setStart(e, t);
                    }
                    u(this);
                  }),
                    (i.setEnd = function (e, t) {
                      try {
                        this.nativeRange.setEnd(e, t);
                      } catch (n) {
                        this.nativeRange.setStart(e, t),
                          this.nativeRange.setEnd(e, t);
                      }
                      u(this);
                    }),
                    (a = function (e, t) {
                      return function (n) {
                        try {
                          this.nativeRange[e](n);
                        } catch (i) {
                          this.nativeRange[t](n), this.nativeRange[e](n);
                        }
                        u(this);
                      };
                    });
                }
                (i.setStartBefore = a("setStartBefore", "setEndBefore")),
                  (i.setStartAfter = a("setStartAfter", "setEndAfter")),
                  (i.setEndBefore = a("setEndBefore", "setStartBefore")),
                  (i.setEndAfter = a("setEndAfter", "setStartAfter")),
                  (i.selectNodeContents = function (e) {
                    this.setStartAndEnd(e, 0, r.getNodeLength(e));
                  }),
                  p.selectNodeContents(h),
                  p.setEnd(h, 3);
                var f = document.createRange();
                f.selectNodeContents(h),
                  f.setEnd(h, 4),
                  f.setStart(h, 2),
                  -1 == p.compareBoundaryPoints(p.START_TO_END, f) &&
                  1 == p.compareBoundaryPoints(p.END_TO_START, f)
                    ? (i.compareBoundaryPoints = function (e, t) {
                        return (
                          e == (t = t.nativeRange || t).START_TO_END
                            ? (e = t.END_TO_START)
                            : e == t.END_TO_START && (e = t.START_TO_END),
                          this.nativeRange.compareBoundaryPoints(e, t)
                        );
                      })
                    : (i.compareBoundaryPoints = function (e, t) {
                        return this.nativeRange.compareBoundaryPoints(
                          e,
                          t.nativeRange || t
                        );
                      });
                var m = document.createElement("div");
                m.innerHTML = "123";
                var g = m.firstChild,
                  v = l(document);
                v.appendChild(m),
                  p.setStart(g, 1),
                  p.setEnd(g, 2),
                  p.deleteContents(),
                  "13" == g.data &&
                    ((i.deleteContents = function () {
                      this.nativeRange.deleteContents(), u(this);
                    }),
                    (i.extractContents = function () {
                      var e = this.nativeRange.extractContents();
                      return u(this), e;
                    })),
                  v.removeChild(m),
                  (v = null),
                  o.isHostMethod(p, "createContextualFragment") &&
                    (i.createContextualFragment = function (e) {
                      return this.nativeRange.createContextualFragment(e);
                    }),
                  l(document).removeChild(h),
                  (i.getName = function () {
                    return "WrappedRange";
                  }),
                  (e.WrappedRange = n),
                  (e.createNativeRange = function (e) {
                    return (e = c(e, t, "createNativeRange")).createRange();
                  });
              })(),
            e.features.implementsTextRange)
          ) {
            var u = function (e, t, n, i, o) {
                var s = e.duplicate();
                s.collapse(n);
                var l = s.parentElement();
                if ((r.isOrIsAncestorOf(t, l) || (l = t), !l.canHaveHTML)) {
                  var c = new a(l.parentNode, r.getNodeIndex(l));
                  return {
                    boundaryPosition: c,
                    nodeInfo: { nodeIndex: c.offset, containerElement: c.node },
                  };
                }
                var u = r.getDocument(l).createElement("span");
                u.parentNode && u.parentNode.removeChild(u);
                for (
                  var h,
                    p,
                    f,
                    m,
                    g,
                    v = n ? "StartToStart" : "StartToEnd",
                    y = o && o.containerElement == l ? o.nodeIndex : 0,
                    b = l.childNodes.length,
                    w = b,
                    x = w;
                  x == b
                    ? l.appendChild(u)
                    : l.insertBefore(u, l.childNodes[x]),
                    s.moveToElementText(u),
                    0 != (h = s.compareEndPoints(v, e)) && y != w;

                ) {
                  if (-1 == h) {
                    if (w == y + 1) break;
                    y = x;
                  } else w = w == y + 1 ? y : x;
                  (x = Math.floor((y + w) / 2)), l.removeChild(u);
                }
                if (((g = u.nextSibling), -1 == h && g && d(g))) {
                  var C;
                  if (
                    (s.setEndPoint(n ? "EndToStart" : "EndToEnd", e),
                    /[\r\n]/.test(g.data))
                  ) {
                    var F = s.duplicate(),
                      S = F.text.replace(/\r\n/g, "\r").length;
                    for (
                      C = F.moveStart("character", S);
                      -1 == (h = F.compareEndPoints("StartToEnd", F));

                    )
                      C++, F.moveStart("character", 1);
                  } else C = s.text.length;
                  m = new a(g, C);
                } else
                  (p = (i || !n) && u.previousSibling),
                    (m =
                      (f = (i || n) && u.nextSibling) && d(f)
                        ? new a(f, 0)
                        : p && d(p)
                        ? new a(p, p.data.length)
                        : new a(l, r.getNodeIndex(u)));
                return (
                  u.parentNode.removeChild(u),
                  {
                    boundaryPosition: m,
                    nodeInfo: { nodeIndex: x, containerElement: l },
                  }
                );
              },
              h = function (e, t) {
                var n,
                  i,
                  o,
                  a,
                  s = e.offset,
                  c = r.getDocument(e.node),
                  u = l(c).createTextRange(),
                  h = d(e.node);
                return (
                  h
                    ? (i = (n = e.node).parentNode)
                    : ((n = s < (a = e.node.childNodes).length ? a[s] : null),
                      (i = e.node)),
                  ((o = c.createElement("span")).innerHTML = "&#feff;"),
                  n ? i.insertBefore(o, n) : i.appendChild(o),
                  u.moveToElementText(o),
                  u.collapse(!t),
                  i.removeChild(o),
                  h && u[t ? "moveStart" : "moveEnd"]("character", s),
                  u
                );
              };
            if (
              (((i = function (e) {
                (this.textRange = e), this.refresh();
              }).prototype = new s(document)),
              (i.prototype.refresh = function () {
                var e,
                  t,
                  n,
                  i,
                  o = (function (e) {
                    var t = e.parentElement(),
                      n = e.duplicate();
                    n.collapse(!0);
                    var i = n.parentElement();
                    (n = e.duplicate()).collapse(!1);
                    var o = n.parentElement(),
                      a = i == o ? i : r.getCommonAncestor(i, o);
                    return a == t ? a : r.getCommonAncestor(t, a);
                  })(this.textRange);
                0 == (i = this.textRange).compareEndPoints("StartToEnd", i)
                  ? (t = e = u(this.textRange, o, !0, !0).boundaryPosition)
                  : ((e = (n = u(this.textRange, o, !0, !1)).boundaryPosition),
                    (t = u(
                      this.textRange,
                      o,
                      !1,
                      !1,
                      n.nodeInfo
                    ).boundaryPosition)),
                  this.setStart(e.node, e.offset),
                  this.setEnd(t.node, t.offset);
              }),
              (i.prototype.getName = function () {
                return "WrappedTextRange";
              }),
              s.copyComparisonConstants(i),
              (i.rangeToTextRange = function (e) {
                if (e.collapsed)
                  return h(new a(e.startContainer, e.startOffset), !0);
                var t = h(new a(e.startContainer, e.startOffset), !0),
                  n = h(new a(e.endContainer, e.endOffset), !1),
                  i = l(s.getRangeDocument(e)).createTextRange();
                return (
                  i.setEndPoint("StartToStart", t),
                  i.setEndPoint("EndToEnd", n),
                  i
                );
              }),
              (e.WrappedTextRange = i),
              !e.features.implementsDomRange || e.config.preferTextRange)
            ) {
              var p = (function () {
                return this;
              })();
              void 0 === p.Range && (p.Range = i),
                (e.createNativeRange = function (e) {
                  return (
                    (e = c(e, t, "createNativeRange")), l(e).createTextRange()
                  );
                }),
                (e.WrappedRange = i);
            }
          }
          (e.createRange = function (n) {
            return (
              (n = c(n, t, "createRange")),
              new e.WrappedRange(e.createNativeRange(n))
            );
          }),
            (e.createRangyRange = function (e) {
              return (e = c(e, t, "createRangyRange")), new s(e);
            }),
            (e.createIframeRange = function (n) {
              return (
                t.deprecationNotice(
                  "createIframeRange()",
                  "createRange(iframeEl)"
                ),
                e.createRange(n)
              );
            }),
            (e.createIframeRangyRange = function (n) {
              return (
                t.deprecationNotice(
                  "createIframeRangyRange()",
                  "createRangyRange(iframeEl)"
                ),
                e.createRangyRange(n)
              );
            }),
            e.addCreateMissingNativeApiListener(function (t) {
              var n = t.document;
              void 0 === n.createRange &&
                (n.createRange = function () {
                  return e.createRange(n);
                }),
                (n = t = null);
            });
        }),
        i.createCoreModule(
          "WrappedSelection",
          ["DomRange", "WrappedRange"],
          function (e, t) {
            e.config.checkSelectionRanges = !0;
            var n,
              i,
              r = e.dom,
              o = e.util,
              a = o.isHostMethod,
              s = e.DomRange,
              l = e.WrappedRange,
              c = e.DOMException,
              d = r.DomPosition,
              u = e.features,
              h = r.getDocument,
              p = r.getBody,
              f = s.rangesEqual;
            function m(e) {
              return "string" == typeof e ? /^backward(s)?$/i.test(e) : !!e;
            }
            function g(e, n) {
              if (e) {
                if (r.isWindow(e)) return e;
                if (e instanceof H) return e.win;
                var i = r.getContentDocument(e, t, n);
                return r.getWindow(i);
              }
              return window;
            }
            function v(e) {
              return g(e, "getDocSelection").document.selection;
            }
            function y(e) {
              var t = !1;
              return (
                e.anchorNode &&
                  (t =
                    1 ==
                    r.comparePoints(
                      e.anchorNode,
                      e.anchorOffset,
                      e.focusNode,
                      e.focusOffset
                    )),
                t
              );
            }
            var b = a(window, "getSelection"),
              w = o.isHostObject(document, "selection");
            (u.implementsWinGetSelection = b), (u.implementsDocSelection = w);
            var x = w && (!b || e.config.preferTextRange);
            x
              ? ((n = v),
                (e.isSelectionValid = function (e) {
                  var t = g(e, "isSelectionValid").document,
                    n = t.selection;
                  return (
                    "None" != n.type || h(n.createRange().parentElement()) == t
                  );
                }))
              : b
              ? ((n = function (e) {
                  return g(e, "getWinSelection").getSelection();
                }),
                (e.isSelectionValid = function () {
                  return !0;
                }))
              : t.fail(
                  "Neither document.selection or window.getSelection() detected."
                ),
              (e.getNativeSelection = n);
            var C = n(),
              F = e.createNativeRange(document),
              S = p(document),
              k = o.areHostProperties(C, [
                "anchorNode",
                "focusNode",
                "anchorOffset",
                "focusOffset",
              ]);
            u.selectionHasAnchorAndFocus = k;
            var E = a(C, "extend");
            u.selectionHasExtend = E;
            var T = "number" == typeof C.rangeCount;
            u.selectionHasRangeCount = T;
            var _ = E
              ? function (t, n) {
                  var i = s.getRangeDocument(n),
                    r = e.createRange(i);
                  r.collapseToPoint(n.endContainer, n.endOffset),
                    t.addRange(B(r)),
                    t.extend(n.startContainer, n.startOffset);
                }
              : null;
            o.areHostMethods(C, [
              "addRange",
              "getRangeAt",
              "removeAllRanges",
            ]) &&
              "number" == typeof C.rangeCount &&
              u.implementsDomRange &&
              (function () {
                var t = window.getSelection();
                if (t) {
                  for (
                    var n = t.rangeCount, i = [], r = y(t), o = 0;
                    o < n;
                    ++o
                  )
                    i[o] = t.getRangeAt(o);
                  for (o = 0; o < n; ++o)
                    0 == o && r
                      ? _
                        ? _(t, i[o])
                        : (e.warn(
                            "Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"
                          ),
                          t.addRange(i[o]))
                      : t.addRange(i[o]);
                }
              })(),
              (u.selectionSupportsMultipleRanges = !1),
              (u.collapsedNonEditableSelectionsSupported = !0);
            var A,
              M,
              L = !1;
            function N(e, t, n) {
              var i = n ? "end" : "start",
                r = n ? "start" : "end";
              (e.anchorNode = t[i + "Container"]),
                (e.anchorOffset = t[i + "Offset"]),
                (e.focusNode = t[r + "Container"]),
                (e.focusOffset = t[r + "Offset"]);
            }
            function D(e) {
              (e.anchorNode = e.focusNode = null),
                (e.anchorOffset = e.focusOffset = 0),
                (e.rangeCount = 0),
                (e.isCollapsed = !0),
                (e._ranges.length = 0);
            }
            function B(t) {
              var n;
              return (
                t instanceof s
                  ? ((n = e.createNativeRange(t.getDocument())).setEnd(
                      t.endContainer,
                      t.endOffset
                    ),
                    n.setStart(t.startContainer, t.startOffset))
                  : t instanceof l
                  ? (n = t.nativeRange)
                  : u.implementsDomRange &&
                    t instanceof r.getWindow(t.startContainer).Range &&
                    (n = t),
                n
              );
            }
            function R(e) {
              var n = e.getNodes();
              if (
                !(function (e) {
                  if (!e.length || 1 != e[0].nodeType) return !1;
                  for (var t = 1, n = e.length; t < n; ++t)
                    if (!r.isAncestorOf(e[0], e[t])) return !1;
                  return !0;
                })(n)
              )
                throw t.createError(
                  "getSingleElementFromRange: range " +
                    e.inspect() +
                    " did not consist of a single element"
                );
              return n[0];
            }
            function P(e) {
              return !!e && void 0 !== e.text;
            }
            function I(e, t) {
              var n = new l(t);
              (e._ranges = [n]),
                N(e, n, !1),
                (e.rangeCount = 1),
                (e.isCollapsed = n.collapsed);
            }
            function O(t) {
              if (((t._ranges.length = 0), "None" == t.docSelection.type)) D(t);
              else {
                var n = t.docSelection.createRange();
                if (P(n)) I(t, n);
                else {
                  t.rangeCount = n.length;
                  for (var i, r = h(n.item(0)), o = 0; o < t.rangeCount; ++o)
                    (i = e.createRange(r)).selectNode(n.item(o)),
                      t._ranges.push(i);
                  (t.isCollapsed = 1 == t.rangeCount && t._ranges[0].collapsed),
                    N(t, t._ranges[t.rangeCount - 1], !1);
                }
              }
            }
            function $(e, n) {
              for (
                var i = e.docSelection.createRange(),
                  r = R(n),
                  o = h(i.item(0)),
                  a = p(o).createControlRange(),
                  s = 0,
                  l = i.length;
                s < l;
                ++s
              )
                a.add(i.item(s));
              try {
                a.add(r);
              } catch (e) {
                throw t.createError(
                  "addRange(): Element within the specified Range could not be added to control selection (does it have layout?)"
                );
              }
              newControlrange.select(n.isBackward), O(e);
            }
            function H(e, t, n) {
              (this.nativeSelection = e),
                (this.docSelection = t),
                (this._ranges = []),
                (this.win = n),
                this.refresh();
            }
            function U(e) {
              (e.win = e.anchorNode = e.focusNode = e._ranges = null),
                (e.rangeCount = e.anchorOffset = e.focusOffset = 0),
                (e.detached = !0);
            }
            S &&
              a(S, "createControlRange") &&
              ((A = S.createControlRange()),
              o.areHostProperties(A, ["item", "add"]) && (L = !0)),
              (u.implementsControlRange = L),
              (i = k
                ? function (e) {
                    return (
                      e.anchorNode === e.focusNode &&
                      e.anchorOffset === e.focusOffset
                    );
                  }
                : function (e) {
                    return (
                      !!e.rangeCount && e.getRangeAt(e.rangeCount - 1).collapsed
                    );
                  }),
              a(C, "getRangeAt")
                ? (M = function (e, t) {
                    try {
                      return e.getRangeAt(t);
                    } catch (e) {
                      return null;
                    }
                  })
                : k &&
                  (M = function (t) {
                    var n = h(t.anchorNode),
                      i = e.createRange(n);
                    return (
                      i.setStartAndEnd(
                        t.anchorNode,
                        t.anchorOffset,
                        t.focusNode,
                        t.focusOffset
                      ),
                      i.collapsed !== this.isCollapsed &&
                        i.setStartAndEnd(
                          t.focusNode,
                          t.focusOffset,
                          t.anchorNode,
                          t.anchorOffset
                        ),
                      i
                    );
                  }),
              (H.prototype = e.selectionPrototype);
            var j = [];
            function q(e, t) {
              for (var n, i, r = j.length; r--; )
                if (((i = (n = j[r]).selection), "deleteAll" == t)) U(i);
                else if (n.win == e)
                  return "delete" == t ? (j.splice(r, 1), !0) : i;
              return "deleteAll" == t && (j.length = 0), null;
            }
            var W = function (e) {
              if (e && e instanceof H) return e.refresh(), e;
              var t = q((e = g(e, "getNativeSelection"))),
                i = n(e),
                r = w ? v(e) : null;
              return (
                t
                  ? ((t.nativeSelection = i), (t.docSelection = r), t.refresh())
                  : ((t = new H(i, r, e)), j.push({ win: e, selection: t })),
                t
              );
            };
            (e.getSelection = W),
              (e.getIframeSelection = function (n) {
                return (
                  t.deprecationNotice(
                    "getIframeSelection()",
                    "getSelection(iframeEl)"
                  ),
                  e.getSelection(r.getIframeWindow(n))
                );
              });
            var z,
              V = H.prototype;
            function J(e, n) {
              for (
                var i,
                  r = h(n[0].startContainer),
                  o = p(r).createControlRange(),
                  a = 0,
                  s = n.length;
                a < s;
                ++a
              ) {
                i = R(n[a]);
                try {
                  o.add(i);
                } catch (e) {
                  throw t.createError(
                    "setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)"
                  );
                }
              }
              controlrange.select(range.isBackward), O(e);
            }
            if (
              !x &&
              k &&
              o.areHostMethods(C, ["removeAllRanges", "addRange"])
            ) {
              V.removeAllRanges = function () {
                this.nativeSelection.removeAllRanges(), D(this);
              };
              var K = function (e, t) {
                _(e.nativeSelection, t), e.refresh();
              };
              (V.addRange = T
                ? function (t, n) {
                    var r;
                    if (L && w && "Control" == this.docSelection.type)
                      $(this, t);
                    else if (m(n) && E) K(this, t);
                    else if (
                      (this.removeAllRanges(),
                      (r = 0),
                      this.nativeSelection.addRange(B(t).cloneRange()),
                      (this.rangeCount = this.nativeSelection.rangeCount),
                      this.rangeCount == r + 1)
                    ) {
                      if (e.config.checkSelectionRanges) {
                        var o = M(this.nativeSelection, this.rangeCount - 1);
                        o && !f(o, t) && (t = new l(o));
                      }
                      (this._ranges[this.rangeCount - 1] = t),
                        N(this, t, Y(this.nativeSelection)),
                        (this.isCollapsed = i(this));
                    } else this.refresh();
                  }
                : function (e, t) {
                    m(t) && E
                      ? K(this, e)
                      : (this.nativeSelection.addRange(B(e)), this.refresh());
                  }),
                (V.setRanges = function (e) {
                  if (L && e.length > 1) J(this, e);
                  else {
                    this.removeAllRanges();
                    for (var t = 0, n = e.length; t < n; ++t)
                      this.addRange(e[t]);
                  }
                });
            } else {
              if (!(a(C, "empty") && a(F, "select") && L && x))
                return (
                  t.fail(
                    "No means of selecting a Range or TextRange was found"
                  ),
                  !1
                );
              (V.removeAllRanges = function () {
                try {
                  if (
                    (this.docSelection.empty(),
                    "None" != this.docSelection.type)
                  ) {
                    var e;
                    if (this.anchorNode) e = h(this.anchorNode);
                    else if ("Control" == this.docSelection.type) {
                      var t = this.docSelection.createRange();
                      t.length && (e = h(t.item(0)));
                    }
                    if (e) {
                      p(e).createTextRange();
                      textrange.select(range.isBackward),
                        this.docSelection.empty();
                    }
                  }
                } catch (e) {}
                D(this);
              }),
                (V.addRange = function (t) {
                  "Control" == this.docSelection.type
                    ? $(this, t)
                    : (e.WrappedTextRange.rangeToTextRange(t).select(),
                      (this._ranges[0] = t),
                      (this.rangeCount = 1),
                      (this.isCollapsed = this._ranges[0].collapsed),
                      N(this, t, !1));
                }),
                (V.setRanges = function (e) {
                  this.removeAllRanges();
                  var t = e.length;
                  t > 1 ? J(this, e) : t && this.addRange(e[0]);
                });
            }
            if (
              ((V.getRangeAt = function (e) {
                if (e < 0 || e >= this.rangeCount)
                  throw new c("INDEX_SIZE_ERR");
                return this._ranges[e].cloneRange();
              }),
              x)
            )
              z = function (t) {
                var n;
                e.isSelectionValid(t.win)
                  ? (n = t.docSelection.createRange())
                  : (n = p(t.win.document).createTextRange()).collapse(!0),
                  "Control" == t.docSelection.type
                    ? O(t)
                    : P(n)
                    ? I(t, n)
                    : D(t);
              };
            else if (a(C, "getRangeAt") && "number" == typeof C.rangeCount)
              z = function (t) {
                if (L && w && "Control" == t.docSelection.type) O(t);
                else if (
                  ((t._ranges.length = t.rangeCount =
                    t.nativeSelection.rangeCount),
                  t.rangeCount)
                ) {
                  for (var n = 0, r = t.rangeCount; n < r; ++n)
                    t._ranges[n] = new e.WrappedRange(
                      t.nativeSelection.getRangeAt(n)
                    );
                  N(t, t._ranges[t.rangeCount - 1], Y(t.nativeSelection)),
                    (t.isCollapsed = i(t));
                } else D(t);
              };
            else {
              if (
                !k ||
                "boolean" != typeof C.isCollapsed ||
                "boolean" != typeof F.collapsed ||
                !u.implementsDomRange
              )
                return (
                  t.fail(
                    "No means of obtaining a Range or TextRange from the user's selection was found"
                  ),
                  !1
                );
              z = function (e) {
                var t,
                  n = e.nativeSelection;
                n.anchorNode
                  ? ((t = M(n, 0)),
                    (e._ranges = [t]),
                    (e.rangeCount = 1),
                    (function (e) {
                      var t = e.nativeSelection;
                      (e.anchorNode = t.anchorNode),
                        (e.anchorOffset = t.anchorOffset),
                        (e.focusNode = t.focusNode),
                        (e.focusOffset = t.focusOffset);
                    })(e),
                    (e.isCollapsed = i(e)))
                  : D(e);
              };
            }
            V.refresh = function (e) {
              var t = e ? this._ranges.slice(0) : null,
                n = this.anchorNode,
                i = this.anchorOffset;
              if ((z(this), e)) {
                var r = t.length;
                if (r != this._ranges.length) return !0;
                if (this.anchorNode != n || this.anchorOffset != i) return !0;
                for (; r--; ) if (!f(t[r], this._ranges[r])) return !0;
                return !1;
              }
            };
            var Y,
              G = function (e, t) {
                var n = e.getAllRanges();
                e.removeAllRanges();
                for (var i = 0, r = n.length; i < r; ++i)
                  f(t, n[i]) || e.addRange(n[i]);
                e.rangeCount || D(e);
              };
            function Q(e, t) {
              if (e.win.document != h(t)) throw new c("WRONG_DOCUMENT_ERR");
            }
            function X(t) {
              return function (n, i) {
                var r;
                this.rangeCount
                  ? (r = this.getRangeAt(0))["set" + (t ? "Start" : "End")](
                      n,
                      i
                    )
                  : (r = e.createRange(this.win.document)).setStartAndEnd(n, i),
                  this.setSingleRange(r, this.isBackward());
              };
            }
            function Z(e) {
              var t = [],
                n = new d(e.anchorNode, e.anchorOffset),
                i = new d(e.focusNode, e.focusOffset),
                r = "function" == typeof e.getName ? e.getName() : "Selection";
              if (void 0 !== e.rangeCount)
                for (var o = 0, a = e.rangeCount; o < a; ++o)
                  t[o] = s.inspect(e.getRangeAt(o));
              return (
                "[" +
                r +
                "(Ranges: " +
                t.join(", ") +
                ")(anchor: " +
                n.inspect() +
                ", focus: " +
                i.inspect() +
                "]"
              );
            }
            (V.removeRange = L
              ? function (e) {
                  if ("Control" == this.docSelection.type) {
                    for (
                      var t = this.docSelection.createRange(),
                        n = R(e),
                        i = h(t.item(0)),
                        r = p(i).createControlRange(),
                        o = !1,
                        a = 0,
                        s = t.length;
                      a < s;
                      ++a
                    )
                      t.item(a) !== n || o ? r.add(t.item(a)) : (o = !0);
                    newControlrange.select(e.isBackward), O(this);
                  } else G(this, e);
                }
              : function (e) {
                  G(this, e);
                }),
              !x && k && u.implementsDomRange
                ? ((Y = y),
                  (V.isBackward = function () {
                    return Y(this);
                  }))
                : (Y = V.isBackward =
                    function () {
                      return !1;
                    }),
              (V.isBackwards = V.isBackward),
              (V.toString = function () {
                for (var e = [], t = 0, n = this.rangeCount; t < n; ++t)
                  e[t] = "" + this._ranges[t];
                return e.join("");
              }),
              (V.collapse = function (t, n) {
                Q(this, t);
                var i = e.createRange(t);
                i.collapseToPoint(t, n),
                  this.setSingleRange(i),
                  (this.isCollapsed = !0);
              }),
              (V.collapseToStart = function () {
                if (!this.rangeCount) throw new c("INVALID_STATE_ERR");
                var e = this._ranges[0];
                this.collapse(e.startContainer, e.startOffset);
              }),
              (V.collapseToEnd = function () {
                if (!this.rangeCount) throw new c("INVALID_STATE_ERR");
                var e = this._ranges[this.rangeCount - 1];
                this.collapse(e.endContainer, e.endOffset);
              }),
              (V.selectAllChildren = function (t) {
                Q(this, t);
                var n = e.createRange(t);
                n.selectNodeContents(t), this.setSingleRange(n);
              }),
              (V.deleteFromDocument = function () {
                if (L && w && "Control" == this.docSelection.type) {
                  for (var e, t = this.docSelection.createRange(); t.length; )
                    (e = t.item(0)), t.remove(e), e.parentNode.removeChild(e);
                  this.refresh();
                } else if (this.rangeCount) {
                  var n = this.getAllRanges();
                  if (n.length) {
                    this.removeAllRanges();
                    for (var i = 0, r = n.length; i < r; ++i)
                      n[i].deleteContents();
                    this.addRange(n[r - 1]);
                  }
                }
              }),
              (V.eachRange = function (e, t) {
                for (var n = 0, i = this._ranges.length; n < i; ++n)
                  if (e(this.getRangeAt(n))) return t;
              }),
              (V.getAllRanges = function () {
                var e = [];
                return (
                  this.eachRange(function (t) {
                    e.push(t);
                  }),
                  e
                );
              }),
              (V.setSingleRange = function (e, t) {
                this.removeAllRanges(), this.addRange(e, t);
              }),
              (V.callMethodOnEachRange = function (e, t) {
                var n = [];
                return (
                  this.eachRange(function (i) {
                    n.push(i[e].apply(i, t));
                  }),
                  n
                );
              }),
              (V.setStart = X(!0)),
              (V.setEnd = X(!1)),
              (e.rangePrototype.select = function (e) {
                W(this.getDocument()).setSingleRange(this, e);
              }),
              (V.changeEachRange = function (e) {
                var t = [],
                  n = this.isBackward();
                this.eachRange(function (n) {
                  e(n), t.push(n);
                }),
                  this.removeAllRanges(),
                  n && 1 == t.length
                    ? this.addRange(t[0], "backward")
                    : this.setRanges(t);
              }),
              (V.containsNode = function (e, t) {
                return this.eachRange(function (n) {
                  return n.containsNode(e, t);
                }, !0);
              }),
              (V.getBookmark = function (e) {
                return {
                  backward: this.isBackward(),
                  rangeBookmarks: this.callMethodOnEachRange("getBookmark", [
                    e,
                  ]),
                };
              }),
              (V.moveToBookmark = function (t) {
                for (var n, i, r = [], o = 0; (n = t.rangeBookmarks[o++]); )
                  (i = e.createRange(this.win)).moveToBookmark(n), r.push(i);
                t.backward
                  ? this.setSingleRange(r[0], "backward")
                  : this.setRanges(r);
              }),
              (V.toHtml = function () {
                return this.callMethodOnEachRange("toHtml").join("");
              }),
              (V.getName = function () {
                return "WrappedSelection";
              }),
              (V.inspect = function () {
                return Z(this);
              }),
              (V.detach = function () {
                q(this.win, "delete"), U(this);
              }),
              (H.detachAll = function () {
                q(null, "deleteAll");
              }),
              (H.inspect = Z),
              (H.isDirectionBackward = m),
              (e.Selection = H),
              (e.selectionPrototype = V),
              e.addCreateMissingNativeApiListener(function (e) {
                void 0 === e.getSelection &&
                  (e.getSelection = function () {
                    return W(e);
                  }),
                  (e = null);
              });
          }
        ),
        (n.exports = i);
    }),
    $__System.registerDynamic(
      "1e",
      ["11", "13", "1b", "1d"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self, e("11");
        var i,
          r,
          o = e("13"),
          a = e("1b").SnapFlag,
          s = (o.Node, o.TYPE, e("1d")),
          l = ["“", "”", "‘", "’"],
          c = {
            isSmartQuote: function (e) {
              return (
                !!c.shouldTriggerReplaceQuote() &&
                [
                  c.userQuote(0),
                  c.userQuote(1),
                  c.userQuote(2),
                  c.userQuote(3),
                ].indexOf(e) > -1
              );
            },
            shouldTriggerReplaceQuote: function () {
              return (
                !File.option.convertSmartOnRender && File.option.smartQuote
              );
            },
            replaceQuote: function (e, t) {
              if (!File.option.convertSmartOnRender && File.option.smartQuote) {
                var n = "'" == e.textContent.toString()[0];
                e &&
                  (2 == e.textContent.length
                    ? (e.nodeValue =
                        c.userQuote(n ? 2 : 0, !1, !0) +
                        c.userQuote(n ? 3 : 1, !1, !0))
                    : (e.nodeValue = c.userQuote(n ? 2 : 0, !1, !0))),
                  t && (t.nodeValue = c.userQuote(n ? 3 : 1, !1, !0));
              }
            },
            userQuote: function (e, t, n) {
              var i = (File.option.userQuotesArray || l)[e] || l[e];
              return !t || ('"' != i && "'" != i)
                ? n && !File.option.convertSmartOnRender
                  ? i
                  : i.trim()
                : null;
            },
            shouldTriggerReplace: function (e, t) {
              var n = e.getJQueryElem(t.commonAncestorContainer);
              return (
                !n.closest(
                  "[md-inline='code'], code, script, pre, [md-inline='escape'], .md-image-src-span, .md-url"
                ).length && !n.find("code, script, [md-inline='escape']").length
              );
            },
            clearLastQuoteState: function () {
              (i = !1), (r = !1);
            },
            handlerCh: function (e, t, n, o, l, d) {
              var u,
                h = function (e, t) {
                  var n = e[e.length - 1] || "";
                  return (
                    !(
                      !/(^|[\(\{\[\s\-/\u2018])$/.exec(n) &&
                      !/(^|\s)[*`~+^$_]$/.exec(e)
                    ) ||
                    !(!t || c.userQuote(0) != n) ||
                    (!t && c.userQuote(2) == n)
                  );
                },
                p = function () {
                  return void 0 !== u ? u : (u = f().replace(/\\[-."']/g, ""));
                },
                f = function () {
                  try {
                    var e = s.createRange();
                    return (
                      e.setEnd(d.startContainer, d.startOffset),
                      e.setStart(
                        $(d.startContainer).closest("[md-inline], [cid]")[0],
                        0
                      ),
                      e.toString()
                    );
                  } catch (e) {}
                  return "";
                },
                m = function (i, r) {
                  var o = (function () {
                    var i = e.selection.buildUndo(d),
                      r = document.createTextNode(t);
                    return (
                      d.insertNode(r),
                      d.setStart(r, t.length),
                      d.setEnd(r, t.length),
                      d.select(),
                      e.undo.addSnap(n.cid, a.ADD),
                      (i.end = i.start + 1),
                      (i.start = i.end),
                      i
                    );
                  })();
                  (o.start -= 1 + i),
                    e.selection.restoreSelection(e.findElemById(n.cid)[0], {
                      start: o.end,
                      end: o.end,
                    });
                  var s = e.selection.restoreSelection(
                    e.findElemById(n.cid)[0],
                    { start: o.start, end: o.end }
                  );
                  if (s) {
                    var l = document.createTextNode(r);
                    s.deleteContents(),
                      s.insertNode(l),
                      s.setStartAndEnd(l, r.length),
                      s.select();
                  }
                  e.undo.addSnap(n.cid, a.REPLACE);
                },
                g = function (t, n) {
                  var o = e.getMarkElem(t.startContainer),
                    a = e.selection.getOffset(o, t);
                  return n
                    ? !(!i || i.startContainer != o[0] || i.startOffset != a) ||
                        ((i = { startContainer: o[0], startOffset: a }), !1)
                    : !(!r || r.startContainer != o[0] || r.startOffset != a) ||
                        ((r = { startContainer: o[0], startOffset: a }), !1);
                };
              if (!File.option.convertSmartOnRender) {
                if ("-" == t && File.option.smartDash) {
                  if (!c.shouldTriggerReplace(e, d)) return;
                  var v;
                  if (/\\$/.exec(p())) return;
                  if ((v = /(--|–)$/.exec(p()))) return m(v[0].length, "—"), !0;
                  if (/-$/.exec(p()))
                    return m(1, File.option.twoHyphensToEm ? "—" : "–"), !0;
                }
                if ("." == t && File.option.smartDash) {
                  if (!c.shouldTriggerReplace(e, d)) return;
                  if (/\\$/.exec(p())) return;
                  if (/\.\.$/.exec(p())) return m(2, "…"), !0;
                }
                var y;
                if ("'" == t && File.option.smartQuote) {
                  if (!c.shouldTriggerReplace(e, d)) return;
                  if (/\\$/.exec(p())) return;
                  return (
                    (y = h(p(), !0)),
                    g(d, !0) && ((i = null), (y = !y)),
                    y ? (m(0, c.userQuote(2)), !0) : (m(0, c.userQuote(3)), !0)
                  );
                }
                if ('"' == t && File.option.smartQuote) {
                  if (!c.shouldTriggerReplace(e, d)) return;
                  if (/\\$/.exec(p())) return;
                  return (
                    (y = h(p(), !1)),
                    g(d, !1) && ((r = null), (y = !y)),
                    y
                      ? (m(0, c.userQuote(0, void 0, !0)), !0)
                      : (m(0, c.userQuote(1, void 0, !0)), !0)
                  );
                }
              }
            },
          };
        n.exports = c;
      }
    ),
    $__System.registerDynamic(
      "60",
      ["4d", "4e", "11", "28", "32", "26", "59", "58", "1e"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("4d"),
          r = e("4e"),
          o = e("11"),
          a = e("28"),
          s = (e("32"), e("26")),
          l = s.map,
          c = e("59"),
          d =
            (e("58"),
            e("1e"),
            (o = e("11")),
            function (e) {
              File.isNodeHtml &&
                ((this.sessionStr = e), $(document).ready(f.bind(this)));
            }),
          u = function (e, t) {
            var n = File.option.convertSmartOnRender || !1,
              i = File.option.smartQuote || !1,
              r = File.option.smartDash || !1,
              o = File.option.remapUnicodePunctuation || (!n && (i || r)),
              a = !n && (i || r),
              s = !e;
            (e = e || {}),
              t ||
                ((e[
                  "Edit→Smart Punctuation→Remap Unicode Punctuation on Parse"
                ] = { state: o, enabled: !a }),
                s && JSBridge.menu.update(e)),
              $("#remap-punctuation").prop("checked", o),
              $("#remap-punctuation").prop("disabled", a);
          };
        (d.prototype.setSmartyPantsTiming = function (e) {
          var t = {
            "Edit→Smart Punctuation→Convert on Input": { state: !e },
            "Edit→Smart Punctuation→Convert on Rendering": { state: e },
          };
          JSBridge.putSetting("SmartyPantsOnRendering", e || !1),
            (File.option.convertSmartOnRender = e),
            c.execForAll(
              "function() {\t\tFile.option.convertSmartOnRender = %@;\t}".replace(
                "%@",
                e ? "true" : "false"
              )
            ),
            u(t),
            JSBridge.menu.update(t);
        }),
          (d.prototype.setSmartDash = function (e) {
            var t = {
              "Edit→Smart Punctuation→Smart Dashes": { state: e || !1 },
            };
            (File.option.smartDash = e || !1),
              JSBridge.putSetting("smartDash", e || !1),
              c.execForAll(
                "function() {\t\tFile.option.smartDash = %@;\t}".replace(
                  "%@",
                  e ? "true" : "false"
                )
              ),
              u(t),
              JSBridge.menu.update(t);
          }),
          (d.prototype.setSmartQuote = function (e) {
            var t = {
              "Edit→Smart Punctuation→Smart Quotes": { state: e || !1 },
            };
            JSBridge.putSetting("smartQuote", e || !1),
              (File.option.smartQuote = e || !1),
              c.execForAll(
                "function() {\t\tFile.option.smartDash = %@;\t}".replace(
                  "%@",
                  e ? "true" : "false"
                )
              ),
              u(t),
              JSBridge.menu.update(t);
          }),
          (d.prototype.setRemapPunctuation = function (e) {
            (File.option.remapUnicodePunctuation = e || !1),
              JSBridge.putSetting("remapPunctuation", e || !1),
              c.execForAll(
                "function() {\t\tFile.option.remapUnicodePunctuation = %@;\t}".replace(
                  "%@",
                  e ? "true" : "false"
                )
              ),
              u();
          });
        var h = null,
          p = null;
        (d.prototype.hide = function () {
          document.body.classList.contains("megamenu-opened") &&
            (document.body.classList.remove("megamenu-opened"),
            this.closePreferencePanel(),
            File.editor.lastCursor &&
              File.editor.undo.exeCommand(File.editor.lastCursor),
            (p = null));
        }),
          (d.prototype.show = function () {
            (File.editor.lastCursor = File.editor.selection.buildUndo()),
              document.body.classList.add("megamenu-opened"),
              $(".dropdown-menu").removeClass("open").removeClass("show"),
              File.editor.cleanTooltip(),
              document.body.classList.remove("ty-show-notification");
          }),
          (d.prototype.isShown = function () {
            return (
              !!document.body.classList.contains("megamenu-opened") &&
              ($(".megamenu-menu-list a.active[role='menuitem']").attr("id") ||
                !0)
            );
          }),
          (d.prototype.highlight = function (e) {
            var t = document.querySelector("#uni-preference-panel-view");
            function n() {
              t.send(
                "executeJavaScript",
                "window.makeHighlight('%@')".replace("%@", e)
              );
            }
            t
              ? (this.showPreferencePanel(), n())
              : ((t = this.showPreferencePanel()), setTimeout(n, 1e3));
          });
        var f = function () {
            function e() {
              var e = this.getAttribute("id").substr(2);
              "preference" == e
                ? File.megaMenu.showPreferencePanel()
                : ($(".megamenu-section").addClass("hide"),
                  $("#megamenu-section-" + e).removeClass("hide"),
                  $("#megamenu-menu-list a").removeClass("active"),
                  $(this).addClass("active"));
            }
            $(document).on("keydown", function (e) {
              "Esc" === l[e.keyCode || e.which] && File.megaMenu.hide();
            }),
              $(".megamenu-menu-panel").on(
                "keydown",
                "input, button",
                function (e) {
                  "Esc" === l[e.keyCode || e.which] && File.megaMenu.hide();
                }
              ),
              $("#w-menu-btn").on("click", function () {
                return File.megaMenu.show(), $("#m-open").trigger("click"), !1;
              }),
              $("#top-titlebar").on("contextmenu", function (e) {
                e.target.closest("#w-traffic-lights") ||
                  JSBridge.invoke("menu.popup");
              }),
              $(".megamenu-menu-header")
                .click(function () {
                  return File.megaMenu.hide(), !1;
                })
                .mouseleave(function () {
                  $(this).blur();
                }),
              $("#m-open")
                .on("active", function () {
                  if (!1 === e.call(this)) return !1;
                  File.isNode &&
                    JSBridge.invoke("setting.getRecentFiles").then((e) => {
                      var t = JSON.parse(e || "{}"),
                        n = t.files || [],
                        a = t.folders || [],
                        s = reqnode("fs-plus");
                      if (
                        (n.map(function (e) {
                          (e["recent-file-dir"] = s.tildify(
                            e.path.substr(0, e.path.length - e.name.length)
                          )),
                            (e["recent-file-name"] = o.escape(e.name)),
                            (e["recent-file-path"] = o.escape(e.path));
                        }),
                        a.map(function (e) {
                          (e["recent-file-dir"] = "(folder)"),
                            (e["recent-file-name"] = o.escape(e.name)),
                            (e["recent-file-path"] = o.escape(e.path));
                        }),
                        (n = (n = n.concat(a))
                          .filter(function (e) {
                            return e["recent-file-name"].trim().length > 0;
                          })
                          .sort(function (e, t) {
                            return -e.date + t.date;
                          })),
                        h)
                      )
                        h.clear(), h.add(n);
                      else {
                        var l = {
                          item: "recent-file-item-pattern",
                          listClass: "list-js-list",
                          valueNames: ["name"],
                          plugins: [r()],
                        };
                        h = new i("recent-file-panel", l, n);
                      }
                    });
                })
                .on("click", function () {
                  $(this).trigger("active"),
                    !$("#megamenu-section-open")
                      .removeClass("hide")
                      .is(":visible") && $("#m-open-local").trigger("click");
                }),
              $("#m-export, #m-about").click(e),
              $("#m-theme").click(function () {
                if ((b(), !1 === e.call(this))) return !1;
              }),
              $("#m-preference").click(function () {
                e.call(this);
              }),
              File.isNode &&
                ($("#m-close").click(c.close),
                $("#m-new").click(c.newFile),
                $("#recent-file-panel").on(
                  "click",
                  ".recent-file-item",
                  function () {
                    var e = this.querySelector(".recent-file-path").innerHTML,
                      t = o.unescape(e);
                    File.fs.existsSync(t)
                      ? (c.openWithPath(t), File.megaMenu.hide())
                      : (a.showDialog({
                          title: $.localize.getString("Error"),
                          html: $.localize
                            .getString(
                              "File does not exist at <em>{0}</em>",
                              "Panel"
                            )
                            .format(e),
                          type: "error",
                          backdrop: "static",
                        }),
                        JSBridge.invoke("setting.removeRecentDocument", t),
                        h && h.remove("path", t));
                  }
                ),
                $("#megamenu-clear-recet-documents").mousedown(function () {
                  JSBridge.invoke("setting.clearRecentDocuments"), h.clear();
                }),
                $("#recent-file-panel-action-btn").blur(function () {
                  var e = this;
                  setTimeout(function () {
                    e.parentElement.classList.remove("open");
                  }, 10);
                }),
                $("#m-open-local").click(c.open),
                $("#m-import-local").click(c.import),
                $("#m-save").click(c.save),
                $("#m-save-as").click(c.saveAs),
                g(),
                $("#m-print").click(c.print),
                $("#open-theme-folder-btn").click(function () {
                  JSBridge.invoke(
                    "shell.openItem",
                    _options.userDataPath + "/themes"
                  );
                }),
                v()),
              File.isNode &&
                _options.framelessWindow &&
                (s("alt+f", function (e) {
                  e.preventDefault(),
                    File.megaMenu.closePreferencePanel(),
                    File.megaMenu.show(),
                    $("#m-open").trigger("click");
                }),
                ["alt+e", "alt+p", "alt+o", "alt+v", "alt+t", "alt+h"].forEach(
                  (e, t) => {
                    s(e, function (e) {
                      e.preventDefault(),
                        JSBridge.invoke("menu.popup", {
                          x: 0,
                          y: 0,
                          positioningItem: t + 1,
                        });
                    });
                  }
                ));
          },
          m = {
            pfd: "file-pdf-o",
            html: "file-code-o",
            "html-plain": "file-code-o",
            epub: "book",
            latex: "file-code-o",
            opml: "file-code-o",
          },
          g = function () {
            File.option.framelessWindow &&
              JSBridge.invoke("setting.loadExports").then((e) => {
                var t = JSON.parse(e),
                  n = t[0],
                  i = t[1];
                $("#export-custom-container").html(
                  Object.keys(i)
                    .map((e) => {
                      var t = i[e],
                        n = m[t.type || e] || "file-text";
                      return '<div class="long-btn do-export-button" data-key="%key%"><i class="fa fa-%icon%"></i><span>%name%</span></div>'
                        .replace("%key%", e)
                        .replace("%icon%", n)
                        .replace("%name%", t.name);
                    })
                    .join("")
                );
                var r = Object.assign(n, i);
                $("#megamenu-section-export")
                  .off("click", ".do-export-button")
                  .on("click", ".do-export-button", function (e) {
                    c.export(r[this.dataset.key]);
                  });
              });
          },
          v = function () {
            $("#about-page-version-label").text(
              "version " + File.option.appVersion
            );
            var e = $("#about-content-about-section");
            File.option.framelessWindow ||
              e.appendTo("#about-dialog .modal-body");
            var t = "";
            "typora" == process.env.SNAP_NAME && (t = " SNAP"),
              e
                .find(".about-content-description-main")
                .html(
                  `Typora<span class="about-content-hint"> for ${
                    File.isWin ? "Windows" : "Linux"
                  } (${process.arch}${t})</span>`
                ),
              $("#typora-help-md-table tr").click(function () {
                if (
                  this.textContent.trim() ==
                  $.localize.getString("Support Documentation", "Panel")
                ) {
                  const e = File.option.useMirrorInCN
                    ? "typoraio.cn"
                    : "typora.io";
                  JSBridge.showInBrowser(`https://support.${e}`);
                } else JSBridge.invoke("app.openFile", window.dirname + "/Docs/" + this.textContent.trim() + ".md", { forceCreateWindow: !0 });
              }),
              e.on("click", "#about-content-license-button", function () {
                File.isNode &&
                  reqnode("electron").ipcRenderer.invoke("license.show");
              });
          },
          y = !1,
          b = function () {
            JSBridge.invoke("setting.getThemes").then((e) => {
              var t = e.all,
                n = e.current,
                i = "";
              y ||
                (t.map(function (e) {
                  i +=
                    '<div class="theme-preview-div" data-theme="$theme$" ><iframe class="theme-preview-content" src="html/preview.html?$src$""></iframe><div style="position:absolute; top:0;left:0;bottom:0;right:0;background:white;opacity:0;padding:0;margin:0;"></div><i class="fa fa-check-circle"></i></div>'
                      .replace(
                        "$src$",
                        encodeURI(
                          "folder=typora://app/userData/themes&&css=" + e
                        )
                      )
                      .replace("$theme$", e);
                }),
                $("#theme-preview-grid")
                  .html(i)
                  .on("click", ".theme-preview-div", function () {
                    $("#theme-preview-grid")
                      .find(".active")
                      .removeClass("active");
                    var e = $(this).addClass("active").attr("data-theme");
                    c.setTheme(
                      e,
                      e
                        .replace(/\.css$/, "")
                        .replace(/(?:^|_|-)(\w)/g, function (e, t, n) {
                          return t.toUpperCase();
                        })
                    );
                  }),
                (y = !0)),
                $("#theme-preview-grid [data-theme='" + n + "']").addClass(
                  "active"
                );
            });
          };
        (d.prototype.closePreferencePanel = function () {
          File.editor.library.recoverSidebar(),
            document.body.classList.contains("show-preference-panel") &&
              (document.body.classList.remove("show-preference-panel"),
              p
                ? (this.show(),
                  "string" == typeof p && $(p).trigger("click"),
                  (p = null))
                : File.isNode
                ? JSBridge.invoke("window.focus").then(() => {
                    File.editor.writingArea.focus(),
                      File.editor.lastCursor &&
                        File.editor.undo.exeCommand(File.editor.lastCursor);
                  })
                : File.editor.lastCursor &&
                  File.editor.undo.exeCommand(File.editor.lastCursor));
        }),
          (d.prototype.isPreferencePanelShown = function () {
            return document.body.classList.contains("show-preference-panel");
          }),
          (d.prototype.searchOnPreferencePanel = function () {
            var e = document.querySelector("#uni-preference-panel-view");
            e &&
              (e.focus(),
              e.send("executeJavaScript", "window.searchOnPreferencePanel();"));
          }),
          (d.prototype.applyTheme = function () {
            var e = document.querySelector("#uni-preference-panel-view");
            try {
              e &&
                (e.executeJavaScript(
                  "window.setThemeForNode('" +
                    File.option.curTheme.replace(/['"]/g, "") +
                    "');1;"
                ),
                e.executeJavaScript(
                  `window.setIsDarkMode(${File.colorBrightness < 0.5});1;`
                ));
            } catch (e) {}
          }),
          (d.prototype.forceReload = function () {
            var e = document.querySelector("#uni-preference-panel-view");
            try {
              e && e.executeJavaScript("window.forceReload();1;");
            } catch (e) {}
          }),
          (d.prototype.showPreferencePanel = function () {
            var e = document.querySelector("#uni-preference-panel-view");
            if (e) e.executeJavaScript("window.reloadData();1;");
            else {
              var t = this;
              (e = document.createElement("webview")).setAttribute(
                "id",
                "uni-preference-panel-view"
              );
              const n = "./page-dist/setting.html";
              e.setAttribute(
                "src",
                n +
                  (File.isWin ? "?os=win" : "?os=linux") +
                  (_options.framelessWindow ? "&unibody" : "") +
                  `&releaseType=${File.option.devVersion ? "dev" : "stable"}` +
                  `theme=${File.colorBrightness < 0.5 ? "dark" : "light"}` +
                  `&hasLicense=${File.option.hasLicense}` +
                  (window.debugMode ? "&debugMode" : "")
              ),
                e.setAttribute("nodeintegration", "true"),
                e.setAttribute("enableremotemodule", "false"),
                e.setAttribute("webpreferences", "contextIsolation=no"),
                document.querySelector("#uni-preference-panel").appendChild(e),
                e.addEventListener("ipc-message", function (e) {
                  switch (e.channel) {
                    case "close":
                      t.closePreferencePanel();
                      break;
                    case "openUnsavedDraft":
                      JSBridge.invoke("setting.getUnsavedDraftsPath").then(
                        (e) => {
                          JSBridge.invoke("shell.openItem", e);
                        }
                      );
                      break;
                    case "evaluateInHost":
                      window.eval(e.args[0]);
                  }
                }),
                e.addEventListener("dom-ready", function () {
                  e.blur(), e.focus();
                });
            }
            return (
              File.editor.library.tmpHideSidebar(!0),
              (p = this.isShown()),
              document.body.classList.remove("megamenu-opened"),
              document.body.classList.add("show-preference-panel"),
              e.focus(),
              e
            );
          }),
          (d.prototype.togglePreferencePanel = function () {
            window.File &&
              File.editor &&
              File.editor.contextMenu &&
              File.editor.contextMenu.hide(),
              document.body.classList.contains("show-preference-panel")
                ? this.closePreferencePanel()
                : this.showPreferencePanel();
          }),
          (n.exports = d);
      }
    ),
    $__System.registerDynamic(
      "a",
      ["4c", "26", "47", "13", "34", "28", "32", "59", "4b", "58", "60"],
      !0,
      function (e, t, n) {
        "use strict";
        this || self;
        var i = e("4c"),
          r = (e("26"), e("47")),
          o = (e("13"), e("34")),
          a = (e("28"), e("32")),
          s = e("59"),
          l = (e("4b"), e("58")),
          c = e("60");
        function d() {
          $("#w-min").on("click", function () {
            JSBridge.invoke("window.minimize");
          }),
            $("#w-close").on("click", function () {
              JSBridge.invoke("window.close");
            }),
            $("#w-restore").on("click", function () {
              JSBridge.invoke("window.restore");
            });
          var e = null;
          $("#w-max-group")
            .on("mouseenter", ".btn", function () {
              this.classList.add("hover");
            })
            .on("mouseleave", ".btn", function () {
              this.classList.remove("hover");
            }),
            $("#w-max")
              .on("mouseup", function (t) {
                1 === t.which &&
                  (document.body.classList.add("typora-maxmized"),
                  e && clearTimeout(e),
                  $("#w-max-group").removeClass("w-show-more"),
                  JSBridge.invoke("window.maximize"));
              })
              .on("mousedown", function () {
                e = setTimeout(function () {
                  $("#w-max-group").addClass("w-show-more");
                }, 300);
              }),
            $("#w-full").on("mouseup", function (t) {
              1 === t.which &&
                ($("#w-max-group").removeClass("w-show-more"),
                JSBridge.invoke("window.fullscreen").then((t) => {
                  t &&
                    (document.body.classList.add("typora-maxmized"),
                    e && clearTimeout(e));
                }));
            }),
            $("#w-pin").on("mouseup", function (e) {
              1 === e.which && s.pinWindow();
            }),
            $("#w-unpin").on("click", function () {
              s.unpinWindow();
            }),
            $("#top-titlebar").on("mouseleave", function () {
              e && clearTimeout(e),
                $("#w-max-group").removeClass("w-show-more");
            }),
            $("#ty-top-placeholder").on("mouseenter", function () {
              (window._options || {}).autoHideMenuBar ||
                JSBridge.invoke("window.setMenuBarVisibility", !0);
            }),
            $(".ty-link").on("click", function () {
              return JSBridge.showInBrowser(this.getAttribute("href")), !1;
            }),
            window._options.isMaximized &&
              document.body.classList.add("typora-maxmized"),
            window._options.isFullScreen &&
              (document.body.classList.add("typora-maxmized"),
              document.body.classList.add("typora-fullscreen"),
              document.body.classList.contains("native-window") &&
                $("#ty-top-placeholder").show()),
            (window.onbeforeunload = function (e) {
              return (
                r.backupVersionWorker(),
                a.tryLeaveDocument(function (e) {
                  e ||
                    (releaseCaptureWin_(),
                    (function () {
                      try {
                        Analytics.record("close");
                      } catch (e) {
                        console.warn(e);
                      }
                      try {
                        r.editor.library.end(), o.watchFileChange(null);
                      } catch (e) {
                        console.warn(e);
                      }
                      try {
                        l.silentQuit();
                      } catch (e) {
                        console.warn(e);
                      }
                      JSBridge.invoke("app.onCloseWin", r.mountFolder_);
                    })());
                }),
                !1
              );
            });
        }
        function u() {
          !0 === _options.framelessWindow
            ? (document.body.classList.remove("native-window"),
              document.body.classList.add("unibody-window"))
            : (document.body.classList.add("native-window"),
              document.body.classList.remove("unibody-window")),
            !1 !== _options.showStatusBar
              ? document.body.classList.add("show-footer")
              : document.body.classList.add("hide-footer"),
            -1 != window.navigator.userAgent.indexOf("Windows NT")
              ? (document.body.classList.add("os-windows"),
                -1 != window.navigator.userAgent.indexOf("Windows NT 6.1")
                  ? document.body.classList.add("os-windows-7")
                  : -1 != window.navigator.userAgent.indexOf("Windows NT 6.2")
                  ? document.body.classList.add("os-windows-8")
                  : -1 != window.navigator.userAgent.indexOf("Windows NT 6.3")
                  ? (document.body.classList.add("os-windows-8"),
                    document.body.classList.add("os-windows-8.1"))
                  : -1 != window.navigator.userAgent.indexOf("Windows NT 10") &&
                    document.body.classList.add("os-windows-10"))
              : process && "linux" == process.platform
              ? document.body.classList.add("os-linux")
              : process &&
                "darwin" == process.platform &&
                document.body.classList.add("os-mac"),
            (-1 == window.navigator.userAgent.indexOf("Windows NT 6.2") &&
              -1 == window.navigator.userAgent.indexOf("Windows NT 6.3")) ||
              document.body.classList.add("paint-border");
        }
        $(document).ready(function () {
          reqnode
            ? u()
            : (document.body.classList.remove("native-window"),
              document.body.classList.add("show-footer")),
            i.init(),
            r.isNodeHtml &&
              ((r.contextMenu = r.editor.contextMenu),
              (r.megaMenu = new c(r.editor.sessionStr))),
            reqnode &&
              (d(),
              (function () {
                var e = reqnode("electron").ipcRenderer;
                function t(e) {
                  if (e) {
                    var t = r.bundle.filePath;
                    (r.bundle.filePath = e),
                      o.onFilePathUpdated(
                        void 0,
                        t,
                        r.editor.imgEdit &&
                          r.editor.imgEdit.getTargetImageStorageFolder()
                      );
                  } else
                    window.Reporter.record(
                      "[doApplyRename] File.bundle.filePath = 0"
                    ),
                      o.onFilePathRemoved();
                  r.isActiveWindow() &&
                    (JSBridge.invoke("document.rename", e),
                    e ||
                      r.updateChangeCount(
                        r.ChangeType.NSChangeReadOtherContents
                      ));
                }
                window.doApplyRename = t;
                var n = r.isWin ? "\\" : "/";
                function i(e) {
                  return (
                    e &&
                    r.bundle.filePath &&
                    (r.bundle.filePath == e ||
                      0 == r.bundle.filePath.indexOf(e + n))
                  );
                }
                e.on("willRename", function (e, t) {
                  i(t.oldPath) && o.watchFileChange(null);
                });
                var a = null;
                e.on("didRename", function (e, n) {
                  !(function e() {
                    a && clearTimeout(a),
                      r._onFileSwitching
                        ? (a = setTimeout(e, 500))
                        : (i(n.oldPath) &&
                            (t(
                              n.newPath +
                                r.bundle.filePath.substr(n.oldPath.length)
                            ),
                            n.oldPath == r.getMountFolder() &&
                              r.editor.library.onRootChanged(n.newPath)),
                          r.editor.quickOpenPanel &&
                            r.editor.quickOpenPanel.updateCacheByRename(
                              n.oldPath,
                              n.newPath
                            ));
                  })();
                }),
                  e.on("willSave", function (e, t) {
                    try {
                      r.editor.library.pauseOnChange(!1, t);
                    } catch (e) {}
                    r.bundle.filePath != t ||
                      r.isActiveWindow() ||
                      (r.bundle.modifiedDate = new Date());
                  }),
                  e.on("didSave", function (e, t) {
                    r.editor.library.onFileUpdated(t),
                      r.bundle.filePath != t.path ||
                        r.isActiveWindow() ||
                        (r.bundle.modifiedDate = new Date());
                  }),
                  e.on("saveFromUntitled", function (e, n) {
                    r.bundle.filePath != n && t();
                  });
              })()),
            $("html, body, #top-titlebar").click(function () {
              $("#main-menu").removeClass("open");
            }),
            o.prepareInfoPanel(),
            $("footer")
              .on("click", "#outline-btn", function () {
                r.editor.library.toggleSidebar(),
                  r.isNode && s.refreshViewMenu();
              })
              .on("click", "#toggle-sourceview-btn", function () {
                r.toggleSourceMode();
              })
              .on("click", "#toggle-focus-mode-btn", function () {
                r.editor.toggleFocusMode();
              })
              .on("click", "#toggle-typewriter-mode-btn", function () {
                r.editor.toggleTypeWriterMode();
              })
              .on("click", function (e) {
                e.target == this && r.editor && r.editor.cleanTooltip();
              });
        });
      }
    );
})(function (e) {
  "function" == typeof define && define.amd
    ? define([], e)
    : "object" == typeof module &&
      module.exports &&
      "function" == typeof require
    ? (module.exports = e())
    : e();
});
//# sourceMappingURL=http://typora/appsrc/window/frame.js.map
